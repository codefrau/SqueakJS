window.module=function(n){if(""===n)return window;var a=n.split(".");n=a.pop();var a=module(a.join(".")),b=a[n];b||(a[n]=b={loaded:!1,pending:[],requires:function(a){return{toRun:function(e){function g(){e();b.loaded=!0;b.pending.forEach(function(a){a()})}a&&!module(a).loaded?module(a).pending.push(g):g()}}}});return b};Object.extend=function(n){for(var a=1;a<arguments.length;a++)if("object"==typeof arguments[a])for(var b in arguments[a])n[b]=arguments[a][b]};
Function.prototype.subclass=function(n){var a=function(){this.initialize&&this.initialize.apply(this,arguments);return this},b=function(){};b.prototype=this.prototype;a.prototype=new b;for(b=1;b<arguments.length;b++)Object.extend(a.prototype,arguments[b]);var b=n.split("."),c=b.pop();return module(b.join("."))[c]=a};
(function(){var n=document.getElementsByTagName("script"),n=n[n.length-1],a=n.src.replace(/[^\/]*$/,"");n.src.match(/squeak\.min\.js$/)||"vm.js jit.js plugins/ADPCMCodecPlugin.js plugins/B2DPlugin.js plugins/BitBltPlugin.js plugins/FFTPlugin.js plugins/FloatArrayPlugin.js plugins/GeniePlugin.js plugins/JPEGReaderPlugin.js plugins/KedamaPlugin.js plugins/KedamaPlugin2.js plugins/Klatt.js plugins/LargeIntegers.js plugins/Matrix2x3Plugin.js plugins/MiscPrimitivePlugin.js plugins/ScratchPlugin.js plugins/SocketPlugin.js plugins/SpeechPlugin.js plugins/SqueakSSL.js plugins/SoundGenerationPlugin.js plugins/StarSqueakPlugin.js plugins/ZipPlugin.js lib/lz-string.js lib/jszip.js".split(" ").forEach(function(b){var c=document.createElement("script");
c.setAttribute("type","text/javascript");c.setAttribute("src",a+b);document.getElementsByTagName("head")[0].appendChild(c)})})();
module("SqueakJS").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,b,d){function c(b){a.fullscreen=b;h.style.background=b?"black":"";d.header&&(d.header.style.display=b?"none":"");d.footer&&(d.footer.style.display=b?"none":"");d.fullscreenCheckbox&&(d.fullscreenCheckbox.checked=b);setTimeout(window.onresize,0)}var h=b.parentElement,e="fullscreenchange",l="fullscreenElement",f="fullscreenEnabled";h.requestFullscreen||[{req:h.webkitRequestFullscreen,exit:document.webkitExitFullscreen,
evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:h.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:h.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(a){a.req&&(h.requestFullscreen=a.req,document.exitFullscreen=a.exit,e=a.evt,l=a.elem,f=a.enable)});var m;
if(h.requestFullscreen)document.addEventListener(e,function(){c(h==document[l])}),m=function(){document[f]&&h==document[l]!=a.fullscreen&&(a.fullscreen?h.requestFullscreen():document.exitFullscreen())};else{var t=!1;m=function(){(d.header||d.footer)&&t!=a.fullscreen&&(t=a.fullscreen,c(t))}}d.fullscreenCheckbox&&(d.fullscreenCheckbox.onclick=function(){a.fullscreen=d.fullscreenCheckbox.checked;m()});return m}function a(a){if(a.swapCheckbox){var b=l.squeakImageName||"default",d=JSON.parse(l["squeakSettings:"+
b]||"{}");"swapButtons"in d&&(a.swapButtons=d.swapButtons);a.swapCheckbox.checked=a.swapButtons;a.swapCheckbox.onclick=function(){a.swapButtons=a.swapCheckbox.checked;d.swapButtons=a.swapButtons;l["squeakSettings:"+b]=JSON.stringify(d)}}}function b(a,b){var d=(a.shiftKey?Squeak.Keyboard_Shift:0)+(a.ctrlKey&&!a.altKey?Squeak.Keyboard_Ctrl:0)+(a.metaKey||a.altKey&&!a.ctrlKey?Squeak.Keyboard_Cmd:0);b.buttons=b.buttons&~Squeak.Keyboard_All|d;return d}function c(a,b,d){var c=u?a.offsetX:a.layerX;a=u?a.offsetY:
a.layerY;d.cursorCanvas&&(d.cursorCanvas.style.left=c+b.offsetLeft+d.cursorOffsetX+"px",d.cursorCanvas.style.top=a+b.offsetTop+d.cursorOffsetY+"px");a=a*b.height/b.offsetHeight|0;d.mouseX=Math.max(0,Math.min(d.width,c*b.width/b.offsetWidth|0));d.mouseY=Math.max(0,Math.min(d.height,a))}function e(a,d,h,e,l,f){c(d,h,e);if(e.vm){h=e.buttons&Squeak.Mouse_All;switch(a){case "mousedown":switch(d.button||0){case 0:h=Squeak.Mouse_Red;break;case 1:h=Squeak.Mouse_Yellow;break;case 2:h=Squeak.Mouse_Blue}f.swapButtons&&
(h==Squeak.Mouse_Yellow?h=Squeak.Mouse_Blue:h==Squeak.Mouse_Blue&&(h=Squeak.Mouse_Yellow));break;case "mouseup":h=0}e.buttons=h|b(d,e);l&&(l.push([Squeak.EventTypeMouse,d.timeStamp,e.mouseX,e.mouseY,e.buttons&Squeak.Mouse_All,e.buttons>>3]),e.signalInputEvent&&e.signalInputEvent());e.idle=0;"mouseup"==a?e.runFor&&e.runFor(100):e.runNow&&e.runNow()}}function g(a,b,d,c){if(d.vm){var h=d.buttons>>3<<8|a;h===d.vm.interruptKeycode?d.vm.interruptPending=!0:c?(c.push([Squeak.EventTypeKeyboard,b,a,Squeak.EventKeyChar,
d.buttons>>3,a]),d.signalInputEvent&&d.signalInputEvent()):d.keys.push(h);d.idle=0;d.runNow&&d.runNow()}}function k(a,b,d,h,e){h.vm&&e&&(c(b,d,h),e.push([Squeak.EventTypeDragDropFiles,b.timeStamp,a,h.mouseX,h.mouseY,h.buttons>>3,h.droppedFiles.length]),h.signalInputEvent&&h.signalInputEvent())}function f(a,b,d,c){d.buttons&=~Squeak.Keyboard_All;d.buttons=d.buttons|Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl;d.keys=[];g(a,b,d,c)}function d(d,c){function h(a){if(a.touches.length)for(var b=w.x=w.y=0;b<
a.touches.length;b++)w.x+=a.touches[b].pageX/a.touches.length,w.y+=a.touches[b].pageY/a.touches.length;return{timeStamp:a.timeStamp,button:w.button,offsetX:w.x-d.offsetLeft,offsetY:w.y-d.offsetTop}}function l(a,b,d,c){a-=d;b-=c;return Math.sqrt(a*a+b*b)}function m(a,b){return l(a.pageX,a.pageY,b.pageX,b.pageY)}function t(a,b,h,e){var l=u.cursorCanvas,f=h/d.width;d.style.left=(a|0)+"px";d.style.top=(b|0)+"px";d.style.width=(h|0)+"px";d.style.height=(e|0)+"px";l&&(l.style.left=(a+u.cursorOffsetX+u.mouseX*
f|0)+"px",l.style.top=(b+u.cursorOffsetY+u.mouseY*f|0)+"px",l.style.width=(l.width*f|0)+"px",l.style.height=(l.height*f|0)+"px");c.pixelated||(3<=f?(d.classList.add("pixelated"),l&&l.classList.add("pixelated")):(d.classList.remove("pixelated"),l&&u.cursorCanvas.classList.remove("pixelated")));return f}function B(a){for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"==a.dataTransfer.types[b])return!0;return!1}c=c||{};c.fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor=
"black",document.ontouchmove=function(a){a.preventDefault()},c.header&&(c.header.style.display="none"),c.footer&&(c.footer.style.display="none"));var u={context:d.getContext("2d"),fullscreen:!1,width:0,height:0,mouseX:0,mouseY:0,buttons:0,keys:[],clipboardString:"",clipboardStringChanged:!1,cursorCanvas:!1!==c.cursor&&document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null};a(c);c.pixelated&&(d.classList.add("pixelated"),u.cursorCanvas&&u.cursorCanvas.classList.add("pixelated"));
var y=null;u.reset=function(){y=null;u.signalInputEvent=null;u.lastTick=0;u.getNextEvent=function(a,b){y=[];y.push=function(a){y.offset=Date.now()-a[1];delete y.push;y.push(a)};u.getNextEvent=function(a,b){var d=y.shift();if(d){var c=b-y.offset;a[0]=d[0];a[1]=d[1]-c&Squeak.MillisecondClockMask;for(c=2;c<d.length;c++)a[c]=d[c]}else a[0]=Squeak.EventTypeNone};u.getNextEvent(a,b)}};u.reset();var p=n(u,d,c);u.fullscreenRequest=function(a,b){u.fullscreen!=a?(u.fullscreen=a,u.resizeTodo=b,u.resizeTodoTimeout=
setTimeout(u.resizeDone,1E3),p()):b()};u.resizeDone=function(){clearTimeout(u.resizeTodoTimeout);var a=u.resizeTodo;a&&(u.resizeTodo=null,a())};u.clear=function(){d.width=d.width};u.showBanner=function(a,b){b=b||{};var c=u.context;c.clearRect(0,0,d.width,d.height);c.fillStyle=b.color||"#F90";c.font=b.font||"bold 48px sans-serif";!b.font&&c.measureText(a).width>d.width&&(c.font="bold 24px sans-serif");c.textAlign="center";c.textBaseline="middle";c.fillText(a,d.width/2,d.height/2)};u.showProgress=function(a,
b){b=b||{};var c=u.context,h=d.width/3|0,e=.5*d.width-h/2,l=.5*d.height+48;c.fillStyle=b.background||"#000";c.fillRect(e,l,h,24);c.lineWidth=2;c.strokeStyle=b.color||"#F90";c.strokeRect(e,l,h,24);c.fillStyle=b.color||"#F90";c.fillRect(e,l,h*a,24)};u.executeClipboardPaste=function(a,b){if(!u.vm)return!0;try{u.clipboardString=a,f(118,b,u,y)}catch(d){console.error("paste error "+d)}};u.executeClipboardCopy=function(a,b){if(!u.vm)return!0;u.clipboardStringChanged=!1;f((a||"c").charCodeAt(0),b,u,y);for(var d=
Date.now();!u.clipboardStringChanged&&500>Date.now()-d;)u.vm.interpret(20);if(u.clipboardStringChanged)try{return u.clipboardString}catch(c){console.error("copy error "+c)}};d.onmousedown=function(a){p();e("mousedown",a,d,u,y,c);a.preventDefault();return!1};d.onmouseup=function(a){e("mouseup",a,d,u,y,c);p();a.preventDefault()};d.onmousemove=function(a){e("mousemove",a,d,u,y,c);a.preventDefault()};d.oncontextmenu=function(){return!1};var w={state:"idle",button:0,x:0,y:0,dist:0,down:{}};d.ontouchstart=
function(a){a.preventDefault();for(var b=h(a),f=0;f<a.changedTouches.length;f++)switch(w.state){case "idle":w.state="got1stFinger";w.first=b;setTimeout(function(){"got1stFinger"===w.state&&(w.state="mousing",w.button=b.button=0,e("mousemove",b,d,u,y,c),e("mousedown",b,d,u,y,c))},100);break;case "got1stFinger":w.state="got2ndFinger",w.dist=m(a.touches[0],a.touches[1]),w.down.x=w.x,w.down.y=w.y,w.down.dist=w.dist,w.down.left=d.offsetLeft,w.down.top=d.offsetTop,w.down.width=d.offsetWidth,w.down.height=
d.offsetHeight,w.orig||(w.orig={left:w.down.left,top:w.down.top,right:w.down.left+w.down.width,bottom:w.down.top+w.down.height,width:w.down.width,height:w.down.height}),setTimeout(function(){"got2ndFinger"===w.state&&(10<Math.abs(w.down.dist-w.dist)||10<l(w.down.x,w.down.y,w.x,w.y)?w.state="zooming":(w.state="mousing",w.button=b.button=2,e("mousemove",b,d,u,y,c),e("mousedown",b,d,u,y,c)))},200)}};d.ontouchmove=function(a){a.preventDefault();var b=h(a);switch(w.state){case "got1stFinger":w.state="mousing";
w.button=b.button=0;e("mousemove",b,d,u,y,c);e("mousedown",b,d,u,y,c);break;case "mousing":e("mousemove",b,d,u,y,c);break;case "got2ndFinger":1<a.touches.length&&(w.dist=m(a.touches[0],a.touches[1]));break;case "zooming":if(!(2>a.touches.length)){w.dist=m(a.touches[0],a.touches[1]);a=w.orig.width/w.down.width;var l=Math.min(Math.max(w.dist/w.down.dist,.95*a),5*a);a=w.down.width*l;var b=w.orig.height*a/w.orig.width,f=w.down.left-(w.down.x-w.down.left)*(l-1)+(w.x-w.down.x),l=w.down.top-(w.down.y-w.down.top)*
(l-1)+(w.y-w.down.y),f=Math.max(Math.min(f,w.orig.left+20),w.orig.right-a-20),l=Math.max(Math.min(l,w.orig.top+20),w.orig.bottom-b-20);t(f,l,a,b)}}};d.ontouchend=function(a){a.preventDefault();p();for(var b=h(a),l=0;l<a.changedTouches.length;l++)switch(w.state){case "mousing":if(0<a.touches.length)break;w.state="idle";e("mouseup",b,d,u,y,c);return;case "got1stFinger":w.state="idle";w.button=b.button=0;e("mousemove",b,d,u,y,c);e("mousedown",b,d,u,y,c);e("mouseup",b,d,u,y,c);return;case "got2ndFinger":w.state=
"mousing";w.button=b.button=2;e("mousemove",b,d,u,y,c);e("mousedown",b,d,u,y,c);break;case "zooming":if(!(0<a.touches.length)){w.state="idle";a=d.offsetLeft;var b=d.offsetTop,l=d.offsetWidth,f,l=Math.min(Math.max(l,w.orig.width),5*w.orig.width);f=w.orig.height*l/w.orig.width;a=Math.max(Math.min(a,w.orig.left),w.orig.right-l);b=Math.max(Math.min(b,w.orig.top),w.orig.bottom-f);1E-4>t(a,b,l,f)-u.initialScale&&(w.orig=null,window.onresize());return}}};d.ontouchcancel=function(a){d.ontouchend(a)};if(u.cursorCanvas){var q=
window.getComputedStyle(d);u.cursorCanvas.style.display="block";u.cursorCanvas.style.position=q.position;u.cursorCanvas.style.cursor="none";u.cursorCanvas.style.background="transparent";u.cursorCanvas.style.pointerEvents="none";d.parentElement.appendChild(u.cursorCanvas);d.style.cursor="none"}document.onkeypress=function(a){if(!u.vm||/[CXVR]/.test(String.fromCharCode(a.charCode+64)))return!0;b(a,u);g(a.charCode,a.timeStamp,u,y);a.preventDefault()};document.onkeydown=function(a){p();if(!u.vm)return!0;
b(a,u);var d={8:8,9:9,13:13,27:27,32:32,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[a.keyCode];if(d)return g(d,a.timeStamp,u,y),a.preventDefault();if(a.metaKey||a.altKey&&!a.ctrlKey)if(d=a.key,!d&&a.keyIdentifier&&"U+"==a.keyIdentifier.slice(0,2)&&(d=String.fromCharCode(parseInt(a.keyIdentifier.slice(2),16))),d&&1==d.length){if(/[CXVR]/i.test(d))return!0;var c=d.charCodeAt(0);/[A-Z]/.test(d)&&!a.shiftKey&&(c+=32);g(c,a.timeStamp,u,y);return a.preventDefault()}};document.onkeyup=function(a){if(!u.vm)return!0;
b(a,u)};document.oncopy=function(a,b){var d=u.executeClipboardCopy(b,a.timeStamp);"string"===typeof d&&a.clipboardData.setData("Text",d);a.preventDefault()};document.oncut=function(a){if(!u.vm)return!0;document.oncopy(a,"x")};document.onpaste=function(a){var b=a.clipboardData.getData("Text");u.executeClipboardPaste(b,a.timeStamp);a.preventDefault()};"ontouchstart"in document&&(q=document.createElement("div"),q.innerHTML='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="50px" height="50px" viewBox="0 0 150 150" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="Page-1" stroke="none" fill="#000000"><rect x="33" y="105" width="10" height="10" rx="1"></rect><rect x="26" y="60" width="10" height="10" rx="1"></rect><rect x="41" y="60" width="10" height="10" rx="1"></rect><rect x="56" y="60" width="10" height="10" rx="1"></rect><rect x="71" y="60" width="10" height="10" rx="1"></rect><rect x="86" y="60" width="10" height="10" rx="1"></rect><rect x="101" y="60" width="10" height="10" rx="1"></rect><rect x="116" y="60" width="10" height="10" rx="1"></rect><rect x="108" y="105" width="10" height="10" rx="1"></rect><rect x="33" y="75" width="10" height="10" rx="1"></rect><rect x="48" y="75" width="10" height="10" rx="1"></rect><rect x="63" y="75" width="10" height="10" rx="1"></rect><rect x="78" y="75" width="10" height="10" rx="1"></rect><rect x="93" y="75" width="10" height="10" rx="1"></rect><rect x="108" y="75" width="10" height="10" rx="1"></rect><rect x="41" y="90" width="10" height="10" rx="1"></rect><rect x="26" y="90" width="10" height="10" rx="1"></rect><rect x="56" y="90" width="10" height="10" rx="1"></rect><rect x="71" y="90" width="10" height="10" rx="1"></rect><rect x="86" y="90" width="10" height="10" rx="1"></rect><rect x="101" y="90" width="10" height="10" rx="1"></rect><rect x="116" y="90" width="10" height="10" rx="1"></rect><rect x="48" y="105" width="55" height="10" rx="1"></rect><path d="M20.0056004,51 C18.3456532,51 17.0000001,52.3496496 17.0000001,54.0038284 L17.0000001,85.6824519 L17,120.003453 C17.0000001,121.6584 18.3455253,123 20.0056004,123 L131.9944,123 C133.654347,123 135,121.657592 135,119.997916 L135,54.0020839 C135,52.3440787 133.654475,51 131.9944,51 L20.0056004,51 Z" fill="none" stroke="#000000" stroke-width="2"></path><path d="M52.0410156,36.6054687 L75.5449219,21.6503905 L102.666016,36.6054687" id="Line" stroke="#000000" stroke-width="3" stroke-linecap="round" fill="none"></path></g></svg>',
q.setAttribute("style","position:fixed;right:0;bottom:0;background-color:rgba(128,128,128,0.5);border-radius:5px"),d.parentElement.appendChild(q),q.onmousedown=function(a){d.contentEditable=!0;d.setAttribute("autocomplete","off");d.setAttribute("autocorrect","off");d.setAttribute("autocapitalize","off");d.setAttribute("spellcheck","off");d.focus();a.preventDefault()},q.ontouchstart=q.onmousedown);document.ondragover=function(a){a.preventDefault();B(a)?(a.dataTransfer.dropEffect="copy",k(Squeak.EventDragMove,
a,d,u,y)):a.dataTransfer.dropEffect="none"};document.ondragenter=function(a){B(a)&&k(Squeak.EventDragEnter,a,d,u,y)};document.ondragleave=function(a){B(a)&&k(Squeak.EventDragLeave,a,d,u,y)};document.ondrop=function(a){a.preventDefault();if(!B(a))return!1;var b=[].slice.call(a.dataTransfer.files),h=[],e,l=null;u.droppedFiles=[];b.forEach(function(f){u.droppedFiles.push(f.name);var m=new FileReader;m.onload=function(){var m=this.result;Squeak.filePut(f.name,m);h.push(f.name);e||!/.*image$/.test(f.name)||
u.vm&&!confirm("Run "+f.name+" now?\n(cancel to use as file)")||(e=m,l=f.name);h.length==b.length&&(e?(SqueakJS.appName=l.slice(0,-6),SqueakJS.runImage(e,l,u,c)):k(Squeak.EventDragDrop,a,d,u,y))};m.readAsArrayBuffer(f)});return!1};window.onresize=function(){if(!w.orig){var a=window.innerWidth,b=window.innerHeight;setTimeout(function(){a==window.innerWidth&&b==window.innerHeight&&u.resizeDone()},300);if(c.header&&c.footer||c.fullscreen){var h=c.fullscreen||u.fullscreen,e=h?0:c.header.offsetTop+c.header.offsetHeight,
l=window.innerWidth,h=h?window.innerHeight:Math.max(100,c.footer.offsetTop-e),f=0,m=0;if(c.fixedWidth){u.width=c.fixedWidth;u.height=c.fixedHeight;var t=u.width/u.height;l/h>t?f=l-Math.floor(h*t):m=h-Math.floor(l/t);u.initialScale=(l-f)/u.width}else c.minWidth||(c.minWidth=700),c.minHeight||(c.minHeight=700),t=Math.max(l<c.minWidth?c.minWidth/l:1,h<c.minHeight?c.minHeight/h:1),u.width=Math.floor(l*t),u.height=Math.floor(h*t),u.initialScale=l/u.width;d.style.left=0+Math.floor(f/2)+"px";d.style.top=
e+Math.floor(m/2)+"px";d.style.width=l-f+"px";d.style.height=h-m+"px";if(d.width!=u.width||d.height!=u.height)e=(c.fixedWidth||!u.resizeTodo)&&u.context.getImageData(0,0,d.width,d.height),d.width=u.width,d.height=u.height,e&&u.context.putImageData(e,0,0);u.cursorCanvas&&c.fixedWidth&&(e=u.cursorCanvas,t=d.offsetWidth/d.width,e.style.width=e.width*t+"px",e.style.height=e.height*t+"px")}else u.width=d.width,u.height=d.height}};window.onresize();return u}function p(a,b){var d=b.spinner;if(!d)return null;
d.onmousedown=function(b){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(a.interruptPending=!0)};return d.style}function A(a){var b=window.location.hash.slice(1);if(b=b&&b.split("&"))for(var d=0;d<b.length;d++){var c=b[d].split("="),h=c[0],e=!0;if(1<c.length&&(e=decodeURIComponent(c.slice(1).join("=")),e.match(/^(true|false|null|[0-9"[{].*)$/)))try{e=JSON.parse(e)}catch(l){"["===e[0]&&(e=e.slice(1,-1).split(","))}a[h]=e}b=Squeak.splitFilePath(a.root||"/").fullname;Squeak.dirCreate(b,!0);/\/$/.test(b)||
(b+="/");a.root=b;SqueakJS.options=a}function x(a){if(a.templates){if(a.templates.constructor===Array){var b={};a.templates.forEach(function(a){b[a]=a});a.templates=b}for(var d in a.templates)Squeak.fetchTemplateDir("/"==d[0]?d:a.root+d,a.templates[d])}}function q(a,b,d,c){Squeak.filePut(d.root+a.name,a.data,function(){console.log("Stored "+d.root+a.name);a.zip?m(a,b,d,c):c()})}function m(a,b,d,c){JSZip().loadAsync(a.data).then(function(h){var e=[];h.forEach(function(h){!d.image.name&&h.match(/\.image$/)&&
(d.image.name=h);if(d.forceDownload||!Squeak.fileExists(d.root+h))e.push(h);else if(d.image.name===h){var l=c;c=function(){Squeak.fileGet(d.root+h,function(a){d.image.data=a;return l()},function(){Squeak.fileDelete(d.root+a.name);return m(a,b,d,l)})}}});if(0===e.length)return c();var l=0;b.showBanner("Unzipping "+a.name);b.showProgress(0);e.forEach(function(f){console.log("Inflating "+a.name+": "+f);h.file(f).async("arraybuffer",function(a){b.showProgress((a.percent/100+l)/e.length)}).then(function(a){console.log("Expanded size of "+
f+": "+a.byteLength);var h={};d.image.name===f&&(h=d.image);h.name=f;h.data=a;q(h,b,d,function(){++l===e.length&&c()})})})})}function h(a,b,d,c,h){if(!Squeak.fileExists(d.root+a.name))return h();a.image||a.zip?Squeak.fileGet(d.root+a.name,function(h){a.data=h;a.zip?m(a,b,d,c):c()},function(){Squeak.fileDelete(d.root+a.name);return h()}):c()}function t(a,b,d,c){b.showBanner("Downloading "+a.name);var h=new XMLHttpRequest;h.open("GET",(d.proxy||"")+a.url);h.responseType="arraybuffer";h.onprogress=function(a){a.lengthComputable&&
b.showProgress(a.loaded/a.total)};h.onload=function(h){if(200==this.status)a.data=this.response,q(a,b,d,c);else this.onerror(this.statusText)};h.onerror=function(b){if(d.proxy)return alert("Failed to download:\n"+a.url);console.warn("Retrying with CORS proxy: "+a.url);b=new XMLHttpRequest;b.open("GET","https://crossorigin.me/"+a.url);b.responseType=h.responseType;b.onprogress=h.onprogress;b.onload=h.onload;b.onerror=function(){alert("Failed to download:\n"+a.url)};b.send()};h.send()}function B(a,
b,d,c){function e(){if(0===a.length)return c();var l=a.shift();d.forceDownload||l.forceDownload?t(l,b,d,e):h(l,b,d,function(){e()},function(){t(l,b,d,e)})}e()}var l=window.localStorage;try{l["squeak-foo:"]="bar";if("bar"!==l["squeak-foo:"])throw Error();delete l["squeak-foo:"]}catch(L){l={}}var u=navigator.userAgent.match("AppleWebKit/"),y=0,G=0,w;SqueakJS.runImage=function(b,d,c,h){window.onbeforeunload=function(a){var b=SqueakJS.appName+" is still running";return a.returnValue=b};window.clearTimeout(w);
c.reset();c.clear();c.showBanner("Loading "+SqueakJS.appName);c.showProgress(0);var e=this;window.setTimeout(function(){var f=new Squeak.Image(d);f.readFromBuffer(b,function(){function b(){try{if(c.quitFlag)e.onQuit(m,c,h);else m.interpret(50,function(a){"sleep"==a&&(a=200);if(t){var d=t,h=m,e=500>h.lastTick-c.lastTick;0!==a||e?(d.display="none",G=0):0===G?G=h.lastTick:1E3<h.lastTick-G&&(d.display="block",y=(y+30)%360,d.webkitTransform=d.transform="rotate("+y+"deg)")}w=window.setTimeout(b,a)})}catch(a){console.error(a),
alert(a)}}c.quitFlag=!1;var m=new Squeak.Interpreter(f,c);SqueakJS.vm=m;l.squeakImageName=d;a(h);c.clear();c.showBanner("Starting "+SqueakJS.appName);var t=p(m,h);c.runNow=function(){window.clearTimeout(w);b()};c.runFor=function(a){a=Date.now()+a;do c.runNow();while(Date.now()<a)};b()},function(a){c.showProgress(a)})},0)};SqueakJS.runSqueak=function(a,b,c){A(c);!a&&c.image&&(a=c.image);var h=c.url||a&&a.replace(/[^\/]*$/,"")||"";if(h.match(/^http:/)&&location.protocol.match(/^https/))location.protocol=
"http";else{x(c);var e=d(b,c),l={url:null,name:null,image:!0,data:null},f=[];a&&(a=Squeak.splitUrl(a,h),l.url=a.full,l.name=a.filename);c.files&&c.files.forEach(function(a){var b=Squeak.splitUrl(a,h);l.name!==a&&(!l.url&&a.match(/\.image$/)?(l.name=b.filename,l.url=b.full):f.push({url:b.full,name:b.filename}))});c.zip&&("string"===typeof c.zip?[c.zip]:c.zip).forEach(function(a){a=Squeak.splitUrl(a,h);f.push({url:a.full,name:a.filename,zip:!0})});l.url&&f.push(l);c.document&&(a=Squeak.splitUrl(c.document,
h),f.push({url:a.full,name:a.filename,forceDownload:!1!==c.forceDownload}),e.documentName=c.root+a.filename);c.image=l;B(f,e,c,function(){Squeak.fsck();var a=c.image;if(!a.name)return alert("could not find an image");if(!a.data)return alert("could not find image "+a.name);SqueakJS.appName=c.appName||a.name.replace(/\.image$/,"");SqueakJS.runImage(a.data,c.root+a.name,e,c)});return e}};SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0};SqueakJS.onQuit=function(a,b,d){window.onbeforeunload=null;
b.vm=null;d.spinner&&(d.spinner.style.display="none");if(d.onQuit)d.onQuit(a,b,d);else b.showBanner(SqueakJS.appName+" stopped.")}});window.applicationCache&&applicationCache.addEventListener("updateready",function(){confirm((window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS")+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())});module("users.bert.SqueakJS.vm").requires().toRun(function(){window.Squeak=users.bert.SqueakJS.vm;var n=window.localStorage;try{n["squeak-foo:"]="bar";if("bar"!==n["squeak-foo:"])throw Error();delete n["squeak-foo:"]}catch(a){console.warn("localStorage not available, faking"),n={}}Object.extend(Squeak,"version",{vmVersion:"SqueakJS 0.9.2",vmBuild:"unknown",vmPath:"/",vmFile:"vm.js",platformName:"Web",platformSubtype:"unknown",osVersion:navigator.userAgent,windowSystem:"HTML"},"object header",{HeaderTypeMask:3,
HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,
splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_TheInputSemaphore:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_BlockContextProto:37,splOb_ExternalObjectsArray:38,
splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},
"known classes",{Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:16,Context_largeFrameSize:56,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,Stream_array:0,Stream_position:1,
Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Mutex_owner:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,
BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,
EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(a,b){this.externalModules[a]=b}},"files",{fsck:function(a,b,c,e){b=b||"";e=e||{dirs:0,files:0,bytes:0,deleted:0};if(!c){c={};for(var g in n){var k=g.match(/squeak-file(\.lz)?:(.*)$/);
k&&(c[k[2]]=!0)}if("undefined"!==typeof indexedDB)return this.dbTransaction("readonly","fsck cursor",function(d){d=d.openCursor();d.onsuccess=function(d){(d=d.target.result)?(c[d.key]=!0,d["continue"]()):Squeak.fsck(a,b,c,e)};d.onerror=function(a){console.error("fsck failed")}})}g=Squeak.dirList(b);for(var f in g){var d=b+"/"+f;g[f][3]?"squeak:"+d in n?(Squeak.fsck(null,d,c,e),e.dirs++):(console.log("Deleting stale directory "+d),Squeak.dirDelete(d),e.deleted++):c[d]?(c[d]=!1,e.files++,e.bytes+=g[f][4]):
(console.log("Deleting stale file entry "+d),Squeak.fileDelete(d,!0),e.deleted++)}if(""===b){console.log("squeak fsck: "+e.dirs+" directories, "+e.files+" files, "+(e.bytes/1E6).toFixed(1)+" MBytes");var p=[];f=0;for(d in c)f++,c[d]&&p.push(d);if(0<p.length){for(d=0;d<p.length;d++)console.log("Deleting orphaned file "+p[d]),delete n["squeak-file:"+p[d]],delete n["squeak-file.lz:"+p[d]],e.deleted++;"undefined"!==typeof indexedDB&&this.dbTransaction("readwrite","fsck delete",function(a){for(var b=0;b<
p.length;b++)a["delete"](p[b])})}a&&a(e)}},dbTransaction:function(a,b,c,e){function g(){c(Squeak.dbFake());e&&e()}function k(){var d=SqueakDB.transaction("files",a),f=d.objectStore("files");d.oncomplete=function(a){e&&e()};d.onerror=function(a){console.error(a.target.error.name+": "+b)};d.onabort=function(a){console.error(a.target.error.name+": aborting "+b);c(Squeak.dbFake());e&&e()};c(f)}if("undefined"==typeof indexedDB)return g();if(window.SqueakDB)return k();var f=indexedDB.open("squeak");if(!f)return g();
f.onsuccess=function(a){console.log("Opened files database.");window.SqueakDB=this.result;SqueakDB.onversionchange=function(a){delete window.SqueakDB;this.close()};SqueakDB.onerror=function(a){console.error("Error accessing database: "+a.target.error.name)};k()};f.onupgradeneeded=function(a){console.log("Creating files database");a.target.result.createObjectStore("files")};f.onerror=function(a){console.error(a.target.error.name+": cannot open files database");console.warn("Falling back to local storage");
g()};f.onblocked=function(a){console.log("Database upgrade needed, but was blocked.");console.warn("Falling back to local storage");g()}},dbFake:function(){"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1E5,get:function(a){var b=SqueakDBFake.bigFiles[a];if(!b){var c=n["squeak-file:"+a];if(!c){var e=n["squeak-file.lz:"+a];e&&("object"==typeof LZString?c=LZString.decompressFromUTF16(e):
console.error("LZString not loaded: cannot decompress "+a))}if(c){a=new Uint8Array(c.length);for(b=0;b<a.length;b++)a[b]=c.charCodeAt(b)&255;b=a.buffer}}var g={result:b};setTimeout(function(){if(g.onsuccess)g.onsuccess({target:g})},0);return g},put:function(a,b){if(a.byteLength>SqueakDBFake.bigFileThreshold)SqueakDBFake.bigFiles[b]||console.log("File "+b+" ("+a.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[b]=a;else{var c=Squeak.bytesAsString(new Uint8Array(a));"object"==
typeof LZString?(c=LZString.compressToUTF16(c),n["squeak-file.lz:"+b]=c,delete n["squeak-file:"+b]):n["squeak-file:"+b]=c}var e={};setTimeout(function(){if(e.onsuccess)e.onsuccess()},0);return e},"delete":function(a){delete n["squeak-file:"+a];delete n["squeak-file.lz:"+a];delete SqueakDBFake.bigFiles[a];var b={};setTimeout(function(){if(b.onsuccess)b.onsuccess()},0);return b},openCursor:function(){var a={};setTimeout(function(){if(a.onsuccess)a.onsuccess({target:a})},0);return a}});return SqueakDBFake},
fileGet:function(a,b,c){c||(c=function(a){console.log(a)});var e=this.splitFilePath(a);if(!e.basename)return c("Invalid path: "+a);if(window.SqueakDBFake&&SqueakDBFake.bigFiles[e.fullname])return b(SqueakDBFake.bigFiles[e.fullname]);this.dbTransaction("readonly","get "+a,function(a){a=a.get(e.fullname);a.onerror=function(a){c(a.target.error.name)};a.onsuccess=function(a){if(void 0!==this.result)return b(this.result);Squeak.fetchTemplateFile(e.fullname,function(a){b(a)},function(){if("undefined"==
typeof indexedDB)return c("file not found: "+e.fullname);var a=Squeak.dbFake().get(e.fullname);a.onerror=function(a){c("file not found: "+e.fullname)};a.onsuccess=function(a){b(this.result)}})}})},filePut:function(a,b,c){var e=this.splitFilePath(a);if(!e.basename)return null;var g=this.dirList(e.dirname);if(!g)return null;var k=g[e.basename],f=this.totalSeconds();if(!k)k=[e.basename,f,0,!1,0],g[e.basename]=k;else if(k[3])return null;k[2]=f;k[4]=b.byteLength||b.length||0;n["squeak:"+e.dirname]=JSON.stringify(g);
this.dbTransaction("readwrite","put "+a,function(a){a.put(b,e.fullname)},function(){c&&c()});return k},fileDelete:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;var e=this.dirList(c.dirname);if(!e)return!1;var g=e[c.basename];if(!g||g[3])return!1;delete e[c.basename];n["squeak:"+c.dirname]=JSON.stringify(e);if(b)return!0;this.dbTransaction("readwrite","delete "+a,function(a){a["delete"](c.fullname)});return!0},fileRename:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;
var e=this.splitFilePath(b);if(!e.basename)return!1;var g=this.dirList(c.dirname);if(!g)return!1;var k=g[c.basename];if(!k||k[3])return!1;var f=c.dirname==e.dirname,d=f?g:this.dirList(e.dirname);if(!d||d[e.basename])return!1;delete g[c.basename];k[0]=e.basename;d[e.basename]=k;n["squeak:"+e.dirname]=JSON.stringify(d);f||(n["squeak:"+c.dirname]=JSON.stringify(g));this.fileGet(c.fullname,function(a){this.dbTransaction("readwrite","rename "+c.fullname+" to "+e.fullname,function(b){b["delete"](c.fullname);
b.put(a,e.fullname)})}.bind(this),function(a){console.log("File rename failed: "+a)}.bind(this));return!0},fileExists:function(a){a=this.splitFilePath(a);if(!a.basename)return!1;var b=this.dirList(a.dirname);if(!b)return!1;a=b[a.basename];return!a||a[3]?!1:!0},dirCreate:function(a,b){var c=this.splitFilePath(a);if(!c.basename)return!1;b&&!n["squeak:"+c.dirname]&&Squeak.dirCreate(c.dirname,!0);var e=this.dirList(c.dirname);if(!e||e[c.basename])return!1;var g=this.totalSeconds();e[c.basename]=[c.basename,
g,g,!0,0];n["squeak:"+c.fullname]=JSON.stringify({});n["squeak:"+c.dirname]=JSON.stringify(e);return!0},dirDelete:function(a){a=this.splitFilePath(a);if(!a.basename)return!1;var b=this.dirList(a.dirname);if(!b||!b[a.basename])return!1;var c=this.dirList(a.fullname);if(!c)return!1;for(var e in c)return!1;delete b[a.basename];n["squeak:"+a.dirname]=JSON.stringify(b);delete n["squeak:"+a.fullname];return!0},dirList:function(a,b){function c(a,b){for(var c in b)if(b.hasOwnProperty(c)){var e=b[c];a[e[0]]=
e}}var e=this.splitFilePath(a),g=n["squeak:"+e.fullname],k=b&&n["squeak-template:"+e.fullname];return g||k?(e={},k&&c(e,JSON.parse(k).entries),g&&c(e,JSON.parse(g)),e):"/"==e.fullname?{}:null},splitFilePath:function(a){"/"!==a[0]&&(a="/"+a);a=a.replace(/\/\//g,"/");var b=a.match(/(.*)\/(.*)/);return{fullname:a,dirname:b[1]?b[1]:"/",basename:b[2]?b[2]:null}},splitUrl:function(a,b){var c=a.match(/(.*\/)?(.*)/),e=c[1]?c[1]:"",c=c[2]?c[2]:null;e||(b&&!b.match(/\/$/)&&(b+="/"),e=b||"",a=e+c);return{full:a,
uptoslash:e,filename:c}},flushFile:function(a){if(a.modified){var b=a.contents.buffer;b.byteLength!==a.size&&(b=new ArrayBuffer(a.size),(new Uint8Array(b)).set(a.contents.subarray(0,a.size)));Squeak.filePut(a.name,b);a.modified=!1}},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var a in SqueakFiles)this.flushFile(SqueakFiles[a])},closeAllFiles:function(){Squeak.flushAllFiles();delete window.SqueakFiles},fetchTemplateDir:function(a,b){function c(a){var b=Squeak.splitFilePath(a);"/"!==
b.dirname&&c(b.dirname);a=JSON.parse(n["squeak-template:"+b.dirname]||'{"entries": {}}');if(!a.entries[b.basename]){var e=Squeak.totalSeconds();a.entries[b.basename]=[b.basename,e,e,!0,0];n["squeak-template:"+b.dirname]=JSON.stringify(a)}}function e(a,b){var c=JSON.parse(n["squeak-template:"+a]),e;for(e in c.entries){var g=c.entries[e];g[3]&&Squeak.fetchTemplateDir(a+"/"+g[0],b+"/"+g[0])}}a=Squeak.splitFilePath(a).fullname;if(n["squeak-template:"+a])e(a,b);else{var g=b+"/sqindex.json",k=new XMLHttpRequest;
k.open("GET",g,!0);k.onload=function(f){if(200==k.status){console.log("adding template "+a);c(a);f=JSON.parse(k.response);var d={url:b,entries:{}},g;for(g in f){var A=f[g];d.entries[A[0]]=A}n["squeak-template:"+a]=JSON.stringify(d);e(a,b)}else k.onerror(k.statusText)};k.onerror=function(a){console.log("cannot load template index "+g)};k.send()}},fetchTemplateFile:function(a,b,c){a=Squeak.splitFilePath(a);var e=n["squeak-template:"+a.dirname];if(!e)return c();var g=JSON.parse(e).url;if(!g)return c();
g+="/"+a.basename;e=new XMLHttpRequest;e.open("get",g,!0);e.responseType="arraybuffer";e.timeout=3E4;e.onreadystatechange=function(){if(this.readyState==this.DONE)if(200==this.status){var e=this.response;console.log("Got "+e.byteLength+" bytes from "+g);Squeak.dirCreate(a.dirname,!0);Squeak.filePut(a.fullname,e);b(e)}else alert("Download failed ("+this.status+") "+g),c()};console.log("Fetching "+g);e.send()}},"audio",{startAudioOut:function(){if(!this.audioOutContext){var a=window.AudioContext||window.webkitAudioContext||
window.mozAudioContext||window.msAudioContext;this.audioOutContext=a&&new a}return this.audioOutContext},startAudioIn:function(a,b){if(this.audioInContext)return this.audioInSource.disconnect(),a(this.audioInContext,this.audioInSource);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!navigator.getUserMedia)return b("test: audio input not supported");navigator.getUserMedia({audio:!0,toString:function(){return"audio"}},
function(b){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioInContext=e&&new e;this.audioInSource=this.audioInContext.createMediaStreamSource(b);a(this.audioInContext,this.audioInSource)},function(){b("cannot access microphone")})},stopAudio:function(){this.audioInSource&&this.audioInSource.disconnect()}},"time",{Epoch:Date.UTC(1901,0,1)+6E4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-
Squeak.Epoch)/1E3)}},"utils",{bytesAsString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}});Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(a){this.totalMemory=1E8;this.name=a;this.newSpaceCount=this.oldSpaceCount=this.allocationCount=this.gcMilliseconds=this.gcTenured=this.gcCount=0;this.hasNewInstances={}},readFromBuffer:function(a,b,c){function e(){if(V){for(var a=X+(P.oldSpaceCount/20|0);V&&X<a;)V.installFromImage(y,
M,O,f,h),V=V.nextObject,X++;c&&c(X/P.oldSpaceCount);return!0}P.specialObjectsArray=Q;P.decorateKnownObjects();P.isSpur?P.fixSkippedOops(E):(P.fixCompiledMethods(),P.fixCompactOops());return!1}function g(){e()?window.setTimeout(g,0):b&&b()}console.log("squeak: reading "+this.name+" ("+a.byteLength+" bytes)");this.startupTime=Date.now();for(var k=new DataView(a),f=!1,d=0,p=function(){var a=k.getUint32(d,f);d+=4;return a},n=function(b,c){if(c){for(var h=[];h.length<b;)h.push(p());return h}h=new Uint32Array(a,
d,b);d+=4*b;return h},x=[6501,6502,6504,6505,6521,68E3,68002,68003,68021],q=0,m=0;;){f=!f;d=m;q=p();if(0<=x.indexOf(q))break;f||(m+=512);if(512<m)throw Error("bad image version");}this.version=q;var h=0<=[6505,6521,68003,68021].indexOf(q);this.hasClosures=0<=[6504,6505,6521,68002,68003,68021].indexOf(q);this.isSpur=0<=[6521,68021].indexOf(q);if(68E3<=q)throw Error("64 bit images not supported yet");var t=p(),B=p(),x=p(),q=p();this.lastHash=p();this.savedHeaderWords=[];for(var l=0;6>l;l++)this.savedHeaderWords.push(p());
var l=p(),u,y={},d=m+=t;if(this.isSpur){this.oldSpaceBytes=l-16;for(var B=d+l,G=0,w=null,L=null,I=0,E={};d<B;){for(;d<B-16;){var K=d,H=p(),C=p(),D=C>>>24;255===D&&(D=H,H=p(),C=p());var t=G+d-8-m,l=H>>>24&31,v=H&4194303,C=C&4194303,H=n(D,10>l&&0<v),d=d+4*(2>D?2-D:D&1);32<=v?(N=new Squeak.ObjectSpur,N.initFromImage(t,v,l,C,H),u&&(u.nextObject=N),this.oldSpaceCount++,u=N,y[x+t]=N,E[t]=I):(I+=d-K,w?L||(L=H):w=H,v&&(y[x+t]=H))}if(d!==B-16)throw Error("invalid segment");l=p();p();t=p();p();if(0===t){if(1241513987!==
l)throw Error("Magic number at image end not found");}else l*=4,B+=t,G+=l,I+=16+l,this.oldSpaceBytes+=l+t}this.oldSpaceBytes-=I;this.firstOldObject=y[x];this.lastOldObject=N}else{for(;d<m+B;){G=N=0;w=p();switch(w&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:N=w>>>2;G=p();w=p();break;case Squeak.HeaderTypeClass:G=w-Squeak.HeaderTypeClass;w=p();N=w>>>2&63;break;case Squeak.HeaderTypeShort:N=w>>>2&63;G=w>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block");}N--;
var t=d-4-m,l=w>>>8&15,C=w>>>17&4095,H=n(N,5>l),N=new Squeak.Object;N.initFromImage(t,G,l,C,H);32>G&&(N.hash|=268435456);u&&(u.nextObject=N);this.oldSpaceCount++;u=N;y[x+t]=N}this.firstOldObject=y[x+4];this.lastOldObject=N;this.oldSpaceBytes=B}u=y[q];n=this.isSpur?this.spurClassTable(y,L,u):y[u.bits[Squeak.splOb_CompactClasses]].bits;m=null;N=this.firstOldObject;for(u=null;N;)u=m,m=N.renameFromImage(y,n),u?u.nextObject=m:this.firstOldObject=m,y[x+N.oop]=m,N=N.nextObject;this.lastOldObject=m;var Q=
y[q],M=y[Q.bits[Squeak.splOb_CompactClasses]].bits,O=y[Q.bits[Squeak.splOb_ClassFloat]];this.isSpur&&(this.initCharacterTable(y[Q.bits[Squeak.splOb_ClassCharacter]]),M=this.spurClassTable(y,L,Q),h=this.getCharacter.bind(this),this.initSpurOverrides());var V=this.firstOldObject,X=0,P=this;if(c)window.setTimeout(g,0);else{for(;e(););b&&b()}},decorateKnownObjects:function(){var a=this.specialObjectsArray.pointers;a[Squeak.splOb_NilObject].isNil=!0;a[Squeak.splOb_TrueObject].isTrue=!0;a[Squeak.splOb_FalseObject].isFalse=
!0;a[Squeak.splOb_ClassFloat].isFloatClass=!0;if(!this.isSpur)for(this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,a=0;a<this.compactClasses.length;a++)this.compactClasses[a].isNil||(this.compactClasses[a].isCompact=!0);Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){if(!this.isSpur){for(var a=this.firstOldObject,b=0;a;){var c=268435455<a.hash;
if(c!==!!a.sqClass.isCompact){var e=0===a.snapshotSize().header;c!==e&&(b+=e?-4:4)}a.hash&=268435455;a.oop+=b;a=a.nextObject}this.oldSpaceBytes+=b}},fixCompiledMethods:function(){if(!(6502<=this.version))for(var a=this.firstOldObject,b=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];a;)a.isMethod()&&(a.sqClass=b),a=a.nextObject},fixSkippedOops:function(a){for(var b=this.firstOldObject;b;)b.oop-=a[b.oop],b=b.nextObject;b=this.lastOldObject;if(b.addr()+b.totalBytes()!==this.oldSpaceBytes)throw Error("image size doesn't match object sizes");
}},"garbage collection",{partialGC:function(){return this.totalMemory-this.oldSpaceBytes},fullGC:function(a){this.vm.addMessage("fullGC: "+a);a=Date.now();var b=this.markReachableObjects();this.removeUnmarkedOldObjects();this.appendToOldObjects(b);this.finalizeWeakReferences();this.allocationCount+=this.newSpaceCount;this.newSpaceCount=0;this.hasNewInstances={};this.gcCount++;this.gcMilliseconds+=Date.now()-a;return 0<b.length?b[0]:null},markReachableObjects:function(){this.vm.storeContextRegisters();
for(var a=[this.specialObjectsArray,this.vm.activeContext],b=[];0<a.length;){var c=a.pop();if(!c.mark){c.nextObject||c===this.lastOldObject||b.push(c);c.mark=!0;c.sqClass.mark||a.push(c.sqClass);var e=c.pointers;if(e){var g=c.nonWeakSize();if(this.vm.isContext(c))for(c=g=c.contextSizeWithStack();c<e.length;c++)e[c]=this.vm.nilObj;for(c=0;c<g;c++)"object"!==typeof e[c]||e[c].mark||a.push(e[c])}}}return b.sort(function(a,b){return b.oop-a.oop})},removeUnmarkedOldObjects:function(){var a=0,b=0,c=this.firstOldObject;
for(c.mark=!1;;){var e=c.nextObject;if(!e){this.lastOldObject=c;this.oldSpaceBytes-=b;this.oldSpaceCount-=a;break}e.mark?(c=e,c.mark=!1,c.oop-=b):(c.nextObject=e.nextObject,e.oop=-++this.newSpaceCount,b+=e.totalBytes(),a++)}},appendToOldObjects:function(a){for(var b=this.lastOldObject,c=0;c<a.length;c++){var e=a[c];e.mark=!1;this.oldSpaceBytes=e.setAddr(this.oldSpaceBytes);b=b.nextObject=e}this.lastOldObject=b;this.oldSpaceCount+=a.length;this.gcTenured+=a.length},tenureIfYoung:function(a){0>a.oop&&
this.appendToOldObjects([a])},finalizeWeakReferences:function(){for(var a=this.firstOldObject;a;){if(a.isWeak()){for(var b=a.pointers||[],c=a.sqClass.classInstSize(),e=!1,g=c;g<b.length;g++)0>b[g].oop&&(b[g]=this.vm.nilObj,e=!0);e&&(this.vm.pendingFinalizationSignals++,2<=c&&(b=a.pointers[Squeak.WeakFinalizerItem_list],b.sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]&&(a.pointers[Squeak.WeakFinalizerItem_next]=b.pointers[Squeak.WeakFinalizationList_first],b.pointers[Squeak.WeakFinalizationList_first]=
a)))}a=a.nextObject}0<this.vm.pendingFinalizationSignals&&this.vm.forceInterruptCheck()}},"creating",{registerObject:function(a){a.oop=-++this.newSpaceCount;this.lastHash=13849+27181*this.lastHash&4294967295;return this.lastHash&4095},registerObjectSpur:function(a){a.oop=-++this.newSpaceCount;return 0},instantiateClass:function(a,b,c){var e=new (a.classInstProto()),g=this.registerObject(e);e.initInstanceOf(a,b,g,c);this.hasNewInstances[a.oop]=!0;return e},clone:function(a){var b=new (a.sqClass.classInstProto()),
c=this.registerObject(b);b.initAsClone(a,c);this.hasNewInstances[b.sqClass.oop]=!0;return b}},"operations",{bulkBecome:function(a,b,c,e){if(!a)return!b;var g=a.length;if(g!==b.length)return!1;0<this.newSpaceCount?this.fullGC("become"):this.vm.storeContextRegisters();for(var k={},f=0;f<g;f++){var d=a[f];if(!d.sqClass||k[d.oop])return!1;k[d.oop]=b[f]}if(c)for(f=0;f<g;f++){d=b[f];if(!d.sqClass||k[d.oop])return!1;k[d.oop]=a[f]}if(e)for(f=0;f<g;f++){if(!b[f].sqClass)return!1;d=a[f].hash;a[f].hash=b[f].hash;
b[f].hash=d}for(d=this.firstOldObject;d;){if(a=k[d.sqClass.oop])d.sqClass=a;if(b=d.pointers)for(g=0;g<b.length;g++)(a=k[b[g].oop])&&(b[g]=a);d=d.nextObject}this.vm.flushMethodCacheAfterBecome(k);return!0},objectAfter:function(a){return a.nextObject||0<this.newSpaceCount&&this.fullGC("nextObject")},someInstanceOf:function(a){for(var b=this.firstOldObject;b;){if(b.sqClass===a)return b;b=b.nextObject||this.nextObjectWithGCFor(a)}return null},nextInstanceAfter:function(a){for(var b=a.sqClass;;){a=a.nextObject||
this.nextObjectWithGCFor(b);if(!a)return null;if(a.sqClass===b)return a}},nextObjectWithGCFor:function(a){return 0!==this.newSpaceCount&&this.hasNewInstances[a.oop]?this.fullGC("instance of "+a.className()):null},allInstancesOf:function(a){for(var b=this.firstOldObject,c=[];b;)b.sqClass===a&&c.push(b),b=b.nextObject||this.nextObjectWithGCFor(a);return c},writeToBuffer:function(){var a=new DataView(new ArrayBuffer(64+this.oldSpaceBytes)),b=0,c=function(c){a.setUint32(b,c);b+=4};c(this.formatVersion());
c(64);c(this.oldSpaceBytes);c(this.firstOldObject.addr());c(this.objectToOop(this.specialObjectsArray));c(this.lastHash);for(c(52429400);64>b;)c(0);for(var c=this.firstOldObject,e=0;c;)b=c.writeTo(a,b,this),c=c.nextObject,e++;if(b!==a.byteLength)throw Error("wrong image size");if(e!==this.oldSpaceCount)throw Error("wrong object count");return a.buffer},objectToOop:function(a){if("number"===typeof a)return a<<1|1;if(0>a.oop)throw Error("temporary oop");return a.oop},bytesLeft:function(){return this.totalMemory-
this.oldSpaceBytes},formatVersion:function(){return this.isSpur?6521:this.hasClosures?6504:6502},segmentVersion:function(){var a=new Uint32Array(this.specialObjectsArray.pointers[Squeak.splOb_SelectorDoesNotUnderstand].bytes.buffer,0,1);return this.formatVersion()|a[0]&4278190080},loadImageSegment:function(a,b){var c=new DataView(a.words.buffer),e=!1,g=0,k=function(){var a=c.getUint32(g,e);g+=4;return a},f=function(a,b){if(5>b){for(var d=[];d.length<a;)d.push(k());return d}d=new Uint32Array(c.buffer,
g,a);g+=4*a;return d},d=k();if(d&1&&(e=!0,g=0,d=k(),d&1))return console.error("image segment format not supported"),null;this.tenureIfYoung(a);for(var p=a,d=p.nextObject,n=a.oop,x={};g<c.byteLength;){var q=0,m=0,h=k();switch(h&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:q=h>>>2;m=k();h=k();break;case Squeak.HeaderTypeClass:m=h-Squeak.HeaderTypeClass;h=k();q=h>>>2&63;break;case Squeak.HeaderTypeShort:q=h>>>2&63;m=h>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block");
}q--;var t=g,B=h>>>8&15,h=h>>>17&4095,l=f(q,B),q=new Squeak.Object;q.initFromImage(t+n,m,B,h,l);p.nextObject=q;this.oldSpaceCount++;p=q;x[t]=q}q.nextObject=d;for(f=0;f<b.pointers.length;f++)x[2147483652+4*f]=b.pointers[f];var u=0,f=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers.map(function(a){x[--u]=a;return u});a.words=new Uint32Array([a.words[0]]);p=a.nextObject;n=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat];m=p;do m.installFromImage(x,f,n,e,!1),m=m.nextObject;
while(m!==d);return p}},"spur support",{initSpurOverrides:function(){this.registerObject=this.registerObjectSpur;this.writeToBuffer=this.writeToBufferSpur},spurClassTable:function(a,b,c){for(var e={},g=0;4096>g;g++){var k=a[b[g]];if(1024===k.length)for(var f=0;1024>f;f++){var d=a[k[f]];if(1===d._format){var p=1024*g+f;e[p]=d}}}for(var n in Squeak)/^splOb_Class/.test(n)&&(b=a[c.bits[Squeak[n]]],1===b._format&&(p=b.hash,0<p&&1024>p&&(e[p]=b)));e[3]=e[1];this.classTable=e;this.classTableIndex=1024;return e},
enterIntoClassTable:function(a){for(var b=this.classTableIndex,c=this.classTable;4194303>=b;){if(!c[b])return c[b]=a,this.classTableIndex=a.hash=b;b++}console.error("class table full?");return null},initCharacterTable:function(a){a.classInstProto("Character");this.characterClass=a;this.characterTable={}},getCharacter:function(a){var b=this.characterTable[a];b||(b=new this.characterClass.instProto,b.initInstanceOfChar(this.characterClass,a),this.characterTable[a]=b);return b},maxClassIndex:function(){var a=
1024,b=this.classTable,c;for(c in b){var e=b[c].hash;e>a&&(a=e)}return a},classTableBytes:function(){return 4*(4108+1028*((this.maxClassIndex()>>10)+1))},writeFreeLists:function(a,b,c,e){a.setUint32(b,167772178,c);b+=4;a.setUint32(b,536870912,c);return b+4+128},writeClassTable:function(a,b,c,e){var g=(this.maxClassIndex()>>10)+1;a.setUint32(b,4104,c);b+=4;a.setUint32(b,4278190080,c);b+=4;a.setUint32(b,33554448,c);b+=4;a.setUint32(b,4278190080,c);b+=4;for(var k=0;k<g;k++)a.setUint32(b,16624+4112*k,
c),b+=4;b+=4*(4104-g);for(var f=0,k=0;k<g;k++){a.setUint32(b,1024,c);b+=4;a.setUint32(b,4278190080,c);b+=4;a.setUint32(b,33554448,c);b+=4;a.setUint32(b,4278190080,c);b+=4;for(var d=0;1024>d;d++){var p=this.classTable[f];if(p&&p.pointers){if(!p.hash)throw Error("class without id");p.hash!==f&&32<=f&&(console.warn("freeing class index "+f+" "+p.className()),p=null)}p&&a.setUint32(b,e(p),c);b+=4;f++}}return b},writeToBufferSpur:function(){function a(a){e.setUint32(k,a,!0);k+=4}function b(a){if("number"===
typeof a)return a<<1|1;if(7===a._format){if(a.hash!==a.oop>>2||2!==(a.oop&3))throw Error("Bad immediate char");return a.oop}if(0>a.oop)throw Error("temporary oop");return 48>a.oop?a.oop:a.oop+c}var c=136+this.classTableBytes(),e=new DataView(new ArrayBuffer(64+c+this.oldSpaceBytes+16)),g=Date.now(),k=0;a(this.formatVersion());a(64);a(c+this.oldSpaceBytes+16);a(this.firstOldObject.addr());a(b(this.specialObjectsArray));a(this.lastHash);this.savedHeaderWords.forEach(a);for(a(c+this.oldSpaceBytes+16);64>
k;)a(0);var f=this.firstOldObject,d=0,k=f.writeTo(e,k,!0,b),f=f.nextObject;d++;k=f.writeTo(e,k,!0,b);f=f.nextObject;d++;k=f.writeTo(e,k,!0,b);f=f.nextObject;d++;k=this.writeFreeLists(e,k,!0,b);for(k=this.writeClassTable(e,k,!0,b);f;)k=f.writeTo(e,k,!0,b),f=f.nextObject,d++;a(1241513987);a(8388608);a(0);a(0);if(k!==e.byteLength)throw Error("wrong image size");if(d!==this.oldSpaceCount)throw Error("wrong object count");g=Date.now()-g;console.log("Wrote "+d+" objects in "+g+" ms, image size "+k+" bytes");
return e.buffer}});Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(a,b,c,e){this.sqClass=a;this.hash=c;c=a.pointers[Squeak.Class_format];var g=(c>>1&63)+(c>>10&192)-1;this._format=c>>7&15;8>this._format?6!=this._format?0<g+b&&(this.pointers=this.fillArray(g+b,e)):0<b&&(a.isFloatClass?(this.isFloat=!0,this["float"]=0):this.words=new Uint32Array(b)):0<b&&(this.bytes=new Uint8Array(b))},initAsClone:function(a,b){this.sqClass=a.sqClass;this.hash=b;this._format=a._format;a.isFloat?
(this.isFloat=a.isFloat,this["float"]=a["float"]):(a.pointers&&(this.pointers=a.pointers.slice(0)),a.words&&(this.words=new Uint32Array(a.words)),a.bytes&&(this.bytes=new Uint8Array(a.bytes)))},initFromImage:function(a,b,c,e,g){this.oop=a;this.sqClass=b;this._format=c;this.hash=e;this.bits=g},classNameFromImage:function(a){return(a=a[this.bits[Squeak.Class_name]])&&8<=a._format&&12>a._format?(a=a.decodeBytes(a.bits.length,a.bits,0,a._format&3),Squeak.bytesAsString(a)):"Class"},renameFromImage:function(a,
b){var c=32>this.sqClass?a[b[this.sqClass-1]]:a[this.sqClass],c=c.instProto||c.classInstProto(c.classNameFromImage(a));if(!c)return this;c=new c;c.oop=this.oop;c.sqClass=this.sqClass;c._format=this._format;c.hash=this.hash;c.bits=this.bits;return c},installFromImage:function(a,b,c,e,g){var k=this.sqClass;this.sqClass=0<k&&32>k?a[b[k-1]]:a[k];b=this.bits.length;if(5>this._format)0<b&&(e=this.bits,this.pointers=this.decodePointers(b,e,a));else if(12<=this._format)c=this.decodeWords(1,this.bits,e)[0]>>
10&255,e=this.decodeWords(c+1,this.bits,e),this.pointers=this.decodePointers(c+1,e,a),this.bytes=this.decodeBytes(b-(c+1),this.bits,c+1,this._format&3);else if(8<=this._format)0<b&&(this.bytes=this.decodeBytes(b,this.bits,0,this._format&3));else if(this.sqClass==c){if(this.isFloat=!0,this["float"]=this.decodeFloat(this.bits,e,g),1.3797216632888E-310==this["float"]&&!/noFloatDecodeWorkaround/.test(window.location.hash)&&(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this["float"]=
this.decodeFloat(this.bits,e,g),1.3797216632888E-310==this["float"]))throw Error("Cannot deoptimize decodeFloat");}else 0<b&&(this.words=this.decodeWords(b,this.bits,e));delete this.bits;this.mark=!1},decodePointers:function(a,b,c){for(var e=Array(a),g=0;g<a;g++){var k=b[g];e[g]=1===(k&1)?k>>1:c[k]||42424242}return e},decodeWords:function(a,b,c){b=new DataView(b.buffer,b.byteOffset);for(var e=new Uint32Array(a),g=0;g<a;g++)e[g]=b.getUint32(4*g,c);return e},decodeBytes:function(a,b,c,e){a=4*a-e;b=
new Uint8Array(b.buffer,b.byteOffset+4*c,a);c=new Uint8Array(a);c.set(b);return c},decodeFloat:function(a,b,c){a=new DataView(a.buffer,a.byteOffset);if(!b)return a.getFloat64(0,!1);if(c)return a.getFloat64(0,!0);b=new ArrayBuffer(8);b=new DataView(b);b.setUint32(0,a.getUint32(4));b.setUint32(4,a.getUint32(0));return b.getFloat64(0,!0)},decodeFloatDeoptimized:function(a,b,c){a=new DataView(a.buffer,a.byteOffset);if(!b)return a.getFloat64(0,!1);if(c)return a.getFloat64(0,!0);b=new ArrayBuffer(8);b=
new DataView(b);b.setUint32(0,a.getUint32(4));b.setUint32(4,a.getUint32(0));return b.getFloat64(0,!0)},fillArray:function(a,b){for(var c=[],e=0;e<a;e++)c[e]=b;return c}},"testing",{isWords:function(){return 6===this._format},isBytes:function(){var a=this._format;return 8<=a&&11>=a},isWordsOrBytes:function(){var a=this._format;return 6==a||8<=a&&11>=a},isPointers:function(){return 4>=this._format},isWeak:function(){return 4===this._format},isMethod:function(){return 12<=this._format},sameFormats:function(a,
b){return 8>a?a===b:(a&12)===(b&12)},sameFormatAs:function(a){return this.sameFormats(this._format,a._format)},sameShapeAs:function(a){return this.sameFormatAs(a)&&this.sqClass.isCompact===a.sqClass.isCompact&&this.sqClass.classInstSize()===a.sqClass.classInstSize()},classSameShapeAs:function(a){return this.sameFormats(this.classInstFormat(),a._format)&&this.isCompact===a.sqClass.isCompact&&this.classInstSize()===a.sqClass.classInstSize()}},"printing",{toString:function(){return this.sqInstName()},
bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(a){if(!this.bytes)return"";for(var b=[],c=0,e=this.bytes.length-1;0<=e;e--)b.push("0123456789ABCDEF"[this.bytes[e]>>4]),b.push("0123456789ABCDEF"[this.bytes[e]&15]),c=256*c+this.bytes[e];a=a?"-":"";e=9007199254740991<c?"\u2248":"";return a+"16r"+b.join("")+" ("+e+a+c+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(a){var b=this.instSize();
return a<=b?this.sqClass.allInstVarNames()[a-1]:(a-b).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat){var a=this["float"].toString();/\./.test(a)||(a+=".0");return a}a=this.sqClass.className();if(/ /.test(a))return"the "+a;switch(a){case "String":case "ByteString":return"'"+this.bytesAsString()+"'";case "Symbol":case "ByteSymbol":return"#"+this.bytesAsString();case "Point":return this.pointers.join("@");case "Rectangle":return this.pointers.join(" corner: ");
case "Association":case "ReadOnlyVariableBinding":return this.pointers.join("->");case "LargePositiveInteger":return this.bytesAsNumberString(!1);case "LargeNegativeInteger":return this.bytesAsNumberString(!0);case "Character":return a=this.pointers?this.pointers[0]:this.hash,"$"+String.fromCharCode(a)+" ("+a.toString()+")"}return/^[aeiou]/i.test(a)?"an"+a:"a"+a}},"accessing",{pointersSize:function(){return this.pointers?this.pointers.length:0},nonWeakSize:function(){return this.pointers?4===this._format?
this.sqClass.classInstSize():this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){var a=this._format;return 4<a||2===a?0:2>a?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(a){var b=this._format;return 2>b?-1:3===b&&a.vm.isContext(this)&&!a.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>b?this.pointersSize()-this.instSize():8>b?this.wordsSize():
12>b?this.bytesSize():this.bytesSize()+4*this.pointersSize()},floatData:function(){var a=new ArrayBuffer(8),a=new DataView(a);a.setFloat64(0,this["float"],!1);return a},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=
new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words?this.words:this.uint32Array?this.uint32Array:this.bytes?this.uint32Array=
new Uint32Array(this.bytes.buffer,0,this.bytes.length>>>2):null},setAddr:function(a){var b=this.snapshotSize();this.oop=a+4*b.header;return a+4*(b.header+b.body)},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(a+=this.bytes.length+3>>>2);a++;return{header:63<a?2:this.sqClass.isCompact?0:1,body:a}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var a=this.snapshotSize();return 4*(a.header+
a.body)},writeTo:function(a,b,c){this.bytes&&(this._format|=-this.bytes.length&3);var e=b,g=this.snapshotSize(),k=(this._format&15)<<8|(this.hash&4095)<<17;switch(g.header){case 2:a.setUint32(b,g.body<<2|Squeak.HeaderTypeSizeAndClass);b+=4;a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass);b+=4;a.setUint32(b,k|Squeak.HeaderTypeSizeAndClass);b+=4;break;case 1:a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeClass);b+=4;a.setUint32(b,k|g.body<<2|Squeak.HeaderTypeClass);b+=4;break;case 0:var f=
c.compactClasses.indexOf(this.sqClass)+1;a.setUint32(b,k|f<<12|g.body<<2|Squeak.HeaderTypeShort);b+=4}if(this.isFloat)a.setFloat64(b,this["float"]),b+=8;else if(this.words)for(g=0;g<this.words.length;g++)a.setUint32(b,this.words[g]),b+=4;else if(this.pointers)for(g=0;g<this.pointers.length;g++)a.setUint32(b,c.objectToOop(this.pointers[g])),b+=4;if(this.bytes){for(g=0;g<this.bytes.length;g++)a.setUint8(b++,this.bytes[g]);b+=-this.bytes.length&3}if(b!==e+this.totalBytes())throw Error("written size does not match");
return b}},"as class",{classInstFormat:function(){return this.pointers[Squeak.Class_format]>>7&15},classInstSize:function(){var a=this.pointers[Squeak.Class_format];return(a>>10&192)+(a>>1&63)-1},instVarNames:function(){return(this.pointers[12<this.pointers.length?4:9<this.pointers.length?3:4].pointers||[]).map(function(a){return a.bytesAsString()})},allInstVarNames:function(){var a=this.superclass();return a.isNil?this.instVarNames():a.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},
className:function(){if(!this.pointers)return"_NOTACLASS_";var a=this.pointers[Squeak.Class_name];if(a&&a.bytes)return a.bytesAsString();for(var b=5;6>=b;b++)if((a=this.pointers[b])&&a.pointers&&(a=a.pointers[Squeak.Class_name])&&a.bytes)return a.bytesAsString()+" class";return"_SOMECLASS_"},defaultInst:function(){return Squeak.Object},classInstProto:function(a){if(this.instProto)return this.instProto;var b=this.defaultInst();try{a||(a=this.className());var c=a.replace(/[^A-Za-z0-9]/g,"_"),c="UndefinedObject"===
c?"nil":"True"===c?"true_":"False"===c?"false_":(/^[AEIOU]/.test(c)?"an":"a")+c,b=(new Function("return function "+c+"() {};"))();b.prototype=this.defaultInst().prototype}catch(e){}Object.defineProperty(this,"instProto",{value:b});return b}},"as method",{methodNumLits:function(){return this.pointers[0]>>9&255},methodNumArgs:function(){return this.pointers[0]>>24&15},methodPrimitiveIndex:function(){var a=this.pointers[0]&805306879;return 511<a?(a&511)+(a>>19):a},methodClassForSuper:function(){return this.pointers[this.methodNumLits()].pointers[Squeak.Assn_value]},
methodNeedsLargeFrame:function(){return 0<(this.pointers[0]&131072)},methodAddPointers:function(a){this.pointers=a},methodTempCount:function(){return this.pointers[0]>>18&63},methodGetLiteral:function(a){return this.pointers[1+a]},methodGetSelector:function(a){return this.pointers[1+a]}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"===typeof this.pointers[Squeak.BlockContext_argumentCount]},
contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(a){if(a&&a.activeContext===this)return a.sp+1;a=this.pointers[Squeak.Context_stackPointer];return Squeak.Context_tempFrameStart+("number"===typeof a?a:0)}});Squeak.Object.subclass("Squeak.ObjectSpur","initialization",{initInstanceOf:function(a,b,c,e){this.sqClass=a;this.hash=c;var g=a.pointers[Squeak.Class_format];c=
g&65535;this._format=g=g>>16&31;12>g?10>g?0<c+b&&(this.pointers=this.fillArray(c+b,e)):0<b&&(a.isFloatClass?(this.isFloat=!0,this["float"]=0):this.words=new Uint32Array(b)):0<b&&(this.bytes=new Uint8Array(b))},installFromImage:function(a,b,c,e,g){var k=this.sqClass;if(32>k)throw Error("Invalid class ID");this.sqClass=b[k];if(!this.sqClass)throw Error("Invalid class ID");b=this.bits.length;switch(this._format){case 0:break;case 1:case 2:case 3:case 4:case 5:0<b&&(e=this.bits,this.pointers=this.decodePointers(b,
e,a,g));break;case 10:if(this.sqClass===c){if(this.isFloat=!0,this["float"]=this.decodeFloat(this.bits,e,!0),1.3797216632888E-310==this["float"]&&!/noFloatDecodeWorkaround/.test(window.location.hash)&&(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this["float"]=this.decodeFloat(this.bits,e,!0),1.3797216632888E-310==this["float"]))throw Error("Cannot deoptimize decodeFloat");}else 0<b&&(this.words=this.decodeWords(b,this.bits,e));break;case 12:case 13:throw Error("16 bit arrays not supported yet");
case 16:case 17:case 18:case 19:0<b&&(this.bytes=this.decodeBytes(b,this.bits,0,this._format&3));break;case 24:case 25:case 26:case 27:c=this.decodeWords(1,this.bits,e)[0];if(c&2147483648)throw Error("Alternate bytecode set not supported");c=c>>1&32767;e=this.decodeWords(c+1,this.bits,e);this.pointers=this.decodePointers(c+1,e,a,g);this.bytes=this.decodeBytes(b-(c+1),this.bits,c+1,this._format&3);break;default:throw Error("Unknown object format: "+this._format);}delete this.bits;this.mark=!1},decodePointers:function(a,
b,c,e){for(var g=Array(a),k=0;k<a;k++){var f=b[k];g[k]=1===(f&1)?f>>1:2===(f&3)?e(f>>>2):c[f]||42424242}return g},initInstanceOfChar:function(a,b){this.oop=b<<2|2;this.sqClass=a;this.hash=b;this._format=7;this.mark=!0},classNameFromImage:function(a){return(a=a[this.bits[Squeak.Class_name]])&&16<=a._format&&24>a._format?(a=a.decodeBytes(a.bits.length,a.bits,0,a._format&7),Squeak.bytesAsString(a)):"Class"},renameFromImage:function(a,b){var c=b[this.sqClass],c=c.instProto||c.classInstProto(c.classNameFromImage(a));
if(!c)return this;c=new c;c.oop=this.oop;c.sqClass=this.sqClass;c._format=this._format;c.hash=this.hash;c.bits=this.bits;return c}},"accessing",{instSize:function(){return 2>this._format?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(a){var b=this._format;return 2>b?-1:3===b&&a.vm.isContext(this)&&!a.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:6>b?this.pointersSize()-this.instSize():12>b?this.wordsSize():16>b?this.shortsSize():24>b?this.bytesSize():4*this.pointersSize()+
this.bytesSize()},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(a+=this.bytes.length+3>>>2);var b=255<=a?2:0,a=a+(a&1)+2;4>a&&(a=4);return{header:b,body:a}},writeTo:function(a,b,c,e){var g=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(g+=this.bytes.length+3>>>2,this._format|=-this.bytes.length&3);var k=b,f=this._format<<24|this.sqClass.hash&4194303,d=g<<24|this.hash&4194303;
255<=g&&(a.setUint32(b,g,c),b+=4,d=-16777216|this.hash&4194303,a.setUint32(b,d,c),b+=4);a.setUint32(b,f,c);b+=4;a.setUint32(b,d,c);b+=4;if(this.isFloat)a.setFloat64(b,this["float"],c),b+=8;else if(this.words)for(f=0;f<this.words.length;f++)a.setUint32(b,this.words[f],c),b+=4;else if(this.pointers)for(f=0;f<this.pointers.length;f++)a.setUint32(b,e(this.pointers[f]),c),b+=4;if(this.bytes){for(f=0;f<this.bytes.length;f++)a.setUint8(b++,this.bytes[f]);b+=-this.bytes.length&3}b=0===g?b+8:b+4*(g&1);if(b!==
k+this.totalBytes())throw Error("written size does not match");return b}},"testing",{isBytes:function(){var a=this._format;return 16<=a&&23>=a},isPointers:function(){return 6>=this._format},isWords:function(){return 10===this._format},isWordsOrBytes:function(){var a=this._format;return 10===a||16<=a&&23>=a},isWeak:function(){return 4===this._format},isMethod:function(){return 24<=this._format},sameFormats:function(a,b){return 16>a?a===b:(a&248)===(b&248)},sameShapeAs:function(a){return this.sameFormatAs(a)&&
this.sqClass.classInstSize()===a.sqClass.classInstSize()},classSameShapeAs:function(a){return this.sameFormats(this.classInstFormat(),a._format)&&this.classInstSize()===a.sqClass.classInstSize()}},"as class",{defaultInst:function(){return Squeak.ObjectSpur},classInstFormat:function(){return this.pointers[Squeak.Class_format]>>16&31},classInstSize:function(){return this.pointers[Squeak.Class_format]&65535}},"as method",{methodNumLits:function(){return this.pointers[0]&32767},methodPrimitiveIndex:function(){return 0===
(this.pointers[0]&65536)?0:this.bytes[1]+256*this.bytes[2]}});Object.subclass("Squeak.Interpreter","initialization",{initialize:function(a,b){console.log("squeak: initializing interpreter "+Squeak.vmVersion);this.Squeak=Squeak;this.image=a;this.image.vm=this;this.primHandler=new Squeak.Primitives(this,b);this.loadImageState();this.hackImage();this.initVMState();this.loadInitialContext();this.initCompiler();console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers;
this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers;this.nilObj=this.specialObjects[Squeak.splOb_NilObject];this.falseObj=this.specialObjects[Squeak.splOb_FalseObject];this.trueObj=this.specialObjects[Squeak.splOb_TrueObject];this.hasClosures=this.image.hasClosures;this.globals=this.findGlobals();this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0);6501==this.image.version&&(this.primHandler.reverseDisplay=
!0)},initVMState:function(){this.interruptCheckCounter=this.sendCount=this.byteCodeCount=0;this.interruptCheckCounterFeedBackReset=1E3;this.interruptChecksEveryNms=3;this.lastTick=this.nextWakeupTick=this.nextPollTick=0;this.interruptKeycode=2094;this.interruptPending=!1;this.pendingFinalizationSignals=0;this.freeLargeContexts=this.freeContexts=this.nilObj;this.nAllocatedContexts=this.nRecycledContexts=this.reclaimableContextCount=0;this.methodCacheSize=1024;this.methodCacheMask=this.methodCacheSize-
1;this.methodCacheRandomish=0;this.methodCache=[];for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1;this.breakOutTick=0;this.breakOnMethod=null;this.breakOnContextChanged=this.breakOnNewMethod=!1;this.breakOnContextReturned=null;this.messages={};this.startupTime=Date.now()},loadInitialContext:function(){this.activeContext=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess].pointers[Squeak.Proc_suspendedContext];
this.fetchContextRegisters(this.activeContext);this.reclaimableContextCount=0},findGlobals:function(){var a=this.specialObjects[Squeak.splOb_SmalltalkDictionary],b=a.sqClass.className();"Association"===b&&(a=a.pointers[1],b=a.sqClass.className());if("SystemDictionary"===b)return a.pointers[1].pointers;if("SmalltalkImage"===b){a=a.pointers[0];b=a.sqClass.className();if("SystemDictionary"===b)return a.pointers[1].pointers;if("Environment"===b)return a.pointers[2].pointers[1].pointers}throw Error("cannot find global dict");
},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==(new Function("return 42"))())return console.warn("function constructor not working, disabling JIT")}catch(b){return console.warn("disabling JIT: "+b)}var a=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(10>a)return console.warn("Slow machine detected (loaded "+(1E3*a|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler"),
this.compiler=new Squeak.Compiler(this)}catch(b){console.warn("Compiler "+b)}},hackImage:function(){[].forEach(function(a){var b=this.findMethod(a.method);b&&(b.pointers[0]|=a.primitive,console.warn("Hacking "+a.method))},this)}},"interpreting",{interpretOne:function(a){if(this.method.compiled){if(a){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(a);this.breakNow()}this.byteCodeCount+=this.method.compiled(this)}else{a=this.Squeak;var b,c;this.byteCodeCount++;
b=this.nextByte();if(128>b)switch(b){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.push(this.receiver.pointers[b&15]);return;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.push(this.homeContext.pointers[a.Context_tempFrameStart+(b&15)]);return;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:this.push(this.method.methodGetLiteral(b&
31));return;case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:this.push(this.method.methodGetLiteral(b&31).pointers[a.Assn_value]);return;case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:this.receiver.pointers[b&7]=this.pop();return;case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:this.homeContext.pointers[a.Context_tempFrameStart+
(b&7)]=this.pop();return;case 112:this.push(this.receiver);return;case 113:this.push(this.trueObj);return;case 114:this.push(this.falseObj);return;case 115:this.push(this.nilObj);return;case 116:this.push(-1);return;case 117:this.push(0);return;case 118:this.push(1);return;case 119:this.push(2);return;case 120:this.doReturn(this.receiver);return;case 121:this.doReturn(this.trueObj);return;case 122:this.doReturn(this.falseObj);return;case 123:this.doReturn(this.nilObj);return;case 124:this.doReturn(this.pop());
return;case 125:this.doReturn(this.pop(),this.activeContext.pointers[a.BlockContext_caller]);return;case 126:this.nono();return;case 127:this.nono();return}else switch(b){case 128:this.extendedPush(this.nextByte());return;case 129:this.extendedStore(this.nextByte());return;case 130:this.extendedStorePop(this.nextByte());return;case 131:c=this.nextByte();this.send(this.method.methodGetSelector(c&31),c>>5,!1);return;case 132:this.doubleExtendedDoAnything(this.nextByte());return;case 133:c=this.nextByte();
this.send(this.method.methodGetSelector(c&31),c>>5,!0);return;case 134:c=this.nextByte();this.send(this.method.methodGetSelector(c&63),c>>6,!1);return;case 135:this.pop();return;case 136:this.push(this.top());return;case 137:this.push(this.exportThisContext());return;case 138:this.pushNewArray(this.nextByte());return;case 139:if(1!==this.pc)throw Error("call prim bytecode not expected here");this.pc=3;return;case 140:c=this.nextByte();this.push(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]);
return;case 141:c=this.nextByte();this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]=this.top();return;case 142:c=this.nextByte();this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[c]=this.pop();return;case 143:this.pushClosureCopy();return;case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:this.pc+=(b&7)+1;return;case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:this.jumpIfFalse((b&7)+1);return;case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:c=
this.nextByte();this.pc+=256*((b&7)-4)+c;4>(b&7)&&0>=this.interruptCheckCounter--&&this.checkForInterrupts();return;case 168:case 169:case 170:case 171:this.jumpIfTrue(256*(b&3)+this.nextByte());return;case 172:case 173:case 174:case 175:this.jumpIfFalse(256*(b&3)+this.nextByte());return;case 176:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 177:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)-
this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 178:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 179:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 180:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 181:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=
this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 182:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 183:this.success=!0;this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 184:this.success=!0;this.resultIsFloat=!1;this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(b&15);return;case 185:this.success=!0;
this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 186:this.success=!0;this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 187:this.success=!0;this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(b&15);return;case 188:this.success=!0;this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 189:this.success=
!0;this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(b&15);return;case 190:this.success=!0;this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(b&15);return;case 191:this.success=!0;this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(b&15);return;case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:this.primHandler.quickSendOther(this.receiver,
b&15)||this.sendSpecial((b&15)+16);return;case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:this.send(this.method.methodGetSelector(b&15),0,!1);return;case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:this.send(this.method.methodGetSelector(b&15),1,!1);return;case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:this.send(this.method.methodGetSelector(b&
15),2,!1);return}throw Error("not a bytecode: "+b);}},interpret:function(a,b){if(this.frozen)return"frozen";this.breakOutOfInterpreter=this.isIdle=!1;for(this.breakOutTick=this.primHandler.millisecondClockValue()+(a||500);!1===this.breakOutOfInterpreter;)this.method.compiled?this.byteCodeCount+=this.method.compiled(this):this.interpretOne();if("function"==typeof this.breakOutOfInterpreter)return this.breakOutOfInterpreter(b);var c="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?
Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0;b&&b(c);return c},goIdle:function(){var a=0!==this.nextWakeupTick;this.forceInterruptCheck();this.checkForInterrupts();this.isIdle=0!==this.nextWakeupTick||!a;this.breakOut()},freeze:function(a){var b;this.frozen=!0;this.breakOutOfInterpreter=function(a){if(!a)throw Error("need function to restart interpreter");b=a;return"frozen"}.bind(this);var c=function(){this.frozen=!1;if(!b)throw Error("no continue function");
b(0)}.bind(this);a&&window.setTimeout(function(){a(c)},0);return c},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.method.bytes[this.pc++]},nono:function(){throw Error("Oh No!");},forceInterruptCheck:function(){this.interruptCheckCounter=-1E3},checkForInterrupts:function(){var a=this.primHandler.millisecondClockValue();a<this.lastTick&&(this.nextPollTick=a+(this.nextPollTick-this.lastTick),this.breakOutTick=a+(this.breakOutTick-this.lastTick),
0!==this.nextWakeupTick&&(this.nextWakeupTick=a+(this.nextWakeupTick-this.lastTick)));-100<this.interruptCheckCounter&&(this.interruptCheckCounterFeedBackReset=a-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+10:1E3>=this.interruptCheckCounterFeedBackReset?1E3:this.interruptCheckCounterFeedBackReset-12);this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset;this.lastTick=a;if(this.interruptPending){this.interruptPending=!1;var b=this.specialObjects[Squeak.splOb_TheInterruptSemaphore];
b.isNil||this.primHandler.synchronousSignal(b)}0!==this.nextWakeupTick&&a>=this.nextWakeupTick&&(this.nextWakeupTick=0,b=this.specialObjects[Squeak.splOb_TheTimerSemaphore],b.isNil||this.primHandler.synchronousSignal(b));0<this.pendingFinalizationSignals&&(b=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore],this.pendingFinalizationSignals=0,b.isNil||this.primHandler.synchronousSignal(b));0<this.primHandler.semaphoresToSignal.length&&this.primHandler.signalExternalSemaphores();!this.method.compiled&&
this.compiler&&this.compiler.compile(this.method);a>=this.breakOutTick&&this.breakOut()},extendedPush:function(a){var b=a&63;switch(a>>6){case 0:this.push(this.receiver.pointers[b]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+b]);break;case 2:this.push(this.method.methodGetLiteral(b));break;case 3:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value])}},extendedStore:function(a){var b=a&63;switch(a>>6){case 0:this.receiver.pointers[b]=this.top();
break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.top();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(a){var b=a&63;switch(a>>6){case 0:this.receiver.pointers[b]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.pop();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(a){var b=
this.nextByte();switch(a>>5){case 0:this.send(this.method.methodGetSelector(b),a&31,!1);break;case 1:this.send(this.method.methodGetSelector(b),a&31,!0);break;case 2:this.push(this.receiver.pointers[b]);break;case 3:this.push(this.method.methodGetLiteral(b));break;case 4:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]);break;case 5:this.receiver.pointers[b]=this.top();break;case 6:this.receiver.pointers[b]=this.pop();break;case 7:this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]=
this.top()}},jumpIfTrue:function(a){var b=this.pop();b.isTrue?this.pc+=a:b.isFalse||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},jumpIfFalse:function(a){var b=this.pop();b.isFalse?this.pc+=a:b.isTrue||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},sendSpecial:function(a){this.send(this.specialSelectors[2*a],this.specialSelectors[2*a+1],!1)}},"closures",{pushNewArray:function(a){var b=127<a;a&=127;var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],
a);if(b){for(b=0;b<a;b++)c.pointers[b]=this.stackValue(a-b-1);this.popN(a)}this.push(c)},pushClosureCopy:function(){var a=this.nextByte(),b=a&15,a=a>>4,c=256*this.nextByte()+this.nextByte(),e=this.encodeSqueakPC(this.pc,this.method),b=this.newClosure(b,e,a);b.pointers[Squeak.Closure_outerContext]=this.activeContext;this.reclaimableContextCount=0;if(0<a){for(e=0;e<a;e++)b.pointers[Squeak.Closure_firstCopiedValue+e]=this.stackValue(a-e-1);this.popN(a)}this.pc+=c;this.push(b)},newClosure:function(a,
b,c){c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],c);c.pointers[Squeak.Closure_startpc]=b;c.pointers[Squeak.Closure_numArgs]=a;return c}},"sending",{send:function(a,b,c){var e=this.stackValue(b),g=this.getClass(e);c&&(g=this.method.methodClassForSuper(),g=g.pointers[Squeak.Class_superclass]);b=this.findSelectorInClass(a,b,g);b.primIndex&&(this.verifyAtSelector=a,this.verifyAtClass=g);this.executeNewMethod(e,b.method,b.argCount,b.primIndex,b.mClass,a)},sendAsPrimitiveFailure:function(a,
b,c){this.executeNewMethod(a,b,c,0)},findSelectorInClass:function(a,b,c){var e=this.findMethodCacheEntry(a,c);if(e.method)return e;for(var g=c,k;!g.isNil;){k=g.pointers[Squeak.Class_mdict];if(k.isNil)return e=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],c=this.createActualMessage(a,b,c),this.popNandPush(b,c),this.findSelectorInClass(e,1,g.superclass());k=this.lookupSelectorInDict(k,a);if(!k.isNil)return this.currentSelector=a,this.currentLookupClass=c,e.method=k,e.primIndex=k.isMethod()?
k.methodPrimitiveIndex():248,e.argCount=b,e.mClass=g,e;g=g.superclass()}g=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(a===g)throw Error("Recursive not understood error encountered");a=this.createActualMessage(a,b,c);this.popNandPush(b,a);return this.findSelectorInClass(g,1,c)},lookupSelectorInDict:function(a,b){for(var c=a.pointersSize(),e=(c-Squeak.MethodDict_selectorStart-1&b.hash)+Squeak.MethodDict_selectorStart,g=!1;;){var k=a.pointers[e];if(k===b)return a.pointers[Squeak.MethodDict_array].pointers[e-
Squeak.MethodDict_selectorStart];if(k.isNil)return this.nilObj;if(++e===c){if(g)return this.nilObj;e=Squeak.MethodDict_selectorStart;g=!0}}},executeNewMethod:function(a,b,c,e,g,k){this.sendCount++;b===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(b,g,k));this.logSends&&console.log(this.sendCount+" "+this.printMethod(b,g,k));this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow());if(!(0<e&&this.tryPrimitive(e,c,b))){e=this.allocateOrRecycleContext(b.methodNeedsLargeFrame());
var f=b.methodTempCount(),d=Squeak.Context_tempFrameStart+f-1;e.pointers[Squeak.Context_method]=b;e.pointers[Squeak.BlockContext_initialIP]=this.nilObj;e.pointers[Squeak.Context_sender]=this.activeContext;this.arrayCopy(this.activeContext.pointers,this.sp-c,e.pointers,Squeak.Context_tempFrameStart-1,c+1);this.arrayFill(e.pointers,Squeak.Context_tempFrameStart+c,Squeak.Context_tempFrameStart+f,this.nilObj);this.popN(c+1);this.reclaimableContextCount++;this.storeContextRegisters();this.homeContext=
this.activeContext=e;this.method=b;this.pc=0;this.sp=d;this.receiver=e.pointers[Squeak.Context_receiver];if(this.receiver!==a)throw Error("receivers don't match");!b.compiled&&this.compiler&&this.compiler.compile(b,g,k);0>=this.interruptCheckCounter--&&this.checkForInterrupts()}},doReturn:function(a,b){if(!b){var c=this.homeContext;if(this.hasClosures)for(var e;!(e=c.pointers[Squeak.Context_closure]).isNil;)c=e.pointers[Squeak.Closure_outerContext];b=c.pointers[Squeak.Context_sender]}if(b.isNil||
b.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(a);for(c=this.activeContext.pointers[Squeak.Context_sender];c!==b;){if(c.isNil)return this.cannotReturn(a);if(this.isUnwindMarked(c))return this.aboutToReturnThrough(a,c);c=c.pointers[Squeak.Context_sender]}for(c=this.activeContext;c!==b;)this.breakOnContextReturned===c&&(this.breakOnContextReturned=null,this.breakNow()),e=c.pointers[Squeak.Context_sender],c.pointers[Squeak.Context_sender]=this.nilObj,c.pointers[Squeak.Context_instructionPointer]=
this.nilObj,0<this.reclaimableContextCount&&(this.reclaimableContextCount--,this.recycleIfPossible(c)),c=e;this.activeContext=c;this.fetchContextRegisters(this.activeContext);this.push(a);this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(a,b){this.push(this.exportThisContext());this.push(a);this.push(b);this.send(this.specialObjects[Squeak.splOb_SelectorAboutToReturn],2)},cannotReturn:function(a){this.push(this.exportThisContext());this.push(a);
this.send(this.specialObjects[Squeak.splOb_SelectorCannotReturn],1)},tryPrimitive:function(a,b,c){if(255<a&&520>a){if(264<=a)return this.popNandPush(1,this.top().pointers[a-264]),!0;switch(a){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}this.popNandPush(1,a-261);return!0}return this.primHandler.doPrimitive(a,b,c)},createActualMessage:function(a,b,c){var e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],
0),g=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],b);this.arrayCopy(this.activeContext.pointers,this.sp-b+1,g.pointers,0,b);e.pointers[Squeak.Message_selector]=a;e.pointers[Squeak.Message_arguments]=g;e.pointers.length>Squeak.Message_lookupClass&&(e.pointers[Squeak.Message_lookupClass]=c);return e},primitivePerform:function(a){var b=this.stackValue(a-1),c=this.stackValue(a);--a;var e=this.sp-a,g=this.activeContext.pointers;this.arrayCopy(g,e+1,g,e,a);this.sp--;a=this.findSelectorInClass(b,
a,this.getClass(c));this.executeNewMethod(c,a.method,a.argCount,a.primIndex,a.mClass,b);return!0},primitivePerformWithArgs:function(a,b){var c=this.stackValue(a),e=this.stackValue(a-1),g=this.stackValue(a-2);if(g.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var k=b?this.stackValue(a-3):this.getClass(c);if(b)for(var f=this.getClass(c);f!==k;)if(f=f.pointers[Squeak.Class_superclass],f.isNil)return!1;f=g.pointersSize();this.arrayCopy(g.pointers,0,this.activeContext.pointers,this.sp-
1,f);this.sp+=f-a;g=this.findSelectorInClass(e,f,k);this.executeNewMethod(c,g.method,g.argCount,g.primIndex,g.mClass,e);return!0},primitiveInvokeObjectAsMethod:function(a,b){for(var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],a),e=0;e<a;e++)c.pointers[a-e-1]=this.pop();var e=this.pop(),g=this.currentSelector,k=this.specialObjects[Squeak.splOb_SelectorRunWithIn];this.push(b);this.push(g);this.push(c);this.push(e);this.send(k,3,!1);return!0},findMethodCacheEntry:function(a,
b){var c;this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var e=(a.hash^b.hash)&this.methodCacheMask,g=e,k=0;4>k;k++){c=this.methodCache[g];if(c.selector===a&&c.lkupClass===b)return c;k===this.methodCacheRandomish&&(e=g);g=g+a.hash&this.methodCacheMask}c=this.methodCache[e];c.lkupClass=b;c.selector=a;c.method=null;return c},flushMethodCache:function(){for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a].selector=null,this.methodCache[a].method=null;return!0},flushMethodCacheForSelector:function(a){for(var b=
0;b<this.methodCacheSize;b++)this.methodCache[b].selector===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheForMethod:function(a){for(var b=0;b<this.methodCacheSize;b++)this.methodCache[b].method===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheAfterBecome:function(a){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(a){return this.isMethodContext(a)?198==a.pointers[Squeak.Context_method].methodPrimitiveIndex():
!1},newActiveContext:function(a){this.storeContextRegisters();this.activeContext=a;this.fetchContextRegisters(a)},exportThisContext:function(){this.storeContextRegisters();this.reclaimableContextCount=0;return this.activeContext},fetchContextRegisters:function(a){var b=a.pointers[Squeak.Context_method];this.isSmallInt(b)?(this.homeContext=a.pointers[Squeak.BlockContext_home],b=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=a;this.receiver=this.homeContext.pointers[Squeak.Context_receiver];
this.method=b;this.pc=this.decodeSqueakPC(a.pointers[Squeak.Context_instructionPointer],b);this.sp=this.decodeSqueakSP(a.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method);this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(a,b){return a+4*b.pointers.length+1},decodeSqueakPC:function(a,b){return a-4*b.pointers.length-
1},encodeSqueakSP:function(a){return a-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(a){return a+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(a){this.isMethodContext(a)&&(a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize?(a.pointers[0]=this.freeContexts,this.freeContexts=a):a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize&&(a.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=a))},allocateOrRecycleContext:function(a){if(a){if(!this.freeLargeContexts.isNil)return a=
this.freeLargeContexts,this.freeLargeContexts=a.pointers[0],this.nRecycledContexts++,a;this.nAllocatedContexts++;return this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)}if(!this.freeContexts.isNil)return a=this.freeContexts,this.freeContexts=a.pointers[0],this.nRecycledContexts++,a;this.nAllocatedContexts++;return this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},
popN:function(a){this.sp-=a},push:function(a){this.activeContext.pointers[++this.sp]=a},popNandPush:function(a,b){this.activeContext.pointers[this.sp-=a-1]=b},top:function(){return this.activeContext.pointers[this.sp]},stackValue:function(a){return this.activeContext.pointers[this.sp-a]},stackInteger:function(a){return this.checkSmallInt(this.stackValue(a))},stackIntOrFloat:function(a){a=this.stackValue(a);if("number"===typeof a)return a;if(a.isFloat)return this.resultIsFloat=!0,a["float"];var b=
a.bytes;if(b&&4==b.length){for(var c=0,e=3;0<=e;e--)c=256*c+b[e];if(a.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return c;if(a.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-c}this.success=!1;return 0},pop2AndPushIntResult:function(a){return this.success&&this.canBeSmallInt(a)?(this.popNandPush(2,a),!0):!1},pop2AndPushNumResult:function(a){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,this.primHandler.makeFloat(a)),!0;if(a>=
Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return this.popNandPush(2,a),!0;if(-4294967295<=a&&4294967295>=a){var b=0>a;a=b?-a:a;var b=this.instantiateClass(this.specialObjects[b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger],4),c=b.bytes;c[0]=a&255;c[1]=a>>8&255;c[2]=a>>16&255;c[3]=a>>24&255;this.popNandPush(2,b);return!0}}return!1},pop2AndPushBoolResult:function(a){if(!this.success)return!1;this.popNandPush(2,a?this.trueObj:this.falseObj);return!0}},"numbers",{getClass:function(a){return this.isSmallInt(a)?
this.specialObjects[Squeak.splOb_ClassInteger]:a.sqClass},canBeSmallInt:function(a){return a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt},isSmallInt:function(a){return"number"===typeof a},checkSmallInt:function(a){if("number"===typeof a)return a;this.success=!1;return 1},quickDivide:function(a,b){if(0===b)return Squeak.NonSmallInt;var c=a/b|0;return c*b===a?c:Squeak.NonSmallInt},div:function(a,b){return 0===b?Squeak.NonSmallInt:Math.floor(a/b)},mod:function(a,b){return 0===b?Squeak.NonSmallInt:a-Math.floor(a/
b)*b},safeShift:function(a,b){if(0>b)return-31>b?0>a?-1:0:a>>-b;if(31<b)return 0==a?0:Squeak.NonSmallInt;var c=a<<b;return c>>b===a?c:Squeak.NonSmallInt}},"utils",{isContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]||a.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]?!0:!1},isMethodContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},instantiateClass:function(a,b){return this.image.instantiateClass(a,b,
this.nilObj)},arrayFill:function(a,b,c,e){for(;b<c;b++)a[b]=e},arrayCopy:function(a,b,c,e,g){if(a===c&&b<e)for(var k=g-1;0<=k;k--)c[e+k]=a[b+k];else for(k=0;k<g;k++)c[e+k]=a[b+k]}},"debugging",{addMessage:function(a){return this.messages[a]?++this.messages[a]:this.messages[a]=1},warnOnce:function(a){1==this.addMessage(a)&&console.warn(a)},printMethod:function(a,b,c){if(c)return b.className()+">>"+c.bytesAsString();a||(a=this.activeContext.contextMethod());var e;this.allMethodsDo(function(b,c,f){if(c===
a)return e=b.className()+">>"+f.bytesAsString()});return e?e:b?"("+b.pointers[Squeak.Context_receiver]+")>>?":"?>>?"},allInstancesOf:function(a,b){"string"===typeof a&&(a=this.globalNamed(a));for(var c=[],e=this.image.someInstanceOf(a);e;)b?b(e):c.push(e),e=this.image.nextInstanceAfter(e);return c},globalNamed:function(a){return this.allGlobalsDo(function(b,c){if(b.bytesAsString()===a)return c})},allGlobalsDo:function(a){for(var b=this.globals,c=0;c<b.length;c++){var e=b[c];if(!e.isNil&&(e=a(e.pointers[0],
e.pointers[1])))return e}},allMethodsDo:function(a){this.allGlobalsDo(function(b,c){if(c.pointers&&9<=c.pointers.length)for(var e=[c,c.sqClass],g=0;g<e.length;g++){var k=e[g],f=k.pointers[1];if(f.pointers&&f.pointers[1]){var d=f.pointers[1].pointers;if(d)for(var f=f.pointers,p=0;p<d.length;p++)if(a.call(this,k,d[p],f[2+p]))return!0}}})},printStack:function(a,b){"number"==typeof a&&(b=a,a=null);a||(a=this.activeContext);b||(b=100);for(var c=[],e=Math.max(b,1E6);!a.isNil&&0<e--;)c.push(a),a=a.pointers[Squeak.Context_sender];
c.length>b+200&&(a.isNil||c.push("..."),c=c.slice(0,b).concat(["..."]).concat(c.slice(-200)));for(var e=[],g=c.length;0<g--;)if(a=c[g],a.pointers){var k="",f=a.pointers[Squeak.Context_method];"number"===typeof f?(f=a.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],k="[] in "):a.pointers[Squeak.Context_closure].isNil||(k="[] in ");e.push(k+this.printMethod(f,a)+"\n")}else e.push("...\n");return e.join("")},findMethod:function(a){var b,c=a.split(">>")[0],e=a.split(">>")[1];this.allMethodsDo(function(a,
k,f){if(e.length==f.bytesSize()&&e==f.bytesAsString()&&c==a.className())return b=k});return b},breakNow:function(a){a&&console.log("Break: "+a);this.breakOutOfInterpreter="break"},breakOn:function(a){return this.breakOnMethod=a&&this.findMethod(a)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1;this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=!0;this.breakOnContextReturned=null},printActiveContext:function(a){function b(b){b=
b.sqInstName?b.sqInstName():b.toString();b=JSON.stringify(b).slice(1,-1);b.length>a-3&&(b=b.slice(0,a-3)+"...");return b}a||(a=72);for(var c=this.activeContext,e="number"===typeof c.pointers[Squeak.BlockContext_argumentCount],g=c.pointers[Squeak.Context_closure],k=e?c.pointers[Squeak.BlockContext_home]:c,g=e||g.isNil?k.pointers[Squeak.Context_method].methodTempCount():g.pointers[Squeak.Closure_numArgs],f=this.decodeSqueakSP(0),d=k.contextSizeWithStack(this)-1,p=f+1,n=p+g-1,g="",x=f;x<=d;x++){var q=
b(k.pointers[x]),m="";x==f?m="=rcvr":x<=n&&(m="=tmp"+(x-p));g+="\nctx["+x+"]"+m+": "+q}if(e)for(g+="\n",k=c.pointers[3],e=this.decodeSqueakSP(1),k=e+k,x=e;x<=this.sp;x++)q=b(c.pointers[x]),m="",x<=k&&(m="=arg"+(x-e)),g+="\nblk["+x+"]"+m+": "+q;return g},printAllProcesses:function(){for(var a=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value],b="Active: "+this.printProcess(a.pointers[Squeak.ProcSched_activeProcess],!0),c=a.pointers[Squeak.ProcSched_processLists].pointers,
e=c.length-1;0<=e;e--)for(a=c[e].pointers[Squeak.LinkedList_firstLink];!a.isNil;)b+="\nRunnable: "+this.printProcess(a),a=a.pointers[Squeak.Link_nextLink];for(c=this.image.someInstanceOf(this.specialObjects[Squeak.splOb_ClassSemaphore]);c;){for(a=c.pointers[Squeak.LinkedList_firstLink];!a.isNil;)b+="\nWaiting: "+this.printProcess(a),a=a.pointers[Squeak.Link_nextLink];c=this.image.nextInstanceAfter(c)}return b},printProcess:function(a,b){var c=a.pointers[Squeak.Proc_suspendedContext],e=a.pointers[Squeak.Proc_priority],
c=this.printStack(b?null:c);return a.toString()+" at priority "+e+"\n"+c},printByteCodes:function(a,b,c,e){a||(a=this.method);return(new Squeak.InstructionPrinter(a,this)).printInstructions(b,c,e)},willSendOrReturn:function(){var a=this.method.bytes[this.pc];if(120<=a&&125>=a)return!0;if(131>a||200==a)return!1;if(176<=a)return!0;if(134>=a){if(132===a){if(1<this.method.bytes[this.pc+1]>>5)return!1;a=this.method.bytes[this.pc+2]}else a=this.method.bytes[this.pc+1]&(134===a?63:31);if("blockCopy:"!==
this.method.methodGetLiteral(a).bytesAsString())return!0}return!1},nextSendSelector:function(){var a=this.method.bytes[this.pc];if(131>a||200==a)return null;var b;if(208<=a)b=this.method.methodGetLiteral(a&15);else if(176<=a)b=this.specialSelectors[2*(a-176)];else if(134>=a){if(132===a){if(1<this.method.bytes[this.pc+1]>>5)return null;a=this.method.bytes[this.pc+2]}else a=this.method.bytes[this.pc+1]&(134===a?63:31);b=this.method.methodGetLiteral(a)}if(b&&(a=b.bytesAsString(),"blockCopy:"!==a))return a}});
Object.subclass("Squeak.Primitives","initialization",{initialize:function(a,b){this.vm=a;this.display=b;this.display.vm=this.vm;this.allowAccessBeyondSP=this.oldPrims=!this.vm.image.hasClosures;this.deferDisplayUpdates=!1;this.semaphoresToSignal=[];this.initDisplay();this.initAtCache();this.initModules();a.image.isSpur&&(this.charFromInt=this.charFromIntSpur,this.charToInt=this.charToIntSpur,this.identityHash=this.identityHashSpur)},initModules:function(){this.loadedModules={};this.builtinModules=
{JavaScriptPlugin:this.findPluginFunctions("js_","",!0),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0)}};this.patchModules={ScratchPlugin:this.findPluginFunctions("scratch_")};this.interpreterProxy=
new Squeak.InterpreterProxy(this.vm)},findPluginFunctions:function(a,b,c){var e={};b=new RegExp("^"+a+(b||"(initialise|shutdown|prim)"),"i");for(var g in this)if(b.test(g)&&"function"==typeof this[g]){var k=g;a&&(k=g[a.length].toLowerCase()+g.slice(a.length+1));e[k]=c?g:this[g].bind(this)}return e},initDisplay:function(){this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,
4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,
4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,
4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,
4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,
4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,
4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}},"dispatch",{quickSendOther:function(a,b){this.success=!0;switch(b){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));
case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(a,b,c){this.success=!0;if(128>a)switch(a){case 1:return this.popNandPushIntIfOK(2,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(2,this.stackInteger(1)-this.stackInteger(0));case 3:return this.pop2andPushBoolIfOK(this.stackInteger(1)<this.stackInteger(0));case 4:return this.pop2andPushBoolIfOK(this.stackInteger(1)>
this.stackInteger(0));case 5:return this.pop2andPushBoolIfOK(this.stackInteger(1)<=this.stackInteger(0));case 6:return this.pop2andPushBoolIfOK(this.stackInteger(1)>=this.stackInteger(0));case 7:return this.pop2andPushBoolIfOK(this.stackInteger(1)===this.stackInteger(0));case 8:return this.pop2andPushBoolIfOK(this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(2,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(2,this.vm.quickDivide(this.stackInteger(1),
this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(2,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(2,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(2,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(2,this.doBitAnd());case 15:return this.popNandPushIfOK(2,this.doBitOr());case 16:return this.popNandPushIfOK(2,this.doBitXor());case 17:return this.popNandPushIfOK(2,
this.doBitShift());case 18:return this.primitiveMakePoint(b,!1);case 19:return!1;case 20:return!1;case 21:return!1;case 22:return!1;case 23:return this.primitiveLessThanLargeIntegers();case 24:return this.primitiveGreaterThanLargeIntegers();case 25:return this.primitiveLessOrEqualLargeIntegers();case 26:return this.primitiveGreaterOrEqualLargeIntegers();case 27:return this.primitiveEqualLargeIntegers();case 28:return this.primitiveNotEqualLargeIntegers();case 29:return!1;case 30:return!1;case 31:return!1;
case 32:return!1;case 33:return!1;case 34:return!1;case 35:return!1;case 36:return!1;case 37:return!1;case 38:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(b+1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)-this.stackFloat(0));case 43:return this.pop2andPushBoolIfOK(this.stackFloat(1)<
this.stackFloat(0));case 44:return this.pop2andPushBoolIfOK(this.stackFloat(1)>this.stackFloat(0));case 45:return this.pop2andPushBoolIfOK(this.stackFloat(1)<=this.stackFloat(0));case 46:return this.pop2andPushBoolIfOK(this.stackFloat(1)>=this.stackFloat(0));case 47:return this.pop2andPushBoolIfOK(this.stackFloat(1)===this.stackFloat(0));case 48:return this.pop2andPushBoolIfOK(this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(b+1,this.stackFloat(1)*this.stackFloat(0));
case 50:return this.popNandPushFloatIfOK(b+1,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(b+1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return!1;case 53:return this.popNandPushIntIfOK(b+1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(2,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(b+1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(b+1,Math.sin(this.stackFloat(0)));
case 57:return this.popNandPushFloatIfOK(b+1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(b+1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(b+1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(b+1,this.objectSize(!1));case 63:return this.popNandPushIfOK(b+1,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(b+
1,this.objectAtPut(!1,!0,!1));case 65:return!1;case 66:return!1;case 67:return!1;case 68:return this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(b+1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(b+1,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(b,!1);case 73:return this.popNandPushIfOK(b+
1,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(b+1,this.identityHash(this.stackNonInteger(0)));case 76:return this.primitiveStoreStackp(b);case 77:return this.popNandPushIfOK(b+1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(b+1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(b);case 80:return this.popNandPushIfOK(2,this.doBlockCopy());case 81:return this.primitiveBlockValue(b);
case 82:return this.primitiveBlockValueWithArgs(b);case 83:return this.vm.primitivePerform(b);case 84:return this.vm.primitivePerformWithArgs(b,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(b);case 91:return this.primitiveTestDisplayDepth(b);case 93:return this.primitiveInputSemaphore(b);case 94:return this.primitiveGetNextEvent(b);
case 95:return this.primitiveInputWord(b);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",b);case 97:return this.primitiveSnapshot(b);case 99:return this.primitiveLoadImageSegment(b);case 100:return this.vm.primitivePerformWithArgs(b,!0);case 101:return this.primitiveBeCursor(b);case 102:return this.primitiveBeDisplay(b);case 103:return!1;case 104:return!1;case 105:return this.popNandPushIfOK(b+1,this.doStringReplace());case 106:return this.primitiveScreenSize(b);case 107:return this.primitiveMouseButtons(b);
case 108:return this.primitiveKeyboardNext(b);case 109:return this.primitiveKeyboardPeek(b);case 110:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(b+1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(b+1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(b);case 114:return this.primitiveExitToDebugger(b);case 115:return this.primitiveChangeClass(b);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());
case 117:return this.doNamedPrimitive(b,c);case 118:return this.primitiveDoPrimitiveWithArgs(b);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return!1;case 121:return this.primitiveImageName(b);case 122:return this.primitiveReverseDisplay(b);case 124:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(2,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(b);case 127:return this.primitiveShowDisplayRect(b)}else if(256>
a)switch(a){case 128:return this.primitiveArrayBecome(b,!0);case 129:return this.popNandPushIfOK(1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(b);case 131:return this.popNandPushIfOK(1,this.vm.image.partialGC());case 132:return this.pop2andPushBoolIfOK(this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return!0;case 134:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(1,this.millisecondClockValue());
case 136:return this.primitiveSignalAtMilliseconds(b);case 137:return this.popNandPushIfOK(1,this.secondClock());case 138:return this.popNandPushIfOK(b+1,this.someObject());case 139:return this.popNandPushIfOK(b+1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(b);case 141:return this.primitiveClipboardText(b);case 142:return this.popNandPushIfOK(b+1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(b);case 145:return this.primitiveConstantFill(b);
case 146:return this.namedPrimitive("JoystickTabletPlugin","primitiveReadJoystick",b);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",b);case 148:return this.popNandPushIfOK(b+1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(b);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(b);case 151:if(this.oldPrims)return this.primitiveFileClose(b);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(b);case 153:if(this.oldPrims)return this.primitiveFileOpen(b);
case 154:if(this.oldPrims)return this.primitiveFileRead(b);case 155:if(this.oldPrims)return this.primitiveFileSetPosition(b);case 156:if(this.oldPrims)return this.primitiveFileDelete(b);case 157:if(this.oldPrims)return this.primitiveFileSize(b);case 158:if(this.oldPrims)return this.primitiveFileWrite(b);case 159:if(this.oldPrims)return this.primitiveFileRename(b);break;case 160:return this.oldPrims?this.primitiveDirectoryCreate(b):this.primitiveAdoptInstance(b);case 161:if(this.oldPrims)return this.primitiveDirectoryDelimitor(b);
break;case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(b);break;case 163:if(this.oldPrims)return this.primitiveDirectoryDelete(b);break;case 165:case 166:return this.primitiveIntegerAtAndPut(b);case 167:return!1;case 168:return this.primitiveCopyObject(b);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(b):this.pop2andPushBoolIfOK(this.vm.stackValue(1)!==this.vm.stackValue(0));case 170:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStart",
b):this.primitiveAsCharacter(b);case 171:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStartWithSemaphore",b):this.popNandPushIfOK(b+1,this.stackNonInteger(0).hash);case 172:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStop",b);break;case 173:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",b):this.popNandPushIfOK(b+1,this.objectAt(!1,!1,!0));case 174:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",
b):this.popNandPushIfOK(b+1,this.objectAtPut(!1,!1,!0));case 175:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",b):this.popNandPushIfOK(b+1,this.behaviorHash(this.stackNonInteger(0)));case 176:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",b);break;case 177:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",b):this.popNandPushIfOK(1,
this.allInstancesOf(this.stackNonInteger(0)));case 178:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primPluckedSoundmixSampleCountintostartingAtpan",b);break;case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",b);break;case 180:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",b);break;case 181:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin",
"primitiveMixPluckedSound",b);break;case 182:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",b);break;case 183:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",b);break;case 184:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",b);break;case 185:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",
b):this.primitiveExitCriticalSection(b);case 186:if(this.oldPrims)break;else return this.primitiveEnterCriticalSection(b);case 187:if(this.oldPrims)break;else return this.primitiveTestAndSetOwnershipOfCriticalSection(b);case 188:if(this.oldPrims)break;else return this.primitiveExecuteMethodArgsArray(b);case 189:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",b):this.primitiveExecuteMethod(b);case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",
b);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",b);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",b);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",b);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",b);break;case 195:return!1;case 196:return!1;case 197:return!1;case 198:return!1;case 199:return!1;
case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",b):this.primitiveClosureCopyWithCopiedValues(b);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",b):this.primitiveClosureValue(b);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",b):this.primitiveClosureValue(b);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",
b):this.primitiveClosureValue(b);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAddressLookupResult",b):this.primitiveClosureValue(b);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",b):this.primitiveClosureValue(b);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",b):this.primitiveClosureValueWithArgs(b);case 207:if(this.oldPrims)return this.namedPrimitive("SocketPlugin",
"primitiveResolverStatus",b);case 208:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverError",b);case 209:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCreate",b);break;case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",b):this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",b):this.popNandPushIfOK(3,this.objectAtPut(!1,
!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",b):this.popNandPushIfOK(1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",b);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",b);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",b);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin",
"primitiveSocketRemotePort",b);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketConnectToPort",b);case 218:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketListenOnPort",b);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",b);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",b);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin",
"primitiveSocketReceiveDataBufCount",b):this.primitiveClosureValueNoContextSwitch(b);case 222:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",b):this.primitiveClosureValueNoContextSwitch(b);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",b);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",b);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(b);
case 231:return this.primitiveForceDisplayUpdate(b);case 233:return this.primitiveSetFullScreen(b);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveDecompressFromByteArray",b);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",b);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",b);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",
b);case 238:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",b);case 239:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortClose",b);break;case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",b):this.popNandPushIfOK(1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",b):this.popNandPushIfOK(1,this.microsecondClockLocal());case 242:if(this.oldPrims)break;
else return this.primitiveSignalAtUTCMicroseconds(b);case 243:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",b);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",b);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",b);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",b);break;case 248:return this.vm.primitiveInvokeObjectAsMethod(b,
c);case 249:return this.primitiveArrayBecome(b,!1);case 254:return this.primitiveVMParameter(b)}else switch(a){case 521:return this.namedPrimitive("MIDIPlugin","primitiveMIDIClosePort",b);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",b);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",b);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",b);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",
b);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",b);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",b);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",b);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",b);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",b);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",b);case 552:return this.namedPrimitive("ADPCMCodecPlugin",
"primitiveEncodeMono",b);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",b);case 571:return this.primitiveUnloadModule(b);case 572:return this.primitiveListBuiltinModule(b);case 573:return this.primitiveListLoadedModule(b)}console.error("primitive "+a+" not implemented yet");return!1},namedPrimitive:function(a,b,c){var e=""===a?this:this.loadedModules[a];void 0===e&&(e=this.loadModule(a),this.loadedModules[a]=e);var g=!1;if(e){this.interpreterProxy.argCount=c;var k=
e[b];"function"===typeof k?g=e[b](c):"string"===typeof k?g=this[k](c):this.vm.warnOnce("missing primitive: "+a+"."+b)}else this.vm.warnOnce("missing module: "+a+" ("+b+")");return!0===g||!1===g?g:this.success},doNamedPrimitive:function(a,b){if(2>b.pointersSize())return!1;var c=b.pointers[1];if(4!==c.pointersSize())return!1;this.primMethod=b;var e=c.pointers[0].bytesAsString(),c=c.pointers[1].bytesAsString();return this.namedPrimitive(e,c,a)},fakePrimitive:function(a,b,c){this.vm.warnOnce("faking primitive: "+
a);void 0===b?this.vm.popN(c):this.vm.popNandPush(c+1,this.makeStObject(b));return!0}},"modules",{loadModule:function(a){var b=Squeak.externalModules[a]||this.builtinModules[a];if(!b)return null;this.patchModules[a]&&this.patchModule(b,a);if(b.setInterpreter&&!b.setInterpreter(this.interpreterProxy))return console.log("Wrong interpreter proxy version: "+a),null;var c=b.initialiseModule;if("function"===typeof c)b.initialiseModule();else if("string"===typeof c)this[c]();if(this.interpreterProxy.failed())return console.log("Module initialization failed: "+
a),null;console.log("Loaded module: "+a);return b},patchModule:function(a,b){var c=this.patchModules[b],e;for(e in c)a[e]=c[e]},unloadModule:function(a){var b=this.loadedModules[a];if(!a||!b||b===this)return null;delete this.loadedModules[a];var c=b.unloadModule;if("function"===typeof c)b.unloadModule(this);else if("string"===typeof c)this[c](this);console.log("Unloaded module: "+a);return b},loadFunctionFrom:function(a,b){var c=""===b?this:this.loadedModules[b];void 0===c&&(c=this.loadModule(b),
this.loadedModules[b]=c);if(!c)return null;var e=c[a];if("function"===typeof e)return e.bind(c);if("string"===typeof e)return this[e].bind(this);this.vm.warnOnce("missing primitive: "+b+"."+a);return null},primitiveUnloadModule:function(a){var b=this.stackNonInteger(0).bytesAsString();if(!b)return!1;this.unloadModule(b);return this.popNIfOK(a)},primitiveListBuiltinModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;var c=Object.keys(this.builtinModules);return this.popNandPushIfOK(a+
1,this.makeStObject(c[b]))},primitiveListLoadedModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;var c=[],e;for(e in this.loadedModules){var g=this.loadedModules[e];g&&(g=g.getModuleName?g.getModuleName():e,c.push(g))}return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))}},"stack access",{popNIfOK:function(a){if(!this.success)return!1;this.vm.popN(a);return!0},pop2andPushBoolIfOK:function(a){this.vm.success=this.success;return this.vm.pop2AndPushBoolResult(a)},popNandPushIfOK:function(a,
b){if(!this.success||null==b)return!1;this.vm.popNandPush(a,b);return!0},popNandPushIntIfOK:function(a,b){return this.success&&this.vm.canBeSmallInt(b)?this.popNandPushIfOK(a,b):!1},popNandPushFloatIfOK:function(a,b){return this.success?this.popNandPushIfOK(a,this.makeFloat(b)):!1},stackNonInteger:function(a){return this.checkNonInteger(this.vm.stackValue(a))},stackInteger:function(a){return this.checkSmallInt(this.vm.stackValue(a))},stackPos32BitInt:function(a){return this.positive32BitValueOf(this.vm.stackValue(a))},
pos32BitIntFor:function(a){if(0<=a&&a<=Squeak.MaxSmallInt)return a;for(var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],4),c=b.bytes,e=0;4>e;e++)c[e]=a>>>8*e&255;return b},pos53BitIntFor:function(a){if(4294967295>=a)return this.pos32BitIntFor(a);if(9007199254740991<a)return console.warn("Out of range: pos53BitIntFor("+a+")"),this.success=!1,0;for(var b=0xffffffffff>=a?5:0xffffffffffff>=a?6:7,c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],
b),e=c.bytes,g=0;g<b;g++)e[g]=a&255,a/=256;return c},stackSigned32BitInt:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;if(4!==a.bytesSize())return this.success=!1,0;for(var b=a.bytes,c=0,e=0,g=1;4>e;e++,g*=256)c+=b[e]*g;if(this.isA(a,Squeak.splOb_ClassLargePositiveInteger)&&2147483647>=c)return c;if(this.isA(a,Squeak.splOb_ClassLargeNegativeInteger)&&-2147483648<=-c)return-c;this.success=!1;return 0},signed32BitIntegerFor:function(a){if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return a;
var b=0>a;a=b?-a:a;for(var b=this.vm.instantiateClass(this.vm.specialObjects[b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger],4),c=b.bytes,e=0;4>e;e++)c[e]=a>>>8*e&255;return b},stackFloat:function(a){return this.checkFloat(this.vm.stackValue(a))},stackBoolean:function(a){return this.checkBoolean(this.vm.stackValue(a))},stackSigned53BitInt:function(a){a=this.vm.stackValue(a);if("number"===typeof a)return a;var b=a.bytesSize();if(7>=b){for(var c=a.bytes,e=0,g=0,k=1;g<
b;g++,k*=256)e+=c[g]*k;if(9007199254740991>=e){if(this.isA(a,Squeak.splOb_ClassLargePositiveInteger))return e;if(this.isA(a,Squeak.splOb_ClassLargeNegativeInteger))return-e}}this.success=!1;return 0}},"numbers",{doBitAnd:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a&b):0},doBitOr:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a|b):0},doBitXor:function(){var a=this.stackPos32BitInt(1),
b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a^b):0},doBitShift:function(){var a=this.stackPos32BitInt(1),b=this.stackInteger(0);if(!this.success)return 0;if(0<this.vm.safeShift(a,b))return this.pos32BitIntFor(this.vm.safeShift(a,b));this.success=!1;return 0},safeFDiv:function(a,b){return 0===b?(this.success=!1,1):a/b},floatAsSmallInt:function(a){return this.ensureSmallInt(0<=a?Math.floor(a):Math.ceil(a))},frexp_exponent:function(a){if(0==a)return 0;var b=new DataView(new ArrayBuffer(8));
b.setFloat64(0,a);var c=b.getUint32(0)>>>20&2047;0===c&&(b.setFloat64(0,a*Math.pow(2,64)),c=(b.getUint32(0)>>>20&2047)-64);return c-1022},ldexp:function(a,b){return 1023<b?a*Math.pow(2,1023)*Math.pow(2,b-1023):-1074>b?a*Math.pow(2,-1074)*Math.pow(2,b+1074):a*Math.pow(2,b)},primitiveLessThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>
this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},primitiveGreaterOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>=this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)!==
this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(a){return a.isFloat?a["float"]:"number"===typeof a?a:0},positive32BitValueOf:function(a){if("number"===typeof a){if(0<=a)return a;this.success=!1;return 0}if(!this.isA(a,Squeak.splOb_ClassLargePositiveInteger)||4!==a.bytesSize())return this.success=!1,0;a=a.bytes;for(var b=0,c=0,e=1;4>c;c++,e*=256)b+=a[c]*e;return b},checkFloat:function(a){if(a.isFloat)return a["float"];if("number"===typeof a)return a;this.success=!1;return 0},checkSmallInt:function(a){if("number"===
typeof a)return a;this.success=!1;return 0},checkNonInteger:function(a){if("number"!==typeof a)return a;this.success=!1;return this.vm.nilObj},checkBoolean:function(a){return a.isTrue?!0:a.isFalse?!1:this.success=!1},indexableSize:function(a){return"number"===typeof a?-1:a.indexableSize(this)},isA:function(a,b){return a.sqClass===this.vm.specialObjects[b]},isKindOf:function(a,b){for(var c=a.sqClass,e=this.vm.specialObjects[b];!c.isNil;){if(c===e)return!0;c=c.pointers[Squeak.Class_superclass]}return!1},
isAssociation:function(a){return"number"!==typeof a&&2==a.pointersSize()},ensureSmallInt:function(a){if(a===(a|0)&&this.vm.canBeSmallInt(a))return a;this.success=!1;return 0},charFromInt:function(a){var b=this.vm.specialObjects[Squeak.splOb_CharacterTable].pointers[a];if(b)return b;b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassCharacter],0);b.pointers[0]=a;return b},charFromIntSpur:function(a){return this.vm.image.getCharacter(a)},charToInt:function(a){return a.pointers[0]},
charToIntSpur:function(a){return a.hash},makeFloat:function(a){var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassFloat],2);b["float"]=a;return b},makeLargeIfNeeded:function(a){return this.vm.canBeSmallInt(a)?a:this.makeLargeInt(a)},makeLargeInt:function(a){if(0>a)throw Error("negative large ints not implemented yet");if(4294967295<a)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(a)},makePointWithXandY:function(a,b){var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassPoint],
0);c.pointers[Squeak.Point_x]=a;c.pointers[Squeak.Point_y]=b;return c},makeStArray:function(a,b){for(var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length),e=0;e<a.length;e++)c.pointers[e]=this.makeStObject(a[e],b);return c},makeStString:function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c)&255);a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],b.length);a.bytes=b;return a},makeStObject:function(a,b){if(void 0===a||null===a)return this.vm.nilObj;
if(!0===a)return this.vm.trueObj;if(!1===a)return this.vm.falseObj;if(a.sqClass)return a;if("number"===typeof a)return a===(a|0)?this.makeLargeIfNeeded(a):this.makeFloat(a);if(b){var c=this.vm.instantiateClass(b,0);c.jsObject=a;return c}if("string"===typeof a||"Uint8Array"===a.constructor.name)return this.makeStString(a);if("Array"===a.constructor.name)return this.makeStArray(a);throw Error("cannot make smalltalk object");},pointsTo:function(a,b){return a.pointers?0<=a.pointers.indexOf(b):!1},asUint8Array:function(a){if("Uint8Array"===
a.constructor.name)return a;if("ArrayBuffer"===a.constructor.name)return new Uint8Array(a);if("string"===typeof a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}throw Error("unknown buffer type");},filenameToSqueak:function(a){a="/SqueakJS"+("/"!==a[0]?"/":"")+a;this.emulateMac&&(a=("Macintosh HD"+a).replace(/\//g,"\u20ac").replace(/:/g,"/").replace(/\u20ac/g,":"));return a},filenameFromSqueak:function(a){a=this.emulateMac?a.replace(/^[^:]*:/,":").replace(/\//g,
"\u20ac").replace(/:/g,"/").replace(/\u20ac/g,":"):a;return a=a.replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(a,b,c){var e=this.stackNonInteger(1),g=this.stackPos32BitInt(0);if(!this.success)return e;if(a){if(a=this.atCache[e.hash&this.atCacheMask],a.array!==e)return this.success=!1,e}else{if(e.isFloat){c=e.floatData();if(1==g)return this.pos32BitIntFor(c.getUint32(0,!1));if(2==g)return this.pos32BitIntFor(c.getUint32(4,!1));this.success=!1;return e}a=this.makeAtCacheInfo(this.atCache,
this.vm.specialSelectors[32],e,b,c)}if(1>g||g>a.size)return this.success=!1,e;if(c)return e.pointers[g-1];if(e.isPointers())return e.pointers[g-1+a.ivarOffset];if(e.isWords())return a.convertChars?this.charFromInt(e.words[g-1]&1073741823):this.pos32BitIntFor(e.words[g-1]);if(e.isBytes())return a.convertChars?this.charFromInt(e.bytes[g-1]&255):e.bytes[g-1]&255;c=4*e.pointersSize();return 0>g-1-c?(this.success=!1,e):e.bytes[g-1-c]&255},objectAtPut:function(a,b,c){var e=this.stackNonInteger(2),g=this.stackPos32BitInt(1);
if(!this.success)return e;var k;if(a){if(k=this.atPutCache[e.hash&this.atCacheMask],k.array!==e)return this.success=!1,e}else{if(e.isFloat)return a=this.stackPos32BitInt(0),!this.success||1!=g&&2!=g?this.success=!1:(b=e.floatData(),b.setUint32(1==g?0:4,a,!1),e["float"]=b.getFloat64(0)),this.vm.stackValue(0);k=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],e,b,c)}if(1>g||g>k.size)return this.success=!1,e;a=this.vm.stackValue(0);if(c)return e.pointers[g-1]=a;if(e.isPointers())return e.pointers[g-
1+k.ivarOffset]=a;if(e.isWords()){if(b){if(a.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,a;b=this.charToInt(a);if("number"!==typeof b)return this.success=!1,a}else b=this.stackPos32BitInt(0);this.success&&(e.words[g-1]=b);return a}if(b){if(a.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,a;b=this.charToInt(a);if("number"!==typeof b)return this.success=!1,a}else{if("number"!==typeof a)return this.success=!1,a;b=a}if(0>b||
255<b)return this.success=!1,a;if(e.isBytes())return e.bytes[g-1]=b;c=4*e.pointersSize();if(0>g-1-c)return this.success=!1,e;e.bytes[g-1-c]=b;return a},objectSize:function(a){var b=this.vm.stackValue(0),c=-1;a?b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?c=b.pointersSize():b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(c=b.bytesSize()):c=this.indexableSize(b);return-1===c?(this.success=!1,-1):this.pos32BitIntFor(c)},initAtCache:function(){this.atCacheSize=32;this.atCacheMask=
this.atCacheSize-1;this.atCache=[];this.atPutCache=[];this.nonCachedInfo={};for(var a=0;a<this.atCacheSize;a++)this.atCache.push({}),this.atPutCache.push({})},clearAtCache:function(){this.nonCachedInfo.array=null;for(var a=0;a<this.atCacheSize;a++)this.atCache[a].array=null,this.atPutCache[a].array=null},makeAtCacheInfo:function(a,b,c,e,g){a=this.vm.verifyAtSelector!==b||this.vm.verifyAtClass!==c.sqClass||this.vm.isContext(c)?this.nonCachedInfo:a[c.hash&this.atCacheMask];a.array=c;a.convertChars=
e;g?(a.size=c.instSize()+Math.max(0,c.indexableSize(this)),a.ivarOffset=0):(a.size=c.indexableSize(this),a.ivarOffset=c.isPointers()?c.instSize():0);return a}},"basic",{instantiateClass:function(a,b){return 4*b>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory"),this.success=!1,null):this.vm.instantiateClass(a,b)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(a){return this.vm.image.objectAfter(a)||0},someInstanceOf:function(a){if(a=this.vm.image.someInstanceOf(a))return a;
this.success=!1;return 0},nextInstanceAfter:function(a){if(a=this.vm.image.nextInstanceAfter(a))return a;this.success=!1;return 0},allInstancesOf:function(a){a=this.vm.image.allInstancesOf(a);var b=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length);b.pointers=a;return b},identityHash:function(a){return a.hash},identityHashSpur:function(a){var b=a.hash;return 0<b?b:a.hash=this.newObjectHash()},behaviorHash:function(a){var b=a.hash;return 0<b?b:this.vm.image.enterIntoClassTable(a)},
newObjectHash:function(a){return Math.floor(1073741822*Math.random())+1},primitiveAsCharacter:function(a){var b=this.stackInteger(0);return 0>b||1073741823<b?!1:(b=this.charFromInt(b))?this.popNandPushIfOK(a+1,b):!1},primitiveFullGC:function(a){this.vm.image.fullGC("primitive");a=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(a))},primitiveMakePoint:function(a,b){var c=this.vm.stackValue(1),e=this.vm.stackValue(0);if(b&&(this.checkFloat(c),this.checkFloat(e),!this.success))return!1;
this.vm.popNandPush(1+a,this.makePointWithXandY(c,e));return!0},primitiveStoreStackp:function(a){var b=this.stackNonInteger(1),c=this.stackInteger(0);if(!this.success||0>c||this.vm.decodeSqueakSP(c)>=b.pointers.length)return!1;for(var e=b.pointers[Squeak.Context_stackPointer];e<c;)b.pointers[this.vm.decodeSqueakSP(++e)]=this.vm.nilObj;b.pointers[Squeak.Context_stackPointer]=c;this.vm.popN(a);return!0},primitiveChangeClass:function(a){if(2<a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);
if(!this.success||!b.sameShapeAs(c))return!1;b.sqClass=c.sqClass;return this.popNIfOK(a)},primitiveAdoptInstance:function(a){if(2<a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success||!b.classSameShapeAs(c))return!1;c.sqClass=b;return this.popNIfOK(a)},primitiveDoPrimitiveWithArgs:function(a){a=this.stackNonInteger(0);var b=this.stackInteger(1);if(!this.success)return!1;var c=a.pointersSize(),e=this.vm.activeContext.pointersSize();if(this.vm.sp+c>=e)return!1;this.vm.popN(2);
for(e=0;e<c;e++)this.vm.push(a.pointers[e]);if(this.vm.tryPrimitive(b,c))return!0;this.vm.popN(c);this.vm.push(b);this.vm.push(a);return!1},primitiveShortAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1,b=b.wordsAsInt16Array();if(!this.success||!b||0>c||c>=b.length)return!1;var e;if(2>a)e=b[c];else{e=this.stackInteger(0);if(-32768>e||32767<e)return!1;b[c]=e}this.popNandPushIfOK(a+1,e);return!0},primitiveIntegerAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-
1)-1,b=b.wordsAsInt32Array();if(!this.success||!b||0>c||c>=b.length)return!1;var e;if(2>a)e=this.signed32BitIntegerFor(b[c]);else{e=this.stackSigned32BitInt(0);if(!this.success)return!1;b[c]=e}this.popNandPushIfOK(a+1,e);return!0},primitiveConstantFill:function(a){var b=this.stackNonInteger(1),c=this.stackPos32BitInt(0);if(!this.success||!b.isWordsOrBytes())return!1;var e=b.words||b.bytes;if(e){if(e===b.bytes&&255<c)return!1;for(b=0;b<e.length;b++)e[b]=c}this.vm.popN(a);return!0},primitiveNewMethod:function(a){var b=
this.stackInteger(0),c=this.stackInteger(1);if(!this.success)return 0;c=this.vm.instantiateClass(this.vm.stackValue(2),c);c.pointers=[b];for(var b=c.methodNumLits(),e=0;e<b;e++)c.pointers.push(this.vm.nilObj);this.vm.popNandPush(1+a,c);this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=c);return!0},primitiveExecuteMethodArgsArray:function(a){var b=this.stackNonInteger(0),c=this.stackNonInteger(1),e=this.vm.stackValue(2);if(!this.success||!b.isMethod()||4<a)return!1;var g=b.methodNumArgs();if(g!==c.pointersSize())return!1;
this.vm.popNandPush(a+1,e);for(a=0;a<g;a++)this.vm.push(c.pointers[a]);this.vm.executeNewMethod(e,b,g,b.methodPrimitiveIndex(),null,null);return!0},primitiveArrayBecome:function(a,b){var c=this.stackNonInteger(a),e=this.stackNonInteger(a-1),g=1<a?this.stackBoolean(a-2):!0;if(!this.success)return!1;this.success=this.vm.image.bulkBecome(c.pointers,e.pointers,b,g);return this.popNIfOK(a)},doStringReplace:function(){var a=this.stackNonInteger(4),b=this.stackInteger(3)-1,c=this.stackInteger(2)-b,e=this.stackNonInteger(1),
g=this.stackInteger(0)-1;if(!this.success)return a;if(!e.sameFormatAs(a))return this.success=!1,a;if(e.isPointers()){var k=e.pointersSize(),f=e.instSize(),g=g+f;if(0>g||g+c>k)return this.success=!1,a;k=a.pointersSize();f=a.instSize();b+=f;if(0>b||b+c>k)return this.success=!1,a;for(k=0;k<c;k++)a.pointers[b+k]=e.pointers[g+k]}else if(e.isWords()){k=e.wordsSize();if(0>g||g+c>k)return this.success=!1,a;k=a.wordsSize();if(0>b||b+c>k)return this.success=!1,a;for(k=0;k<c;k++)a.words[b+k]=e.words[g+k]}else{k=
e.bytesSize();if(0>g||g+c>k)return this.success=!1,a;k=a.bytesSize();if(0>b||b+c>k)return this.success=!1,a;for(k=0;k<c;k++)a.bytes[b+k]=e.bytes[g+k]}return a},primitiveCopyObject:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0),e=b.pointersSize();if(!this.success||b.isWordsOrBytes()||b.sqClass!==c.sqClass||e!==c.pointersSize())return!1;for(var g=0;g<e;g++)b.pointers[g]=c.pointers[g];this.vm.pop(a);return!0},primitiveLoadImageSegment:function(a){var b=this.stackNonInteger(1),c=
this.stackNonInteger(0);return b.words&&c.pointers?(b=this.vm.image.loadImageSegment(b,c))?this.popNandPushIfOK(a+1,b):!1:!1}},"blocks/closures",{doBlockCopy:function(){var a=this.vm.stackValue(1),b=this.stackInteger(0),c=a;this.vm.isContext(c)||(this.success=!1);if(!this.success)return a;"number"===typeof c.pointers[Squeak.Context_method]&&(c=c.pointers[Squeak.BlockContext_home]);var a=c.pointersSize()-c.instSize(),a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],
a),e=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method);a.pointers[Squeak.BlockContext_initialIP]=e;a.pointers[Squeak.Context_instructionPointer]=e;a.pointers[Squeak.Context_stackPointer]=0;a.pointers[Squeak.BlockContext_argumentCount]=b;a.pointers[Squeak.BlockContext_home]=c;a.pointers[Squeak.Context_sender]=this.vm.nilObj;return a},primitiveBlockValue:function(a){var b=this.vm.stackValue(a);if(!this.isA(b,Squeak.splOb_ClassBlockContext))return!1;var c=b.pointers[Squeak.BlockContext_argumentCount];
if("number"!==typeof c||c!=a||!b.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-a+1,b.pointers,Squeak.Context_tempFrameStart,a);b.pointers[Squeak.Context_instructionPointer]=b.pointers[Squeak.BlockContext_initialIP];b.pointers[Squeak.Context_stackPointer]=a;b.pointers[Squeak.BlockContext_caller]=this.vm.activeContext;this.vm.popN(a+1);this.vm.newActiveContext(b);return!0},primitiveBlockValueWithArgs:function(a){var b=this.vm.stackValue(1),
c=this.vm.stackValue(0);if(!this.isA(b,Squeak.splOb_ClassBlockContext)||!this.isA(c,Squeak.splOb_ClassArray))return!1;var e=b.pointers[Squeak.BlockContext_argumentCount];if("number"!==typeof e||e!=c.pointersSize()||!b.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(c.pointers,0,b.pointers,Squeak.Context_tempFrameStart,e);b.pointers[Squeak.Context_instructionPointer]=b.pointers[Squeak.BlockContext_initialIP];b.pointers[Squeak.Context_stackPointer]=e;b.pointers[Squeak.BlockContext_caller]=
this.vm.activeContext;this.vm.popN(a+1);this.vm.newActiveContext(b);return!0},primitiveClosureCopyWithCopiedValues:function(a){this.vm.breakNow("primitiveClosureCopyWithCopiedValues");debugger;return!1},primitiveClosureValue:function(a){var b=this.vm.stackValue(a);return a!==b.pointers[Squeak.Closure_numArgs]?!1:this.activateNewClosureMethod(b,a)},primitiveClosureValueWithArgs:function(a){var b=this.vm.top(),c=b.pointersSize();a=this.vm.stackValue(a);if(c!==a.pointers[Squeak.Closure_numArgs])return!1;
this.vm.pop();for(var e=0;e<c;e++)this.vm.push(b.pointers[e]);return this.activateNewClosureMethod(a,c)},primitiveClosureValueNoContextSwitch:function(a){return this.primitiveClosureValue(a)},activateNewClosureMethod:function(a,b){var c=a.pointers[Squeak.Closure_outerContext],e=this.vm.allocateOrRecycleContext(c.pointers[Squeak.Context_method].methodNeedsLargeFrame()),g=a.pointers.length-Squeak.Closure_firstCopiedValue;e.pointers[Squeak.Context_sender]=this.vm.activeContext;e.pointers[Squeak.Context_instructionPointer]=
a.pointers[Squeak.Closure_startpc];e.pointers[Squeak.Context_stackPointer]=b+g;e.pointers[Squeak.Context_method]=c.pointers[Squeak.Context_method];e.pointers[Squeak.Context_closure]=a;e.pointers[Squeak.Context_receiver]=c.pointers[Squeak.Context_receiver];for(var c=Squeak.Context_tempFrameStart,k=0;k<b;k++)e.pointers[c++]=this.vm.stackValue(b-k-1);for(k=0;k<g;k++)e.pointers[c++]=a.pointers[Squeak.Closure_firstCopiedValue+k];this.vm.popN(b+1);this.vm.newActiveContext(e);return!0}},"scheduling",{primitiveResume:function(){this.resume(this.vm.top());
return!0},primitiveSuspend:function(){var a=this.vm.top();if(a===this.activeProcess())this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.wakeHighestPriority());else{var b=a.pointers[Squeak.Proc_myList];if(b.isNil)return!1;this.removeProcessFromList(a,b);if(!this.success)return!1;a.pointers[Squeak.Proc_myList]=this.vm.nilObj;this.vm.popNandPush(1,b)}return!0},getScheduler:function(){return this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value]},activeProcess:function(){return this.getScheduler().pointers[Squeak.ProcSched_activeProcess]},
resume:function(a){var b=this.activeProcess();a.pointers[Squeak.Proc_priority]>b.pointers[Squeak.Proc_priority]?(this.putToSleep(b),this.transferTo(a)):this.putToSleep(a)},putToSleep:function(a){var b=a.pointers[Squeak.Proc_priority],b=this.getScheduler().pointers[Squeak.ProcSched_processLists].pointers[b-1];this.linkProcessToList(a,b)},transferTo:function(a){var b=this.getScheduler(),c=b.pointers[Squeak.ProcSched_activeProcess];b.pointers[Squeak.ProcSched_activeProcess]=a;c.pointers[Squeak.Proc_suspendedContext]=
this.vm.activeContext;this.vm.newActiveContext(a.pointers[Squeak.Proc_suspendedContext]);a.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj;this.vm.reclaimableContextCount=0;this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow())},wakeHighestPriority:function(){var a=this.getScheduler().pointers[Squeak.ProcSched_processLists],b=a.pointersSize()-1,c;do{if(0>b)throw Error("scheduler could not find a runnable process");c=a.pointers[b--]}while(this.isEmptyList(c));return this.removeFirstLinkOfList(c)},
linkProcessToList:function(a,b){this.isEmptyList(b)?b.pointers[Squeak.LinkedList_firstLink]=a:b.pointers[Squeak.LinkedList_lastLink].pointers[Squeak.Link_nextLink]=a;b.pointers[Squeak.LinkedList_lastLink]=a;a.pointers[Squeak.Proc_myList]=b},isEmptyList:function(a){return a.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(a){var b=a.pointers[Squeak.LinkedList_firstLink];b===a.pointers[Squeak.LinkedList_lastLink]?(a.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,a.pointers[Squeak.LinkedList_lastLink]=
this.vm.nilObj):a.pointers[Squeak.LinkedList_firstLink]=b.pointers[Squeak.Link_nextLink];b.pointers[Squeak.Link_nextLink]=this.vm.nilObj;return b},removeProcessFromList:function(a,b){var c=b.pointers[Squeak.LinkedList_firstLink],e=b.pointers[Squeak.LinkedList_lastLink];if(a===c)c=a.pointers[Squeak.Link_nextLink],b.pointers[Squeak.LinkedList_firstLink]=c,a===e&&(b.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj);else{for(var g=c;;){if(g.isNil)return this.success=!1;c=g.pointers[Squeak.Link_nextLink];
if(c===a)break;g=c}c=a.pointers[Squeak.Link_nextLink];g.pointers[Squeak.Link_nextLink]=c;a===e&&(b.pointers[Squeak.LinkedList_lastLink]=g)}a.pointers[Squeak.Link_nextLink]=this.vm.nilObj},registerSemaphore:function(a){var b=this.vm.top();this.isA(b,Squeak.splOb_ClassSemaphore)?this.vm.specialObjects[a]=b:this.vm.specialObjects[a]=this.vm.nilObj;return this.vm.stackValue(1)},primitiveWait:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;var b=a.pointers[Squeak.Semaphore_excessSignals];
0<b?a.pointers[Squeak.Semaphore_excessSignals]=b-1:(this.linkProcessToList(this.activeProcess(),a),this.transferTo(this.wakeHighestPriority()));return!0},primitiveSignal:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;this.synchronousSignal(a);return!0},synchronousSignal:function(a){this.isEmptyList(a)?a.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(a))},signalAtMilliseconds:function(a,b){this.isA(a,Squeak.splOb_ClassSemaphore)?
(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=a,this.vm.nextWakeupTick=b):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0)},primitiveSignalAtMilliseconds:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);if(!this.success)return!1;this.signalAtMilliseconds(c,b);this.vm.popN(a);return!0},primitiveSignalAtUTCMicroseconds:function(a){var b=this.stackSigned53BitInt(0),c=this.stackNonInteger(1);if(!this.success)return!1;this.signalAtMilliseconds(c,
b/1E3+Squeak.EpochUTC-this.vm.startupTime&Squeak.MillisecondClockMask);this.vm.popN(a);return!0},signalSemaphoreWithIndex:function(a){this.semaphoresToSignal.push(a)},signalExternalSemaphores:function(){for(var a=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,b=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var c=this.semaphoresToSignal.shift(),c=a[c-1];c.sqClass==b&&this.synchronousSignal(c)}},primitiveEnterCriticalSection:function(a){if(1<
a)return!1;var b=this.vm.stackValue(a),c=a?this.vm.top():this.activeProcess(),e=b.pointers[Squeak.Mutex_owner];e.isNil?(b.pointers[Squeak.Mutex_owner]=c,this.popNandPushIfOK(a+1,this.vm.falseObj)):e===c?this.popNandPushIfOK(a+1,this.vm.trueObj):(this.popNandPushIfOK(a+1,this.vm.falseObj),this.linkProcessToList(c,b),this.transferTo(this.wakeHighestPriority()));return!0},primitiveExitCriticalSection:function(a){a=this.vm.top();if(this.isEmptyList(a))a.pointers[Squeak.Mutex_owner]=this.vm.nilObj;else{var b=
this.removeFirstLinkOfList(a);a.pointers[Squeak.Mutex_owner]=b;this.resume(b)}return!0},primitiveTestAndSetOwnershipOfCriticalSection:function(a){if(1<a)return!1;var b=this.vm.stackValue(a),c=a?this.vm.top():this.activeProcess(),e=b.pointers[Squeak.Mutex_owner];e.isNil?(b.pointers[Squeak.Mutex_owner]=c,this.popNandPushIfOK(a+1,this.vm.falseObj)):e===c?this.popNandPushIfOK(a+1,this.vm.trueObj):this.popNandPushIfOK(a+1,this.vm.nilObj);return!0}},"vm functions",{primitiveGetAttribute:function(a){var b=
this.stackInteger(0);if(!this.success)return!1;switch(b){case 0:b=this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:b=this.display.documentName||null;break;case 2:b=this.display.documentName||null;break;case 1001:b=Squeak.platformName;break;case 1002:b=Squeak.osVersion;break;case 1003:b=Squeak.platformSubtype;break;case 1004:b=Squeak.vmVersion;break;case 1005:b=Squeak.windowSystem;break;case 1006:b=Squeak.vmBuild;break;case 1007:b=Squeak.vmVersion;break;case 1009:b=Squeak.vmVersion;
break;default:return!1}this.vm.popNandPush(a+1,this.makeStObject(b));return!0},setLowSpaceThreshold:function(){var a=this.stackInteger(0);this.success&&(this.vm.lowSpaceThreshold=a);return this.vm.stackValue(1)},primitiveVMParameter:function(a){switch(a){case 0:a=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],44);for(var b=0;44>b;b++)a.pointers[b]=this.makeStObject(this.vmParameterAt(b+1));return this.popNandPushIfOK(1,a);case 1:return a=this.stackInteger(0),1>a||44<a?!1:
this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(a)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(a){switch(a){case 1:return this.vm.image.oldSpaceBytes;case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return 1;case 10:return 0;case 11:return this.vm.image.gcTenured;case 22:return 0;
case 23:return this.vm.image.extraVMMemory;case 40:return 4;case 41:return this.vm.image.formatVersion();case 44:return this.vm.image.bytesLeft()}return null},primitiveImageName:function(a){if(0==a)return this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name)));this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString());window.localStorage.squeakImageName=this.vm.image.name;return!0},primitiveSnapshot:function(a){this.vm.popNandPush(1,this.vm.trueObj);this.vm.storeContextRegisters();
this.activeProcess().pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext;this.vm.image.fullGC("snapshot");a=this.vm.image.writeToBuffer();Squeak.flushAllFiles();Squeak.filePut(this.vm.image.name,a);this.vm.popNandPush(1,this.vm.falseObj);return!0},primitiveQuit:function(a){Squeak.flushAllFiles();this.display.quitFlag=!0;this.vm.breakNow("quit");return!0},primitiveExitToDebugger:function(a){this.vm.breakNow("debugger primitive");debugger;return!0},primitiveSetGCBiasToGrow:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrow",
0,a)},primitiveSetGCBiasToGrowGCLimit:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,a)}},"display",{primitiveBeCursor:function(a){if(this.display.cursorCanvas){var b=this.loadForm(this.stackNonInteger(a),!0),c=1===a?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!b)return!1;var e=this.display.cursorCanvas,g=e.getContext("2d"),k={left:0,top:0,right:b.width,bottom:b.height};e.width=b.width;e.height=b.height;1===b.depth?c?(b=this.cursorMergeMask(b,c),this.showForm(g,
b,k,[0,4278190335,4294967295,4278190080])):this.showForm(g,b,k,[0,4278190080]):this.showForm(g,b,k,!0);c=this.display.context.canvas;c=c.offsetWidth/c.width;e.style.width=(e.width*c|0)+"px";e.style.height=(e.height*c|0)+"px";this.display.cursorOffsetX=b.offsetX*c|0;this.display.cursorOffsetY=b.offsetY*c|0}this.vm.popN(a);return!0},cursorMergeMask:function(a,b){for(var c=new Uint32Array(16),e=0;16>e;e++){for(var g=a.bits[e],k=b.bits[e],f=2147483648,d=0,p=0;16>p;p++)d=d|(k&f)>>p|(g&f)>>p+1,f>>>=1;c[e]=
d}return{obj:a.obj,bits:c,depth:2,width:16,height:16,offsetX:a.offsetX,offsetY:a.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(a){var b=this.vm.stackValue(0);this.vm.specialObjects[Squeak.splOb_TheDisplay]=b;this.vm.popN(a);return!0},primitiveReverseDisplay:function(a){this.reverseDisplay=!this.reverseDisplay;this.redrawDisplay();if(this.display.cursorCanvas){var b=this.display.cursorCanvas;a=b.getContext("2d");for(var b=a.getImageData(0,0,b.width,b.height),c=new Uint32Array(b.data.buffer),
e=0;e<c.length;e++)c[e]^=16777215;a.putImageData(b,0,0)}return!0},primitiveShowDisplayRect:function(a){var b={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};if(!this.success)return!1;this.redrawDisplay(b);this.vm.popN(a);return!0},redrawDisplay:function(a){var b=this.theDisplay(),c={left:0,top:0,right:b.width,bottom:b.height};a&&(a.left>c.left&&(c.left=a.left),a.right<c.right&&(c.right=a.right),a.top>c.top&&(c.top=a.top),a.bottom<c.bottom&&
(c.bottom=a.bottom));c.left<c.right&&c.top<c.bottom&&this.displayUpdate(b,c)},showForm:function(a,b,c,e){if(c){var g=c.left,k=c.top,f=c.right-g,d=c.bottom-k,p=a.createImageData(f,d),n=p.data;n.buffer||(n=new Uint8Array(f*d*4));var x=new Uint32Array(n.buffer);switch(b.depth){case 1:case 2:case 4:case 8:var q=e||this.swappedColors;if(!q){for(var q=[],m=0;256>m;m++){var h=this.indexedColors[m],h=(h&4278255360)+((h&16711680)>>16)+((h&255)<<16);q[m]=h}this.swappedColors=q}this.reverseDisplay&&(e?q=e.map(function(a){return a^
16777215}):(this.reversedColors||(this.reversedColors=q.map(function(a){return a^16777215})),q=this.reversedColors));var t=(1<<b.depth)-1,h=32-(g%b.pixPerWord+1)*b.depth;for(e=0;e<d;e++){for(var m=b.pitch*k+(g/b.pixPerWord|0),B=h,l=b.bits[m],u=p.width*e,y=0;y<f;y++)x[u++]=q[l>>>B&t],0>(B-=b.depth)&&(B=32-b.depth,l=b.bits[++m]);k++}break;case 16:h=g%2?0:16;for(e=0;e<d;e++){m=b.pitch*k+(g/2|0);B=h;l=b.bits[m];u=p.width*e;for(y=0;y<f;y++)q=l>>>B,x[u++]=((q&31744)>>7)+((q&992)<<6)+((q&31)<<19)+4278190080,
0>(B-=16)&&(B=16,l=b.bits[++m]);k++}break;case 32:q=e?0:4278190080;for(e=0;e<d;e++){m=b.pitch*k+g;u=p.width*e;for(y=0;y<f;y++)h=b.bits[m++],h=h&4278255360|(h&16711680)>>16|(h&255)<<16|q,x[u++]=h;k++}break;default:throw Error("depth not implemented");}p.data!==n&&p.data.set(n);a.putImageData(p,c.left,c.top)}},primitiveDeferDisplayUpdates:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;this.deferDisplayUpdates=b;this.vm.popN(a);return!0},primitiveForceDisplayUpdate:function(a){this.vm.breakOut();
this.vm.popN(a);return!0},primitiveScreenSize:function(a){var b=this.display;return this.popNandPushIfOK(a+1,this.makePointWithXandY(b.width||b.context.canvas.width,b.height||b.context.canvas.height))},primitiveSetFullScreen:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;if(this.display.fullscreen!=b)if(this.display.fullscreenRequest){var c=this.vm.freeze();this.display.fullscreenRequest(b,function(){c()})}else this.display.fullscreen=b,this.vm.breakOut();this.vm.popN(a);return!0},
primitiveTestDisplayDepth:function(a){return this.pop2andPushBoolIfOK(0<=[1,2,4,8,16,32].indexOf(this.stackInteger(0)))},loadForm:function(a,b){if(a.isNil)return null;var c={obj:a,bits:a.pointers[Squeak.Form_bits].wordsOrBytes(),depth:a.pointers[Squeak.Form_depth],width:a.pointers[Squeak.Form_width],height:a.pointers[Squeak.Form_height]};if(b){var e=a.pointers[Squeak.Form_offset];c.offsetX=e.pointers?e.pointers[Squeak.Point_x]:0;c.offsetY=e.pointers?e.pointers[Squeak.Point_y]:0}if(0===c.width||0===
c.height)return c;if(!(0<c.width&&0<c.height))return null;c.msb=0<c.depth;c.msb||(c.depth=-c.depth);if(!(0<c.depth))return null;c.pixPerWord=32/c.depth;c.pitch=(c.width+(c.pixPerWord-1))/c.pixPerWord|0;return c.bits.length!==c.pitch*c.height?null:c},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(a,b){this.deferDisplayUpdates||a!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),b)},displayUpdate:function(a,
b){this.showForm(this.display.context,a,b);this.display.lastTick=this.vm.lastTick;this.display.idle=0},primitiveBeep:function(a){var b=Squeak.startAudioOut();if(b){var c=b.createOscillator();c.connect(b.destination);c.type="square";c.frequency.value=880;c.start();c.stop(b.currentTime+.2)}else this.vm.warnOnce("could not initialize audio");return this.popNIfOK(a)}},"input",{primitiveClipboardText:function(a){if(0===a){if("string"!==typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,
this.makeStString(this.display.clipboardString))}else 1===a&&(a=this.vm.top(),a.bytes&&(this.display.clipboardString=a.bytesAsString(),this.display.clipboardStringChanged=!0),this.vm.pop());return!0},primitiveKeyboardNext:function(a){return this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(a){return this.popNandPushIfOK(a+1,this.display.keys.length?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(a){this.popNandPushIfOK(a+
1,this.ensureSmallInt(this.display.buttons));this.vm.breakOut();20<this.display.idle++&&this.vm.goIdle();return!0},primitiveMousePoint:function(a){var b=this.ensureSmallInt(this.display.mouseX),c=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(a+1,this.makePointWithXandY(b,c))},primitiveInputSemaphore:function(a){a=this.stackInteger(0);if(!this.success)return!1;this.inputEventSemaIndex=a;this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this);
return!0},primitiveInputWord:function(a){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(a){this.display.idle++;a=this.stackNonInteger(0);if(!this.display.getNextEvent)return!1;this.display.getNextEvent(a.pointers,this.vm.startupTime);return!0}},"time",{primitiveRelinquishProcessorForMicroseconds:function(a){this.vm.pop(a);this.vm.goIdle();return!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(a){this.vm.startupTime=
Date.now()-a},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClock:function(a){var b=Date.now()-a.epoch;if("object"!==typeof performance)return this.pos53BitIntFor(1E3*b);var c=1E3*performance.now()%1E3|0,e=a.millis,g=a.micros;e>b&&(b=e);b===e&&c<g&&b++;a.millis=b;a.micros=c;return this.pos53BitIntFor(1E3*b+c)},microsecondClockUTC:function(){this.microsecondClockUTCState||(this.microsecondClockUTCState={epoch:Squeak.EpochUTC,millis:0,micros:0});return this.microsecondClock(this.microsecondClockUTCState)},
microsecondClockLocal:function(){this.microsecondClockLocalState||(this.microsecondClockLocalState={epoch:Squeak.Epoch,millis:0,micros:0});return this.microsecondClock(this.microsecondClockLocalState)}},"FilePlugin",{primitiveDirectoryCreate:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.dirCreate(b);this.success||(b=Squeak.splitFilePath(b),console.log("Directory not created: "+b.fullname));return this.popNIfOK(a)},
primitiveDirectoryDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.dirDelete(b);return this.popNIfOK(a)},primitiveDirectoryDelimitor:function(a){return this.popNandPushIfOK(1,this.charFromInt((this.emulateMac?":":"/").charCodeAt(0)))},primitiveDirectoryEntry:function(a){this.vm.warnOnce("Not yet implemented: primitiveDirectoryEntry");return!1},primitiveDirectoryLookup:function(a){var b=this.stackInteger(0),
c=this.stackNonInteger(1);if(!this.success)return!1;var c=c.bytesAsString(),e=this.filenameFromSqueak(c),g=Squeak.dirList(e,!0);if(!g)return a=Squeak.splitFilePath(e),console.log("Directory not found: "+a.fullname),!1;e=Object.keys(g).sort();g=g[e[b-1]];"/"===c&&(1===b?(g||(g=[0,0,0,0,0]),g[0]="SqueakJS",g[3]=!0):g=null);this.popNandPushIfOK(a+1,this.makeStObject(g));return!0},primitiveDirectorySetMacTypeAndCreator:function(a){return this.popNIfOK(a)},primitiveFileAtEnd:function(a){var b=this.stackNonInteger(0);
if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeStObject(b.filePos>=b.file.size));return!0},primitiveFileClose:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;"string"===typeof b.file?this.fileConsoleFlush(b.file):(this.fileClose(b.file),this.vm.breakOut(),b.file=null);return this.popNIfOK(a)},primitiveFileDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());this.success=Squeak.fileDelete(b);
return this.popNIfOK(a)},primitiveFileFlush:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;"string"===typeof b.file?this.fileConsoleFlush(b.file):(Squeak.flushFile(b.file),this.vm.breakOut());return this.popNIfOK(a)},primitiveFileGetPosition:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.filePos));return!0},makeFileHandle:function(a,b,c){a=this.makeStString("squeakjs:"+a);a.file=b;a.fileWrite=
c;a.filePos=0;return a},primitiveFileOpen:function(a){var b=this.stackBoolean(0),c=this.stackNonInteger(1);if(!this.success)return!1;c=this.filenameFromSqueak(c.bytesAsString());c=this.fileOpen(c,b);if(!c)return!1;b=this.makeFileHandle(c.name,c,b);this.popNandPushIfOK(a+1,b);return!0},primitiveFileRead:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-1,e=this.stackNonInteger(2),g=this.stackNonInteger(3);return this.success&&g.file?b?e.bytes?0>c||c+b>e.bytes.length?!1:this.fileContentsDo(g.file,
function(k){if(!k.contents)return this.popNandPushIfOK(a+1,0);var f=k.contents,d=e.bytes;b=Math.min(b,k.size-g.filePos);for(k=0;k<b;k++)d[c+k]=f[g.filePos++];this.popNandPushIfOK(a+1,b)}.bind(this)):(console.log("File reading into non-bytes object not implemented yet"),!1):this.popNandPushIfOK(a+1,0):!1},primitiveFileRename:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success)return!1;b=this.filenameFromSqueak(b.bytesAsString());c=this.filenameFromSqueak(c.bytesAsString());
this.success=Squeak.fileRename(b,c);this.vm.breakOut();return this.popNIfOK(a)},primitiveFileSetPosition:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);if(!this.success||!c.file)return!1;c.filePos=b;return this.popNIfOK(a)},primitiveFileSize:function(a){var b=this.stackNonInteger(0);if(!this.success||!b.file)return!1;this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.file.size));return!0},primitiveFileStdioHandles:function(a){var b=[null,this.makeFileHandle("console.log","log",
!0),this.makeFileHandle("console.error","error",!0)];this.popNandPushIfOK(a+1,this.makeStArray(b));return!0},primitiveFileTruncate:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);if(!this.success||!c.file||!c.fileWrite)return!1;c.file.size>b&&(c.file.size=b,c.file.modified=!0,c.filePos>c.file.size&&(c.filePos=c.file.size));return this.popNIfOK(a)},primitiveDisableFileAccess:function(a){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,a)},primitiveFileWrite:function(a){var b=
this.stackInteger(0),c=this.stackInteger(1)-1,e=this.stackNonInteger(2),g=this.stackNonInteger(3);if(!this.success||!g.file||!g.fileWrite)return!1;if(!b)return this.popNandPushIfOK(a+1,0);var k=e.bytes||e.wordsAsUint8Array();return!k||0>c||c+b>k.length?!1:"string"===typeof g.file?(this.fileConsoleWrite(g.file,k,c,b),this.popNandPushIfOK(a+1,b),!0):this.fileContentsDo(g.file,function(e){var d=e.contents||[];g.filePos+b>d.length&&(e.contents=new Uint8Array(0===d.length?g.filePos+b:Math.max(g.filePos+
b,d.length+1E4)),e.contents.set(d),d=e.contents);for(var p=0;p<b;p++)d[g.filePos++]=k[c+p];g.filePos>e.size&&(e.size=g.filePos);e.modified=!0;this.popNandPushIfOK(a+1,b)}.bind(this))},fileOpen:function(a,b){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});var c=Squeak.splitFilePath(a);if(!c.basename)return null;var e=Squeak.dirList(c.dirname,!0);if(!e)return null;var e=e[c.basename],g=null;if(e){var k=SqueakFiles[c.fullname];if(k)return++k.refCount,k}else{if(!b)return console.log("File not found: "+
c.fullname),null;g=new Uint8Array;e=Squeak.filePut(c.fullname,g.buffer);if(!e)return console.log("Cannot create file: "+c.fullname),null}k={name:c.fullname,size:e[4],contents:g,modified:!1,refCount:1};return SqueakFiles[k.name]=k},fileClose:function(a){Squeak.flushFile(a);0==--a.refCount&&delete SqueakFiles[a.name]},fileContentsDo:function(a,b){if(a.contents)b(a);else{if(!1===a.contents)return!1;this.vm.freeze(function(c){Squeak.fileGet(a.name,function(e){if(null==e)return error(a.name);a.contents=
this.asUint8Array(e);c();b(a)}.bind(this),function(e){console.log("File get failed: "+e);a.contents=!1;c();b(a)}.bind(this))}.bind(this))}return!0},fileConsoleBuffer:{log:"",error:""},fileConsoleWrite:function(a,b,c,e){b=b.subarray(c,c+e);b=this.fileConsoleBuffer[a]+Squeak.bytesAsString(b);if(c=b.match("([^]*)\n"))console[a](c[1]),b=c[2];this.fileConsoleBuffer[a]=b},fileConsoleFlush:function(a){var b=this.fileConsoleBuffer[a];b&&(console[a](b),this.fileConsoleBuffer[a]="")}},"DropPlugin",{primitiveDropRequestFileHandle:function(a){var b=
this.stackInteger(0),c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;b=c[b-1];c=this.fileOpen(b,!1);if(!c)return!1;b=this.makeFileHandle(b,c,!1);this.popNandPushIfOK(a+1,b);return!0},primitiveDropRequestFileName:function(a){var b=this.stackInteger(0),c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;b=this.makeStString(this.filenameToSqueak(c[b-1]));return this.popNandPushIfOK(a,b)}},"SoundPlugin",{snd_primitiveSoundStart:function(a){return this.snd_primitiveSoundStartWithSemaphore(a)},
snd_primitiveSoundStartWithSemaphore:function(a){var b=this.stackInteger(a-1),c=this.stackInteger(a-2),e=this.stackBoolean(a-3),g=3<a?this.stackInteger(a-4):0;if(!this.success)return!1;this.audioContext=Squeak.startAudioOut();if(!this.audioContext)return this.vm.warnOnce("could not initialize audio"),!1;this.audioSema=g;this.audioNextTimeSlot=0;this.audioBuffersReady=[];this.audioBuffersUnused=[this.audioContext.createBuffer(e?2:1,b,c),this.audioContext.createBuffer(e?2:1,b,c)];console.log("sound: started");
return this.popNIfOK(a)},snd_playNextBuffer:function(){if(this.audioContext&&0!==this.audioBuffersReady.length){var a=this.audioContext.createBufferSource();a.buffer=this.audioBuffersReady.shift();a.connect(this.audioContext.destination);this.audioNextTimeSlot<this.audioContext.currentTime&&(0<this.audioNextTimeSlot&&console.warn("sound "+this.audioContext.currentTime.toFixed(3)+": buffer underrun by "+(this.audioContext.currentTime-this.audioNextTimeSlot).toFixed(3)+" s"),this.audioNextTimeSlot=
this.audioContext.currentTime);a.start(this.audioNextTimeSlot);this.audioNextTimeSlot+=a.buffer.duration;window.setTimeout(function(){this.audioContext&&(this.audioBuffersUnused.push(a.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1E3*(this.audioNextTimeSlot-this.audioContext.currentTime));this.snd_playNextBuffer()}},snd_primitiveSoundAvailableSpace:function(a){if(!this.audioContext)return console.log("sound: no audio context"),!1;
var b=0;0<this.audioBuffersUnused.length&&(b=this.audioBuffersUnused[0],b=b.length*b.numberOfChannels*2);return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundPlaySamples:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;var b=this.stackInteger(2),c=this.stackNonInteger(1).wordsAsInt16Array(),e=this.stackInteger(0)-1;if(!this.success||!c)return!1;for(var g=this.audioBuffersUnused.shift(),k=g.numberOfChannels,f=0;f<k;f++)for(var d=
g.getChannelData(f),p=e+f,n=0;n<b;n++)d[n]=c[p]/32768,p+=k;this.audioBuffersReady.push(g);this.snd_playNextBuffer();return this.popNIfOK(a)},snd_primitiveSoundPlaySilence:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;for(var b=this.audioBuffersUnused.shift(),c=b.numberOfChannels,e=b.length,g=0;g<c;g++)for(var k=b.getChannelData(g),f=0;f<e;f++)k[f]=0;this.audioBuffersReady.push(b);this.snd_playNextBuffer();return this.popNandPushIfOK(a+
1,e)},snd_primitiveSoundStop:function(a){this.audioContext&&(this.audioBuffersUnused=this.audioBuffersReady=this.audioContext=null,this.audioSema=this.audioNextTimeSlot=0,console.log("sound: stopped"));return this.popNIfOK(a)},snd_primitiveSoundStartRecording:function(a){if(3!==a)return!1;var b=this.stackNonInteger(3),c=this.stackInteger(2),e=this.stackBoolean(1),g=this.stackInteger(0);if(!this.success)return!1;var k=this.primMethod,f=this.vm.freeze(),d=this;Squeak.startAudioIn(function(b,k){console.log("sound: recording started");
d.audioInContext=b;d.audioInSource=k;d.audioInSema=g;d.audioInBuffers=[];d.audioInBufferIndex=0;for(d.audioInOverSample=1;c*d.audioInOverSample<d.audioInContext.sampleRate;)d.audioInOverSample*=2;for(var n=1024*d.audioInOverSample;.1>n/d.audioInContext.sampleRate;)n*=2;d.audioInProcessor=b.createScriptProcessor(n,e?2:1,e?2:1);d.audioInProcessor.onaudioprocess=function(a){d.snd_recordNextBuffer(a.inputBuffer)};d.audioInSource.connect(d.audioInProcessor);d.audioInProcessor.connect(b.destination);d.vm.popN(a);
window.setTimeout(f,0)},function(c){console.warn(c);d.vm.sendAsPrimitiveFailure(b,k,a);window.setTimeout(f,0)});return!0},snd_recordNextBuffer:function(a){this.audioInContext&&(5<this.audioInBuffers.length&&this.audioInBuffers.shift(),this.audioInBuffers.push(a),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(a){if(!this.audioInContext)return!1;var b=this.audioInContext.sampleRate/this.audioInOverSample|
0;console.log("sound: actual recording rate "+b+"x"+this.audioInOverSample);return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundRecordSamples:function(a){var b=this.stackNonInteger(1).wordsAsInt16Array(),c=this.stackInteger(0)-1;if(!this.success)return!1;for(var e=0;c<b.length&&0!==this.audioInBuffers.length;){for(var g=this.audioInBuffers[0],k=g.numberOfChannels,f=k,d=this.audioInOverSample,p=Math.min((g.length-this.audioInBufferIndex)/d,(b.length-c)/f),n=0;n<k;n++)for(var x=g.getChannelData(n),
q=this.audioInBufferIndex,m=c+n,h=0;h<p;h++)b[m]=32768*x[q]&65535,m+=f,q+=d;e+=p*k;c+=p*k;q<g.length?this.audioInBufferIndex=q:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(a+1,e)},snd_primitiveSoundStopRecording:function(a){this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInProcessor=this.audioInSource=this.audioInBuffers=null,console.log("sound recording stopped"));
return!0},snd_primitiveSoundSetRecordLevel:function(a){return!0}},"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(a){return this.popNandPushIfOK(a+1,this.vm.trueObj)},jpeg2_primImageHeight:function(a){var b=this.stackNonInteger(0).wordsOrBytes();return b?this.popNandPushIfOK(a+1,b[1]):!1},jpeg2_primImageWidth:function(a){var b=this.stackNonInteger(0).wordsOrBytes();return b?this.popNandPushIfOK(a+1,b[0]):!1},jpeg2_primJPEGCompressStructSize:function(a){return this.popNandPushIfOK(a+
1,0)},jpeg2_primJPEGDecompressStructSize:function(a){return this.popNandPushIfOK(a+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(a){var b=this.stackNonInteger(2).wordsOrBytes(),c=this.stackNonInteger(1).bytes;if(!b||!c)return!1;var e=this.vm.freeze();this.jpeg2_readImageFromBytes(c,function(a){this.jpeg2state={src:c,img:a};b[0]=a.width;b[1]=a.height;e()}.bind(this),function(){b[0]=0;b[1]=0;e()}.bind(this));
return this.popNIfOK(a)},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(a){var b=this.stackNonInteger(3).bytes,c=this.stackNonInteger(2).pointers,e=this.stackBoolean(1);if(!this.success||!b||!c)return!1;var g=this.jpeg2state;if(!g||g.src!==b)return console.error("jpeg read did not match header info"),!1;b=c[Squeak.Form_depth];g=this.jpeg2_getPixelsFromImage(g.img);c=c[Squeak.Form_bits].words;if(32===b)this.jpeg2_copyPixelsToForm32(g,c);else if(16===b)e?this.jpeg2_ditherPixelsToForm16(g,
c):this.jpeg2_copyPixelsToForm16(g,c);else return!1;return this.popNIfOK(a)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(a){this.vm.warnOnce("JPEGReadWritePlugin2: writing not implemented yet");return!1},jpeg2_readImageFromBytes:function(a,b,c){a=new Blob([a],{type:"image/jpeg"});var e=new Image;e.onload=function(){b(e)};e.onerror=function(){console.warn("could not render JPEG");c()};e.src=(window.URL||window.webkitURL).createObjectURL(a)},jpeg2_getPixelsFromImage:function(a){var b=
document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return c.getImageData(0,0,a.width,a.height)},jpeg2_copyPixelsToForm32:function(a,b){for(var c=a.data,e=0;e<b.length;e++)b[e]=4278190080|c[4*e+0]<<16|c[4*e+1]<<8|c[4*e+2]},jpeg2_copyPixelsToForm16:function(a,b){for(var c=a.width,e=a.height,g=a.data,k=0;k<e;k++)for(var f=0;f<c;f+=2){var d=k*e+f,p=g[4*d+4]>>3,n=g[4*d+5]>>3,x=g[4*d+6]>>3,q=g[4*d+0]>>3<<10|g[4*d+1]>>3<<5|g[4*d+2]>>3;0===q&&(q=1);
q=q<<16|p<<10|n<<5|x;0===(q&65535)&&(q|=1);b[d>>1]=q}},jpeg2_ditherPixelsToForm16:function(a,b){for(var c=a.width>>1,e=a.height,g=a.data,k=[2,0,14,12,1,3,13,15],f=[10,8,6,4,9,11,5,7],d=0;d<e;d++)for(var p=0;p<c;p++){var n=d*e+2*p<<2,x=g[n+0],q=g[n+1],m=g[n+2],h=g[n+4],t=g[n+5],B=g[n+6],l=(d&3)<<1|p&1,u=k[l],l=f[l],y,G;y=496*x>>8;G=y&15;y>>=4;x=u<G?y+1:y;y=496*q>>8;G=y&15;y>>=4;q=u<G?y+1:y;y=496*m>>8;G=y&15;y>>=4;m=u<G?y+1:y;y=496*h>>8;G=y&15;y>>=4;h=l<G?y+1:y;y=496*t>>8;G=y&15;y>>=4;t=l<G?y+1:y;y=
496*B>>8;G=y&15;y>>=4;B=l<G?y+1:y;x=x<<10|q<<5|m;0===x&&(x=1);x=x<<16|h<<10|t<<5|B;0===(x&65535)&&(x|=1);b[n>>3]=x}}},"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(a){var b=this.stackNonInteger(0).bytesAsString();if(""==b)return!1;if(/^\/SqueakJS\//.test(b)){var b=b.slice(10),c=Squeak.splitFilePath(b),e=n["squeak-template:"+c.dirname];e&&(b=JSON.parse(e).url+"/"+c.basename)}window.open(b,"_blank");return this.popNIfOK(a)},scratch_primitiveGetFolderPath:function(a){var b=this.stackInteger(0);
if(!this.success)return!1;var c;switch(b){case 1:c="/"}if(!c)return!1;this.vm.popNandPush(a+1,this.makeStString(this.filenameToSqueak(c)));return!0}},"JavaScriptPlugin",{js_primitiveDoUnderstand:function(a){var b=this.stackNonInteger(1),c=this.js_objectOrGlobal(b),e=this.stackNonInteger(0).pointers,g=e[0].bytesAsString(),e=e[1].pointers||[],k=!("jsObject"in b),f=null;try{var d=g.match(/([^:]*)/)[0];if(k||"new"!==d){if(!(d in c))return this.js_setError("Property not found: "+d);var p=c[d];if("function"==
typeof p&&(!k||0<e.length))f=p.apply(c,this.js_fromStArray(e));else if(0==e.length)f=p;else if(1==e.length)c[d]=this.js_fromStObject(e[0]);else return this.js_setError("Property "+d+" is not a function")}else if(0===e.length)f=new c;else var n=[null].concat(this.js_fromStArray(e)),f=new (Function.prototype.bind.apply(c,n))}catch(x){return this.js_setError(x.message)}b=this.makeStObject(f,b.sqClass);return this.popNandPushIfOK(a+1,b)},js_primitiveAsString:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));
return this.popNandPushIfOK(a+1,this.makeStString(String(b)))},js_primitiveTypeof:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(typeof b))},js_primitiveAt:function(a){var b=this.stackNonInteger(1),c=this.vm.stackValue(0),e;try{var g=this.js_objectOrGlobal(b),k=this.js_fromStObject(c);e=this.makeStObject(g[k],b.sqClass)}catch(f){return this.js_setError(f.message)}return this.popNandPushIfOK(a+1,e)},js_primitiveAtPut:function(a){var b=
this.stackNonInteger(2),c=this.vm.stackValue(1),e=this.vm.stackValue(0);try{var g=this.js_objectOrGlobal(b),k=this.js_fromStObject(c),f=this.js_fromStObject(e);g[k]=f}catch(d){return this.js_setError(d.message)}return this.popNandPushIfOK(a+1,e)},js_primitiveSqueakAsJSObject:function(a){var b=this.stackNonInteger(1),c=this.vm.stackValue(0);this.success&&(b.jsObject=c);return this.popNIfOK(a)},js_primitiveInitCallbacks:function(a){this.js_callbackSema=this.stackInteger(0);this.js_activeCallback=null;
return this.popNIfOK(a)},js_primitiveGetActiveCallbackBlock:function(a){var b=this.js_activeCallback;return b?this.popNandPushIfOK(a,b.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(a){var b=this.stackNonInteger(a),c=this.js_activeCallback;if(!c)return this.js_setError("No active callback");try{var e=this.makeStArray(c.args,b);return this.popNandPushIfOK(a,e)}catch(g){return this.js_setError(g.message)}},js_primitiveReturnFromCallback:function(a){if(1!==
a)return!1;if(!this.js_activeCallback)return this.js_setError("No active callback");this.js_activeCallback.result=this.vm.pop();this.vm.breakOut();return!0},js_primitiveGetError:function(a){var b=this.makeStObject(this.js_error);this.js_error=null;return this.popNandPushIfOK(a+1,b)},js_setError:function(a){this.js_error=String(a);return!1},js_fromStObject:function(a){if("number"===typeof a)return a;if(a.jsObject)return a.jsObject;if(a.isFloat)return a["float"];if(a.isNil)return null;if(a.isTrue)return!0;
if(a.isFalse)return!1;if(a.bytes||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return a.bytesAsString();if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(a.pointers||[],!0);if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(a);throw Error("asJSArgument needed for "+a);},js_fromStArray:function(a,b){if(0<a.length&&b&&this.isAssociation(a[0]))return this.js_fromStDict(a);
for(var c=[],e=0;e<a.length;e++)c.push(this.js_fromStObject(a[e]));return c},js_fromStDict:function(a){for(var b={},c=0;c<a.length;c++){var e=a[c].pointers;if(!e||2!==e.length)throw Error(e+" is not an Association");var g=this.js_fromStObject(e[0]),e=this.js_fromStObject(e[1]);b[g]=e}return b},js_fromStBlock:function(a){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var b=a.pointers[Squeak.BlockContext_argumentCount];"number"!==typeof b&&(b=a.pointers[Squeak.Closure_numArgs]);
var c=this;return function(){for(var e=[],g=0;g<b;g++)e.push(arguments[g]);return new Promise(function(b,f){setTimeout(function(){c.js_executeCallbackAsync(a,e,b,f)},0)})}},js_executeCallbackAsync:function(a,b,c,e){function g(){k.js_executeCallbackAsync(a,b,c,e)}var k=this;this.js_activeCallback||this.vm.frozen?setTimeout(g,0):this.js_executeCallback(a,b,c,e)},js_executeCallback:function(a,b,c,e){if(this.js_activeCallback)return console.error("Callback: already active");this.js_activeCallback={block:a,
args:b,result:null};this.signalSemaphoreWithIndex(this.js_callbackSema);this.vm.forceInterruptCheck();for(a=Date.now()+500;Date.now()<a&&!this.js_activeCallback.result;)this.vm.interpret();a=this.js_activeCallback.result;this.js_activeCallback=null;if(a)try{c(this.js_fromStObject(a))}catch(g){c(a.toString())}else e(Error("SqueakJS timeout"))},js_objectOrGlobal:function(a){return"jsObject"in a?a.jsObject:window}},"Obsolete",{primitiveFloatArrayAt:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveAt",a)},primitiveFloatArrayMulFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",a)},primitiveFloatArrayAddScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",a)},primitiveFloatArrayDivFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",a)},primitiveFloatArrayDivScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",a)},primitiveFloatArrayHash:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveHash",a)},primitiveFloatArrayAtPut:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",a)},primitiveFloatArrayMulScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",a)},primitiveFloatArrayAddFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",a)},primitiveFloatArraySubScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",a)},primitiveFloatArraySubFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin",
"primitiveSubFloatArray",a)},primitiveFloatArrayEqual:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",a)},primitiveFloatArrayDotProduct:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",a)},m23PrimitiveInvertRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",a)},m23PrimitiveTransformPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",a)},m23PrimitiveIsPureTranslation:function(a){return this.namedPrimitive("Matrix2x3Plugin",
"primitiveIsPureTranslation",a)},m23PrimitiveComposeMatrix:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",a)},m23PrimitiveTransformRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",a)},m23PrimitiveIsIdentity:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",a)},m23PrimitiveInvertPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",a)},primitiveDeflateBlock:function(a){return this.namedPrimitive("ZipPlugin",
"primitiveDeflateBlock",a)},primitiveDeflateUpdateHashTable:function(a){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",a)},primitiveUpdateGZipCrc32:function(a){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",a)},primitiveInflateDecompressBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",a)},primitiveZipSendBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",a)},primitiveFFTTransformData:function(a){return this.namedPrimitive("FFTPlugin",
"primitiveFFTTransformData",a)},primitiveFFTScaleData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",a)},primitiveFFTPermuteData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",a)},gePrimitiveMergeFillFrom:function(a){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",a)},gePrimitiveCopyBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",a)},gePrimitiveAddRect:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveAddRect",a)},gePrimitiveAddGradientFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",a)},gePrimitiveSetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",a)},gePrimitiveSetBitBltPlugin:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",a)},gePrimitiveRegisterExternalEdge:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",a)},gePrimitiveGetClipRect:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveGetClipRect",a)},gePrimitiveAddBezier:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",a)},gePrimitiveInitializeProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",a)},gePrimitiveRenderImage:function(a){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",a)},gePrimitiveGetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",a)},gePrimitiveSetDepth:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveSetDepth",a)},gePrimitiveAddBezierShape:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",a)},gePrimitiveSetEdgeTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",a)},gePrimitiveGetTimes:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",a)},gePrimitiveNextActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",a)},gePrimitiveAddBitmapFill:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveAddBitmapFill",a)},gePrimitiveGetDepth:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",a)},gePrimitiveAbortProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",a)},gePrimitiveNextGlobalEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",a)},gePrimitiveGetFailureReason:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",a)},gePrimitiveDisplaySpanBuffer:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveDisplaySpanBuffer",a)},gePrimitiveGetCounts:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",a)},gePrimitiveChangedActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",a)},gePrimitiveRenderScanline:function(a){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",a)},gePrimitiveGetBezierStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",a)},gePrimitiveFinishedProcessing:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveFinishedProcessing",a)},gePrimitiveNeedsFlush:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",a)},gePrimitiveAddLine:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddLine",a)},gePrimitiveSetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",a)},gePrimitiveNextFillEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",a)},gePrimitiveInitializeBuffer:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveInitializeBuffer",a)},gePrimitiveDoProfileStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",a)},gePrimitiveAddActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",a)},gePrimitiveSetAALevel:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",a)},gePrimitiveNeedsFlushPut:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",a)},gePrimitiveAddCompressedShape:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveAddCompressedShape",a)},gePrimitiveSetColorTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",a)},gePrimitiveAddOval:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddOval",a)},gePrimitiveRegisterExternalFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",a)},gePrimitiveAddPolygon:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",a)},gePrimitiveGetAALevel:function(a){return this.namedPrimitive("B2DPlugin",
"primitiveGetAALevel",a)}});Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(a){this.vm=a;this.remappableOops=[];Object.defineProperty(this,"successFlag",{get:function(){return a.primHandler.success},set:function(b){a.primHandler.success=b}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=
!1},primitiveFailFor:function(a){this.successFlag=!1},success:function(a){a||(this.successFlag=!1)}},"stack access",{pop:function(a){this.vm.popN(a)},popthenPush:function(a,b){this.vm.popNandPush(a,b)},push:function(a){this.vm.push(a)},pushBool:function(a){this.vm.push(a?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(a){this.vm.push(a)},pushFloat:function(a){this.vm.push(this.floatObjectOf(a))},stackValue:function(a){return this.vm.stackValue(a)},stackIntegerValue:function(a){a=this.vm.stackValue(a);
if("number"===typeof a)return a;this.successFlag=!1;return 0},stackFloatValue:function(a){this.vm.success=!0;a=this.vm.stackIntOrFloat(a);if(this.vm.success)return a;this.successFlag=!1;return 0},stackObjectValue:function(a){a=this.vm.stackValue(a);if("number"!==typeof a)return a;this.successFlag=!1;return this.vm.nilObj},stackBytes:function(a){a=this.vm.stackValue(a);if(a.bytes)return a.bytes;"number"!==typeof a&&a.isBytes()||(this.successFlag=!1);return[]},stackWords:function(a){a=this.vm.stackValue(a);
if(a.words)return a.words;"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackInt32Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsInt32Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackInt16Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsInt16Array();"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]},stackUint16Array:function(a){a=this.vm.stackValue(a);if(a.words)return a.wordsAsUint16Array();
"number"!==typeof a&&a.isWords()||(this.successFlag=!1);return[]}},"object access",{isBytes:function(a){return"number"!==typeof a&&a.isBytes()},isWords:function(a){return"number"!==typeof a&&a.isWords()},isWordsOrBytes:function(a){return"number"!==typeof a&&a.isWordsOrBytes()},isPointers:function(a){return"number"!==typeof a&&a.isPointers()},isIntegerValue:function(a){return"number"===typeof a&&-1073741824<=a&&1073741823>=a},isArray:function(a){return a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},
isMemberOf:function(a,b){var c=a.sqClass.pointers[Squeak.Class_name].bytes;if(b.length!==c.length)return!1;for(var e=0;e<b.length;e++)if(b.charCodeAt(e)!==c[e])return!1;return!0},booleanValueOf:function(a){return a.isTrue?!0:a.isFalse?!1:this.successFlag=!1},positive32BitValueOf:function(a){return this.vm.primHandler.positive32BitValueOf(a)},positive32BitIntegerFor:function(a){return this.vm.primHandler.pos32BitIntFor(a)},floatValueOf:function(a){if(a.isFloat)return a["float"];this.successFlag=!1;
return 0},floatObjectOf:function(a){return this.vm.primHandler.makeFloat(a)},fetchPointerofObject:function(a,b){return b.pointers[a]},fetchBytesofObject:function(a,b){var c=b.pointers[a];if(c.bytes)return c.bytes;if(c.words)return c.wordsAsUint8Array();"number"!==typeof c&&c.isWordsOrBytes()||(this.successFlag=!1);return[]},fetchWordsofObject:function(a,b){var c=b.pointers[a];if(c.words)return c.words;"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchInt32ArrayofObject:function(a,
b){var c=b.pointers[a];if(c.words)return c.wordsAsInt32Array();"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchInt16ArrayofObject:function(a,b){var c=b.pointers[a];if(c.words)return c.wordsAsInt16Array();"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchUint16ArrayofObject:function(a,b){var c=b.pointers[a];if(c.words)return c.wordsAsUint16Array();"number"!==typeof c&&c.isWords()||(this.successFlag=!1);return[]},fetchIntegerofObject:function(a,b){var c=b.pointers[a];
if("number"===typeof c)return c;this.successFlag=!1;return 0},fetchLong32ofObject:function(a,b){return b.words[a]},fetchFloatofObject:function(a,b){return this.floatValueOf(b.pointers[a])},storeIntegerofObjectwithValue:function(a,b,c){"number"===typeof c?b.pointers[a]=c:this.successFlag=!1},storePointerofObjectwithValue:function(a,b,c){b.pointers[a]=c},stObjectatput:function(a,b,c){if(a.sqClass!==this.classArray())throw Error("Array expected");if(1>b||b>=a.pointers.length)return this.successFlag=
!1;a.pointers[b]=c}},"constant access",{isKindOfInteger:function(a){return"number"===typeof a||a.sqClass==this.classLargeNegativeInteger()||a.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},
classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{instantiateClassindexableSize:function(a,b){return this.vm.instantiateClass(a,b)},
methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(a,b){return this.vm.primHandler.makePointWithXandY(a,b)},pushRemappableOop:function(a){this.remappableOops.push(a)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(a,b,c,e,g){b<e&&c<g&&this.vm.primHandler.displayDirty(a,{left:b,top:c,right:e,bottom:g})},ioLoadFunctionFrom:function(a,b){return this.vm.primHandler.loadFunctionFrom(a,b)}});Object.subclass("Squeak.InstructionPrinter",
"initialization",{initialize:function(a,b){this.method=a;this.vm=b}},"printing",{printInstructions:function(a,b,c){this.indent=a;this.highlight=b;this.highlightPC=c;this.innerIndents={};this.result="";this.scanner=new Squeak.InstructionStream(this.method,this.vm);this.oldPC=this.scanner.pc;this.endPC=0;for(this.done=!1;!this.done;)this.scanner.interpretNextInstructionFor(this);return this.result},print:function(a){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&
(this.result+=this.indent);this.result+=this.oldPC;for(var b=0;b<this.innerIndents[this.oldPC];b++)this.result+="   ";this.result+=" <";for(b=this.oldPC;b<this.scanner.pc;b++)b>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[b]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+a+"\n";this.oldPC=this.scanner.pc}},"decoding",{blockReturnTop:function(){this.print("blockReturn")},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(a){this.print("jumpTo: "+
(this.scanner.pc+a));this.scanner.pc+a>this.endPC&&(this.endPC=this.scanner.pc+a)},jumpIf:function(a,b){this.print((a?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+b));this.scanner.pc+b>this.endPC&&(this.endPC=this.scanner.pc+b)},methodReturnReceiver:function(){this.print("return: receiver");this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack");this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(a){this.print("returnConst: "+a.toString());
this.done=this.scanner.pc>this.endPC},popIntoLiteralVariable:function(a){this.print("popIntoBinding: "+a.assnKeyAsString())},popIntoReceiverVariable:function(a){this.print("popIntoInstVar: "+a)},popIntoTemporaryVariable:function(a){this.print("popIntoTemp: "+a)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(a){a=a.sqInstName?a.sqInstName():a.toString();this.print("pushConst: "+a)},pushLiteralVariable:function(a){this.print("pushBinding: "+a.assnKeyAsString())},
pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(a){this.print("pushInstVar: "+a)},pushTemporaryVariable:function(a){this.print("pushTemp: "+a)},send:function(a,b,c){this.print((c?"superSend: #":"send: #")+(a.bytesAsString?a.bytesAsString():a))},storeIntoLiteralVariable:function(a){this.print("storeIntoBinding: "+a.assnKeyAsString())},storeIntoReceiverVariable:function(a){this.print("storeIntoInstVar: "+a)},storeIntoTemporaryVariable:function(a){this.print("storeIntoTemp: "+
a)},pushNewArray:function(a){this.print("push: (Array new: "+a+")")},popIntoNewArray:function(a){this.print("pop: "+a+" into: (Array new: "+a+")")},pushRemoteTemp:function(a,b){this.print("push: "+a+" ofTemp: "+b)},storeIntoRemoteTemp:function(a,b){this.print("storeInto: "+a+" ofTemp: "+b)},popIntoRemoteTemp:function(a,b){this.print("popInto: "+a+" ofTemp: "+b)},pushClosureCopy:function(a,b,c){var e=this.scanner.pc;c=e+c;this.print("closure("+e+"-"+(c-1)+"): "+a+" copied, "+b+" args");for(a=e;a<c;a++)this.innerIndents[a]=
(this.innerIndents[a]||0)+1;c>this.endPC&&(this.endPC=c)},callPrimitive:function(a){this.print("primitive: "+a)}});Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(a,b){this.vm=b;this.method=a;this.pc=0;this.specialConstants=[b.trueObj,b.falseObj,b.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(a){var b=this.method,c=b.bytes[this.pc++],e=c/16|0,g=c%16;if(0===e)return a.pushReceiverVariable(g);if(1===e)return a.pushTemporaryVariable(g);if(2===e)return a.pushConstant(b.methodGetLiteral(g));
if(3===e)return a.pushConstant(b.methodGetLiteral(g+16));if(4===e)return a.pushLiteralVariable(b.methodGetLiteral(g));if(5===e)return a.pushLiteralVariable(b.methodGetLiteral(g+16));if(6===e)return 8>g?a.popIntoReceiverVariable(g):a.popIntoTemporaryVariable(g-8);if(7===e){if(0===g)return a.pushReceiver();if(8>g)return a.pushConstant(this.specialConstants[g-1]);if(8===g)return a.methodReturnReceiver();if(12>g)return a.methodReturnConstant(this.specialConstants[g-9]);if(12===g)return a.methodReturnTop();
if(13===g)return a.blockReturnTop();if(13<g)throw Error("unusedBytecode");}if(8===e)return this.interpretExtension(g,b,a);if(9===e)return 8>g?a.jump(g+1):a.jumpIf(!1,g-8+1);if(10===e)return c=this.method.bytes[this.pc++],8>g?a.jump(256*(g-4)+c):a.jumpIf(12>g,256*(g&3)+c);if(11===e)return a.send(this.vm.specialSelectors[2*g],this.vm.specialSelectors[2*g+1],!1);if(12===e)return a.send(this.vm.specialSelectors[2*(g+16)],this.vm.specialSelectors[2*(g+16)+1],!1);if(12<e)return a.send(b.methodGetLiteral(g),
e-13,!1)},interpretExtension:function(a,b,c){if(6>=a){b=this.method.bytes[this.pc++];if(2>=a){var e=b/64|0,g=b%64;if(0===a){if(0===e)return c.pushReceiverVariable(g);if(1===e)return c.pushTemporaryVariable(g);if(2===e)return c.pushConstant(this.method.methodGetLiteral(g));if(3===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g))}if(1===a){if(0===e)return c.storeIntoReceiverVariable(g);if(1===e)return c.storeIntoTemporaryVariable(g);if(2===e)throw Error("illegalStore");if(3===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(2===
a){if(0===e)return c.popIntoReceiverVariable(g);if(1===e)return c.popIntoTemporaryVariable(g);if(2===e)throw Error("illegalStore");if(3===e)return c.popIntoLiteralVariable(this.method.methodGetLiteral(g))}}if(3===a)return c.send(this.method.methodGetLiteral(b%32),b/32|0,!1);if(4===a){g=this.method.bytes[this.pc++];e=b/32|0;if(0===e)return c.send(this.method.methodGetLiteral(g),b%32,!1);if(1===e)return c.send(this.method.methodGetLiteral(g),b%32,!0);if(2===e)return c.pushReceiverVariable(g);if(3===
e)return c.pushConstant(this.method.methodGetLiteral(g));if(4===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g));if(5===e)return c.storeIntoReceiverVariable(g);if(6===e)return c.popIntoReceiverVariable(g);if(7===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(5===a)return c.send(this.method.methodGetLiteral(b&31),b>>5,!0);if(6===a)return c.send(this.method.methodGetLiteral(b&63),b>>6,!1)}if(7===a)return c.doPop();if(8===a)return c.doDup();if(9===a)return c.pushActiveContext();
b=this.method.bytes[this.pc++];if(10===a)return 128>b?c.pushNewArray(b):c.popIntoNewArray(b-128);g=this.method.bytes[this.pc++];if(11===a)return c.callPrimitive(b+256*g);if(12===a)return c.pushRemoteTemp(b,g);if(13===a)return c.storeIntoRemoteTemp(b,g);if(14===a)return c.popIntoRemoteTemp(b,g);a=this.method.bytes[this.pc++];return c.pushClosureCopy(b>>4,b&15,256*g+a)}})});module("users.bert.SqueakJS.jit").requires("users.bert.SqueakJS.vm").toRun(function(){Object.subclass("Squeak.Compiler","initialization",{initialize:function(n){this.vm=n;this.comments=!!Squeak.Compiler.comments;this.specialSelectors="+ - < > <= >= = ~= * / \\ @ bitShift: // bitAnd: bitOr: at: at:put: size next nextPut: atEnd == class blockCopy: value value: do: new new: x y".split(" ")}},"accessing",{compile:function(n,a,b){n.isHot?(this.singleStep=!1,this.debug=this.comments,a=a&&a.className(),
b=b&&b.bytesAsString(),n.compiled=this.generate(n,a,b)):n.isHot=!0},enableSingleStepping:function(n,a,b){n.compiled&&n.compiled.canSingleStep||(this.debug=this.singleStep=!0,a=this.vm.printMethod(n,a,b).split(">>"),n.compiled=this.generate(n,a[0],a[1]),n.compiled.canSingleStep=!0);return!0},functionNameFor:function(n,a){if(!n||!a)return"Squeak_DOIT";if(!/[^a-zA-Z0-9:_]/.test(a))return(n+"_"+a).replace(/[: ]/g,"_");var b=a.replace(/./g,function(a){return{"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT",
"&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[a]||"OPERATOR"});return n.replace(/[ ]/,"_")+"__"+b+"__"}},"generating",{generate:function(n,a,b){this.method=n;this.prevPC=this.endPC=this.pc=0;this.source=[];this.sourceLabels={};this.needsLabel={0:!0};this.needsBreak=!1;a&&b&&this.source.push("// ",a,">>",b,"\n");this.source.push("var context = vm.activeContext,\n","    stack = context.pointers,\n","    rcvr = vm.receiver,\n","    inst = rcvr.pointers,\n",
"    temp = vm.homeContext.pointers,\n","    lit = vm.method.pointers,\n","    bytecodes = 0 - vm.pc;\n","while (true) switch (vm.pc) {\n");for(this.done=!1;!this.done;){var c=n.bytes[this.pc++],e;switch(c&248){case 0:case 8:this.generatePush("inst[",c&15,"]");break;case 16:case 24:this.generatePush("temp[",6+(c&15),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(c&31),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(c&31),"].pointers[1]");break;case 96:this.generatePopInto("inst[",
c&7,"]");break;case 104:this.generatePopInto("temp[",6+(c&7),"]");break;case 112:switch(c){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(c){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");
break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode");}break;case 128:case 136:this.generateExtended(c);break;case 144:this.generateJump((c&7)+1);break;case 152:this.generateJumpIf(!1,(c&7)+1);break;case 160:e=n.bytes[this.pc++];this.generateJump(256*((c&7)-4)+e);break;case 168:e=n.bytes[this.pc++];this.generateJumpIf(172>
c,256*(c&3)+e);break;case 176:case 184:this.generateNumericOp(c);break;case 192:case 200:this.generateQuickPrim(c);break;case 208:case 216:this.generateSend("lit[",1+(c&15),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(c&15),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(c&15),"]",2,!1)}}n=this.functionNameFor(a,b);if(this.singleStep)return this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC'); }"),(new Function("return function "+
n+"(vm, singleStep) {\n"+this.source.join("")+"\n}"))();this.debug&&this.source.push("// fall back to single-stepping\n");this.source.push("default: bytecodes += vm.pc; vm.interpretOne(true); return bytecodes;}");this.deleteUnneededLabels();return(new Function("return function "+n+"(vm) {\n"+this.source.join("")+"\n}"))()},generateExtended:function(n){var a;switch(n){case 128:switch(n=this.method.bytes[this.pc++],n>>6){case 0:this.generatePush("inst[",n&63,"]");return;case 1:this.generatePush("temp[",
6+(n&63),"]");return;case 2:this.generatePush("lit[",1+(n&63),"]");return;case 3:this.generatePush("lit[",1+(n&63),"].pointers[1]");return}case 129:n=this.method.bytes[this.pc++];switch(n>>6){case 0:this.generateStoreInto("inst[",n&63,"]");break;case 1:this.generateStoreInto("temp[",6+(n&63),"]");break;case 2:throw Error("illegal store into literal");case 3:this.generateStoreInto("lit[",1+(n&63),"].pointers[1]")}break;case 130:switch(n=this.method.bytes[this.pc++],n>>6){case 0:this.generatePopInto("inst[",
n&63,"]");return;case 1:this.generatePopInto("temp[",6+(n&63),"]");return;case 2:throw Error("illegal pop into literal");case 3:this.generatePopInto("lit[",1+(n&63),"].pointers[1]");return}case 131:n=this.method.bytes[this.pc++];this.generateSend("lit[",1+(n&31),"]",n>>5,!1);break;case 132:switch(n=this.method.bytes[this.pc++],a=this.method.bytes[this.pc++],n>>5){case 0:this.generateSend("lit[",1+a,"]",n&31,!1);return;case 1:this.generateSend("lit[",1+a,"]",n&31,!0);return;case 2:this.generatePush("inst[",
a,"]");return;case 3:this.generatePush("lit[",1+a,"]");return;case 4:this.generatePush("lit[",1+a,"].pointers[1]");return;case 5:this.generateStoreInto("inst[",a,"]");return;case 6:this.generatePopInto("inst[",a,"]");return;case 7:this.generateStoreInto("lit[",1+a,"].pointers[1]");return}case 133:n=this.method.bytes[this.pc++];this.generateSend("lit[",1+(n&31),"]",n>>5,!0);break;case 134:n=this.method.bytes[this.pc++];this.generateSend("lit[",1+(n&63),"]",n>>6,!1);break;case 135:this.generateInstruction("pop",
"vm.sp--");break;case 136:this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");break;case 137:this.generateInstruction("thisContext","stack[++vm.sp] = vm.exportThisContext()");break;case 138:n=this.method.bytes[this.pc++];this.generateClosureTemps(n&127,127<n);break;case 139:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generateCallPrimitive(n+256*a);break;case 140:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generatePush("temp[",
6+a,"].pointers[",n,"]");break;case 141:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generateStoreInto("temp[",6+a,"].pointers[",n,"]");break;case 142:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];this.generatePopInto("temp[",6+a,"].pointers[",n,"]");break;case 143:n=this.method.bytes[this.pc++];a=this.method.bytes[this.pc++];var b=this.method.bytes[this.pc++];this.generateClosureCopy(n&15,n>>4,a<<8|b)}},generatePush:function(n,a,b,c,e){this.debug&&this.generateDebugCode("push");
this.generateLabel();this.source.push("stack[++vm.sp] = ",n);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(";\n")},generateStoreInto:function(n,a,b,c,e){this.debug&&this.generateDebugCode("store into");this.generateLabel();this.source.push(n);void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(" = stack[vm.sp];\n")},generatePopInto:function(n,a,b,c,e){this.debug&&this.generateDebugCode("pop into");this.generateLabel();this.source.push(n);
void 0!==a&&(this.source.push(a,b),void 0!==c&&this.source.push(c,e));this.source.push(" = stack[vm.sp--];\n")},generateReturn:function(n){this.debug&&this.generateDebugCode("return");this.generateLabel();this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",n,"); return bytecodes + ",this.pc,";\n");this.needsBreak=!1;this.done=this.pc>this.endPC},generateBlockReturn:function(){this.debug&&this.generateDebugCode("block return");this.generateLabel();this.source.push("vm.pc = ",this.pc,"; vm.doReturn(stack[vm.sp--], context.pointers[0]); return bytecodes + ",
this.pc,";\n");this.needsBreak=!1},generateJump:function(n){var a=this.pc+n;this.debug&&this.generateDebugCode("jump to "+a);this.generateLabel();this.source.push("vm.pc = ",a,"; ");0>n?this.source.push("bytecodes += ",-n,"; "):this.source.push("bytecodes -= ",n,"; ");0>n&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",a,";\n","}\n");this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return bytecodes + ",
a,";\n");this.source.push("continue;\n");this.needsBreak=!1;this.needsLabel[a]=!0;a>this.endPC&&(this.endPC=a)},generateJumpIf:function(n,a){var b=this.pc+a;this.debug&&this.generateDebugCode("jump if "+n+" to "+b);this.generateLabel();this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",n,"Obj) {vm.pc = ",b,"; bytecodes -= ",a,"; ");this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",b,"; else ");this.source.push("continue}\n","else if (cond !== vm.",!n,
"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return bytecodes + ",this.pc,"}\n");this.needsLabel[this.pc]=!0;this.needsLabel[b]=!0;b>this.endPC&&(this.endPC=b)},generateQuickPrim:function(n){this.debug&&this.generateDebugCode("quick prim "+this.specialSelectors[(n&15)+16]);this.generateLabel();switch(n){case 194:this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n",
"else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"; }\n");this.needsLabel[this.pc]=!0;return;case 198:this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");return;case 199:this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");return;case 200:this.source.push("vm.pc = ",this.pc,
"; if (!vm.primHandler.quickSendOther(rcvr, ",n&15,")) ","{vm.sendSpecial(",(n&15)+16,"); return bytecodes + ",this.pc,"}\n");this.needsLabel[this.pc]=!0;this.needsLabel[this.pc+2]=!0;return;case 201:case 202:case 203:this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",n&15,")) vm.sendSpecial(",(n&15)+16,"); return bytecodes + ",this.pc,";\n");this.needsLabel[this.pc]=!0;return}this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",n&15,"))",
" vm.sendSpecial(",(n&15)+16,");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n","if (vm.pc !== ",this.pc,") throw Error('Huh?');\n");this.needsBreak=!1;this.needsLabel[this.pc]=!0},generateNumericOp:function(n){this.debug&&this.generateDebugCode("numeric op "+this.specialSelectors[n&15]);this.generateLabel();this.needsLabel[this.pc]=!0;switch(n){case 176:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n",
"   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");break;case 177:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",
this.pc,"}\n");break;case 178:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");break;case 179:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n",
"   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");break;case 180:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",
this.pc,"}\n");break;case 181:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");break;case 182:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n",
"   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");break;case 183:this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n",
"} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");break;case 184:this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(8); return bytecodes + ",this.pc,"}\n");break;case 185:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",
this.pc,"; vm.sendSpecial(9); return bytecodes + ",this.pc,"}\n");break;case 186:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return bytecodes + ",this.pc,"}\n");break;case 187:this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",this.pc,"; vm.sendSpecial(11); return bytecodes + ",this.pc,"}\n");break;case 188:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",
this.pc,"; vm.sendSpecial(12); return bytecodes + ",this.pc,"}\n");break;case 189:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return bytecodes + ",this.pc,"}\n");break;case 190:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(14); return bytecodes + ",this.pc,"}\n");break;case 191:this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",
this.pc,"; vm.sendSpecial(15); return bytecodes + ",this.pc,"}\n")}},generateSend:function(n,a,b,c,e){this.debug&&this.generateDebugCode("send "+("lit["===n?this.method.pointers[a].bytesAsString():"..."));this.generateLabel();this.source.push("vm.pc = ",this.pc,"; vm.send(",n,a,b,", ",c,", ",e,"); ","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n");this.needsBreak=!1;this.needsLabel[this.pc]=!0},generateClosureTemps:function(n,a){this.debug&&
this.generateDebugCode("closure temps");this.generateLabel();this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",n,");\n");if(a){for(var b=0;b<n;b++)this.source.push("array.pointers[",b,"] = stack[vm.sp - ",n-b-1,"];\n");this.source.push("stack[vm.sp -= ",n-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(n,a,b){var c=this.pc,e=c+b;this.debug&&this.generateDebugCode("push closure("+c+"-"+(e-1)+"): "+a+" copied, "+n+" args");this.generateLabel();
this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",a,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",c+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",n,";\n");if(0<a){for(n=0;n<a;n++)this.source.push("closure.pointers[",n+3,"] = stack[vm.sp - ",a-n-1,"];\n");this.source.push("stack[vm.sp -= ",a-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",e,";\n");this.source.push("bytecodes -= ",
b,";\n");this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",e,";\n");this.source.push("continue;\n");this.needsBreak=!1;this.needsLabel[c]=!0;this.needsLabel[e]=!0;e>this.endPC&&(this.endPC=e)},generateCallPrimitive:function(n){this.debug&&this.generateDebugCode("call primitive "+n);this.generateLabel();if(3!==this.pc)throw Error("call primitive bytecode not expected here");},generateLabel:function(){this.sourceLabels[this.prevPC]=this.source.length;this.source.push("case ",
this.prevPC,":\n");this.prevPC=this.pc},generateDebugCode:function(n){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + (vm.pc = ",this.prevPC,");\n"),this.needsLabel[this.prevPC]=!0);for(var a=[],b=this.prevPC;b<this.pc;b++)a.push((this.method.bytes[b]+256).toString(16).slice(-2).toUpperCase());this.source.push("// ",this.prevPC," <",a.join(" "),"> ",n,"\n");this.needsBreak=this.singleStep},generateInstruction:function(n,a){this.debug&&this.generateDebugCode(n);
this.generateLabel();this.source.push(a,";\n")},deleteUnneededLabels:function(){for(var n in this.sourceLabels)if(!this.needsLabel[n])for(var a=0;3>a;a++)this.source[this.sourceLabels[n]+a]=""}})});module("users.bert.SqueakJS.plugins.ADPCMCodecPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,b){return 31<b?0:a>>>b}function a(a){var b,d;for(b=0;;)if(d=a-c,0<d)b+=31<d?0:g<<d,a-=c,g=k[++e-1],c=8;else return b+=n(g,0-d),c-=a,g&=n(255,8-c),b}function b(a,b){var d,f,m,h;f=b;for(m=a;;)if(d=8-c,h=d-m,0>h)g+=n(f,0-h),k[++e-1]=g,g=c=0,h=0-h,f&=(31<h?0:1<<h)-1,m-=d;else return g+=31<h?0:f<<h,c+=m,self}var c=0,e=0,g=0,k=null,f=null,d=null;Squeak.registerExternalModule("ADPCMCodecPlugin",
{primitiveDecodeStereo:function(){var b,n,x,q,m,h,t,B,l,u,y,G,w,L,I,E,K,H,C,D,v,N,Q,M,O;b=f.stackValue(1);n=f.stackIntegerValue(0);N=f.fetchInt16ArrayofObject(0,b);D=f.fetchInt16ArrayofObject(1,b);E=f.fetchIntegerofObject(2,b);H=f.fetchIntegerofObject(3,b);K=f.fetchIntegerofObject(4,b);C=f.fetchIntegerofObject(5,b);g=f.fetchIntegerofObject(6,b);c=f.fetchIntegerofObject(7,b);e=f.fetchIntegerofObject(8,b);k=f.fetchBytesofObject(9,b);O=f.fetchInt16ArrayofObject(10,b);Q=f.fetchInt16ArrayofObject(11,b);
M=f.fetchIntegerofObject(12,b);I=f.fetchIntegerofObject(13,b);d=f.fetchInt16ArrayofObject(14,b);v=f.fetchInt16ArrayofObject(15,b);if(f.failed())return null;y=N[0];G=N[1];t=D[0];B=D[1];for(h=1;h<=n;h++){if(1===(h&C))y=a(16),t=a(6),G=a(16),B=a(6),32767<y&&(y-=65536),32767<G&&(G-=65536);else{q=a(I);m=a(I);w=d[t];L=d[B];l=u=0;for(x=K;0<x;)0<(q&x)&&(l+=w),0<(m&x)&&(u+=L),w>>>=1,L>>>=1,x>>>=1;l+=w;u+=L;y=0<(q&E)?y-l:y+l;G=0<(m&E)?G-u:G+u;32767<y?y=32767:-32768>y&&(y=-32768);32767<G?G=32767:-32768>G&&(G=
-32768);t+=v[q&H];0>t?t=0:88<t&&(t=88);B+=v[m&H];0>B?B=0:88<B&&(B=88)}O[++M-1]=y;Q[M-1]=G}N[0]=y;N[1]=G;D[0]=t;D[1]=B;if(f.failed())return null;f.storeIntegerofObjectwithValue(6,b,g);f.storeIntegerofObjectwithValue(7,b,c);f.storeIntegerofObjectwithValue(8,b,e);f.storeIntegerofObjectwithValue(12,b,M);f.pop(1)},primitiveEncodeStereo:function(){var a;a=f.stackValue(1);f.stackIntegerValue(0);g=f.fetchIntegerofObject(6,a);c=f.fetchIntegerofObject(7,a);e=f.fetchIntegerofObject(8,a);k=f.fetchIntegerofObject(9,
a);d=f.fetchIntegerofObject(14,a);if(f.failed())return null;success(!1);if(f.failed())return null;f.storeIntegerofObjectwithValue(6,a,g);f.storeIntegerofObjectwithValue(7,a,c);f.storeIntegerofObjectwithValue(8,a,e);f.pop(1)},setInterpreter:function(a){f=a;a=1==f.majorVersion();return!1===a?!1:a=11<=f.minorVersion()},primitiveEncodeMono:function(){var a,n,x,q,m,h,t,B,l,u,y,G,w,L,I,E,K,H,C;a=f.stackValue(1);n=f.stackIntegerValue(0);K=f.fetchIntegerofObject(0,a);I=f.fetchIntegerofObject(1,a);G=f.fetchIntegerofObject(2,
a);w=f.fetchIntegerofObject(4,a);L=f.fetchIntegerofObject(5,a);g=f.fetchIntegerofObject(6,a);c=f.fetchIntegerofObject(7,a);e=f.fetchIntegerofObject(8,a);k=f.fetchBytesofObject(9,a);C=f.fetchInt16ArrayofObject(10,a);H=f.fetchIntegerofObject(12,a);y=f.fetchIntegerofObject(13,a);d=f.fetchInt16ArrayofObject(14,a);E=f.fetchInt16ArrayofObject(15,a);if(f.failed())return null;u=d[0];for(h=1;h<=n;h++)if(1===(h&L)){K=C[++H-1];0>(t=K)&&(t+=65536);b(16,t);if(h<n){q=C[H]-K;0>q&&(q=0-q);x=63;for(m=1;62>=m;m++)63===
x&&d[m-1]>=q&&(x=m);I=x}b(6,I)}else{l=0;m=C[++H-1]-K;0>m&&(l=G,m=0-m);B=q=0;for(x=w;0<x;)m>=u&&(q+=x,B+=u,m-=u),u>>>=1,x>>>=1;B+=u;K=0<l?K-B:K+B;32767<K?K=32767:-32768>K&&(K=-32768);I+=E[q];0>I?I=0:88<I&&(I=88);u=d[I];b(y,l|q)}0<c&&(k[++e-1]=g);if(f.failed())return null;f.storeIntegerofObjectwithValue(0,a,K);f.storeIntegerofObjectwithValue(1,a,I);f.storeIntegerofObjectwithValue(6,a,g);f.storeIntegerofObjectwithValue(7,a,c);f.storeIntegerofObjectwithValue(8,a,e);f.storeIntegerofObjectwithValue(12,
a,H);f.pop(1)},primitiveDecodeMono:function(){var b,n,x,q,m,h,t,B,l,u,y,G,w,L,I,E,K;b=f.stackValue(1);n=f.stackIntegerValue(0);I=f.fetchIntegerofObject(0,b);w=f.fetchIntegerofObject(1,b);l=f.fetchIntegerofObject(2,b);y=f.fetchIntegerofObject(3,b);u=f.fetchIntegerofObject(4,b);G=f.fetchIntegerofObject(5,b);g=f.fetchIntegerofObject(6,b);c=f.fetchIntegerofObject(7,b);e=f.fetchIntegerofObject(8,b);k=f.fetchBytesofObject(9,b);K=f.fetchInt16ArrayofObject(10,b);E=f.fetchIntegerofObject(12,b);B=f.fetchIntegerofObject(13,
b);d=f.fetchInt16ArrayofObject(14,b);L=f.fetchInt16ArrayofObject(15,b);if(f.failed())return null;for(m=1;m<=n;m++){if(1===(m&G))I=a(16),32767<I&&(I-=65536),w=a(6);else{q=a(B);t=d[w];h=0;for(x=u;0<x;)0<(q&x)&&(h+=t),t>>>=1,x>>>=1;h+=t;I=0<(q&l)?I-h:I+h;32767<I?I=32767:-32768>I&&(I=-32768);w+=L[q&y];0>w?w=0:88<w&&(w=88)}K[++E-1]=I}if(f.failed())return null;f.storeIntegerofObjectwithValue(0,b,I);f.storeIntegerofObjectwithValue(1,b,w);f.storeIntegerofObjectwithValue(6,b,g);f.storeIntegerofObjectwithValue(7,
b,c);f.storeIntegerofObjectwithValue(8,b,e);f.storeIntegerofObjectwithValue(12,b,E);f.pop(1)},getModuleName:function(){return"ADPCMCodecPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.B2DPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?r.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 31<b?0:a<<b}function c(a,b){return 31<b?0:a>>>b}function e(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function g(a,b){return new Float32Array(a.buffer,a.byteOffset+4*b)}function k(a,b){var d;d=a+z[48]-
1&~(z[48]-1);return d>b?b:d}function f(){return z[49]}function d(a,b){if(0===a)return 0>b?0-b:b;if(0===b)return 0>a?0-a:a;var d;d=a*a+b*b;d=32>d?[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6][d]:Math.sqrt(d)+.5|0;return d}function p(a){if(!x(1))return 0;Ea[z[12]]=a;z[12]+=1}function A(){Pb(6);return qa()}function x(a){var b,d,c,h;if(!Ka(a))return!1;if(0!==z[14])for(c=z[14],b=z[14]+a,d=1,h=z[14];d<=h;d++)S[--b]=S[--c];S=e(S,a);return!0}function q(a){var b,d,c,h;if(!x(a))return!1;
if(0!==z[12])for(c=z[12],b=z[12]+a,d=1,h=z[12];d<=h;d++)Ea[--b]=Ea[--c];Ea=e(Ea,a);return!0}function m(a,b,d){if(b>d){if(a>b)return b;if(a<d)return d}else{if(a<b)return b;if(a>d)return d}return a}function h(a){return e(F,a+10)}function t(a,d,h,l){var f,m,t;f=F[a+12];m=F[a+14];if(32===f)return d=d[m*l+h]|0,0!==d&&0===(d&4278190080)&&(d|=4278190080),$a(d);t=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1][f];d=d[m*l+c(h,t)];l=b(1,f)-1;t=32-f-(h&b(1,t)-1)*f;d=c(d,t)&l;16===f?0!==d&&(a=(d&31)<<3,h=(d>>>5&31)<<3,f=
(d>>>10&31)<<3,d=a+(a>>>5)+(h+(h>>>5)<<8)+(f+(f>>>5)<<16)+-16777216):d=0===F[a+15]?0:e(F,a+18)[d];return $a(d)}function B(a){return Aa(qa()-a+4)}function l(a,b){return Ab(qa()-a+4,b)}function u(a){return Aa(qa()-a+5)}function y(a,b){return Ab(qa()-a+5,b)}function G(a){return Aa(qa()-a+0)}function w(a,b){return Ab(qa()-a+0,b)}function L(a){return Aa(qa()-a+1)}function I(a,b){return Ab(qa()-a+1,b)}function E(a){return Aa(qa()-a+2)}function K(a,b){return Ab(qa()-a+2,b)}function H(a){return Aa(qa()-a+
3)}function C(a,b){return Ab(qa()-a+3,b)}function D(b,d,c){var h,e,l,f,m;e=a(b);b=b.wordsAsInt32Array();for(h=l=0;h<=e-1;h++){f=(b[h]|0)>>>16;m=(b[h]|0)&65535;if(!(0<=m&&m<=d))return!1;l+=f}return l===c}function v(){return[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,
-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1]}function N(){return[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,
-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0]}function Q(a,b){return 0>a?0:a>=b?b-1:a}function M(){var a,b;a=c(z[32],f());b=c(z[34],f())+1;0>a&&(a=0);for(b>z[33]&&(b=z[33]);a<b;)ba[a]=0,++a;z[32]=z[33];z[34]=0}function O(a,b){var d,c,h,e,f,t,g,k,N,n,q;h=k=G(a);e=f=L(a);t=n=E(a);g=q=H(a);d=B(a);c=u(a);k=h+=(n-k)*b|0;N=e+=(q-
f)*b|0;t+=(d-n)*b|0;g+=(c-q)*b|0;k+=(t-h)*b|0;N+=(g-e)*b|0;e=m(e,f,N);g=m(g,N,c);f=A();if(aa)return 0;K(a,h);C(a,e);l(a,k);y(a,N);w(f,k);I(f,N);K(f,t);C(f,g);l(f,d);y(f,c);return f}function V(a){var b,d,c,h,e,f,m,t,g,k,N;e=A();if(aa)return 0;c=t=G(a);h=k=L(a);f=N=E(a);m=g=H(a);b=B(a);d=u(a);c+=N-t>>1;h+=g-k>>1;t=f+=b-N>>1;g=m+=d-g>>1;t+=c-f>>1;g+=h-m>>1;K(a,c);C(a,h);l(a,t);y(a,g);w(e,t);I(e,g);K(e,f);C(e,m);l(e,b);y(e,d);return e}function X(a,b){var d,c,e;d=h(a)[0]>>8;c=Na(a)[0]>>8;d>c&&(e=d,d=c,
c=e);Z(a,d);c-d>b?F[a+17]=c-d:F[a+17]=b}function P(){return z[88]}function ta(a){var b,d;b=c(z[32],f());b<z[42]&&(b=z[42]);d=c(z[34]+z[48]-1,f());d>z[43]&&(d=z[43]);a=c(a,f());if(a<z[44]||a>=z[45]||d<z[42]||b>=z[43])return 0;(rb||lb())&&rb(b,d,a)}function U(a){return F[a+4]}function Z(a,b){return F[a+4]=b}function T(a,b){return F[a+5]=b}function xa(a,b){var d,c,h;R();c=a;for(h=db();h<b;){d=R();if(0!==d&&La(d,c,h))return!0;gc(h);c=h;h=db()}d=R();return 0!==d?La(d,c,b):!1}function la(a,b,d){var h;if(1!==
z[48]){var e,l,m,t,g;l=k(b,d);t=d-1&~(z[48]-1);h=z[48];e=f();if(b<l)for(g=c(a&z[51],z[50]);b<l;)m=c(b,e),ba[m]+=g,++b;if(b<t)for(l=c(z[51],f())|4042322160,g=c(a&l,f());b<t;)m=c(b,e),ba[m]+=g,b+=h;if(b<d)for(g=c(a&z[51],z[50]);b<d;)m=c(b,e),ba[m]+=g,++b}else{for(h=b;h+4<d;)ba[h]=a,ba[h+1]=a,ba[h+2]=a,ba[h+3]=a,h+=4;for(;h<d;)ba[h]=a,++h}}function wa(a,b){var d;d=Aa(a+1)-Aa(b+1);return 0!==d?0<d:Aa(a)>>>0<Aa(b)>>>0}function La(a,h,l){var m,g,u;if(0===a)return!1;g=h<z[35]?z[35]:h;u=l>b(z[33],f())?b(z[33],
f()):l;g<z[36]&&(g=z[36]);u>z[37]&&(u=z[37]);g<z[32]&&(z[32]=g);u>z[34]&&(z[34]=u);u>z[35]&&(z[35]=u);if(g>=u)return!1;if(0!==(a&4278190080))la(a,g,u);else{z[66]=a;z[67]=g;z[68]=u;m=(sb(a)&65280)>>>8;if(1>=m)return!0;switch(m){case 2:var B=z[66],y=z[67],N=z[68],w=P(),n,q,C,p,v,x;C=e(F,B+12);v=F[B+10];q=F[B+6];n=(y-F[B+4])*q+(w-F[B+5])*F[B+7];for(x=y;(0>(p=n>>16)||p>=v)&&x<N;)++x,n+=q;x>y&&(0>p&&(p=0),p>=v&&(p=v-1),la(C[p],y,x));if(1===z[48])for(;(p=n>>16)<v&&0<=p&&x<N;)ba[x]=C[p],++x,n+=q;else{var r=
n,A=x,G,M,I,O,L,E,ta,D,V,K,H,wa;G=z[48];M=f();K=F[B+10];L=r;wa=A;V=L>>16;E=k(A,N);D=N-1&~(z[48]-1);I=z[51];for(O=z[50];wa<E&&V<K&&0<=V;){H=C[V];for(H=c(H&I,O);wa<E&&L>>16===V;)ta=c(wa,M),ba[ta]+=H,++wa,L+=q;V=L>>16}I=c(z[51],f())|4042322160;for(O=f();wa<D&&V<K&&0<=V;){H=C[V];for(H=c(H&I,O);wa<D&&L>>16===V;)ta=c(wa,M),ba[ta]+=H,wa+=G,L+=b(q,O);V=L>>16}I=z[51];for(O=z[50];wa<N&&V<K&&0<=V;){H=C[V];for(H=c(H&I,O);wa<N&&L>>16===V;)ta=c(wa,M),ba[ta]+=H,++wa,L+=q;V=L>>16}x=wa}x<N&&(0>p&&(p=0),p>=v&&(p=v-
1),la(C[p],x,N));break;case 3:var Kb=z[66],Bc=z[67],Lb=z[68],Jc=P(),xb,Z,U,T,ra,X,J,La,sa,xa,ea;sa=e(F,Kb+12);xa=F[Kb+10];Z=Bc-F[Kb+4];U=Jc-F[Kb+5];ra=F[Kb+6];J=F[Kb+8];T=Z*ra+U*F[Kb+7];X=Z*J+U*F[Kb+9];ea=Bc;for(La=(xa-1)*(xa-1);ga(T>>16,X>>16)>=La&&ea<Lb;)++ea,T+=ra,X+=J;ea>Bc&&la(sa[xa-1],Bc,ea);xb=ca();xb[0]=T;xb[1]=X;if(ea<F[Kb+4])if(1===z[48]){var Ma=ea,W,Sa,lb,R,S,Y,aa,da;W=xb[0]|0;Sa=xb[1]|0;S=d(W>>16,Sa>>16);Y=sa[S];lb=(S-1)*(S-1);aa=Ma;da=Lb;for(da>F[Kb+4]&&(da=F[Kb+4]);aa<da;){for(;aa<da&&
ga(W>>16,Sa>>16)>=lb;)ba[aa]=Y,++aa,W+=ra,Sa+=J;for(R=ga(W>>16,Sa>>16);R<lb;)--S,Y=sa[S],lb=(S-1)*(S-1)}xb[0]=W;xb[1]=Sa;ea=aa}else{var ka=ea,ma,ia,gb,jb,Wa,za,na,ha,pa,fa,qa,ja,va,oa,ya;Wa=xb[0]|0;za=xb[1]|0;ma=z[48];ia=f();ja=d(Wa>>16,za>>16);fa=(ja-1)*(ja-1);oa=ka;ya=F[Kb+4];ya>Lb&&(ya=Lb);na=k(ka,ya);pa=ya-1&~(z[48]-1);if(oa<na)for(gb=z[51],jb=z[50],va=sa[ja],va=c(va&gb,jb);oa<na;){for(;oa<na&&ga(Wa>>16,za>>16)>=fa;)ha=c(oa,ia),ba[ha]+=va,++oa,Wa+=ra,za+=J;for(qa=ga(Wa>>16,za>>16);qa<fa;)--ja,
va=sa[ja],va=c(va&gb,jb),fa=(ja-1)*(ja-1)}if(oa<pa)for(gb=c(z[51],f())|4042322160,jb=f(),va=sa[ja],va=c(va&gb,jb);oa<pa;){for(;oa<pa&&ga(Wa>>16,za>>16)>=fa;)ha=c(oa,ia),ba[ha]+=va,oa+=ma,Wa+=b(ra,jb),za+=b(J,jb);for(qa=ga(Wa>>16,za>>16);qa<fa;)--ja,va=sa[ja],va=c(va&gb,jb),fa=(ja-1)*(ja-1)}if(oa<ya)for(gb=z[51],jb=z[50],va=sa[ja],va=c(va&gb,jb);oa<ya;){for(;oa<ya&&ga(Wa>>16,za>>16)>=fa;)ha=c(oa,ia),ba[ha]+=va,++oa,Wa+=ra,za+=J;for(qa=ga(Wa>>16,za>>16);qa<fa;)--ja,va=sa[ja],va=c(va&gb,jb),fa=(ja-1)*
(ja-1)}xb[0]=Wa;xb[1]=za;ea=oa}if(ea<Lb)if(1===z[48]){var Ja=ea,Aa,eb,Ha,Ta,Pa,Ga,Xa,Ya,Qa;Aa=xb[0]|0;eb=xb[1]|0;Ga=d(Aa>>16,eb>>16);Ya=sa[Ga];Xa=F[Kb+10];Ta=(Xa-1)*(Xa-1);Pa=(Ga+1)*(Ga+1);Ha=ga(Aa>>16,eb>>16);for(Qa=Ja;Qa<Lb&&Ha<Ta;){for(;Qa<Lb&&ga(Aa>>16,eb>>16)<=Pa;)ba[Qa]=Ya,++Qa,Aa+=ra,eb+=J;for(Ha=ga(Aa>>16,eb>>16);Ha>Pa;)++Ga,Ya=sa[Ga],Pa=(Ga+1)*(Ga+1)}xb[0]=Aa;xb[1]=eb;ea=Qa}else{var ab=ea,bb,Za,Na,Ka,Da,Ea,db,Ra,Ia,fb,$a,Va,Ca,mb,pb,hb;Da=xb[0]|0;Ea=xb[1]|0;bb=z[48];Za=f();Ca=d(Da>>16,Ea>>
16);mb=F[Kb+10];$a=(mb-1)*(mb-1);Va=(Ca+1)*(Ca+1);Ia=ga(Da>>16,Ea>>16);hb=ab;db=k(ab,Lb);fb=Lb-1&~(z[48]-1);if(hb<db&&Ia<$a)for(Na=z[51],Ka=z[50],pb=sa[Ca],pb=c(pb&Na,Ka);hb<db&&Ia<$a;){for(;hb<db&&ga(Da>>16,Ea>>16)<=Va;)Ra=c(hb,Za),ba[Ra]+=pb,++hb,Da+=ra,Ea+=J;for(Ia=ga(Da>>16,Ea>>16);Ia>Va;)++Ca,pb=sa[Ca],pb=c(pb&Na,Ka),Va=(Ca+1)*(Ca+1)}if(hb<fb&&Ia<$a)for(Na=c(z[51],f())|4042322160,Ka=f(),pb=sa[Ca],pb=c(pb&Na,Ka);hb<fb&&Ia<$a;){for(;hb<fb&&ga(Da>>16,Ea>>16)<=Va;)Ra=c(hb,Za),ba[Ra]+=pb,hb+=bb,Da+=
b(ra,Ka),Ea+=b(J,Ka);for(Ia=ga(Da>>16,Ea>>16);Ia>Va;)++Ca,pb=sa[Ca],pb=c(pb&Na,Ka),Va=(Ca+1)*(Ca+1)}if(hb<Lb&&Ia<$a)for(Na=z[51],Ka=z[50],pb=sa[Ca],pb=c(pb&Na,Ka);hb<Lb&&Ia<$a;){for(;hb<Lb&&ga(Da>>16,Ea>>16)<=Va;)Ra=c(hb,Za),ba[Ra]+=pb,++hb,Da+=ra,Ea+=J;for(Ia=ga(Da>>16,Ea>>16);Ia>Va;)++Ca,pb=sa[Ca],pb=c(pb&Na,Ka),Va=(Ca+1)*(Ca+1)}xb[0]=Da;xb[1]=Ea;ea=hb}ea<Lb&&la(sa[xa-1],ea,Lb);break;case 4:case 5:var ib=z[66],kb=z[67],nb=z[68],vb=P(),yb,qb,ub,Mb,Ab,rb,lc,wb,Db,Gb,Ib,jc,Eb,Fb;if(1!==z[48]){var Wb,
Nb,Pb,ac,bc,Hb,Sb,mc,Xb,Qb,Tb,Rb,Ub,Vb,dc,ic,gc,qc,cc,Bb,Cb;if(Pb=rc(ib)){bc=F[ib+10];ac=F[ib+11];qc=1===F[ib+16];mc=kb-F[ib+4];Xb=vb-F[ib+5];Tb=F[ib+6];Ub=F[ib+8];Qb=mc*Tb+Xb*F[ib+7];Rb=mc*Ub+Xb*F[ib+9];Wb=z[48];dc=k(kb,nb);gc=nb-1&~(z[48]-1);Nb=f();Hb=z[51];Sb=z[50];for(cc=kb;cc<dc;)qc&&(Qb=Ua(Qb,bc<<16),Rb=Ua(Rb,ac<<16)),Bb=Qb>>16,Cb=Rb>>16,qc||(Bb=Q(Bb,bc),Cb=Q(Cb,ac)),0<=Bb&&0<=Cb&&Bb<bc&&Cb<ac&&(Vb=t(ib,Pb,Bb,Cb),Vb=c(Vb&Hb,Sb),ic=c(cc,Nb),ba[ic]+=Vb),Qb+=Tb,Rb+=Ub,++cc;Hb=c(z[51],f())|4042322160;
for(Sb=f();cc<gc;)qc&&(Qb=Ua(Qb,bc<<16),Rb=Ua(Rb,ac<<16)),Bb=Qb>>16,Cb=Rb>>16,qc||(Bb=Q(Bb,bc),Cb=Q(Cb,ac)),0<=Bb&&0<=Cb&&Bb<bc&&Cb<ac&&(Vb=t(ib,Pb,Bb,Cb),Vb=c(Vb&Hb,Sb),ic=c(cc,Nb),ba[ic]+=Vb),Qb+=b(Tb,Sb),Rb+=b(Ub,Sb),cc+=Wb;Hb=z[51];for(Sb=z[50];cc<nb;)qc&&(Qb=Ua(Qb,bc<<16),Rb=Ua(Rb,ac<<16)),Bb=Qb>>16,Cb=Rb>>16,qc||(Bb=Q(Bb,bc),Cb=Q(Cb,ac)),0<=Bb&&0<=Cb&&Bb<bc&&Cb<ac&&(Vb=t(ib,Pb,Bb,Cb),Vb=c(Vb&Hb,Sb),ic=c(cc,Nb),ba[ic]+=Vb),Qb+=Tb,Rb+=Ub,++cc}}else if(yb=rc(ib))for(ub=F[ib+10],qb=F[ib+11],Ib=
1===F[ib+16],Mb=kb-F[ib+4],Ab=vb-F[ib+5],lc=F[ib+6],Db=F[ib+8],rb=Mb*lc+Ab*F[ib+7],wb=Mb*Db+Ab*F[ib+9],jc=kb;jc<nb;)Ib&&(rb=Ua(rb,ub<<16),wb=Ua(wb,qb<<16)),Eb=rb>>16,Fb=wb>>16,Ib||(Eb=Q(Eb,ub),Fb=Q(Fb,qb)),0<=Eb&&0<=Fb&&Eb<ub&&Fb<qb&&(Gb=t(ib,yb,Eb,Fb),ba[jc]=Gb),rb+=lc,wb+=Db,++jc}}return!1}function ea(){var a,b,d;for(d=P();z[11]<z[12];){a=Ea[z[11]];if(F[a+5]>d)break;b=sb(a);if(2===(b&254))return!0;if(!Ka(1))break;switch(b){case 4:Ca(Ea[z[11]],P());break;case 5:b=Ea[z[11]];var c=P(),e,l,f,m,t,g;
l=F[b+20];e=l>>1;m=U(b);t=F[b+5];Ca(b,t);f=F[b+7];g=F[b+10];Z(b,m-e);F[b+7]=f+l;0<g?F[b+17]=F[b+12]+l:(F[b+17]=l-F[b+12],Z(b,U(b)+F[b+12]));l=0-f-e;F[b+18]=0;F[b+19]=l;0>=e&&0>l?fb(b,sb(b)&-65537):fb(b,sb(b)|65536);if(t!==c){for(e=t;e<=c-1;e++)Va(b,e);F[b+7]-=c-t}break;case 6:Eb(Ea[z[11]],P());break;case 7:b=Ea[z[11]];c=P();e=F[b+20];t=e>>1;f=F[b+14];l=F[b+5];Eb(b,l);m=F[b+7];for(g=0;5>=g;g++)Na(b)[g]=h(b)[g];g=h(b)[2];0===g&&h(b)[4];g=0<=g?1:-1;0>g?(h(b)[0]=h(b)[0]-256*t,g=Na(b)[0],Na(b)[0]=g+256*
(e-t),g=Na(b)[1],Na(b)[1]=g+256*e,F[b+21]=f-t):(h(b)[0]=h(b)[0]+256*t,g=Na(b)[0],Na(b)[0]=g-256*(e-t),g=Na(b)[1],Na(b)[1]=g+256*e,F[b+21]=f-t+e);0===m&&(h(b)[0]=256*F[b+21]);F[b+7]=m+e;f=0-m-t;F[b+18]=0;F[b+19]=f;0>=t&&0>f?fb(b,sb(b)&-65537):fb(b,sb(b)|65536);X(b,e);if(l!==c){for(g=l;g<=c-1;g++)Ra(b,g);F[b+7]-=c-l}}jb(a);z[11]+=1}return!1}function Ma(){var a,b,d;for(d=z[37];z[13]<z[14];){a=S[z[13]];b=d=U(a);if(b>=z[37])return!1;gc(b);if(va(a)){var c=a,h,e,l,f;h=sb(c)>>>1;Fb=c;switch(h){case 2:mb=
F[Fb+17];break;case 3:mb=F[Fb+17]}l=mb;switch(h){case 2:mb=F[Fb+16];break;case 3:mb=F[Fb+16]}e=mb;0!==e&&Ka(3)&&(h=(F[c+6]<<1)+1,f=U(c)+l,l=ra(e,h),-1===l?Ya(e,h,f):Aa(l+2)<f&&oa(l,f),gc(U(c)))}if(0===(F[a+0]&65536)&&(Ka(6)&&(c=F[a+6]<<1,h=F[a+8],0!==h&&Wb(h,c,999999999),h=F[a+9],0!==h&&Wb(h,c,999999999),gc(U(a))),aa))return!1;z[13]+=1;z[13]<z[14]&&(d=S[z[13]],d=U(d),d>=z[36]&&xa(b,d))}d<z[37]&&xa(d,z[37]);return!1}function Wa(){for(var a,b;z[13]<z[14];)if(b=S[z[13]],a=F[b+7]-1,0===a)Cc();else{F[b+
7]=a;a=sb(b);if(2===(a&254))return!0;switch(a){case 4:nb(S[z[13]],P());break;case 5:Va(S[z[13]],P());break;case 6:a=S[z[13]];b=P();b=Da(h(a),b);Z(a,b);break;case 7:Ra(S[z[13]],P())}Ga();z[13]+=1}return!1}function ra(a,b){var d;for(d=0;d<qa()&&(Aa(d)!==a||Aa(d+1)!==b);)d+=3;return d>=qa()?-1:d}function sa(a,b){var d;if(a===b)return!0;d=F[a+5]-F[b+5];if(0!==d)return 0>d;d=U(a)-U(b);return 0>d}function Sa(a,b){var d,c;d=ra(a,b);if(-1===d)return!1;if(0===d)return z[10]+=3,!0;ub(d,Aa(0));ma(d,Aa(1));oa(d,
Aa(2));z[10]+=3;if(3>=qa())return!0;c=0;for(d=3;d<qa();)wa(d,c)&&(c=d),d+=3;if(c+3===qa())return!0;d=Aa(c);ub(c,Aa(qa()-3));ha(d);d=Aa(c+1);ma(c,Aa(qa()-3+1));vb(d);d=Aa(c+2);oa(c,Aa(qa()-3+2));Gb(d);return!0}function W(a,b){return z[a]+=b}function lb(){Ta=r.ioLoadFunctionFrom("loadBitBltFrom",ia);rb=r.ioLoadFunctionFrom("copyBitsFromtoat",ia);return!!Ta&&!!rb}function gb(){ab(z[48]);0>z[42]&&(z[42]=0);z[43]>z[33]&&(z[43]=z[33]);z[36]=b(z[42],f());z[38]=b(z[44],f());z[37]=b(z[43],f());z[39]=b(z[45],
f());z[12]=0;z[14]=0;Ea=e(F,Y);S=e(F,Y);var a,d;d=0;for(a=Y;d<a;){var c=d;if((255<sb(c)?0:0!==(sb(c)&255))&&!(F[d+5]>=z[39]))if(c=d,4===(sb(c)&254)){var h;h=va(c)?F[c+20]:0;F[c+15]+h<z[38]||U(c)-h>=z[37]&&F[c+14]-h>=z[37]||p(c)}else 6===(sb(c)&254)?(h=va(c)?F[c+20]:0,F[c+15]+h<z[38]||U(c)-h>=z[37]&&F[c+14]-h>=z[37]||p(c)):p(c);d+=F[d+1]}if(aa)return null;if(0===z[12])return z[88]=z[39],0;sc(Ea,0,z[12]-1);z[88]=F[Ea[0]+5];P()<z[38]&&(z[88]=z[38]);z[32]=0;z[34]=b(z[33],f())-1;M()}function jb(a){if(0>=
F[a+7])return null;var b,d;d=U(a);for(b=0;b<z[14]&&U(S[b])<d;)++b;for(;b<z[14]&&U(S[b])===d&&sa(S[b],a);)++b;if(Ka(1)){for(d=z[14]-1;!(d<b);)S[d+1]=S[d],--d;S[b]=a;z[14]+=1}}function za(a){var b;(b=0===a)||(b=0!==(a&4278190080))||!(b=0<=a&&a<Y)||(b=0!==(a&4278190080)||0!==(sb(a)&65280));return b}function va(a){return 0!==(sb(a)&1)}function eb(a,b,d,c){var h;h=A();if(aa)return 0;w(h,a[0]);I(h,a[1]);K(h,b[0]);C(h,b[1]);l(h,d[0]);y(h,d[1]);a=L(h);d=H(h);b=u(h);a=d-a;b-=d;0<=a*b?a=h:(W(108,1),b-=a,0>
a&&(a=0-a),0>b&&(b=0-b),a=O(h,a/b));a=b=d=a;c&&(b=da(h));b>d&&(d=b);h!==a&&c&&(b=da(a));b>d&&(d=b);for(a=c=d;h<=c;h+=6)if(b=Hb(h),b>a&&(a=b),aa)return 0;return Math.floor(a/6)|0}function hb(a){return Ta||lb()?Ta(a):!1}function Mb(d,c,h,l,f,m,t){var g,u,B,y,k;if(c.isNil)g=0,k=null;else{if(n(c)!==r.classBitmap())return r.primitiveFail();g=a(c);k=c.wordsAsInt32Array()}if("number"===typeof d||!r.isPointers(d)||5>a(d))return r.primitiveFail();c=r.fetchPointerofObject(0,d);if(n(c)!==r.classBitmap())return r.primitiveFail();
c=a(c);y=r.fetchIntegerofObject(1,d);u=r.fetchIntegerofObject(2,d);d=r.fetchIntegerofObject(3,d);if(r.failed())return null;if(!(0<=y&&0<=u)||32!==d&&8!==d&&16!==d&&1!==d&&2!==d&&4!==d||0!==g&&g!==b(1,d))return r.primitiveFail();B=Math.floor(32/d)|0;B=Math.floor((y+(B-1))/B)|0;if(c!==B*u)return r.primitiveFail();var N,w,C;N=18+g;if(q(N)){w=Y;Y=w+N;fb(w,1024);F[w+2]=0;F[w+1]=N;N=e(F,w+18);if(0!==z[17])for(C=0;C<=g-1;C++)N[C]=ka(k[C]);else for(C=0;C<=g-1;C++)N[C]=k[C];F[w+15]=g;g=w}else g=0;if(aa)return null;
F[g+10]=y;F[g+11]=u;F[g+12]=d;F[g+14]=B;F[g+13]=c;F[g+16]=h;F[g+2]=t;Sb(g,l,f,m,y,u);return g}function rc(b){var d;d=F[b+2];if(d>a(Db))return null;d=r.fetchPointerofObject(d,Db);d=r.fetchPointerofObject(0,d);return a(d)!==F[b+13]?null:d.wordsAsInt32Array()}function lc(a,b,d,c,h,e,l){var f,m,t,g;if(c===h&&(0===e||0===l))return null;a*=6;d?(d=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+0],t=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+1],f=(b.int16Array||
(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+2],g=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+3],m=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+4],b=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[a+5]):(d=b[a+0]|0,t=b[a+1]|0,f=b[a+2]|0,g=b[a+3]|0,m=b[a+4]|0,b=b[a+5]|0);if(d===f&&t===g||f===m&&g===b){if(d===m&&t===b)return null;ca()[0]=d;ca()[1]=t;pa()[0]=m;pa()[1]=b;Pa(2);return Ib(e,ca(),pa(),l,c,h)}ca()[0]=d;ca()[1]=
t;pa()[0]=f;pa()[1]=g;Ha()[0]=m;Ha()[1]=b;Pa(3);b=eb(ca(),pa(),Ha(),0!==e&&0!==l);if(aa)return null;tc(e,l,c,h,b)}function mc(b){var d;d=z[65];if(6>a(b))return null;Z(d,r.fetchIntegerofObject(1,b));T(d,r.fetchIntegerofObject(2,b));var c=r.fetchIntegerofObject(3,b);F[d+6]=c;b=r.fetchIntegerofObject(4,b);F[d+7]=b;return d}function Sb(a,b,d,c,h,e){var l,f,m;d[0]+=b[0];d[1]+=b[1];c[0]+=b[0];c[1]+=b[1];na(b);na(d);na(c);l=d[0]-b[0];f=d[1]-b[1];d=c[0]-b[0];c=c[1]-b[1];m=l*l+f*f;0<m?(l=l*h*65536/m|0,h=f*
h*65536/m|0):h=l=0;f=d*d+c*c;0<f?(d=d*e*65536/f|0,e=c*e*65536/f|0):e=d=0;F[a+4]=b[0];F[a+5]=b[1];F[a+6]=l;F[a+7]=h;F[a+8]=d;F[a+9]=e}function jc(b){var d,c,h,e;if(!r.isArray(b))return!1;Db=b;for(b=0;b<=a(Db)-1;b++){c=r.fetchPointerofObject(b,Db);if("number"===typeof c||!r.isPointers(c)||5>a(c))return!1;d=r.fetchPointerofObject(0,c);if(n(d)!==r.classBitmap())return!1;d=a(d);e=r.fetchIntegerofObject(1,c);h=r.fetchIntegerofObject(2,c);c=r.fetchIntegerofObject(3,c);if(r.failed()||!(0<=e&&0<=h))return!1;
c=Math.floor(32/c)|0;e=Math.floor((e+(c-1))/c)|0;if(d!==e*h)return!1}return!0}function Qa(a,b){var d;if(n(b)!==r.classPoint())return r.primitiveFail();d=r.fetchPointerofObject(0,b);if("number"!==typeof d&&!d.isFloat)return r.primitiveFail();a[0]="number"===typeof d?d:r.floatValueOf(d)|0;d=r.fetchPointerofObject(1,b);if("number"!==typeof d&&!d.isFloat)return r.primitiveFail();a[1]="number"===typeof d?d:r.floatValueOf(d)|0}function Dc(){var b,d,c;if(2!==r.methodArgumentCount())return 5;if(0!==(d=yb(r.stackValue(2))))return d;
c=r.stackObjectValue(0);b=r.stackObjectValue(1);if(r.failed())return 3;if(0!==(d=Tb(r.fetchPointerofObject(1,Ia))))return d;if(!hb(r.fetchPointerofObject(2,Ia)))return 122;if(!jc(r.fetchPointerofObject(3,Ia)))return 123;if(6>a(b))return 112;if(6>a(c))return 113;b=z[2];return 2===b||4===b||7===b?116:0}function Tb(b){if(n(b)!==r.classBitmap())return 114;ba=b.words;z[33]=a(b)-1;return 0}function Ub(b,d,c){if(b.isNil)return!1;if("number"===typeof b||a(b)!==c)return r.primitiveFail();if(r.isWords(b)){var h;
h=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)d[b]=h[b]}else a:{var e;for(h=0;h<=c-1;h++){e=r.fetchPointerofObject(h,b);if("number"!==typeof e&&!e.isFloat){r.primitiveFail();break a}d[h]="number"===typeof e?e:r.floatValueOf(e)}}return!0}function tc(a,b,d,c,h){var e,l,f;0===a||0===b?(f=!1,l=0):(f=!0,l=a>>1);for(h*=6;0<h;){f?q(28)?(e=Y,Y=e+28,fb(e,7),F[e+2]=0,F[e+1]=28):e=0:q(16)?(e=Y,Y=e+16,fb(e,6),F[e+2]=0,F[e+1]=16):e=0;if(aa)return 0;var m=e,t=h,g=d,y=c,k=l;if(u(t)>=L(t)){Z(m,G(t));T(m,L(t)-k);var N=
E(t);F[m+12]=N;N=H(t)-k;F[m+13]=N;N=B(t);F[m+14]=N;t=u(t)-k}else Z(m,B(t)),T(m,u(t)-k),N=E(t),F[m+12]=N,N=H(t)-k,F[m+13]=N,N=G(t),F[m+14]=N,t=L(t)-k;F[m+15]=t;F[m+6]=z[113];F[m+8]=g;F[m+9]=y;f&&(F[e+16]=b,F[e+17]=a,F[e+20]=a);h-=6}bb()}function Ib(a,b,d,c,h,e){var l,f;0===a||0===c?(q(16)?(l=Y,Y=l+16,fb(l,4),F[l+2]=0,F[l+1]=16):l=0,f=0):(q(21)?(l=Y,Y=l+21,fb(l,5),F[l+2]=0,F[l+1]=21):l=0,f=a>>1);if(aa)return 0;var m=l,t;b[1]<=d[1]?(t=b,b=d,d=1):(t=d,d=-1);Z(m,t[0]);T(m,t[1]-f);F[m+6]=z[113];F[m+8]=
h;F[m+9]=e;F[m+14]=b[0];F[m+15]=b[1]-f;F[m+11]=d;va(l)&&(F[l+16]=c,F[l+17]=a,F[l+20]=a)}function Xb(b){if("number"===typeof b)return 105;if(!r.isWords(b))return 106;if(256>a(b))return 107;z=b.wordsAsInt32Array();if(1097753705!==z[0])return 108;if(z[1]!==a(b))return 109;if(128!==z[8])return 110;F=e(z,z[8]);Ea=e(F,z[9]);S=e(Ea,z[12]);return 128+z[9]+z[12]+z[14]>z[1]?111:0}function Ka(a){return 128+Y+z[12]+z[14]+a>z[10]?(Za(1),!1):!0}function ya(a){return z[9]=a}function sb(a){return F[a+0]&65535}function fb(a,
b){return F[a+0]=b}function ca(){return e(z,80)}function pa(){return e(z,82)}function Ha(){return e(z,84)}function dc(){z[11]>=z[12]&&0===z[14]&&ja(8);P()>=z[39]&&ja(8)}function Nb(){for(var a;8!==z[2];){fa&&(J=r.ioMicroMSecs());a=ea();fa&&(W(95,1),W(94,r.ioMicroMSecs()-J));if(aa)return ja(1);if(a)return ja(2),Za(4);z[13]=0;bb();z[69]=1;fa&&(J=r.ioMicroMSecs());0!==z[69]&&0===(P()&z[52])&&M();z[69]=0;a=Ma();fa&&(W(99,1),W(98,r.ioMicroMSecs()-J));if(aa)return ja(3);if(a)return ja(4),Za(5);bb();z[35]=
0;fa&&(J=r.ioMicroMSecs());(P()&z[52])===z[52]&&(ta(P()),dc());fa&&(W(103,1),W(102,r.ioMicroMSecs()-J));if(aa)return ja(5);if(8===z[2])return 0;z[13]=0;z[88]=P()+1;fa&&(J=r.ioMicroMSecs());a=Wa();fa&&(W(105,1),W(104,r.ioMicroMSecs()-J));if(aa)return ja(6);if(a)return ja(7),Za(6)}}function Ec(){var a;a=z[2];if(0===a){gb();if(aa)return 0;a=1}if(1===a){fa&&(J=r.ioMicroMSecs());a=ea();fa&&(W(95,1),W(94,r.ioMicroMSecs()-J));if(aa)return ja(1);if(a)return ja(2),Za(4);z[13]=0;bb();z[69]=1;a=3}if(3===a){fa&&
(J=r.ioMicroMSecs());0!==z[69]&&0===(P()&z[52])&&M();z[69]=0;a=Ma();fa&&(W(99,1),W(98,r.ioMicroMSecs()-J));if(aa)return ja(3);if(a)return ja(4),Za(5);a=5;bb();z[35]=0}if(5===a){fa&&(J=r.ioMicroMSecs());(P()&z[52])===z[52]&&(ta(P()),dc());fa&&(W(103,1),W(102,r.ioMicroMSecs()-J));if(aa)return ja(5);if(8===z[2])return 0;a=6;z[13]=0;z[88]=P()+1}if(6===a){fa&&(J=r.ioMicroMSecs());a=Wa();fa&&(W(105,1),W(104,r.ioMicroMSecs()-J));if(aa)return ja(6);if(a)return ja(7),Za(6);ja(1)}}function yb(b){if(r.failed())return 100;
if("number"===typeof b)return 101;if(!r.isPointers(b))return 102;if(12>a(b))return 103;Ia=b;if(0!==(b=Xb(r.fetchPointerofObject(0,b))))return b;z[64]=0;Y=z[9];aa=!1;return 0}function Xa(a,b){var d;if(0!==(d=yb(a)))return d;if(z[2]===b)return 0;z[64]=2;return 116}function gc(a){if(0===qa())return null;for(;db()<=a;){var b=R(),d;d=0===qa()?-1:Aa(qa()-3+1);Sa(b,d);if(0===qa())return null}}function sc(a,b,d){var c,h,e,l,f,m;if(1>=(c=d+1-b))return 0;e=a[b];f=a[d];h=sa(e,f);h||(h=a[b],a[b]=a[d],a[d]=h,
l=e,e=f,f=l);if(2>=c)return 0;m=b+d>>1;l=a[m];(h=sa(e,l))?(h=sa(l,f),h||(h=a[d],a[d]=a[m],a[m]=h,l=f)):(h=a[b],a[b]=a[m],a[m]=h,l=e);if(3>=c)return 0;e=b;f=d;for(c=!0;c;){for(h=!0;h;)e<=--f?(h=a[f],h=sa(l,h)):h=!1;for(h=!0;h;)++e<=f?(h=a[e],h=sa(h,l)):h=!1;if(c=e<=f)h=a[e],a[e]=a[f],a[f]=h}sc(a,b,f);sc(a,e,d)}function Cc(){var a;a=z[13];for(--z[14];a<z[14];)S[a]=S[a+1],++a}function Ua(a,b){var d;for(d=a;0>d;)d+=b;for(;d>=b;)d-=b;return d}function Ga(){var a,b;if(0===z[13])return null;a=S[z[13]];b=
U(a);if(U(S[z[13]-1])<=b)return null;var d;for(d=z[13];0<d&&U(S[d-1])>b;)S[d]=S[d-1],--d;S[d]=a}function ab(a){var b;4<=a&&(b=4);2<=a&&4>a&&(b=2);2>a&&(b=1);z[48]=b;1===b&&(z[49]=0,z[51]=4294967295,z[52]=0);2===b&&(z[49]=1,z[51]=4244438268,z[52]=1);4===b&&(z[49]=2,z[51]=4042322160,z[52]=3);z[50]=2*f();z[53]=f()}function Ya(a,b,d){if(!Pb(3))return null;Ab(0,a);ma(0,b);oa(0,d);if(3===qa())return null;wa(0,qa()-3)&&(ub(0,Aa(qa()-3)),ma(0,Aa(qa()-3+1)),oa(0,Aa(qa()-3+2)),ha(a),vb(b),Gb(d))}function ga(a,
b){return a*a+b*b}function ma(a,b){return Ab(a+1,b)}function oa(a,b){return Ab(a+2,b)}function ub(a,b){return Ab(a,b)}function ja(a){return z[2]=a}function Eb(a,b){var d,c,e,l,f,m,t,g,u;if(!va(a)&&b>=F[a+15])return F[a+7]=0;g=U(a);u=F[a+5];l=F[a+12];f=F[a+13];c=F[a+14];e=F[a+15];d=e-u;m=2*d;2>m&&(m=2);m=Math.floor(16777216/m)|0;var B;t=m&65535;B=m>>>16&255;t=(t*t>>>16)+t*B*2+(B*B<<16)>>>8;c=(g+c-2*l)*t*2;l=2*(l-g)*m+(c>>1);e=(u+e-2*f)*t*2;f=2*(f-u)*m+(e>>1);F[a+7]=d;m=h(a);m[0]=256*g;m[1]=256*u;m[2]=
l;m[3]=f;m[4]=c;m[5]=e;(u=F[a+5])!==b&&(g=Da(h(a),b),Z(a,g),F[a+7]=d-(b-u))}function Ca(a,b){var d,c,h,e,l;if(!va(a)&&b>=F[a+15])return F[a+7]=0;d=F[a+14]-U(a);c=F[a+15]-F[a+5];0<=d?(l=1,e=d,h=0):(l=-1,e=0-d,h=1-c);0===c?e=h=0:c>e?d=0:(d=(Math.floor(e/c)|0)*l,e=e-(Math.floor(e/c)|0)*c|0);F[a+7]=c;F[a+10]=l;F[a+12]=d;F[a+13]=h;F[a+14]=e;F[a+15]=c;if((l=F[a+5])!==b){for(h=l;h<=b-1;h++)nb(a,h);F[a+7]=c-(b-l)}}function Da(a,b){var d,c,h,e,l;h=a[0];e=a[1];d=a[2];c=a[3];for(l=256*b;l>e&&0<=c;)h+=d+32768>>
16,e+=c+32768>>16,d+=a[4],c+=a[5];a[0]=h;a[1]=e;a[2]=d;a[3]=c;return h>>8}function nb(a,b){var d,c;c=U(a)+F[a+12];d=F[a+13]+F[a+14];0<d&&(c+=F[a+10],d-=F[a+15]);F[a+13]=d;Z(a,c)}function Ra(a,b){var d,c,e,l;c=F[a+20];d=c>>1;e=F[a+18]+1;l=F[a+19]+1;F[a+18]=e;F[a+19]=l;e>=d&&fb(a,sb(a)&-65537);0<=l&&fb(a,sb(a)|65536);0>l+d?Da(h(a),b):h(a)[0]=256*F[a+21];Da(Na(a),b);X(a,c)}function Va(a,b){var d,c,h,e,l,f;l=F[a+18]+1;f=F[a+19]+1;F[a+18]=l;F[a+19]=f;h=F[a+20];c=h>>1;l>=c&&fb(a,sb(a)&-65537);0<=f&&fb(a,
sb(a)|65536);d=U(a);nb(a,b);e=U(a);if(l<=h||0<=f+c){var m,t;m=F[a+18];t=F[a+19];c=F[a+20];h=c>>1;l=F[a+17];f=F[a+10];e-=d;m<c&&(0>f?l-=e:(l+=e,Z(a,d)));0===t+h&&(0<f?l-=F[a+12]:(l+=F[a+12],Z(a,d)));0<t+h&&(0>f?(l+=e,Z(a,d)):l-=e);F[a+17]=l}}function Za(a){z[64]=a;aa=!0}function kb(b,d){if(6>a(d))return r.primitiveFail();r.storeIntegerofObjectwithValue(0,d,F[b+2]);r.storeIntegerofObjectwithValue(1,d,U(b));r.storeIntegerofObjectwithValue(2,d,P());r.storeIntegerofObjectwithValue(3,d,F[b+6]);r.storeIntegerofObjectwithValue(4,
d,F[b+7]);z[65]=b}function qb(b){var d,c,h;d=z[66];c=z[67];h=z[68];if(6>a(b))return r.primitiveFail();r.storeIntegerofObjectwithValue(0,b,F[d+2]);r.storeIntegerofObjectwithValue(1,b,c);r.storeIntegerofObjectwithValue(2,b,h);r.storeIntegerofObjectwithValue(3,b,P())}function Ja(){if(r.failed())return null;if(aa){var a=r.stackObjectValue(1),b=r.stackObjectValue(0),d,c;c=z[64];4===c&&(d=Ea[z[11]],kb(d,a),z[11]+=1);5===c&&qb(b);6===c&&(d=S[z[13]],kb(d,a))}ya(Y);r.pop(3);r.pushInteger(z[64])}function zc(a){var b,
d;b=L(a);d=u(a);if(d===b)return a;d-=b;0>d&&(d=0-d);if(255<d)return W(109,1),V(a);b=G(a);b=B(a)-b;0>b&&(b=0-b);return 32*d<b?(W(110,1),V(a)):a}function Hb(a){var b;b=zc(a);if(b!==a){a=Hb(a);if(aa)return 0;b=Hb(b);return aa?0:a>=b?a:b}return a}function da(a){var b,d,c;d=G(a);c=E(a);b=B(a);d=c-d;b-=c;if(0<=d*b)return a;W(108,1);b-=d;0>d&&(d=0-d);0>b&&(b=0-b);return O(a,d/b)}function Wb(a,b,d){var c;0===qa()?Pb(3)&&(ha(a),vb(b),Gb(d)):(c=Sa(a,b))||Ya(a,b,d)}function R(){return 0===qa()?0:Aa(qa()-3)}
function vb(a){return ma(qa()-3,a)}function Gb(a){return oa(qa()-3,a)}function ha(a){return ub(qa()-3,a)}function db(){return 0===qa()?999999999:Aa(qa()-3+2)}function ka(a){var b,d,c,h,e;if(0!==a&&0===(a&4278190080))return a;d=a&255;c=a>>>8&255;h=a>>>16&255;a=a>>>24&255;0!==z[17]&&(e=g(z,24),b=(a*e[6]+e[7])/a,h=(h*e[0]+e[1])*b|0,c=(c*e[2]+e[3])*b|0,d=(d*e[4]+e[5])*b|0,h=Math.max(h,0),h=Math.min(h,255),c=Math.max(c,0),c=Math.min(c,255),d=Math.max(d,0),d=Math.min(d,255),a=Math.max(a*b|0,0),a=Math.min(a,
255));if(1>a)return 0;255>a&&0!==z[63]&&Za(3);return d+(c<<8)+(h<<16)+(a<<24)}function na(a){if(0!==z[16]){var b=a[0]|0,d=a[1]|0,c,h;c=g(z,18);h=(c[0]*b+c[1]*d+c[2])*z[48]|0;b=(c[3]*b+c[4]*d+c[5])*z[48]|0;a[0]=h;a[1]=b}else a[0]=(a[0]+z[46])*z[48],a[1]=(a[1]+z[47])*z[48]}function Pa(a){0<a&&na(ca());1<a&&na(pa());2<a&&na(Ha());3<a&&na(e(z,86))}function wb(a){var b,d;if(0===a)return 0;ca()[0]=0;ca()[1]=0;pa()[0]=256*a;pa()[1]=0;Ha()[0]=0;Ha()[1]=256*a;Pa(3);b=pa()[0]-ca()[0];d=pa()[1]-ca()[1];a=(Math.sqrt(b*
b+d*d)|0)+128>>8;b=Ha()[0]-ca()[0];d=Ha()[1]-ca()[1];b=(Math.sqrt(b*b+d*d)|0)+128>>8;b<a&&(a=b);return 0===a?1:a}function $a(a){var b,d,c,h;if(0===z[17])return a;b=a&255;d=a>>>8&255;c=a>>>16&255;a=a>>>24&255;h=g(z,24);c=c*h[0]+h[1]|0;d=d*h[2]+h[3]|0;b=b*h[4]+h[5]|0;a=a*h[6]+h[7]|0;c=Math.max(c,0);c=Math.min(c,255);d=Math.max(d,0);d=Math.min(d,255);b=Math.max(b,0);b=Math.min(b,255);a=Math.max(a,0);a=Math.min(a,255);return 16>a?0:b+(d<<8)+(c<<16)+(a<<24)}function bb(){z[10]=z[1]}function Pb(a){if(!Ka(a))return!1;
z[10]-=a;return!0}function qa(){return z[1]-z[10]}function Aa(a){return z[z[10]+a]}function Ab(a,b){return z[z[10]+a]=b}function Na(a){return e(F,a+22)}var S=null,ia="BitBltPlugin",rb=null,mb=0,Fb=0,fa=0,Ia=0,aa=0,Db=0,J=0,Ea=null,r=null,Ta=null,F=null,Y=0,ba=null,z=null;Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:function(){var b,d,h;fa&&(J=r.ioMicroMSecs());if(2!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=Xa(r.stackValue(2),4))||0!==(b=Tb(r.fetchPointerofObject(1,
Ia))))return r.primitiveFailFor(b);d=r.stackObjectValue(0);b=r.stackObjectValue(1);if(r.failed()||n(b)!==r.classBitmap())return r.primitiveFailFor(3);if(6>a(d))return r.primitiveFailFor(113);h=r.fetchIntegerofObject(0,d);if(F[z[66]+2]!==h)return r.primitiveFailFor(117);h=r.fetchIntegerofObject(1,d);if(z[67]!==h)return r.primitiveFailFor(117);h=r.fetchIntegerofObject(2,d);if(z[68]!==h)return r.primitiveFailFor(117);if(a(b)<z[68]-z[67])return r.primitiveFailFor(3);if(r.failed())return null;b=b.wordsAsInt32Array();
d=z[68];var e,l,m,t,g,u;u=z[67];e=-1;if(1===z[48])for(;u<d;)t=b[++e]|0,ba[u]=t,++u;else for(l=z[51],m=z[50],h=f();u<d;)g=c(u,h),t=b[++e]|0,t=c(t&l,m),ba[g]+=t,++u;d>z[34]&&(z[34]=d);d>z[35]&&(z[35]=d);ja(3);ya(Y);r.pop(2);fa&&(W(101,1),W(100,r.ioMicroMSecs()-J))},primitiveCopyBuffer:function(){var b,d,c,h,l,f;if(2!==r.methodArgumentCount())return r.primitiveFailFor(5);d=r.stackValue(0);b=r.stackValue(1);if(0!==(c=Xb(b)))return r.primitiveFailFor(c);if(n(b)!==n(d))return r.primitiveFailFor(114);b=
a(d)-a(b);if(0>b)return r.primitiveFailFor(115);l=z;c=d.wordsAsInt32Array();h=0;for(f=z[10]-1;h<=f;h++)c[h]=l[h];c[10]=z[10]+b;c[1]=z[1]+b;l=e(l,z[10]);c=e(c,z[10]+b);h=0;for(f=z[1]-z[10]-1;h<=f;h++)c[h]=l[h];if(0!==(c=Xb(d)))return r.primitiveFailFor(c);r.pop(2)},primitiveAddRect:function(){var a,b,d,c,h,l;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);a=r.positive32BitValueOf(r.stackValue(0));b=r.stackIntegerValue(1);h=r.positive32BitValueOf(r.stackValue(2));d=r.stackObjectValue(3);
l=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(c=Xa(r.stackValue(5),0)))return r.primitiveFailFor(c);if(!za(a)||!za(h))return r.primitiveFailFor(117);a=ka(a);h=ka(h);if(aa)return r.primitiveFailFor(104);if(0===h&&(0===a||0===b))return r.pop(5);if(!Ka(64))return r.primitiveFailFor(111);b=0<b&&0!==a?wb(b):0;Qa(ca(),l);Qa(Ha(),d);if(r.failed())return r.primitiveFailFor(121);pa()[0]=Ha()[0];pa()[1]=ca()[1];e(z,86)[0]=ca()[0];e(z,86)[1]=Ha()[1];Pa(4);Ib(b,ca(),pa(),a,0,h);Ib(b,
pa(),Ha(),a,0,h);Ib(b,Ha(),e(z,86),a,0,h);Ib(b,e(z,86),ca(),a,0,h);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(Y);r.pop(5)},primitiveAddGradientFill:function(){var b,d,c,h,l,f;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);c=r.booleanValueOf(r.stackValue(0));h=r.stackValue(1);b=r.stackValue(2);l=r.stackValue(3);f=r.stackValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(d=Xa(r.stackValue(5),0)))return r.primitiveFailFor(d);Qa(ca(),l);Qa(pa(),b);Qa(Ha(),h);if(r.failed())return r.primitiveFailFor(121);
b=ca();d=pa();h=Ha();if(n(f)!==r.classBitmap())c=r.primitiveFail();else{l=a(f);f=f.wordsAsInt32Array();var m,t;t=12+l;if(q(t)){m=Y;Y=m+t;c?fb(m,768):fb(m,512);F[m+2]=0;F[m+1]=t;t=e(F,m+12);if(0!==z[17])for(c=0;c<=l-1;c++)t[c]=ka(f[c]);else for(c=0;c<=l-1;c++)t[c]=f[c];F[m+10]=l;c=m}else c=0;aa?c=null:Sb(c,b,d,h,l,l)}if(aa)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(Y);r.popthenPush(6,r.positive32BitIntegerFor(c))},primitiveSetClipRect:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);
if(0!==(b=Xa(r.stackValue(1),0)))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isPointers(b)&&2<=a(b)))return r.primitiveFailFor(3);Qa(ca(),r.fetchPointerofObject(0,b));Qa(pa(),r.fetchPointerofObject(1,b));if(r.failed())return r.primitiveFailFor(3);z[42]=ca()[0];z[44]=ca()[1];z[43]=pa()[0];z[45]=pa()[1];ya(Y);r.pop(1)},initialiseModule:lb,primitiveSetBitBltPlugin:function(){var a,b;b=r.stackValue(0);if(!r.isBytes(b)||256<=(b.bytes?b.bytes.length:b.words?4*b.words.length:
0))return r.primitiveFail();a=!1;b=b.bytesAsString();b!==ia&&(ia=b,a=!0);if(a&&!lb())return r.primitiveFail();r.pop(1)},primitiveRegisterExternalEdge:function(){var a,b,d,c,h,e,l;if(6!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(6),0)))return r.primitiveFailFor(a);l=r.positive32BitValueOf(r.stackValue(0));e=r.positive32BitValueOf(r.stackValue(1));h=r.stackIntegerValue(2);c=r.stackIntegerValue(3);d=r.stackIntegerValue(4);b=r.stackIntegerValue(5);if(r.failed())return r.primitiveFailFor(3);
if(!q(10))return r.primitiveFailFor(111);if(!za(e)||!za(l))return r.primitiveFailFor(117);a=Y;Y=a+10;fb(a,2);F[a+1]=10;F[a+2]=b;Z(a,d);T(a,c);F[a+6]=h;b=ka(e);F[a+8]=b;l=ka(l);F[a+9]=l;if(aa)return r.primitiveFailFor(104);r.failed()||(ya(Y),r.pop(6))},primitiveGetClipRect:function(){var b,d;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=yb(r.stackValue(1))))return r.primitiveFailFor(b);d=r.stackObjectValue(0);if(r.failed()||!(r.isPointers(d)&&2<=a(d)))return r.primitiveFailFor(3);
r.pushRemappableOop(d);b=r.makePointwithxValueyValue(z[42],z[44]);r.storePointerofObjectwithValue(0,r.topRemappableOop(),b);b=r.makePointwithxValueyValue(z[43],z[45]);d=r.popRemappableOop();r.storePointerofObjectwithValue(1,d,b);r.popthenPush(2,d)},primitiveAddBezier:function(){var a,b,d,c,h,e;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);c=r.positive32BitValueOf(r.stackValue(0));d=r.positive32BitValueOf(r.stackValue(1));e=r.stackObjectValue(2);a=r.stackObjectValue(3);h=r.stackObjectValue(4);
if(r.failed())return r.primitiveFailFor(3);if(0!==(b=Xa(r.stackValue(5),0)))return r.primitiveFailFor(b);if(!za(d)||!za(c))return r.primitiveFailFor(117);Qa(ca(),h);Qa(pa(),e);Qa(Ha(),a);if(r.failed())return r.primitiveFailFor(3);Pa(3);a=eb(ca(),pa(),Ha(),!1);Ka(16*a);aa||(d=ka(d),c=ka(c));aa||tc(0,0,d,c,a);if(aa)return bb(),r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(Y);r.pop(5)},primitiveInitializeProcessing:function(){var a;fa&&(J=r.ioMicroMSecs());if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);
if(0!==(a=Xa(r.stackValue(0),0))||0!==(a=Tb(r.fetchPointerofObject(1,Ia))))return r.primitiveFailFor(a);gb();if(aa)return r.primitiveFailFor(104);ja(1);r.failed()||ya(Y);fa&&(W(91,1),W(90,r.ioMicroMSecs()-J))},primitiveRenderImage:function(){var a;if(0!==(a=Dc()))return r.primitiveFailFor(a);Ec();if(aa)return Ja();Nb();Ja()},primitiveGetOffset:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=yb(r.stackValue(0))))return r.primitiveFailFor(a);a=r.makePointwithxValueyValue(z[46],
z[47]);r.popthenPush(1,a)},primitiveSetDepth:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackIntegerValue(0);if(r.failed())return r.primitiveFailFor(3);z[113]=a;ya(Y);r.pop(1)},primitiveAddBezierShape:function(){var b,d,c,h,e,l,f;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);c=r.positive32BitValueOf(r.stackValue(0));h=r.stackIntegerValue(1);d=r.positive32BitValueOf(r.stackValue(2));e=
r.stackIntegerValue(3);l=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(b=Xa(r.stackValue(5),0)))return r.primitiveFailFor(b);b=a(l);if(r.isWords(l)){if(f=!1,b!==3*e&&b!==6*e)return r.primitiveFailFor(3)}else{if(!r.isArray(l)||b!==3*e)return r.primitiveFailFor(3);f=!0}if(!Ka((0===h||0===c?16:21)*e))return r.primitiveFailFor(111);if(!za(c)||!za(d))return r.primitiveFailFor(117);c=ka(c);d=ka(d);if(aa)return r.primitiveFailFor(104);if((0===c||0===h)&&0===d)return r.pop(5);0!==
h&&(h=wb(h),1>h&&(h=1));if(f)a:{b=d;var m,t,g,u,B;for(d=0;d<=e-1;d++){f=r.fetchPointerofObject(3*d,l);Qa(ca(),f);f=r.fetchPointerofObject(3*d+1,l);Qa(pa(),f);f=r.fetchPointerofObject(3*d+2,l);Qa(Ha(),f);if(r.failed())break a;Pa(3);f=ca()[0];g=ca()[1];m=pa()[0];u=pa()[1];t=Ha()[0];B=Ha()[1];if(f===g&&m===u||m===t&&u===B)Ib(h,ca(),Ha(),c,b,0);else{f=eb(ca(),pa(),Ha(),0!==h&&0!==c);if(aa)break a;tc(h,c,b,0,f)}if(aa)break a}}else a:for(l=l.wordsAsInt32Array(),b=3*e===b,f=1;f<=e;f++)if(lc(f-1,l,b,d,0,
h,c),aa)break a;if(aa)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(Y);r.pop(5)},primitiveSetEdgeTransform:function(){var a,b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),0)))return r.primitiveFailFor(a);b=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);z[16]=0;a=g(z,18);b=Ub(b,a,6);!r.failed()&&b&&(z[16]=1,a[2]+=z[46],a[5]+=z[47]);if(r.failed())return r.primitiveFailFor(3);ya(Y);r.pop(1)},getModuleName:function(){return"B2DPlugin 14 November 2014 (e)"},
primitiveGetTimes:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=yb(r.stackValue(1))))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isWords(b)&&9<=a(b)))return r.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[90];b[1]+=z[92];b[2]+=z[94];b[3]+=z[96];b[4]+=z[98];b[5]+=z[100];b[6]+=z[102];b[7]+=z[104];b[8]+=z[106];r.pop(1)},primitiveNextActiveEdgeEntry:function(){var a,b,d;fa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);
a=r.stackValue(1);0===(a=yb(a))&&(6===z[2]?a=0:8===z[2]?a=0:(z[64]=2,a=116));if(0!==a)return r.primitiveFailFor(a);b=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);d=!1;8!==z[2]&&((d=Wa())?(a=S[z[13]],kb(a,b),ja(7)):ja(1));if(r.failed())return null;ya(Y);r.pop(2);r.pushBool(!d);fa&&(W(105,1),W(104,r.ioMicroMSecs()-J))},primitiveAddBitmapFill:function(){var a,b,d,c,h,e,l,f;if(7!==r.methodArgumentCount())return r.primitiveFailFor(5);f=r.stackIntegerValue(0);if(0>=f)return r.primitiveFailFor(3);
h=r.stackObjectValue(1);b=r.stackObjectValue(2);e=r.stackObjectValue(3);l=r.booleanValueOf(r.stackValue(4));a=r.stackObjectValue(5);c=r.stackObjectValue(6);if(r.failed())return r.primitiveFailFor(3);if(0!==(d=Xa(r.stackValue(7),0)))return r.primitiveFailFor(d);Qa(ca(),e);Qa(pa(),b);Qa(Ha(),h);if(r.failed())return r.primitiveFailFor(121);a=Mb(c,a,l?1:0,ca(),pa(),Ha(),f-1);if(aa)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(Y);r.popthenPush(8,r.positive32BitIntegerFor(a))},
primitiveGetDepth:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=yb(r.stackValue(0))))return r.primitiveFailFor(a);r.pop(1);r.pushInteger(z[113])},primitiveAbortProcessing:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=yb(r.stackValue(0))))return r.primitiveFailFor(a);ja(8);ya(Y)},primitiveNextGlobalEdgeEntry:function(){var a,b,d;fa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==
(a=Xa(r.stackValue(1),1)))return r.primitiveFailFor(a);b=r.stackObjectValue(0);if(d=ea())a=Ea[z[11]],kb(a,b),z[11]+=1;if(r.failed())return r.primitiveFailFor(118);d?ja(2):(ja(3),z[69]=1,z[13]=0,bb());ya(Y);r.pop(2);r.pushBool(!d);fa&&(W(95,1),W(94,r.ioMicroMSecs()-J))},primitiveGetFailureReason:function(){var b;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);Ia=r.stackValue(0);if("number"===typeof Ia)return r.primitiveFailFor(101);if(!r.isPointers(Ia))return r.primitiveFailFor(102);if(12>
a(Ia))return r.primitiveFailFor(103);if(0!==(b=Xb(r.fetchPointerofObject(0,Ia))))return r.primitiveFailFor(b);r.pop(1);r.pushInteger(z[64])},primitiveDisplaySpanBuffer:function(){var a;fa&&(J=r.ioMicroMSecs());if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(0),5))||0!==(a=Tb(r.fetchPointerofObject(1,Ia))))return r.primitiveFailFor(a);if(!hb(r.fetchPointerofObject(2,Ia)))return r.primitiveFailFor(122);(P()&z[52])===z[52]&&(ta(P()),dc());8!==z[2]&&(z[13]=0,z[88]=
P()+1,ja(6));ya(Y);fa&&(W(103,1),W(102,r.ioMicroMSecs()-J))},moduleUnloaded:function(a){0===strcmp(a,ia)&&(rb=Ta=0)},primitiveGetCounts:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=yb(r.stackValue(1))))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isWords(b)&&9<=a(b)))return r.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[91];b[1]+=z[93];b[2]+=z[95];b[3]+=z[97];b[4]+=z[99];b[5]+=z[101];b[6]+=z[103];b[7]+=z[105];b[8]+=z[107];
r.pop(1)},primitiveChangedActiveEdgeEntry:function(){var a;fa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),7)))return r.primitiveFailFor(a);a=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);a=mc(a);if(!a)return r.primitiveFailFor(112);0===F[a+7]?Cc():(Ga(),z[13]+=1);ja(6);ya(Y);r.pop(1);fa&&(W(107,1),W(106,r.ioMicroMSecs()-J))},primitiveRenderScanline:function(){var a;if(0!==(a=Dc()))return r.primitiveFailFor(a);Ec();
Ja()},primitiveGetBezierStats:function(){var b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(b=yb(r.stackValue(1))))return r.primitiveFailFor(b);b=r.stackObjectValue(0);if(r.failed()||!(r.isWords(b)&&4<=a(b)))return r.primitiveFailFor(3);b=b.wordsAsInt32Array();b[0]+=z[108];b[1]+=z[109];b[2]+=z[110];b[3]+=z[111];r.pop(1)},primitiveFinishedProcessing:function(){var a;fa&&(J=r.ioMicroMSecs());if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=yb(r.stackValue(0))))return r.primitiveFailFor(a);
a=8===z[2];ya(Y);r.pop(1);r.pushBool(a);fa&&(W(93,1),W(92,r.ioMicroMSecs()-J))},setInterpreter:function(a){r=a;a=1==r.majorVersion();return!1===a?!1:a=11<=r.minorVersion()},primitiveNeedsFlush:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=yb(r.stackValue(0))))return r.primitiveFailFor(a);a=0!==z[63];ya(Y);r.pop(1);r.pushBool(a)},primitiveAddLine:function(){var a,b,d,c,h;if(4!==r.methodArgumentCount())return r.primitiveFailFor(5);c=r.positive32BitValueOf(r.stackValue(0));
d=r.positive32BitValueOf(r.stackValue(1));a=r.stackObjectValue(2);h=r.stackObjectValue(3);if(r.failed())return r.primitiveFailFor(3);if(0!==(b=Xa(r.stackValue(4),0)))return r.primitiveFailFor(b);if(!za(d)||!za(c))return r.primitiveFailFor(117);Qa(ca(),h);Qa(pa(),a);if(r.failed())return r.primitiveFailFor(121);Pa(2);d=ka(d);c=ka(c);if(aa)return r.primitiveFailFor(104);Ib(0,ca(),pa(),0,d,c);if(aa)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);ya(Y);r.pop(4)},primitiveSetOffset:function(){var a;
if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackValue(0);if(n(a)!==r.classPoint())return r.primitiveFailFor(3);Qa(ca(),a);if(r.failed())return r.primitiveFailFor(3);z[46]=ca()[0];z[47]=ca()[1];ya(Y);r.pop(1)},primitiveNextFillEntry:function(){var a,b;fa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),3))||0!==(a=Tb(r.fetchPointerofObject(1,Ia))))return r.primitiveFailFor(a);
if(!jc(r.fetchPointerofObject(3,Ia)))return r.primitiveFailFor(123);0!==z[69]&&(0===(P()&z[52])&&M(),z[69]=0);a=r.stackObjectValue(0);b=Ma();if(aa)return r.primitiveFailFor(104);b&&qb(a);if(r.failed())return r.primitiveFailFor(117);b?ja(4):(bb(),z[35]=0,ja(5));ya(Y);r.pop(2);r.pushBool(!b);fa&&(W(99,1),W(98,r.ioMicroMSecs()-J))},primitiveInitializeBuffer:function(){var b,d;if(1!==r.methodArgumentCount())return r.primitiveFail();d=r.stackObjectValue(0);if(r.failed())return null;if(!r.isWords(d)||256>
(b=a(d)))return r.primitiveFail();z=d.wordsAsInt32Array();F=e(z,128);z[0]=1097753705;z[1]=b;z[10]=b;ja(0);z[8]=128;ya(4);fb(0,256);F[1]=4;F[2]=0;z[11]=0;z[12]=0;z[13]=0;z[14]=0;z[64]=0;z[63]=0;z[42]=0;z[43]=0;z[44]=0;z[45]=0;z[113]=0;z[90]=0;z[92]=0;z[94]=0;z[96]=0;z[98]=0;z[100]=0;z[102]=0;z[104]=0;z[106]=0;z[91]=0;z[93]=0;z[95]=0;z[97]=0;z[99]=0;z[101]=0;z[103]=0;z[105]=0;z[107]=0;z[108]=0;z[109]=0;z[110]=0;z[111]=0;b=g(z,18);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;z[16]=0;b=g(z,24);b[0]=1;b[1]=
0;b[2]=1;b[3]=0;b[4]=1;b[5]=0;b[6]=1;b[7]=0;z[17]=0;r.pop(2);r.push(d)},primitiveDoProfileStats:function(){var a,b;b=fa;a=r.stackObjectValue(0);a=r.booleanValueOf(a);r.failed()||(fa=a,r.pop(2),r.pushBool(b))},primitiveAddActiveEdgeEntry:function(){var a;fa&&(J=r.ioMicroMSecs());if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),2)))return r.primitiveFailFor(a);a=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);a=mc(a);if(!a)return r.primitiveFailFor(112);
if(!Ka(1))return r.primitiveFailFor(111);0<F[a+7]&&jb(a);if(aa)return r.primitiveFailFor(104);ja(1);ya(Y);r.pop(1);fa&&(W(97,1),W(96,r.ioMicroMSecs()-J))},primitiveSetAALevel:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackIntegerValue(0);if(r.failed())return r.primitiveFailFor(3);ab(a);ya(Y);r.pop(1)},primitiveNeedsFlushPut:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);
if(0!==(a=yb(r.stackValue(1))))return r.primitiveFailFor(a);a=r.booleanValueOf(r.stackValue(0));if(r.failed())return r.primitiveFailFor(3);z[63]=!0===a?1:0;ya(Y);r.pop(1)},primitiveAddCompressedShape:function(){var b,d,c,h,e,l,f,m;if(7!==r.methodArgumentCount())return r.primitiveFailFor(5);d=r.stackObjectValue(0);h=r.stackObjectValue(1);e=r.stackObjectValue(2);m=r.stackObjectValue(3);c=r.stackObjectValue(4);l=r.stackIntegerValue(5);f=r.stackObjectValue(6);if(r.failed())return r.primitiveFailFor(3);
if(0!==(b=Xa(r.stackValue(7),0)))return r.primitiveFailFor(b);r.isWords(f)?(b=a(f),b=b!==3*l&&b!==6*l?!1:!0):b=!1;if(b){b:{var t,g,u;if(r.isWords(d)){u=a(d);t=d.wordsAsInt32Array();for(g=0;g<=u-1;g++)if(b=t[g],!za(b)){b=!1;break b}b=!0}else b=!1}if(b)if(b=a(d),D(c,b,l)&&D(m,b,l)&&D(h,b,l)){var B;t=a(e);u=e.wordsAsInt32Array();for(b=g=0;b<=t-1;b++)B=(u[b]|0)>>>16,g+=B;b=g!==l?!1:!0}else b=!1;else b=!1}else b=!1;if(!b)return r.primitiveFailFor(120);if(!Ka(Math.max(16,16)*l))return r.primitiveFailFor(111);
b=a(f)===3*l;a:{f=f.wordsAsInt32Array();c=c.wordsAsInt32Array();m=m.wordsAsInt32Array();e=e.wordsAsInt32Array();h=h.wordsAsInt32Array();d=d.wordsAsInt32Array();var y,k,N,w,n,q,C,p,v;if(0!==l)for(u=n=p=k=-1,g=w=C=y=1,B=q=v=N=0,t=1;t<=l;t++){if(0>=--g&&(++u,g=(c[u]|0)>>>16,B=(c[u]|0)&65535,0!==B&&(B=d[B-1],B=ka(B),aa)))break a;0>=--w&&(++n,w=(m[n]|0)>>>16,q=(m[n]|0)&65535,0!==q&&(q=d[q-1],q=ka(q)));0>=--C&&(++p,C=(e[p]|0)>>>16,v=(e[p]|0)&65535,0!==v&&(v=wb(v)));0>=--y&&(++k,y=(h[k]|0)>>>16,N=(h[k]|
0)&65535,0!==N&&(N=d[N-1]));lc(t-1,f,b,B,q,v,N);if(aa)break a}}if(aa)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(Y);r.pop(7)},primitiveSetColorTransform:function(){var a;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),0)))return r.primitiveFailFor(a);a=r.stackObjectValue(0);if(r.failed())return r.primitiveFailFor(3);var b;b=g(z,24);z[17]=0;Ub(a,b,8)&&(z[17]=1,b[1]*=256,b[3]*=256,b[5]*=256,b[7]*=256);if(r.failed())return r.primitiveFailFor(119);
ya(Y);r.pop(1)},primitiveAddOval:function(){var a,b,d,c,h,e;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);a=r.positive32BitValueOf(r.stackValue(0));b=r.stackIntegerValue(1);h=r.positive32BitValueOf(r.stackValue(2));d=r.stackObjectValue(3);e=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(c=Xa(r.stackValue(5),0)))return r.primitiveFailFor(c);if(!za(a)||!za(h))return r.primitiveFailFor(117);h=ka(h);a=ka(a);if(aa)return r.primitiveFailFor(104);if(0===h&&(0===a||
0>=b))return r.pop(5);if(!Ka(256))return r.primitiveFailFor(111);b=0<b&&0!==a?wb(b):0;Qa(ca(),e);Qa(pa(),d);if(r.failed())return r.primitiveFailFor(121);a:{var l,f,m;m=pa()[0]-ca()[0]>>1;e=pa()[1]-ca()[1]>>1;d=pa()[0]+ca()[0]>>1;c=pa()[1]+ca()[1]>>1;for(l=0;15>=l;l++){var t=l,g=m,u=e,B=d,y=c,k,w,n;f=v()[2*t+0]*g+B|0;w=N()[2*t+0]*u+y|0;ca()[0]=f;ca()[1]=w;k=v()[2*t+2]*g+B|0;n=N()[2*t+2]*u+y|0;Ha()[0]=k;Ha()[1]=n;g=v()[2*t+1]*g+B|0;t=N()[2*t+1]*u+y|0;g=2*g-(f+k>>1);t=2*t-(w+n>>1);pa()[0]=g;pa()[1]=
t;Pa(3);f=eb(ca(),pa(),Ha(),0!==b&&0!==a);if(aa)break a;tc(b,a,0,h,f);if(aa)break a}}if(aa)return bb(),r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(Y);r.pop(5)},primitiveRegisterExternalFill:function(){var a,b;if(1!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=Xa(r.stackValue(1),0)))return r.primitiveFailFor(a);b=r.stackIntegerValue(0);if(r.failed())return r.primitiveFailFor(3);for(a=0;0===a;){if(!q(10))return r.primitiveFailFor(111);a=Y;Y=a+4;
fb(a,256);F[a+1]=4;F[a+2]=b}r.failed()||(ya(Y),r.pop(2),r.pushInteger(a))},primitiveAddPolygon:function(){var b,d,c,h,e,l,f;if(5!==r.methodArgumentCount())return r.primitiveFailFor(5);c=r.positive32BitValueOf(r.stackValue(0));h=r.stackIntegerValue(1);d=r.positive32BitValueOf(r.stackValue(2));e=r.stackIntegerValue(3);l=r.stackObjectValue(4);if(r.failed())return r.primitiveFailFor(3);if(0!==(b=Xa(r.stackValue(5),0)))return r.primitiveFailFor(b);b=a(l);if(r.isWords(l)){if(f=!1,b!==e&&2*e!==b)return r.primitiveFailFor(3)}else{if(!r.isArray(l)||
b!==e)return r.primitiveFailFor(3);f=!0}if(!Ka((0===h||0===c?16:21)*e))return r.primitiveFail();if(!za(c)||!za(d))return r.primitiveFailFor(117);c=ka(c);d=ka(d);if(aa)return r.primitiveFailFor(104);if((0===c||0===h)&&0===d)return r.pop(5);0!==h&&(h=wb(h));if(f)a:{var m,t,g;Qa(ca(),r.fetchPointerofObject(0,l));if(!r.failed())for(f=ca()[0],t=ca()[1],b=1;b<=e-1;b++){Qa(ca(),r.fetchPointerofObject(b,l));if(r.failed())break a;m=ca()[0];g=ca()[1];ca()[0]=f;ca()[1]=t;pa()[0]=m;pa()[1]=g;Pa(2);Ib(h,ca(),
pa(),c,d,0);if(aa)break a;f=m;t=g}}else a:{l=l.wordsAsInt32Array();b=e===b;var u;b?(m=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[0],g=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[1]):(m=l[0]|0,g=l[1]|0);for(f=1;f<=e-1;f++){b?(t=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[2*f],u=(l.int16Array||(l.int16Array=new Int16Array(l.buffer,l.byteOffset)))[2*f+1]):(t=l[2*f]|0,u=l[2*f+1]|0);ca()[0]=m;ca()[1]=g;pa()[0]=t;pa()[1]=u;Pa(2);
Ib(h,ca(),pa(),c,d,0);if(aa)break a;m=t;g=u}}if(aa)return r.primitiveFailFor(104);if(r.failed())return r.primitiveFailFor(119);z[63]=1;ya(Y);r.pop(5)},primitiveGetAALevel:function(){var a;if(0!==r.methodArgumentCount())return r.primitiveFailFor(5);if(0!==(a=yb(r.stackValue(0))))return r.primitiveFailFor(a);r.pop(1);r.pushInteger(z[48])}})});module("users.bert.SqueakJS.plugins.BitBltPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?J.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a,b){return Math.floor(a/b)|0}function e(a,b){return 31<b?0:a<<b}function g(a,b){return 31<b?0:a>>>b}function k(a,b){return 0>b?-31>b?0:a>>>0-b:31<
b?0:a<<b}function f(a,b){var d,c;if(16>R){d=a^b;for(c=Y[R];0!==d;)0!==(d&c)&&++ub,d=g(d,R);return b}16===R?(d=Mb(a,b,5,3),ub=ub+(d&31)+(d>>>5&31)+(d>>>10&31),d=Mb(a>>>16,b>>>16,5,3),ub=ub+(d&31)+(d>>>5&31)+(d>>>10&31)):(d=Mb(a,b,8,3),ub=ub+(d&255)+(d>>>8&255)+(d>>>16&255));return b}function d(a,b){var d,c,h,e;if(5!==(Ra&5))return b;if(16>R){d=Y[R]&Za;e=b;for(h=1;h<=na;h++)c=e&d,Va[c&Za]+=1,e=g(e,R);return b}16===R?(c=Ka(b&65535,5,nb),Va[c&Za]+=1,c=Ka(b>>>16,5,nb)):c=Ka(b,8,nb);Va[c&Za]+=1;return b}
function p(a,b){return a+b}function A(a,b){var d,c,h;h=a>>>24;if(0===h)return b;if(255===h)return a;d=255-h;c=(a&16711935)*h+(b&16711935)*d+16711935;d=((a>>>8|16711680)&16711935)*h+(b>>>8&16711935)*d+16711935;return c+(c-65537>>>8&16711935)>>>8&16711935|(d+(d-65537>>>8&16711935)>>>8&16711935)<<8}function x(a,b){return q(a,b,!1)}function q(a,b,d){var h,l,f,m,t,u,B,y,k,N,w;if(16>R)return b;y=255-oc;m=b;if(1===na)d&&0===a||(d=(a&16711935)*oc+(b&16711935)*y+16711935,y=(a>>>8&16711935)*oc+(b>>>8&16711935)*
y+16711935,m=d+(d-65537>>>8&16711935)>>>8&16711935|(y+(y-65537>>>8&16711935)>>>8&16711935)<<8);else for(h=Y[R],w=ka,f=a,l=1;l<=na;l++){u=f&h;if(!(0===(w&h)||d&&0===u)){k=b&h;a=0;for(B=1;3>=B;B++)t=5*(B-1),N=c((g(u,t)&31)*oc+(g(k,t)&31)*y+254,255)&31,a|=e(N,t);m=m&~e(h,16*(l-1))|e(a,16*(l-1))}w=g(w,R);f=g(f,R);b=g(b,R)}return m}function m(a,b){var d,c;d=255-(a>>>24);c=((b&16711935)*d>>>8&16711935)+(a&16711935);d=((b>>>8&16711935)*d>>>8&16711935)+(a>>>8&16711935);return(d&16711935)<<8|255*(d&16777472)|
c&16711935|255*(c&16777472)>>>8}function h(a,b){return 0===a?b:q(a,b,!0)}function t(a,b){return a&b}function B(a,b){return a&~b}function l(a,b){return~a&b}function u(a,b){return~a&~b}function y(a,b){return~b}function G(a,b){return~a|b}function w(a,b){return~a|~b}function L(a,b){return~a}function I(a,b){return~a^b}function E(a,b){return a|b}function K(a,b){return a|~b}function H(a,b){return a^b}function C(a,b){return 0}function D(){$a>=Ca?(Fa=pc,S=$a,ma=$b):(Fa=pc+(Ca-$a),ma=$b-(Ca-$a),S=Ca);S+ma>
Ca+Eb&&(ma-=S+ma-(Ca+Eb));bb>=Da?(Oa=Ac,ia=bb,ga=Db):(Oa=Ac+Da-bb,ga=Db-(Da-bb),ia=Da);ia+ga>Da+ja&&(ga-=ia+ga-(Da+ja));if(Ob)return null;0>Fa&&(S-=Fa,ma+=Fa,Fa=0);Fa+ma>hc&&(ma-=Fa+ma-hc);0>Oa&&(ia-=Oa,ga+=Oa,Oa=0);Oa+ga>ec&&(ga-=Oa+ga-ec)}function v(){D();if(0>=ma||0>=ga)return Ga=ab=Ya=Ua=0,null;if(!lb())return J.primitiveFail();N();sc()}function N(){Q();if(J.failed())return J.primitiveFail();if(gc())return null;if(30===Ja||31===Ja)if(1===J.methodArgumentCount()){if(oc=J.stackIntegerValue(0),J.failed()||
!(0<=oc&&255>=oc))return J.primitiveFail()}else return J.primitiveFail();ub=0;X();if(Ob){var a,b,d,h,l,f;d=ua[Ja+1];d;for(f=1;f<=ga;f++){b=z?4294967295:la(ia+f-1);ka=Ta;h=da[ha>>>2];a=d(b,h);h=ka&a|h&~ka;da[ha>>>2]=h;ha+=4;ka=4294967295;if(3===Ja)for(h=b,l=2;l<=ba-1;l++)da[ha>>>2]=h,ha+=4;else for(l=2;l<=ba-1;l++)h=da[ha>>>2],a=d(b,h),da[ha>>>2]=a,ha+=4;1<ba&&(ka=F,h=da[ha>>>2],a=d(b,h),h=ka&a|h&~ka,da[ha>>>2]=h,ha+=4);ha+=Wb}}else if(Jb===vb&&ia>=Oa&&(ia>Oa?(kc=-1,Oa=Oa+ga-1,ia=ia+ga-1):ia===Oa&&
S>Fa&&(mb=-1,Fa=Fa+ma-1,S=S+ma-1,1<ba&&(a=Ta,Ta=F,F=a)),ha=ia*Pa+4*c(S,na),Wb=Pa*kc-4*ba*mb),cb!==R||0!==Ra||fc!==db)M();else{h=na-1;b=Fa&h;a=S&h;0<mb?(d=Math.min(ma,na-a),uc=b+d>h):(d=Math.min(ma,a+1),uc=0>b-d+1);zb=fc?(b-a)*R:(a-b)*R;uc&&(zb=0>zb?zb+32:zb-32);ob=Oa*tb+4*c(Fa,c(32,cb));vc=tb*kc-4*ba*mb;uc&&(vc-=4*mb);var m,t,u,B,y,N;h=ua[Ja+1];h;l=4*mb;-32===zb?zb=d=a=0:0>zb?(d=zb+32,a=e(4294967295,0-zb)):0===zb?(d=0,a=4294967295):(d=zb-32,a=g(4294967295,zb));N=~a;z?(b=4294967295,Ia=0):b=la(0);u=
ia;for(B=1;B<=ga;B++){1<Ia&&(b=la(u),u+=kc);uc?(f=Ba[ob>>>2],ob+=l):f=0;ka=Ta;y=Ba[ob>>>2];ob+=l;m=k(f&N,d)|k(y&a,zb);f=y;t=da[ha>>>2];m=h(m&b,t);t=ka&m|t&~ka;da[ha>>>2]=t;ha+=l;ka=4294967295;if(3===Ja)if(0===zb&&4294967295===b)if(-1===mb)for(t=2;t<=ba-1;t++)y=Ba[ob>>>2],ob+=l,da[ha>>>2]=y,ha+=l;else for(t=2;t<=ba-1;t++)da[ha>>>2]=f,ha+=l,f=Ba[ob>>>2],ob+=l;else for(t=2;t<=ba-1;t++)y=Ba[ob>>>2],ob+=l,m=k(f&N,d)|k(y&a,zb),f=y,da[ha>>>2]=m&b,ha+=l;else for(t=2;t<=ba-1;t++)y=Ba[ob>>>2],ob+=l,m=k(f&N,
d)|k(y&a,zb),f=y,m=h(m&b,da[ha>>>2]),da[ha>>>2]=m,ha+=l;1<ba&&(ka=F,y=Ba[ob>>>2],ob+=l,m=k(f&N,d)|k(y&a,zb),t=da[ha>>>2],m=h(m&b,t),t=ka&m|t&~ka,da[ha>>>2]=t,ha+=l);ob+=vc;ha+=Wb}}if(22===Ja||32===Ja)Ga=ab=Ya=Ua=0;0<mb?(Ga=S,ab=S+ma):(Ga=S-ma+1,ab=S+1);0<kc?(Ya=ia,Ua=ia+ga):(Ya=ia-ga+1,Ua=ia+1)}function Q(){var a;if(41===Ja)if(zc=255,Hb=16777215,Yb=rb=null,2<=J.methodArgumentCount()){zc=J.stackIntegerValue(J.methodArgumentCount()-2);if(J.failed())return J.primitiveFail();Hb=J.stackIntegerValue(J.methodArgumentCount()-
1);if(J.failed())return J.primitiveFail();4===J.methodArgumentCount()&&(a=J.stackObjectValue(1),J.isBytes(a)&&(rb=a.bytes),a=J.stackObjectValue(0),J.isBytes(a)&&(Yb=a.bytes))}else if(1===J.methodArgumentCount()){if(Hb=J.stackIntegerValue(0),J.failed())return J.primitiveFail()}else return J.primitiveFail()}function M(){var a,b,d,h,l,f,m,t,u,B,y,k,N,w,n,q,C;u=ua[Ja+1];u;Zb=c(32,cb);h=Y[cb];N=Y[R];a=Ra&-9;ob=Oa*tb+4*c(Fa,Zb);b=Zb-(Fa&Zb-1);b=ma<b?0:c(ma-b,Zb)+1;vc=tb-4*b;t=na-(S&na-1);q=(S+ma-1&na-1)+
1;ma<t&&(t=ma);n=(Fa&Zb-1)*cb;B=(S&na-1)*R;b=cb;w=R;d=0;fc&&(n=32-cb-n,b=0-b);db&&(B=32-R-B,w=0-w,d=32-R);for(y=1;y<=ga;y++){k=z?4294967295:la(ia+y-1);wc=n;Na=B;ka=Ta;C=t;f=ba;do{m=a;l=h;var p=N,v=b,x=w,r,A,Q,G,M;Q=Ba[ob>>>2];M=0;A=wc;G=Na;if(5===m){do r=g(Q,A)&l,r=Va[r&Za],M|=e(r&p,G),G+=x,0!==((A+=v)&4294967264)&&(A=fc?A+32:A-32,Q=Ba[(ob+=4)>>>2]);while(0!==--C)}else{do r=g(Q,A)&l,r=gb(r,m),M|=e(r&p,G),G+=x,0!==((A+=v)&4294967264)&&(A=fc?A+32:A-32,Q=Ba[(ob+=4)>>>2]);while(0!==--C)}wc=A;l=M;Na=d;
4294967295===ka?(l=u(l&k,da[ha>>>2]),da[ha>>>2]=ka&l):(m=da[ha>>>2],l=u(l&k,m&ka),m=ka&l|m&~ka,da[ha>>>2]=m);ha+=4;2===f?(ka=F,C=q):(ka=4294967295,C=na)}while(0!==--f);ob+=vc;ha+=Wb}}function O(){return[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,
4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,
4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,
4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,
4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,
4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}function V(a,b,d){return b>
a?c(b-a+16384,d+1)+1:b===a?0:0-(c(a-b+16384,d+1)+1)}function X(){var a,b,d;d=na-1;b=na-(S&d);Ta=db?g(4294967295,32-b*R):e(4294967295,32-b*R);a=(S+ma-1&d)+1;F=db?e(4294967295,32-a*R):g(4294967295,32-a*R);ma<b?(Ta&=F,F=0,ba=1):ba=c(ma-b+d,na)+1;mb=kc=1;ha=ia*Pa+4*c(S,na);Wb=Pa*kc-4*ba*mb}function P(a,b){return b}function ta(a,b){var d;d=b<<8;return(Pb[d+(a>>>16&255)]<<10)+(Pb[d+(a>>>8&255)]<<5)+Pb[d+(a&255)]}function U(a,b,d){var c;c=da[a>>>2];da[a>>>2]=c&d|b}function Z(a,b){var d;d=J.fetchPointerofObject(a,
b);if("number"===typeof d)return d;d=J.floatValueOf(d);return-2147483648<=d&&2147483647>=d?d|0:(J.primitiveFail(),0)}function T(a,b,d){a=J.fetchPointerofObject(a,b);if("number"===typeof a)return a;if(a.isNil)return d;d=J.floatValueOf(a);return-2147483648<=d&&2147483647>=d?d|0:(J.primitiveFail(),0)}function xa(a,b){return 32!==R?b:0===b?0:0!==(b&4278190080)?b:b|a&4278190080}function la(a){var b=Fb,d=Ia;a=a-c(a,d)*d|0;return b[a]}function wa(a){return a.isNil||0===Ja||5===Ja||10===Ja||15===Ja?!0:!1}
function La(){var a;da=J.fetchPointerofObject(0,vb);wb=J.fetchIntegerofObject(1,vb);Gb=J.fetchIntegerofObject(2,vb);if(!(0<=wb&&0<=Gb))return!1;R=J.fetchIntegerofObject(3,vb);db=0<R;0>R&&(R=0-R);if("number"===typeof da){if(!Qa(da))return!1;na=c(32,R);da=Pa=0}else{na=c(32,R);Pa=4*c(wb+(na-1),na);a=b(da);if(!J.isWordsOrBytes(da)||a!==Pa*Gb)return!1;da=da.wordsOrBytes()}return!0}function ea(a){return Ma(a,!1)}function Ma(b,d){var c;oa=b;Ea=d;Ja=J.fetchIntegerofObject(3,oa);if(J.failed()||0>Ja||41<Ja||
16<=Ja&&17>=Ja)return!1;Jb=J.fetchPointerofObject(1,oa);Ob=wa(Jb);fa=J.fetchPointerofObject(2,oa);z=wa(fa);vb=J.fetchPointerofObject(0,b);if(!(J.isPointers(vb)&&4<=a(vb)))return!1;c=La();if(!c)return!1;$a=T(4,oa,0);bb=T(5,oa,0);$b=T(6,oa,wb);Db=T(7,oa,Gb);if(J.failed())return!1;if(Ob)pc=Ac=0;else{if(!(J.isPointers(Jb)&&4<=a(Jb)))return!1;c=Wa();if(!c)return!1;c=ra();if(!c)return!1;0===(Ra&8)&&Ha();pc=T(8,oa,0);Ac=T(9,oa,0)}c=Sa();if(!c)return!1;Ca=T(10,oa,0);Da=T(11,oa,0);Eb=T(12,oa,wb);ja=T(13,oa,
Gb);if(J.failed())return!1;0>Ca&&(Eb+=Ca,Ca=0);0>Da&&(ja+=Da,Da=0);Ca+Eb>wb&&(Eb=wb-Ca);Da+ja>Gb&&(ja=Gb-Da);return!0}function Wa(){var a;Ba=J.fetchPointerofObject(0,Jb);hc=Z(1,Jb);ec=Z(2,Jb);if(!(0<=hc&&0<=ec))return!1;cb=J.fetchIntegerofObject(3,Jb);fc=0<cb;0>cb&&(cb=0-cb);if("number"===typeof Ba){if(!Dc(Ba))return!1;Zb=c(32,cb);Ba=tb=0}else{Zb=c(32,cb);tb=4*c(hc+(Zb-1),Zb);a=b(Ba);if(!J.isWordsOrBytes(Ba)||a!==tb*ec)return!1;Ba=Ba.wordsOrBytes()}return!0}function ra(){var b,d,c;Ra=Za=nb=0;Va=kb=
qb=null;b=J.fetchPointerofObject(14,oa);if(b.isNil)return!0;Ra=1;c=!1;if(J.isWords(b))d=a(b),Va=b.words,c=!0;else{if(!(J.isPointers(b)&&3<=a(b)))return!1;qb=sa(J.fetchPointerofObject(0,b));kb=sa(J.fetchPointerofObject(1,b));b=J.fetchPointerofObject(2,b);if(b.isNil)d=0;else{if(!J.isWords(b))return!1;d=a(b);Va=b.words}Ra|=8}if(0!==(d&d-1))return!1;Za=d-1;nb=0;512===d&&(nb=3);4096===d&&(nb=4);32768===d&&(nb=5);0===d?(Va=null,Za=0):Ra|=4;c&&Ha();d=qb&&kb?0===qb[0]&&0===qb[1]&&0===qb[2]&&0===qb[3]&&16711680===
kb[0]&&65280===kb[1]&&255===kb[2]&&4278190080===kb[3]?!0:!1:!0;d?qb=kb=null:Ra|=2;return!0}function sa(b){return b.isNil?null:"number"!==typeof b&&J.isWords(b)&&4===a(b)?b.words:(J.primitiveFail(),null)}function Sa(){var b;if(z)return Fb=null,!0;if(J.isPointers(fa)&&4<=a(fa))b=J.fetchPointerofObject(0,fa),Ia=J.fetchIntegerofObject(2,fa),J.isWords(b)||(z=!0);else{if(J.isPointers(fa)||!J.isWords(fa))return!1;b=fa;Ia=a(b)}Fb=b.wordsOrBytes();return!0}function W(){nc=J.ioLoadFunctionFrom("ioGetSurfaceFormat",
"SurfacePlugin");r=J.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin");xc=J.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin");return!!nc&&!!r&&!!xc}function lb(){var a,b,d,c,h,e;aa=!1;if(0===da){if(!r&&!W())return null;d=r;a=J.fetchIntegerofObject(0,vb);if(0===Ba&&!Ob&&(b=J.fetchIntegerofObject(0,Jb),b===a))return Ea?(e=Math.min(Fa,S),c=Math.max(Fa,S)+ma,a=Math.min(Oa,ia),h=Math.max(Oa,ia)+ga,Ba=d(b,function(a){tb=a},e,a,c-e,h-a)):Ba=d(b,function(a){tb=a},0,0,hc,ec),da=Ba,Pa=tb,aa=!0,0!==da;
da=d(a,function(a){Pa=a},S,ia,ma,ga);aa=!0}if(0===Ba&&!Ob){b=J.fetchIntegerofObject(0,Jb);if(!r&&!W())return null;d=r;Ba=Ea?d(b,function(a){tb=a},0,0,hc,ec):d(b,function(a){tb=a},Fa,Oa,ma,ga);aa=!0}return 0!==da&&(0!==Ba||Ob)}function gb(a,b){var d;d=a;0!==(b&1)&&(0!==(b&2)&&(d=k(a&kb[0],qb[0]),d|=k(a&kb[1],qb[1]),d|=k(a&kb[2],qb[2]),d|=k(a&kb[3],qb[3]),0===d&&0!==a&&(d=1)),0!==(b&4)&&(d=Va[d&Za]));return d}function jb(a,b,d,c){var h,l,f;f=Y[d];h=0;for(l=1;l<=c;l++)(a&f)===f&&(h|=b&f),f=e(f,d);return h}
function za(a,b,d,c,h){var e;e=a&h;h&=b;a=(a^e)+(b^h);return a^e^h|g(e&h|(e|h)&a,d-1)*c}function va(a,b,d,c){var h,l,f;f=Y[d];h=0;for(l=1;l<=c;l++)h|=Math.max(b&f,a&f),f=e(f,d);return h}function eb(a,b,d,c){var h,l,f;f=Y[d];h=0;for(l=1;l<=c;l++)h|=Math.min(b&f,a&f),f=e(f,d);return h}function hb(a,b,d,c){var h,l,f,m;m=Y[d];h=e(m,d);l=g(((a&m)+1)*((b&m)+1)-1&h,d);if(1===c)return l;f=((g(a,d)&m)+1)*((g(b,d)&m)+1)-1&h;l|=f;if(2===c)return l;f=((g(a,2*d)&m)+1)*((g(b,2*d)&m)+1)-1&h;l|=e(f,d);if(3===c)return l;
f=((g(a,3*d)&m)+1)*((g(b,3*d)&m)+1)-1&h;return l|=e(f,2*d)}function Mb(a,b,d,c){var h,l,f,m,t;t=Y[d];l=0;for(m=1;m<=c;m++)f=a&t,h=b&t,l=f<h?l|h-f:l|f-h,t=e(t,d);return l}function rc(a,b){var d,c;if(0>a||0>b||(c=a>>>14)>=hc||(d=b>>>14)>=ec)return 0;d=d*tb+4*g(c,Gc);d=Ba[d>>>2];wc=Hc[c&Fc];return g(d,wc)&Ic}function lc(a,b){var d,c,h,l,f;if(32===R)return a===b?0:b;c=R;f=Y[c];h=0;for(l=1;l<=na;l++)d=b&f,(a&f)===d&&(d=0),h|=d,f=e(f,c);return h}function mc(a,b){return jb(~a,b,R,na)}function Sb(a,b){return 0===
a?b:a|jb(~a,b,R,na)}function jc(a,b){var d,c,h,l,f;if(1===na)return b;d=0;h=e(1,R)-1;l=e(h,(na-1)*R);c=32-R;d|=e(b&h,c)|g(b&l,c);if(2>=na)return d;for(f=2;f<=na>>1;f++)h=e(h,R),l=g(l,R),c-=2*R,d|=e(b&h,c)|g(b&l,c);return d}function Qa(a){return nc||W()?nc(a,function(a,b,d,c){wb=a;Gb=b;R=d;db=c}):!1}function Dc(a){return nc||W()?nc(a,function(a,b,d,c){hc=a;ec=b;cb=d;fc=c}):!1}function Tb(a,b){var d,h;return 16>R?(h=e(1,R)-1,d=e(c(4294967295,h),R-1),za(a,b,R,h,d)):16===R?za(a&2147450879,b&2147450879,
5,31,1108361744):za(a,b,8,255,2155905152)}function Ub(a,b){var d,c,h,e,l,f,m,t;e=a;if(0===e)return b;c=Hb;f=zc&255;m=e&255;e>>>=8;d=e&255;e>>>=8;l=e&255;e=e>>>8&255;255!==f&&(e=e*f>>>8,l=l*f>>>8,d=d*f>>>8,m=m*f>>>8);f=b;h=f&255;t=c&255;Yb&&(h=Yb[h],t=Yb[t]);m=(h*(255-m)>>>8)+(t*m>>>8);255<m&&(m=255);rb&&(m=rb[m]);f>>>=8;c>>>=8;h=f&255;t=c&255;Yb&&(h=Yb[h],t=Yb[t]);d=(h*(255-d)>>>8)+(t*d>>>8);255<d&&(d=255);rb&&(d=rb[d]);f>>>=8;h=f&255;t=c>>>8&255;Yb&&(h=Yb[h],t=Yb[t]);c=(h*(255-l)>>>8)+(t*l>>>8);
255<c&&(c=255);rb&&(c=rb[c]);e=((f>>>8&255)*(255-e)>>>8)+e;255<e&&(e=255);return(((e<<8)+c<<8)+d<<8)+m}function tc(a,b){if(0===a)return b;var d=R,c=na,h,l,f,m,t;t=Y[d];l=0;for(m=1;m<=c;m++)f=g(a&t,(m-1)*d),h=g(b&t,(m-1)*d),32!==d&&(16===d?(f=Xb(f)|4278190080,h=Xb(h)|4278190080):(f=Ka(f,d,32)|4278190080,h=Ka(h,d,32)|4278190080)),h=Ub(f,h),32!==d&&(h=Ka(h,32,d)),l|=e(h,(m-1)*d),t=e(t,d);return l}function Ib(a,b){var d,c,h,e,l,f,m,t,u;e=Y[R];16===R?(c=5,l=31):(c=8,l=255);t=ka;f=b;h=a;for(m=1;m<=na;m++)0<
(t&e)&&(u=f&e,d=h&e,16>R?d=d===u?0:1:(d=Mb(d,u,c,3),d=(d&l)+(g(d,c)&l)+(g(g(d,c),c)&l)),ub+=d),t=g(t,R),h=g(h,R),f=g(f,R);return b}function Xb(a){return(a&31)<<3|(a&992)<<6|(a&31744)<<9}function Ka(a,b,d){var c,h;if(0<(c=d-b))return b=e(1,b)-1,h=e(a,c),b=e(b,c),a=h&b,b=e(b,d),h=e(h,c),a+(h&b)+(e(h,c)&e(b,d));if(0===c)return 5===b?a&32767:8===b?a&16777215:a;if(0===a)return a;c=b-d;b=e(1,d)-1;h=g(a,c);a=h&b;b=e(b,d);h=g(h,c);a=a+(h&b)+(g(h,c)&e(b,d));return 0===a?1:a}function ya(a,b){return 16>R?va(a,
b,R,na):16===R?va(a,b,5,3)+(va(a>>>16,b>>>16,5,3)<<16):va(a,b,8,4)}function sb(a,b){return 16>R?eb(a,b,R,na):16===R?eb(a,b,5,3)+(eb(a>>>16,b>>>16,5,3)<<16):eb(a,b,8,4)}function fb(a,b){var d;d=~a;return 16>R?eb(d,b,R,na):16===R?eb(d,b,5,3)+(eb(d>>>16,b>>>16,5,3)<<16):eb(d,b,8,4)}function ca(a,b){return 16>R?hb(a,b,R,na):16===R?hb(a,b,5,3)+(hb(a>>>16,b>>>16,5,3)<<16):hb(a,b,8,4)}function pa(a,b){return 16>R?Mb(a,b,R,na):16===R?Mb(a,b,5,3)+(Mb(a>>>16,b>>>16,5,3)<<16):Mb(a,b,8,4)}function Ha(){var a,
b;a=b=0;if(8>=cb)return null;16===cb&&(a=5);32===cb&&(a=8);if(0===nb){if(8>=R)return null;16===R&&(b=5);32===R&&(b=8)}else b=nb;dc(a,b)}function dc(a,b){var d=[0,0,0,0],c=[0,0,0,0],h,l;h=b-a;if(0===h)return 0;0>=h?(l=e(1,b)-1,c[0]=e(l,2*a-h),c[1]=e(l,a-h),c[2]=e(l,0-h),c[3]=0):(l=e(1,a)-1,c[0]=e(l,2*a),c[1]=e(l,a),c[2]=l);d[0]=3*h;d[1]=2*h;d[2]=h;d[3]=0;qb=d;kb=c;Ra|=3}function Nb(){J.showDisplayBitsLeftTopRightBottom(vb,Ga,Ya,ab,Ua)}function Ec(a,b){return a}function yb(a,b){return a-b}function Xa(a,
b){var d,c,h,e,l;if(5!==(Ra&5))return b;d=Y[R];h=b;l=ka;for(e=1;e<=na;e++)0!==(l&d)&&(c=h&d,c=16>R?c:16===R?Ka(c,5,nb):Ka(c,8,nb),Va[c&Za]+=1),l=g(l,R),h=g(h,R);return b}function gc(){if(Ob||34!==Ja&&41!==Ja||32!==cb||Jb===vb)return!1;if(41===Ja){if(32===R){var a,b,d,h,l,f,t,u;f=ga+1;t=Oa;for(u=ia;0!==--f;){b=t*tb+4*Fa;h=u*Pa+4*S;for(d=ma+1;0!==--d;)if(a=Ba[b>>>2],l=a&16777215,0===l){b+=4;for(h+=4;0!==--d&&0===(Ba[b>>>2]&16777215);)b+=4,h+=4;++d}else l=da[h>>>2],l=Ub(a,l),da[h>>>2]=l,b+=4,h+=4;++t;
++u}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}if(16===R){var B,y,k,N,w;y=ga+1;k=Oa;N=ia;d=16*(S&1);db&&(d=16-d);for(Ta=e(65535,16-d);0!==--y;){f=k*tb+4*Fa;u=N*Pa+4*(S>>1);a=4*(N&3);w=(Fa&3)-1;t=ma+1;l=Ta;for(d=65535===l?16:0;0!==--t;)b=qa[a+(w=w+1&3)],h=Ba[f>>>2],B=h&16777215,0!==B&&(B=da[u>>>2],B&=~l,B=g(B,d),B=(B&31744)<<9|(B&992)<<6|(B&31)<<3|4278190080,h=Ub(h,B),h=ta(h,b),h=0===h?e(1,d):e(h,d),U(u,h,l)),f+=4,db?0===d&&(u+=4):0!==d&&(u+=4),d^=16,l=~l;++k;++N}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}if(8===
R){f=O();l=Ra&-9;k=ga+1;N=Oa;w=ia;Ta=8*(S&3);db&&(Ta=24-Ta);F=4294967295^e(255,Ta);u=0===(S&1)?0:522133279;for(0===(ia&1)&&(u^=522133279);0!==--k;){u^=522133279;d=N*tb+4*Fa;t=w*Pa+4*(S>>2);h=ma+1;a=Ta;for(y=F;0!==--h;)b=(Ba[d>>>2]&~u)+u,B=b&16777215,B=c((B>>>16)+(B>>>8&255)+(B&255),3),31<B&&(224<B&&(b=4294967295),B=da[t>>>2],B&=~y,B=g(B,a),B=f[B],b=Ub(b,B),b=gb(b,l),b=e(b,a),U(t,b,y)),d+=4,db?0===a?(t+=4,a=24,y=16777215):(a-=8,y=y>>>8|4278190080):32===a?(t+=4,a=0,y=4294967040):(a+=8,y=y<<8|255),u^=
522133279;++N;++w}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}return!1}if(8>R||8===R&&0===(Ra&1))return!1;if(32===R)for(f=ga+1,t=Oa,u=ia;0!==--f;){b=t*tb+4*Fa;h=u*Pa+4*S;for(d=ma+1;0!==--d;)if(a=Ba[b>>>2],l=a>>>24,255===l){da[h>>>2]=a;b+=4;for(h+=4;0!==--d&&255===(a=Ba[b>>>2])>>>24;)da[h>>>2]=a,b+=4,h+=4;++d}else if(0===l){b+=4;for(h+=4;0!==--d&&0===Ba[b>>>2]>>>24;)b+=4,h+=4;++d}else l=da[h>>>2],l=m(a,l),da[h>>>2]=l,b+=4,h+=4;++t;++u}if(16===R)for(y=ga+1,k=Oa,N=ia,d=16*(S&1),db&&(d=16-d),Ta=e(65535,16-d);0!==
--y;){f=k*tb+4*Fa;u=N*Pa+4*(S>>1);a=4*(N&3);w=(Fa&3)-1;t=ma+1;l=Ta;for(d=65535===l?16:0;0!==--t;)b=qa[a+(w=w+1&3)],h=Ba[f>>>2],B=h>>>24,255===B?(h=ta(h,b),h=0===h?e(1,d):e(h,d),U(u,h,l)):0!==B&&(B=da[u>>>2],B&=~l,B=g(B,d),B=(B&31744)<<9|(B&992)<<6|(B&31)<<3|4278190080,h=m(h,B),h=ta(h,b),h=0===h?e(1,d):e(h,d),U(u,h,l)),f+=4,db?0===d&&(u+=4):0!==d&&(u+=4),d^=16,l=~l;++k;++N}if(8===R)for(f=O(),l=Ra&-9,k=ga+1,N=Oa,w=ia,Ta=8*(S&3),db&&(Ta=24-Ta),F=4294967295^e(255,Ta),u=0===(S&1)?0:522133279,0===(ia&1)&&
(u^=522133279);0!==--k;){u^=522133279;d=N*tb+4*Fa;t=w*Pa+4*(S>>2);h=ma+1;a=Ta;for(y=F;0!==--h;)b=(Ba[d>>>2]&~u)+u,B=b>>>24,31<B&&(224>B&&(B=da[t>>>2],B&=~y,B=g(B,a),B=f[B],b=m(b,B)),b=gb(b,l),b=e(b,a),U(t,b,y)),d+=4,db?0===a?(t+=4,a=24,y=16777215):(a-=8,y=y>>>8|4278190080):24===a?(t+=4,a=0,y=4294967040):(a+=8,y=y<<8|255),u^=522133279;++N;++w}Ga=S;ab=S+ma;Ya=ia;Ua=ia+ga;return!0}function sc(){var a,b,d,c;if(aa){if(!xc&&!W())return null;d=xc;c=!1;a=J.fetchPointerofObject(0,vb);"number"===typeof a&&
(d(a,Ga,Ya,ab-Ga,Ua-Ya),da=Pa=0,c=!0);Ob||(b=J.fetchPointerofObject(0,Jb),"number"===typeof b&&(c&&b===a||d(b,0,0,0,0),Ba=tb=0));aa=!1}}function Cc(){var b,d,h,l,f,m,t,g,u,B,y,k,N,w,n,q,C,p,v,x,r,A,Q,G,M;u=ua[Ja+1];u;if(!(27<=a(oa)))return J.primitiveFail();f=Db-1;0>=f&&(f=1);x=Z(15,oa);h=Z(18,oa);G=V(x,h,f);0>G&&(x=h-f*G);n=Z(16,oa);h=Z(19,oa);r=V(n,h,f);0>r&&(n=h-f*r);C=Z(24,oa);h=Z(21,oa);B=V(C,h,f);0>B&&(C=h-f*B);y=Z(25,oa);h=Z(22,oa);m=V(y,h,f);0>m&&(y=h-f*m);if(J.failed())return!1;if(2===J.methodArgumentCount())if(M=
J.stackIntegerValue(1),p=J.stackValue(0),p.isNil){if(16>cb)return J.primitiveFail()}else{if(a(p)<e(1,cb))return J.primitiveFail();p=p.wordsOrBytes()}else M=1,p=J.nilObject();f=$b-1;0>=f&&(f=1);g=na-(S&na-1);A=(S+ma-1&na-1)+1;ma<g&&(g=ma);bb<Da&&(x+=(Da-bb)*G,n+=(Da-bb)*r,C+=(Da-bb)*B,y+=(Da-bb)*m);yc=0;for(b=cb;1!==b;)++yc,b>>>=1;Ic=Y[cb];Gc=5-yc;Fc=e(1,Gc)-1;for(b=0;b<=Fc;b++)Hc[b]=fc?32-e(b+1,yc):e(b,yc);1<M&&0===(Ra&8)&&(Va?dc(8,nb):16===R&&dc(8,5));b=Ra&-9;db?(q=0-R,d=32-R):(q=R,d=0);for(k=1;k<=
ga;k++){v=V(x,C,f);Fa=0<=v?x:C-f*v;N=V(n,y,f);Oa=0<=N?n:y-f*N;Na=db?32-((S&na-1)+1)*R:(S&na-1)*R;$a<Ca&&(Fa+=(Ca-$a)*v,Oa+=(Ca-$a)*N);w=z?4294967295:la(ia+k-1);ka=Ta;Q=g;h=ba;do{if(1===M){t=v;l=N;var I=q,O=b,L,ta,E;ta=Y[R];E=0;if(5===O){do L=rc(Fa,Oa),L=Va[L&Za],E|=e(L&ta,Na),Na+=I,Fa+=t,Oa+=l;while(0!==--Q)}else{do L=rc(Fa,Oa),L=gb(L,O),E|=e(L&ta,Na),Na+=I,Fa+=t,Oa+=l;while(0!==--Q)}}else{var D=Q;t=v;l=N;var H=G,K=r,I=p,O=M;ta=q;var wa,U,T,ra,X,P,sa,La,ea,xa,W,Ma,Sa;T=Y[R];E=0;2===O?(Q=t>>1,L=l>>
1,H>>=1,K>>=1):(Q=c(t,O),L=c(l,O),H=c(H,O),K=c(K,O));U=D;do{ea=Fa;X=Oa;Ma=xa=W=La=P=0;wa=O;do{Sa=ea;sa=X;D=O;do{ra=rc(Sa,sa);if(25!==Ja||0!==ra)++Ma,ra=16>cb?I[ra]:16===cb?Xb(ra):ra,P+=ra&255,La+=ra>>>8&255,W+=ra>>>16&255,xa+=ra>>>24;Sa+=Q;sa+=L}while(0!==--D);ea+=H;X+=K}while(0!==--wa);0===Ma||25===Ja&&Ma<O*O>>1?ra=0:(4===Ma?(W>>>=2,La>>>=2,P>>>=2,xa>>>=2):(W=c(W,Ma),La=c(La,Ma),P=c(P,Ma),xa=c(xa,Ma)),ra=(xa<<24)+(W<<16)+(La<<8)+P,0===ra&&0<W+La+P+xa&&(ra=1),ra=gb(ra,Ra));E|=e(ra&T,Na);Na+=ta;Fa+=
t;Oa+=l}while(0!==--U)}l=E;Na=d;4294967295===ka?(l=u(l&w,da[ha>>>2]),da[ha>>>2]=ka&l):(t=da[ha>>>2],l=u(l&w,t&ka),t=ka&l|t&~ka,da[ha>>>2]=t);ha+=4;2===h?(ka=F,Q=A):(ka=4294967295,Q=na)}while(0!==--h);x+=G;n+=r;C+=B;y+=m;ha+=Wb}}var Ua=0,Ga=0,ab=0,Ya=0,ga=0,ma=0,oa=0,ub=0,ja=0,Eb=0,Ca=0,Da=0,nb=0,Ra=0,Va=null,Za=0,kb=null,qb=null,Ja=0,zc=0,Hb=0,da=0,Wb=0,R=0,vb=0,Gb=0,ha=0,db=0,ka=0,na=0,Pa=0,wb=0,$a=0,bb=0,Pb=Array(4096),qa=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],Aa=[0,2,4,6,8,12,14,16],Ab=[0,0,1,
2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],Na=0,S=0,ia=0,rb=null,mb=0,Fb=0,fa=0,Ia=0,aa=0,Db=0,J=null,Ea=0,r=null,Ta=0,F=0,Y=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],ba=0,z=0,Ob=0,ua=Array(43),uc=0,nc=null,zb=0,oc=0,Ba=0,vc=0,cb=0,Jb=0,ec=0,ob=0,fc=0,Zb=0,tb=0,hc=0,pc=0,Ac=0,wc=0,Fa=0,Oa=0,Yb=null,xc=null,kc=0,Fc=0,Gc=0,Hc=Array(32),Ic=0,yc=0,$b=0;Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:function(){var a;
a=J.stackValue(J.methodArgumentCount());if(!ea(a))return J.primitiveFail();v();if(J.failed())return null;Nb();if(J.failed())return null;J.pop(J.methodArgumentCount());if(22===Ja||32===Ja)return J.pop(1),J.pushInteger(ub)},copyBits:v,moduleUnloaded:function(a){0===strcmp(a,"SurfacePlugin")&&(nc=r=xc=0)},primitiveDrawLoop:function(){var a,b,d;b=J.stackValue(2);d=J.stackIntegerValue(1);a=J.stackIntegerValue(0);if(!ea(b))return J.primitiveFail();if(!J.failed()){a:{var c,h,l,e,f,m,t;b=0<d?1:0===d?0:-1;
t=0<a?1:0===a?0:-1;a=Math.abs(a);e=Math.abs(d);l=c=9999;h=m=-9999;if(e>a)for(d=e>>1,f=1;f<=e;f++){if($a+=b,0>(d-=a)&&(bb+=t,d+=e),f<e){v();if(J.failed())break a;Ga<ab&&Ya<Ua&&(l=Math.min(l,Ga),h=Math.max(h,ab),c=Math.min(c,Ya),m=Math.max(m,Ua),4E3<(h-l)*(m-c)&&(Ga=l,ab=h,Ya=c,Ua=m,Nb(),l=c=9999,h=m=-9999))}}else for(d=a>>1,f=1;f<=a;f++)if(bb+=t,0>(d-=e)&&($a+=b,d+=a),f<a){v();if(J.failed())break a;Ga<ab&&Ya<Ua&&(l=Math.min(l,Ga),h=Math.max(h,ab),c=Math.min(c,Ya),m=Math.max(m,Ua),4E3<(h-l)*(m-c)&&
(Ga=l,ab=h,Ya=c,Ua=m,Nb(),l=c=9999,h=m=-9999))}Ga=l;ab=h;Ya=c;Ua=m;J.storeIntegerofObjectwithValue(4,oa,$a);J.storeIntegerofObjectwithValue(5,oa,bb)}Nb()}J.failed()||J.pop(2)},primitiveDisplayString:function(){var d,c,h,l,e,f,m,t,g,u,B;if(6!==J.methodArgumentCount())return J.primitiveFail();B=J.stackIntegerValue(0);e=J.stackObjectValue(1);g=J.stackObjectValue(2);if(n(e)!==J.classArray()||n(g)!==J.classArray()||256!==a(g))return J.primitiveFail();if(J.failed())return null;f=a(e)-2;h=J.stackIntegerValue(3);
d=J.stackIntegerValue(4);c=J.stackObjectValue(5);if(!(J.isBytes(c)&&0<d&&0<h&&h<=b(c)))return J.primitiveFail();l=J.stackObjectValue(6);if(!ea(l)||30===Ja||31===Ja)return J.primitiveFail();m=0!==da&&0!==Ba&&!1===Ob&&Jb!==vb&&(0!==Ra||fc!==db||cb!==R);u=$a;for(c=c.bytes;d<=h;d++){t=c[d-1];t=J.fetchIntegerofObject(t,g);if(0>t||t>f)return J.primitiveFail();pc=J.fetchIntegerofObject(t,e);$b=J.fetchIntegerofObject(t+1,e)-pc;if(J.failed())return null;D();0<ma&&0<ga&&(m?(X(),M(),Ga=S,ab=S+ma,Ya=ia,Ua=ia+
ga):v());if(J.failed())return null;$a=$a+$b+B}Ga=u;Nb();J.storeIntegerofObjectwithValue(4,l,$a);J.pop(6)},initialiseModule:function(){ua[1]=C;ua[2]=t;ua[3]=B;ua[4]=Ec;ua[5]=l;ua[6]=P;ua[7]=H;ua[8]=E;ua[9]=u;ua[10]=I;ua[11]=y;ua[12]=K;ua[13]=L;ua[14]=G;ua[15]=w;ua[16]=P;ua[17]=P;ua[18]=P;ua[19]=p;ua[20]=yb;ua[21]=Tb;ua[22]=pa;ua[23]=f;ua[24]=d;ua[25]=A;ua[26]=Sb;ua[27]=mc;ua[28]=ya;ua[29]=sb;ua[30]=fb;ua[31]=x;ua[32]=h;ua[33]=Ib;ua[34]=Xa;ua[35]=m;ua[36]=m;ua[37]=m;ua[38]=ca;ua[39]=jc;ua[40]=lc;ua[41]=
xa;ua[42]=tc;var a,b,c;for(b=0;255>=b;b++)for(a=0;15>=a;a++){var e,g;e=b&255;c=Aa[e&7];e=Ab[e>>>3];g=a<c?e+1:e;e=b>>>8&255;c=Aa[e&7];e=Ab[e>>>3];g=a<c?g|e+1<<5:g|e<<5;e=b>>>16&255;c=Aa[e&7];e=Ab[e>>>3];c=g=a<c?g|e+1<<10:g|e<<10;Pb[(a<<8)+b]=c}return!0},loadBitBltFrom:ea,setInterpreter:function(a){J=a;a=1==J.majorVersion();return!1===a?!1:a=11<=J.minorVersion()},primitiveWarpBits:function(){var a;a=J.stackValue(J.methodArgumentCount());if(!Ma(a,!0))return J.primitiveFail();a=Ob;Ob=!0;D();(Ob=a)||0>=
ma||0>=ga?Ga=ab=Ya=Ua=0:lb()?(X(),Cc(),0<mb?(Ga=S,ab=S+ma):(Ga=S-ma+1,ab=S+1),0<kc?(Ya=ia,Ua=ia+ga):(Ya=ia-ga+1,Ua=ia+1),sc()):J.primitiveFail();if(J.failed())return null;Nb();if(J.failed())return null;J.pop(J.methodArgumentCount())},getModuleName:function(){return"BitBltPlugin 3 November 2014 (e)"},primitivePixelValueAt:function(){var d,h,l,e,f,m;d=J.stackIntegerValue(1);m=J.stackIntegerValue(0);J.stackValue(2);if(J.failed())return null;if(0>d||0>m){d=0;if(J.failed())return null;J.popthenPush(3,
d);return null}h=J.stackValue(J.methodArgumentCount());if(!(J.isPointers(h)&&4<=a(h)))return J.primitiveFail(),null;l=J.fetchPointerofObject(0,h);if(!J.isWordsOrBytes(l))return J.primitiveFail(),null;$b=J.fetchIntegerofObject(1,h);Db=J.fetchIntegerofObject(2,h);h=J.fetchIntegerofObject(3,h);if(J.failed())return null;if(d>=$b||m>=Db){d=0;if(J.failed())return null;J.popthenPush(3,d);return null}if(0>h)return J.primitiveFail(),null;e=c(32,h);f=c($b+(e-1),e);if(b(l)!==f*Db*4)return J.primitiveFail(),
null;l=J.fetchLong32ofObject(m*f+c(d,e),l);m=g(4294967295,32-h);d=g(l,32-((d&e-1)+1)*h)&m;d=J.positive32BitIntegerFor(d);if(J.failed())return null;J.popthenPush(3,d);return null},copyBitsFromtoat:function(a,b,d){$a=a;bb=d;pc=a;$b=b-a;v();Nb()}})});module("users.bert.SqueakJS.plugins.FFTPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a){d.success(d.isWords(a));return d.failed()?0:a.wordsAsFloat32Array()}function b(b){var c;d.success(6<=n(b));if(d.failed())return!1;p=d.fetchIntegerofObject(0,b);g=d.fetchIntegerofObject(1,b);c=d.fetchPointerofObject(2,b);t=n(c);h=a(c);c=d.fetchPointerofObject(3,b);x=n(c);d.success(d.isWords(c));
A=c.words;c=d.fetchPointerofObject(4,b);m=n(c);q=a(c);c=d.fetchPointerofObject(5,b);f=n(c);k=a(c);d.success((31<p?0:1<<p)===g&&(g>>2)+1===t&&g===m&&g===f&&m===f);return!1===d.failed()}function c(){var a,b,c,h,e;h=0;for(c=x;h<c;){a=A[h]-1;b=A[h+1]-1;if(!(a<m&&b<m))return d.success(!1);e=q[a];q[a]=q[b];q[b]=e;e=k[a];k[a]=k[b];k[b]=e;h+=2}}function e(){var a,b;if(1>=g)return null;b=1/g;for(a=0;a<=g-1;a++)q[a]*=b,k[a]*=b}var g=0,k=null,f=0,d=null,p=0,A=null,x=0,q=null,m=0,h=null,t=0;Squeak.registerExternalModule("FFTPlugin",
{primitiveFFTTransformData:function(){var a,l;a=d.booleanValueOf(d.stackValue(0));l=d.stackObjectValue(1);if(!b(l))return null;c();if(d.failed())c();else{var f,m,n,w,x,A,E,K,H,C,D,v,N;f=g>>1;m=g>>2;for(D=1;D<=p;D++)for(H=31<D?0:1<<D,C=H>>1,l=Math.floor(g/H)|0,K=1;K<=C;K++)for(n=(K-1)*l,n<m?(N=h[t-n-1],A=h[n]):(N=0-h[n-m],A=h[f-n]),a||(A=0-A),n=K;n<=g;)E=n+C-1,w=n-1,v=q[E]*N-k[E]*A,x=q[E]*A+k[E]*N,q[E]=q[w]-v,k[E]=k[w]-x,q[w]+=v,k[w]+=x,n+=H;a||e()}d.failed()||d.pop(1)},setInterpreter:function(a){d=
a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitiveFFTPermuteData:function(){var a;a=d.stackObjectValue(0);if(!b(a))return null;c();d.failed()&&c()},primitiveFFTScaleData:function(){var a;a=d.stackObjectValue(0);if(!b(a))return null;e()},getModuleName:function(){return"FFTPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.FloatArrayPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}var a=null;Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;
g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]*=b[c];a.pop(1)},primitiveEqual:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;a.pop(2);e=n(b);if(e!==n(g))return a.pushBool(!1);g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)if(g[c]!==b[c])return a.pushBool(!1);return a.pushBool(!0)},primitiveAtPut:function(){var b,c,e,g;g=a.stackValue(0);
b="number"===typeof g?g:a.floatValueOf(g);c=a.stackIntegerValue(1);e=a.stackObjectValue(2);if(a.failed())return null;a.success(a.isWords(e));a.success(0<c&&c<=n(e));if(a.failed())return null;e.wordsAsFloat32Array()[c-1]=b;a.failed()||a.popthenPush(3,g)},primitiveAt:function(){var b,c;b=a.stackIntegerValue(0);c=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(c));a.success(0<b&&b<=n(c));if(a.failed())return null;b=c.wordsAsFloat32Array()[b-1];a.pop(2);a.pushFloat(b)},primitiveNormalize:function(){var b,
c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;e=n(b);a.success(!0);g=b.wordsAsFloat32Array();for(b=c=0;b<=e-1;b++)c+=g[b]*g[b];a.success(0<c);if(a.failed())return null;c=Math.sqrt(c);for(b=0;b<=e-1;b++)g[b]/=c},primitiveSubFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;
g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]-=b[c];a.pop(1)},primitiveDivFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)if(0===b[c])return a.primitiveFail();for(c=0;c<=e-1;c++)g[c]/=b[c];a.pop(1)},primitiveAddScalar:function(){var b,
c,e,g;g=a.stackFloatValue(0);b=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)e[b]+=g;a.pop(1)},primitiveDotProduct:function(){var b,c,e,g,k;b=a.stackObjectValue(0);g=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=
k=0;c<=e-1;c++)k+=g[c]*b[c];a.pop(2);a.pushFloat(k)},primitiveSubScalar:function(){var b,c,e,g;g=a.stackFloatValue(0);b=a.stackObjectValue(1);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)e[b]-=g;a.pop(1)},setInterpreter:function(b){a=b;b=1==a.majorVersion();return!1===b?!1:b=11<=a.minorVersion()},primitiveSum:function(){var b,c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;
c=n(b);e=b.wordsAsFloat32Array();for(b=g=0;b<=c-1;b++)g+=e[b];a.popthenPush(1,a.floatObjectOf(g))},getModuleName:function(){return"FloatArrayPlugin 3 November 2014 (e)"},primitiveHashArray:function(){var b,c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsInt32Array();for(b=g=0;b<=c-1;b++)g+=e[b];a.pop(1);return a.pushInteger(g&536870911)},primitiveMulScalar:function(){var b,c,e,g;g=a.stackFloatValue(0);b=a.stackObjectValue(1);
if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);e=b.wordsAsFloat32Array();for(b=0;b<=c-1;b++)e[b]*=g;a.pop(1)},primitiveLength:function(){var b,c,e,g;b=a.stackObjectValue(0);if(a.failed())return null;a.success(a.isWords(b));if(a.failed())return null;c=n(b);a.success(!0);e=b.wordsAsFloat32Array();for(b=g=0;b<=c-1;b++)g+=e[b]*e[b];g=Math.sqrt(g);a.popthenPush(1,a.floatObjectOf(g))},primitiveAddFloatArray:function(){var b,c,e,g;b=a.stackObjectValue(0);g=a.stackObjectValue(1);
if(a.failed())return null;a.success(a.isWords(b));a.success(a.isWords(g));if(a.failed())return null;e=n(b);a.success(e===n(g));if(a.failed())return null;g=g.wordsAsFloat32Array();b=b.wordsAsFloat32Array();for(c=0;c<=e-1;c++)g[c]+=b[c];a.pop(1)},primitiveDivScalar:function(){var b,c,e,g;b=a.stackFloatValue(0);g=a.stackObjectValue(1);if(a.failed())return null;if(0===b)return a.primitiveFail();a.success(a.isWords(g));if(a.failed())return null;e=n(g);g=g.wordsAsFloat32Array();c=1/b;for(b=0;b<=e-1;b++)g[b]*=
c;a.pop(1)}})});module("users.bert.SqueakJS.plugins.GeniePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function b(a,b){var c,d,e,n;c=a[0];e=a[1];d=b[0];n=b[1];c=d-c;e=n-e;return c*c+e*e}function c(a){console.log("GeniePlugin v2.0 14 November 2014 (e): "+a)}var e=null;Squeak.registerExternalModule("GeniePlugin",{primVersionNO:function(){if(e.failed())return null;
e.popthenPush(1,2E3);return null},setInterpreter:function(a){e=a;a=1==e.majorVersion();return!1===a?!1:a=11<=e.minorVersion()},primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:function(){var g,k,f,d,p,A,x,q,m,h,t,B,l,u,y,G,w,L,I,E,K,H,C,D,v,N,Q,M;f=e.stackValue(11);p=e.stackValue(10);D=e.stackValue(9);h=e.stackValue(8);y=e.stackValue(7);k=e.stackValue(6);
K=e.stackValue(5);C=e.stackValue(4);l=e.stackIntegerValue(3);q=e.stackValue(2);v=e.stackValue(1);d=e.stackValue(0);if(e.failed())return null;if(e.failed())return c("failed 1"),null;e.success(e.isWords(f)&&e.isWords(p)&&e.isWords(D)&&e.isWords(h)&&e.isWords(y)&&e.isWords(k)&&e.isWords(K)&&e.isWords(C)&&e.isWords(q)&&e.isWords(v)&&e.isWords(d));if(e.failed())return c("failed 2"),null;e.success(e.isMemberOf(f,"PointArray")&&e.isMemberOf(p,"PointArray"));if(e.failed())return c("failed 3"),null;B=f.wordsAsInt32Array();
w=p.wordsAsInt32Array();L=D.wordsAsInt32Array();m=h.wordsAsInt32Array();u=y.wordsAsInt32Array();t=k.wordsAsInt32Array();N=K.wordsAsInt32Array();g=C.wordsAsInt32Array();E=q.wordsAsInt32Array();Q=v.wordsAsInt32Array();I=d.wordsAsInt32Array();p=n(p)>>>1;D=n(D)>>>1;h=n(h)>>>1;k=n(k);q=n(q);e.success(q===n(v)&&q===n(d)&&q>h);if(e.failed())return c("failed 4"),null;e.success(n(y)>=D-1&&n(f)>>>1>=D&&k>=h-1&&p>=h&&n(K)>=D-1&&n(C)>=h-1);if(e.failed())return c("failed 5"),null;f=l&1;l>>>=1;y=f?0:l*l>>>10;E[0]=
0;Q[0]=0;I[0]=2;H=0-y;l=h;if(!(p>=l-1&&k>=l-1))return e.primitiveFail(),null;for(K=1;K<=l;K++)d=K-1,H=H+(t[d]+b(a(w,d<<1),B)>>>7)+y,Q[K]=H,E[K]=H*K,I[K]=K+1;H=Q[0]-y;for(C=1;C<=D;C++){p=C-1;k=p<<1;v=E[0];H=H+(u[p]+b(a(B,k),w)>>>7)+y;Q[0]=H;E[0]=H*C;I[0]=C+1;l=h;for(K=1;K<=l;K++)d=K-1,A=d<<1,x=E[K],M=E[d],G=u[p]+b(a(B,k),a(w,K<<1))>>>7,0===(H=Q[K])?x+=G:(x=x+H+G*I[K],G+=H),q=t[d]+b(a(w,A),a(B,C<<1))>>>7,0===(H=Q[d])?M+=q:(M=M+H+q*I[d],q+=H),f?v=536870912:(H=b(a(m,A),a(L,k))+b(a(w,A),a(B,k)),A=Math.abs(N[p]-
g[d]),180<A&&(A=360-A),H=H*(16+(A*A>>>6))>>>11,v+=H),v<=x&&v<=M?(x=v,H=0,d=1):x<=M?(H=G+y,d=I[K]+1):(x=M,H=q+y,d=I[d]+1),v=E[K],E[K]=Math.min(x,536870912),Q[K]=Math.min(H,536870912),I[K]=d;H=Q[0]}g=x;if(e.failed())return null;e.popthenPush(13,g);return null},getModuleName:function(){return"GeniePlugin v2.0 14 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.JPEGReaderPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){if("number"===typeof b||!u.isPointers(b)||11>n(b))return!1;a[0]=u.fetchIntegerofObject(0,b);a[1]=u.fetchIntegerofObject(1,b);a[2]=u.fetchIntegerofObject(2,b);a[3]=u.fetchIntegerofObject(3,b);a[5]=u.fetchIntegerofObject(5,b);a[8]=u.fetchIntegerofObject(8,b);a[10]=u.fetchIntegerofObject(10,
b);return!u.failed()}function b(a,b){var d,c,h,e;if("number"===typeof b||!u.isPointers(b)||11>n(b))return!1;d=u.fetchPointerofObject(4,b);if("number"===typeof d||!u.isPointers(d))return!1;e=n(d);if(128<e)return!1;for(h=0;h<=e-1;h++){c=u.fetchPointerofObject(h,d);if("number"===typeof c||!u.isWords(c)||64!==n(c))return!1;a[h]=c.wordsAsInt32Array()}return!u.failed()}function c(a,b){var d,c,h;c=g(t,B);if(0>c)return u.primitiveFail();0!==c&&(d=e(c),c=f(d,c));c=b[10]+=c;a[0]=c;for(c=1;63>=c;c++)a[c]=0;
for(h=1;64>h;){c=g(p,A);if(0>c)return u.primitiveFail();d=c>>>4;c&=15;if(0!==c){h+=d;d=e(c);c=f(d,c);if(0>h||64<=h)return u.primitiveFail();a[w[h]]=c}else if(15===d)h+=d;else return null;++h}}function e(a){if(a>I){for(var b;16>=I&&K<H;){b=E[K];++K;if(255===b){if(!(K<H&&0===E[K])){--K;break}++K}L=L<<8|b;I+=8}if(a>I)return-1}I-=a;a=31<I?0:L>>>I;L&=(31<I?0:1<<I)-1;return a}function g(a,b){var d,c;d=a[0]>>>24;if(16<d)return-1;for(c=2;;){d=e(d);if(0>d)break;c=c+d-1;if(c>=b)break;d=a[c];if(0===(d&1056964608))return d;
c=d&65535;d=d>>>24&255;if(16<d)break}return-1}function k(){var a,b,d,c,h;b=a=v[0];d=v[1];c=v[2];h=v[3];0!==c&&0!==h&&(b=Math.floor(b/c)|0,d=Math.floor(d/h)|0);b=D[(d>>>3)*v[5]+(b>>>3)][((d&7)<<3)+(b&7)];++a;a<8*v[8]?v[0]=a:(v[0]=0,v[1]++);return b}function f(a,b){var d=b-1;return a<(31<d?0:1<<d)?a-(31<b?0:1<<b)+1:a}function d(d){return a(v,d)&&b(D,d)}var p=null,A=0,x=Array(128),q=Array(11),m=Array(128),h=Array(11),t=null,B=0,l=0,u=null,y=null,G=0,w=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,
33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],L=0,I=0,E=null,K=0,H=0,C=null,D=Array(128),v=Array(11);Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:function(a){u=a;a=1==u.majorVersion();return!1===a?!1:a=11<=u.minorVersion()},primitiveIdctInt:function(){var a,b;if(2!==u.methodArgumentCount())return u.primitiveFail();a=u.stackObjectValue(0);if(u.failed())return null;if(!u.isWords(a)||64!==n(a))return u.primitiveFail();
b=a.wordsAsInt32Array();a=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(a)||64!==n(a))return u.primitiveFail();a=a.wordsAsInt32Array();var d,c,h,e,l,f,m,t,g,B=Array(64),y,k,w,q,C;for(c=0;7>=c;c++){d=-1;for(h=1;7>=h;h++)-1===d&&0!==a[8*h+c]&&(d=h);if(-1===d)for(d=a[c]*b[0]<<2,h=0;7>=h;h++)B[8*h+c]=d;else k=a[16+c]*b[16+c],w=a[48+c]*b[48+c],y=4433*(k+w),t=y+-15137*w,g=y+6270*k,k=a[c]*b[c],w=a[32+c]*b[32+c],d=k+w<<13,h=k-w<<13,e=d+g,m=d-g,l=h+t,f=h-t,d=a[56+c]*b[56+c],h=a[40+c]*b[40+
c],t=a[24+c]*b[24+c],g=a[8+c]*b[8+c],y=d+g,k=h+t,w=d+t,q=h+g,C=9633*(w+q),d*=2446,h*=16819,t*=25172,g*=12299,y*=-7373,k*=-20995,w*=-16069,q*=-3196,w+=C,q+=C,d=d+y+w,h=h+k+q,t=t+k+w,g=g+y+q,B[c]=e+g>>11,B[56+c]=e-g>>11,B[8+c]=l+t>>11,B[48+c]=l-t>>11,B[16+c]=f+h>>11,B[40+c]=f-h>>11,B[24+c]=m+d>>11,B[32+c]=m-d>>11}for(c=0;56>=c;c+=8)k=B[c+2],w=B[c+6],y=4433*(k+w),t=y+-15137*w,g=y+6270*k,d=B[c]+B[c+4]<<13,h=B[c]-B[c+4]<<13,e=d+g,m=d-g,l=h+t,f=h-t,d=B[c+7],h=B[c+5],t=B[c+3],g=B[c+1],y=d+g,k=h+t,w=d+t,
q=h+g,C=9633*(w+q),d*=2446,h*=16819,t*=25172,g*=12299,y*=-7373,k*=-20995,w*=-16069,q*=-3196,w+=C,q+=C,d=d+y+w,h=h+k+q,t=t+k+w,g=g+y+q,b=(e+g>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c]=b,b=(e-g>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+7]=b,b=(l+t>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+1]=b,b=(l-t>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+6]=b,b=(f+h>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+2]=b,b=(f-h>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+5]=b,b=(m+d>>18)+127,
b=Math.min(b,255),b=Math.max(b,0),a[c+3]=b,b=(m-d>>18)+127,b=Math.min(b,255),b=Math.max(b,0),a[c+4]=b;u.pop(2)},primitiveColorConvertMCU:function(){var c;if(4!==u.methodArgumentCount())return u.primitiveFail();l=u.stackIntegerValue(0);c=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(c)||3!==n(c))return u.primitiveFail();C=c.wordsAsInt32Array();c=u.stackObjectValue(2);if(u.failed())return null;if(!u.isWords(c))return u.primitiveFail();G=n(c);y=c.wordsAsInt32Array();c=u.stackObjectValue(3);
if(u.failed())return null;if(!u.isPointers(c)||3!==n(c)||!d(u.fetchPointerofObject(0,c)))return u.primitiveFail();var e=u.fetchPointerofObject(1,c);if(!a(q,e)||!b(x,e))return u.primitiveFail();c=u.fetchPointerofObject(2,c);if(!a(h,c)||!b(m,c))return u.primitiveFail();var f,t,g;v[0]=0;v[1]=0;q[0]=0;q[1]=0;h[0]=0;for(c=h[1]=0;c<=G-1;c++){var e=k(),B,w;g=f=q[0];t=q[1];B=q[2];w=q[3];0!==B&&0!==w&&(g=Math.floor(g/B)|0,t=Math.floor(t/w)|0);g=x[(t>>>3)*q[5]+(g>>>3)][((t&7)<<3)+(g&7)];++f;f<8*q[8]?q[0]=f:
(q[0]=0,q[1]++);f=g;f-=127;var p;t=g=h[0];B=h[1];w=h[2];p=h[3];0!==w&&0!==p&&(t=Math.floor(t/w)|0,B=Math.floor(B/p)|0);t=m[(B>>>3)*h[5]+(t>>>3)][((B&7)<<3)+(t&7)];++g;g<8*h[8]?h[0]=g:(h[0]=0,h[1]++);t-=127;g=e+(91881*t>>16)+C[0];g=Math.min(g,255);g=Math.max(g,0);C[0]=g&l;g&=255-l;g=Math.max(g,1);t=e-(22554*f>>16)-(46802*t>>16)+C[1];t=Math.min(t,255);t=Math.max(t,0);C[1]=t&l;t&=255-l;t=Math.max(t,1);e=e+(116130*f>>16)+C[2];e=Math.min(e,255);e=Math.max(e,0);C[2]=e&l;e&=255-l;e=Math.max(e,1);y[c]=4278190080+
(g<<16)+(t<<8)+e}u.pop(4)},primitiveColorConvertGrayscaleMCU:function(){var a;if(4!==u.methodArgumentCount())return u.primitiveFail();l=u.stackIntegerValue(0);a=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(a)||3!==n(a))return u.primitiveFail();C=a.wordsAsInt32Array();a=u.stackObjectValue(2);if(u.failed())return null;if(!u.isWords(a))return u.primitiveFail();G=n(a);y=a.wordsAsInt32Array();a=u.stackObjectValue(3);if(u.failed())return null;if(!d(a))return u.primitiveFail();var b;v[0]=
0;for(a=v[1]=0;a<=G-1;a++)b=k(),b+=C[1],b=Math.min(b,255),C[1]=b&l,b&=255-l,b=Math.max(b,1),y[a]=4278190080+(b<<16)+(b<<8)+b;u.pop(4)},primitiveDecodeMCU:function(){var b;if(5!==u.methodArgumentCount())return u.primitiveFail();b=u.stackObjectValue(0);if(u.failed())return null;var d;5>n(b)||!u.isPointers(b)?b=!1:(d=u.fetchPointerofObject(0,b),"number"!==typeof d&&u.isBytes(d)?(d=(E=d.bytes)?d.bytes.length:d.words?4*d.words.length:0,K=u.fetchIntegerofObject(1,b),H=u.fetchIntegerofObject(2,b),L=u.fetchIntegerofObject(3,
b),I=u.fetchIntegerofObject(4,b),b=u.failed()||d<H||0>K||K>=H?!1:!0):b=!1);if(!b)return u.primitiveFail();b=u.stackObjectValue(1);if(u.failed())return null;if(!u.isWords(b))return u.primitiveFail();A=n(b);p=b.wordsAsInt32Array();b=u.stackObjectValue(2);if(u.failed())return null;if(!u.isWords(b))return u.primitiveFail();B=n(b);t=b.wordsAsInt32Array();b=u.stackObjectValue(3);if(u.failed())return null;if(!a(v,b))return u.primitiveFail();b=u.stackObjectValue(4);if(u.failed())return null;if(!u.isWords(b)||
64!==n(b))return u.primitiveFail();b=b.wordsAsInt32Array();if(u.failed())return null;c(b,v);if(u.failed())return null;b=u.stackValue(0);u.storeIntegerofObjectwithValue(1,b,K);u.storeIntegerofObjectwithValue(3,b,L);u.storeIntegerofObjectwithValue(4,b,I);u.storeIntegerofObjectwithValue(10,u.stackValue(3),v[10]);u.pop(5)},getModuleName:function(){return"JPEGReaderPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.KedamaPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){var d;if(0===a)return 0<=b?90:270;d=Math.atan(b/a);return 0<=a?0<=b?d/.0174532925199433:360+d/.0174532925199433:180+d/.0174532925199433}function b(a){var b;a=90-a;b=a/360|0;0>a&&--b;return.0174532925199433*(a-360*b)}function c(a){var b;b=x;d=p*(d-(Math.floor(d/b)|0)*b|0)-q*(Math.floor(d/
x)|0);b=(d&65535)*((0>a?0-a:a)+1)>>>16;return 0>a?0-b:b}function e(a){a=90-a/.0174532925199433;0<a||(a+=360);return a}function g(a,b,d,c,e,f,g){0>c&&(1===f&&(c+=e),2===f&&(c=0),3===f&&(c=0-c,f=d[a],d[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));c>=e&&(1===g&&(c-=e),2===g&&(c=e-1E-6),3===g&&(c=e-1E-6-(c-e),f=d[a],d[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));b[a]=c}function k(a,b,d,c,e,f,g){0>c&&(1===f&&(c+=e),2===f&&(c=0),3===f&&(c=0-c,d[a]=6.283185307179586-
d[a]));c>=e&&(1===g&&(c-=e),2===g&&(c=e-1E-6),3===g&&(c=e-1E-6-(c-e),d[a]=6.283185307179586-d[a]));b[a]=c}var f=null,d=0,p=0,A=0,x=0,q=0;Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:function(){var a,b,d,c,e,g,y;d=f.stackValue(0);y=f.stackIntegerValue(1);c=f.stackValue(2);b=f.stackValue(3);if(f.failed())return null;d=d.words[0];if(f.failed())return null;g=Math.log(d);d=n(b);e=n(c);if(d!==e)return f.primitiveFail(),null;b=b.words;e=c.words;for(c=0;c<=d-1;c++)a=b[c],a=0===a?0:255/g*Math.log(a)|
0,255<a&&(a=255),e[c]=a<<24&4278190080|y;f.pop(4)},vectorGetDistanceTo:function(){var a,b,d,c,e,g,y,k,w,q,p,x,A;w=f.stackValue(0);A=f.stackValue(1);p=f.stackValue(2);e=f.stackValue(3);a=f.stackValue(4);if(f.failed())return null;if(!f.isWords(w)||!f.isWords(p)||!f.isWords(A))return f.primitiveFail(),null;q=n(w);if(0>q||n(p)!==q||n(A)!==q)return f.primitiveFail(),null;if(a.isFloat)if(e.isFloat)b=!1;else return f.primitiveFail(),null;else{if(e.isFloat)return f.primitiveFail(),null;b=!0}if(b&&(n(a)!==
q||n(e)!==q))return f.primitiveFail(),null;k=w.wordsAsFloat32Array();p=p.wordsAsFloat32Array();A=A.wordsAsFloat32Array();b&&(d=a.wordsAsFloat32Array(),c=e.wordsAsFloat32Array());b||(g=f.floatValueOf(a),y=f.floatValueOf(e));for(a=0;a<=q-1;a++)b&&(g=d[a],y=c[a]),e=g-p[a],x=y-A[a],k[a]=Math.sqrt(e*e+x*x);if(f.failed())return null;f.pop(6);f.push(w)},getScalarHeading:function(){var a,b;a=f.stackValue(0);b=f.stackIntegerValue(1);if(f.failed())return null;if(!f.isWords(a)||n(a)<b)return f.primitiveFail(),
null;a=a.wordsAsFloat32Array()[b-1];a=e(a);if(f.failed())return null;f.pop(3);f.pushFloat(a)},shutdownModule:function(){return!0},primitiveAddScalar:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(b);f.success(e===n(g));if(f.failed())return null;d="number"===typeof a;c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),
null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;c?d?(d=b.words,b=a,c=g.words):(d=b.words,b=f.floatValueOf(a),c=g.wordsAsFloat32Array()):(d?(d=b.wordsAsFloat32Array(),b=a):(d=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),c=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)c[a]=d[a]+b;f.pop(4);f.push(g)},primSetPixelsAtXY:function(){var a,b,d,c,e,g,y,k,w,q,p,x;d=f.stackValue(0);b=f.stackIntegerValue(1);c=f.stackIntegerValue(2);a=f.stackValue(3);x=f.stackValue(4);q=f.stackValue(5);
if(f.failed())return null;if(!f.isWords(q)||!f.isWords(x)||!f.isWords(a)||b*c!==n(a))return f.primitiveFail(),null;y=n(q);if(n(x)!==y)return f.primitiveFail(),null;(g="number"===typeof d)&&(e=d);if(!(g||f.isMemberOf(d,"WordArray")&&n(d)===y))return f.primitiveFail(),null;q=q.wordsAsFloat32Array();x=x.wordsAsFloat32Array();g||(w=d.words);a=a.words;g&&(k=e);for(e=0;e<=y-1;e++)d=q[e]|0,p=x[e]|0,0<=d&&0<=p&&d<c&&p<b&&(d=p*c+d,g||(k=w[e]),a[d]=k);if(f.failed())return null;f.pop(6)},turtleScalarSetX:function(){var a,
b,d,c,e,u,y,k;c=f.stackIntegerValue(0);d=f.stackIntegerValue(1);a=f.stackFloatValue(2);u=f.stackFloatValue(3);b=f.stackValue(4);y=f.stackIntegerValue(5);k=f.stackValue(6);if(f.failed())return null;if(!f.isWords(k)||!f.isWords(b))return f.primitiveFail(),null;e=n(k);if(n(b)!==e)return f.primitiveFail(),null;e=k.wordsAsFloat32Array();b=b.wordsAsFloat32Array();g(y-1,e,b,u,a,d,c);if(f.failed())return null;f.pop(7)},primPixelAtXY:function(){var a,b,d,c,e;b=f.stackIntegerValue(0);d=f.stackIntegerValue(1);
e=f.stackFloatValue(2);c=f.stackFloatValue(3);a=f.stackValue(4);if(f.failed())return null;if(!f.isWords(a)||n(a)!==b*d)return f.primitiveFail(),null;c|=0;e|=0;a=a.words;b=0<=c&&c<d&&0<=e&&e<b?a[e*d+c]:0;if(f.failed())return null;f.pop(6);f.pushInteger(b)},primUpHill:function(){var b,d,c,g,l,u,y,k,w,q,p,x,A,H,C;g=f.stackIntegerValue(0);c=f.stackIntegerValue(1);A=f.stackIntegerValue(2);b=f.stackValue(3);w=f.stackFloatValue(4);d=f.stackFloatValue(5);q=f.stackFloatValue(6);if(f.failed())return null;if(!f.isWords(b)||
n(b)!==c*A)return f.primitiveFail(),null;b=b.words;q=Math.max(q,0);x=Math.max(d,0);q=Math.min(q,A-1);x=Math.min(x,c-1);k=Math.max(q-g,0);d=Math.min(q+g,A-1);y=Math.max(x-g,0);c=Math.min(x+g,c-1);g=b[x*A+q];l=-1;for(C=y;C<=c;C++)for(y=C*A,H=k;H<=d;H++)p=b[y+H],p>g&&(l=H,u=C,g=p);u=-1===l?e(w):a(l-q,u-x)+90|0;if(f.failed())return null;f.pop(8);f.pushFloat(u)},primScalarForward:function(){var a,b,d,c,e,u,y,q,w,p,x,A;a=f.stackIntegerValue(0);x=f.stackIntegerValue(1);w=f.stackIntegerValue(2);u=f.stackIntegerValue(3);
b=f.stackFloatValue(4);d=f.stackFloatValue(5);q=f.stackFloatValue(6);c=f.stackValue(7);A=f.stackValue(8);y=f.stackValue(9);e=f.stackIntegerValue(10);if(f.failed())return null;if(!f.isWords(y)||!f.isWords(A)||!f.isWords(c))return f.primitiveFail(),null;p=n(y);if(n(A)!==p||n(c)!==p)return f.primitiveFail(),null;p=y.wordsAsFloat32Array();A=A.wordsAsFloat32Array();c=c.wordsAsFloat32Array();--e;y=p[e]+q*Math.cos(c[e]);q=A[e]-q*Math.sin(c[e]);g(e,p,c,y,d,u,w);k(e,A,c,q,b,x,a);if(f.failed())return null;
f.pop(11)},primitiveDivArrays:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(a));f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;d=f.isMemberOf(a,"WordArray");c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),
null;c?d?(d=b.words,b=a.words,c=g.words):(d=b.words,b=a.wordsAsFloat32Array(),c=g.wordsAsFloat32Array()):(d?(d=b.wordsAsFloat32Array(),b=a.words):(d=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),c=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)c[a]=d[a]/b[a];f.pop(4);f.push(g)},getModuleName:function(){return"KedamaPlugin 3 November 2014 (e)"},primitiveSubArrays:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(a));
f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;d=f.isMemberOf(a,"WordArray");c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;c?d?(d=b.words,b=a.words,c=g.words):(d=b.words,b=a.wordsAsFloat32Array(),c=g.wordsAsFloat32Array()):(d?(d=b.wordsAsFloat32Array(),b=a.words):(d=b.wordsAsFloat32Array(),
b=a.wordsAsFloat32Array()),c=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)c[a]=d[a]-b[a];f.pop(4);f.push(g)},scalarGetAngleTo:function(){var b,d,c,e;d=f.stackFloatValue(0);b=f.stackFloatValue(1);e=f.stackFloatValue(2);c=f.stackFloatValue(3);if(f.failed())return null;b=a(c-b,e-d);b+=90;360<b&&(b-=360);if(f.failed())return null;f.pop(5);f.pushFloat(b)},randomRange:function(){var a;a=f.stackIntegerValue(0);if(f.failed())return null;a=c(a);if(f.failed())return null;f.pop(2);f.pushInteger(a)},setInterpreter:function(a){f=
a;a=1==f.majorVersion();return!1===a?!1:a=11<=f.minorVersion()},kedamaSetRandomSeed:function(){var a;a=f.stackIntegerValue(0);if(f.failed())return null;d=a&65536;f.pop(1)},drawTurtlesInArray:function(){var a,b,d,c,e,g,y,k,w,q,p,x;k=f.stackValue(0);b=f.stackValue(1);x=f.stackValue(2);q=f.stackValue(3);c=f.stackIntegerValue(4);e=f.stackIntegerValue(5);d=f.stackValue(6);if(f.failed())return null;if(!(f.isWords(d)&&f.isWords(q)&&f.isWords(x)&&f.isWords(b)&&f.isBytes(k))||c*e!==n(d))return f.primitiveFail(),
null;y=n(q);if(n(x)!==y||n(b)!==y||n(k)!==y)return f.primitiveFail(),null;q=q.wordsAsFloat32Array();x=x.wordsAsFloat32Array();b=b.words;k=k.bytes;d=d.words;for(g=0;g<=y-1;g++)w=q[g]|0,p=x[g]|0,a=k[g],0!==a&&0<=w&&0<=p&&w<e&&p<c&&(a=p*e+w,d[a]=b[g]);if(f.failed())return null;f.pop(7)},turtleScalarSetY:function(){var a,b,d,c,e,g,y,q;a=f.stackIntegerValue(0);e=f.stackIntegerValue(1);b=f.stackFloatValue(2);g=f.stackFloatValue(3);d=f.stackValue(4);y=f.stackIntegerValue(5);q=f.stackValue(6);if(f.failed())return null;
if(!f.isWords(q)||!f.isWords(d))return f.primitiveFail(),null;c=n(q);if(n(d)!==c)return f.primitiveFail(),null;c=q.wordsAsFloat32Array();d=d.wordsAsFloat32Array();k(y-1,c,d,g,b,e,a);if(f.failed())return null;f.pop(7)},randomIntoIntegerArray:function(){var a,b,d,e,l;a=f.stackFloatValue(0);d=f.stackValue(1);l=f.stackIntegerValue(2);b=f.stackIntegerValue(3);e=f.stackIntegerValue(4);if(f.failed())return null;if(!(f.isWords(d)&&n(d)>=l&&1<=b&&l>=b))return f.primitiveFail(),null;d=d.words;if(f.failed())return null;
for(;b<=l;b++)d[b-1]=c(e)*a|0;f.pop(5)},getHeadingArrayInto:function(){var a,b,d,c,e;a=f.stackValue(0);b=f.stackValue(1);if(f.failed())return null;if(!f.isWords(b)||!f.isWords(a))return f.primitiveFail(),null;e=n(b);if(n(a)!==e)return f.primitiveFail(),null;b=b.wordsAsFloat32Array();c=a.wordsAsFloat32Array();for(d=0;d<=e-1;d++)a=b[d],a/=.0174532925199433,a=90-a,0<a||(a+=360),c[d]=a;if(f.failed())return null;f.pop(2)},makeTurtlesMap:function(){var a,b,d,c,e,g,y,k,w,q;a=f.stackIntegerValue(0);y=f.stackIntegerValue(1);
q=f.stackValue(2);k=f.stackValue(3);g=f.stackValue(4);b=f.stackValue(5);if(!(f.isWords(q)&&f.isWords(k)&&f.isWords(g)&&f.isWords(b)))return f.primitiveFail(),null;e=n(g);if(n(k)!==e||n(q)!==e||n(b)!==a*y)return f.primitiveFail(),null;k=k.wordsAsFloat32Array();q=q.wordsAsFloat32Array();g=g.words;d=b.words;for(b=0;b<=a*y-1;b++)d[b]=0;for(b=0;b<=e-1;b++)c=k[b],w=q[b],c=y*w+c,0<=c&&c<a*y&&(d[c]=g[b]);if(f.failed())return null;f.pop(6)},setHeadingArrayFrom:function(){var a,d,c,e,l,g;c=f.stackValue(0);
d=f.stackValue(1);if(f.failed())return null;if(!f.isWords(d))return f.primitiveFail(),null;g=n(d);if(c.isFloat)e=!1;else if(f.isWords(c)){if(n(c)!==g)return f.primitiveFail(),null;e=!0}else return f.primitiveFail(),null;d=d.wordsAsFloat32Array();e?l=c.wordsAsFloat32Array():(a=f.floatValueOf(c),a=b(a));for(c=0;c<=g-1;c++)e&&(a=l[c],a=b(a)),d[c]=a;if(f.failed())return null;f.pop(2)},turtlesSetX:function(){var a,b,d,c,e,u,y,k,w,q,p;y=f.stackIntegerValue(0);e=f.stackIntegerValue(1);a=f.stackFloatValue(2);
d=f.stackValue(3);b=f.stackValue(4);p=f.stackValue(5);if(f.failed())return null;if(!f.isWords(p)||!f.isWords(b))return f.primitiveFail(),null;if(d.isFloat)c=!1;else if(f.isWords(d))c=!0;else return f.primitiveFail(),null;k=n(p);if(n(b)!==k||c&&n(d)!==k)return f.primitiveFail(),null;p=p.wordsAsFloat32Array();b=b.wordsAsFloat32Array();c?q=d.wordsAsFloat32Array():w=f.floatValueOf(d);for(d=0;d<=k-1;d++)u=c?q[d]:w,g(d,p,b,u,a,e,y);if(f.failed())return null;f.pop(6)},setScalarHeading:function(){var a,d,
c;a=f.stackFloatValue(0);d=f.stackValue(1);c=f.stackIntegerValue(2);if(f.failed())return null;if(!f.isWords(d)||n(d)<c)return f.primitiveFail(),null;d.wordsAsFloat32Array()[c-1]=b(a);if(f.failed())return null;f.pop(3)},makeMask:function(){var a,b,d,c,e,g,y;y=f.stackIntegerValue(0);g=f.stackIntegerValue(1);c=f.stackValue(2);b=f.stackValue(3);if(f.failed())return null;d=n(b);e=n(c);if(d!==e||-32>y||8<y)return f.primitiveFail(),null;b=b.words;e=c.words;for(c=0;c<=d-1;c++)a=b[c],a=0>y?-31>y?0:a>>>0-y:
31<y?0:a<<y,255<a&&(a=255),0>a&&(a=0),e[c]=a<<24&4278190080|g;f.pop(4)},primitiveDivScalar:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(b);f.success(e===n(g));if(f.failed())return null;d="number"===typeof a;c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),
null;if(c)if(d)for(d=b.words,b=a,c=g.words,a=0;a<=e-1;a++)c[a]=Math.floor(d[a]/b)|0;else for(d=b.words,b=f.floatValueOf(a),c=g.wordsAsFloat32Array(),a=0;a<=e-1;a++)c[a]=d[a]/b;else for(d?(d=b.wordsAsFloat32Array(),b=a):(d=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),c=g.wordsAsFloat32Array(),a=0;a<=e-1;a++)c[a]=d[a]/b;f.pop(4);f.push(g)},primitiveSubScalar:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));
f.success(f.isWords(g));if(f.failed())return null;e=n(b);f.success(e===n(g));if(f.failed())return null;d="number"===typeof a;c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;c?d?(d=b.words,b=a,c=g.words):(d=b.words,b=f.floatValueOf(a),c=g.wordsAsFloat32Array()):(d?(d=b.wordsAsFloat32Array(),b=a):(d=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),c=g.wordsAsFloat32Array());for(a=
0;a<=e-1;a++)c[a]=d[a]-b;f.pop(4);f.push(g)},primPixelsAtXY:function(){var a,b,d,c,e,g,y,k,w,q;e=f.stackValue(0);b=f.stackIntegerValue(1);c=f.stackIntegerValue(2);a=f.stackValue(3);q=f.stackValue(4);k=f.stackValue(5);if(f.failed())return null;if(!(f.isWords(e)&&f.isWords(k)&&f.isWords(q)&&f.isWords(a))||b*c!==n(a))return f.primitiveFail(),null;y=n(k);if(n(q)!==y||n(e)!==y)return f.primitiveFail(),null;k=k.wordsAsFloat32Array();q=q.wordsAsFloat32Array();e=e.words;a=a.words;for(g=0;g<=y-1;g++)d=k[g]|
0,w=q[g]|0,0<=d&&0<=w&&d<c&&w<b&&(d=w*c+d,e[g]=a[d]);if(f.failed())return null;f.pop(6)},vectorGetAngleTo:function(){var b,d,c,e,l,g,y,k,w,q,p,x,A;w=f.stackValue(0);A=f.stackValue(1);p=f.stackValue(2);l=f.stackValue(3);b=f.stackValue(4);if(f.failed())return null;if(!f.isWords(w)||!f.isWords(p)||!f.isWords(A))return f.primitiveFail(),null;q=n(w);if(0>q||n(p)!==q||n(A)!==q)return f.primitiveFail(),null;if(b.isFloat)if(l.isFloat)d=!1;else return f.primitiveFail(),null;else{if(l.isFloat)return f.primitiveFail(),
null;d=!0}if(d&&(n(b)!==q||n(l)!==q))return f.primitiveFail(),null;k=w.wordsAsFloat32Array();p=p.wordsAsFloat32Array();A=A.wordsAsFloat32Array();d&&(c=b.wordsAsFloat32Array(),e=l.wordsAsFloat32Array());d||(g=f.floatValueOf(b),y=f.floatValueOf(l));for(b=0;b<=q-1;b++)d&&(g=c[b],y=e[b]),l=g-p[b],x=y-A[b],l=a(l,x),l+=90,360<l&&(l-=360),k[b]=l;if(f.failed())return null;f.pop(6);f.push(w)},primitiveMulArrays:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);
if(f.failed())return null;f.success(f.isWords(a));f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;d=f.isMemberOf(a,"WordArray");c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;c?d?(d=b.words,b=a.words,c=g.words):(d=b.words,b=a.wordsAsFloat32Array(),c=g.wordsAsFloat32Array()):
(d?(d=b.wordsAsFloat32Array(),b=a.words):(d=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),c=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)c[a]=d[a]*b[a];f.pop(4);f.push(g)},primPixelAtXYPut:function(){var a,b,d,c,e,g;b=f.stackIntegerValue(0);c=f.stackIntegerValue(1);d=f.stackIntegerValue(2);g=f.stackFloatValue(3);e=f.stackFloatValue(4);a=f.stackValue(5);if(f.failed())return null;if(!f.isWords(a)||n(a)!==b*c)return f.primitiveFail(),null;e|=0;g|=0;1073741823<d&&(d=1073741823);0>d&&(d=0);a=a.words;
0<=e&&e<c&&0<=g&&g<b&&(a[g*c+e]=d);if(f.failed())return null;f.pop(6)},zoomBitmap:function(){var a,b,d,c,e,g,y,k,w,q,p,x,A,H;H=f.stackIntegerValue(0);x=f.stackIntegerValue(1);g=f.stackIntegerValue(2);y=f.stackIntegerValue(3);a=f.stackValue(4);b=f.stackValue(5);if(f.failed())return null;d=n(b);c=n(a);if(y*g!==d||d*x*H!==c)return f.primitiveFail(),null;c=b.words;b=a.words;for(p=d=w=k=0;p<=g-1;p++){for(A=0;A<=H-1;A++){for(q=0;q<=y-1;q++)for(a=c[k],++k,e=0;e<=x-1;e++)b[d]=a,++d;k=w}k=w+=y}f.pop(6)},initialiseModule:function(){d=
17;p=16807;A=2147483647;x=Math.floor(A/p)|0;var a=p;q=A-(Math.floor(A/a)|0)*a|0},primitiveAddArrays:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackObjectValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(a));f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;e=n(a);f.success(e===n(b));f.success(e===n(g));if(f.failed())return null;d=f.isMemberOf(a,"WordArray");c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),
null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;c?d?(d=b.words,b=a.words,c=g.words):(d=b.words,b=a.wordsAsFloat32Array(),c=g.wordsAsFloat32Array()):(d?(d=b.wordsAsFloat32Array(),b=a.words):(d=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),c=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)c[a]=d[a]+b[a];f.pop(4);f.push(g)},scalarGetDistanceTo:function(){var a,b,d,c;b=f.stackFloatValue(0);a=f.stackFloatValue(1);c=f.stackFloatValue(2);d=f.stackFloatValue(3);if(f.failed())return null;
a-=d;b-=c;b=Math.sqrt(a*a+b*b);if(f.failed())return null;f.pop(5);f.pushFloat(b)},turtlesSetY:function(){var a,b,d,c,e,g,y,q,w,p,x;a=f.stackIntegerValue(0);q=f.stackIntegerValue(1);b=f.stackFloatValue(2);c=f.stackValue(3);d=f.stackValue(4);x=f.stackValue(5);if(f.failed())return null;if(!f.isWords(x)||!f.isWords(d))return f.primitiveFail(),null;if(c.isFloat)e=!1;else if(f.isWords(c))e=!0;else return f.primitiveFail(),null;y=n(x);if(n(d)!==y||e&&n(c)!==y)return f.primitiveFail(),null;x=x.wordsAsFloat32Array();
d=d.wordsAsFloat32Array();e?p=c.wordsAsFloat32Array():w=f.floatValueOf(c);for(c=0;c<=y-1;c++)g=e?p[c]:w,k(c,x,d,g,b,q,a);if(f.failed())return null;f.pop(6)},randomIntoFloatArray:function(){var a,b,d,e,l;a=f.stackFloatValue(0);b=f.stackValue(1);l=f.stackIntegerValue(2);d=f.stackIntegerValue(3);e=f.stackIntegerValue(4);if(f.failed())return null;if(!(f.isWords(b)&&n(b)>=l&&1<=d&&l>=d))return f.primitiveFail(),null;b=b.wordsAsFloat32Array();if(f.failed())return null;for(;d<=l;d++)b[d-1]=c(e)*a;f.pop(5)},
primTurtlesForward:function(){var a,b,d,c,e,u,y,q,w,p,x,A,K,H,C,D;a=f.stackIntegerValue(0);A=f.stackIntegerValue(1);p=f.stackIntegerValue(2);q=f.stackIntegerValue(3);b=f.stackFloatValue(4);d=f.stackFloatValue(5);u=f.stackValue(6);e=f.stackValue(7);D=f.stackValue(8);C=f.stackValue(9);if(f.failed())return null;if(!f.isWords(C)||!f.isWords(D)||!f.isWords(e))return f.primitiveFail(),null;if(u.isFloat)y=!1;else if(f.isWords(u))y=!0;else return f.primitiveFail(),null;x=n(C);if(n(D)!==x||n(e)!==x||y&&n(u)!==
x)return f.primitiveFail(),null;C=C.wordsAsFloat32Array();D=D.wordsAsFloat32Array();e=e.wordsAsFloat32Array();y?H=u.wordsAsFloat32Array():K=f.floatValueOf(u);for(u=0;u<=x-1;u++)c=y?H[u]:K,w=C[u]+c*Math.cos(e[u]),c=D[u]-c*Math.sin(e[u]),g(u,C,e,w,d,q,p),k(u,D,e,c,b,A,a);if(f.failed())return null;f.pop(10)},primitiveMulScalar:function(){var a,b,d,c,e,g;g=f.stackObjectValue(0);a=f.stackValue(1);b=f.stackObjectValue(2);if(f.failed())return null;f.success(f.isWords(b));f.success(f.isWords(g));if(f.failed())return null;
e=n(b);f.success(e===n(g));if(f.failed())return null;d="number"===typeof a;c=f.isMemberOf(b,"WordArray");if(d&&c){if(!f.isMemberOf(g,"WordArray"))return f.primitiveFail(),null}else if(!f.isMemberOf(g,"KedamaFloatArray"))return f.primitiveFail(),null;c?d?(d=b.words,b=a,c=g.words):(d=b.words,b=f.floatValueOf(a),c=g.wordsAsFloat32Array()):(d?(d=b.wordsAsFloat32Array(),b=a):(d=b.wordsAsFloat32Array(),b=f.floatValueOf(a)),c=g.wordsAsFloat32Array());for(a=0;a<=e-1;a++)c[a]=d[a]*b;f.pop(4);f.push(g)}})});module("users.bert.SqueakJS.plugins.KedamaPlugin2").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return a-(Math.floor(a/b)|0)*b|0}function b(a,b){var d;if(0===a)return 0<=b?90:270;d=Math.atan(b/a);return 0<=a?0<=b?d/.0174532925199433:360+d/.0174532925199433:180+d/.0174532925199433}function c(a){var b;a=90-a;b=a/360|0;0>a&&--b;return.0174532925199433*(a-360*b)}function e(b){var d,
c,e;e=0>b?0-b:b;d=Math.floor(p/q)|0;c=a(p,q);p=A*c-m*d;d=(p&65535)*(e+1)>>>16;return 0>b?0-d:d}function g(a){a=90-a/.0174532925199433;0<a||(a+=360);return a}function k(a,b,d,c,e,f,g){0>c&&(1===f&&(c+=e),2===f&&(c=0),3===f&&(c=0-c,f=d[a],d[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));c>=e&&(1===g&&(c-=e),2===g&&(c=e-1E-6),3===g&&(c=e-1E-6-(c-e),f=d[a],d[a]=3.141592653589793>f?3.141592653589793-f:9.42477796076938-f));b[a]=c}function f(a,b,d,c,e,f,g){0>c&&(1===f&&(c+=e),2===f&&(c=
0),3===f&&(c=0-c,d[a]=6.283185307179586-d[a]));c>=e&&(1===g&&(c-=e),2===g&&(c=e-1E-6),3===g&&(c=e-1E-6-(c-e),d[a]=6.283185307179586-d[a]));b[a]=c}var d=null,p=0,A=0,x=0,q=0,m=0;Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===
n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]+b[a];d.pop(4);
d.push(g)},getModuleName:function(){return"KedamaPlugin2 13 November 2014 (e)"},primitiveMulArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),
null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]*b[a];d.pop(4);d.push(g)},drawTurtlesInArray:function(){var a,b,c,e,f,g,m,k,q,p,x,A;k=d.stackValue(0);b=d.stackValue(1);A=d.stackValue(2);p=d.stackValue(3);e=d.stackIntegerValue(4);
f=d.stackIntegerValue(5);c=d.stackValue(6);if(d.failed())return null;if(!(d.isWords(c)&&d.isWords(p)&&d.isWords(A)&&d.isWords(b)&&d.isBytes(k))||e*f!==n(c))return d.primitiveFail(),null;m=n(p);if(n(A)!==m||n(b)!==m||n(k)!==m)return d.primitiveFail(),null;p=p.wordsAsFloat32Array();A=A.wordsAsFloat32Array();b=b.words;k=k.bytes;c=c.words;for(g=0;g<=m-1;g++)q=p[g]|0,x=A[g]|0,a=k[g],0!==a&&0<=q&&0<=x&&q<f&&x<e&&(a=x*f+q,c[a]=b[g]);if(d.failed())return null;d.pop(7)},primitiveGTScalar:function(){var a,
b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>b;d.pop(4);d.push(g)},setScalarHeading:function(){var a,
b,e;a=d.stackFloatValue(0);b=d.stackValue(1);e=d.stackIntegerValue(2);if(d.failed())return null;if(!d.isWords(b)||n(b)<e)return d.primitiveFail(),null;b.wordsAsFloat32Array()[e-1]=c(a);if(d.failed())return null;d.pop(3)},primitiveSubScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;
e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a,e=g.words):(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]-b;d.pop(4);d.push(g)},turtleScalarSetY:function(){var a,b,c,e,g,m,k,w;a=d.stackIntegerValue(0);g=d.stackIntegerValue(1);
b=d.stackFloatValue(2);m=d.stackFloatValue(3);c=d.stackValue(4);k=d.stackIntegerValue(5);w=d.stackValue(6);if(d.failed())return null;if(!d.isWords(w)||!d.isWords(c))return d.primitiveFail(),null;e=n(w);if(n(c)!==e)return d.primitiveFail(),null;e=w.wordsAsFloat32Array();c=c.wordsAsFloat32Array();f(k-1,e,c,m,b,g,a);if(d.failed())return null;d.pop(7)},vectorGetAngleTo:function(){var a,c,e,f,g,m,k,w,q,p,x,A,H;q=d.stackValue(0);H=d.stackValue(1);x=d.stackValue(2);g=d.stackValue(3);a=d.stackValue(4);if(d.failed())return null;
if(!d.isWords(q)||!d.isWords(x)||!d.isWords(H))return d.primitiveFail(),null;p=n(q);if(0>p||n(x)!==p||n(H)!==p)return d.primitiveFail(),null;if(a.isFloat)if(g.isFloat)c=!1;else return d.primitiveFail(),null;else{if(g.isFloat)return d.primitiveFail(),null;c=!0}if(c&&(n(a)!==p||n(g)!==p))return d.primitiveFail(),null;w=q.wordsAsFloat32Array();x=x.wordsAsFloat32Array();H=H.wordsAsFloat32Array();c&&(e=a.wordsAsFloat32Array(),f=g.wordsAsFloat32Array());c||(m=d.floatValueOf(a),k=d.floatValueOf(g));for(a=
0;a<=p-1;a++)c&&(m=e[a],k=f[a]),g=m-x[a],A=k-H[a],g=b(g,A),g+=90,360<g&&(g-=360),w[a]=g;if(d.failed())return null;d.pop(6);d.push(q)},primitiveRemArrays:function(){var b,c,e,f,g,m,k,w,q;q=d.stackObjectValue(0);b=d.stackObjectValue(1);k=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(k));d.success(d.isWords(q));if(d.failed())return null;w=n(b);d.success(w===n(k));d.success(w===n(q));if(d.failed())return null;m=d.isMemberOf(b,"WordArray");f=d.isMemberOf(k,
"WordArray");if(m&&f){if(!d.isMemberOf(q,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(q,"KedamaFloatArray"))return d.primitiveFail(),null;if(f)if(m)for(m=k.words,c=b.words,f=q.words,b=0;b<=w-1;b++)e=m[b],g=c[b],k=a(e,g),f[b]=k;else for(m=k.words,g=b.wordsAsFloat32Array(),k=q.wordsAsFloat32Array(),b=0;b<=w-1;b++)e=m[b],c=g[b],f=e/c,f=Math.floor(f),k[b]=e-f*c;else if(m)for(m=k.wordsAsFloat32Array(),c=b.words,k=q.wordsAsFloat32Array(),b=0;b<=w-1;b++)e=m[b],g=c[b],f=e/g,f=Math.floor(f),
k[b]=e-f*g;else for(m=k.wordsAsFloat32Array(),g=b.wordsAsFloat32Array(),k=q.wordsAsFloat32Array(),b=0;b<=w-1;b++)e=m[b],c=g[b],f=e/c,f=Math.floor(f),k[b]=e-f*c;d.pop(4);d.push(q)},primitiveLTArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,
"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<b[e];d.pop(4);d.push(g)},primitiveAddScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;
c="number"===typeof a;e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a,e=g.words):(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]+b;d.pop(4);d.push(g)},primPixelsAtXY:function(){var a,b,c,e,f,g,m,k,q,p;f=d.stackValue(0);
b=d.stackIntegerValue(1);e=d.stackIntegerValue(2);a=d.stackValue(3);p=d.stackValue(4);k=d.stackValue(5);if(d.failed())return null;if(!(d.isWords(f)&&d.isWords(k)&&d.isWords(p)&&d.isWords(a))||b*e!==n(a))return d.primitiveFail(),null;m=n(k);if(n(p)!==m||n(f)!==m)return d.primitiveFail(),null;k=k.wordsAsFloat32Array();p=p.wordsAsFloat32Array();f=f.words;a=a.words;for(g=0;g<=m-1;g++)c=k[g]|0,q=p[g]|0,0<=c&&0<=q&&c<e&&q<b&&(c=q*e+c,f[g]=a[c]);if(d.failed())return null;d.pop(6)},primitiveMulScalar:function(){var a,
b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a,e=g.words):(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array()):
(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]*b;d.pop(4);d.push(g)},primSetPixelsAtXY:function(){var a,b,c,e,f,g,m,k,q,p,x,A,H,C,D;m=d.stackValue(0);b=d.stackIntegerValue(1);e=d.stackIntegerValue(2);a=d.stackValue(3);k=d.stackValue(4);C=d.stackValue(5);p=d.stackValue(6);if(d.failed())return null;if(!(d.isBytes(p)&&d.isWords(C)&&d.isWords(k)&&d.isWords(a))||b*e!==n(a))return d.primitiveFail(),null;x=n(C);if(n(p)!==
x||n(k)!==x)return d.primitiveFail(),null;p=p.bytes;C=C.wordsAsFloat32Array();D=k.wordsAsFloat32Array();if(k="number"===typeof m)A=m;else{if(n(m)!==x)return d.primitiveFail(),null;(q=d.isMemberOf(m,"WordArray"))?H=m.words:f=m.wordsAsFloat32Array()}a=a.words;for(m=0;m<=x-1;m++)1===p[m]&&(c=C[m]|0,g=D[m]|0,0<=c&&0<=g&&c<e&&g<b&&(c=g*e+c,k?a[c]=A:q?a[c]=H[m]:(g=f[m],a[c]=g)));if(d.failed())return null;d.pop(7)},setHeadingArrayFrom:function(){var a,b,e,f,g,m,k;e=d.stackValue(0);b=d.stackValue(1);g=d.stackValue(2);
if(d.failed())return null;if(!d.isBytes(g)||!d.isWords(b))return d.primitiveFail(),null;k=n(b);if(e.isFloat)f=!1;else if(d.isWords(e)){if(n(e)!==k)return d.primitiveFail(),null;f=!0}else return d.primitiveFail(),null;g=g.bytes;b=b.wordsAsFloat32Array();f?m=e.wordsAsFloat32Array():(a=d.floatValueOf(e),a=c(a));for(e=0;e<=k-1;e++)1===g[e]&&(f&&(a=m[e],a=c(a)),b[e]=a);if(d.failed())return null;d.pop(3)},primPixelAtXYPut:function(){var a,b,c,e,f,g;b=d.stackIntegerValue(0);e=d.stackIntegerValue(1);c=d.stackIntegerValue(2);
g=d.stackFloatValue(3);f=d.stackFloatValue(4);a=d.stackValue(5);if(d.failed())return null;if(!d.isWords(a)||n(a)!==b*e)return d.primitiveFail(),null;f|=0;g|=0;1073741823<c&&(c=1073741823);0>c&&(c=0);a=a.words;0<=f&&f<e&&0<=g&&g<b&&(a[g*e+f]=c);if(d.failed())return null;d.pop(6)},makeMaskLog:function(){var a,b,c,e,f,g,m;c=d.stackValue(0);m=d.stackIntegerValue(1);e=d.stackValue(2);b=d.stackValue(3);if(d.failed())return null;c=c.words[0];if(d.failed())return null;g=Math.log(c);c=n(b);f=n(e);if(c!==f)return d.primitiveFail(),
null;b=b.words;f=e.words;for(e=0;e<=c-1;e++)a=b[e],a=0===a?0:255/g*Math.log(a)|0,255<a&&(a=255),f[e]=a<<24&4278190080|m;d.pop(4)},primitiveLTScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),
b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<b;d.pop(4);d.push(g)},scalarGetAngleTo:function(){var a,c,e,f;c=d.stackFloatValue(0);a=d.stackFloatValue(1);f=d.stackFloatValue(2);e=d.stackFloatValue(3);if(d.failed())return null;a=b(e-a,f-c);a+=90;360<a&&(a-=360);if(d.failed())return null;d.pop(5);d.pushFloat(a)},primitiveOrByteArray:function(){var a,b,c,e,f;f=d.stackObjectValue(0);a=d.stackValue(1);if(d.failed())return null;d.success(d.isBytes(a));d.success(d.isBytes(f));
if(d.failed())return null;c=n(a);e=n(f);if(d.failed())return null;b=c;c>e&&(b=e);c=f.bytes;e=a.bytes;for(a=0;a<=b-1;a++)e[a]=0<e[a]+c[a];d.pop(1)},primitiveLEArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,
"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<=b[e];d.pop(4);d.push(g)},primitiveRemScalar:function(){var b,c,e,f,g,m,k,w;w=d.stackObjectValue(0);b=d.stackValue(1);g=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(g));d.success(d.isWords(w));if(d.failed())return null;k=n(g);d.success(k===n(w));if(d.failed())return null;
f="number"===typeof b;m=d.isMemberOf(g,"WordArray");if(f&&m){if(!d.isMemberOf(w,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(w,"KedamaFloatArray"))return d.primitiveFail(),null;if(m)if(f)for(g=g.words,c=b,f=w.words,b=0;b<=k-1;b++)f[b]=a(g[b],c);else for(g=g.words,c=d.floatValueOf(b),m=w.wordsAsFloat32Array(),b=0;b<=k-1;b++)e=g[b],f=e/c,f=Math.floor(f),m[b]=e-f*c;else for(f?(g=g.wordsAsFloat32Array(),c=b):(g=g.wordsAsFloat32Array(),c=d.floatValueOf(b)),m=w.wordsAsFloat32Array(),
b=0;b<=k-1;b++)e=g[b],f=e/c,f=Math.floor(f),m[b]=e-f*c;d.pop(4);d.push(w)},getHeadingArrayInto:function(){var a,b,c,e,f;a=d.stackValue(0);b=d.stackValue(1);if(d.failed())return null;if(!d.isWords(b)||!d.isWords(a))return d.primitiveFail(),null;f=n(b);if(n(a)!==f)return d.primitiveFail(),null;b=b.wordsAsFloat32Array();e=a.wordsAsFloat32Array();for(c=0;c<=f-1;c++)a=b[c],a/=.0174532925199433,a=90-a,0<a||(a+=360),e[c]=a;if(d.failed())return null;d.pop(2)},turtlesSetX:function(){var a,b,c,e,f,g,m,w,q,
p,x,A,H,C;q=d.stackIntegerValue(0);g=d.stackIntegerValue(1);a=d.stackFloatValue(2);c=d.stackValue(3);b=d.stackValue(4);C=d.stackValue(5);w=d.stackValue(6);if(d.failed())return null;if(!d.isBytes(w)||!d.isWords(C)||!d.isWords(b))return d.primitiveFail(),null;if(c.isFloat)e=!1;else if(d.isWords(c))e=!0,f=d.isMemberOf(c,"WordArray");else return d.primitiveFail(),null;p=n(C);if(n(w)!==p||n(b)!==p||e&&n(c)!==p)return d.primitiveFail(),null;w=w.bytes;C=C.wordsAsFloat32Array();b=b.wordsAsFloat32Array();
e?f?H=c.words:A=c.wordsAsFloat32Array():x=d.floatValueOf(c);for(c=0;c<=p-1;c++)1===w[c]&&(m=e?f?H[c]:A[c]:x,k(c,C,b,m,a,g,q));if(d.failed())return null;d.pop(7)},primitivePredicateReplaceBytes:function(){var a,b,c,e,f,g,m,k,q;e=d.stackIntegerValue(0);a=d.stackObjectValue(1);m=d.stackIntegerValue(2);g=d.stackIntegerValue(3);b=d.stackObjectValue(4);if(d.failed())return null;q=d.fetchPointerofObject(1,b);c=d.fetchPointerofObject(0,b);if(d.failed())return null;if(!d.isBytes(c)||!d.isBytes(q)||!d.isBytes(a))return d.primitiveFail(),
null;k=q.bytes;b=c.bytes;f=a.bytes;q=n(q);c=n(c);a=n(a);if(g>m||1>g||g>q||g>c||m>q||m>c||1>e||e>a||a-e+1<m-g+1)return d.primitiveFail(),null;for(a=g-1;a<=m-1;a++)1===b[a]&&(k[a]=f[e+a-g]);d.pop(4)},primitiveDivArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===n(g));if(d.failed())return null;
c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]/b[a];d.pop(4);d.push(g)},makeMask:function(){var a,
b,c,e,f,g,m;m=d.stackIntegerValue(0);g=d.stackIntegerValue(1);e=d.stackValue(2);b=d.stackValue(3);if(d.failed())return null;c=n(b);f=n(e);if(c!==f||-32>m||8<m)return d.primitiveFail(),null;b=b.words;f=e.words;for(e=0;e<=c-1;e++)a=b[e],a=0>m?-31>m?0:a>>>0-m:31<m?0:a<<m,255<a&&(a=255),0>a&&(a=0),f[e]=a<<24&4278190080|g;d.pop(4)},primitiveLEScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));
if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]<=b;d.pop(4);d.push(g)},kedamaSetRandomSeed:function(){var a;a=d.stackIntegerValue(0);if(d.failed())return null;p=a&65536;d.pop(1)},randomIntoIntegerArray:function(){var a,b,c,f,g;a=d.stackFloatValue(0);
c=d.stackValue(1);g=d.stackIntegerValue(2);b=d.stackIntegerValue(3);f=d.stackIntegerValue(4);if(d.failed())return null;if(!(d.isWords(c)&&n(c)>=g&&1<=b&&g>=b))return d.primitiveFail(),null;c=c.words;if(d.failed())return null;for(;b<=g;b++)c[b-1]=e(f)*a|0;d.pop(5)},setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitivePredicateAtAllPutColor:function(){var a,b,c,e,f;e=d.stackIntegerValue(0);c=d.stackObjectValue(1);if(d.failed())return null;e|=4278190080;
f=d.fetchPointerofObject(1,c);a=d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isWords(f))return d.primitiveFail(),null;c=f.words;b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},makeTurtlesMap:function(){var a,b,c,e,f,g,m,k,q,p;a=d.stackIntegerValue(0);m=d.stackIntegerValue(1);p=d.stackValue(2);k=d.stackValue(3);g=d.stackValue(4);b=d.stackValue(5);if(!(d.isWords(p)&&d.isWords(k)&&d.isWords(g)&&d.isWords(b)))return d.primitiveFail(),null;f=n(g);if(n(k)!==f||
n(p)!==f||n(b)!==a*m)return d.primitiveFail(),null;k=k.wordsAsFloat32Array();p=p.wordsAsFloat32Array();g=g.words;c=b.words;for(b=0;b<=a*m-1;b++)c[b]=0;for(b=0;b<=f-1;b++)e=k[b],q=p[b],e=m*q+e,0<=e&&e<a*m&&(c[e]=g[b]);if(d.failed())return null;d.pop(6)},randomIntoFloatArray:function(){var a,b,c,f,g;a=d.stackFloatValue(0);b=d.stackValue(1);g=d.stackIntegerValue(2);c=d.stackIntegerValue(3);f=d.stackIntegerValue(4);if(d.failed())return null;if(!(d.isWords(b)&&n(b)>=g&&1<=c&&g>=c))return d.primitiveFail(),
null;b=b.wordsAsFloat32Array();if(d.failed())return null;for(;c<=g;c++)b[c-1]=e(f)*a;d.pop(5)},primUpHill:function(){var a,c,e,f,m,k,q,w,p,x,A,K,H,C,D;f=d.stackIntegerValue(0);e=d.stackIntegerValue(1);H=d.stackIntegerValue(2);a=d.stackValue(3);p=d.stackFloatValue(4);c=d.stackFloatValue(5);x=d.stackFloatValue(6);if(d.failed())return null;if(!d.isWords(a)||n(a)!==e*H)return d.primitiveFail(),null;a=a.words;x=Math.max(x,0);K=Math.max(c,0);x=Math.min(x,H-1);K=Math.min(K,e-1);w=Math.max(x-f,0);c=Math.min(x+
f,H-1);q=Math.max(K-f,0);e=Math.min(K+f,e-1);f=a[K*H+x];m=-1;for(D=q;D<=e;D++)for(q=D*H,C=w;C<=c;C++)A=a[q+C],A>f&&(m=C,k=D,f=A);k=-1===m?g(p):b(m-x,k-K)+90|0;if(d.failed())return null;d.pop(8);d.pushFloat(k)},shutdownModule:function(){return!0},primitiveDivScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);b=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(b);d.success(f===n(g));if(d.failed())return null;
c="number"===typeof a;e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;if(e)if(c)for(c=b.words,b=a,e=g.words,a=0;a<=f-1;a++)e[a]=Math.floor(c[a]/b)|0;else for(c=b.words,b=d.floatValueOf(a),e=g.wordsAsFloat32Array(),a=0;a<=f-1;a++)e[a]=c[a]/b;else for(c?(c=b.wordsAsFloat32Array(),b=a):(c=b.wordsAsFloat32Array(),b=d.floatValueOf(a)),e=g.wordsAsFloat32Array(),a=0;a<=f-1;a++)e[a]=
c[a]/b;d.pop(4);d.push(g)},primitiveGEArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):
(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>=b[e];d.pop(4);d.push(g)},primitiveNotByteArray:function(){var a,b,c;a=d.stackValue(0);if(d.failed())return null;d.success(d.isBytes(a));if(d.failed())return null;b=n(a);if(d.failed())return null;c=a.bytes;for(a=0;a<=b-1;a++)c[a]=0===c[a]?1:0},randomRange:function(){var a;a=d.stackIntegerValue(0);if(d.failed())return null;a=e(a);if(d.failed())return null;d.pop(2);d.pushInteger(a)},initialiseModule:function(){p=
17;A=16807;x=2147483647;q=Math.floor(x/A)|0;m=a(x,A)},getScalarHeading:function(){var a,b;a=d.stackValue(0);b=d.stackIntegerValue(1);if(d.failed())return null;if(!d.isWords(a)||n(a)<b)return d.primitiveFail(),null;a=a.wordsAsFloat32Array()[b-1];a=g(a);if(d.failed())return null;d.pop(3);d.pushFloat(a)},primPixelAtXY:function(){var a,b,c,e,f;b=d.stackIntegerValue(0);c=d.stackIntegerValue(1);f=d.stackFloatValue(2);e=d.stackFloatValue(3);a=d.stackValue(4);if(d.failed())return null;if(!d.isWords(a)||n(a)!==
b*c)return d.primitiveFail(),null;e|=0;f|=0;a=a.words;b=0<=e&&e<c&&0<=f&&f<b?a[f*c+e]:0;if(d.failed())return null;d.pop(6);d.pushInteger(b)},primitivePredicateAtAllPutNumber:function(){var a,b,c,e,f;e=d.stackFloatValue(0);c=d.stackObjectValue(1);if(d.failed())return null;f=d.fetchPointerofObject(1,c);a=d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isWords(f))return d.primitiveFail(),null;c=f.wordsAsFloat32Array();b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},
primitiveEQArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),
b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]===b[e];d.pop(4);d.push(g)},primitiveNEArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=
a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]!==b[e];d.pop(4);d.push(g)},primScalarForward:function(){var a,b,c,e,g,m,q,w,p,x,A,K;a=d.stackIntegerValue(0);A=d.stackIntegerValue(1);p=d.stackIntegerValue(2);m=d.stackIntegerValue(3);b=d.stackFloatValue(4);c=d.stackFloatValue(5);w=d.stackFloatValue(6);e=d.stackValue(7);K=d.stackValue(8);q=d.stackValue(9);g=d.stackIntegerValue(10);if(d.failed())return null;
if(!d.isWords(q)||!d.isWords(K)||!d.isWords(e))return d.primitiveFail(),null;x=n(q);if(n(K)!==x||n(e)!==x)return d.primitiveFail(),null;x=q.wordsAsFloat32Array();K=K.wordsAsFloat32Array();e=e.wordsAsFloat32Array();--g;q=x[g]+w*Math.cos(e[g]);w=K[g]-w*Math.sin(e[g]);k(g,x,e,q,c,m,p);f(g,K,e,w,b,A,a);if(d.failed())return null;d.pop(11)},vectorGetDistanceTo:function(){var a,b,c,e,f,g,m,k,q,p,x,A,H;q=d.stackValue(0);H=d.stackValue(1);x=d.stackValue(2);f=d.stackValue(3);a=d.stackValue(4);if(d.failed())return null;
if(!d.isWords(q)||!d.isWords(x)||!d.isWords(H))return d.primitiveFail(),null;p=n(q);if(0>p||n(x)!==p||n(H)!==p)return d.primitiveFail(),null;if(a.isFloat)if(f.isFloat)b=!1;else return d.primitiveFail(),null;else{if(f.isFloat)return d.primitiveFail(),null;b=!0}if(b&&(n(a)!==p||n(f)!==p))return d.primitiveFail(),null;k=q.wordsAsFloat32Array();x=x.wordsAsFloat32Array();H=H.wordsAsFloat32Array();b&&(c=a.wordsAsFloat32Array(),e=f.wordsAsFloat32Array());b||(g=d.floatValueOf(a),m=d.floatValueOf(f));for(a=
0;a<=p-1;a++)b&&(g=c[a],m=e[a]),f=g-x[a],A=m-H[a],k[a]=Math.sqrt(f*f+A*A);if(d.failed())return null;d.pop(6);d.push(q)},turtlesSetY:function(){var a,b,c,e,g,m,k,q,p,x,A,K,H,C;a=d.stackIntegerValue(0);x=d.stackIntegerValue(1);b=d.stackFloatValue(2);e=d.stackValue(3);c=d.stackValue(4);C=d.stackValue(5);q=d.stackValue(6);if(d.failed())return null;if(!d.isBytes(q)||!d.isWords(C)||!d.isWords(c))return d.primitiveFail(),null;if(e.isFloat)g=!1;else if(d.isWords(e))g=!0,m=d.isMemberOf(e,"WordArray");else return d.primitiveFail(),
null;p=n(C);if(n(q)!==p||n(c)!==p||g&&n(e)!==p)return d.primitiveFail(),null;q=q.bytes;C=C.wordsAsFloat32Array();c=c.wordsAsFloat32Array();g?m?H=e.words:K=e.wordsAsFloat32Array():A=d.floatValueOf(e);for(e=0;e<=p-1;e++)1===q[e]&&(k=g?m?H[e]:K[e]:A,f(e,C,c,k,b,x,a));if(d.failed())return null;d.pop(7)},turtleScalarSetX:function(){var a,b,c,e,f,g,m,q;e=d.stackIntegerValue(0);c=d.stackIntegerValue(1);a=d.stackFloatValue(2);g=d.stackFloatValue(3);b=d.stackValue(4);m=d.stackIntegerValue(5);q=d.stackValue(6);
if(d.failed())return null;if(!d.isWords(q)||!d.isWords(b))return d.primitiveFail(),null;f=n(q);if(n(b)!==f)return d.primitiveFail(),null;f=q.wordsAsFloat32Array();b=b.wordsAsFloat32Array();k(m-1,f,b,g,a,c,e);if(d.failed())return null;d.pop(7)},primTurtlesForward:function(){var a,b,c,e,g,m,q,w,p,x,A,K,H,C,D,v,N;a=d.stackIntegerValue(0);H=d.stackIntegerValue(1);A=d.stackIntegerValue(2);w=d.stackIntegerValue(3);b=d.stackFloatValue(4);c=d.stackFloatValue(5);m=d.stackValue(6);g=d.stackValue(7);N=d.stackValue(8);
v=d.stackValue(9);x=d.stackValue(10);if(d.failed())return null;if(!(d.isBytes(x)&&d.isWords(v)&&d.isWords(N)&&d.isWords(g)))return d.primitiveFail(),null;if(m.isFloat)q=!1;else if(d.isWords(m))q=!0;else return d.primitiveFail(),null;K=n(v);if(n(N)!==K||n(g)!==K||n(x)!==K||q&&n(m)!==K)return d.primitiveFail(),null;x=x.bytes;v=v.wordsAsFloat32Array();N=N.wordsAsFloat32Array();g=g.wordsAsFloat32Array();q?D=m.wordsAsFloat32Array():C=d.floatValueOf(m);for(m=0;m<=K-1;m++)1===x[m]&&(e=q?D[m]:C,p=v[m]+e*
Math.cos(g[m]),e=N[m]-e*Math.sin(g[m]),k(m,v,g,p,c,w,A),f(m,N,g,e,b,H,a));if(d.failed())return null;d.pop(11)},primitiveGEScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),
b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>=b;d.pop(4);d.push(g)},primitiveAndByteArray:function(){var a,b,c,e,f;f=d.stackObjectValue(0);a=d.stackValue(1);if(d.failed())return null;d.success(d.isBytes(a));d.success(d.isBytes(f));if(d.failed())return null;c=n(a);e=n(f);if(d.failed())return null;b=c;c>e&&(b=e);c=f.bytes;e=a.bytes;for(a=0;a<=b-1;a++)e[a]=2===e[a]+c[a];d.pop(1)},primitivePredicateReplaceWords:function(){var a,b,c,e,f,g,m,k,q,p,x,A;k=d.stackIntegerValue(0);
m=d.stackObjectValue(1);x=d.stackIntegerValue(2);p=d.stackIntegerValue(3);f=d.stackObjectValue(4);if(d.failed())return null;A=d.fetchPointerofObject(1,f);g=d.fetchPointerofObject(0,f);if(d.failed())return null;if(!d.isBytes(g)||!(d.isWords(A)&&d.isWords(m)||d.isPointers(A)&&d.isPointers(m)))return d.primitiveFail(),null;f=g.bytes;e=n(A);g=n(g);q=n(m);if(p>x||1>p||p>e||p>g||x>e||x>g||1>k||k>q||q-k+1<x-p+1)return d.primitiveFail(),null;q=d.isMemberOf(A,"KedamaFloatArray");g=d.isMemberOf(m,"KedamaFloatArray");
if(q&&g)for(b=A.wordsAsFloat32Array(),a=m.wordsAsFloat32Array(),e=p-1;e<=x-1;e++)1===f[e]&&(b[e]=a[k+e-p]);if(q&&!g)for(b=A.wordsAsFloat32Array(),a=m.words,e=p-1;e<=x-1;e++)1===f[e]&&(b[e]=a[k+e-p]);if(!q&&g)for(b=A.words,a=m.wordsAsFloat32Array(),e=p-1;e<=x-1;e++)1===f[e]&&(c=a[k+e-p]>>>0,b[e]=c);if(!q&&!g)for(b=A.words,a=m.words,e=p-1;e<=x-1;e++)1===f[e]&&(b[e]=a[k+e-p]);d.pop(4)},primitiveGTArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);e=d.stackObjectValue(2);
if(d.failed())return null;d.success(d.isWords(a));d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(a);d.success(f===n(e));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a.words):(c=e.words,b=a.wordsAsFloat32Array()):c?(c=e.wordsAsFloat32Array(),b=a.words):(c=e.wordsAsFloat32Array(),b=a.wordsAsFloat32Array());a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]>b[e];d.pop(4);d.push(g)},primitivePredicateAtAllPutObject:function(){var a,
b,c,e,f;e=d.stackValue(0);c=d.stackObjectValue(1);if(d.failed())return null;f=d.fetchPointerofObject(1,c);a=d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isPointers(f))return d.primitiveFail(),null;c=f.wordsAsInt32Array();b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},primitiveEQScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;
f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]===b;d.pop(4);d.push(g)},primitivePredicateAtAllPutBoolean:function(){var a,b,c,e,f;e=d.stackValue(0);c=d.stackObjectValue(1);if(d.failed())return null;e=d.isIntegerValue(e)?e:d.booleanValueOf(e);f=d.fetchPointerofObject(1,c);a=
d.fetchPointerofObject(0,c);if(d.failed())return null;if(!d.isBytes(a)||!d.isBytes(f))return d.primitiveFail(),null;c=f.bytes;b=a.bytes;for(a=0;a<=n(f)-1;a++)1===b[a]&&(c[a]=e);d.pop(1)},zoomBitmap:function(){var a,b,c,e,f,g,m,k,q,p,x,A,H,C;C=d.stackIntegerValue(0);A=d.stackIntegerValue(1);g=d.stackIntegerValue(2);m=d.stackIntegerValue(3);a=d.stackValue(4);b=d.stackValue(5);if(d.failed())return null;c=n(b);e=n(a);if(m*g!==c||c*A*C!==e)return d.primitiveFail(),null;e=b.words;b=a.words;for(x=c=q=k=
0;x<=g-1;x++){for(H=0;H<=C-1;H++){for(p=0;p<=m-1;p++)for(a=e[k],++k,f=0;f<=A-1;f++)b[c]=a,++c;k=q}k=q+=m}d.pop(6)},primitiveNEScalar:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackValue(1);e=d.stackObjectValue(2);if(d.failed())return null;d.success(d.isWords(e));d.success(d.isBytes(g));if(d.failed())return null;f=n(e);d.success(f===n(g));if(d.failed())return null;c="number"===typeof a;d.isMemberOf(e,"WordArray")?c?(c=e.words,b=a):(c=e.words,b=d.floatValueOf(a)):c?(c=e.wordsAsFloat32Array(),
b=a):(c=e.wordsAsFloat32Array(),b=d.floatValueOf(a));a=g.bytes;for(e=0;e<=f-1;e++)a[e]=c[e]!==b;d.pop(4);d.push(g)},scalarGetDistanceTo:function(){var a,b,c,e;b=d.stackFloatValue(0);a=d.stackFloatValue(1);e=d.stackFloatValue(2);c=d.stackFloatValue(3);if(d.failed())return null;a-=c;b-=e;b=Math.sqrt(a*a+b*b);if(d.failed())return null;d.pop(5);d.pushFloat(b)},primitiveSubArrays:function(){var a,b,c,e,f,g;g=d.stackObjectValue(0);a=d.stackObjectValue(1);b=d.stackObjectValue(2);if(d.failed())return null;
d.success(d.isWords(a));d.success(d.isWords(b));d.success(d.isWords(g));if(d.failed())return null;f=n(a);d.success(f===n(b));d.success(f===n(g));if(d.failed())return null;c=d.isMemberOf(a,"WordArray");e=d.isMemberOf(b,"WordArray");if(c&&e){if(!d.isMemberOf(g,"WordArray"))return d.primitiveFail(),null}else if(!d.isMemberOf(g,"KedamaFloatArray"))return d.primitiveFail(),null;e?c?(c=b.words,b=a.words,e=g.words):(c=b.words,b=a.wordsAsFloat32Array(),e=g.wordsAsFloat32Array()):(c?(c=b.wordsAsFloat32Array(),
b=a.words):(c=b.wordsAsFloat32Array(),b=a.wordsAsFloat32Array()),e=g.wordsAsFloat32Array());for(a=0;a<=f-1;a++)e[a]=c[a]-b[a];d.pop(4);d.push(g)}})});module("users.bert.SqueakJS.plugins.Klatt").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b,c){var d,e;d=-3.141592653589793/C*c;e=Math.exp(d);c=0-e*e;d=6.283185307179586/C*b;d=e*Math.cos(d)*2;b=1/(1-d-c);E[5*a-5]=b;E[5*a-4]=(0-d)*b;E[5*a-3]=(0-c)*b}function b(a,b){var c,d;c=E[5*a-5]*b+E[5*a-4]*(d=E[5*a-2])+E[5*a-3]*E[5*a-1];E[5*a-1]=d;E[5*a-2]=b;return c}function c(a){l.success(l.isWords(a));
return l.failed()?0:a.wordsAsFloat32Array()}function e(a){return 32.767*Math.pow(2,(a-87)/6)}function g(){return D=1309*D+13849&65535}function k(a,b,c,d,e){return Math.exp(a*b)*((e*(a*a+1)+a)*d-c)+1}function f(a,b,c){var d,e;d=-3.141592653589793/C*c;e=Math.exp(d);c=0-e*e;d=6.283185307179586/C*b;b=e*Math.cos(d)*2;E[5*a-5]=1-b-c;E[5*a-4]=b;E[5*a-3]=c}function d(a,b,c,d){f(a,b,c);E[5*a-5]*=d}function p(a,b){var c,d;c=E[5*a-5]*b+E[5*a-4]*(d=E[5*a-2])+E[5*a-3]*E[5*a-1];E[5*a-1]=d;return E[5*a-2]=c}var A=
0,x=0,q=0,m=0,h=0,t=null,B=0,l=null,u=0,y=0,G=0,w=0,L=0,I=0,E=null,K=0,H=0,C=0,D=0,v=0,N=0,Q=0,M=0;Squeak.registerExternalModule("Klatt",{setInterpreter:function(a){l=a;a=1==l.majorVersion();return!1===a?!1:a=11<=l.minorVersion()},primitiveSynthesizeFrameIntoStartingAt:function(){var O,V,X,P,ta;O=c(l.stackValue(2));V=X=l.stackValue(1);l.success(l.isWords(V));V=l.failed()?0:V.wordsAsInt16Array();ta=l.stackIntegerValue(0);if(l.failed())return null;P=l.stackObjectValue(3);var U;l.success(22===n(P));
l.failed()?U=!1:(U=l.fetchPointerofObject(0,P),E=c(U),I=l.fetchFloatofObject(2,P),v=l.fetchIntegerofObject(3,P),w=l.fetchIntegerofObject(4,P),G=l.fetchIntegerofObject(5,P),y=l.fetchIntegerofObject(6,P),A=l.fetchFloatofObject(7,P),x=l.fetchFloatofObject(8,P),Q=l.fetchFloatofObject(9,P),M=l.fetchFloatofObject(10,P),q=l.fetchFloatofObject(11,P),m=l.fetchFloatofObject(12,P),B=l.fetchFloatofObject(13,P),N=l.fetchFloatofObject(14,P),u=l.fetchFloatofObject(15,P),L=l.fetchIntegerofObject(16,P),K=l.fetchIntegerofObject(17,
P),D=l.fetchIntegerofObject(18,P),h=l.fetchIntegerofObject(19,P),H=l.fetchIntegerofObject(20,P),C=l.fetchIntegerofObject(21,P),U=!1===l.failed());if(!U)return null;l.success(2*n(X)>=H);if(l.failed())return null;var Z,T,xa,la,wa,La,ea,Ma,Wa;t=O;T=.6*e(t[45]);La=.6*e(t[50]);O=.4*e(t[46]);U=.15*e(t[47]);Ma=.06*e(t[48]);Z=.04*e(t[49]);X=.15*e(t[34]);ea=.06*e(t[35]);Wa=.04*e(t[36]);wa=.022*e(t[37]);xa=.03*e(t[38]);8<=h&&(16E3<=C?f(19,7500,600):h=6);7<=h&&(16E3<=C?f(18,6500,500):h=6);6<=h&&f(17,t[24],t[25]);
5<=h&&f(16,t[22],t[23]);f(15,t[20],t[21]);f(14,t[18],t[19]);f(13,t[16],t[17]);f(12,t[12],t[13]);f(20,t[26],t[27]);f(22,t[30],t[31]);a(21,t[28],t[29]);a(23,t[32],t[33]);d(1,t[26],t[27],T);d(2,t[30],t[31],La);d(3,t[12],t[13],O);d(4,t[16],t[17],U);d(5,t[18],t[19],Ma);d(6,t[20],t[21],Z);d(7,t[16],t[40],X);d(8,t[18],t[41],ea);d(9,t[20],t[42],Wa);d(10,t[22],t[43],wa);d(11,t[24],t[44],xa);0<I?(Wa=e(t[5]-7),ea=e(t[5]),Ma=.1*e(t[11])):Wa=ea=Ma=0;U=.25*e(t[10]);O=.05*e(t[9]);X=.05*e(t[39]);Z=t[51]-3;0>=Z&&
(Z=57);Z=e(Z);d(24,0,C,Z);wa=ta;for(ta=H+ta-1;wa<=ta;){T=(g()-32768)/4;u=T+=.75*u;w>y&&(T*=.5);xa=U*T;if(0===v)La=0;else{w<G?(La=A*Q+x*M,M=Q):La=q*Q-m;Q=La;if(w>=v)if(w=0,0<t[0]){I=t[0];la=K/C;I+=2*t[1]*t[0]/100*(Math.sin(79.79645340118074*la)+Math.sin(44.61061568097506*la)+Math.sin(29.530970943744055*la));I+=(g()-32767)*t[2]/32768*t[0];I=0===(L-2*(Math.floor(L/2)|0)|0)?I+t[4]*t[0]*(1-t[6]):I-t[4]*t[0]*(1-t[6]);0>I&&(I=0);y=v=C/I|0;0<t[5]&&(y>>=1);G=v*t[6]|0;var ra=t[7],sa,Sa,W,lb;la=v*t[6]|0;lb=
la/v;0>=ra?sa=1:(Sa=(1-lb)/ra,sa=1-Sa/(Math.exp(Sa)-1));W=Sa=3.141592653589793*(t[8]+1);var gb=Math.cos(Sa),jb=Math.sin(Sa);lb=ra/lb*Sa*sa;var za,va,eb;if(0<k(0,W,gb,jb,lb))for(sa=0,va=1,za=k(va,W,gb,jb,lb);0<za;)sa=va,va*=2,za=k(va,W,gb,jb,lb);else for(sa=-1,va=0,za=k(sa,W,gb,jb,lb);0>za;)va=sa,sa*=2,za=k(sa,W,gb,jb,lb);for(;1E-4<va-sa;)eb=(va+sa)/2,za=k(eb,W,gb,jb,lb),0<za?sa=eb:va=eb;W=(va+sa)/2;Sa/=la;W=Math.exp(W*Sa);A=2*Math.cos(Sa)*W;x=0-W*W;M=0;Q=W*Math.sin(Sa);ra=Math.exp(-1/(ra*v));la=Math.pow(ra,
v-la);q=ra;m=(1-ra)*la/(1-la);ra=0;Sa=Q;W=M;for(la=1;la<=G;la++)ra=A*Sa+x*W,W=Sa,Sa=ra;0!==ra&&(Q=Q/ra*1E4);Q+=(g()-32767)*t[3]/32768*Q;0<Q&&(Q=0);0!==(L-2*(Math.floor(L/2)|0)|0)&&(Q*=1-t[4],0<Q&&(Q=0));la=L+1;L=la-65535*(Math.floor(la/65535)|0)|0}else y=v=1;++w}N=La;w<G&&(La+=Ma*(g()-32768)/4);la=Wa*La;La*=ea;T*=O;la+=T;La+=T;0<h?(T=b(21,la),T=p(20,T),T=b(23,T),T=p(22,T),8<=h&&(T=p(19,T)),7<=h&&(T=p(18,T)),6<=h&&(T=p(17,T)),5<=h&&(T=p(16,T)),4<=h&&(T=p(15,T)),3<=h&&(T=p(14,T)),2<=h&&(T=p(13,T)),
1<=h&&(T=p(12,T)),la=T):la=0;T=La;T=p(3,T)+p(4,T)+p(5,T)+p(6,T)+p(1,T)+p(2,T);la+=T;T=xa+La-B;B=La;xa=T;la=p(7,xa)-p(8,xa)+p(9,xa)-p(10,xa)+p(11,xa)-la;la=X*T-la;la=p(24,la);xa=la*Z|0;-32768>xa&&(xa=-32768);32767<xa&&(xa=32767);V[wa-1]=xa;++wa;++K}l.pushRemappableOop(P);l.pushRemappableOop(l.floatObjectOf(I));l.pushRemappableOop(l.floatObjectOf(A));l.pushRemappableOop(l.floatObjectOf(x));l.pushRemappableOop(l.floatObjectOf(Q));l.pushRemappableOop(l.floatObjectOf(M));l.pushRemappableOop(l.floatObjectOf(q));
l.pushRemappableOop(l.floatObjectOf(m));l.pushRemappableOop(l.floatObjectOf(B));l.pushRemappableOop(l.floatObjectOf(N));Ma=l.floatObjectOf(u);Z=l.popRemappableOop();U=l.popRemappableOop();X=l.popRemappableOop();O=l.popRemappableOop();ta=l.popRemappableOop();wa=l.popRemappableOop();P=l.popRemappableOop();V=l.popRemappableOop();Wa=l.popRemappableOop();ea=l.popRemappableOop();l.failed()?V=!1:(l.storePointerofObjectwithValue(2,ea,Wa),l.storeIntegerofObjectwithValue(3,ea,v),l.storeIntegerofObjectwithValue(4,
ea,w),l.storeIntegerofObjectwithValue(5,ea,G),l.storeIntegerofObjectwithValue(6,ea,y),l.storePointerofObjectwithValue(7,ea,V),l.storePointerofObjectwithValue(8,ea,P),l.storePointerofObjectwithValue(9,ea,wa),l.storePointerofObjectwithValue(10,ea,ta),l.storePointerofObjectwithValue(11,ea,O),l.storePointerofObjectwithValue(12,ea,X),l.storePointerofObjectwithValue(13,ea,U),l.storePointerofObjectwithValue(14,ea,Z),l.storePointerofObjectwithValue(15,ea,Ma),l.storeIntegerofObjectwithValue(16,ea,L),l.storeIntegerofObjectwithValue(17,
ea,K),l.storeIntegerofObjectwithValue(18,ea,D),V=!1===l.failed());if(!V)return null;l.pop(3)},getModuleName:function(){return"Klatt 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.LargeIntegers").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?v.classSmallInteger():a.sqClass}function a(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function b(a,b){return a-(Math.floor(a/b)|0)*b|0}function c(a,b){return 31<b?0:a>>>b}function e(d,e,f){var g,m,h;if(1>e||1>f)return v.primitiveFail();h=Math.min(f,p(d.bytes,a(d)));if(e>h)return!1;m=(e-1>>3)+1;f=(h-1>>3)+1;g=b(e-1,8);e=7-b(h-1,8);if(m===f)return f=
(31<g?0:255<<g)&c(255,e),d=I(d,m),0!==(d&f);if(0!==c(I(d,m),g))return!0;for(m+=1;m<=f-1;m++)if(0!==I(d,m))return!0;d=I(d,f);return 0!==((31<e?0:d<<e)&255)?!0:!1}function g(b,c){var e,f;f=v.instantiateClassindexableSize(n(b),c);e=a(b);d(b.bytes,f.bytes,e<c?e:c);return f}function k(a,b){var d;if("number"===typeof a){d=0>a?v.classLargeNegativeInteger():v.classLargePositiveInteger();d=v.instantiateClassindexableSize(d,b);var c,e,f;c=d.bytes;e=1;for(f=A(a);e<=f;e++)c[e-1]=x(a,e)}else d=g(a,b);return d}
function f(a,b,d){var c,e;for(e=d-1;0<=e;){if((c=b[e])!==(d=a[e]))return c<d?1:-1;--e}return 0}function d(a,b,d){var c;--d;for(c=0;c<=d;c++)b[c]=a[c];return 0}function p(a,b){var d,c;for(c=b;0===(d=a[c-1]);)if(0===--c)return 0;return m(d)+8*(c-1)}function A(a){return 256>a&&-256<a?1:65536>a&&-65536<a?2:16777216>a&&-16777216<a?3:4}function x(a,b){1>b&&v.primitiveFail();return 4<b?0:0>a?c(0-a,8*(b-1))&255:c(a,8*(b-1))&255}function q(a,b,d,c,e){d=d-b+1;for(var f=0;f<d;f++)a[f+b]=c[f+e];return 0}function m(a){var b;
b=0;65536>a||(a>>>=16,b+=16);256>a||(a>>>=8,b+=8);16>a||(a>>>=4,b+=4);4>a||(a>>>=2,b+=2);2>a||(a>>>=1,++b);return b+a}function h(a){var b,d,c,e;d=0>a?v.classLargeNegativeInteger():v.classLargePositiveInteger();b=A(a);d=v.instantiateClassindexableSize(d,b);c=d.bytes;for(e=1;e<=b;e++)c[e-1]=x(a,e);return d}function t(d,e){var f,g,m;g=a(d);if(0===(f=p(d.bytes,g)))return 0;f=f+e+7>>3;m=v.instantiateClassindexableSize(n(d),f);var h=d.bytes,l=m.bytes,k,w,t,x,u,y;k=e>>3;x=b(e,8);y=k-1;for(t=0;t<=y;t++)l[t]=
0;if(0===x)q(l,k,f-1,h,0);else{u=8-x;w=0;y=g-1;for(t=0;t<=y;t++)g=h[t],l[t+k]=(w|(31<x?0:g<<x))&255,w=c(g,u);0!==w&&(l[f-1]=w)}return m}function B(a,d,e){var f,g;e=p(a.bytes,e);f=e+7>>3;e-=d;if(0>=e)return v.instantiateClassindexableSize(n(a),0);g=e+7>>3;e=v.instantiateClassindexableSize(n(a),g);a=a.bytes;var m=e.bytes,h,l,k,w,t;h=d>>3;k=b(d,8);if(0===k)q(m,0,g-1,a,h);else{w=8-k;d=c(a[h],k);h+=1;t=f-1;for(f=h;f<=t;f++)l=a[f],m[f-h]=(d|(31<w?0:l<<w))&255,d=c(l,k);0!==d&&(m[g-1]=d)}return e}function l(b,
c){var e,f,g,m,h,l;e=a(b);h=a(c);m=n(b);e<=h?(g=b,f=e,l=c):(g=c,f=h,l=b,h=e);e=v.instantiateClassindexableSize(m,h);g=g.bytes;l=l.bytes;var k=e.bytes,q,w,t;t=0;w=f-1;for(q=0;q<=w;q++)t=(t>>>8)+g[q]+l[q],k[q]=t&255;w=h-1;for(q=f;q<=w;q++)t=(t>>>8)+l[q],k[q]=t&255;g=t>>>8;0<g&&(m=v.instantiateClassindexableSize(m,h+1),d(e.bytes,m.bytes,h),e=m,e.bytes[h]=g);return e}function u(b,d,c){var e,f,g,m;if("number"===typeof b){if(0>b)return v.primitiveFail();b=h(b)}else if(n(b)===v.classLargeNegativeInteger())return v.primitiveFail();
if("number"===typeof d){if(0>d)return v.primitiveFail();f=h(d)}else{if(n(d)===v.classLargeNegativeInteger())return v.primitiveFail();f=d}g=a(b);m=a(f);g<m?(e=g,d=b,g=m):(e=m,d=f,f=b);b=v.instantiateClassindexableSize(v.classLargePositiveInteger(),g);d=d.bytes;f=f.bytes;m=b.bytes;var l;l=e-1;if(0===c){for(c=0;c<=l;c++)m[c]=d[c]&f[c];l=g-1;for(c=e;c<=l;c++)m[c]=0}else if(1===c){for(c=0;c<=l;c++)m[c]=d[c]|f[c];l=g-1;for(c=e;c<=l;c++)m[c]=f[c]}else if(2===c){for(c=0;c<=l;c++)m[c]=d[c]^f[c];l=g-1;for(c=
e;c<=l;c++)m[c]=f[c]}else v.primitiveFail();return v.failed()?0:D(b)}function y(b,c){var d,e;e=a(b);d=a(c);return d!==e?d>e?-1:1:f(b.bytes,c.bytes,e)}function G(c,d,e){var f,g,h;g=a(c);f=a(d);e=e?v.classLargeNegativeInteger():v.classLargePositiveInteger();h=g-f+1;if(0>=h)return f=v.instantiateClassindexableSize(v.classArray(),2),v.stObjectatput(f,1,0),v.stObjectatput(f,2,c),f;f=8-m(d.bytes[f-1]);d=t(d,f);d=k(d,w(d)+1);c=t(c,f);w(c)===g&&(c=k(c,g+1));g=v.instantiateClassindexableSize(e,h);e=d.bytes;
h=w(d);var l=c.bytes,q=w(c),p=g.bytes,n=w(g),x,u,y,C,A,D,G,H,E,I,L;I=h-1;L=e[I-1];y=1===I?0:e[I-2];for(H=1;H<=n;H++){E=q+1-H;if(l[E-1]===L)u=255;else for(u=l[E-1],u=(u<<8)+l[E-2],G=b(u,L),u=Math.floor(u/L)|0,C=u*y,A=C>>>8,C&=255,D=3>E?0:l[E-3];;){G<A||G===A&&D<C?(--u,C<y?(--A,C=C+256-y):C-=y,x=A>=L):x=!1;if(!x)break;A-=L}G=E-I;x=0;for(D=1;D<=h;D++)A=e[D-1]*(u>>>8),C=e[D-1]*(u&255),x=l[G-1]-x-(C&255),l[G-1]=x&255,x>>=8,x=A+(C>>>8)-x,++G;if(0<x)for(--u,G=E-I,x=0,D=1;D<=h;D++)x=(x>>>8)+l[G-1]+e[D-1],
l[G-1]=x&255,++G;p[n-H]=u}c=B(c,f,w(d)-1);f=v.instantiateClassindexableSize(v.classArray(),2);v.stObjectatput(f,1,g);v.stObjectatput(f,2,c);return f}function w(b){return"number"===typeof b?A(b):a(b)}function L(b,c,d){var e,f,g,m;g=a(b);m=a(c);g<=m?(f=b,e=g,b=c,g=m):(f=c,e=m);d=d?v.classLargeNegativeInteger():v.classLargePositiveInteger();d=v.instantiateClassindexableSize(d,g+e);f=f.bytes;b=b.bytes;m=d.bytes;var h,l,k,q,w;if(1!==e||0!==f[0])if(1!==g||0!==b[0])for(--e,q=g-1,k=0;k<=e;k++)if(0!==(h=f[k])){w=
k;for(c=l=0;c<=q;c++)g=b[c],g=g*h+l+m[w],l=g>>>8,m[w]=g&255,++w;m[w]=l}return H(d)}function I(b,c){return c>a(b)?0:b.bytes[c-1]}function E(b,c){var d,e,f,g,m,h;h=n(b)===v.classLargeNegativeInteger();f=a(b);d=a(c);if(f===d){for(;1<f&&I(b,f)===I(c,f);)--f;d=f}f<d||f===d&&I(b,f)<I(c,f)?(e=c,m=d,g=b,d=f,h=!1===h):(e=b,m=f,g=c);f=m;f=v.instantiateClassindexableSize(h?v.classLargeNegativeInteger():v.classLargePositiveInteger(),f);g=g.bytes;e=e.bytes;var l=f.bytes,k,q;for(k=q=0;k<=d-1;k++)q=q+e[k]-g[k],
l[k]=q&255,q>>=8;for(k=d;k<=m-1;k++)q+=e[k],l[k]=q&255,q>>=8;return h?C(f):D(f)}function K(a){var b;if("number"===typeof a)return!0;b=w(a);if(0===b||0===a.bytes[b-1])return!1;if(4<b)return!0;if(4>b)return!1;if(n(a)===v.classLargePositiveInteger())return a.bytes[3]>x(1073741823,4);if(!(a.bytes[3]<x(-1073741824,4)))for(b=1;4>=b;b++)if(a.bytes[b-1]!==x(-1073741824,b))return!0;return!1}function H(a){return n(a)===v.classLargePositiveInteger()?D(a):C(a)}function C(a){var b,c,d;for(c=d=w(a);0!==c&&0===
a.bytes[c-1];)--c;if(0===c)return 0;if(4>=c){if(4>c||I(a,4)<x(-1073741824,4)){d=0;for(b=c;1<=b;b+=-1)d=256*d-a.bytes[b-1];return d}for(b=1;4>=b;b++)if(I(a,b)!==x(-1073741824,b))return c<d?g(a,c):a;return-1073741824}return c<d?g(a,c):a}function D(a){var b,c;for(b=c=w(a);0!==b&&0===a.bytes[b-1];)--b;if(0===b)return 0;if(4>=b&&I(a,4)<=x(1073741823,4)){for(c=0;1<=b;b+=-1)c=256*c+a.bytes[b-1];return c}return b<c?g(a,b):a}var v=null;Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:function(){var a,
b;v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;a=l(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},primDigitBitShiftMagnitude:function(){var b,c;c=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?h(b):b;c=0<=c?t(b,c):H(B(b,0-c,a(b)));
if(v.failed())return null;v.popthenPush(2,c);return null},primGetModuleName:function(){var a,b,c,d;b=strlen("LargeIntegers v1.5 (e)");d=v.instantiateClassindexableSize(v.classString(),b);a=d.bytes;for(c=0;c<=b-1;c++)a[c]="LargeIntegers v1.5 (e)"[c];if(v.failed())return null;v.popthenPush(1,d);return null},primDigitBitLogicWithOp:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.stackIntegerValue(0);
if(v.failed())return null;a=u(a,b,c);if(v.failed())return null;v.popthenPush(4,a);return null},primCheckIfCModuleExists:function(){var a;a=v.trueObject();if(v.failed())return null;v.popthenPush(1,a);return null},primDigitCompare:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a="number"===typeof a?"number"===typeof b?a>b?1:a<b?-1:0:-1:"number"===typeof b?1:y(a,b);if(v.failed())return null;
v.popthenPush(2,a);return null},primDigitMultiplyNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.booleanValueOf(v.stackValue(0));v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;c=L(a,b,c);if(v.failed())return null;v.popthenPush(3,c);return null},primDigitBitShift:function(){var b,c;c=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));
b=v.stackValue(1);if(v.failed())return null;b="number"===typeof b?h(b):b;c=0<=c?t(b,c):H(B(b,0-c,a(b)));if(v.failed())return null;v.popthenPush(2,c);return null},primNormalizePositive:function(){var a;v.success(v.stackValue(0).sqClass===v.classLargePositiveInteger());a=v.stackValue(0);if(v.failed())return null;a=D(a);if(v.failed())return null;v.popthenPush(1,a);return null},primDigitSubtractWith:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));
b=v.stackValue(0);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;a=E(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},_primDigitBitShift:function(){var b,c;v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.stackIntegerValue(0);if(v.failed())return null;b="number"===typeof b?h(b):b;c=0<=c?t(b,c):H(B(b,0-c,a(b)));if(v.failed())return null;v.popthenPush(3,c);return null},primDigitMultiplyWithNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(2)));
a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.booleanValueOf(v.stackValue(0));if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;c=L(a,b,c);if(v.failed())return null;v.popthenPush(4,c);return null},primDigitSubtract:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===
typeof b?h(b):b;a=E(a,b);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitDivNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);c=v.booleanValueOf(v.stackValue(0));v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);if(v.failed())return null;if(!K(a)||!K(b))return v.primitiveFail(),null;a="number"===typeof a?h(a):a;if("number"===typeof b){if(0===b)return v.primitiveFail(),null;b=h(b)}c=G(a,b,c);if(v.failed())return null;v.popthenPush(3,
c);return null},primNormalizeNegative:function(){var a;v.success(v.stackValue(0).sqClass===v.classLargeNegativeInteger());a=v.stackValue(0);if(v.failed())return null;a=C(a);if(v.failed())return null;v.popthenPush(1,a);return null},primDigitBitOr:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a=u(a,b,1);if(v.failed())return null;v.popthenPush(2,a);return null},primMontgomeryTimesModulo:function(){var b,
c,d,e,g,m;v.success(v.isKindOfInteger(v.stackValue(2)));e=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));g=v.stackValue(1);m=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(3)));d=v.stackValue(3);if(v.failed())return null;b="number"===typeof d?h(d):d;c="number"===typeof e?h(e):e;var l="number"===typeof g?h(g):g,k;d=a(b);k=a(c);e=a(l);if(d<=e)if(k<=e)if(0<=m&&255>=m){g=v.instantiateClassindexableSize(v.classLargePositiveInteger(),e);b=b.bytes;c=c.bytes;var l=l.bytes,
q=g.bytes,w,t,p,x,n,u,y,C;u=d-1;n=k-1;x=e-1;for(t=p=0;t<=u;t++){C=q[0]+b[t]*c[0];y=C*m&255;C+=y*l[0];for(w=1;w<=n;w++)C=(C>>>8)+q[w]+b[t]*c[w]+y*l[w],q[w-1]=C&255;for(w=k;w<=x;w++)C=(C>>>8)+q[w]+y*l[w],q[w-1]=C&255;C=(C>>>8)+p;q[x]=C&255;p=C>>>8}for(t=d;t<=x;t++){C=q[0];y=C*m&255;C+=y*l[0];for(w=1;w<=x;w++)C=(C>>>8)+q[w]+y*l[w],q[w-1]=C&255;C=(C>>>8)+p;q[x]=C&255;p=C>>>8}if(0!==p||1!==f(l,q,e))for(t=C=0;t<=x;t++)C=C+q[t]-l[t],q[t]=C&255,C>>=8;m=D(g)}else m=v.primitiveFail();else m=v.primitiveFail();
else m=v.primitiveFail();if(v.failed())return null;v.popthenPush(4,m);return null},primDigitBitAnd:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a=u(a,b,0);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitDivWithNegative:function(){var a,b,c;v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);v.success(v.isKindOfInteger(v.stackValue(1)));b=v.stackValue(1);
c=v.booleanValueOf(v.stackValue(0));if(v.failed())return null;a="number"===typeof a?h(a):a;if("number"===typeof b){if(0===b)return v.primitiveFail(),null;b=h(b)}c=G(a,b,c);if(v.failed())return null;v.popthenPush(4,c);return null},setInterpreter:function(a){v=a;a=1==v.majorVersion();return!1===a?!1:a=11<=v.minorVersion()},primNormalize:function(){var a;v.success(v.isKindOfInteger(v.stackValue(0)));a=v.stackValue(0);if(v.failed())return null;if("number"===typeof a){if(v.failed())return null;v.popthenPush(2,
a);return null}a=H(a);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitBitXor:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a=u(a,b,2);if(v.failed())return null;v.popthenPush(2,a);return null},primDigitCompareWith:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);
if(v.failed())return null;a="number"===typeof a?"number"===typeof b?a>b?1:a<b?-1:0:-1:"number"===typeof b?1:y(a,b);if(v.failed())return null;v.popthenPush(3,a);return null},primDigitAdd:function(){var a,b;v.success(v.isKindOfInteger(v.stackValue(0)));b=v.stackValue(0);v.success(v.isKindOfInteger(v.stackValue(1)));a=v.stackValue(1);if(v.failed())return null;a="number"===typeof a?h(a):a;b="number"===typeof b?h(b):b;a=l(a,b);if(v.failed())return null;v.popthenPush(2,a);return null},getModuleName:function(){return"LargeIntegers v1.5 (e)"},
primAsLargeInteger:function(){var a;v.success(v.isKindOfInteger(v.stackValue(0)));a=v.stackValue(0);if(v.failed())return null;"number"===typeof a&&(a=h(a));if(v.failed())return null;v.popthenPush(2,a);return null},primAnyBitFromTo:function(){var a,b,c;b=v.stackIntegerValue(1);c=v.stackIntegerValue(0);v.success(v.isKindOfInteger(v.stackValue(2)));a=v.stackValue(2);if(v.failed())return null;a="number"===typeof a?h(a):a;b=e(a,b,c)?v.trueObject():v.falseObject();if(v.failed())return null;v.popthenPush(3,
b);return null}})});module("users.bert.SqueakJS.plugins.Matrix2x3Plugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?d.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(b){return d.failed()?null:d.isWords(b)&&6===a(b)?b.wordsAsFloat32Array():(d.primitiveFail(),null)}function c(a){var b,c;if(d.failed())return null;if(n(a)!==d.classPoint())return d.primitiveFail();c=d.fetchPointerofObject(0,
a);b="number"===typeof c;if(!b&&!c.isFloat)return d.primitiveFail();p=b?c:d.floatValueOf(c);c=d.fetchPointerofObject(1,a);b="number"===typeof c;if(!b&&!c.isFloat)return d.primitiveFail();A=b?c:d.floatValueOf(c)}function e(a){var b,c,e,f;e=p-a[2];f=A-a[5];b=a[0]*a[4]-a[1]*a[3];if(0===b)return d.primitiveFail();b=1/b;c=e*a[4]-a[1]*f;a=a[0]*f-e*a[3];x=c*b;q=a*b}function g(a){x=p*a[0]+A*a[1]+a[2];q=p*a[3]+A*a[4]+a[5]}function k(a){x+=.5;q+=.5;if(!(-1073741824<=x&&1073741823>=x&&-1073741824<=q&&1073741823>=
x))return d.primitiveFail();d.popthenPush(a,d.makePointwithxValueyValue(x|0,q|0))}function f(a,b,c,e,f){b+=.5;if(!(-1073741824<=b&&1073741823>=x))return d.primitiveFail();e+=.5;if(!(-1073741824<=e&&1073741823>=x))return d.primitiveFail();c+=.5;if(!(-1073741824<=c&&1073741823>=x))return d.primitiveFail();f+=.5;if(!(-1073741824<=f&&1073741823>=x))return d.primitiveFail();d.pushRemappableOop(a);a=d.makePointwithxValueyValue(b|0,c|0);d.pushRemappableOop(a);f=d.makePointwithxValueyValue(e|0,f|0);a=d.popRemappableOop();
e=d.popRemappableOop();d.storePointerofObjectwithValue(0,e,a);d.storePointerofObjectwithValue(1,e,f);return e}var d=null,p=0,A=0,x=0,q=0;Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:function(){var a;c(d.stackObjectValue(0));a=b(d.stackObjectValue(1));if(d.failed())return null;e(a);d.failed()||k(2)},primitiveInvertRectInto:function(){var g,h,k,B,l,u,y,G,w,L;k=d.stackObjectValue(0);g=d.stackObjectValue(1);B=b(d.stackObjectValue(2));if(d.failed())return null;if(n(g)!==n(k)||
!d.isPointers(g)||2!==a(g))return d.primitiveFail();c(d.fetchPointerofObject(0,g));if(d.failed())return null;w=p;L=A;e(B);y=l=x;G=u=q;c(d.fetchPointerofObject(1,g));if(d.failed())return null;g=p;h=A;e(B);y=Math.min(y,x);l=Math.max(l,x);G=Math.min(G,q);u=Math.max(u,q);p=g;A=L;e(B);y=Math.min(y,x);l=Math.max(l,x);G=Math.min(G,q);u=Math.max(u,q);p=w;A=h;e(B);y=Math.min(y,x);l=Math.max(l,x);G=Math.min(G,q);u=Math.max(u,q);d.failed()||(k=f(k,y,G,l,u));d.failed()||d.popthenPush(3,k)},primitiveIsIdentity:function(){var a;
a=b(d.stackObjectValue(0));if(d.failed())return null;d.pop(1);d.pushBool(1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&1===a[4]&&0===a[5])},primitiveComposeMatrix:function(){var a,c,e,f;e=b(f=d.stackObjectValue(0));c=b(d.stackObjectValue(1));a=b(d.stackObjectValue(2));if(d.failed())return null;var g,k,q,p,w;g=a[0]*c[0]+a[1]*c[3];k=a[0]*c[1]+a[1]*c[4];q=a[0]*c[2]+a[1]*c[5]+a[2];p=a[3]*c[0]+a[4]*c[3];w=a[3]*c[1]+a[4]*c[4];a=a[3]*c[2]+a[4]*c[5]+a[5];e[0]=g;e[1]=k;e[2]=q;e[3]=p;e[4]=w;e[5]=a;d.popthenPush(3,
f)},setInterpreter:function(a){d=a;a=1==d.majorVersion();return!1===a?!1:a=11<=d.minorVersion()},primitiveTransformRectInto:function(){var e,h,k,B,l,u,y,G,w,L;k=d.stackObjectValue(0);e=d.stackObjectValue(1);B=b(d.stackObjectValue(2));if(d.failed())return null;if(n(e)!==n(k)||!d.isPointers(e)||2!==a(e))return d.primitiveFail();c(d.fetchPointerofObject(0,e));if(d.failed())return null;w=p;L=A;g(B);y=l=x;G=u=q;c(d.fetchPointerofObject(1,e));if(d.failed())return null;e=p;h=A;g(B);y=Math.min(y,x);l=Math.max(l,
x);G=Math.min(G,q);u=Math.max(u,q);p=e;A=L;g(B);y=Math.min(y,x);l=Math.max(l,x);G=Math.min(G,q);u=Math.max(u,q);p=w;A=h;g(B);y=Math.min(y,x);l=Math.max(l,x);G=Math.min(G,q);u=Math.max(u,q);k=f(k,y,G,l,u);d.failed()||d.popthenPush(3,k)},primitiveIsPureTranslation:function(){var a;a=b(d.stackObjectValue(0));if(d.failed())return null;d.pop(1);d.pushBool(1===a[0]&&0===a[1]&&0===a[3]&&1===a[4])},getModuleName:function(){return"Matrix2x3Plugin 3 November 2014 (e)"},primitiveTransformPoint:function(){var a;
c(d.stackObjectValue(0));a=b(d.stackObjectValue(1));if(d.failed())return null;g(a);k(2)}})});module("users.bert.SqueakJS.plugins.MiscPrimitivePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,b,g){var k;for(k=0;3>=k;k++){var f=8*(3-k);b[g+k-1]=(31<f?0:a>>>f)&255}return g+4}function a(a,b,g){if(223>=a)return b[g-1]=a,g+1;if(7935>=a)return b[g-1]=(a>>8)+224,b[g]=a-256*(Math.floor(a/256)|0)|0,g+2;b[g-1]=255;return n(a,b,g+1)}var b=null;Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:function(){var a,e,g,k,f;b.stackValue(2);a=b.stackBytes(1);
e=b.stackUint16Array(0);if(b.failed())return null;k=a.length;for(g=1;g<=k;g++)f=a[g-1],e[g-1]=127<f?f-256<<8:f<<8;if(b.failed())return null;b.pop(2)},primitiveCompareString:function(){var a,e,g,k,f,d,p,n;b.stackValue(3);a=b.stackBytes(2);e=b.stackBytes(1);g=b.stackBytes(0);if(b.failed())return null;p=a.length;n=e.length;for(d=1;d<=Math.min(p,n);d++)if(k=g[a[d-1]],f=g[e[d-1]],k!==f){if(k<f){if(b.failed())return null;b.popthenPush(4,1)}else{if(b.failed())return null;b.popthenPush(4,3)}return null}if(p===
n){if(b.failed())return null;b.popthenPush(4,2);return null}if(p<n){if(b.failed())return null;b.popthenPush(4,1)}else{if(b.failed())return null;b.popthenPush(4,3)}return null},primitiveTranslateStringWithTable:function(){var a,e,g,k;b.stackValue(4);a=b.stackBytes(3);e=b.stackIntegerValue(2);g=b.stackIntegerValue(1);k=b.stackBytes(0);if(b.failed())return null;for(;e<=g;e++)a[e-1]=k[a[e-1]];if(b.failed())return null;b.pop(4)},primitiveStringHash:function(){var a,e,g,k,f;b.stackValue(2);a=b.stackBytes(1);
e=b.stackIntegerValue(0);if(b.failed())return null;g=a.length;e&=268435455;for(f=1;f<=g;f++)e+=a[f-1],k=e&16383,e=9741*k+16384*(9741*(e>>>14)+101*k&16383)&268435455;if(b.failed())return null;b.popthenPush(3,e);return null},primitiveCompressToByteArray:function(){var c,e,g,k,f,d,p,A,x;b.stackValue(2);c=b.stackInt32Array(1);e=b.stackBytes(0);if(b.failed())return null;A=c.length;k=a(A,e,1);for(d=1;d<=A;){x=c[d-1];p=x&255;g=(x>>>8&255)===p&&(x>>>16&255)===p&&(x>>>24&255)===p;for(f=d;f<A&&x===c[f];)++f;
if(f>d)g?(k=a(4*(f-d+1)+1,e,k),e[k-1]=p,++k):(k=a(4*(f-d+1)+2,e,k),k=n(x,e,k)),d=f+1;else if(g)k=a(5,e,k),e[k-1]=p,++k,++d;else{for(;f<A&&c[f-1]!==c[f];)++f;f===A&&++f;k=a(4*(f-d)+3,e,k);for(g=d;g<=f-1;g++)k=n(c[g-1],e,k);d=f}}if(b.failed())return null;b.popthenPush(3,k-1);return null},primitiveFindSubstring:function(){var a,e,g,k,f;b.stackValue(4);a=b.stackBytes(3);e=b.stackBytes(2);g=b.stackIntegerValue(1);k=b.stackBytes(0);if(b.failed())return null;if(0===a.length){if(b.failed())return null;b.popthenPush(5,
0);return null}for(f=g;f<=e.length-a.length+1;f++)for(g=1;k[e[f+g-1-1]]===k[a[g-1]];){if(g===a.length){if(b.failed())return null;b.popthenPush(5,f);return null}++g}if(b.failed())return null;b.popthenPush(5,0);return null},primitiveIndexOfAsciiInString:function(){var a,e,g,k;b.stackValue(3);a=b.stackIntegerValue(2);e=b.stackBytes(1);g=b.stackIntegerValue(0);if(b.failed())return null;for(k=e.length;g<=k;g++)if(e[g-1]===a){if(b.failed())return null;b.popthenPush(4,g);return null}if(b.failed())return null;
b.popthenPush(4,0);return null},setInterpreter:function(a){b=a;a=1==b.majorVersion();return!1===a?!1:a=11<=b.minorVersion()},primitiveDecompressFromByteArray:function(){var a,e,g,k,f,d,p,n,x,q;b.stackValue(3);a=b.stackInt32Array(2);e=b.stackBytes(1);g=b.stackIntegerValue(0);if(b.failed())return null;d=g;g=e.length;n=1;for(q=a.length+1;d<=g;){k=e[d-1];++d;if(!(223>=k))if(254>=k)k=256*(k-224)+e[d-1],++d;else for(k=0,p=1;4>=p;p++)k=(k<<8)+e[d-1],++d;x=k>>>2;if(n+x>q)return b.primitiveFail(),null;f=k&
3;0===f&&null;if(1===f)for(k=e[d-1],++d,k|=k<<8,k|=k<<16,p=1;p<=x;p++)a[n-1]=k,++n;if(2===f){k=0;for(p=1;4>=p;p++)k=k<<8|e[d-1],++d;for(p=1;p<=x;p++)a[n-1]=k,++n}if(3===f)for(f=1;f<=x;f++){k=0;for(p=1;4>=p;p++)k=k<<8|e[d-1],++d;a[n-1]=k;++n}}if(b.failed())return null;b.pop(3)},getModuleName:function(){return"MiscPrimitivePlugin 3 November 2014 (e)"},primitiveFindFirstInString:function(){var a,e,g,k;b.stackValue(3);a=b.stackBytes(2);e=b.stackBytes(1);g=b.stackIntegerValue(0);if(b.failed())return null;
if(256!==e.length){if(b.failed())return null;b.popthenPush(4,0);return null}for(k=a.length;g<=k&&0===e[a[g-1]];)++g;if(g>k){if(b.failed())return null;b.popthenPush(4,0);return null}if(b.failed())return null;b.popthenPush(4,g);return null}})});module("users.bert.SqueakJS.plugins.ScratchPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a,b){return Math.floor(a/b)|0}function b(b,c){return b-a(b,c)*c|0}function c(c,d,e,f,g){var k,p,l,n;p=a(e,60);k=b(e,60);e=(1E3-f)*g;n=(1E3-a(f*k,60))*g;f=(1E3-a(f*(60-k),60))*g;g=a(1E3*g,3922);e=a(e,3922);n=a(n,3922);f=a(f,3922);0===p&&(l=(g<<16)+(f<<8)+e);1===p&&(l=(n<<16)+(g<<8)+e);2===
p&&(l=(e<<16)+(g<<8)+f);3===p&&(l=(e<<16)+(n<<8)+g);4===p&&(l=(f<<16)+(e<<8)+g);5===p&&(l=(g<<16)+(e<<8)+n);0===l&&(l=1);c[d]=l;return 0}function e(a){p.success(p.isWordsOrBytes(a));return p.failed()?0:a.wordsAsFloat64Array()}function g(a){p.success(p.isWords(a));return p.failed()?0:a.words}function k(b,c,d,e,f){e=f-e;if(0===e)return 0;b=b===f?a(60*(c-d),e):c===f?120+a(60*(d-b),e):240+a(60*(b-c),e);return 0>b?b+360:b}function f(a,b,c){var d;if(0===a)return b;if(0===b)return a;d=1024-c;a=(d*(a>>>16&
255)+c*(b>>>16&255)>>10<<16)+(d*(a>>>8&255)+c*(b>>>8&255)>>10<<8)+(d*(a&255)+c*(b&255)>>10);0===a&&(a=1);return a}function d(a,b,c,d,e){var g,k,l;k=b>>>10;if(-1>k||k>=d)return 0;l=c>>>10;if(-1>l||l>=e)return 0;b&=1023;-1===k&&(b=k=0);k===d-1&&(b=0);c&=1023;-1===l&&(c=l=0);l===e-1&&(c=0);e=l*d+k;g=a[e]&16777215;0<b&&(g=f(g,a[e+1]&16777215,b));if(0===c)return g;e=(l+1)*d+k;d=a[e]&16777215;0<b&&(d=f(d,a[e+1]&16777215,b));return f(g,d,c)}var p=null;Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:function(){var b,
c,d,e,f,g,k,l,u=0,y=0;k=p.stackValue(2);c=p.stackValue(1);d=p.stackIntegerValue(0);p.success(p.isWords(k));p.success(p.isWords(c));b=a(2*n(k),d);e=2*n(c);p.success(e>=b);if(p.failed())return null;k=k.wordsAsInt16Array();c=c.wordsAsInt16Array();for(e=1;e<=b;e++){g=0;for(f=1;f<=d;f++)l=k[u++],0>l&&(l=0-l),l>g&&(g=l);c[y++]=g}p.pop(3);return 0},getModuleName:function(){return"ScratchPlugin 3 November 2014 (e)"},primitiveFisheye:function(){var b,c,e,f,h,k,B,l,u,y,G,w;e=p.stackValue(3);c=p.stackValue(2);
y=p.stackIntegerValue(1);u=p.stackIntegerValue(0);k=g(e);B=g(c);e=n(e);p.success(n(c)===e);if(p.failed())return null;a(e,y);h=a(e,y);c=y>>1;e=h>>1;u/=100;for(G=0;G<=y-1;G++)for(w=0;w<=h-1;w++)f=(G-c)/c,b=(w-e)/e,l=Math.pow(Math.sqrt(f*f+b*b),u),1>=l?(b=Math.atan2(b,f),f=1024*(c+l*Math.cos(b)*c)|0,l=1024*(e+l*Math.sin(b)*e)|0):(f=1024*G,l=1024*w),l=d(k,f,l,y,h),B[w*y+G]=l;p.pop(4);return 0},primitiveWaterRipples1:function(){var c,d,f,m,h,k,B,l,u,y,G,w,L,I,E,K;c=p.stackValue(5);G=p.stackValue(4);E=
p.stackIntegerValue(3);w=g(c);L=g(G);d=n(c);m=p.stackIntegerValue(2);c=p.stackValue(1);f=p.stackValue(0);c=e(c);f=e(f);p.success(n(G)===d);if(p.failed())return null;G=a(d,E);h=Math.random();m=b(h,m)-1;for(d=0;d<=m/2-1;d++)for(h=Math.random(),l=b(h,E),h=Math.random(),K=b(h,G),h=Math.random(),I=b(h,8),u=-4;4>=u;u++)for(y=-4;4>=y;y++)h=u*u+y*y,25>h&&0<h&&(k=l+u|0,B=K+y|0,0<k&&0<B&&B<G&&k<E&&(c[B*E+k]=I*(1-h/25)));for(d=1;d<=E-2;d++)for(m=1;m<=G-2;m++)l=m*E+d,c[l]=(f[l+1]+f[l-1]+f[l+E]+f[l-E]+f[l-1-E]/
2+f[l-1+E]/2+f[l+1-E]/2+f[l+1+E]/2)/4-c[l],c[l]*=.9;for(m=0;m<=E*G;m++)d=f[m],f[m]=c[m],c[m]=d;for(m=0;m<=G-1;m++)for(f=0;f<=E-1;f++)1<f&&f<E-1&&1<m&&m<G-1?(l=m*E+f,d=64*(c[l]-c[l-1]+(c[l+1]-c[l])),l=(c[l]-c[l-E]+(c[l+E]-c[l]))/64,2>d&&(d=-2),2<d&&(d=2),2>l&&(l=-2),2<l&&(l=2),d=(m+l)*E+(f+d)|0,d=d<E*G&&0<=d?w[d]:w[f+m*E]):d=w[f+m*E],L[f+m*E]=d;p.pop(6);return 0},primitiveHalfSizeDiagonal:function(){var a,b,c,d,e,f,k,l,n,y,G,w,L,I,E,K,H,C;l=g(p.stackValue(11));n=p.stackIntegerValue(10);c=p.stackIntegerValue(9);
y=g(p.stackValue(8));G=p.stackIntegerValue(7);k=p.stackIntegerValue(6);E=p.stackIntegerValue(5);K=p.stackIntegerValue(4);e=p.stackIntegerValue(3);f=p.stackIntegerValue(2);d=p.stackIntegerValue(1);b=p.stackIntegerValue(0);p.success(0<=E&&0<=K);p.success(E+2*d<=n);p.success(K+2*b<=c);p.success(0<=e&&0<=f);p.success(e+d<=G);p.success(f+b<=k);if(p.failed())return null;for(C=0;C<=b-1;C++)for(I=n*(K+2*C)+E,c=G*(f+C)+e,H=0;H<=d-1;H++)a=l[I],w=l[I+n+1],L=(a&16711680)+(w&16711680)>>>1&16711680,k=(a&65280)+
(w&65280)>>>1&65280,a=(a&255)+(w&255)>>>1,y[c]=L|k|a,I+=2,++c;p.pop(12);return 0},primitiveScale:function(){var b,c,d,e,f,k,B,l,u,y,G,w,L,I,E,K,H,C,D,v,N,Q;b=p.stackValue(5);d=p.stackIntegerValue(4);c=p.stackIntegerValue(3);e=p.stackValue(2);u=p.stackIntegerValue(1);B=p.stackIntegerValue(0);p.success(n(b)===d*c);p.success(n(e)===u*B);b=g(b);k=g(e);if(p.failed())return null;f=0;N=a(1024*d,u);Q=a(1024*c,B);for(G=0;G<=B-1;G++){for(y=e=0;y<=u-1;y++)H=(1024-(e&1023))*(1024-(f&1023)),C=(e&1023)*(1024-(f&
1023)),D=(1024-(e&1023))*(f&1023),v=(e&1023)*(f&1023),K=(f>>>10)*d+(e>>>10),w=b[K],L=e>>>10<d-1?b[K+1]:w,f>>>10<c-1&&(K+=d),I=b[K],E=e>>>10<d-1?b[K+1]:I,K=0,0===w&&(w=L,K+=H),0===L&&(L=w,K+=C),0===I&&(I=E,K+=D),0===E&&(E=I,K+=v),0===w&&(w=I,L=E),0===I&&(I=w,E=L),l=0,5E5>K&&(K=H*(w>>>16&255)+C*(L>>>16&255)+D*(I>>>16&255)+v*(E>>>16&255),l=(K>>>20&255)<<16,K=H*(w>>>8&255)+C*(L>>>8&255)+D*(I>>>8&255)+v*(E>>>8&255),l|=(K>>>20&255)<<8,K=H*(w&255)+C*(L&255)+D*(I&255)+v*(E&255),l|=K>>>20&255,0===l&&(l=1)),
k[G*u+y]=l,e+=N;f+=Q}p.pop(6);return 0},primitiveDoubleSize:function(){var a,b,c,d,e,f,k,l,n,y,G,w;e=p.stackValue(7);k=p.stackIntegerValue(6);f=p.stackIntegerValue(5);l=p.stackValue(4);n=p.stackIntegerValue(3);a=p.stackIntegerValue(2);b=p.stackIntegerValue(1);c=p.stackIntegerValue(0);e=g(e);l=g(l);p.success(b+2*k<n);p.success(c+2*f<a);if(p.failed())return null;for(w=0;w<=f-1;w++)for(a=(c+2*w)*n+b,G=0;G<=k-1;G++)y=e[G+w*k],d=a+2*G,l[d]=y,l[d+1]=y,l[d+n]=y,l[d+n+1]=y;p.pop(8);return 0},setInterpreter:function(a){p=
a;a=1==p.majorVersion();return!1===a?!1:a=11<=p.minorVersion()},primitiveWhirl:function(){var b,c,e,f,h,k,B,l,u,y,G,w,L,I,E,K,H;e=p.stackValue(3);c=p.stackValue(2);E=p.stackIntegerValue(1);h=p.stackIntegerValue(0);u=g(e);y=g(c);e=n(e);p.success(n(c)===e);if(p.failed())return null;l=a(e,E);c=E>>1;e=l>>1;c<e?(G=c,w=e/c,L=1):(G=e,w=1,L=e<c?c/e:1);I=-3.141592653589793*h/180;h=G*G;for(K=0;K<=E-1;K++)for(H=0;H<=l-1;H++)k=w*(K-c),B=L*(H-e),f=k*k+B*B,f<h&&(f=1-Math.sqrt(f)/G,b=I*f*f,f=Math.sin(b),b=Math.cos(b),
k=d(u,1024*((b*k-f*B)/w+c)|0,1024*((f*k+b*B)/L+e)|0,E,l),y[E*H+K]=k);p.pop(4);return 0},primitiveBlur:function(){var b,c,d,e,f,k,B,l,u,y,G,w,L;B=p.stackValue(2);f=p.stackValue(1);w=p.stackIntegerValue(0);k=g(B);u=g(f);B=n(B);p.success(n(f)===B);if(p.failed())return null;f=a(B,w);for(L=1;L<=f-2;L++)for(B=1;B<=w-2;B++){l=G=e=b=0;for(d=-1;1>=d;d++)for(c=-1;1>=c;c++)y=k[(L+d)*w+(B+c)]&16777215,0!==y&&(G+=y>>>16&255,e+=y>>>8&255,b+=y&255,++l);b=0===l?0:(a(G,l)<<16)+(a(e,l)<<8)+a(b,l);u[L*w+B]=b}p.pop(3);
return 0},primitiveBrightnessShift:function(){var b,d,e,f,h,t,B,l,u,y;t=p.stackValue(2);f=p.stackValue(1);u=p.stackIntegerValue(0);h=g(t);y=n(t);t=g(f);p.success(n(f)===y);if(p.failed())return null;for(f=0;f<=y-1;f++)d=h[f]&16777215,0!==d&&(l=d>>>16&255,e=d>>>8&255,b=d&255,d=B=l,e>d&&(d=e),b>d&&(d=b),e<B&&(B=e),b<B&&(B=b),e=k(l,e,b,B,d),B=0===d?0:a(1E3*(d-B),d),d=a(1E3*d,255),d+=10*u,1E3<d&&(d=1E3),0>d&&(d=0),c(t,f,e,B,d));p.pop(3);return 0},primitiveHalfSizeAverage:function(){var a,b,c,d,e,f,k,l,
n,y,G,w,L,I,E,K,H,C;l=g(p.stackValue(11));n=p.stackIntegerValue(10);a=p.stackIntegerValue(9);y=g(p.stackValue(8));G=p.stackIntegerValue(7);c=p.stackIntegerValue(6);E=p.stackIntegerValue(5);K=p.stackIntegerValue(4);e=p.stackIntegerValue(3);f=p.stackIntegerValue(2);d=p.stackIntegerValue(1);b=p.stackIntegerValue(0);p.success(0<=E&&0<=K);p.success(E+2*d<=n);p.success(K+2*b<=a);p.success(0<=e&&0<=f);p.success(e+d<=G);p.success(f+b<=c);if(p.failed())return null;for(C=0;C<=b-1;C++)for(I=n*(K+2*C)+E,c=G*
(f+C)+e,H=0;H<=d-1;H++)w=l[I],L=w&16711680,k=w&65280,a=w&255,w=l[I+1],L+=w&16711680,k+=w&65280,a+=w&255,w=l[I+n],L+=w&16711680,k+=w&65280,a+=w&255,w=l[I+n+1],L+=w&16711680,k+=w&65280,a+=w&255,y[c]=L>>>2&16711680|k>>>2&65280|a>>>2,I+=2,++c;p.pop(12);return 0},primitiveSaturationShift:function(){var b,d,e,f,h,t,B,l,u,y,G,w;t=p.stackValue(2);f=p.stackValue(1);G=p.stackIntegerValue(0);h=g(t);w=n(t);t=g(f);p.success(n(f)===w);if(p.failed())return null;for(f=0;f<=w-1;f++)d=h[f]&16777215,2>d||(u=d>>>16&
255,e=d>>>8&255,b=d&255,B=l=u,e>B&&(B=e),b>B&&(B=b),e<l&&(l=e),b<l&&(l=b),d=a(1E3*B,255),y=0===B?0:a(1E3*(B-l),B),0<y&&(e=k(u,e,b,l,B),y+=10*G,1E3<y&&(y=1E3),0>y&&(y=0),c(t,f,e,y,d)));p.pop(3);return 0},primitiveHueShift:function(){var d,e,f,m,h,t,B,l,u,y,G,w;t=p.stackValue(2);m=p.stackValue(1);G=p.stackIntegerValue(0);h=g(t);w=n(t);t=g(m);p.success(n(m)===w);if(p.failed())return null;for(m=0;m<=w-1;m++)e=h[m]&16777215,0!==e&&(u=e>>>16&255,f=e>>>8&255,d=e&255,B=l=u,f>B&&(B=f),d>B&&(B=d),f<l&&(l=f),
d<l&&(l=d),e=a(1E3*B,255),y=0===B?0:a(1E3*(B-l),B),110>e&&(e=110,y=1E3),90>y&&(y=90),f=110===e||90===y?0:k(u,f,d,l,B),f=b(f+G+36E7,360),c(t,m,f,y,e));p.pop(3);return 0},primitiveInterpolate:function(){var b,c,e,f,h;c=p.stackValue(3);e=p.stackIntegerValue(2);f=p.stackIntegerValue(1);h=p.stackIntegerValue(0);b=g(c);c=n(c);if(p.failed())return null;b=d(b,f,h,e,a(c,e));p.pop(5);p.pushInteger(b);return 0},primitiveExtractChannel:function(){var a,b,c,d,e=0,f=0;c=p.stackValue(2);a=p.stackValue(1);b=p.booleanValueOf(p.stackValue(0));
p.success(p.isWords(c));p.success(p.isWords(a));d=n(c);p.success(n(a)>=d>>1);if(p.failed())return null;c=c.wordsAsInt16Array();a=a.wordsAsInt16Array();b&&e++;for(b=1;b<=d;b++)a[f++]=c[e],e+=2;p.pop(3);return 0}})});function SocketPlugin(){return{getModuleName:function(){return"SocketPlugin (http-only)"},interpreterProxy:null,primHandler:null,handleCounter:0,needProxy:new Set,lastLookup:null,TCP_Socket_Type:0,Resolver_Uninitialized:0,Resolver_Ready:1,Resolver_Busy:2,Resolver_Error:3,Socket_InvalidSocket:-1,Socket_Unconnected:0,Socket_WaitingForConnection:1,Socket_Connected:2,Socket_OtherEndClosed:3,Socket_ThisEndClosed:4,setInterpreter:function(n){this.interpreterProxy=n;this.primHandler=this.interpreterProxy.vm.primHandler;
return!0},_newSocketHandle:function(n,a,b,c){var e=this;return{host:null,port:null,connSemaIndex:a,readSemaIndex:b,writeSemaIndex:c,sendBuffer:null,sendTimeout:null,response:null,responseReadUntil:0,responseReceived:!1,status:e.Socket_Unconnected,_signalSemaphore:function(a){0>=a||e.primHandler.signalSemaphoreWithIndex(a)},_signalConnSemaphore:function(){this._signalSemaphore(this.connSemaIndex)},_signalReadSemaphore:function(){this._signalSemaphore(this.readSemaIndex)},_signalWriteSemaphore:function(){this._signalSemaphore(this.writeSemaIndex)},
_otherEndClosed:function(){this.status=e.Socket_OtherEndClosed;this._signalConnSemaphore()},_hostAndPort:function(){return this.host+":"+this.port},_requestNeedsProxy:function(){return e.needProxy.has(this._hostAndPort())},_getURL:function(a,b){var c="";if(b||this._requestNeedsProxy())c+="object"===typeof SqueakJS&&SqueakJS.options.proxy||"https://crossorigin.me/";return c=443!==this.port?c+("http://"+this._hostAndPort()+a):c+("https://"+this.host+a)},_performRequest:function(){var a=(new TextDecoder("utf-8")).decode(this.sendBuffer).split("\r\n\r\n")[0].split("\n"),
b=a[0].split(" "),c=b[0];if("GET"!==c&&"PUT"!==c&&"POST"!==c)return this._otherEndClosed(),-1;for(var b=b[1],d=null,e=1;e<a.length;e++){var n=a[e];if(n.match(/Content-Length:/i)){d=parseInt(n.substr(16));e=this.sendBuffer.byteLength;d=this.sendBuffer.subarray(e-d,e);break}}window.fetch?this._performFetchAPIRequest(b,c,d,a):this._performXMLHTTPRequest(b,c,d,a)},_performFetchAPIRequest:function(a,b,c,d){for(var p=this,n={},x=1;x<d.length;x++){var q=d[x].split(":");2===q.length&&(n[q[0]]=q[1].trim())}var m=
{method:b,headers:n,body:c,mode:"cors"};fetch(this._getURL(a),m).then(p._handleFetchAPIResponse.bind(p))["catch"](function(h){var n=p._getURL(a,!0);console.warn("Retrying with CORS proxy: "+n);fetch(n,m).then(function(a){console.log("Success: "+n);p._handleFetchAPIResponse(a);e.needProxy.add(p._hostAndPort())})["catch"](function(e){console.warn("Fetch API failed, retrying with XMLHttpRequest");p._performXMLHTTPRequest(a,b,c,d)})})},_handleFetchAPIResponse:function(a){if(null===this.response){var b=
["HTTP/1.0 ",a.status," ",a.statusText,"\r\n"];a.headers.forEach(function(a,c,e){b=b.concat([c,": ",a,"\r\n"])});b.push("\r\n");this.response=[(new TextEncoder("utf-8")).encode(b.join(""))]}this._readIncremental(a.body.getReader())},_readIncremental:function(a){var b=this;return a.read().then(function(c){if(c.done)b.responseReceived=!0;else return b.response.push(c.value),b._signalReadSemaphore(),b._readIncremental(a)})},_performXMLHTTPRequest:function(a,b,c,d){for(var p=this,n,x=1;x<d.length;x++){var q=
d[x];if(q.match(/Content-Type:/i)){n=encodeURIComponent(q.substr(14));break}}var m=new XMLHttpRequest;m.open(b,this._getURL(a));void 0!==n&&m.setRequestHeader("Content-type",n);m.responseType="arraybuffer";m.onload=function(a){p._handleXMLHTTPResponse(this)};m.onerror=function(d){var n=p._getURL(a,!0);console.warn("Retrying with CORS proxy: "+n);d=new XMLHttpRequest;d.open(b,n);d.responseType=m.responseType;d.onload=function(a){console.log("Success: "+n);p._handleXMLHTTPResponse(this);e.needProxy.add(p._hostAndPort())};
d.onerror=function(){p._otherEndClosed();console.error("Failed to download:\n"+n)};d.send(c)};m.send(c)},_handleXMLHTTPResponse:function(a){this.responseReceived=!0;var b=a.response;if(b){a=(new TextEncoder("utf-8")).encode("HTTP/1.0 "+a.status+" "+a.statusText+"\r\n"+a.getAllResponseHeaders()+"\r\n");var c=new Uint8Array(a.byteLength+b.byteLength);c.set(a,0);c.set(new Uint8Array(b),a.byteLength);this.response=[c];this._signalReadSemaphore()}else this._otherEndClosed()},connect:function(a,b){this.host=
a;this.port=b;this.status=e.Socket_Connected;this._signalConnSemaphore();this._signalWriteSemaphore()},close:function(){if(this.status==e.Socket_Connected||this.status==e.Socket_OtherEndClosed||this.status==e.Socket_WaitingForConnection)this.status=e.Socket_Unconnected,this._signalConnSemaphore()},destroy:function(){this.status=e.Socket_InvalidSocket},dataAvailable:function(){if(this.status==e.Socket_InvalidSocket)return!1;if(this.status==e.Socket_Connected){if(this.response&&0<this.response.length)return this._signalReadSemaphore(),
!0;this.responseSentCompletly&&(this.status=e.Socket_OtherEndClosed,this._signalConnSemaphore())}return!1},recv:function(a){if(null===this.response)return[];var b=this.response[0];if(b.length>a){var c=b.subarray(a);c?this.response[0]=c:this.response.shift();b=b.subarray(0,a)}else this.response.shift();this.responseReceived&&0===this.response.length&&(this.responseSentCompletly=!0);return b},send:function(a,b,c){null!==this.sendTimeout&&window.clearTimeout(this.sendTimeout);this.lastSend=Date.now();
a=a.bytes.subarray(b,c);null===this.sendBuffer?this.sendBuffer=a:(b=new Uint8Array(this.sendBuffer.byteLength+a.byteLength),b.set(this.sendBuffer,0),b.set(a,this.sendBuffer.byteLength),this.sendBuffer=b);this.sendTimeout=setTimeout(this._performRequest.bind(this),50);return a.byteLength}}},primitiveHasSocketAccess:function(n){this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject());return!0},primitiveInitializeNetwork:function(n){this.interpreterProxy.pop(1);return!0},primitiveResolverNameLookupResult:function(n){if(0!==
n)return!1;null!==this.lastLookup?(n=this.primHandler.makeStString(this.lastLookup),this.lastLookup=null):n=this.interpreterProxy.nilObject();this.interpreterProxy.popthenPush(1,n);return!0},primitiveResolverStartNameLookup:function(n){if(1!==n)return!1;this.lastLookup=this.interpreterProxy.stackValue(0).bytesAsString();this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject());return!0},primitiveResolverStatus:function(n){this.interpreterProxy.popthenPush(1,this.Resolver_Ready);return!0},
primitiveSocketConnectionStatus:function(n){if(1!==n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle.status;void 0===n&&(n=this.Socket_InvalidSocket);this.interpreterProxy.popthenPush(1,n);return!0},primitiveSocketConnectToPort:function(n){if(3!==n)return!1;var a=this.interpreterProxy.stackObjectValue(2).handle;if(void 0===a)return!1;var b=this.interpreterProxy.stackObjectValue(1).bytesAsString(),c=this.interpreterProxy.stackIntegerValue(0);a.connect(b,c);this.interpreterProxy.popthenPush(n,
this.interpreterProxy.nilObject());return!0},primitiveSocketCloseConnection:function(n){if(1!==n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===n)return!1;n.close();this.interpreterProxy.popthenPush(1,this.interpreterProxy.nilObject());return!0},primitiveSocketCreate3Semaphores:function(n){if(7!==n)return!1;var a=this.interpreterProxy.stackIntegerValue(0),b=this.interpreterProxy.stackIntegerValue(1),c=this.interpreterProxy.stackIntegerValue(2),e=this.interpreterProxy.stackIntegerValue(3);
if(this.interpreterProxy.stackIntegerValue(5)!==this.TCP_Socket_Type)return!1;var g="{SqueakJS Socket #"+ ++this.handleCounter+"}",g=this.primHandler.makeStString(g);g.handle=this._newSocketHandle(e,c,b,a);this.interpreterProxy.popthenPush(n,g);return!0},primitiveSocketDestroy:function(n){if(1!==n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===n)return!1;n.destroy();this.interpreterProxy.popthenPush(1,n.status);return!0},primitiveSocketReceiveDataAvailable:function(n){if(1!==
n)return!1;n=this.interpreterProxy.stackObjectValue(0).handle;if(void 0===n)return!1;var a=this.interpreterProxy.falseObject();n.dataAvailable()&&(a=this.interpreterProxy.trueObject());this.interpreterProxy.popthenPush(1,a);return!0},primitiveSocketReceiveDataBufCount:function(n){if(4!==n)return!1;var a=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===a)return!1;var b=this.interpreterProxy.stackObjectValue(2),c=this.interpreterProxy.stackIntegerValue(1)-1,e=this.interpreterProxy.stackIntegerValue(0);
if(c+e>b.bytes.length)return!1;a=a.recv(e);b.bytes.set(a,c);this.interpreterProxy.popthenPush(n,a.length);return!0},primitiveSocketSendDataBufCount:function(n){if(4!==n)return!1;n=this.interpreterProxy.stackObjectValue(3).handle;if(void 0===n)return!1;var a=this.interpreterProxy.stackObjectValue(2),b=this.interpreterProxy.stackIntegerValue(1)-1;if(0>b)return!1;var c=this.interpreterProxy.stackIntegerValue(0),c=b+c;if(c>a.length)return!1;n=n.send(a,b,c);this.interpreterProxy.popthenPush(1,n);return!0},
primitiveSocketSendDone:function(n){if(1!==n)return!1;this.interpreterProxy.popthenPush(1,this.interpreterProxy.trueObject());return!0}}}function registerSocketPlugin(){"object"===typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SocketPlugin",SocketPlugin()):window.setTimeout(registerSocketPlugin,100)}registerSocketPlugin();module("users.bert.SqueakJS.plugins.SoundGenerationPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a,c){return a-(Math.floor(a/c)|0)*c|0}var a=null;Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:function(){var b,c,e,g,k,f,d,p,A,x,q,m,h,t,B,l,u,y,G,w,L,I;b=a.stackValue(5);c=a.stackIntegerValue(4);e=a.stackInt16Array(3);g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);y=a.fetchIntegerofObject(3,b);G=a.fetchIntegerofObject(4,
b);w=a.fetchIntegerofObject(5,b);m=a.fetchIntegerofObject(7,b);I=a.fetchInt16ArrayofObject(8,b);L=a.fetchIntegerofObject(9,b);t=a.fetchIntegerofObject(10,b);B=a.fetchIntegerofObject(11,b);h=a.fetchIntegerofObject(14,b);l=a.fetchIntegerofObject(15,b);u=a.fetchIntegerofObject(16,b);if(a.failed())return null;d=0!==h&&0!==u;A=g+c-1;for(q=g;q<=A;q++)if(g=y*I[t>>15]>>15,d?(p=h*I[l>>15],l=n(l+u,L),0>l&&(l+=L),t=n(t+B+p,L),0>t&&(t+=L)):t=n(t+B,L),0<k&&(p=2*q-1,x=e[p-1]+(g*k>>15),32767<x&&(x=32767),-32767>
x&&(x=-32767),e[p-1]=x),0<f&&(p=2*q,x=e[p-1]+(g*f>>15),32767<x&&(x=32767),-32767>x&&(x=-32767),e[p-1]=x),0!==G&&(y+=G,0<G&&y>=w||0>G&&y<=w))y=w,G=0;m-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,y);a.storeIntegerofObjectwithValue(4,b,G);a.storeIntegerofObjectwithValue(7,b,m);a.storeIntegerofObjectwithValue(10,b,t);a.storeIntegerofObjectwithValue(15,b,l);a.pop(5)},primitiveMixSampledSound:function(){var b,c,e,g,k,f,d,p,n,x,q,m,h,t,B,l,u,y,G;b=a.stackValue(5);c=a.stackIntegerValue(4);
e=a.stackInt16Array(3);g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);u=a.fetchIntegerofObject(3,b);y=a.fetchIntegerofObject(4,b);G=a.fetchIntegerofObject(5,b);q=a.fetchIntegerofObject(7,b);h=a.fetchInt16ArrayofObject(8,b);t=a.fetchIntegerofObject(10,b);l=a.fetchIntegerofObject(11,b);m=a.fetchIntegerofObject(12,b);B=a.fetchIntegerofObject(13,b);if(a.failed())return null;p=g+c-1;for(d=m+(l>>>16);d<=t&&g<=p;)x=h[d-1]*u>>15,0<k&&(d=2*g-1,n=e[d-1]+(x*k>>15),32767<n&&(n=32767),
-32767>n&&(n=-32767),e[d-1]=n),0<f&&(d=2*g,n=e[d-1]+(x*f>>15),32767<n&&(n=32767),-32767>n&&(n=-32767),e[d-1]=n),0!==y&&(u+=y,0<y&&u>=G||0>y&&u<=G)&&(u=G,y=0),l+=B,536870912<=l&&(d=l>>>16,m+=d,l-=d<<16),d=m+(l>>>16),++g;q-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,u);a.storeIntegerofObjectwithValue(4,b,y);a.storeIntegerofObjectwithValue(7,b,q);a.storeIntegerofObjectwithValue(11,b,l);a.storeIntegerofObjectwithValue(12,b,m);a.pop(5)},setInterpreter:function(b){a=b;b=1==a.majorVersion();
return!1===b?!1:b=11<=a.minorVersion()},getModuleName:function(){return"SoundGenerationPlugin 3 November 2014 (e)"},primitiveApplyReverb:function(){var b,c,e,g,k,f,d,p,A,x,q,m,h,t,B,l,u;b=a.stackValue(3);c=a.stackInt16Array(2);e=a.stackIntegerValue(1);g=a.stackIntegerValue(0);l=a.fetchInt32ArrayofObject(7,b);u=a.fetchInt32ArrayofObject(8,b);B=a.fetchIntegerofObject(9,b);m=a.fetchIntegerofObject(10,b);q=a.fetchIntegerofObject(11,b);h=a.fetchInt16ArrayofObject(12,b);t=a.fetchInt16ArrayofObject(13,b);
if(a.failed())return null;for(p=e;p<=e+g-1;p++){k=f=0;for(x=1;x<=B;x++)d=q-l[x-1],1>d&&(d+=m),A=u[x-1],k+=A*h[d-1],f+=A*t[d-1];d=2*p-1;k=c[d-1]+(k>>15);32767<k&&(k=32767);-32767>k&&(k=-32767);c[d-1]=k;h[q-1]=k;++d;k=c[d-1]+(f>>15);32767<k&&(k=32767);-32767>k&&(k=-32767);c[d-1]=k;t[q-1]=k;q=n(q,m)+1}if(a.failed())return null;a.storeIntegerofObjectwithValue(11,b,q);a.pop(3)},primitiveMixPluckedSound:function(){var b,c,e,g,k,f,d,n,A,x,q,m,h,t,B,l,u,y,G;b=a.stackValue(5);c=a.stackIntegerValue(4);e=a.stackInt16Array(3);
g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);u=a.fetchIntegerofObject(3,b);y=a.fetchIntegerofObject(4,b);G=a.fetchIntegerofObject(5,b);h=a.fetchIntegerofObject(7,b);t=a.fetchInt16ArrayofObject(8,b);q=a.fetchIntegerofObject(9,b);B=a.fetchIntegerofObject(10,b);l=a.fetchIntegerofObject(11,b);if(a.failed())return null;n=g+c-1;for(m=q;g<=n;g++)if(q=m+B,q>=l&&(q=32768+(q-l)),d=t[(m>>15)-1]+t[(q>>15)-1]>>1,t[(m>>15)-1]=d,x=d*u>>15,m=q,0<k&&(d=2*g-1,A=e[d-1]+(x*k>>15),32767<
A&&(A=32767),-32767>A&&(A=-32767),e[d-1]=A),0<f&&(d=2*g,A=e[d-1]+(x*f>>15),32767<A&&(A=32767),-32767>A&&(A=-32767),e[d-1]=A),0!==y&&(u+=y,0<y&&u>=G||0>y&&u<=G))u=G,y=0;h-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,u);a.storeIntegerofObjectwithValue(4,b,y);a.storeIntegerofObjectwithValue(7,b,h);a.storeIntegerofObjectwithValue(9,b,q);a.pop(5)},primitiveMixLoopedSampledSound:function(){var b,c,e,g,k,f,d,n,A,x,q,m,h,t,B,l,u,y,G,w,L,I,E,K,H,C,D,v;b=a.stackValue(5);c=a.stackIntegerValue(4);
e=a.stackInt16Array(3);g=a.stackIntegerValue(2);k=a.stackIntegerValue(1);f=a.stackIntegerValue(0);C=a.fetchIntegerofObject(3,b);D=a.fetchIntegerofObject(4,b);v=a.fetchIntegerofObject(5,b);u=a.fetchIntegerofObject(7,b);L=a.fetchIntegerofObject(8,b);G=a.fetchInt16ArrayofObject(10,b);I=a.fetchInt16ArrayofObject(11,b);y=a.fetchIntegerofObject(16,b);w=a.fetchIntegerofObject(17,b);H=a.fetchIntegerofObject(18,b);E=a.fetchIntegerofObject(19,b);K=a.fetchIntegerofObject(20,b);if(a.failed())return null;x=G!==
I;d=k*C>>15;n=f*C>>15;A=2*g-1;q=g+c-1;for(l=g;l<=q;l++){B=(E+=K)>>9;B>w&&u>L&&(B=(E-=H)>>9);if((t=B+1)>y){if(B>y){u=0;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,C);a.storeIntegerofObjectwithValue(4,b,D);a.storeIntegerofObjectwithValue(7,b,u);a.storeIntegerofObjectwithValue(19,b,E);a.popthenPush(6,null);return null}t=0===H?B:(E-H>>9)+1}h=E&511;g=m=G[B-1]*(512-h)+G[t-1]*h>>9;x&&(g=I[B-1]*(512-h)+I[t-1]*h>>9);0<k&&(m=e[A-1]+(d*m>>15),32767<m&&(m=32767),-32767>m&&(m=-32767),e[A-1]=
m);++A;0<f&&(m=e[A-1]+(n*g>>15),32767<m&&(m=32767),-32767>m&&(m=-32767),e[A-1]=m);++A;if(0!==D){C+=D;if(0<D&&C>=v||0>D&&C<=v)C=v,D=0;d=k*C>>15;n=f*C>>15}}u-=c;if(a.failed())return null;a.storeIntegerofObjectwithValue(3,b,C);a.storeIntegerofObjectwithValue(4,b,D);a.storeIntegerofObjectwithValue(7,b,u);a.storeIntegerofObjectwithValue(19,b,E);a.pop(5)}})});function SpeechPlugin(){return{getModuleName:function(){return"SpeechPlugin"},interpreterProxy:null,primHandler:null,voiceInput:null,semaphoreIndex:null,shouldListen:!1,recognition:null,synth:window.speechSynthesis,setInterpreter:function(n){this.interpreterProxy=n;this.primHandler=this.interpreterProxy.vm.primHandler;return!0},primitiveSpeak:function(n){var a,b;if(1===n)a=this.interpreterProxy.stackValue(0).bytesAsString();else if(2===n){a=this.interpreterProxy.stackValue(1).bytesAsString();var c=
this.interpreterProxy.stackValue(0).bytesAsString();b=this.synth.getVoices().filter(function(a){return a.name===c})}else return!1;a=new SpeechSynthesisUtterance(a);b&&0<b.length&&(a.voice=b[0]);this.synth.speak(a);this.interpreterProxy.pop(n);return!0},primitiveRegisterSemaphore:function(n){if(1!==n)return!1;this.semaphoreIndex=this.interpreterProxy.stackIntegerValue(0);return!0},primitiveUnregisterSemaphore:function(n){if(0!==n)return!1;this.semaphoreIndex=null;return!0},primitiveGetLastRecognitionResult:function(n){if(0!==
n||null===this.semaphoreIndex||null===this.voiceInput)return!1;n=this.primHandler.makeStArray(this.voiceInput);this.voiceInput=[];this.interpreterProxy.popthenPush(1,n);return!0},primitiveStartListening:function(n){if(0!==n)return!1;this.recognition=new webkitSpeechRecognition;this.recognition.lang="en-US";this.recognition.interimResults=!0;this.recognition.onresult=this._onRecognitionResult.bind(this);this.recognition.onerror=function(a){console.log(a)};this.recognition.onend=function(a){this.shouldListen&&
this.recognition.start()}.bind(this);this.shouldListen=!0;this.recognition.start();return!0},_onRecognitionResult:function(n){this.voiceInput=[];for(var a=n.resultIndex;a<n.results.length;a++){for(var b=n.results[a],c=[b.isFinal,[]],e=0;e<b.length;e++){var g=b[e].transcript;Date.now();c[1].push([g,b[e].confidence])}0<c[1].length&&this.voiceInput.push(c)}null!==this.semaphoreIndex&&0<this.voiceInput.length&&this.primHandler.signalSemaphoreWithIndex(this.semaphoreIndex)},primitiveStopListening:function(n){if(0!==
n)return!1;this.voiceInput=[];this.recognition.stop();this.shouldListen=!1;return!0}}}function registerSpeechPlugin(){"object"===typeof Squeak&&Squeak.registerExternalModule?"webkitSpeechRecognition"in window?Squeak.registerExternalModule("SpeechPlugin",SpeechPlugin()):console.warn("SpeechPlugin: Web Speech API is not supported by this browser."):window.setTimeout(registerSpeechPlugin,100)}registerSpeechPlugin();function SqueakSSL(){return{getModuleName:function(){return"SqueakSSL (fake)"},interpreterProxy:null,primHandler:null,handleCounter:0,SQSSL_OK:0,SQSSL_NEED_MORE_DATA:-1,SQSSL_INVALID_STATE:-2,SQSSL_BUFFER_TOO_SMALL:-3,SQSSL_INPUT_TOO_LARGE:-4,SQSSL_GENERIC_ERROR:-5,SQSSL_OUT_OF_MEMORY:-6,SQSSL_PROP_VERSION:0,SQSSL_PROP_LOGLEVEL:1,SQSSL_PROP_SSLSTATE:2,SQSSL_PROP_CERTSTATE:3,SQSSL_PROP_PEERNAME:0,SQSSL_PROP_CERTNAME:1,SQSSL_PROP_SERVERNAME:2,setInterpreter:function(n){this.interpreterProxy=n;this.primHandler=
this.interpreterProxy.vm.primHandler;return!0},primitiveCreate:function(n){var a="{SqueakJS SSL #"+ ++this.handleCounter+"}",a=this.primHandler.makeStString(a);a.handle=!0;this.interpreterProxy.popthenPush(n,a);return!0},primitiveConnect:function(n){if(5!==n)return!1;this.interpreterProxy.popthenPush(n,0);return!0},primitiveDestroy:function(n){if(1!==n)return!1;this.interpreterProxy.popthenPush(1,1);return!0},primitiveGetIntProperty:function(n){if(2!==n||void 0===this.interpreterProxy.stackObjectValue(1).handle)return!1;
var a;a=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_CERTSTATE?this.SQSSL_OK:0;this.interpreterProxy.popthenPush(n,a);return!0},primitiveGetStringProperty:function(n){if(2!==n||void 0===this.interpreterProxy.stackObjectValue(1).handle)return!1;var a;a=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_PEERNAME?this.primHandler.makeStString("*"):this.interpreterProxy.nilObject();this.interpreterProxy.popthenPush(n,a);return!0},primitiveEncrypt:function(n){if(5!==n||void 0===
this.interpreterProxy.stackObjectValue(4).handle)return!1;var a=this.interpreterProxy.stackObjectValue(3);this.interpreterProxy.stackIntegerValue(2);var b=this.interpreterProxy.stackIntegerValue(1);this.interpreterProxy.stackObjectValue(0).bytes=a.bytes;this.interpreterProxy.popthenPush(n,b);return!0},primitiveDecrypt:function(n){if(5!==n||void 0===this.interpreterProxy.stackObjectValue(4).handle)return!1;var a=this.interpreterProxy.stackObjectValue(3);this.interpreterProxy.stackIntegerValue(2);var b=
this.interpreterProxy.stackIntegerValue(1);this.interpreterProxy.stackObjectValue(0).bytes=a.bytes;this.interpreterProxy.popthenPush(n,b);return!0}}}function registerSqueakSSL(){"object"===typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SqueakSSL",SqueakSSL()):window.setTimeout(registerSqueakSSL,100)}registerSqueakSSL();module("users.bert.SqueakJS.plugins.StarSqueakPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function a(a){b.success(b.isWords(a));return b.failed()?0:a.words}var b=null;Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:function(){var c,e,g,k,f,d,p,A,x,q,m,h,t,B,l,u;k=b.stackValue(4);c=b.stackValue(3);h=b.stackIntegerValue(2);d=b.stackIntegerValue(1);
e=b.stackIntegerValue(0);A=a(k);g=a(c);b.success(n(k)===n(c));b.success(n(k)===h*d);if(b.failed())return null;c=(2*e+1)*(2*e+1);for(l=0;l<=d-1;l++)for(q=l-e,0>q&&(q=0),f=l+e,f>=d&&(f=d-1),t=0;t<=h-1;t++){x=t-e;0>x&&(x=0);k=t+e;k>=h&&(k=h-1);m=0;for(u=q;u<=f;u++)for(p=u*h,B=x;B<=k;B++)m+=A[p+B];g[l*h+t]=Math.floor(m/c)|0}b.pop(5)},primitiveEvaporateRate:function(){var c,e,g,k;c=b.stackValue(1);g=b.stackIntegerValue(0);e=a(c);k=n(c);if(b.failed())return null;for(c=0;c<=k-1;c++)e[c]=e[c]*g>>>10;b.pop(2)},
setInterpreter:function(a){b=a;a=1==b.majorVersion();return!1===a?!1:a=11<=b.minorVersion()},primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:function(){var c,e,g,k,f,d,p,A,x,q,m,h,t,B;h=b.stackValue(6);g=b.stackValue(5);t=b.stackIntegerValue(4);k=b.stackIntegerValue(3);d=b.stackIntegerValue(2);A=b.stackIntegerValue(1);q=b.stackIntegerValue(0);m=a(h);c=a(g);b.success(n(g)===t*k);b.success(n(g)===n(h)*d*d);if(b.failed())return null;g=0;0<(A&4)&&(g+=65536);0<(A&2)&&(g+=256);0<(A&1)&&++g;A=-1;for(B=
0;B<=(Math.floor(k/d)|0)-1;B++)for(h=0;h<=(Math.floor(t/d)|0)-1;h++)for(e=m[++A],e=0>q?-31>q?0:e>>>0-q:31<q?0:e<<q,255<e&&(e=255),p=0>=e?1:e*g,x=f=(B*t+h)*d;x<=f+(d-1)*t;x+=t)for(e=x;e<=x+d-1;e++)c[e]=p;b.pop(7)},getModuleName:function(){return"StarSqueakPlugin 3 November 2014 (e)"}})});module("users.bert.SqueakJS.plugins.ZipPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(a){return"number"===typeof a?m.classSmallInteger():a.sqClass}function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a){for(a=n(a);!a.isNil&&7<=a.classInstSize();)a=a.superclass();if(a.isNil)return!1;t=a.classInstSize();return!0}function e(a,b,c,d,e){var f,g,h;h=b<<
16|c;if(258<=b)return h;c=Q[(O<<5^w[a+3-1])&32767];f=a-c;if(!(0<f&&32768>f))return h;for(f=32768<a?a-32768:0;;){if(w[a+b]!==w[c+b]||w[a+b-1]!==w[c+b-1]||w[a]!==w[c])g=0;else if(w[a+1]!==w[c+1])g=1;else for(g=2;258>g&&w[a+g]===w[c+g];)++g;a+g>la&&(g=la-a);3===g&&8192<a-c&&(g=2);if(g>b&&(h=g<<16|c,b=g,258<=b||b>e)||!(0<--d))return h;c=M[c&32767];if(c<=f)return h}}function g(a){var b;O=(O<<5^w[a+3-1])&32767;b=Q[O];Q[O]=a;M[a&32767]=b}function k(d){var e;if(!(m.isPointers(d)&&15<=a(d)))return!1;e=m.fetchPointerofObject(0,
d);if(!m.isBytes(e))return!1;if(0===t){if(!c(d))return!1;if(a(d)<t+5)return t=0,!1}w=e.bytes;L=b(e);la=m.fetchIntegerofObject(1,d);wa=m.fetchIntegerofObject(2,d);e=m.fetchPointerofObject(t+0,d);if(!m.isWords(e)||32768!==a(e))return!1;Q=e.words;e=m.fetchPointerofObject(t+1,d);if(!m.isWords(e)||32768!==a(e))return!1;M=e.words;O=m.fetchIntegerofObject(t+2,d);G=m.fetchIntegerofObject(t+3,d);e=m.fetchPointerofObject(t+5,d);if(!m.isBytes(e))return!1;U=a(e);Z=e.bytes;e=m.fetchPointerofObject(t+6,d);if(!(m.isWords(e)&&
a(e)>=U))return!1;D=e.words;e=m.fetchPointerofObject(t+7,d);if(!m.isWords(e)||286!==a(e))return!1;ta=e.words;e=m.fetchPointerofObject(t+8,d);if(!m.isWords(e)||30!==a(e))return!1;C=e.words;P=m.fetchIntegerofObject(t+9,d);T=m.fetchIntegerofObject(t+10,d);return!m.failed()}function f(d){var e;if(0===t){if(!c(d))return!1;if(a(d)<t+3)return t=0,!1}if(!(m.isPointers(d)&&a(d)>=t+3))return!1;e=m.fetchPointerofObject(0,d);if(!m.isBytes(e))return m.primitiveFail();w=e.bytes;L=b(e);la=m.fetchIntegerofObject(1,
d);wa=m.fetchIntegerofObject(2,d);u=m.fetchIntegerofObject(t+1,d);y=m.fetchIntegerofObject(t+2,d);return!m.failed()}function d(a,b){if(!(0<=b&&(31<a?0:1<<a)>b))return m.primitiveFail();u|=31<y?0:b<<y;for(y+=a;8<=y&&la<L;)w[la]=u&255,++la,u>>>=8,y-=8}function p(c,e,f,g){var h,k,w,n,p,q,C,y,t,u,x,A,D;h=m.fetchPointerofObject(0,c);u=m.fetchIntegerofObject(1,c);t=m.fetchIntegerofObject(2,c);if(!(u<=t&&m.isBytes(h)&&t<=b(h)))return m.primitiveFail();C=h.bytes;h=m.fetchPointerofObject(0,e);if(!(m.isWords(h)&&
t<=a(h)&&m.fetchIntegerofObject(1,e)===u&&m.fetchIntegerofObject(2,e)===t))return m.primitiveFail();k=h.words;h=m.fetchPointerofObject(0,f);if(!m.isWords(h))return m.primitiveFail();y=a(h);x=h.words;h=m.fetchPointerofObject(1,f);if(!m.isWords(h)||y!==a(h))return m.primitiveFail();A=h.words;h=m.fetchPointerofObject(0,g);if(!m.isWords(h))return m.primitiveFail();w=a(h);f=h.words;h=m.fetchPointerofObject(1,g);if(!m.isWords(h)||w!==a(h))return m.primitiveFail();n=h.words;d(0,0);for(D=0;u<t&&la+4<L;)if(q=
C[u],h=k[u],++u,0===h){++D;if(!(q<y))return m.primitiveFail();d(x[q],A[q])}else{D=D+q+3;if(!(256>q))return m.primitiveFail();g=xa[q];if(!(g<y))return m.primitiveFail();d(x[g],A[g]);p=N[g-257];0!==p&&(q-=l[g-257],d(p,q));--h;if(!(32768>h))return m.primitiveFail();g=256>h?H[h]:H[256+(h>>>7)];if(!(g<w))return m.primitiveFail();d(f[g],n[g]);p=v[g];0!==p&&(h-=B[g],d(p,h))}if(m.failed())return null;m.storeIntegerofObjectwithValue(1,c,u);m.storeIntegerofObjectwithValue(1,e,u);return D}function A(){var a;
if(P===U)return!0;if(0!==(P&4095)||10*T<=P)return!1;a=P-T;return a<=T?!1:4*a<=T}function x(a,b){var c,d;c=a[0]>>>24;if(16<c)return m.primitiveFail(),0;for(d=2;;){c=q(c);d=d+c-1;if(d>=b){m.primitiveFail();break}c=a[d];if(0===(c&1056964608))return c;d=c&65535;c=c>>>24&255;if(16<c){m.primitiveFail();break}}return 0}function q(a){for(var b;y<a;)b=La[++Ma],u+=31<y?0:b<<y,y+=8;b=u&(31<a?0:1<<a)-1;u=31<a?0:u>>>a;y-=a;return b}var m=null,h=0,t=0,B=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,
1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],l=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],u=0,y=0,G=0,w=null,L=0,I=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,
997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,
3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,
3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,
2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,
2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],E=null,K=0,H=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,
10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,
15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],C=null,D=null,v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,
0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Q=null,M=null,O=0,V=null,X=0,P=0,ta=null,U=0,Z=null,T=0,xa=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,
279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,
284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],la=0,wa=0,La=null,ea=0,Ma=0,Wa=0;Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:function(){var b,c,d,e,g;if(4!==m.methodArgumentCount())return m.primitiveFail();c=m.stackObjectValue(0);e=m.stackObjectValue(1);b=m.stackObjectValue(2);d=m.stackObjectValue(3);g=m.stackObjectValue(4);if(m.failed())return null;if(!(f(g)&&m.isPointers(c)&&2<=a(c)&&m.isPointers(e)&&
2<=a(e)&&m.isPointers(d)&&3<=a(d)&&m.isPointers(b)&&3<=a(b)))return m.primitiveFail();b=p(d,b,e,c);m.failed()||(m.storeIntegerofObjectwithValue(1,g,la),m.storeIntegerofObjectwithValue(h+1,g,u),m.storeIntegerofObjectwithValue(h+2,g,y));m.failed()||(m.pop(5),m.pushInteger(b))},primitiveUpdateAdler32:function(){var a,c,d,e,f,g;if(4!==m.methodArgumentCount())return m.primitiveFail();d=m.stackObjectValue(0);g=m.stackIntegerValue(1);e=m.stackIntegerValue(2);a=m.positive32BitValueOf(m.stackValue(3));if(m.failed())return 0;
if(!(m.isBytes(d)&&g>=e&&0<e))return m.primitiveFail();f=b(d);if(!(g<=f))return m.primitiveFail();d=d.bytes;--e;--g;f=a&65535;for(a=a>>>16&65535;e<=g;e++)c=d[e],f+=c,f=f-65521*(Math.floor(f/65521)|0)|0,a+=f,a=a-65521*(Math.floor(a/65521)|0)|0;m.popthenPush(5,m.positive32BitIntegerFor((a<<16)+f))},primitiveUpdateGZipCrc32:function(){var a,c,d,e,f;if(4!==m.methodArgumentCount())return m.primitiveFail();a=m.stackObjectValue(0);f=m.stackIntegerValue(1);d=m.stackIntegerValue(2);c=m.positive32BitValueOf(m.stackValue(3));
if(m.failed())return 0;if(!(m.isBytes(a)&&f>=d&&0<d))return m.primitiveFail();e=b(a);if(!(f<=e))return m.primitiveFail();a=a.bytes;--d;for(--f;d<=f;d++)c=I[(c^a[d])&255]^c>>>8;m.popthenPush(5,m.positive32BitIntegerFor(c))},primitiveDeflateUpdateHashTable:function(){var b,c,d,e,f;if(2!==m.methodArgumentCount())return m.primitiveFail();b=m.stackIntegerValue(0);c=m.stackObjectValue(1);if(m.failed())return null;if(!m.isWords(c))return m.primitiveFail();f=a(c);e=c.wordsAsInt32Array();for(d=0;d<=f-1;d++)c=
e[d],e[d]=c>=b?c-b:0;m.pop(2)},setInterpreter:function(a){m=a;a=1==m.majorVersion();return!1===a?!1:a=11<=m.minorVersion()},getModuleName:function(){return"ZipPlugin 3 November 2014 (e)"},primitiveDeflateBlock:function(){var a,b,c,d;if(3!==m.methodArgumentCount())return m.primitiveFail();b=m.stackIntegerValue(0);a=m.stackIntegerValue(1);c=m.stackIntegerValue(2);d=m.stackObjectValue(3);if(m.failed())return null;if(!k(d))return m.primitiveFail();a:{var f,h,l,n,p,q,y;if(G>c)a=!1;else if(P>=U)a=!0;else{h=
!1;for(l=G;l<=c;){h||(f=e(l,2,l,a,b),g(l),p=f&65535,n=f>>>16);f=e(l+1,n,p,a,b);y=f&65535;q=f>>>16;if(n>=q&&3<=n){h=n;y=l-p;Z[P]=h-3;D[P]=y;ta[xa[h-3]]++;C[257>y?H[y-1]:H[256+(y-1>>>7)]]++;++P;++T;f=P===U||0===(P&4095)&&A();for(h=1;h<=n-1;h++)g(++l);h=!1;++l}else f=w[l],Z[P]=f,D[P]=0,ta[f]++,++P,f=P===U||0===(P&4095)&&A(),++l,l<=c&&!f&&(g(l),h=!0,p=y,n=q);if(f){G=l;a=!0;break a}}G=l;a=!1}}m.failed()||(m.storeIntegerofObjectwithValue(t+2,d,O),m.storeIntegerofObjectwithValue(t+3,d,G),m.storeIntegerofObjectwithValue(t+
9,d,P),m.storeIntegerofObjectwithValue(t+10,d,T));m.failed()||(m.pop(4),m.pushBool(a))},primitiveInflateDecompressBlock:function(){var c,d;if(2!==m.methodArgumentCount())return m.primitiveFail();c=m.stackValue(0);if(!m.isWords(c))return m.primitiveFail();E=c.words;K=a(c);c=m.stackValue(1);if(!m.isWords(c))return m.primitiveFail();V=c.words;X=a(c);d=m.stackValue(2);if(!m.isPointers(d))return m.primitiveFail();if(0===h){for(c=n(d);!c.isNil&&13<=c.classInstSize();)c=c.superclass();c.isNil?c=!1:(h=c.classInstSize(),
c=!0);if(!c)return m.primitiveFail();if(a(d)<h+8)return h=0,m.primitiveFail()}if(a(d)<h+8)return m.primitiveFail();wa=m.fetchIntegerofObject(2,d);Wa=m.fetchIntegerofObject(h+0,d);u=m.fetchIntegerofObject(h+1,d);y=m.fetchIntegerofObject(h+2,d);Ma=m.fetchIntegerofObject(h+4,d);ea=m.fetchIntegerofObject(h+5,d);if(m.failed())return null;--wa;--Ma;--ea;c=m.fetchPointerofObject(0,d);if(!m.isBytes(c))return m.primitiveFail();w=c.bytes;L=b(c);c=m.fetchPointerofObject(h+3,d);if(!m.isBytes(c))return m.primitiveFail();
La=c.bytes;a:{var e,f,g,k,l,p;for(g=L-1;wa<g&&Ma<=ea;)if(l=u,k=y,p=Ma,e=x(V,X),256>e)w[++wa]=e;else{if(256===e){Wa&=1;break a}f=(e>>>16)-1;c=e&65535;0<f&&(c+=q(f));e=x(E,K);f=e>>>16;e&=65535;0<f&&(e+=q(f));if(wa+c>=g){u=l;y=k;Ma=p;break a}f=wa;k=wa-e;for(e=1;e<=c;e++)w[f+e]=w[k+e];wa+=c}}m.failed()||(m.storeIntegerofObjectwithValue(2,d,wa+1),m.storeIntegerofObjectwithValue(h+0,d,Wa),m.storeIntegerofObjectwithValue(h+1,d,u),m.storeIntegerofObjectwithValue(h+2,d,y),m.storeIntegerofObjectwithValue(h+
4,d,Ma+1),m.pop(2))}})});var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(n){if(null==n)return"";var a="",b,c,e,g,k,f,d=0;for(n=LZString.compress(n);d<2*n.length;)0==d%2?(b=n.charCodeAt(d/2)>>8,c=n.charCodeAt(d/2)&255,e=d/2+1<n.length?n.charCodeAt(d/2+1)>>8:NaN):(b=n.charCodeAt((d-1)/2)&255,(d+1)/2<n.length?(c=n.charCodeAt((d+1)/2)>>8,e=n.charCodeAt((d+1)/2)&255):c=e=NaN),d+=3,g=b>>2,b=(b&3)<<4|c>>4,k=(c&15)<<2|e>>6,f=e&63,isNaN(c)?
k=f=64:isNaN(e)&&(f=64),a=a+LZString._keyStr.charAt(g)+LZString._keyStr.charAt(b)+LZString._keyStr.charAt(k)+LZString._keyStr.charAt(f);return a},decompressFromBase64:function(n){if(null==n)return"";var a="",b=0,c,e,g,k,f,d,p=0,A=LZString._f;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<n.length;)e=LZString._keyStr.indexOf(n.charAt(p++)),g=LZString._keyStr.indexOf(n.charAt(p++)),f=LZString._keyStr.indexOf(n.charAt(p++)),d=LZString._keyStr.indexOf(n.charAt(p++)),e=e<<2|g>>4,g=(g&15)<<4|f>>2,k=(f&3)<<
6|d,0==b%2?(c=e<<8,64!=f&&(a+=A(c|g)),64!=d&&(c=k<<8)):(a+=A(c|e),64!=f&&(c=g<<8),64!=d&&(a+=A(c|k))),b+=3;return LZString.decompress(a)},compressToUTF16:function(n){if(null==n)return"";var a="",b,c,e,g=0,k=LZString._f;n=LZString.compress(n);for(b=0;b<n.length;b++)switch(c=n.charCodeAt(b),g++){case 0:a+=k((c>>1)+32);e=(c&1)<<14;break;case 1:a+=k(e+(c>>2)+32);e=(c&3)<<13;break;case 2:a+=k(e+(c>>3)+32);e=(c&7)<<12;break;case 3:a+=k(e+(c>>4)+32);e=(c&15)<<11;break;case 4:a+=k(e+(c>>5)+32);e=(c&31)<<
10;break;case 5:a+=k(e+(c>>6)+32);e=(c&63)<<9;break;case 6:a+=k(e+(c>>7)+32);e=(c&127)<<8;break;case 7:a+=k(e+(c>>8)+32);e=(c&255)<<7;break;case 8:a+=k(e+(c>>9)+32);e=(c&511)<<6;break;case 9:a+=k(e+(c>>10)+32);e=(c&1023)<<5;break;case 10:a+=k(e+(c>>11)+32);e=(c&2047)<<4;break;case 11:a+=k(e+(c>>12)+32);e=(c&4095)<<3;break;case 12:a+=k(e+(c>>13)+32);e=(c&8191)<<2;break;case 13:a+=k(e+(c>>14)+32);e=(c&16383)<<1;break;case 14:a+=k(e+(c>>15)+32,(c&32767)+32),g=0}return a+k(e+32)},decompressFromUTF16:function(n){if(null==
n)return"";for(var a="",b,c,e=0,g=0,k=LZString._f;g<n.length;){c=n.charCodeAt(g)-32;switch(e++){case 0:b=c<<1;break;case 1:a+=k(b|c>>14);b=(c&16383)<<2;break;case 2:a+=k(b|c>>13);b=(c&8191)<<3;break;case 3:a+=k(b|c>>12);b=(c&4095)<<4;break;case 4:a+=k(b|c>>11);b=(c&2047)<<5;break;case 5:a+=k(b|c>>10);b=(c&1023)<<6;break;case 6:a+=k(b|c>>9);b=(c&511)<<7;break;case 7:a+=k(b|c>>8);b=(c&255)<<8;break;case 8:a+=k(b|c>>7);b=(c&127)<<9;break;case 9:a+=k(b|c>>6);b=(c&63)<<10;break;case 10:a+=k(b|c>>5);b=
(c&31)<<11;break;case 11:a+=k(b|c>>4);b=(c&15)<<12;break;case 12:a+=k(b|c>>3);b=(c&7)<<13;break;case 13:a+=k(b|c>>2);b=(c&3)<<14;break;case 14:a+=k(b|c>>1);b=(c&1)<<15;break;case 15:a+=k(b|c),e=0}g++}return LZString.decompress(a)},compress:function(n){if(null==n)return"";var a,b,c={},e={},g,k,f="",d=2,p=3,A=2,x="",q=0,m=0,h,t=LZString._f;for(h=0;h<n.length;h+=1)if(g=n.charAt(h),Object.prototype.hasOwnProperty.call(c,g)||(c[g]=p++,e[g]=!0),k=f+g,Object.prototype.hasOwnProperty.call(c,k))f=k;else{if(Object.prototype.hasOwnProperty.call(e,
f)){if(256>f.charCodeAt(0)){for(a=0;a<A;a++)q<<=1,15==m?(m=0,x+=t(q),q=0):m++;b=f.charCodeAt(0);for(a=0;8>a;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1}else{b=1;for(a=0;a<A;a++)q=q<<1|b,15==m?(m=0,x+=t(q),q=0):m++,b=0;b=f.charCodeAt(0);for(a=0;16>a;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1}d--;0==d&&(d=Math.pow(2,A),A++);delete e[f]}else for(b=c[f],a=0;a<A;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1;d--;0==d&&(d=Math.pow(2,A),A++);c[k]=p++;f=String(g)}if(""!==f){if(Object.prototype.hasOwnProperty.call(e,
f)){if(256>f.charCodeAt(0)){for(a=0;a<A;a++)q<<=1,15==m?(m=0,x+=t(q),q=0):m++;b=f.charCodeAt(0);for(a=0;8>a;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1}else{b=1;for(a=0;a<A;a++)q=q<<1|b,15==m?(m=0,x+=t(q),q=0):m++,b=0;b=f.charCodeAt(0);for(a=0;16>a;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1}d--;0==d&&(d=Math.pow(2,A),A++);delete e[f]}else for(b=c[f],a=0;a<A;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1;d--;0==d&&A++}b=2;for(a=0;a<A;a++)q=q<<1|b&1,15==m?(m=0,x+=t(q),q=0):m++,b>>=1;for(;;)if(q<<=
1,15==m){x+=t(q);break}else m++;return x},decompress:function(n){if(null==n)return"";if(""==n)return null;var a=[],b=4,c=4,e=3,g,k,f,d,p,A,x,q=LZString._f,m=n.charCodeAt(0),h=32768,t=1;for(k=0;3>k;k+=1)a[k]=k;d=0;A=Math.pow(2,2);for(x=1;x!=A;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(t++)),d|=(0<p?1:0)*x,x<<=1;switch(d){case 0:d=0;A=Math.pow(2,8);for(x=1;x!=A;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(t++)),d|=(0<p?1:0)*x,x<<=1;g=q(d);break;case 1:d=0;A=Math.pow(2,16);for(x=1;x!=A;)p=m&h,h>>=1,0==
h&&(h=32768,m=n.charCodeAt(t++)),d|=(0<p?1:0)*x,x<<=1;g=q(d);break;case 2:return""}for(f=k=a[3]=g;;){if(t>n.length)return"";d=0;A=Math.pow(2,e);for(x=1;x!=A;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(t++)),d|=(0<p?1:0)*x,x<<=1;switch(g=d){case 0:d=0;A=Math.pow(2,8);for(x=1;x!=A;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(t++)),d|=(0<p?1:0)*x,x<<=1;a[c++]=q(d);g=c-1;b--;break;case 1:d=0;A=Math.pow(2,16);for(x=1;x!=A;)p=m&h,h>>=1,0==h&&(h=32768,m=n.charCodeAt(t++)),d|=(0<p?1:0)*x,x<<=1;a[c++]=q(d);g=
c-1;b--;break;case 2:return k}0==b&&(b=Math.pow(2,e),e++);if(a[g])g=a[g];else if(g===c)g=f+f.charAt(0);else return null;k+=g;a[c++]=f+g.charAt(0);b--;f=g;0==b&&(b=Math.pow(2,e),e++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);(function(n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define([],n):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).JSZip=n()})(function(){return function a(b,c,e){function g(d,f){if(!c[d]){if(!b[d]){var A="function"==typeof require&&require;if(!f&&A)return A(d,!0);if(k)return k(d,!0);A=Error("Cannot find module '"+d+"'");throw A.code="MODULE_NOT_FOUND",A;}A=c[d]={exports:{}};
b[d][0].call(A.exports,function(a){var c=b[d][1][a];return g(c?c:a)},A,A.exports,a,b,c,e)}return c[d].exports}for(var k="function"==typeof require&&require,f=0;f<e.length;f++)g(e[f]);return g}({1:[function(a,b,c){var e=a("./utils"),g=a("./support");c.encode=function(a){for(var b=[],c,g,A,x,q=0,m=a.length,h,t="string"!==e.getTypeOf(a);q<a.length;)h=m-q,t?(c=a[q++],g=q<m?a[q++]:0,A=q<m?a[q++]:0):(c=a.charCodeAt(q++),g=q<m?a.charCodeAt(q++):0,A=q<m?a.charCodeAt(q++):0),x=c>>2,c=(c&3)<<4|g>>4,g=1<h?(g&
15)<<2|A>>6:64,A=2<h?A&63:64,b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(x)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(A));return b.join("")};c.decode=function(a){var b,c,e,A,x,q=0,m=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");A=3*a.length/4;"="===a.charAt(a.length-1)&&A--;"="===
a.charAt(a.length-2)&&A--;var h;for(h=g.uint8array?new Uint8Array(A):Array(A);q<a.length;)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),b=b<<2|c>>4,c=(c&15)<<4|A>>2,e=(A&3)<<6|
x,h[m++]=b,64!==A&&(h[m++]=c),64!==x&&(h[m++]=e);return h}},{"./support":27,"./utils":29}],2:[function(a,b,c){function e(a,b,c,d,e){this.compressedSize=a;this.uncompressedSize=b;this.crc32=c;this.compression=d;this.compressedContent=e}var g=a("./external"),k=a("./stream/DataWorker"),f=a("./stream/DataLengthProbe"),d=a("./stream/Crc32Probe"),f=a("./stream/DataLengthProbe");e.prototype={getContentWorker:function(){var a=(new k(g.Promise.resolve(this.compressedContent))).pipe(this.compression.uncompressWorker()).pipe(new f("data_length")),
b=this;a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw Error("Bug : uncompressed data size mismatch");});return a},getCompressedWorker:function(){return(new k(g.Promise.resolve(this.compressedContent))).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};e.createWorkerFrom=function(a,b,c){return a.pipe(new d).pipe(new f("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new f("compressedSize")).withStreamInfo("compression",
b)};b.exports=e},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(a,b,c){var e=a("./stream/GenericWorker");c.STORE={magic:"\x00\x00",compressWorker:function(a){return new e("STORE compression")},uncompressWorker:function(){return new e("STORE decompression")}};c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(a,b,c){var e=a("./utils"),g=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var e=0;8>e;e++)a=a&1?3988292384^
a>>>1:a>>>1;b[c]=a}return b}();b.exports=function(a,b){if("undefined"===typeof a||!a.length)return 0;if("string"!==e.getTypeOf(a)){var c,p=0+a.length;c=(b|0)^-1;for(var A=0;A<p;A++)c=c>>>8^g[(c^a[A])&255];return c^-1}p=0+a.length;c=(b|0)^-1;for(A=0;A<p;A++)c=c>>>8^g[(c^a.charCodeAt(A))&255];return c^-1}},{"./utils":29}],5:[function(a,b,c){c.base64=!1;c.binary=!1;c.dir=!1;c.createFolders=!0;c.date=null;c.compression=null;c.compressionOptions=null;c.comment=null;c.unixPermissions=null;c.dosPermissions=
null},{}],6:[function(a,b,c){a=a("es6-promise").Promise;b.exports={Promise:a}},{"es6-promise":37}],7:[function(a,b,c){function e(a,b){f.call(this,"FlateWorker/"+a);this._pako=new g[a]({raw:!0,level:b.level||-1});this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}b="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;var g=a("pako"),k=a("./utils"),f=a("./stream/GenericWorker"),d=b?"uint8array":"array";c.magic="\b\x00";
k.inherits(e,f);e.prototype.processChunk=function(a){this.meta=a.meta;this._pako.push(k.transformTo(d,a.data),!1)};e.prototype.flush=function(){f.prototype.flush.call(this);this._pako.push([],!0)};e.prototype.cleanUp=function(){f.prototype.cleanUp.call(this);this._pako=null};c.compressWorker=function(a){return new e("Deflate",a)};c.uncompressWorker=function(){return new e("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(a,b,c){function e(a,b,c,d){k.call(this,"ZipFileWorker");
this.bytesWritten=0;this.zipComment=b;this.zipPlatform=c;this.encodeFileName=d;this.streamFiles=a;this.accumulate=!1;this.contentBuffer=[];this.dirRecords=[];this.entriesCount=this.currentSourceOffset=0;this.currentFile=null;this._sources=[]}var g=a("../utils"),k=a("../stream/GenericWorker"),f=a("../utf8"),d=a("../crc32"),p=a("../signature"),A=function(a,b){var c="",d;for(d=0;d<b;d++)c+=String.fromCharCode(a&255),a>>>=8;return c},x=function(a,b,c,e,l,k){var q=a.file,x=a.compression,w=k!==f.utf8encode,
L=g.transformTo("string",k(q.name)),I=g.transformTo("string",f.utf8encode(q.name)),E=q.comment;k=g.transformTo("string",k(E));var K=g.transformTo("string",f.utf8encode(E)),H=I.length!==q.name.length,C=K.length!==E.length,D,E="";D=q.dir;var v=q.date,N=0,Q=0,M=0;if(!b||c)N=a.crc32,Q=a.compressedSize,M=a.uncompressedSize;a=0;b&&(a|=8);w||!H&&!C||(a|=2048);b=0;D&&(b|=16);"UNIX"===l?(l=798,(w=q=q.unixPermissions)||(w=D?16893:33204),b|=(w&65535)<<16):(l=20,b|=(q.dosPermissions||0)&63);q=v.getUTCHours();
q=q<<6|v.getUTCMinutes();q=q<<5|v.getUTCSeconds()/2;D=v.getUTCFullYear()-1980;D=D<<4|v.getUTCMonth()+1;D=D<<5|v.getUTCDate();H&&(I=A(1,1)+A(d(L),4)+I,E+="up"+A(I.length,2)+I);C&&(I=A(1,1)+A(d(k),4)+K,E+="uc"+A(I.length,2)+I);I="\n\x00"+A(a,2);I+=x.magic;I+=A(q,2);I+=A(D,2);I+=A(N,4);I+=A(Q,4);I+=A(M,4);I+=A(L.length,2);I+=A(E.length,2);x=p.LOCAL_FILE_HEADER+I+L+E;e=p.CENTRAL_FILE_HEADER+A(l,2)+I+A(k.length,2)+"\x00\x00\x00\x00"+A(b,4)+A(e,4)+L+E+k;return{fileRecord:x,dirRecord:e}},q=function(a){return p.DATA_DESCRIPTOR+
A(a.crc32,4)+A(a.compressedSize,4)+A(a.uncompressedSize,4)};g.inherits(e,k);e.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,k.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))};e.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten;this.currentFile=a.file.name;this.streamFiles&&!a.file.dir?(a=
x(a,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:a.fileRecord,meta:{percent:0}})):this.accumulate=!0};e.prototype.closedSource=function(a){this.accumulate=!1;var b=x(a,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(b.dirRecord);if(this.streamFiles&&!a.file.dir)this.push({data:q(a),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());
this.currentFile=null};e.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var b=this.dirRecords.length,c=this.bytesWritten-a,d=g.transformTo("string",(0,this.encodeFileName)(this.zipComment)),a=p.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+A(b,2)+A(b,2)+A(c,4)+A(a,4)+A(d.length,2)+d;this.push({data:a,meta:{percent:100}})};e.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);
this.isPaused?this.previous.pause():this.previous.resume()};e.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.closedSource(b.previous.streamInfo);b._sources.length?b.prepareNextSource():b.end()});a.on("error",function(a){b.error(a)});return this};e.prototype.resume=function(){if(!k.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&
!this._sources.length&&!this.generatedError)return this.end(),!0};e.prototype.error=function(a){var b=this._sources;if(!k.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(d){}return!0};e.prototype.lock=function(){k.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()};b.exports=e},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(a,b,c){var e=a("../compressions"),g=a("./ZipFileWorker");
c.generateWorker=function(a,b,c){var p=new g(b.streamFiles,c,b.platform,b.encodeFileName),A=0;try{a.forEach(function(a,c){A++;var d=c.options.compression||b.compression,g=e[d];if(!g)throw Error(d+" is not a valid compression method !");var d=c.dir,k=c.date;c._compressWorker(g,c.options.compressionOptions||b.compressionOptions||{}).withStreamInfo("file",{name:a,dir:d,date:k,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(p)}),p.entriesCount=A}catch(x){p.error(x)}return p}},
{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){function e(){if(!(this instanceof e))return new e;if(arguments.length)throw Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var a=new e,b;for(b in this)"function"!==typeof this[b]&&(a[b]=this[b]);return a}}e.prototype=a("./object");e.prototype.loadAsync=a("./load");e.support=a("./support");e.defaults=a("./defaults");
e.loadAsync=function(a,b){return(new e).loadAsync(a,b)};e.external=a("./external");b.exports=e},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(a,b,c){function e(a){return new k.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new p);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var g=a("./utils"),k=a("./external"),f=a("./utf8"),g=a("./utils"),
d=a("./zipEntries"),p=a("./stream/Crc32Probe"),A=a("./nodejsUtils");b.exports=function(a,b){var c=this;b=g.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode});return A.isNode&&A.isStream(a)?k.Promise.reject(Error("JSZip can't accept a stream when loading a zip file.")):g.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new d(b);c.load(a);return c}).then(function(a){var c=[k.Promise.resolve(a)];
a=a.files;if(b.checkCRC32)for(var d=0;d<a.length;d++)c.push(e(a[d]));return k.Promise.all(c)}).then(function(a){a=a.shift();for(var d=a.files,e=0;e<d.length;e++){var f=d[e];c.file(f.fileNameStr,f.decompressed,{binary:!0,optimizedBinaryString:!0,date:f.date,dir:f.dir,comment:f.fileCommentStr.length?f.fileCommentStr:null,unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions,createFolders:b.createFolders})}a.zipComment.length&&(c.comment=a.zipComment);return c})}},{"./external":6,"./nodejsUtils":12,
"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(a,b,c){(function(a){b.exports={isNode:"undefined"!==typeof a,newBuffer:function(b,c){return new a(b,c)},isBuffer:function(b){return a.isBuffer(b)},isStream:function(a){return a&&"function"===typeof a.on&&"function"===typeof a.pause&&"function"===typeof a.resume}}}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{}],13:[function(a,b,c){var e=a("./utf8"),g=a("./utils"),k=a("./stream/GenericWorker"),f=a("./stream/StreamHelper"),
d=a("./defaults"),p=a("./compressedObject"),A=a("./zipObject"),x=a("./generate"),q=a("./nodejsUtils"),m=a("./nodejs/NodejsStreamInputAdapter"),h=function(a,b,c){var e=g.getTypeOf(b),f;c=g.extend(c||{},d);c.date=c.date||new Date;null!==c.compression&&(c.compression=c.compression.toUpperCase());"string"===typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8));c.unixPermissions&&c.unixPermissions&16384&&(c.dir=!0);c.dosPermissions&&c.dosPermissions&16&&(c.dir=!0);c.dir&&(a=t(a));
var h;if(h=c.createFolders)f=a,"/"===f.slice(-1)&&(f=f.substring(0,f.length-1)),h=f.lastIndexOf("/"),h=f=0<h?f.substring(0,h):"";h&&B.call(this,f,!0);c.binary=!("string"===e&&!1===c.binary&&!1===c.base64);if(b instanceof p&&0===b.uncompressedSize||c.dir||!b||0===b.length)c.base64=!1,c.binary=!0,b="",c.compression="STORE";b=b instanceof p||b instanceof k?b:q.isNode&&q.isStream(b)?new m(a,b):g.prepareContent(a,b,c.binary,c.optimizedBinaryString,c.base64);c=new A(a,b,c);this.files[a]=c},t=function(a){"/"!==
a.slice(-1)&&(a+="/");return a},B=function(a,b){b="undefined"!==typeof b?b:d.createFolders;a=t(a);this.files[a]||h.call(this,a,null,{dir:!0,createFolders:b});return this.files[a]};b.exports={load:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],(c=b.slice(this.root.length,b.length))&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=
[];this.forEach(function(c,d){a(c,d)&&b.push(d)});return b},file:function(a,b,c){if(1===arguments.length){if("[object RegExp]"===Object.prototype.toString.call(a)){var d=a;return this.filter(function(a,b){return!b.dir&&d.test(a)})}var e=this.files[this.root+a];return e&&!e.dir?e:null}a=this.root+a;h.call(this,a,b,c);return this},folder:function(a){if(!a)return this;if("[object RegExp]"===Object.prototype.toString.call(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=B.call(this,
this.root+a),c=this.clone();c.root=b.name;return c},remove:function(a){a=this.root+a;var b=this.files[a];b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]);if(b&&!b.dir)delete this.files[a];else for(var b=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),c=0;c<b.length;c++)delete this.files[b[c].name];return this},generate:function(a){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},generateInternalStream:function(a){var b,c={};try{c=g.extend(a||
{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode});c.type=c.type.toLowerCase();c.compression=c.compression.toUpperCase();"binarystring"===c.type&&(c.type="string");if(!c.type)throw Error("No output type specified.");g.checkSupport(c.type);if("darwin"===a.platform||"freebsd"===a.platform||"linux"===a.platform||"sunos"===a.platform)a.platform="UNIX";"win32"===a.platform&&(a.platform="DOS");b=x.generateWorker(this,
c,c.comment||this.comment||"")}catch(d){b=new k("error"),b.error(d)}return new f(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){a=a||{};a.type||(a.type="nodebuffer");return this.generateInternalStream(a).toNodejsStream(b)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,
"./utils":29,"./zipObject":32}],14:[function(a,b,c){function e(a){g.call(this,a);for(var b=0;b<this.data.length;b++)a[b]&=255}var g=a("./DataReader");a("../utils").inherits(e,g);e.prototype.byteAt=function(a){return this.data[this.zero+a]};e.prototype.lastIndexOfSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),e=a.charCodeAt(2);a=a.charCodeAt(3);for(var g=this.length-4;0<=g;--g)if(this.data[g]===b&&this.data[g+1]===c&&this.data[g+2]===e&&this.data[g+3]===a)return g-this.zero;return-1};
e.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),e=a.charCodeAt(2);a=a.charCodeAt(3);var g=this.readData(4);return b===g[0]&&c===g[1]&&e===g[2]&&a===g[3]};e.prototype.readData=function(a){this.checkOffset(a);if(0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./DataReader":15}],15:[function(a,b,c){function e(a){this.data=a;this.length=a.length;this.zero=this.index=0}var g=a("../utils");
e.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||0>a)throw Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?");},setIndex:function(a){this.checkIndex(a);this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b=0,c;this.checkOffset(a);for(c=this.index+a-1;c>=this.index;c--)b=(b<<8)+this.byteAt(c);this.index+=a;return b},readString:function(a){return g.transformTo("string",
this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}};b.exports=e},{"../utils":29}],16:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./Uint8ArrayReader");a("../utils").inherits(e,g);e.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+
a);this.index+=a;return b};b.exports=e},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./DataReader");a("../utils").inherits(e,g);e.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)};e.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero};e.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b};e.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+
this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./DataReader":15}],18:[function(a,b,c){function e(a){g.call(this,a)}var g=a("./ArrayReader");a("../utils").inherits(e,g);e.prototype.readData=function(a){this.checkOffset(a);if(0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};b.exports=e},{"../utils":29,"./ArrayReader":14}],19:[function(a,b,c){var e=a("../utils"),g=a("../support"),k=a("./ArrayReader"),
f=a("./StringReader"),d=a("./NodeBufferReader"),p=a("./Uint8ArrayReader");b.exports=function(a){var b=e.getTypeOf(a);e.checkSupport(b);return"string"!==b||g.uint8array?"nodebuffer"===b?new d(a):g.uint8array?new p(e.transformTo("uint8array",a)):new k(e.transformTo("array",a)):new f(a)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(a,b,c){c.LOCAL_FILE_HEADER="PK\u0003\u0004";c.CENTRAL_FILE_HEADER="PK\u0001\u0002";
c.CENTRAL_DIRECTORY_END="PK\u0005\u0006";c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";c.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";c.DATA_DESCRIPTOR="PK\u0007\b"},{}],21:[function(a,b,c){function e(a){g.call(this,"ConvertWorker to "+a);this.destType=a}var g=a("./GenericWorker"),k=a("../utils");k.inherits(e,g);e.prototype.processChunk=function(a){this.push({data:k.transformTo(this.destType,a.data),meta:a.meta})};b.exports=e},{"../utils":29,"./GenericWorker":25}],22:[function(a,b,c){function e(){g.call(this,
"Crc32Probe")}var g=a("./GenericWorker"),k=a("../crc32");a("../utils").inherits(e,g);e.prototype.processChunk=function(a){this.streamInfo.crc32=k(a.data,this.streamInfo.crc32||0);this.push(a)};b.exports=e},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(a,b,c){function e(a){g.call(this,"DataLengthProbe for "+a);this.propName=a;this.withStreamInfo(a,0)}c=a("../utils");var g=a("./GenericWorker");c.inherits(e,g);e.prototype.processChunk=function(a){a&&(this.streamInfo[this.propName]=
(this.streamInfo[this.propName]||0)+a.data.length);g.prototype.processChunk.call(this,a)};b.exports=e},{"../utils":29,"./GenericWorker":25}],24:[function(a,b,c){function e(a){k.call(this,"DataWorker");var b=this;this.dataIsReady=!1;this.max=this.index=0;this.data=null;this.type="";this._tickScheduled=!1;a.then(function(a){b.dataIsReady=!0;b.data=a;b.max=a&&a.length||0;b.type=g.getTypeOf(a);b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var g=a("../utils"),k=a("./GenericWorker");g.inherits(e,
k);e.prototype.cleanUp=function(){k.prototype.cleanUp.call(this);this.data=null};e.prototype.resume=function(){if(!k.prototype.resume.call(this))return!1;!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,g.delay(this._tickAndRepeat,[],this));return!0};e.prototype._tickAndRepeat=function(){this._tickScheduled=!1;this.isPaused||this.isFinished||(this._tick(),this.isFinished||(g.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))};e.prototype._tick=function(){if(this.isPaused||
this.isFinished)return!1;var a=null,b=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case "string":a=this.data.substring(this.index,b);break;case "uint8array":a=this.data.subarray(this.index,b);break;case "array":case "nodebuffer":a=this.data.slice(this.index,b)}this.index=b;return this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})};b.exports=e},{"../utils":29,"./GenericWorker":25}],25:[function(a,b,c){function e(a){this.name=a||
"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=!0;this.isLocked=this.isFinished=!1;this._listeners={data:[],end:[],error:[]};this.previous=null}e.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){if(this.isFinished)return!1;this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",
a),this.previous&&this.previous.error(a),this.cleanUp());return!0},on:function(a,b){this._listeners[a].push(b);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");
this.streamInfo=a.streamInfo;this.mergeStreamInfo();this.previous=a;var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.end()});a.on("error",function(a){b.error(a)});return this},pause:function(){if(this.isPaused||this.isFinished)return!1;this.isPaused=!0;this.previous&&this.previous.pause();return!0},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;this.generatedError&&(this.error(this.generatedError),a=!0);this.previous&&this.previous.resume();
return!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){this.extraStreamInfo[a]=b;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?
this.previous+" -> "+a:a}};b.exports=e},{}],26:[function(a,b,c){(function(c){function g(a,b){var d,f=0,g;for(d=g=0;d<b.length;d++)g+=b[d].length;switch(a){case "string":return b.join("");case "array":return Array.prototype.concat.apply([],b);case "uint8array":g=new Uint8Array(g);for(d=0;d<b.length;d++)g.set(b[d],f),f+=b[d].length;return g;case "nodebuffer":return c.concat(b);default:throw Error("concat : unsupported type '"+a+"'");}}function k(a,b){return new m.Promise(function(c,e){var f=[],m=a._internalType,
k=a._outputType,w=a._mimeType;a.on("data",function(a,c){f.push(a);b&&b(c)}).on("error",function(a){f=[];e(a)}).on("end",function(){try{var a;a:{var b=g(m,f);switch(k){case "blob":a=d.newBlob(d.transformTo("arraybuffer",b),w);break a;case "base64":a=x.encode(b);break a;default:a=d.transformTo(k,b)}}c(a)}catch(h){e(h)}f=[]}).resume()})}function f(a,b,c){var e=b;switch(b){case "blob":case "arraybuffer":e="uint8array";break;case "base64":e="string"}try{this._internalType=e,this._outputType=b,this._mimeType=
c,d.checkSupport(e),this._worker=a.pipe(new p(e)),a.lock()}catch(f){this._worker=new A("error"),this._worker.error(f)}}var d=a("../utils"),p=a("./ConvertWorker"),A=a("./GenericWorker"),x=a("../base64"),q=a("../nodejs/NodejsStreamOutputAdapter"),m=a("../external");f.prototype={accumulate:function(a){return k(this,a)},on:function(a,b){var c=this;if("data"===a)this._worker.on(a,function(a){b.call(c,a.data,a.meta)});else this._worker.on(a,function(){d.delay(b,arguments,c)});return this},resume:function(){d.delay(this._worker.resume,
[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(a){d.checkSupport("nodestream");if("nodebuffer"!==this._outputType)throw Error(this._outputType+" is not supported by this method");return new q(this,{objectMode:"nodebuffer"!==this._outputType},a)}};b.exports=f}).call(this,"undefined"!==typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],
27:[function(a,b,c){b="undefined"!==typeof Buffer?Buffer:void 0;c.base64=!0;c.array=!0;c.string=!0;c.arraybuffer="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array;c.nodebuffer="undefined"!==typeof b;c.uint8array="undefined"!==typeof Uint8Array;if("undefined"===typeof ArrayBuffer)c.blob=!1;else{b=new ArrayBuffer(0);try{c.blob=0===(new Blob([b],{type:"application/zip"})).size}catch(g){try{var e=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);
e.append(b);c.blob=0===e.getBlob("application/zip").size}catch(k){c.blob=!1}}}c.nodestream=!!a("./nodejs/NodejsStreamOutputAdapter").prototype},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(a,b,c){function e(){p.call(this,"utf-8 decode");this.leftOver=null}function g(){p.call(this,"utf-8 encode")}var k=a("./utils"),f=a("./support"),d=a("./nodejsUtils"),p=a("./stream/GenericWorker"),A=Array(256);for(a=0;256>a;a++)A[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;A[254]=A[254]=1;c.utf8encode=
function(a){if(f.nodebuffer)return d.newBuffer(a,"utf-8");var b,c,e,g,k,l=a.length,p=0;for(g=0;g<l;g++)c=a.charCodeAt(g),55296===(c&64512)&&g+1<l&&(e=a.charCodeAt(g+1),56320===(e&64512)&&(c=65536+(c-55296<<10)+(e-56320),g++)),p+=128>c?1:2048>c?2:65536>c?3:4;b=f.uint8array?new Uint8Array(p):Array(p);for(g=k=0;k<p;g++)c=a.charCodeAt(g),55296===(c&64512)&&g+1<l&&(e=a.charCodeAt(g+1),56320===(e&64512)&&(c=65536+(c-55296<<10)+(e-56320),g++)),128>c?b[k++]=c:(2048>c?b[k++]=192|c>>>6:(65536>c?b[k++]=224|
c>>>12:(b[k++]=240|c>>>18,b[k++]=128|c>>>12&63),b[k++]=128|c>>>6&63),b[k++]=128|c&63);return b};c.utf8decode=function(a){if(f.nodebuffer)return k.transformTo("nodebuffer",a).toString("utf-8");a=k.transformTo(f.uint8array?"uint8array":"array",a);var b,c,d,e,g=a.length,l=Array(2*g);for(b=c=0;b<g;)if(d=a[b++],128>d)l[c++]=d;else if(e=A[d],4<e)l[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;1<e&&b<g;)d=d<<6|a[b++]&63,e--;1<e?l[c++]=65533:65536>d?l[c++]=d:(d-=65536,l[c++]=55296|d>>10&1023,l[c++]=56320|
d&1023)}l.length!==c&&(l.subarray?l=l.subarray(0,c):l.length=c);return k.applyFromCharCode(l)};k.inherits(e,p);e.prototype.processChunk=function(a){var b=k.transformTo(f.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var d=b,b=new Uint8Array(d.length+this.leftOver.length);b.set(this.leftOver,0);b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e,d=b.length;d>b.length&&(d=b.length);for(e=d-1;0<=e&&128===(b[e]&192);)e--;
d=0>e?d:0===e?d:e+A[b[e]]>d?e:d;e=b;d!==b.length&&(f.uint8array?(e=b.subarray(0,d),this.leftOver=b.subarray(d,b.length)):(e=b.slice(0,d),this.leftOver=b.slice(d,b.length)));this.push({data:c.utf8decode(e),meta:a.meta})};e.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};c.Utf8DecodeWorker=e;k.inherits(g,p);g.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})};c.Utf8EncodeWorker=
g},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(a,b,c){function e(a){return a}function g(a,b){for(var c=0;c<a.length;++c)b[c]=a.charCodeAt(c)&255;return b}function k(a){var b=65536,d=c.getTypeOf(a),e=!0;"uint8array"===d?e=t.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=t.applyCanBeUsed.nodebuffer);if(e)for(;1<b;)try{return t.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return t.stringifyByChar(a)}function f(a,b){for(var c=0;c<a.length;c++)b[c]=
a[c];return b}var d=a("./support"),p=a("./base64"),A=a("./nodejsUtils"),x=a("asap"),q=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);e.append(a);return e.getBlob(b)}catch(f){throw Error("Bug : can't construct the Blob.");}}};var m;try{m=d.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(l){m=!1}a=m;var h;
try{h=d.nodebuffer&&1===String.fromCharCode.apply(null,A.newBuffer(1)).length}catch(l){h=!1}var t={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},
applyCanBeUsed:{uint8array:a,nodebuffer:h}};c.applyFromCharCode=k;var B={};B.string={string:e,array:function(a){return g(a,Array(a.length))},arraybuffer:function(a){return B.string.uint8array(a).buffer},uint8array:function(a){return g(a,new Uint8Array(a.length))},nodebuffer:function(a){return g(a,A.newBuffer(a.length))}};B.array={string:k,array:e,arraybuffer:function(a){return(new Uint8Array(a)).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return A.newBuffer(a)}};
B.arraybuffer={string:function(a){return k(new Uint8Array(a))},array:function(a){return f(new Uint8Array(a),Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return A.newBuffer(new Uint8Array(a))}};B.uint8array={string:k,array:function(a){return f(a,Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return A.newBuffer(a)}};B.nodebuffer={string:k,array:function(a){return f(a,Array(a.length))},arraybuffer:function(a){return B.nodebuffer.uint8array(a).buffer},
uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:e};c.transformTo=function(a,b){b||(b="");if(!a)return b;c.checkSupport(a);var d=c.getTypeOf(b);return B[d][a](b)};c.getTypeOf=function(a){if("string"===typeof a)return"string";if("[object Array]"===Object.prototype.toString.call(a))return"array";if(d.nodebuffer&&A.isBuffer(a))return"nodebuffer";if(d.uint8array&&a instanceof Uint8Array)return"uint8array";if(d.arraybuffer&&a instanceof ArrayBuffer)return"arraybuffer"};c.checkSupport=
function(a){if(!d[a.toLowerCase()])throw Error(a+" is not supported by this platform");};c.MAX_VALUE_16BITS=65535;c.MAX_VALUE_32BITS=-1;c.pretty=function(a){var b="",c,d;for(d=0;d<(a||"").length;d++)c=a.charCodeAt(d),b+="\\x"+(16>c?"0":"")+c.toString(16).toUpperCase();return b};c.delay=function(a,b,c){x(function(){a.apply(c||null,b||[])})};c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c};c.extend=function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&
"undefined"===typeof a[c]&&(a[c]=arguments[b][c]);return a};c.prepareContent=function(a,b,e,f,h){var m=null,m=d.blob&&b instanceof Blob&&"undefined"!==typeof FileReader?new q.Promise(function(a,c){var d=new FileReader;d.onload=function(b){a(b.target.result)};d.onerror=function(a){c(a.target.error)};d.readAsArrayBuffer(b)}):q.Promise.resolve(b);return m.then(function(b){var m=c.getTypeOf(b);if(!m)return q.Promise.reject(Error("The data of '"+a+"' is in an unsupported format !"));"arraybuffer"===m?
b=c.transformTo("uint8array",b):"string"===m&&(h?b=p.decode(b):e&&!0!==f&&(m=d.uint8array?new Uint8Array(b.length):Array(b.length),b=g(b,m)));return b})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(a,b,c){function e(a){this.files=[];this.loadOptions=a}var g=a("./reader/readerFor"),k=a("./utils"),f=a("./signature"),d=a("./zipEntry");a("./utf8");var p=a("./support");e.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=
4;var b=this.reader.readString(4);throw Error("Corrupted zip or bug : unexpected signature ("+k.pretty(b)+", expected "+k.pretty(a)+")");}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4)===b;this.reader.setIndex(c);return d},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);
this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),a=k.transformTo(p.uint8array?"uint8array":"array",a);this.zipComment=this.loadOptions.decodeFileName(a)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=
this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};for(var a=this.zip64EndOfCentralSize-44,b,c,d;0<a;)b=this.reader.readInt(2),c=this.reader.readInt(4),d=this.reader.readData(c),this.zip64ExtensibleData[b]={id:b,length:c,value:d}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=
this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(1<this.disksCount)throw Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)a=
new d({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(0>a){if(this.isSignature(0,f.LOCAL_FILE_HEADER))throw Error("Corrupted zip : can't find end of central directory");
throw Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html");}this.reader.setIndex(a);var b=a;this.checkSignature(f.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===k.MAX_VALUE_16BITS||this.diskWithCentralDirStart===k.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===k.MAX_VALUE_16BITS||this.centralDirRecords===k.MAX_VALUE_16BITS||this.centralDirSize===k.MAX_VALUE_32BITS||this.centralDirOffset===
k.MAX_VALUE_32BITS){this.zip64=!0;a=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(0>a)throw Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(a);this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),
0>this.relativeOffsetEndOfZip64CentralDir))throw Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a=a+20+(12+this.zip64EndOfCentralSize));a=b-a;if(0<a)this.isSignature(b,f.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(0>a)throw Error("Corrupted zip: missing "+Math.abs(a)+
" bytes.");},prepareReader:function(a){this.reader=g(a)},load:function(a){this.prepareReader(a);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};b.exports=e},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(a,b,c){function e(a,b){this.options=a;this.loadOptions=b}var g=a("./reader/readerFor"),k=a("./utils"),f=a("./compressedObject"),d=a("./crc32"),p=a("./utf8"),A=a("./compressions"),x=a("./support");e.prototype={isEncrypted:function(){return 1===
(this.bitFlag&1)},useUTF8:function(){return 2048===(this.bitFlag&2048)},readLocalPart:function(a){var b,c;a.skip(22);this.fileNameLength=a.readInt(2);c=a.readInt(2);this.fileName=a.readData(this.fileNameLength);a.skip(c);if(-1===this.compressedSize||-1===this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");a:{c=this.compressionMethod;for(b in A)if(A.hasOwnProperty(b)&&A[b].magic===c){b=
A[b];break a}b=null}if(null===b)throw Error("Corrupted zip : compression "+k.pretty(this.compressionMethod)+" unknown (inner file : "+k.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2);a.skip(2);this.bitFlag=a.readInt(2);this.compressionMethod=a.readString(2);this.date=a.readDate();this.crc32=a.readInt(4);this.compressedSize=a.readInt(4);
this.uncompressedSize=a.readInt(4);var b=a.readInt(2);this.extraFieldsLength=a.readInt(2);this.fileCommentLength=a.readInt(2);this.diskNumberStart=a.readInt(2);this.internalFileAttributes=a.readInt(2);this.externalFileAttributes=a.readInt(4);this.localHeaderOffset=a.readInt(4);if(this.isEncrypted())throw Error("Encrypted zip are not supported");a.skip(b);this.readExtraFields(a);this.parseZIP64ExtraField(a);this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.dosPermissions=
this.unixPermissions=null;var a=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?!0:!1;0===a&&(this.dosPermissions=this.externalFileAttributes&63);3===a&&(this.unixPermissions=this.externalFileAttributes>>16&65535);this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){this.extraFields[1]&&(a=g(this.extraFields[1].value),this.uncompressedSize===k.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===k.MAX_VALUE_32BITS&&(this.compressedSize=
a.readInt(8)),this.localHeaderOffset===k.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===k.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4)))},readExtraFields:function(a){var b=a.index+this.extraFieldsLength,c,d,e;this.extraFields||(this.extraFields={});for(;a.index<b;)c=a.readInt(2),d=a.readInt(2),e=a.readData(d),this.extraFields[c]={id:c,length:d,value:e}},handleUTF8:function(){var a=x.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),
this.fileCommentStr=p.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();null!==b?this.fileNameStr=b:(b=k.transformTo(a,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(b));b=this.findExtraFieldUnicodeComment();null!==b?this.fileCommentStr=b:(a=k.transformTo(a,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(a))}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=g(a.value);return 1!==b.readInt(1)||d(this.fileName)!==
b.readInt(4)?null:p.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=g(a.value);return 1!==b.readInt(1)||d(this.fileComment)!==b.readInt(4)?null:p.utf8decode(b.readData(a.length-5))}return null}};b.exports=e},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(a,b,c){var e=a("./stream/StreamHelper"),g=a("./stream/DataWorker"),k=a("./utf8"),
f=a("./compressedObject"),d=a("./stream/GenericWorker");a=function(a,b,c){this.name=a;this.dir=c.dir;this.date=c.date;this.comment=c.comment;this.unixPermissions=c.unixPermissions;this.dosPermissions=c.dosPermissions;this._data=b;this._dataBinary=c.binary;this.options={compression:c.compression,compressionOptions:c.compressionOptions}};a.prototype={internalStream:function(a){a=a.toLowerCase();var b="string"===a||"text"===a;if("binarystring"===a||"text"===a)a="string";var c=this._decompressWorker(),
d=!this._dataBinary;d&&!b&&(c=c.pipe(new k.Utf8EncodeWorker));!d&&b&&(c=c.pipe(new k.Utf8DecodeWorker));return new e(c,a,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof f&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();this._dataBinary||(c=c.pipe(new k.Utf8EncodeWorker));return f.createWorkerFrom(c,
a,b)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof d?this._data:new g(this._data)}};c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"];for(var p=function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},A=0;A<c.length;A++)a.prototype[c[A]]=p;b.exports=a},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],
33:[function(a,b,c){function e(a){var b;b=f.length?f.pop():new g;b.task=a;k(b)}function g(){this.task=null}var k=a("./raw"),f=[],d=[],p=k.makeRequestCallFromTimer(function(){if(d.length)throw d.shift();});b.exports=e;g.prototype.call=function(){try{this.task.call()}catch(a){if(e.onerror)e.onerror(a);else d.push(a),p()}finally{this.task=null,f[f.length]=this}}},{"./raw":34}],34:[function(a,b,c){(function(a){function c(a){p.length||A();p[p.length]=a}function k(){for(;x<p.length;){var a=x;x+=1;p[a].call();
if(1024<x){for(var a=0,b=p.length-x;a<b;a++)p[a]=p[a+x];p.length-=x;x=0}}x=p.length=0}function f(a){var b=1;a=new q(a);var c=document.createTextNode("");a.observe(c,{characterData:!0});return function(){b=-b;c.data=b}}function d(a){return function(){function b(){clearTimeout(c);clearInterval(d);a()}var c=setTimeout(b,0),d=setInterval(b,50)}}b.exports=c;var p=[],A,x=0,q=a.MutationObserver||a.WebKitMutationObserver;A="function"===typeof q?f(k):d(k);c.requestFlush=A;c.makeRequestCallFromTimer=d}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],35:[function(a,b,c){},{}],36:[function(a,b,c){function e(){p=!1;A.length?d=A.concat(d):x=-1;d.length&&g()}function g(){if(!p){var a=setTimeout(e);p=!0;for(var b=d.length;b;){A=d;for(d=[];++x<b;)A&&A[x].run();x=-1;b=d.length}A=null;p=!1;clearTimeout(a)}}function k(a,b){this.fun=a;this.array=b}function f(){}a=b.exports={};var d=[],p=!1,A,x=-1;a.nextTick=function(a){var b=Array(arguments.length-
1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];d.push(new k(a,b));1!==d.length||p||setTimeout(g,0)};k.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=!0;a.env={};a.argv=[];a.version="";a.versions={};a.on=f;a.addListener=f;a.once=f;a.off=f;a.removeListener=f;a.removeAllListeners=f;a.emit=f;a.binding=function(a){throw Error("process.binding is not supported");};a.cwd=function(){return"/"};a.chdir=function(a){throw Error("process.chdir is not supported");
};a.umask=function(){return 0}},{}],37:[function(a,b,c){(function(c,g){(function(){function k(a){return"function"===typeof a}function f(){return function(){c.nextTick(q)}}function d(){return function(){Q(q)}}function p(){var a=0,b=new P(q),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function A(){var a=new MessageChannel;a.port1.onmessage=q;return function(){a.port2.postMessage(0)}}function x(){return function(){setTimeout(q,1)}}function q(){for(var a=
0;a<N;a+=2)(0,U[a])(U[a+1]),U[a]=void 0,U[a+1]=void 0;N=0}function m(){try{var b=a("vertx");Q=b.runOnLoop||b.runOnContext;return d()}catch(c){return x()}}function h(){}function t(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function B(a,b,c){O(function(a){var d=!1,e=t(c,b,function(c){d||(d=!0,b!==c?u(a,c):G(a,c))},function(b){d||(d=!0,w(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,w(a,e))},a)}function l(a,b){1===b._state?G(a,b._result):2===b._state?w(a,b._result):L(b,void 0,function(b){u(a,
b)},function(b){w(a,b)})}function u(a,b){if(a===b)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof b||"object"===typeof b&&null!==b)if(b.constructor===a.constructor)l(a,b);else{var c;try{c=b.then}catch(d){T.error=d,c=T}c===T?w(a,T.error):void 0===c?G(a,b):k(c)?B(a,b,c):G(a,b)}else G(a,b)}function y(a){a._onerror&&a._onerror(a._result);I(a)}function G(a,b){void 0===a._state&&(a._result=b,a._state=1,0!==a._subscribers.length&&O(I,a))}function w(a,b){void 0===
a._state&&(a._state=2,a._result=b,O(y,a))}function L(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null;e[f]=b;e[f+1]=c;e[f+2]=d;0===f&&a._state&&O(I,a)}function I(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?K(c,d,e,f):e(f);a._subscribers.length=0}}function E(){this.error=null}function K(a,b,c,d){var e=k(c),f,g,h,l;if(e){try{f=c(d)}catch(m){xa.error=m,f=xa}f===xa?(l=!0,g=f.error,f=null):h=!0;if(b===f){w(b,new TypeError("A promises callback cannot return that same promise."));
return}}else f=d,h=!0;void 0===b._state&&(e&&h?u(b,f):l?w(b,g):1===a?G(b,f):2===a&&w(b,f))}function H(a,b){try{b(function(b){u(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function C(a,b){this._instanceConstructor=a;this.promise=new a(h);this._validateInput(b)?(this._input=b,this._remaining=this.length=b.length,this._init(),0===this.length?G(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&G(this.promise,this._result))):w(this.promise,this._validationError())}
function D(a){this._id=la++;this._result=this._state=void 0;this._subscribers=[];if(h!==a){if(!k(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof D))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");H(this,a)}}var v=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},N=0,Q,M,O=function(a,
b){U[N]=a;U[N+1]=b;N+=2;2===N&&(M?M(q):Z())},V="undefined"!==typeof window?window:void 0,X=V||{},P=X.MutationObserver||X.WebKitMutationObserver,X="undefined"!==typeof c&&"[object process]"==={}.toString.call(c),ta="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,U=Array(1E3),Z;Z=X?f():P?p():ta?A():void 0===V&&"function"===typeof a?m():x();var T=new E,xa=new E;C.prototype._validateInput=function(a){return v(a)};C.prototype._validationError=
function(){return Error("Array Methods must be provided an Array")};C.prototype._init=function(){this._result=Array(this.length)};C.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;void 0===b._state&&d<a;d++)this._eachEntry(c[d],d)};C.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a._state?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,
this._result[b]=a)};C.prototype._settledAt=function(a,b,c){var d=this.promise;void 0===d._state&&(this._remaining--,2===a?w(d,c):this._result[b]=c);0===this._remaining&&G(d,this._result)};C.prototype._willSettleAt=function(a,b){var c=this;L(a,void 0,function(a){c._settledAt(1,b,a)},function(a){c._settledAt(2,b,a)})};var la=0;D.all=function(a){return(new C(this,a)).promise};D.race=function(a){function b(a){u(d,a)}function c(a){w(d,a)}var d=new this(h);if(!v(a))return w(d,new TypeError("You must pass an array to race.")),
d;for(var e=a.length,f=0;void 0===d._state&&f<e;f++)L(this.resolve(a[f]),void 0,b,c);return d};D.resolve=function(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(h);u(b,a);return b};D.reject=function(a){var b=new this(h);w(b,a);return b};D._setScheduler=function(a){M=a};D._setAsap=function(a){O=a};D._asap=O;D.prototype={constructor:D,then:function(a,b){var c=this._state;if(1===c&&!a||2===c&&!b)return this;var d=new this.constructor(h),e=this._result;if(c){var f=arguments[c-
1];O(function(){K(c,d,f,e)})}else L(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}};V=function(){var a;if("undefined"!==typeof g)a=g;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(b){throw Error("polyfill failed because global object is unavailable in this environment");}var c=a.Promise;if(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)a.Promise=D};X={Promise:D,polyfill:V};"undefined"!==typeof b&&b.exports?b.exports=
X:"undefined"!==typeof this&&(this.ES6Promise=X);V()}).call(this)}).call(this,a("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{_process:36}],38:[function(a,b,c){c=a("./lib/utils/common").assign;var e=a("./lib/deflate"),g=a("./lib/inflate");a=a("./lib/zlib/constants");var k={};c(k,e,g,a);b.exports=k},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(a,b,c){function e(a){if(!(this instanceof
e))return new e(a);a=this.options=f.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new A;this.strm.avail_out=0;var b=k.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(0!==b)throw Error(p[b]);a.header&&k.deflateSetHeader(this.strm,a.header);if(a.dictionary){a=
"string"===typeof a.dictionary?d.string2buf(a.dictionary):"[object ArrayBuffer]"===x.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary;b=k.deflateSetDictionary(this.strm,a);if(0!==b)throw Error(p[b]);this._dict_set=!0}}function g(a,b){var c=new e(b);c.push(a,!0);if(c.err)throw c.msg;return c.result}var k=a("./zlib/deflate"),f=a("./utils/common"),d=a("./utils/strings"),p=a("./zlib/messages"),A=a("./zlib/zstream"),x=Object.prototype.toString;e.prototype.push=function(a,b){var c=this.strm,
e=this.options.chunkSize,g,l;if(this.ended)return!1;l=b===~~b?b:!0===b?4:0;"string"===typeof a?c.input=d.string2buf(a):"[object ArrayBuffer]"===x.call(a)?c.input=new Uint8Array(a):c.input=a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new f.Buf8(e),c.next_out=0,c.avail_out=e);g=k.deflate(c,l);if(1!==g&&0!==g)return this.onEnd(g),this.ended=!0,!1;if(0===c.avail_out||0===c.avail_in&&(4===l||2===l))if("string"===this.options.to)this.onData(d.buf2binstring(f.shrinkBuf(c.output,
c.next_out)));else this.onData(f.shrinkBuf(c.output,c.next_out))}while((0<c.avail_in||0===c.avail_out)&&1!==g);if(4===l)return g=k.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,0===g;2===l&&(this.onEnd(0),c.avail_out=0);return!0};e.prototype.onData=function(a){this.chunks.push(a)};e.prototype.onEnd=function(a){0===a&&(this.result="string"===this.options.to?this.chunks.join(""):f.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Deflate=e;c.deflate=g;c.deflateRaw=
function(a,b){b=b||{};b.raw=!0;return g(a,b)};c.gzip=function(a,b){b=b||{};b.gzip=!0;return g(a,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(a,b,c){function e(a){if(!(this instanceof e))return new e(a);var b=this.options=f.assign({chunkSize:16384,windowBits:0,to:""},a||{});b.raw&&0<=b.windowBits&&16>b.windowBits&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15));!(0<=b.windowBits&&16>b.windowBits)||a&&a.windowBits||
(b.windowBits+=32);15<b.windowBits&&48>b.windowBits&&0===(b.windowBits&15)&&(b.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new x;this.strm.avail_out=0;a=k.inflateInit2(this.strm,b.windowBits);if(a!==p.Z_OK)throw Error(A[a]);this.header=new q;k.inflateGetHeader(this.strm,this.header)}function g(a,b){var c=new e(b);c.push(a,!0);if(c.err)throw c.msg;return c.result}var k=a("./zlib/inflate"),f=a("./utils/common"),d=a("./utils/strings"),p=a("./zlib/constants"),A=a("./zlib/messages"),
x=a("./zlib/zstream"),q=a("./zlib/gzheader"),m=Object.prototype.toString;e.prototype.push=function(a,b){var c=this.strm,e=this.options.chunkSize,g=this.options.dictionary,q,x,w,A,I,E=!1;if(this.ended)return!1;x=b===~~b?b:!0===b?p.Z_FINISH:p.Z_NO_FLUSH;"string"===typeof a?c.input=d.binstring2buf(a):"[object ArrayBuffer]"===m.call(a)?c.input=new Uint8Array(a):c.input=a;c.next_in=0;c.avail_in=c.input.length;do{0===c.avail_out&&(c.output=new f.Buf8(e),c.next_out=0,c.avail_out=e);q=k.inflate(c,p.Z_NO_FLUSH);
q===p.Z_NEED_DICT&&g&&(q="string"===typeof g?d.string2buf(g):"[object ArrayBuffer]"===m.call(g)?new Uint8Array(g):g,q=k.inflateSetDictionary(this.strm,q));q===p.Z_BUF_ERROR&&!0===E&&(q=p.Z_OK,E=!1);if(q!==p.Z_STREAM_END&&q!==p.Z_OK)return this.onEnd(q),this.ended=!0,!1;if(c.next_out&&(0===c.avail_out||q===p.Z_STREAM_END||0===c.avail_in&&(x===p.Z_FINISH||x===p.Z_SYNC_FLUSH)))if("string"===this.options.to)w=d.utf8border(c.output,c.next_out),A=c.next_out-w,I=d.buf2string(c.output,w),c.next_out=A,c.avail_out=
e-A,A&&f.arraySet(c.output,c.output,w,A,0),this.onData(I);else this.onData(f.shrinkBuf(c.output,c.next_out));0===c.avail_in&&0===c.avail_out&&(E=!0)}while((0<c.avail_in||0===c.avail_out)&&q!==p.Z_STREAM_END);q===p.Z_STREAM_END&&(x=p.Z_FINISH);if(x===p.Z_FINISH)return q=k.inflateEnd(this.strm),this.onEnd(q),this.ended=!0,q===p.Z_OK;x===p.Z_SYNC_FLUSH&&(this.onEnd(p.Z_OK),c.avail_out=0);return!0};e.prototype.onData=function(a){this.chunks.push(a)};e.prototype.onEnd=function(a){a===p.Z_OK&&(this.result=
"string"===this.options.to?this.chunks.join(""):f.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Inflate=e;c.inflate=g;c.inflateRaw=function(a,b){b=b||{};b.raw=!0;return g(a,b)};c.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(a,b,c){a="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=
function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])}}return a};c.shrinkBuf=function(a,b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a};var e={arraySet:function(a,b,c,e,g){if(b.subarray&&a.subarray)a.set(b.subarray(c,c+e),g);else for(var x=0;x<e;x++)a[g+x]=b[c+x]},flattenChunks:function(a){var b,c,e,g,x;b=
e=0;for(c=a.length;b<c;b++)e+=a[b].length;x=new Uint8Array(e);b=e=0;for(c=a.length;b<c;b++)g=a[b],x.set(g,e),e+=g.length;return x}},g={arraySet:function(a,b,c,e,g){for(var x=0;x<e;x++)a[g+x]=b[c+x]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,g))};c.setTyped(a)},{}],42:[function(a,b,c){function e(a,b){if(65537>b&&(a.subarray&&f||!a.subarray&&
k))return String.fromCharCode.apply(null,g.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var g=a("./common"),k=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch(p){k=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(p){f=!1}var d=new g.Buf8(256);for(a=0;256>a;a++)d[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;d[254]=d[254]=1;c.string2buf=function(a){var b,c,d,e,f,k=a.length,B=0;for(e=0;e<k;e++)c=a.charCodeAt(e),55296===(c&64512)&&e+1<k&&(d=a.charCodeAt(e+
1),56320===(d&64512)&&(c=65536+(c-55296<<10)+(d-56320),e++)),B+=128>c?1:2048>c?2:65536>c?3:4;b=new g.Buf8(B);for(e=f=0;f<B;e++)c=a.charCodeAt(e),55296===(c&64512)&&e+1<k&&(d=a.charCodeAt(e+1),56320===(d&64512)&&(c=65536+(c-55296<<10)+(d-56320),e++)),128>c?b[f++]=c:(2048>c?b[f++]=192|c>>>6:(65536>c?b[f++]=224|c>>>12:(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63),b[f++]=128|c>>>6&63),b[f++]=128|c&63);return b};c.buf2binstring=function(a){return e(a,a.length)};c.binstring2buf=function(a){for(var b=new g.Buf8(a.length),
c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b};c.buf2string=function(a,b){var c,f,g,h,k=b||a.length,B=Array(2*k);for(c=f=0;c<k;)if(g=a[c++],128>g)B[f++]=g;else if(h=d[g],4<h)B[f++]=65533,c+=h-1;else{for(g&=2===h?31:3===h?15:7;1<h&&c<k;)g=g<<6|a[c++]&63,h--;1<h?B[f++]=65533:65536>g?B[f++]=g:(g-=65536,B[f++]=55296|g>>10&1023,B[f++]=56320|g&1023)}return e(B,f)};c.utf8border=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);for(c=b-1;0<=c&&128===(a[c]&192);)c--;return 0>c||0===c?b:c+d[a[c]]>
b?c:b}},{"./common":41}],43:[function(a,b,c){b.exports=function(a,b,c,f){var d=a&65535|0;a=a>>>16&65535|0;for(var p;0!==c;){p=2E3<c?2E3:c;c-=p;do d=d+b[f++]|0,a=a+d|0;while(--p);d%=65521;a%=65521}return d|a<<16|0}},{}],44:[function(a,b,c){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,
Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(a,b,c){var e=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}();b.exports=function(a,b,c,d){c=d+c;for(a^=-1;d<c;d++)a=a>>>8^e[(a^b[d])&255];return a^-1}},{}],46:[function(a,b,c){function e(a,b){a.msg=K[b];return b}function g(a){for(var b=a.length;0<=--b;)a[b]=0}function k(a){var b=a.state,c=b.pending;c>a.avail_out&&
(c=a.avail_out);0!==c&&(w.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function f(a,b){L._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,b);a.block_start=a.strstart;k(a.strm)}function d(a,b){a.pending_buf[a.pending++]=b}function p(a,b){a.pending_buf[a.pending++]=b>>>8&255;a.pending_buf[a.pending++]=b&255}function A(a,b){var c=a.max_chain_length,d=
a.strstart,e,f=a.prev_length,g=a.nice_match,h=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,k=a.window,l=a.w_mask,m=a.prev,w=a.strstart+258,p=k[d+f-1],q=k[d+f];a.prev_length>=a.good_match&&(c>>=2);g>a.lookahead&&(g=a.lookahead);do if(e=b,k[e+f]===q&&k[e+f-1]===p&&k[e]===k[d]&&k[++e]===k[d+1]){d+=2;for(e++;k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&k[++d]===k[++e]&&d<w;);e=258-(w-d);d=w-258;if(e>f){a.match_start=b;f=
e;if(e>=g)break;p=k[d+f-1];q=k[d+f]}}while((b=m[b&l])>h&&0!==--c);return f<=a.lookahead?f:a.lookahead}function x(a){var b=a.w_size,c,d,e,f;do{f=a.window_size-a.lookahead-a.strstart;if(a.strstart>=b+(b-262)){w.arraySet(a.window,a.window,b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;c=d=a.hash_size;do e=a.head[--c],a.head[c]=e>=b?e-b:0;while(--d);c=d=b;do e=a.prev[--c],a.prev[c]=e>=b?e-b:0;while(--d);f+=b}if(0===a.strm.avail_in)break;c=a.strm;d=a.window;e=a.strstart+a.lookahead;var g=c.avail_in;
g>f&&(g=f);0===g?d=0:(c.avail_in-=g,w.arraySet(d,c.input,c.next_in,g,e),1===c.state.wrap?c.adler=I(c.adler,d,g,e):2===c.state.wrap&&(c.adler=E(c.adler,d,g,e)),c.next_in+=g,c.total_in+=g,d=g);a.lookahead+=d;if(3<=a.lookahead+a.insert)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&!(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+3-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,3>a.lookahead+a.insert););
}while(262>a.lookahead&&0!==a.strm.avail_in)}function q(a,b){for(var c;;){if(262>a.lookahead){x(a);if(262>a.lookahead&&0===b)return 1;if(0===a.lookahead)break}c=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);0!==c&&a.strstart-c<=a.w_size-262&&(a.match_length=A(a,c));if(3<=a.match_length)if(c=L._tr_tally(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=
a.max_lazy_match&&3<=a.lookahead){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else c=L._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=
2>a.strstart?a.strstart:2;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function m(a,b){for(var c,d;;){if(262>a.lookahead){x(a);if(262>a.lookahead&&0===b)return 1;if(0===a.lookahead)break}c=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);a.prev_length=a.match_length;a.prev_match=a.match_start;a.match_length=2;0!==c&&a.prev_length<a.max_lazy_match&&
a.strstart-c<=a.w_size-262&&(a.match_length=A(a,c),5>=a.match_length&&(1===a.strategy||3===a.match_length&&4096<a.strstart-a.match_start)&&(a.match_length=2));if(3<=a.prev_length&&a.match_length<=a.prev_length){d=a.strstart+a.lookahead-3;c=L._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=d&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);
while(0!==--a.prev_length);a.match_available=0;a.match_length=2;a.strstart++;if(c&&(f(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if((c=L._tr_tally(a,0,a.window[a.strstart-1]))&&f(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}a.match_available&&(L._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0);a.insert=2>a.strstart?a.strstart:2;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===
a.strm.avail_out)?1:2}function h(a,b){for(var c,d,e,g=a.window;;){if(258>=a.lookahead){x(a);if(258>=a.lookahead&&0===b)return 1;if(0===a.lookahead)break}a.match_length=0;if(3<=a.lookahead&&0<a.strstart&&(d=a.strstart-1,c=g[d],c===g[++d]&&c===g[++d]&&c===g[++d])){for(e=a.strstart+258;c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&c===g[++d]&&d<e;);a.match_length=258-(e-d);a.match_length>a.lookahead&&(a.match_length=a.lookahead)}3<=a.match_length?(c=L._tr_tally(a,
1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=L._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++);if(c&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function t(a,b){for(var c;;){if(0===a.lookahead&&(x(a),0===a.lookahead)){if(0===b)return 1;break}a.match_length=0;c=L._tr_tally(a,0,a.window[a.strstart]);a.lookahead--;a.strstart++;if(c&&
(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===b?(f(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(f(a,!1),0===a.strm.avail_out)?1:2}function B(a,b,c,d,e){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d;this.func=e}function l(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=
0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new w.Buf16(1146);this.dyn_dtree=new w.Buf16(122);this.bl_tree=new w.Buf16(78);g(this.dyn_ltree);g(this.dyn_dtree);g(this.bl_tree);this.bl_desc=this.d_desc=
this.l_desc=null;this.bl_count=new w.Buf16(16);this.heap=new w.Buf16(573);g(this.heap);this.heap_max=this.heap_len=0;this.depth=new w.Buf16(573);g(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function u(a){var b;if(!a||!a.state)return e(a,-2);a.total_in=a.total_out=0;a.data_type=2;b=a.state;b.pending=0;b.pending_out=0;0>b.wrap&&(b.wrap=-b.wrap);b.status=b.wrap?42:113;a.adler=2===b.wrap?0:1;b.last_flush=
0;L._tr_init(b);return 0}function y(a){var b=u(a);0===b&&(a=a.state,a.window_size=2*a.w_size,g(a.head),a.max_lazy_match=H[a.level].max_lazy,a.good_match=H[a.level].good_length,a.nice_match=H[a.level].nice_length,a.max_chain_length=H[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0);return b}function G(a,b,c,d,f,g){if(!a)return-2;var h=1;-1===b&&(b=6);0>d?(h=0,d=-d):15<d&&(h=2,d-=16);if(1>f||9<f||8!==c||8>d||15<d||
0>b||9<b||0>g||4<g)return e(a,-2);8===d&&(d=9);var k=new l;a.state=k;k.strm=a;k.wrap=h;k.gzhead=null;k.w_bits=d;k.w_size=1<<k.w_bits;k.w_mask=k.w_size-1;k.hash_bits=f+7;k.hash_size=1<<k.hash_bits;k.hash_mask=k.hash_size-1;k.hash_shift=~~((k.hash_bits+3-1)/3);k.window=new w.Buf8(2*k.w_size);k.head=new w.Buf16(k.hash_size);k.prev=new w.Buf16(k.w_size);k.lit_bufsize=1<<f+6;k.pending_buf_size=4*k.lit_bufsize;k.pending_buf=new w.Buf8(k.pending_buf_size);k.d_buf=k.lit_bufsize>>1;k.l_buf=3*k.lit_bufsize;
k.level=b;k.strategy=g;k.method=c;return y(a)}var w=a("../utils/common"),L=a("./trees"),I=a("./adler32"),E=a("./crc32"),K=a("./messages"),H;H=[new B(0,0,0,0,function(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(1>=a.lookahead){x(a);if(0===a.lookahead&&0===b)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+c;if(0===a.strstart||a.strstart>=d)if(a.lookahead=a.strstart-d,a.strstart=d,f(a,!1),0===a.strm.avail_out)return 1;if(a.strstart-
a.block_start>=a.w_size-262&&(f(a,!1),0===a.strm.avail_out))return 1}a.insert=0;if(4===b)return f(a,!0),0===a.strm.avail_out?3:4;a.strstart>a.block_start&&f(a,!1);return 1}),new B(4,4,8,4,q),new B(4,5,16,8,q),new B(4,6,32,32,q),new B(4,4,16,16,m),new B(8,16,32,32,m),new B(8,16,128,128,m),new B(8,32,128,256,m),new B(32,128,258,1024,m),new B(32,258,258,4096,m)];c.deflateInit=function(a,b){return G(a,b,8,15,8,0)};c.deflateInit2=G;c.deflateReset=y;c.deflateResetKeep=u;c.deflateSetHeader=function(a,b){if(!a||
!a.state||2!==a.state.wrap)return-2;a.state.gzhead=b;return 0};c.deflate=function(a,b){var c,f,l,m;if(!a||!a.state||5<b||0>b)return a?e(a,-2):-2;f=a.state;if(!a.output||!a.input&&0!==a.avail_in||666===f.status&&4!==b)return e(a,0===a.avail_out?-5:-2);f.strm=a;c=f.last_flush;f.last_flush=b;42===f.status&&(2===f.wrap?(a.adler=0,d(f,31),d(f,139),d(f,8),f.gzhead?(d(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),d(f,f.gzhead.time&255),d(f,f.gzhead.time>>
8&255),d(f,f.gzhead.time>>16&255),d(f,f.gzhead.time>>24&255),d(f,9===f.level?2:2<=f.strategy||2>f.level?4:0),d(f,f.gzhead.os&255),f.gzhead.extra&&f.gzhead.extra.length&&(d(f,f.gzhead.extra.length&255),d(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(a.adler=E(a.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(d(f,0),d(f,0),d(f,0),d(f,0),d(f,0),d(f,9===f.level?2:2<=f.strategy||2>f.level?4:0),d(f,3),f.status=113)):(l=8+(f.w_bits-8<<4)<<8,l|=(2<=f.strategy||2>f.level?0:6>f.level?1:6===f.level?
2:3)<<6,0!==f.strstart&&(l|=32),f.status=113,p(f,l+(31-l%31)),0!==f.strstart&&(p(f,a.adler>>>16),p(f,a.adler&65535)),a.adler=1));if(69===f.status)if(f.gzhead.extra){for(l=f.pending;f.gzindex<(f.gzhead.extra.length&65535)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l)),k(a),l=f.pending,f.pending!==f.pending_buf_size));)d(f,f.gzhead.extra[f.gzindex]&255),f.gzindex++;f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-
l,l));f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(73===f.status)if(f.gzhead.name){l=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l)),k(a),l=f.pending,f.pending===f.pending_buf_size)){m=1;break}m=f.gzindex<f.gzhead.name.length?f.gzhead.name.charCodeAt(f.gzindex++)&255:0;d(f,m)}while(0!==m);f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l));0===m&&(f.gzindex=0,
f.status=91)}else f.status=91;if(91===f.status)if(f.gzhead.comment){l=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l)),k(a),l=f.pending,f.pending===f.pending_buf_size)){m=1;break}m=f.gzindex<f.gzhead.comment.length?f.gzhead.comment.charCodeAt(f.gzindex++)&255:0;d(f,m)}while(0!==m);f.gzhead.hcrc&&f.pending>l&&(a.adler=E(a.adler,f.pending_buf,f.pending-l,l));0===m&&(f.status=103)}else f.status=103;103===f.status&&(f.gzhead.hcrc?
(f.pending+2>f.pending_buf_size&&k(a),f.pending+2<=f.pending_buf_size&&(d(f,a.adler&255),d(f,a.adler>>8&255),a.adler=0,f.status=113)):f.status=113);if(0!==f.pending){if(k(a),0===a.avail_out)return f.last_flush=-1,0}else if(0===a.avail_in&&(b<<1)-(4<b?9:0)<=(c<<1)-(4<c?9:0)&&4!==b)return e(a,-5);if(666===f.status&&0!==a.avail_in)return e(a,-5);if(0!==a.avail_in||0!==f.lookahead||0!==b&&666!==f.status){c=2===f.strategy?t(f,b):3===f.strategy?h(f,b):H[f.level].func(f,b);if(3===c||4===c)f.status=666;if(1===
c||3===c)return 0===a.avail_out&&(f.last_flush=-1),0;if(2===c&&(1===b?L._tr_align(f):5!==b&&(L._tr_stored_block(f,0,0,!1),3===b&&(g(f.head),0===f.lookahead&&(f.strstart=0,f.block_start=0,f.insert=0))),k(a),0===a.avail_out))return f.last_flush=-1,0}if(4!==b)return 0;if(0>=f.wrap)return 1;2===f.wrap?(d(f,a.adler&255),d(f,a.adler>>8&255),d(f,a.adler>>16&255),d(f,a.adler>>24&255),d(f,a.total_in&255),d(f,a.total_in>>8&255),d(f,a.total_in>>16&255),d(f,a.total_in>>24&255)):(p(f,a.adler>>>16),p(f,a.adler&
65535));k(a);0<f.wrap&&(f.wrap=-f.wrap);return 0!==f.pending?0:1};c.deflateEnd=function(a){var b;if(!a||!a.state)return-2;b=a.state.status;if(42!==b&&69!==b&&73!==b&&91!==b&&103!==b&&113!==b&&666!==b)return e(a,-2);a.state=null;return 113===b?e(a,-3):0};c.deflateSetDictionary=function(a,b){var c=b.length,d,e,f,h,k,l;if(!a||!a.state)return-2;d=a.state;f=d.wrap;if(2===f||1===f&&42!==d.status||d.lookahead)return-2;1===f&&(a.adler=I(a.adler,b,c,0));d.wrap=0;c>=d.w_size&&(0===f&&(g(d.head),d.strstart=
0,d.block_start=0,d.insert=0),h=new w.Buf8(d.w_size),w.arraySet(h,b,c-d.w_size,d.w_size,0),b=h,c=d.w_size);h=a.avail_in;k=a.next_in;l=a.input;a.avail_in=c;a.next_in=0;a.input=b;for(x(d);3<=d.lookahead;){c=d.strstart;e=d.lookahead-2;do d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+3-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++;while(--e);d.strstart=c;d.lookahead=2;x(d)}d.strstart+=d.lookahead;d.block_start=d.strstart;d.insert=d.lookahead;d.lookahead=0;d.match_length=d.prev_length=
2;d.match_available=0;a.next_in=k;a.input=l;a.avail_in=h;d.wrap=f;return 0};c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(a,b,c){b.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],48:[function(a,b,c){b.exports=function(a,b){var c,f,d,p,A,x,q,m,h,t,B,l,u,y,G,w,L,I,E,K,H,C,D,v;c=a.state;f=a.next_in;D=
a.input;d=f+(a.avail_in-5);p=a.next_out;v=a.output;A=p-(b-a.avail_out);x=p+(a.avail_out-257);q=c.dmax;m=c.wsize;h=c.whave;t=c.wnext;B=c.window;l=c.hold;u=c.bits;y=c.lencode;G=c.distcode;w=(1<<c.lenbits)-1;L=(1<<c.distbits)-1;a:do b:for(15>u&&(l+=D[f++]<<u,u+=8,l+=D[f++]<<u,u+=8),I=y[l&w];;){E=I>>>24;l>>>=E;u-=E;E=I>>>16&255;if(0===E)v[p++]=I&65535;else if(E&16){K=I&65535;if(E&=15)u<E&&(l+=D[f++]<<u,u+=8),K+=l&(1<<E)-1,l>>>=E,u-=E;15>u&&(l+=D[f++]<<u,u+=8,l+=D[f++]<<u,u+=8);I=G[l&L];c:for(;;){E=I>>>
24;l>>>=E;u-=E;E=I>>>16&255;if(E&16){I&=65535;E&=15;u<E&&(l+=D[f++]<<u,u+=8,u<E&&(l+=D[f++]<<u,u+=8));I+=l&(1<<E)-1;if(I>q){a.msg="invalid distance too far back";c.mode=30;break a}l>>>=E;u-=E;E=p-A;if(I>E){E=I-E;if(E>h&&c.sane){a.msg="invalid distance too far back";c.mode=30;break a}H=0;C=B;if(0===t){if(H+=m-E,E<K){K-=E;do v[p++]=B[H++];while(--E);H=p-I;C=v}}else if(t<E){if(H+=m+t-E,E-=t,E<K){K-=E;do v[p++]=B[H++];while(--E);H=0;if(t<K){E=t;K-=E;do v[p++]=B[H++];while(--E);H=p-I;C=v}}}else if(H+=
t-E,E<K){K-=E;do v[p++]=B[H++];while(--E);H=p-I;C=v}for(;2<K;)v[p++]=C[H++],v[p++]=C[H++],v[p++]=C[H++],K-=3;K&&(v[p++]=C[H++],1<K&&(v[p++]=C[H++]))}else{H=p-I;do v[p++]=v[H++],v[p++]=v[H++],v[p++]=v[H++],K-=3;while(2<K);K&&(v[p++]=v[H++],1<K&&(v[p++]=v[H++]))}}else if(0===(E&64)){I=G[(I&65535)+(l&(1<<E)-1)];continue c}else{a.msg="invalid distance code";c.mode=30;break a}break}}else if(0===(E&64)){I=y[(I&65535)+(l&(1<<E)-1)];continue b}else{E&32?c.mode=12:(a.msg="invalid literal/length code",c.mode=
30);break a}break}while(f<d&&p<x);K=u>>3;f-=K;u-=K<<3;a.next_in=f;a.next_out=p;a.avail_in=f<d?5+(d-f):5-(f-d);a.avail_out=p<x?257+(x-p):257-(p-x);c.hold=l&(1<<u)-1;c.bits=u}},{}],49:[function(a,b,c){function e(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function g(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=
this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new x.Buf16(320);this.work=new x.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function k(a){var b;if(!a||!a.state)return-2;b=a.state;a.total_in=a.total_out=b.total=0;a.msg="";b.wrap&&(a.adler=b.wrap&1);b.mode=1;b.last=0;b.havedict=0;b.dmax=32768;b.head=null;b.hold=0;b.bits=0;b.lencode=b.lendyn=new x.Buf32(852);b.distcode=b.distdyn=new x.Buf32(592);
b.sane=1;b.back=-1;return 0}function f(a){var b;if(!a||!a.state)return-2;b=a.state;b.wsize=0;b.whave=0;b.wnext=0;return k(a)}function d(a,b){var c,d;if(!a||!a.state)return-2;d=a.state;0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15));if(b&&(8>b||15<b))return-2;null!==d.window&&d.wbits!==b&&(d.window=null);d.wrap=c;d.wbits=b;return f(a)}function p(a,b){var c;if(!a)return-2;c=new g;a.state=c;c.window=null;c=d(a,b);0!==c&&(a.state=null);return c}function A(a,b,c,d){var e=a.state;null===e.window&&(e.wsize=1<<
e.wbits,e.wnext=0,e.whave=0,e.window=new x.Buf8(e.wsize));d>=e.wsize?(x.arraySet(e.window,b,c-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(a=e.wsize-e.wnext,a>d&&(a=d),x.arraySet(e.window,b,c-d,a,e.wnext),(d-=a)?(x.arraySet(e.window,b,c-d,d,0),e.wnext=d,e.whave=e.wsize):(e.wnext+=a,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=a)));return 0}var x=a("../utils/common"),q=a("./adler32"),m=a("./crc32"),h=a("./inffast"),t=a("./inftrees"),B=!0,l,u;c.inflateReset=f;c.inflateReset2=d;c.inflateResetKeep=
k;c.inflateInit=function(a){return p(a,15)};c.inflateInit2=p;c.inflate=function(a,b){var c,d,f,g,k,p,C,D,v,N,Q,M,O,V,X,P,ta,U,Z=new x.Buf8(4),T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;c=a.state;12===c.mode&&(c.mode=13);k=a.next_out;f=a.output;C=a.avail_out;g=a.next_in;d=a.input;p=a.avail_in;D=c.hold;v=c.bits;N=p;Q=C;U=0;a:for(;;)switch(c.mode){case 1:if(0===c.wrap){c.mode=13;break}for(;16>v;){if(0===p)break a;p--;D+=d[g++]<<v;
v+=8}if(c.wrap&2&&35615===D){c.check=0;Z[0]=D&255;Z[1]=D>>>8&255;c.check=m(c.check,Z,2,0);v=D=0;c.mode=2;break}c.flags=0;c.head&&(c.head.done=!1);if(!(c.wrap&1)||(((D&255)<<8)+(D>>8))%31){a.msg="incorrect header check";c.mode=30;break}if(8!==(D&15)){a.msg="unknown compression method";c.mode=30;break}D>>>=4;v-=4;O=(D&15)+8;if(0===c.wbits)c.wbits=O;else if(O>c.wbits){a.msg="invalid window size";c.mode=30;break}c.dmax=1<<O;a.adler=c.check=1;c.mode=D&512?10:12;v=D=0;break;case 2:for(;16>v;){if(0===p)break a;
p--;D+=d[g++]<<v;v+=8}c.flags=D;if(8!==(c.flags&255)){a.msg="unknown compression method";c.mode=30;break}if(c.flags&57344){a.msg="unknown header flags set";c.mode=30;break}c.head&&(c.head.text=D>>8&1);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,c.check=m(c.check,Z,2,0));v=D=0;c.mode=3;case 3:for(;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.head&&(c.head.time=D);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,Z[2]=D>>>16&255,Z[3]=D>>>24&255,c.check=m(c.check,Z,4,0));v=D=0;c.mode=4;case 4:for(;16>v;){if(0===
p)break a;p--;D+=d[g++]<<v;v+=8}c.head&&(c.head.xflags=D&255,c.head.os=D>>8);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,c.check=m(c.check,Z,2,0));v=D=0;c.mode=5;case 5:if(c.flags&1024){for(;16>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.length=D;c.head&&(c.head.extra_len=D);c.flags&512&&(Z[0]=D&255,Z[1]=D>>>8&255,c.check=m(c.check,Z,2,0));v=D=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(c.flags&1024&&(M=c.length,M>p&&(M=p),M&&(c.head&&(O=c.head.extra_len-c.length,c.head.extra||(c.head.extra=
Array(c.head.extra_len)),x.arraySet(c.head.extra,d,g,M,O)),c.flags&512&&(c.check=m(c.check,d,M,g)),p-=M,g+=M,c.length-=M),c.length))break a;c.length=0;c.mode=7;case 7:if(c.flags&2048){if(0===p)break a;M=0;do O=d[g+M++],c.head&&O&&65536>c.length&&(c.head.name+=String.fromCharCode(O));while(O&&M<p);c.flags&512&&(c.check=m(c.check,d,M,g));p-=M;g+=M;if(O)break a}else c.head&&(c.head.name=null);c.length=0;c.mode=8;case 8:if(c.flags&4096){if(0===p)break a;M=0;do O=d[g+M++],c.head&&O&&65536>c.length&&(c.head.comment+=
String.fromCharCode(O));while(O&&M<p);c.flags&512&&(c.check=m(c.check,d,M,g));p-=M;g+=M;if(O)break a}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(c.flags&512){for(;16>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(D!==(c.check&65535)){a.msg="header crc mismatch";c.mode=30;break}v=D=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0);a.adler=c.check=0;c.mode=12;break;case 10:for(;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}a.adler=c.check=e(D);v=D=0;c.mode=11;case 11:if(0===c.havedict)return a.next_out=
k,a.avail_out=C,a.next_in=g,a.avail_in=p,c.hold=D,c.bits=v,2;a.adler=c.check=1;c.mode=12;case 12:if(5===b||6===b)break a;case 13:if(c.last){D>>>=v&7;v-=v&7;c.mode=27;break}for(;3>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.last=D&1;D>>>=1;--v;switch(D&3){case 0:c.mode=14;break;case 1:M=c;if(B){l=new x.Buf32(512);u=new x.Buf32(32);for(O=0;144>O;)M.lens[O++]=8;for(;256>O;)M.lens[O++]=9;for(;280>O;)M.lens[O++]=7;for(;288>O;)M.lens[O++]=8;t(1,M.lens,0,288,l,0,M.work,{bits:9});for(O=0;32>O;)M.lens[O++]=
5;t(2,M.lens,0,32,u,0,M.work,{bits:5});B=!1}M.lencode=l;M.lenbits=9;M.distcode=u;M.distbits=5;c.mode=20;if(6===b){D>>>=2;v-=2;break a}break;case 2:c.mode=17;break;case 3:a.msg="invalid block type",c.mode=30}D>>>=2;v-=2;break;case 14:D>>>=v&7;for(v-=v&7;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if((D&65535)!==(D>>>16^65535)){a.msg="invalid stored block lengths";c.mode=30;break}c.length=D&65535;v=D=0;c.mode=15;if(6===b)break a;case 15:c.mode=16;case 16:if(M=c.length){M>p&&(M=p);M>C&&(M=C);if(0===
M)break a;x.arraySet(f,d,g,M,k);p-=M;g+=M;C-=M;k+=M;c.length-=M;break}c.mode=12;break;case 17:for(;14>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.nlen=(D&31)+257;D>>>=5;v-=5;c.ndist=(D&31)+1;D>>>=5;v-=5;c.ncode=(D&15)+4;D>>>=4;v-=4;if(286<c.nlen||30<c.ndist){a.msg="too many length or distance symbols";c.mode=30;break}c.have=0;c.mode=18;case 18:for(;c.have<c.ncode;){for(;3>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.lens[T[c.have++]]=D&7;D>>>=3;v-=3}for(;19>c.have;)c.lens[T[c.have++]]=0;c.lencode=
c.lendyn;c.lenbits=7;M={bits:c.lenbits};U=t(0,c.lens,0,19,c.lencode,0,c.work,M);c.lenbits=M.bits;if(U){a.msg="invalid code lengths set";c.mode=30;break}c.have=0;c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;;){X=c.lencode[D&(1<<c.lenbits)-1];M=X>>>24;X&=65535;if(M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(16>X)D>>>=M,v-=M,c.lens[c.have++]=X;else{if(16===X){for(O=M+2;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=M;v-=M;if(0===c.have){a.msg="invalid bit length repeat";c.mode=30;break}O=
c.lens[c.have-1];M=3+(D&3);D>>>=2;v-=2}else if(17===X){for(O=M+3;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=M;v-=M;O=0;M=3+(D&7);D>>>=3;v-=3}else{for(O=M+7;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=M;v-=M;O=0;M=11+(D&127);D>>>=7;v-=7}if(c.have+M>c.nlen+c.ndist){a.msg="invalid bit length repeat";c.mode=30;break}for(;M--;)c.lens[c.have++]=O}}if(30===c.mode)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block";c.mode=30;break}c.lenbits=9;M={bits:c.lenbits};U=t(1,c.lens,
0,c.nlen,c.lencode,0,c.work,M);c.lenbits=M.bits;if(U){a.msg="invalid literal/lengths set";c.mode=30;break}c.distbits=6;c.distcode=c.distdyn;M={bits:c.distbits};U=t(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,M);c.distbits=M.bits;if(U){a.msg="invalid distances set";c.mode=30;break}c.mode=20;if(6===b)break a;case 20:c.mode=21;case 21:if(6<=p&&258<=C){a.next_out=k;a.avail_out=C;a.next_in=g;a.avail_in=p;c.hold=D;c.bits=v;h(a,Q);k=a.next_out;f=a.output;C=a.avail_out;g=a.next_in;d=a.input;p=a.avail_in;
D=c.hold;v=c.bits;12===c.mode&&(c.back=-1);break}for(c.back=0;;){X=c.lencode[D&(1<<c.lenbits)-1];M=X>>>24;O=X>>>16&255;X&=65535;if(M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(O&&0===(O&240)){V=M;P=O;for(ta=X;;){X=c.lencode[ta+((D&(1<<V+P)-1)>>V)];M=X>>>24;O=X>>>16&255;X&=65535;if(V+M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}D>>>=V;v-=V;c.back+=V}D>>>=M;v-=M;c.back+=M;c.length=X;if(0===O){c.mode=26;break}if(O&32){c.back=-1;c.mode=12;break}if(O&64){a.msg="invalid literal/length code";
c.mode=30;break}c.extra=O&15;c.mode=22;case 22:if(c.extra){for(O=c.extra;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.length+=D&(1<<c.extra)-1;D>>>=c.extra;v-=c.extra;c.back+=c.extra}c.was=c.length;c.mode=23;case 23:for(;;){X=c.distcode[D&(1<<c.distbits)-1];M=X>>>24;O=X>>>16&255;X&=65535;if(M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(0===(O&240)){V=M;P=O;for(ta=X;;){X=c.distcode[ta+((D&(1<<V+P)-1)>>V)];M=X>>>24;O=X>>>16&255;X&=65535;if(V+M<=v)break;if(0===p)break a;p--;D+=d[g++]<<v;v+=
8}D>>>=V;v-=V;c.back+=V}D>>>=M;v-=M;c.back+=M;if(O&64){a.msg="invalid distance code";c.mode=30;break}c.offset=X;c.extra=O&15;c.mode=24;case 24:if(c.extra){for(O=c.extra;v<O;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}c.offset+=D&(1<<c.extra)-1;D>>>=c.extra;v-=c.extra;c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back";c.mode=30;break}c.mode=25;case 25:if(0===C)break a;M=Q-C;if(c.offset>M){M=c.offset-M;if(M>c.whave&&c.sane){a.msg="invalid distance too far back";c.mode=30;break}M>
c.wnext?(M-=c.wnext,O=c.wsize-M):O=c.wnext-M;M>c.length&&(M=c.length);V=c.window}else V=f,O=k-c.offset,M=c.length;M>C&&(M=C);C-=M;c.length-=M;do f[k++]=V[O++];while(--M);0===c.length&&(c.mode=21);break;case 26:if(0===C)break a;f[k++]=c.length;C--;c.mode=21;break;case 27:if(c.wrap){for(;32>v;){if(0===p)break a;p--;D|=d[g++]<<v;v+=8}Q-=C;a.total_out+=Q;c.total+=Q;Q&&(a.adler=c.check=c.flags?m(c.check,f,Q,k-Q):q(c.check,f,Q,k-Q));Q=C;if((c.flags?D:e(D))!==c.check){a.msg="incorrect data check";c.mode=
30;break}v=D=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;32>v;){if(0===p)break a;p--;D+=d[g++]<<v;v+=8}if(D!==(c.total&4294967295)){a.msg="incorrect length check";c.mode=30;break}v=D=0}c.mode=29;case 29:U=1;break a;case 30:U=-3;break a;case 31:return-4;default:return-2}a.next_out=k;a.avail_out=C;a.next_in=g;a.avail_in=p;c.hold=D;c.bits=v;if((c.wsize||Q!==a.avail_out&&30>c.mode&&(27>c.mode||4!==b))&&A(a,a.output,a.next_out,Q-a.avail_out))return c.mode=31,-4;N-=a.avail_in;Q-=a.avail_out;a.total_in+=
N;a.total_out+=Q;c.total+=Q;c.wrap&&Q&&(a.adler=c.check=c.flags?m(c.check,f,Q,a.next_out-Q):q(c.check,f,Q,a.next_out-Q));a.data_type=c.bits+(c.last?64:0)+(12===c.mode?128:0)+(20===c.mode||15===c.mode?256:0);(0===N&&0===Q||4===b)&&0===U&&(U=-5);return U};c.inflateEnd=function(a){if(!a||!a.state)return-2;var b=a.state;b.window&&(b.window=null);a.state=null;return 0};c.inflateGetHeader=function(a,b){var c;if(!a||!a.state)return-2;c=a.state;if(0===(c.wrap&2))return-2;c.head=b;b.done=!1;return 0};c.inflateSetDictionary=
function(a,b){var c=b.length,d,e;if(!a||!a.state)return-2;d=a.state;if(0!==d.wrap&&11!==d.mode)return-2;if(11===d.mode&&(e=q(1,b,c,0),e!==d.check))return-3;if(A(a,b,c,c))return d.mode=31,-4;d.havedict=1;return 0};c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(a,b,c){var e=a("../utils/common"),g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[16,16,16,
16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,q,m,h,t,B){var l=B.bits,u,y,G,w,L,I,E,K,H,C,D,v,N,Q=0,M,O=new e.Buf16(16);L=new e.Buf16(16);var V,X=0,P,ta,U;for(u=0;15>=u;u++)O[u]=0;for(y=0;y<q;y++)O[b[c+y]]++;w=l;for(G=
15;1<=G&&0===O[G];G--);w>G&&(w=G);if(0===G)return m[h++]=20971520,m[h++]=20971520,B.bits=1,0;for(l=1;l<G&&0===O[l];l++);w<l&&(w=l);for(u=I=1;15>=u;u++)if(I<<=1,I-=O[u],0>I)return-1;if(0<I&&(0===a||1!==G))return-1;L[1]=0;for(u=1;15>u;u++)L[u+1]=L[u]+O[u];for(y=0;y<q;y++)0!==b[c+y]&&(t[L[b[c+y]]++]=y);0===a?(N=V=t,M=19):1===a?(N=g,Q-=257,V=k,X-=257,M=256):(N=f,V=d,M=-1);y=K=0;u=l;v=h;q=w;L=0;C=-1;E=1<<w;D=E-1;if(1===a&&852<E||2===a&&592<E)return 1;for(var Z=0;;){Z++;P=u-L;t[y]<M?(ta=0,U=t[y]):t[y]>
M?(ta=V[X+t[y]],U=N[Q+t[y]]):(ta=96,U=0);I=1<<u-L;l=H=1<<q;do H-=I,m[v+(K>>L)+H]=P<<24|ta<<16|U|0;while(0!==H);for(I=1<<u-1;K&I;)I>>=1;0!==I?(K&=I-1,K+=I):K=0;y++;if(0===--O[u]){if(u===G)break;u=b[c+t[y]]}if(u>w&&(K&D)!==C){0===L&&(L=w);v+=l;q=u-L;for(I=1<<q;q+L<G;){I-=O[q+L];if(0>=I)break;q++;I<<=1}E+=1<<q;if(1===a&&852<E||2===a&&592<E)return 1;C=K&D;m[C]=w<<24|q<<16|v-h|0}}0!==K&&(m[v+K]=u-L<<24|4194304);B.bits=w;return 0}},{"../utils/common":41}],51:[function(a,b,c){b.exports={2:"need dictionary",
1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(a,b,c){function e(a){for(var b=a.length;0<=--b;)a[b]=0}function g(a,b,c,d,e){this.static_tree=a;this.extra_bits=b;this.extra_base=c;this.elems=d;this.max_length=e;this.has_stree=a&&a.length}function k(a,b){this.dyn_tree=a;this.max_code=0;this.stat_desc=b}function f(a,b){a.pending_buf[a.pending++]=b&255;a.pending_buf[a.pending++]=
b>>>8&255}function d(a,b,c){a.bi_valid>16-c?(a.bi_buf|=b<<a.bi_valid&65535,f(a,a.bi_buf),a.bi_buf=b>>16-a.bi_valid,a.bi_valid+=c-16):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function p(a,b,c){d(a,c[2*b],c[2*b+1])}function A(a,b){var c=0;do c|=a&1,a>>>=1,c<<=1;while(0<--b);return c>>>1}function x(a,b,c){var d=Array(16),e=0,f;for(f=1;15>=f;f++)d[f]=e=e+c[f-1]<<1;for(c=0;c<=b;c++)e=a[2*c+1],0!==e&&(a[2*c]=A(d[e]++,e))}function q(a){var b;for(b=0;286>b;b++)a.dyn_ltree[2*b]=0;for(b=0;30>b;b++)a.dyn_dtree[2*
b]=0;for(b=0;19>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function m(a){8<a.bi_valid?f(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function h(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len;){e<a.heap_len&&h(b,a.heap[e+1],a.heap[e],a.depth)&&e++;if(h(b,d,a.heap[e],a.depth))break;a.heap[c]=a.heap[e];c=e;e<<=1}a.heap[c]=d}function B(a,
b,c){var e,f,g=0,h,k;if(0!==a.last_lit){do e=a.pending_buf[a.d_buf+2*g]<<8|a.pending_buf[a.d_buf+2*g+1],f=a.pending_buf[a.l_buf+g],g++,0===e?p(a,f,b):(h=N[f],p(a,h+256+1,b),k=I[h],0!==k&&(f-=Q[h],d(a,f,k)),e--,h=256>e?v[e]:v[256+(e>>>7)],p(a,h,c),k=E[h],0!==k&&(e-=M[h],d(a,e,k)));while(g<a.last_lit)}p(a,256,b)}function l(a,b){var c=b.dyn_tree,d=b.stat_desc.static_tree,e=b.stat_desc.has_stree,f=b.stat_desc.elems,g,h=-1,k;a.heap_len=0;a.heap_max=573;for(g=0;g<f;g++)0!==c[2*g]?(a.heap[++a.heap_len]=
h=g,a.depth[g]=0):c[2*g+1]=0;for(;2>a.heap_len;)k=a.heap[++a.heap_len]=2>h?++h:0,c[2*k]=1,a.depth[k]=0,a.opt_len--,e&&(a.static_len-=d[2*k+1]);b.max_code=h;for(g=a.heap_len>>1;1<=g;g--)t(a,c,g);k=f;do g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,c,1),d=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=d,c[2*k]=c[2*g]+c[2*d],a.depth[k]=(a.depth[g]>=a.depth[d]?a.depth[g]:a.depth[d])+1,c[2*g+1]=c[2*d+1]=k,a.heap[1]=k++,t(a,c,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];g=b.dyn_tree;k=
b.max_code;for(var l=b.stat_desc.static_tree,m=b.stat_desc.has_stree,p=b.stat_desc.extra_bits,q=b.stat_desc.extra_base,u=b.stat_desc.max_length,v,w,y=0,f=0;15>=f;f++)a.bl_count[f]=0;g[2*a.heap[a.heap_max]+1]=0;for(d=a.heap_max+1;573>d;d++)e=a.heap[d],f=g[2*g[2*e+1]+1]+1,f>u&&(f=u,y++),g[2*e+1]=f,e>k||(a.bl_count[f]++,v=0,e>=q&&(v=p[e-q]),w=g[2*e],a.opt_len+=w*(f+v),m&&(a.static_len+=w*(l[2*e+1]+v)));if(0!==y){do{for(f=u-1;0===a.bl_count[f];)f--;a.bl_count[f]--;a.bl_count[f+1]+=2;a.bl_count[u]--;y-=
2}while(0<y);for(f=u;0!==f;f--)for(e=a.bl_count[f];0!==e;)l=a.heap[--d],l>k||(g[2*l+1]!==f&&(a.opt_len+=(f-g[2*l+1])*g[2*l],g[2*l+1]=f),e--)}x(c,h,a.bl_count)}function u(a,b,c){var d,e=-1,f,g=b[1],h=0,k=7,l=4;0===g&&(k=138,l=3);b[2*(c+1)+1]=65535;for(d=0;d<=c;d++)f=g,g=b[2*(d+1)+1],++h<k&&f===g||(h<l?a.bl_tree[2*f]+=h:0!==f?(f!==e&&a.bl_tree[2*f]++,a.bl_tree[32]++):10>=h?a.bl_tree[34]++:a.bl_tree[36]++,h=0,e=f,0===g?(k=138,l=3):f===g?(k=6,l=3):(k=7,l=4))}function y(a,b,c){var e,f=-1,g,h=b[1],k=0,
l=7,m=4;0===h&&(l=138,m=3);for(e=0;e<=c;e++)if(g=h,h=b[2*(e+1)+1],!(++k<l&&g===h)){if(k<m){do p(a,g,a.bl_tree);while(0!==--k)}else 0!==g?(g!==f&&(p(a,g,a.bl_tree),k--),p(a,16,a.bl_tree),d(a,k-3,2)):10>=k?(p(a,17,a.bl_tree),d(a,k-3,3)):(p(a,18,a.bl_tree),d(a,k-11,7));k=0;f=g;0===h?(l=138,m=3):g===h?(l=6,m=3):(l=7,m=4)}}function G(a){var b=4093624447,c;for(c=0;31>=c;c++,b>>>=1)if(b&1&&0!==a.dyn_ltree[2*c])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(c=32;256>
c;c++)if(0!==a.dyn_ltree[2*c])return 1;return 0}function w(a,b,c,e){d(a,0+(e?1:0),3);m(a);f(a,c);f(a,~c);L.arraySet(a.pending_buf,a.window,b,c,a.pending);a.pending+=c}var L=a("../utils/common"),I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=Array(576);e(C);var D=Array(60);e(D);var v=Array(512);e(v);var N=Array(256);e(N);
var Q=Array(29);e(Q);var M=Array(30);e(M);var O,V,X,P=!1;c._tr_init=function(a){if(!P){var b,c,d,e=Array(16);for(d=c=0;28>d;d++)for(Q[d]=c,b=0;b<1<<I[d];b++)N[c++]=d;N[c-1]=d;for(d=c=0;16>d;d++)for(M[d]=c,b=0;b<1<<E[d];b++)v[c++]=d;for(c>>=7;30>d;d++)for(M[d]=c<<7,b=0;b<1<<E[d]-7;b++)v[256+c++]=d;for(b=0;15>=b;b++)e[b]=0;for(b=0;143>=b;)C[2*b+1]=8,b++,e[8]++;for(;255>=b;)C[2*b+1]=9,b++,e[9]++;for(;279>=b;)C[2*b+1]=7,b++,e[7]++;for(;287>=b;)C[2*b+1]=8,b++,e[8]++;x(C,287,e);for(b=0;30>b;b++)D[2*b+1]=
5,D[2*b]=A(b,5);O=new g(C,I,257,286,15);V=new g(D,E,0,30,15);X=new g([],K,0,19,7);P=!0}a.l_desc=new k(a.dyn_ltree,O);a.d_desc=new k(a.dyn_dtree,V);a.bl_desc=new k(a.bl_tree,X);a.bi_buf=0;a.bi_valid=0;q(a)};c._tr_stored_block=w;c._tr_flush_block=function(a,b,c,e){var f,g,h=0;if(0<a.level){2===a.strm.data_type&&(a.strm.data_type=G(a));l(a,a.l_desc);l(a,a.d_desc);u(a,a.dyn_ltree,a.l_desc.max_code);u(a,a.dyn_dtree,a.d_desc.max_code);l(a,a.bl_desc);for(h=18;3<=h&&0===a.bl_tree[2*H[h]+1];h--);a.opt_len+=
3*(h+1)+14;f=a.opt_len+3+7>>>3;g=a.static_len+3+7>>>3;g<=f&&(f=g)}else f=g=c+5;if(c+4<=f&&-1!==b)w(a,b,c,e);else if(4===a.strategy||g===f)d(a,2+(e?1:0),3),B(a,C,D);else{d(a,4+(e?1:0),3);b=a.l_desc.max_code+1;c=a.d_desc.max_code+1;h+=1;d(a,b-257,5);d(a,c-1,5);d(a,h-4,4);for(f=0;f<h;f++)d(a,a.bl_tree[2*H[f]+1],3);y(a,a.dyn_ltree,b-1);y(a,a.dyn_dtree,c-1);B(a,a.dyn_ltree,a.dyn_dtree)}q(a);e&&m(a)};c._tr_tally=function(a,b,c){a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255;a.pending_buf[a.d_buf+2*a.last_lit+
1]=b&255;a.pending_buf[a.l_buf+a.last_lit]=c&255;a.last_lit++;0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(N[c]+256+1)]++,a.dyn_dtree[2*(256>b?v[b]:v[256+(b>>>7)])]++);return a.last_lit===a.lit_bufsize-1};c._tr_align=function(a){d(a,2,3);p(a,256,C);16===a.bi_valid?(f(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}},{"../utils/common":41}],53:[function(a,b,c){b.exports=function(){this.input=null;this.total_in=this.avail_in=
this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[10])(10)});
