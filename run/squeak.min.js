"use strict";window.module=function(t){if(""==t)return window;var i=t.split("."),r=i.pop(),n=module(i.join(".")),e=n[r];return e||(n[r]=e={loaded:!1,pending:[],requires:function(t){return{toRun:function(r){function i(){r(),e.loaded=!0,e.pending.forEach(function(e){e()})}t&&!module(t).loaded?module(t).pending.push(i):i()}}}}),e},Object.subclass=function(r){for(var t=r.split("."),n=t.pop(),i=function(){return this.initialize&&this.initialize.apply(this,arguments),this},e=1;e<arguments.length;e++)for(name in arguments[e])i.prototype[name]=arguments[e][name];module(t.join("."))[n]=i},Object.extend=function(t){for(var e=1;e<arguments.length;e++)for(name in arguments[e])t[name]=arguments[e][name]},function(){var e=document.getElementsByTagName("script"),t=e[e.length-1],i=t.src.replace(/[^\/]*$/,"");t.src.match(/squeak\.min\.js$/)||["vm.js","jit.js","plugins/ADPCMCodecPlugin.js","plugins/B2DPlugin.js","plugins/BitBltPlugin.js","plugins/FFTPlugin.js","plugins/FloatArrayPlugin.js","plugins/GeniePlugin.js","plugins/JPEGReaderPlugin.js","plugins/KedamaPlugin.js","plugins/KedamaPlugin2.js","plugins/Klatt.js","plugins/LargeIntegers.js","plugins/Matrix2x3Plugin.js","plugins/MiscPrimitivePlugin.js","plugins/ScratchPlugin.js","plugins/SoundGenerationPlugin.js","plugins/StarSqueakPlugin.js","plugins/ZipPlugin.js","lib/lz-string.js"].forEach(function(t){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",i+t),document.getElementsByTagName("head")[0].appendChild(e)})}(),module("SqueakJS").requires("users.bert.SqueakJS.vm").toRun(function(){function p(i,l,e){function a(r){i.fullscreen=r,t.style.background=r?"black":"",e.header&&(e.header.style.display=r?"none":""),e.footer&&(e.footer.style.display=r?"none":""),e.fullscreenCheckbox&&(e.fullscreenCheckbox.checked=r),setTimeout(window.onresize,0)}var t=l.parentElement,o="fullscreenchange",n="fullscreenElement",u="fullscreenEnabled";t.requestFullscreen||[{req:t.webkitRequestFullscreen,exit:document.webkitExitFullscreen,evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:t.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:t.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(e){e.req&&(t.requestFullscreen=e.req,document.exitFullscreen=e.exit,o=e.evt,n=e.elem,u=e.enable)});var r;if(t.requestFullscreen)document.addEventListener(o,function(){a(t==document[n])}),r=function(){document[u]&&t==document[n]!=i.fullscreen&&(i.fullscreen?t.requestFullscreen():document.exitFullscreen())};else{var s=!1;r=function(){(e.header||e.footer)&&s!=i.fullscreen&&(s=i.fullscreen,a(s))}}return e.fullscreenCheckbox&&(e.fullscreenCheckbox.onclick=function(){i.fullscreen=e.fullscreenCheckbox.checked,r()}),r}function l(e){if(e.swapCheckbox){var i=localStorage.squeakImageName||"default",t=JSON.parse(localStorage["squeakSettings:"+i]||"{}");"swapButtons"in t&&(e.swapButtons=t.swapButtons),e.swapCheckbox.checked=e.swapButtons,e.swapCheckbox.onclick=function(){e.swapButtons=e.swapCheckbox.checked,t.swapButtons=e.swapButtons,localStorage["squeakSettings:"+i]=JSON.stringify(t)}}}function i(e,t){var i=(e.shiftKey?Squeak.Keyboard_Shift:0)+(e.ctrlKey?Squeak.Keyboard_Ctrl:0)+(e.altKey||e.metaKey?Squeak.Keyboard_Cmd:0);return t.buttons=t.buttons&~Squeak.Keyboard_All|i,i}function o(i,t,e){e.cursorCanvas.style.left=i.pageX+e.cursorOffsetX+"px",e.cursorCanvas.style.top=i.pageY+e.cursorOffsetY+"px";var r=(i.pageX-t.offsetLeft)*(t.width/t.offsetWidth)|0,n=(i.pageY-t.offsetTop)*(t.height/t.offsetHeight)|0;e.mouseX=Math.max(0,Math.min(e.width,r)),e.mouseY=Math.max(0,Math.min(e.height,n))}function e(n,r,a,e,s,u){if("touchend"!=n&&o(r,a,e),e.vm){var t=e.buttons&Squeak.Mouse_All;switch(n){case"mousedown":case"touchstart":switch(r.button||0){case 0:t=Squeak.Mouse_Red;break;case 1:t=Squeak.Mouse_Yellow;break;case 2:t=Squeak.Mouse_Blue}u.swapButtons&&(t==Squeak.Mouse_Yellow?t=Squeak.Mouse_Blue:t==Squeak.Mouse_Blue&&(t=Squeak.Mouse_Yellow));break;case"mousemove":case"touchmove":break;case"mouseup":case"touchend":t=0}e.buttons=t|i(r,e),s&&(s.push([Squeak.EventTypeMouse,r.timeStamp,e.mouseX,e.mouseY,e.buttons&Squeak.Mouse_All,e.buttons>>3]),e.signalInputEvent&&e.signalInputEvent()),e.idle=0,"mouseup"==n?e.runFor&&e.runFor(100):e.runNow&&e.runNow()}}function r(t,n,e,i){if(e.vm){var r=e.buttons>>3<<8|t;r===e.vm.interruptKeycode?e.vm.interruptPending=!0:i?(i.push([Squeak.EventTypeKeyboard,n,t,Squeak.EventKeyChar,e.buttons>>3,0]),e.signalInputEvent&&e.signalInputEvent()):e.keys.push(r),e.idle=0,e.runNow&&e.runNow()}}function n(r,t,n,e,i){e.vm&&i&&(o(t,n,e),i.push([Squeak.EventTypeDragDropFiles,t.timeStamp,r,e.mouseX,e.mouseY,e.buttons>>3,e.droppedFiles.length]),e.signalInputEvent&&e.signalInputEvent())}function u(t,i,e,n){e.buttons&=~Squeak.Keyboard_All,e.buttons|=Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl,e.keys=[],r(t,i,e,n)}function m(e,i,r){i[0]=e[0],i[1]=e[1]-r&Squeak.MillisecondClockMask;for(var t=2;t<e.length;t++)i[t]=e[t]}function d(s,a){function c(t){for(var e=0;e<t.dataTransfer.types.length;e++)if("Files"==t.dataTransfer.types[e])return!0;return!1}a=a||{},a.fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor="black",a.header&&(a.header.style.display="none"),a.footer&&(a.footer.style.display="none"));var t={context:s.getContext("2d"),fullscreen:!1,width:0,height:0,mouseX:0,mouseY:0,buttons:0,keys:[],clipboardString:"",clipboardStringChanged:!1,cursorCanvas:document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null};l(a);var o=null;t.reset=function(){o=null,t.signalInputEvent=null,t.lastTick=0,t.getNextEvent=function(e,i){o=[],t.getNextEvent=function(e,i){var t=o.shift();t?m(t,e,i):e[0]=Squeak.EventTypeNone},t.getNextEvent(e,i)}},t.reset();var f=p(t,s,a);return t.fullscreenRequest=function(e,i){t.fullscreen!=e?(t.fullscreen=e,t.resizeTodo=i,t.resizeTodoTimeout=setTimeout(t.resizeDone,1e3),f()):i()},t.resizeDone=function(){clearTimeout(t.resizeTodoTimeout);var e=t.resizeTodo;e&&(t.resizeTodo=null,e())},t.clear=function(){s.width=s.width},t.showBanner=function(r,i){i=i||{};var e=t.context;e.clearRect(0,0,s.width,s.height),e.fillStyle=i.color||"#F90",e.font=i.font||"bold 48px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(r,s.width/2,s.height/2)},t.showProgress=function(u,i){i=i||{};var e=t.context,r=s.width/3|0,n=24,a=.5*s.width-r/2,o=.5*s.height+2*n;e.fillStyle=i.background||"#000",e.fillRect(a,o,r,n),e.lineWidth=2,e.strokeStyle=i.color||"#F90",e.strokeRect(a,o,r,n),e.fillStyle=i.color||"#F90",e.fillRect(a,o,r*u,n)},s.onmousedown=function(i){return f(),e("mousedown",i,s,t,o,a),i.preventDefault(),!1},s.onmouseup=function(i){e("mouseup",i,s,t,o,a),f(),i.preventDefault()},s.onmousemove=function(i){e("mousemove",i,s,t,o,a),i.preventDefault()},s.oncontextmenu=function(){return!1},s.ontouchstart=function(i){i.touches[0].timeStamp=i.timeStamp,e("touchstart",i.touches[0],s,t,o,a),t.runNow&&t.runNow(),i.preventDefault()},s.ontouchmove=function(i){i.touches[0].timeStamp=i.timeStamp,e("touchmove",i.touches[0],s,t,o,a),t.runNow&&t.runNow(),i.preventDefault()},s.ontouchend=function(i){e("touchend",i,s,t,o,a),t.runNow&&t.runNow(),i.preventDefault()},s.ontouchcancel=function(e){s.ontouchend(e)},t.cursorCanvas.style.display="block",t.cursorCanvas.style.position="absolute",t.cursorCanvas.style.cursor="none",t.cursorCanvas.style.background="transparent",["onmousedown","onmouseup","onmousemove","oncontextmenu","ontouchstart","ontouchmove","ontouchend","ontouchcancel"].forEach(function(e){t.cursorCanvas[e]=s[e]}),s.parentElement.appendChild(t.cursorCanvas),s.style.cursor="none",document.onkeypress=function(e){return t.vm?/[CXVR]/.test(String.fromCharCode(e.charCode+64))?!0:(i(e,t),r(e.charCode,e.timeStamp,t,o),void e.preventDefault()):!0},document.onkeydown=function(e){if(f(),!t.vm)return!0;i(e,t);var s={8:8,9:9,13:13,27:27,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[e.keyCode];if(s)return r(s,e.timeStamp,t,o),e.preventDefault();if(e.metaKey||e.altKey){var n=e.key;if(!n&&e.keyIdentifier&&"U+"==e.keyIdentifier.slice(0,2)&&(n=String.fromCharCode(parseInt(e.keyIdentifier.slice(2),16))),n&&1==n.length){if(/[CXVR]/i.test(n))return!0;var a=n.charCodeAt(0);return/[A-Z]/.test(n)&&!e.shiftKey&&(a+=32),r(a,e.timeStamp,t,o),e.preventDefault()}}},document.onkeyup=function(e){return t.vm?void i(e,t):!0},document.oncopy=function(e,i){if(!t.vm)return!0;t.clipboardStringChanged=!1,u((i||"c").charCodeAt(0),e.timeStamp,t,o);for(var r=Date.now();!t.clipboardStringChanged&&Date.now()-r<500;)t.vm.interpret(20);if(t.clipboardStringChanged){try{e.clipboardData.setData("Text",t.clipboardString)}catch(n){alert("copy error "+n)}e.preventDefault()}},document.oncut=function(e){return t.vm?void document.oncopy(e,"x"):!0},document.onpaste=function(e){if(!t.vm)return!0;try{t.clipboardString=e.clipboardData.getData("Text"),u("v".charCodeAt(0),e.timeStamp,t,o)}catch(i){alert("paste error "+i)}e.preventDefault()},document.body.ondragover=function(e){return e.preventDefault(),c(e)?(e.dataTransfer.dropEffect="copy",n(Squeak.EventDragMove,e,s,t,o),!1):e.dataTransfer.dropEffect="none"},document.body.ondragenter=function(e){c(e)&&n(Squeak.EventDragEnter,e,s,t,o)},document.body.ondragleave=function(e){c(e)&&n(Squeak.EventDragLeave,e,s,t,o)},document.body.ondrop=function(e){if(e.preventDefault(),!c(e))return!1;var i,u=[].slice.call(e.dataTransfer.files),l=[],r=null;return t.droppedFiles=[],u.forEach(function(c){t.droppedFiles.push(c.name);var f=new FileReader;f.onload=function(){var f=this.result;Squeak.filePut(c.name,f),l.push(c.name),i||!/.*image$/.test(c.name)||t.vm&&!confirm("Run "+c.name+" now?\n(cancel to use as file)")||(i=f,r=c.name),l.length==u.length&&(i?(SqueakJS.appName=r.slice(0,-6),SqueakJS.runImage(i,r,t,a)):n(Squeak.EventDragDrop,e,s,t,o))},f.readAsArrayBuffer(c)}),!1},window.onresize=function(){var m=window.innerWidth,f=window.innerHeight;if(setTimeout(function(){m==window.innerWidth&&f==window.innerHeight&&t.resizeDone()},300),!(a.header&&a.footer||a.fullscreen))return t.width=s.width,void(t.height=s.height);var u=a.fullscreen||t.fullscreen,h=0,c=u?0:a.header.offsetTop+a.header.offsetHeight,i=window.innerWidth,e=u?window.innerHeight:Math.max(100,a.footer.offsetTop-c),o=0,n=0;if(a.fixedWidth){t.width=a.fixedWidth,t.height=a.fixedHeight;var r=t.width/t.height,p=i/e;p>r?o=i-Math.floor(e*r):n=e-Math.floor(i/r)}else t.width=i,t.height=e;if(s.style.left=h+Math.floor(o/2)+"px",s.style.top=c+Math.floor(n/2)+"px",s.style.width=i-o+"px",s.style.height=e-n+"px",s.width!=t.width||s.height!=t.height){var d=a.fixedWidth||!t.resizeTodo,l=d&&t.context.getImageData(0,0,s.width,s.height);s.width=t.width,s.height=t.height,l&&t.context.putImageData(l,0,0)}},window.onresize(),t}function c(t,i){var e=i.spinner;return e?(e.onmousedown=function(){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(t.interruptPending=!0)},e.style):null}function f(e,r,i,n){var s=0===r,o=i.lastTick-n.lastTick<500;!s||o?(e.display="none",t=0):0===t?t=i.lastTick:i.lastTick-t>1e3&&(e.display="block",a=(a+30)%360,e.webkitTransform=e.transform="rotate("+a+"deg)")}function h(e){var s=decodeURIComponent(window.location.hash).slice(1),r=s&&s.split("&");if(r)for(var n=0;n<r.length;n++){var u=r[n].split("="),l=u[0],t=u[1];try{t=JSON.parse(t)}catch(c){"["===t[0]&&(t=t.slice(1,-1).split(","))}e[l]=t}var i=Squeak.splitFilePath(e.root||"/").fullname;if(Squeak.dirCreate(i,!0),/\/$/.test(i)||(i+="/"),e.root=i,e.url&&e.files&&!e.image&&(e.image=e.url+"/"+e.files[0]),e.templates){if(e.templates.constructor===Array){var o={};e.templates.forEach(function(e){o[e]=e}),e.templates=o}for(var a in e.templates)Squeak.fetchTemplateDir(e.root+a,e.templates[a])}}var s,a=0,t=0;SqueakJS.runImage=function(r,i,e,t){window.onbeforeunload=function(){return SqueakJS.appName+" is still running"},window.clearTimeout(s),e.reset(),e.clear(),e.showBanner("Loading "+SqueakJS.appName),e.showProgress(0);var n=this;window.setTimeout(function(){var a=new Squeak.Image(i);a.readFromBuffer(r,function(){function o(){try{e.quitFlag?n.onQuit(r,e,t):r.interpret(50,function(t){"sleep"==t&&(t=200),u&&f(u,t,r,e),s=window.setTimeout(o,t)})}catch(i){console.error(i),alert(i)}}e.quitFlag=!1;var r=new Squeak.Interpreter(a,e);SqueakJS.vm=r,localStorage.squeakImageName=i,l(t),e.clear(),e.showBanner("Starting "+SqueakJS.appName);var u=c(r,t);e.runNow=function(){window.clearTimeout(s),o()},e.runFor=function(t){var i=Date.now()+t;do e.runNow();while(Date.now()<i)},o()},function(t){e.showProgress(t)})},0)},SqueakJS.runSqueak=function(t,u,e){function i(u){if(0===n.length)return u(a);var t=n.shift();if(!t.forceDownload&&Squeak.fileExists(e.root+t.name))return void(t.name==r?Squeak.fileGet(e.root+t.name,function(e){a=e,i(u)},function(){Squeak.fileDelete(e.root+t.name),n.unshift(t),i(u)}):i(u));s.showBanner("Downloading "+t.name);var o=new XMLHttpRequest;o.open("GET",t.url),o.responseType="arraybuffer",o.onprogress=function(e){e.lengthComputable&&s.showProgress(e.loaded/e.total)},o.onload=function(){200==o.status?(t.name==r&&(a=o.response),Squeak.filePut(e.root+t.name,o.response,function(){i(u)})):o.onerror(o.statusText)},o.onerror=function(){alert("Failed to download:\n"+t.url)},o.send()}h(e),e.image?t=e.image:e.image=t,SqueakJS.options=e,SqueakJS.appName=e.appName||t.replace(/.*\//,"").replace(/\.image$/,""),Squeak.fsck();var s=d(u,e),r=Squeak.splitFilePath(t).basename,a=null,l=t.replace(/[^\/]*$/,""),n=[{url:t,name:r}];if(e.files&&e.files.forEach(function(e){e!==r&&n.push({url:l+e,name:e})}),e.document){var o=Squeak.splitFilePath(e.document).basename;n.push({url:e.document,name:o,forceDownload:!0}),s.documentName=e.root+o}i(function(t){SqueakJS.runImage(t,e.root+r,s,e)})},SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0},SqueakJS.onQuit=function(i,t,e){window.onbeforeunload=null,t.vm=null,e.spinner&&(e.spinner.style.display="none"),e.onQuit?e.onQuit(i,t,e):t.showBanner(SqueakJS.appName+" stopped.")}}),window.applicationCache&&applicationCache.addEventListener("updateready",function(){var e=window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS";confirm(e+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())}),module("users.bert.SqueakJS.vm").requires().toRun(function(){window.Squeak=users.bert.SqueakJS.vm,Object.extend(Squeak,"version",{vmVersion:"SqueakJS 0.7.1",vmBuild:"unknown",vmPath:"/",vmFile:"vm.js",platformName:"Web",platformSubtype:"unknown",osVersion:navigator.userAgent,windowSystem:"HTML"},"object header",{HeaderTypeMask:3,HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_TheInputSemaphore:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_BlockContextProto:37,splOb_ExternalObjectsArray:38,splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},"known classes",{Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:17,Context_largeFrameSize:57,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,Stream_array:0,Stream_position:1,Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(e,t){this.externalModules[e]=t}},"files",{fsck:function(o,n,t,e){if(n=n||"",e=e||{dirs:0,files:0,bytes:0,deleted:0},!t){t={};for(var h in localStorage){var l=h.match(/squeak-file(\.lz)?:(.*)$/);l&&(t[l[2]]=!0)}if("undefined"!=typeof indexedDB)return this.dbTransaction("readonly","fsck cursor",function(r){var i=r.openCursor();i.onsuccess=function(r){var i=r.target.result;i?(t[i.key]=!0,i.continue()):Squeak.fsck(o,n,t,e)},i.onerror=function(){console.error("fsck failed")}})}var a=Squeak.dirList(n);for(var u in a){var i=n+"/"+u,c=a[u][3];if(c){var f="squeak:"+i in localStorage;f?(Squeak.fsck(null,i,t,e),e.dirs++):(console.log("Deleting stale directory "+i),Squeak.dirDelete(i),e.deleted++)}else t[i]?(t[i]=!1,e.files++,e.bytes+=a[u][4]):(console.log("Deleting stale file entry "+i),Squeak.fileDelete(i,!0),e.deleted++)}if(""===n){console.log("squeak fsck: "+e.dirs+" directories, "+e.files+" files, "+(e.bytes/1e6).toFixed(1)+" MBytes");var r=[],p=0;for(var i in t)p++,t[i]&&r.push(i);if(r.length>0){for(var s=0;s<r.length;s++)console.log("Deleting orphaned file "+r[s]),delete localStorage["squeak-file:"+r[s]],delete localStorage["squeak-file.lz:"+r[s]],e.deleted++;"undefined"!=typeof indexedDB&&this.dbTransaction("readwrite","fsck delete",function(t){for(var e=0;e<r.length;e++)t.delete(r[e])})}o&&o(e)}},dbTransaction:function(s,r,i,e){if("undefined"==typeof indexedDB)return i(Squeak.dbFake()),void(e&&e());var n=function(){var t=SqueakDB.transaction("files",s),n=t.objectStore("files");t.oncomplete=function(){e&&e()},t.onerror=function(e){console.error(e.target.error.name+": "+r)},t.onabort=function(t){console.error(t.target.error.name+": aborting "+r),i(Squeak.dbFake()),e&&e()},i(n)};if(window.SqueakDB)return n();var t=indexedDB.open("squeak");t.onsuccess=function(){window.SqueakDB=this.result,SqueakDB.onversionchange=function(){delete window.SqueakDB,this.close()},SqueakDB.onerror=function(e){console.log("Error accessing database: "+e.target.errorCode)},n()},t.onupgradeneeded=function(e){console.log("Creating database version "+e.newVersion);var t=e.target.result;t.createObjectStore("files")},t.onerror=function(e){console.log("Error opening database: "+e.target.errorCode)},t.onblocked=function(){alert("Database upgrade needed. Please close all other tabs with this site open!")}},dbFake:function(){return"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1e5,get:function(r){var e=SqueakDBFake.bigFiles[r];if(!e){var t=localStorage["squeak-file:"+r];if(!t){var a=localStorage["squeak-file.lz:"+r];a&&("object"==typeof LZString?t=LZString.decompressFromUTF16(a):console.error("LZString not loaded: cannot decompress "+r))}if(t){for(var s=new Uint8Array(t.length),n=0;n<s.length;n++)s[n]=255&t.charCodeAt(n);e=s.buffer}}var i={result:e};return setTimeout(function(){e&&i.onsuccess&&i.onsuccess(),!e&&i.onerror&&i.onerror()},0),i},put:function(t,e){if(t.byteLength>SqueakDBFake.bigFileThreshold)SqueakDBFake.bigFiles[e]||console.log("File "+e+" ("+t.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[e]=t;else{var r=Squeak.bytesAsString(new Uint8Array(t));if("object"==typeof LZString){var n=LZString.compressToUTF16(r);localStorage["squeak-file.lz:"+e]=n,delete localStorage["squeak-file:"+e]}else localStorage["squeak-file:"+e]=r}var i={};return setTimeout(function(){i.onsuccess&&i.onsuccess()},0),i},"delete":function(e){delete localStorage["squeak-file:"+e],delete localStorage["squeak-file.lz:"+e],delete SqueakDBFake.bigFiles[e];var t={};return setTimeout(function(){t.onsuccess&&t.onsuccess()},0),t}}),SqueakDBFake},fileGet:function(r,i,t){t||(t=function(e){console.log(e)});var e=this.splitFilePath(r);return e.basename?window.SqueakDBFake&&SqueakDBFake.bigFiles[e.fullname]?i(SqueakDBFake.bigFiles[e.fullname]):void this.dbTransaction("readonly","get "+r,function(n){var r=n.get(e.fullname);r.onerror=function(){t(this.errorCode)},r.onsuccess=function(){return void 0!==this.result?i(this.result):void Squeak.fetchTemplateFile(e.fullname,function(e){i(e)},function(){if("undefined"==typeof indexedDB)return t("file not found: "+e.fullname);var r=Squeak.dbFake().get(e.fullname);r.onerror=function(){t("file not found: "+e.fullname)},r.onsuccess=function(){i(this.result)}})}}):t("Invalid path: "+r)},filePut:function(n,r,s){var e=this.splitFilePath(n);if(!e.basename)return null;var i=this.dirList(e.dirname);if(!i)return null;var t=i[e.basename],a=this.totalSeconds();if(t){if(t[3])return null}else t=[e.basename,a,0,!1,0],i[e.basename]=t;return t[2]=a,t[4]=r.byteLength||r.length||0,localStorage["squeak:"+e.dirname]=JSON.stringify(i),this.dbTransaction("readwrite","put "+n,function(t){t.put(r,e.fullname)},function(){s&&s()}),t},fileDelete:function(i,n){var e=this.splitFilePath(i);if(!e.basename)return!1;var t=this.dirList(e.dirname);if(!t)return!1;var r=t[e.basename];return!r||r[3]?!1:(delete t[e.basename],localStorage["squeak:"+e.dirname]=JSON.stringify(t),n?!0:(this.dbTransaction("readwrite","delete "+i,function(t){t.delete(e.fullname)}),!0))},fileRename:function(a,o){var e=this.splitFilePath(a);if(!e.basename)return!1;var t=this.splitFilePath(o);if(!t.basename)return!1;var i=this.dirList(e.dirname);if(!i)return!1;var r=i[e.basename];if(!r||r[3])return!1;var s=e.dirname==t.dirname,n=s?i:this.dirList(t.dirname);return n?n[t.basename]?!1:(delete i[e.basename],r[0]=t.basename,n[t.basename]=r,localStorage["squeak:"+t.dirname]=JSON.stringify(n),s||(localStorage["squeak:"+e.dirname]=JSON.stringify(i)),this.fileGet(e.fullname,function(i){this.dbTransaction("readwrite","rename "+e.fullname+" to "+t.fullname,function(r){r.delete(e.fullname),r.put(i,t.fullname)})}.bind(this),function(e){console.log("File rename failed: "+e)}.bind(this)),!0):!1},fileExists:function(r){var e=this.splitFilePath(r);if(!e.basename)return!1;var t=this.dirList(e.dirname);if(!t)return!1;var i=t[e.basename];return!i||i[3]?!1:!0},dirCreate:function(r,n){var e=this.splitFilePath(r);if(!e.basename)return!1;n&&!localStorage["squeak:"+e.dirname]&&Squeak.dirCreate(e.dirname,!0);var t=this.dirList(e.dirname);if(!t)return!1;if(t[e.basename])return!1;var i=this.totalSeconds(),s=[e.basename,i,i,!0,0];return t[e.basename]=s,localStorage["squeak:"+e.fullname]=JSON.stringify({}),localStorage["squeak:"+e.dirname]=JSON.stringify(t),!0},dirDelete:function(r){var e=this.splitFilePath(r);if(!e.basename)return!1;var t=this.dirList(e.dirname);if(!t)return!1;if(!t[e.basename])return!1;var i=this.dirList(e.fullname);if(!i)return!1;for(var n in i)return!1;return delete t[e.basename],localStorage["squeak:"+e.dirname]=JSON.stringify(t),delete localStorage["squeak:"+e.fullname],!0},dirList:function(s,a){function n(r,e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];r[i[0]]=i}}var e=this.splitFilePath(s),t=localStorage["squeak:"+e.fullname],i=a&&localStorage["squeak-template:"+e.fullname];if(t||i){var r={};return i&&n(r,JSON.parse(i).entries),t&&n(r,JSON.parse(t)),r}return"/"==e.fullname?{}:null},splitFilePath:function(e){"/"!==e[0]&&(e="/"+e),e=e.replace(/\/\//gi,"/");var t=e.match(/(.*)\/(.*)/),i=t[1].length?t[1]:"/",r=t[2].length?t[2]:null;return{fullname:e,dirname:i,basename:r}},flushFile:function(e){if(e.modified){var t=e.contents.buffer;t.byteLength!==e.size&&(t=new ArrayBuffer(e.size),new Uint8Array(t).set(e.contents.subarray(0,e.size))),Squeak.filePut(e.name,t),e.modified=!1}},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var e in SqueakFiles)this.flushFile(SqueakFiles[e])},closeAllFiles:function(){Squeak.flushAllFiles(),delete window.SqueakFiles},fetchTemplateDir:function(e,i){function r(t){var e=Squeak.splitFilePath(t);"/"!==e.dirname&&r(e.dirname);var t=JSON.parse(localStorage["squeak-template:"+e.dirname]||'{"entries": {}}');if(!t.entries[e.basename]){var i=Squeak.totalSeconds();t.entries[e.basename]=[e.basename,i,i,!0,0],localStorage["squeak-template:"+e.dirname]=JSON.stringify(t)}}function n(e,t){var i=JSON.parse(localStorage["squeak-template:"+e]);i.entries.forEach(function(i){i[3]&&Squeak.fetchTemplateDir(e+"/"+i[0],t+"/"+i[0])})}if(e=Squeak.splitFilePath(e).fullname,localStorage["squeak-template:"+e])n(e,i);else{var s=i+"/sqindex.json",t=new XMLHttpRequest;t.open("GET",s,!0),t.onload=function(){200==t.status?(console.log("adding template "+e),r(e),localStorage["squeak-template:"+e]='{"url": '+JSON.stringify(i)+', "entries": '+t.response+"}",n(e,i)):t.onerror(t.statusText)},t.onerror=function(){console.log("cannot load template index "+s)},t.send()}},fetchTemplateFile:function(e,s,r){e=Squeak.splitFilePath(e);var n=localStorage["squeak-template:"+e.dirname];if(!n)return r();var t=JSON.parse(n).url;if(!t)return r();t+="/"+e.basename;var i=new XMLHttpRequest;i.open("get",t,!0),i.responseType="arraybuffer",i.timeout=3e4,i.onreadystatechange=function(){if(this.readyState==this.DONE)if(200==this.status){var i=this.response;console.log("Got "+i.byteLength+" bytes from "+t),Squeak.dirCreate(e.dirname,!0),Squeak.filePut(e.fullname,i),s(i)}else alert("Download failed ("+this.status+") "+t),r()},console.log("Fetching "+t),i.send()}},"audio",{startAudioOut:function(){if(!this.audioOutContext){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioOutContext=e&&new e}return this.audioOutContext},startAudioIn:function(e,t){return this.audioInContext?(this.audioInSource.disconnect(),e(this.audioInContext,this.audioInSource)):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia({audio:!0,toString:function(){return"audio"}},function(i){var t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioInContext=t&&new t,this.audioInSource=this.audioInContext.createMediaStreamSource(i),e(this.audioInContext,this.audioInSource)},function(){t("cannot access microphone")}):t("test: audio input not supported"))},stopAudio:function(){this.audioInSource&&this.audioInSource.disconnect()}},"time",{Epoch:Date.UTC(1901,0,1)+6e4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1e3)}},"utils",{bytesAsString:function(t){for(var i=[],e=0;e<t.length;e++)i.push(String.fromCharCode(t[e]));return i.join("")}}),Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(e){this.totalMemory=1e8,this.name=e,this.gcCount=0,this.gcTenured=0,this.gcMilliseconds=0,this.allocationCount=0,this.oldSpaceCount=0,this.newSpaceCount=0,this.hasNewInstances={}},readFromBuffer:function(m,d,v){function P(){if(s){for(var e=h+(u.oldSpaceCount/10|0);s&&e>h;)s.installFromImage(r,j,x,o,S),s=s.nextObject,h++;return v&&v(h/u.oldSpaceCount),!0}return u.specialObjectsArray=k,u.decorateKnownObjects(),u.fixCompactOops(),!1}function A(){P()?window.setTimeout(A,0):d&&d()}console.log("squeak: reading "+this.name+" ("+m.byteLength+" bytes)"),this.startupTime=Date.now();for(var V=new DataView(m),o=!1,i=0,e=function(){var e=V.getUint32(i,o);return i+=4,e},w=function(t,n){if(5>n){for(var r=[];r.length<t;)r.push(e());return r}var s=new Uint32Array(m,i,t);return i+=4*t,s},q=[6502,6504,6505,68e3,68002,68003],n=0,f=0;;){if(o=!o,i=f,n=e(),q.indexOf(n)>=0)break;if(o||(f+=512),f>512)throw Error("bad image version")}var S=0!=(1&n);if(this.hasClosures=6504==n||68002==n||S,n>=68e3)throw Error("64 bit images not supported yet");var y=e(),I=e(),b=e(),M=e();this.lastHash=e();e(),e(),e();i+=y-36;for(var p,r={},g=f+y;g+I>i;){var l=0,c=0,t=e();switch(t&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:l=t>>2,c=e(),t=e();break;case Squeak.HeaderTypeClass:c=t-Squeak.HeaderTypeClass,t=e(),l=t>>2&63;break;case Squeak.HeaderTypeShort:l=t>>2&63,c=t>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}l--;var F=i-4-g,O=t>>8&15,B=t>>17&4095,C=w(l,O),a=new Squeak.Object;a.initFromImage(F,c,O,B,C),32>c&&(a.hash|=268435456),p&&(p.nextObject=a),this.oldSpaceCount++,p=a,r[b+F]=a}this.firstOldObject=r[b+4],this.lastOldObject=p,this.oldSpaceBytes=I;var k=r[M],j=r[k.bits[Squeak.splOb_CompactClasses]].bits,x=r[k.bits[Squeak.splOb_ClassFloat]],s=this.firstOldObject,h=0,u=this;if(v)window.setTimeout(A,0);else{for(;P(););d&&d()}},decorateKnownObjects:function(){var e=this.specialObjectsArray.pointers;e[Squeak.splOb_NilObject].isNil=!0,e[Squeak.splOb_TrueObject].isTrue=!0,e[Squeak.splOb_FalseObject].isFalse=!0,e[Squeak.splOb_ClassFloat].isFloatClass=!0,this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers;for(var t=0;t<this.compactClasses.length;t++)this.compactClasses[t].isNil||(this.compactClasses[t].isCompact=!0);Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){for(var e=this.firstOldObject,t=0;e;){var i=e.hash>268435455,n=!!e.sqClass.isCompact;if(i!==n){var r=0===e.snapshotSize().header;i!==r&&(t+=r?-4:4)}e.hash&=268435455,e.oop+=t,e=e.nextObject}this.oldSpaceBytes+=t}},"garbage collection",{partialGC:function(){return this.totalMemory-this.oldSpaceBytes},fullGC:function(t){this.vm.addMessage("fullGC: "+t);var i=Date.now(),e=this.markReachableObjects();return this.removeUnmarkedOldObjects(),this.appendToOldObjects(e),this.finalizeWeakReferences(),this.allocationCount+=this.newSpaceCount,this.newSpaceCount=0,this.hasNewInstances={},this.gcCount++,this.gcMilliseconds+=Date.now()-i,e.length>0?e[0]:null},markReachableObjects:function(){this.vm.storeContextRegisters();for(var r=[this.specialObjectsArray,this.vm.activeContext],s=[];r.length>0;){var e=r.pop();
if(!e.mark){e.nextObject||e===this.lastOldObject||s.push(e),e.mark=!0,e.sqClass.mark||r.push(e.sqClass);var i=e.pointers;if(i){var n=i.length;if(this.vm.isContext(e)){n=e.contextSizeWithStack();for(var t=n;t<i.length;t++)i[t]=this.vm.nilObj}else e.sqClass.isWeak()&&(n=e.sqClass.classInstSize());for(var t=0;n>t;t++)"object"!=typeof i[t]||i[t].mark||r.push(i[t])}}}return s.sort(function(e,t){return t.oop-e.oop})},removeUnmarkedOldObjects:function(){var n=0,i=0,e=this.firstOldObject;for(e.mark=!1;;){var t=e.nextObject;if(!t)return this.lastOldObject=e,this.oldSpaceBytes-=i,void(this.oldSpaceCount-=n);if(t.mark)e=t,e.mark=!1,e.oop-=i;else{var r=t;e.nextObject=r.nextObject,r.oop=-++this.newSpaceCount,i+=r.totalBytes(),n++}}},appendToOldObjects:function(e){for(var i=this.lastOldObject,r=0;r<e.length;r++){var t=e[r];t.mark=!1,this.oldSpaceBytes=t.setAddr(this.oldSpaceBytes),i.nextObject=t,i=t}this.lastOldObject=i,this.oldSpaceCount+=e.length,this.gcTenured+=e.length},finalizeWeakReferences:function(){for(var e=this.firstOldObject;e;){if(e.sqClass.isWeak()){for(var i=e.pointers||[],n=e.sqClass.classInstSize(),s=!1,t=n;t<i.length;t++)i[t].oop<0&&(i[t]=this.vm.nilObj,s=!0);if(s&&(this.vm.pendingFinalizationSignals++,n>=2)){var r=e.pointers[Squeak.WeakFinalizerItem_list];if(r.sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]){var a=r.pointers[Squeak.WeakFinalizationList_first];e.pointers[Squeak.WeakFinalizerItem_next]=a,r.pointers[Squeak.WeakFinalizationList_first]=e}}}e=e.nextObject}this.vm.pendingFinalizationSignals>0&&this.vm.forceInterruptCheck()}},"creating",{registerObject:function(e){return e.oop=-++this.newSpaceCount,this.lastHash=13849+27181*this.lastHash&4294967295,4095&this.lastHash},instantiateClass:function(t,i,r){var e=new Squeak.Object,n=this.registerObject(e);return e.initInstanceOf(t,i,n,r),this.hasNewInstances[t.oop]=!0,e},clone:function(t){var e=new Squeak.Object,i=this.registerObject(e);return e.initAsClone(t,i),this.hasNewInstances[e.sqClass.oop]=!0,e}},"operations",{bulkBecome:function(n,r,c,l){if(!n)return!r;var a=n.length;if(a!==r.length)return!1;this.newSpaceCount>0?this.fullGC("become"):this.vm.storeContextRegisters();for(var i={},e=0;a>e;e++){var t=n[e];if(!t.sqClass)return!1;if(i[t.oop])return!1;i[t.oop]=r[e]}if(c)for(var e=0;a>e;e++){var t=r[e];if(!t.sqClass)return!1;if(i[t.oop])return!1;i[t.oop]=n[e]}if(l)for(var e=0;a>e;e++){var f=n[e].hash;n[e].hash=r[e].hash,r[e].hash=f}for(var t=this.firstOldObject;t;){var s=i[t.sqClass.oop];s&&(t.sqClass=s);var o=t.pointers;if(o)for(var u=0;u<o.length;u++)s=i[o[u].oop],s&&(o[u]=s);t=t.nextObject}return this.vm.flushMethodCacheAfterBecome(i),!0},objectAfter:function(e){return e.nextObject||this.newSpaceCount>0&&this.fullGC("nextObject")},someInstanceOf:function(t){for(var e=this.firstOldObject;;){if(e.sqClass===t)return e;if(e=e.nextObject||this.nextObjectWithGCFor(t),!e)return null}},nextInstanceAfter:function(e){for(var t=e.sqClass;;){if(e=e.nextObject||this.nextObjectWithGCFor(t),!e)return null;if(e.sqClass===t)return e}},nextObjectWithGCFor:function(e){return 0!==this.newSpaceCount&&this.hasNewInstances[e.oop]?this.fullGC("instance of "+e.className()):null},writeToBuffer:function(){var n=64,i=new DataView(new ArrayBuffer(n+this.oldSpaceBytes)),t=0,e=function(e){i.setUint32(t,e),t+=4};for(e(this.formatVersion()),e(n),e(this.oldSpaceBytes),e(this.firstOldObject.addr()),e(this.objectToOop(this.specialObjectsArray)),e(this.lastHash),e(52429400);n>t;)e(0);for(var r=this.firstOldObject,s=0;r;)t=r.writeTo(i,t,this),r=r.nextObject,s++;if(t!==i.byteLength)throw Error("wrong image size");if(s!==this.oldSpaceCount)throw Error("wrong object count");return i.buffer},objectToOop:function(e){if("number"==typeof e)return e<<1|1;if(e.oop<0)throw Error("temporary oop");return e.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.hasClosures?6504:6502},segmentVersion:function(){var e=this.specialObjectsArray.pointers[Squeak.splOb_SelectorDoesNotUnderstand],t=new Uint32Array(e.bytes.buffer,0,1);return this.formatVersion()|4278190080&t[0]},loadImageSegment:function(A,p){var l=new DataView(A.words.buffer),c=!1,O=!1,t=0,i=function(){var e=l.getUint32(t,c);return t+=4,e},S=function(e,n){if(5>n){for(var r=[];r.length<e;)r.push(i());return r}var s=new Uint32Array(l.buffer,t,e);return t+=4*e,s},a=i();if(a&!0&&(c=!0,t=0,a=i(),a&!0))return console.error("image segment format not supported"),null;if(a>>16!==this.vm.image.segmentVersion()>>16)return console.error("image segment format not supported"),null;for(var f=[],r={};t<l.byteLength;){var s=0,o=0,e=i();switch(e&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:s=e>>2,o=i(),e=i();break;case Squeak.HeaderTypeClass:o=e-Squeak.HeaderTypeClass,e=i(),s=e>>2&63;break;case Squeak.HeaderTypeShort:s=e>>2&63,o=e>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}s--;var d=t,m=e>>8&15,g=e>>17&4095,b=S(s,m),u=new Squeak.Object;u.initFromImage(d,o,m,g,b),f.push(u),r[d]=u}for(var n=0;n<p.pointers.length;n++)r[2147483652+4*n]=p.pointers[n];for(var y=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,v=0,F=y.map(function(e){return r[--v]=e,v}),h=r[8]||r[12]||r[16],I=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat],k=h,n=0;n<f.length;n++){var k=f[n];k.installFromImage(r,F,I,c,O),k.oop=-++this.newSpaceCount}return h}}),Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(t,e,n,s){this.sqClass=t,this.hash=n;var i=t.pointers[Squeak.Class_format],r=(i>>1&63)+(i>>10&192)-1;this.format=i>>7&15,this.format<8?6!=this.format?r+e>0&&(this.pointers=this.fillArray(r+e,s)):e>0&&(t.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(e)):e>0&&(this.bytes=new Uint8Array(e))},initAsClone:function(e,t){this.sqClass=e.sqClass,this.hash=t,this.format=e.format,e.isFloat?(this.isFloat=e.isFloat,this.float=e.float):(e.pointers&&(this.pointers=e.pointers.slice(0)),e.words&&(this.words=new Uint32Array(e.words)),e.bytes&&(this.bytes=new Uint8Array(e.bytes)))},initFromImage:function(e,t,i,r,n){this.oop=e,this.sqClass=t,this.format=i,this.hash=r,this.bits=n},installFromImage:function(i,o,u,t,s){var r=this.sqClass;this.sqClass=r>0&&32>r?i[o[r-1]]:i[r];var e=this.bits.length;if(this.format<5){if(e>0){var a=this.bits;this.pointers=this.decodePointers(e,a,i)}}else if(this.format>=12){var l=this.decodeWords(1,this.bits,t)[0],n=l>>10&255,a=this.decodeWords(n+1,this.bits,t);this.pointers=this.decodePointers(n+1,a,i),this.bytes=this.decodeBytes(e-(n+1),this.bits,n+1,3&this.format)}else if(this.format>=8)e>0&&(this.bytes=this.decodeBytes(e,this.bits,0,3&this.format));else if(this.sqClass==u){if(this.isFloat=!0,this.float=this.decodeFloat(this.bits,t,s),1.3797216632888e-310==this.float)if(/noFloatDecodeWorkaround/.test(window.location.hash));else if(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this.float=this.decodeFloat(this.bits,t,s),1.3797216632888e-310==this.float)throw Error("Cannot deoptimize decodeFloat")}else e>0&&(this.words=this.decodeWords(e,this.bits,t));delete this.bits,this.mark=!1},decodePointers:function(i,n,s){for(var r=new Array(i),e=0;i>e;e++){var t=n[e];r[e]=1===(1&t)?t>>1:s[t]||42424242}return r},decodeWords:function(t,i,n){for(var s=new DataView(i.buffer,i.byteOffset),r=new Uint32Array(t),e=0;t>e;e++)r[e]=s.getUint32(4*e,n);return r},decodeBytes:function(r,e,n,s){var t=4*r-s,a=new Uint8Array(e.buffer,e.byteOffset+4*n,t),i=new Uint8Array(t);return i.set(a),i},decodeFloat:function(i,r,n){var e=new DataView(i.buffer,i.byteOffset);if(!r)return e.getFloat64(0,!1);if(n)return e.getFloat64(0,!0);var s=new ArrayBuffer(8),t=new DataView(s);return t.setUint32(0,e.getUint32(4)),t.setUint32(4,e.getUint32(0)),t.getFloat64(0,!0)},decodeFloatDeoptimized:function(i,r,n){var e=new DataView(i.buffer,i.byteOffset);if(!r)return e.getFloat64(0,!1);if(n)return e.getFloat64(0,!0);var s=new ArrayBuffer(8),t=new DataView(s);return function(){t.setUint32(0,e.getUint32(4)),t.setUint32(4,e.getUint32(0))}(),t.getFloat64(0,!0)},fillArray:function(i,r){for(var t=[],e=0;i>e;e++)t[e]=r;return t}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(s){if(!this.bytes)return"";for(var r="0123456789ABCDEF",i=[],t=0,e=this.bytes.length-1;e>=0;e--)i.push(r[this.bytes[e]>>4]),i.push(r[15&this.bytes[e]]),t=256*t+this.bytes[e];var n=s?"-":"",a=t>=9007199254740992?"â‰ˆ":"";return n+"16r"+i.join("")+" ("+a+n+t+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(e){var t=this.instSize();return t>=e?this.sqClass.allInstVarNames()[e-1]:(e-t).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat){var t=this.float.toString();return/\./.test(t)||(t+=".0"),t}var e=this.sqClass.className();if(/ /.test(e))return"the "+e;switch(e){case"String":case"ByteString":return"'"+this.bytesAsString()+"'";case"Symbol":case"ByteSymbol":return"#"+this.bytesAsString();case"Point":return this.pointers.join("@");case"Rectangle":return this.pointers.join(" corner: ");case"Association":case"ReadOnlyVariableBinding":return this.pointers.join("->");case"LargePositiveInteger":return this.bytesAsNumberString(!1);case"LargeNegativeInteger":return this.bytesAsNumberString(!0);case"Character":return"$"+String.fromCharCode(this.pointers[0])+" ("+this.pointers[0].toString()+")"}return/^[aeiou]/i.test(e)?"an "+e:"a "+e}},"accessing",{isWords:function(){return 6===this.format},isBytes:function(){var e=this.format;return e>=8&&11>=e},isWordsOrBytes:function(){var e=this.format;return 6==e||e>=8&&11>=e},isPointers:function(){return this.format<=4},isMethod:function(){return this.format>=12},pointersSize:function(){return this.pointers?this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){return this.format>4||2==this.format?0:this.format<2?this.pointersSize():this.sqClass.classInstSize()},floatData:function(){var t=new ArrayBuffer(8),e=new DataView(t);return e.setFloat64(0,this.float,!1),e},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words?this.words:this.uint32Array?this.uint32Array:this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>2):null},setAddr:function(t){var e=this.snapshotSize();return this.oop=t+4*e.header,t+4*(e.header+e.body)},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;this.bytes&&(e+=this.bytes.length+3>>2),e++;var t=e>63?2:this.sqClass.isCompact?0:1;return{header:t,body:e}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var e=this.snapshotSize();return 4*(e.header+e.body)},writeTo:function(t,e,s){this.bytes&&(this.format|=3&-this.bytes.length);var a=e,r=this.snapshotSize(),n=(15&this.format)<<8|(4095&this.hash)<<17;switch(r.header){case 2:t.setUint32(e,r.body<<2|Squeak.HeaderTypeSizeAndClass),e+=4,t.setUint32(e,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass),e+=4,t.setUint32(e,n|Squeak.HeaderTypeSizeAndClass),e+=4;break;case 1:t.setUint32(e,this.sqClass.oop|Squeak.HeaderTypeClass),e+=4,t.setUint32(e,n|r.body<<2|Squeak.HeaderTypeClass),e+=4;break;case 0:var o=s.compactClasses.indexOf(this.sqClass)+1;t.setUint32(e,n|o<<12|r.body<<2|Squeak.HeaderTypeShort),e+=4}if(this.isFloat)t.setFloat64(e,this.float),e+=8;else if(this.words)for(var i=0;i<this.words.length;i++)t.setUint32(e,this.words[i]),e+=4;else if(this.pointers)for(var i=0;i<this.pointers.length;i++)t.setUint32(e,s.objectToOop(this.pointers[i])),e+=4;if(this.bytes){for(var i=0;i<this.bytes.length;i++)t.setUint8(e++,this.bytes[i]);e+=3&-this.bytes.length}if(e!==a+this.totalBytes())throw Error("written size does not match");return e}},"as class",{classInstSize:function(){var e=this.pointers[Squeak.Class_format];return(e>>10&192)+(e>>1&63)-1},isWeak:function(){var e=this.pointers[Squeak.Class_format];return 4==(e>>7&15)},instVarNames:function(){var e=this.pointers.length>12?4:this.pointers.length>9?3:4;return(this.pointers[e].pointers||[]).map(function(e){return e.bytesAsString()})},allInstVarNames:function(){var e=this.superclass();return e.isNil?this.instVarNames():e.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";var e=this.pointers[6];if(e&&e.bytes)return Squeak.bytesAsString(e.bytes);var e=this.pointers[7];if(e&&e.bytes)return Squeak.bytesAsString(e.bytes);for(var t=5;6>=t;t++)for(var i=6;7>=i;i++){var r=this.pointers[t];if(r.pointers){var e=r.pointers[i];if(e&&e.bytes)return Squeak.bytesAsString(e.bytes)+" class"}}return"_SOMECLASS_"}},"as method",{methodHeader:function(){return this.pointers[0]},methodNumLits:function(){return this.pointers.length-1},methodNumArgs:function(){return this.methodHeader()>>24&15},methodPrimitiveIndex:function(){var e=805306879&this.methodHeader();return e>511?(511&e)+(e>>19):e},methodClassForSuper:function(){var e=this.pointers[this.methodNumLits()];return e.pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return(131072&this.methodHeader())>0},methodAddPointers:function(e){this.pointers=e},methodTempCount:function(){return this.methodHeader()>>18&63},methodGetLiteral:function(e){return this.pointers[1+e]},methodGetSelector:function(e){return this.pointers[1+e]},methodSetLiteral:function(e,t){this.pointers[1+e]=t}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"==typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(e){if(e&&e.activeContext===this)return e.sp+1;var t=this.pointers[Squeak.Context_stackPointer];return Squeak.Context_tempFrameStart+("number"==typeof t?t:0)}}),Object.subclass("Squeak.Interpreter","initialization",{initialize:function(e,t){console.log("squeak: initializing interpreter "+Squeak.vmVersion),this.Squeak=Squeak,this.image=e,this.image.vm=this,this.primHandler=new Squeak.Primitives(this,t),this.loadImageState(),this.hackImage(),this.initVMState(),this.loadInitialContext(),this.initCompiler(),console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers,this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers,this.nilObj=this.specialObjects[Squeak.splOb_NilObject],this.falseObj=this.specialObjects[Squeak.splOb_FalseObject],this.trueObj=this.specialObjects[Squeak.splOb_TrueObject],this.hasClosures=this.image.hasClosures,this.globals=this.findGlobals(),this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0)},initVMState:function(){this.byteCodeCount=0,this.sendCount=0,this.interruptCheckCounter=0,this.interruptCheckCounterFeedBackReset=1e3,this.interruptChecksEveryNms=3,this.nextPollTick=0,this.nextWakeupTick=0,this.lastTick=0,this.interruptKeycode=2094,this.interruptPending=!1,this.pendingFinalizationSignals=0,this.freeContexts=this.nilObj,this.freeLargeContexts=this.nilObj,this.reclaimableContextCount=0,this.nRecycledContexts=0,this.nAllocatedContexts=0,this.methodCacheSize=1024,this.methodCacheMask=this.methodCacheSize-1,this.methodCacheRandomish=0,this.methodCache=[];for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1,this.breakOutTick=0,this.breakOnMethod=null,this.breakOnNewMethod=!1,this.breakOnContextChanged=!1,this.breakOnContextReturned=null,this.messages={},this.startupTime=Date.now()},loadInitialContext:function(){var e=this.specialObjects[Squeak.splOb_SchedulerAssociation],t=e.pointers[Squeak.Assn_value],i=t.pointers[Squeak.ProcSched_activeProcess];this.activeContext=i.pointers[Squeak.Proc_suspendedContext],this.fetchContextRegisters(this.activeContext),this.reclaimableContextCount=0},findGlobals:function(){var e=this.specialObjects[Squeak.splOb_SmalltalkDictionary],t=e.sqClass.className();if("Association"===t&&(e=e.pointers[1],t=e.sqClass.className()),"SystemDictionary"===t)return e.pointers[1].pointers;if("SmalltalkImage"===t){var i=e.pointers[0],r=i.sqClass.className();if("SystemDictionary"===r)return i.pointers[1].pointers;if("Environment"===r)return i.pointers[2].pointers[1].pointers}throw Error("cannot find global dict")},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==new Function("return 42")())return console.warn("function constructor not working, disabling JIT")}catch(e){return console.warn("disabling JIT: "+e)}var t=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(10>t)return console.warn("Slow machine detected (loaded "+(1e3*t|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler"),this.compiler=new Squeak.Compiler(this)}catch(e){console.warn("Compiler "+e)}},hackImage:function(){[].forEach(function(e){var t=this.findMethod(e.method);t&&(t.pointers[0]|=e.primitive,console.warn("Hacking "+e.method))},this)}},"interpreting",{interpretOne:function(r){if(this.method.compiled){if(r){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(r);this.breakNow()}return void(this.byteCodeCount+=this.method.compiled(this))}var e,t,i=this.Squeak;if(this.byteCodeCount++,e=this.nextByte(),128>e)switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&e]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.homeContext.pointers[i.Context_tempFrameStart+(15&e)]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&e));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:return void this.push(this.method.methodGetLiteral(31&e).pointers[i.Assn_value]);case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:return void(this.receiver.pointers[7&e]=this.pop());case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:return void(this.homeContext.pointers[i.Context_tempFrameStart+(7&e)]=this.pop());case 112:return void this.push(this.receiver);case 113:return void this.push(this.trueObj);case 114:return void this.push(this.falseObj);case 115:return void this.push(this.nilObj);case 116:return void this.push(-1);case 117:return void this.push(0);case 118:return void this.push(1);case 119:return void this.push(2);case 120:return void this.doReturn(this.receiver);case 121:return void this.doReturn(this.trueObj);case 122:return void this.doReturn(this.falseObj);case 123:return void this.doReturn(this.nilObj);case 124:return void this.doReturn(this.pop());case 125:return void this.doReturn(this.pop(),this.activeContext.pointers[i.BlockContext_caller]);case 126:return void this.nono();case 127:return void this.nono()}else switch(e){case 128:return void this.extendedPush(this.nextByte());case 129:return void this.extendedStore(this.nextByte());case 130:return void this.extendedStorePop(this.nextByte());case 131:return t=this.nextByte(),void this.send(this.method.methodGetSelector(31&t),t>>5,!1);case 132:return void this.doubleExtendedDoAnything(this.nextByte());case 133:return t=this.nextByte(),void this.send(this.method.methodGetSelector(31&t),t>>5,!0);case 134:return t=this.nextByte(),void this.send(this.method.methodGetSelector(63&t),t>>6,!1);case 135:return void this.pop();case 136:return void this.push(this.top());case 137:return this.push(this.activeContext),void(this.reclaimableContextCount=0);case 138:return void this.pushNewArray(this.nextByte());case 139:return void this.nono();case 140:return t=this.nextByte(),void this.push(this.homeContext.pointers[i.Context_tempFrameStart+this.nextByte()].pointers[t]);case 141:return t=this.nextByte(),void(this.homeContext.pointers[i.Context_tempFrameStart+this.nextByte()].pointers[t]=this.top());case 142:return t=this.nextByte(),void(this.homeContext.pointers[i.Context_tempFrameStart+this.nextByte()].pointers[t]=this.pop());case 143:return void this.pushClosureCopy();case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:return void(this.pc+=(7&e)+1);case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.jumpIfFalse((7&e)+1);case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:return t=this.nextByte(),this.pc+=256*((7&e)-4)+t,void(4>(7&e)&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 168:case 169:case 170:case 171:return void this.jumpIfTrue(256*(3&e)+this.nextByte());case 172:case 173:case 174:case 175:return void this.jumpIfFalse(256*(3&e)+this.nextByte());case 176:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 177:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 178:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 179:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 180:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 181:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 182:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 183:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 184:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&e));case 185:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 186:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 187:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&e));case 188:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 189:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&e));case 190:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&e));case 191:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&e));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return void(this.primHandler.quickSendOther(this.receiver,15&e)||this.sendSpecial((15&e)+16));case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:return void this.send(this.method.methodGetSelector(15&e),0,!1);case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:return void this.send(this.method.methodGetSelector(15&e),1,!1);case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:return void this.send(this.method.methodGetSelector(15&e),2,!1)}throw Error("not a bytecode: "+e)},interpret:function(i,e){if(this.frozen)return"frozen";for(this.isIdle=!1,this.breakOutOfInterpreter=!1,this.breakOutTick=this.primHandler.millisecondClockValue()+(i||500);this.breakOutOfInterpreter===!1;)this.method.compiled?this.byteCodeCount+=this.method.compiled(this):this.interpretOne();if("function"==typeof this.breakOutOfInterpreter)return this.breakOutOfInterpreter(e);var t="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0;return e&&e(t),t},goIdle:function(){var e=0!==this.nextWakeupTick;this.forceInterruptCheck(),this.checkForInterrupts();var t=0!==this.nextWakeupTick;this.isIdle=t||!e,this.breakOut()},freeze:function(){var e;return this.frozen=!0,this.breakOutOfInterpreter=function(t){if(!t)throw Error("need function to restart interpreter");return e=t,"frozen"}.bind(this),function(){if(this.frozen=!1,!e)throw Error("no continue function");e(0)}.bind(this)},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.methodBytes[this.pc++]},nono:function(){throw Error("Oh No!")},forceInterruptCheck:function(){this.interruptCheckCounter=-1e3},checkForInterrupts:function(){var e=this.primHandler.millisecondClockValue();if(e<this.lastTick&&(this.nextPollTick=e+(this.nextPollTick-this.lastTick),this.breakOutTick=e+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick&&(this.nextWakeupTick=e+(this.nextWakeupTick-this.lastTick))),this.interruptCheckCounter>-100&&(e-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+=10:this.interruptCheckCounterFeedBackReset<=1e3?this.interruptCheckCounterFeedBackReset=1e3:this.interruptCheckCounterFeedBackReset-=12),this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset,this.lastTick=e,this.interruptPending){this.interruptPending=!1;var t=this.specialObjects[Squeak.splOb_TheInterruptSemaphore];t.isNil||this.primHandler.synchronousSignal(t)}if(0!==this.nextWakeupTick&&e>=this.nextWakeupTick){this.nextWakeupTick=0;var t=this.specialObjects[Squeak.splOb_TheTimerSemaphore];t.isNil||this.primHandler.synchronousSignal(t)}if(this.pendingFinalizationSignals>0){var t=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore];this.pendingFinalizationSignals=0,t.isNil||this.primHandler.synchronousSignal(t)}this.primHandler.semaphoresToSignal.length>0&&this.primHandler.signalExternalSemaphores(),!this.method.compiled&&this.compiler&&this.compiler.compile(this.method),e>=this.breakOutTick&&this.breakOut()},extendedPush:function(t){var e=63&t;switch(t>>6){case 0:this.push(this.receiver.pointers[e]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+e]);break;case 2:this.push(this.method.methodGetLiteral(e));break;case 3:this.push(this.method.methodGetLiteral(e).pointers[Squeak.Assn_value])}},extendedStore:function(t){var e=63&t;switch(t>>6){case 0:this.receiver.pointers[e]=this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+e]=this.top();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(t){var e=63&t;switch(t>>6){case 0:this.receiver.pointers[e]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+e]=this.pop();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(t){var e=this.nextByte();switch(t>>5){case 0:this.send(this.method.methodGetSelector(e),31&t,!1);break;case 1:this.send(this.method.methodGetSelector(e),31&t,!0);break;case 2:this.push(this.receiver.pointers[e]);break;case 3:this.push(this.method.methodGetLiteral(e));break;case 4:this.push(this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]);break;case 5:this.receiver.pointers[e]=this.top();break;case 6:this.receiver.pointers[e]=this.pop();break;case 7:this.method.methodGetLiteral(e).pointers[Squeak.Assn_value]=this.top()}},jumpIfTrue:function(t){var e=this.pop();return e.isTrue?void(this.pc+=t):void(e.isFalse||(this.push(e),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1)))},jumpIfFalse:function(t){var e=this.pop();return e.isFalse?void(this.pc+=t):void(e.isTrue||(this.push(e),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1)))},sendSpecial:function(e){this.send(this.specialSelectors[2*e],this.specialSelectors[2*e+1],!1)}},"closures",{pushNewArray:function(i){var n=i>127,e=127&i,r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],e);if(n){for(var t=0;e>t;t++)r.pointers[t]=this.stackValue(e-t-1);this.popN(e)}this.push(r)},pushClosureCopy:function(){var r=this.nextByte(),n=15&r,e=r>>4,s=this.nextByte(),a=256*s+this.nextByte(),o=this.encodeSqueakPC(this.pc,this.method),i=this.newClosure(n,o,e);if(i.pointers[Squeak.Closure_outerContext]=this.activeContext,this.reclaimableContextCount=0,e>0){for(var t=0;e>t;t++)i.pointers[Squeak.Closure_firstCopiedValue+t]=this.stackValue(e-t-1);this.popN(e)}this.pc+=a,this.push(i)},newClosure:function(t,i,r){var n=Squeak.Closure_firstCopiedValue+r,e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],n);return e.pointers[Squeak.Closure_startpc]=i,e.pointers[Squeak.Closure_numArgs]=t,e}},"sending",{send:function(i,r,s){var n=this.stackValue(r),e=this.getClass(n);s&&(e=this.method.methodClassForSuper(),e=e.pointers[Squeak.Class_superclass]);var t=this.findSelectorInClass(i,r,e);t.primIndex&&(this.verifyAtSelector=i,this.verifyAtClass=e),this.executeNewMethod(n,t.method,t.argCount,t.primIndex,t.mClass,i)},sendAsPrimitiveFailure:function(e,t,i){this.executeNewMethod(e,t,i,0)},findSelectorInClass:function(r,n,i){var e=this.findMethodCacheEntry(r,i);if(e.method)return e;for(var a,t=i;!t.isNil;){if(a=t.pointers[Squeak.Class_mdict],a.isNil){var u=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],l=this.createActualMessage(r,n,i);return this.popNandPush(n,l),this.findSelectorInClass(u,1,t.superclass())}var s=this.lookupSelectorInDict(a,r);if(!s.isNil)return this.currentSelector=r,this.currentLookupClass=i,e.method=s,e.primIndex=s.isMethod()?s.methodPrimitiveIndex():248,e.argCount=n,e.mClass=t,e;t=t.superclass()}var o=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(r===o)throw Error("Recursive not understood error encountered");
var c=this.createActualMessage(r,n,i);return this.popNandPush(n,c),this.findSelectorInClass(o,1,i)},lookupSelectorInDict:function(t,i){for(var r=t.pointersSize(),a=r-Squeak.MethodDict_selectorStart-1,e=(a&i.hash)+Squeak.MethodDict_selectorStart,n=!1;;){var s=t.pointers[e];if(s===i){var o=t.pointers[Squeak.MethodDict_array];return o.pointers[e-Squeak.MethodDict_selectorStart]}if(s.isNil)return this.nilObj;if(++e===r){if(n)return this.nilObj;e=Squeak.MethodDict_selectorStart,n=!0}}},executeNewMethod:function(o,e,i,s,r,n){if(this.sendCount++,e===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(e,r,n)),this.logSends&&console.log(this.sendCount+" "+this.printMethod(e,r,n)),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow()),!(s>0&&this.tryPrimitive(s,i,e))){var t=this.allocateOrRecycleContext(e.methodNeedsLargeFrame()),a=e.methodTempCount(),u=0,l=Squeak.Context_tempFrameStart+a-1;if(t.pointers[Squeak.Context_method]=e,t.pointers[Squeak.BlockContext_initialIP]=this.nilObj,t.pointers[Squeak.Context_sender]=this.activeContext,this.arrayCopy(this.activeContext.pointers,this.sp-i,t.pointers,Squeak.Context_tempFrameStart-1,i+1),this.arrayFill(t.pointers,Squeak.Context_tempFrameStart+i,Squeak.Context_tempFrameStart+a,this.nilObj),this.popN(i+1),this.reclaimableContextCount++,this.storeContextRegisters(),this.activeContext=t,this.homeContext=t,this.method=e,this.methodBytes=e.bytes,this.pc=u,this.sp=l,this.storeContextRegisters(),this.receiver=t.pointers[Squeak.Context_receiver],this.receiver!==o)throw Error("receivers don't match");!e.compiled&&this.compiler&&this.compiler.compile(e,r,n),this.interruptCheckCounter--<=0&&this.checkForInterrupts()}},doReturn:function(i,t){if(!t){var r=this.homeContext;if(this.hasClosures)for(var n;!(n=r.pointers[Squeak.Context_closure]).isNil;)r=n.pointers[Squeak.Closure_outerContext];t=r.pointers[Squeak.Context_sender]}if(t.isNil||t.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(i);for(var e=this.activeContext.pointers[Squeak.Context_sender];e!==t;){if(e.isNil)return this.cannotReturn(i);if(this.isUnwindMarked(e))return this.aboutToReturnThrough(i,e);e=e.pointers[Squeak.Context_sender]}var s;for(e=this.activeContext;e!==t;)this.breakOnContextReturned===e&&(this.breakOnContextReturned=null,this.breakNow()),s=e.pointers[Squeak.Context_sender],e.pointers[Squeak.Context_sender]=this.nilObj,e.pointers[Squeak.Context_instructionPointer]=this.nilObj,this.reclaimableContextCount>0&&(this.reclaimableContextCount--,this.recycleIfPossible(e)),e=s;this.activeContext=e,this.fetchContextRegisters(this.activeContext),this.push(i),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(e,t){this.reclaimableContextCount=0,this.push(this.activeContext),this.push(e),this.push(t);var i=this.specialObjects[Squeak.splOb_SelectorAboutToReturn];this.send(i,2)},cannotReturn:function(e){this.reclaimableContextCount=0,this.push(this.activeContext),this.push(e);var t=this.specialObjects[Squeak.splOb_SelectorCannotReturn];this.send(t,1)},tryPrimitive:function(e,t,i){if(e>255&&520>e){if(e>=264)return this.popNandPush(1,this.top().pointers[e-264]),!0;switch(e){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}return this.popNandPush(1,e-261),!0}var r=this.primHandler.doPrimitive(e,t,i);return r},createActualMessage:function(r,t,n){var e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],0),i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],t);return this.arrayCopy(this.activeContext.pointers,this.sp-t+1,i.pointers,0,t),e.pointers[Squeak.Message_selector]=r,e.pointers[Squeak.Message_arguments]=i,e.pointers.length>Squeak.Message_lookupClass&&(e.pointers[Squeak.Message_lookupClass]=n),e},primitivePerform:function(t){var r=this.stackValue(t-1),n=this.stackValue(t),i=t-1,s=this.sp-i,a=this.activeContext.pointers;this.arrayCopy(a,s+1,a,s,i),this.sp--;var e=this.findSelectorInClass(r,i,this.getClass(n));return this.executeNewMethod(n,e.method,e.argCount,e.primIndex,e.mClass,r),!0},primitivePerformWithArgs:function(e,a){var r=this.stackValue(e),o=this.stackValue(e-1),n=this.stackValue(e-2);if(n.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var u=a?this.stackValue(e-3):this.getClass(r);if(a)for(var t=this.getClass(r);t!==u;)if(t=t.pointers[Squeak.Class_superclass],t.isNil)return!1;var s=n.pointersSize(),l=this.activeContext.pointers;this.arrayCopy(n.pointers,0,l,this.sp-1,s),this.sp+=s-e;var i=this.findSelectorInClass(o,s,u);return this.executeNewMethod(r,i.method,i.argCount,i.primIndex,i.mClass,o),!0},primitiveInvokeObjectAsMethod:function(e,r){for(var i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],e),t=0;e>t;t++)i.pointers[e-t-1]=this.pop();var n=this.pop(),s=this.currentSelector,a=this.specialObjects[Squeak.splOb_SelectorRunWithIn];return this.push(r),this.push(s),this.push(i),this.push(n),this.send(a,3,!1),!0},findMethodCacheEntry:function(t,r){var e;this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var n=(t.hash^r.hash)&this.methodCacheMask,i=n,s=0;4>s;s++){if(e=this.methodCache[i],e.selector===t&&e.lkupClass===r)return e;s===this.methodCacheRandomish&&(n=i),i=i+t.hash&this.methodCacheMask}return e=this.methodCache[n],e.lkupClass=r,e.selector=t,e.method=null,e},flushMethodCache:function(){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].selector=null,this.methodCache[e].method=null;return!0},flushMethodCacheForSelector:function(t){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].selector===t&&(this.methodCache[e].selector=null,this.methodCache[e].method=null);return!0},flushMethodCacheForMethod:function(t){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].method===t&&(this.methodCache[e].selector=null,this.methodCache[e].method=null);return!0},flushMethodCacheAfterBecome:function(){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(e){if(!this.isMethodContext(e))return!1;var t=e.pointers[Squeak.Context_method];return 198==t.methodPrimitiveIndex()},newActiveContext:function(e){this.storeContextRegisters(),this.activeContext=e,this.fetchContextRegisters(e)},fetchContextRegisters:function(e){var t=e.pointers[Squeak.Context_method];this.isSmallInt(t)?(this.homeContext=e.pointers[Squeak.BlockContext_home],t=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=e,this.receiver=this.homeContext.pointers[Squeak.Context_receiver],this.method=t,this.methodBytes=t.bytes,this.pc=this.decodeSqueakPC(e.pointers[Squeak.Context_instructionPointer],t),this.sp=this.decodeSqueakSP(e.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method),this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(e,t){return e+4*t.pointers.length+1},decodeSqueakPC:function(e,t){return e-4*t.pointers.length-1},encodeSqueakSP:function(e){return e-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(e){return e+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(e){if(this.isMethodContext(e))if(e.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize)e.pointers[0]=this.freeContexts,this.freeContexts=e;else{if(e.pointersSize()!==Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize)return;e.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=e}},allocateOrRecycleContext:function(t){var e;return t?this.freeLargeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)):(e=this.freeLargeContexts,this.freeLargeContexts=e.pointers[0],this.nRecycledContexts++,e):this.freeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)):(e=this.freeContexts,this.freeContexts=e.pointers[0],this.nRecycledContexts++,e)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},popN:function(e){this.sp-=e},push:function(e){this.activeContext.pointers[++this.sp]=e},popNandPush:function(e,t){this.activeContext.pointers[this.sp-=e-1]=t},top:function(){return this.activeContext.pointers[this.sp]},stackValue:function(e){return this.activeContext.pointers[this.sp-e]},stackInteger:function(e){return this.checkSmallInt(this.stackValue(e))},stackIntOrFloat:function(n){var e=this.stackValue(n);if("number"==typeof e)return e;if(e.isFloat)return this.resultIsFloat=!0,e.float;var i=e.bytes;if(i&&4==i.length){for(var t=0,r=3;r>=0;r--)t=256*t+i[r];if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return t;if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-t}return this.success=!1,0},pop2AndPushIntResult:function(e){return this.success&&this.canBeSmallInt(e)?(this.popNandPush(2,e),!0):!1},pop2AndPushNumResult:function(e){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,this.primHandler.makeFloat(e)),!0;if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return this.popNandPush(2,e),!0;if(e>=-4294967295&&4294967295>=e){var r=0>e,t=r?-e:e,s=r?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,n=this.instantiateClass(this.specialObjects[s],4),i=n.bytes;return i[0]=255&t,i[1]=t>>8&255,i[2]=t>>16&255,i[3]=t>>24&255,this.popNandPush(2,n),!0}}return!1},pop2AndPushBoolResult:function(e){return this.success?(this.popNandPush(2,e?this.trueObj:this.falseObj),!0):!1}},"numbers",{getClass:function(e){return this.isSmallInt(e)?this.specialObjects[Squeak.splOb_ClassInteger]:e.sqClass},canBeSmallInt:function(e){return e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt},isSmallInt:function(e){return"number"==typeof e},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,1)},quickDivide:function(t,e){if(0===e)return Squeak.NonSmallInt;var i=t/e|0;return i*e===t?i:Squeak.NonSmallInt},div:function(t,e){return 0===e?Squeak.NonSmallInt:Math.floor(t/e)},mod:function(t,e){return 0===e?Squeak.NonSmallInt:t-Math.floor(t/e)*e},safeShift:function(t,e){if(0>e)return-31>e?0>t?-1:0:t>>-e;if(e>31)return 0==t?0:Squeak.NonSmallInt;var i=t<<e;return i>>e===t?i:Squeak.NonSmallInt}},"utils",{isContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]?!0:e.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]?!0:!1},isMethodContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},isMethod:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassCompiledMethod]},instantiateClass:function(e,t){return this.image.instantiateClass(e,t,this.nilObj)},arrayFill:function(t,i,r,n){for(var e=i;r>e;e++)t[e]=n},arrayCopy:function(t,i,r,n,s){if(t===r&&n>i)for(var e=s-1;e>=0;e--)r[n+e]=t[i+e];else for(var e=0;s>e;e++)r[n+e]=t[i+e]}},"debugging",{addMessage:function(e){return this.messages[e]?++this.messages[e]:this.messages[e]=1},warnOnce:function(e){1==this.addMessage(e)&&console.warn(e)},printMethod:function(e,t,r){if(r)return t.className()+">>"+r.bytesAsString();e||(e=this.activeContext.contextMethod());var i;if(this.allMethodsDo(function(t,r,n){return r===e?i=t.className()+">>"+n.bytesAsString():void 0}),i)return i;if(t){var n=t.pointers[Squeak.Context_receiver];return"("+n+")>>?"}return"?>>?"},allInstancesOf:function(t,i){"string"==typeof t&&(t=this.globalNamed(t));for(var r=[],e=this.image.someInstanceOf(t);e;)i?i(e):r.push(e),e=this.image.nextInstanceAfter(e);return r},globalNamed:function(e){return this.allGlobalsDo(function(t,i){return t.bytesAsString()===e?i:void 0})},allGlobalsDo:function(n){for(var i=this.globals,e=0;e<i.length;e++){var t=i[e];if(!t.isNil){var r=n(t.pointers[0],t.pointers[1]);if(r)return r}}},allMethodsDo:function(e){this.allGlobalsDo(function(l,t){if(t.pointers&&t.pointers.length>=9)for(var a=[t,t.sqClass],n=0;n<a.length;n++){var o=a[n],i=o.pointers[1];if(i.pointers&&i.pointers[1]){var s=i.pointers[1].pointers;if(s)for(var u=i.pointers,r=0;r<s.length;r++)if(e.call(this,o,s[r],u[2+r]))return!0}}})},printStack:function(e,i){"number"==typeof e&&(i=e,e=null),e||(e=this.activeContext),i||(i=100);for(var t=[],u=Math.max(i,1e6);!e.isNil&&u-->0;)t.push(e),e=e.pointers[Squeak.Context_sender];var a=200;t.length>i+a&&(e.isNil||t.push("..."),t=t.slice(0,i).concat(["..."]).concat(t.slice(-a)));for(var r=[],o=t.length;o-->0;){var e=t[o];if(e.pointers){var n="",s=e.pointers[Squeak.Context_method];"number"==typeof s?(s=e.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],n="[] in "):e.pointers[Squeak.Context_closure].isNil||(n="[] in "),r.push(n+this.printMethod(s,e)+"\n")}else r.push("...\n")}return r.join("")},findMethod:function(e){var t,r=e.split(">>")[0],i=e.split(">>")[1];return this.allMethodsDo(function(n,s,e){return i.length==e.bytesSize()&&i==e.bytesAsString()&&r==n.className()?t=s:void 0}),t},breakNow:function(e){e&&console.log("Break: "+e),this.breakOutOfInterpreter="break"},breakOn:function(e){return this.breakOnMethod=e&&this.findMethod(e)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1,this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=!0,this.breakOnContextReturned=null},printActiveContext:function(){for(var t=this.activeContext,s="number"==typeof t.pointers[Squeak.BlockContext_argumentCount],l=t.pointers[Squeak.Context_closure],d=!s&&!l.isNil,o=s?t.pointers[Squeak.BlockContext_home]:t,p=d?l.pointers[Squeak.Closure_numArgs]:o.pointers[Squeak.Context_method].methodTempCount(),a=this.decodeSqueakSP(0),v=o.contextSizeWithStack(this)-1,c=a+1,k=c+p-1,n="",e=a;v>=e;e++){var i=o.pointers[e],f=i.sqInstName?i.sqInstName():i.toString(),r="";e==a?r="=rcvr":k>=e&&(r="=tmp"+(e-c)),n+="\nctx["+e+"]"+r+": "+f}if(s){n+="\n";for(var m=t.pointers[3],u=this.decodeSqueakSP(1),h=u+m,e=u;e<=this.sp;e++){var i=t.pointers[e],f=i.sqInstName?i.sqInstName():i.toString(),r="";h>=e&&(r="=arg"+(e-u)),n+="\nblk["+e+"]"+r+": "+f}}return n},printAllProcesses:function(){for(var a=this.specialObjects[Squeak.splOb_SchedulerAssociation],n=a.pointers[Squeak.Assn_value],o=n.pointers[Squeak.ProcSched_activeProcess],i="Active: "+this.printProcess(o,!0),s=n.pointers[Squeak.ProcSched_processLists].pointers,r=s.length-1;r>=0;r--)for(var e=s[r].pointers[Squeak.LinkedList_firstLink];!e.isNil;)i+="\nRunnable: "+this.printProcess(e),e=e.pointers[Squeak.Link_nextLink];for(var u=this.specialObjects[Squeak.splOb_ClassSemaphore],t=this.image.someInstanceOf(u);t;){for(var e=t.pointers[Squeak.LinkedList_firstLink];!e.isNil;)i+="\nWaiting: "+this.printProcess(e),e=e.pointers[Squeak.Link_nextLink];t=this.image.nextInstanceAfter(t)}return i},printProcess:function(e,t){var i=e.pointers[Squeak.Proc_suspendedContext],r=e.pointers[Squeak.Proc_priority],n=this.printStack(t?null:i);return e.toString()+" at priority "+r+"\n"+n},printByteCodes:function(e,t,i,r){e||(e=this.method);var n=new Squeak.InstructionPrinter(e,this);return n.printInstructions(t,i,r)},willSendOrReturn:function(){var e=this.method.bytes[this.pc];if(e>=120&&125>=e)return!0;if(131>e||200==e)return!1;if(e>=176)return!0;if(134>=e){var t;if(132===e){if(this.method.bytes[this.pc+1]>>5>1)return!1;t=this.method.bytes[this.pc+2]}else t=this.method.bytes[this.pc+1]&(134===e?63:31);var i=this.method.pointers[t+1];if("blockCopy:"!=i.bytesAsString())return!0}return!1}}),Object.subclass("Squeak.Primitives","initialization",{initialize:function(e,t){this.vm=e,this.display=t,this.display.vm=this.vm,this.oldPrims=!this.vm.image.hasClosures,this.allowAccessBeyondSP=this.oldPrims,this.deferDisplayUpdates=!1,this.semaphoresToSignal=[],this.initDisplay(),this.initAtCache(),this.initModules()},initModules:function(){this.loadedModules={},this.builtinModules={JavaScriptPlugin:this.findPluginFunctions("js_","",!0),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0)}},this.patchModules={ScratchPlugin:this.findPluginFunctions("scratch_")},this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},findPluginFunctions:function(t,i,s){i=i||"(initialise|shutdown|prim)";var r={},a=new RegExp("^"+t+i,"i");for(var e in this)if(a.test(e)&&"function"==typeof this[e]){var n=e;t&&(n=e[t.length].toLowerCase()+e.slice(t.length+1)),r[n]=s?e:this[e].bind(this)}return r},initDisplay:function(){this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}},"dispatch",{quickSendOther:function(t,e){switch(this.success=!0,e){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(t,e,i){if(this.success=!0,128>t)switch(t){case 1:return this.popNandPushIntIfOK(2,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(2,this.stackInteger(1)-this.stackInteger(0));case 3:return this.pop2andPushBoolIfOK(this.stackInteger(1)<this.stackInteger(0));case 4:return this.pop2andPushBoolIfOK(this.stackInteger(1)>this.stackInteger(0));case 5:return this.pop2andPushBoolIfOK(this.stackInteger(1)<=this.stackInteger(0));case 6:return this.pop2andPushBoolIfOK(this.stackInteger(1)>=this.stackInteger(0));case 7:return this.pop2andPushBoolIfOK(this.stackInteger(1)===this.stackInteger(0));case 8:return this.pop2andPushBoolIfOK(this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(2,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(2,this.vm.quickDivide(this.stackInteger(1),this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(2,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(2,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(2,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(2,this.doBitAnd());case 15:return this.popNandPushIfOK(2,this.doBitOr());case 16:return this.popNandPushIfOK(2,this.doBitXor());case 17:return this.popNandPushIfOK(2,this.doBitShift());case 18:return this.primitiveMakePoint(e,!1);case 19:return!1;case 20:return!1;case 21:return!1;case 22:return!1;case 23:return!1;case 24:return!1;case 25:return!1;case 26:return!1;case 27:return!1;case 28:return!1;case 29:return!1;case 30:return!1;case 31:return!1;case 32:return!1;case 33:return!1;case 34:return!1;case 35:return!1;case 36:return!1;case 37:return!1;case 38:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(2,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(2,this.stackFloat(1)-this.stackFloat(0));case 43:return this.pop2andPushBoolIfOK(this.stackFloat(1)<this.stackFloat(0));case 44:return this.pop2andPushBoolIfOK(this.stackFloat(1)>this.stackFloat(0));case 45:return this.pop2andPushBoolIfOK(this.stackFloat(1)<=this.stackFloat(0));case 46:return this.pop2andPushBoolIfOK(this.stackFloat(1)>=this.stackFloat(0));case 47:return this.pop2andPushBoolIfOK(this.stackFloat(1)===this.stackFloat(0));case 48:return this.pop2andPushBoolIfOK(this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(2,this.stackFloat(1)*this.stackFloat(0));case 50:return this.popNandPushFloatIfOK(2,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return!1;case 53:return this.popNandPushIntIfOK(1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(2,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(1,Math.sin(this.stackFloat(0)));case 57:return this.popNandPushFloatIfOK(1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(1,this.objectSize(!1));case 63:return this.popNandPushIfOK(2,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(3,this.objectAtPut(!1,!0,!1));case 65:return!1;case 66:return!1;case 67:return!1;case 68:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(2,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(e,!1);case 73:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(1,this.stackNonInteger(0).hash);case 76:return this.primitiveStoreStackp(e);case 77:return this.popNandPushIfOK(1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(e);case 80:return this.popNandPushIfOK(2,this.doBlockCopy());case 81:return this.primitiveBlockValue(e);case 82:return this.primitiveBlockValueWithArgs(e);case 83:return this.vm.primitivePerform(e);case 84:return this.vm.primitivePerformWithArgs(e,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(e);case 91:return this.primitiveTestDisplayDepth(e);case 93:return this.primitiveInputSemaphore(e);case 94:return this.primitiveGetNextEvent(e);case 95:return this.primitiveInputWord(e);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",e);case 97:return this.primitiveSnapshot(e);case 99:return this.primitiveLoadImageSegment(e);case 100:return this.vm.primitivePerformWithArgs(e,!0);case 101:return this.primitiveBeCursor(e);case 102:return this.primitiveBeDisplay(e);case 103:return!1;case 104:return!1;case 105:return this.popNandPushIfOK(5,this.doStringReplace());case 106:return this.primitiveScreenSize(e);case 107:return this.primitiveMouseButtons(e);case 108:return this.primitiveKeyboardNext(e);case 109:return this.primitiveKeyboardPeek(e);case 110:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(e);case 114:return this.primitiveExitToDebugger(e);case 115:return this.primitiveChangeClass(e);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());case 117:return this.doNamedPrimitive(e,i);case 118:return this.primitiveDoPrimitiveWithArgs(e);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return!1;case 121:return this.primitiveImageName(e);case 122:return this.primitiveReverseDisplay(e);case 124:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(2,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(e);case 127:return this.primitiveShowDisplayRect(e)}else if(256>t)switch(t){case 128:return this.primitiveArrayBecome(e,!0);case 129:return this.popNandPushIfOK(1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(e);case 131:return this.popNandPushIfOK(1,this.vm.image.partialGC());case 132:return this.pop2andPushBoolIfOK(this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return!0;case 134:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(e);case 137:return this.popNandPushIfOK(1,this.secondClock());case 138:return this.popNandPushIfOK(1,this.someObject());case 139:return this.popNandPushIfOK(1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(e);case 141:return this.primitiveClipboardText(e);case 142:return this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(e);case 145:return this.primitiveConstantFill(e);case 146:return this.namedPrimitive("JoystickTabletPlugin","primitiveReadJoystick",e);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",e);case 148:return this.popNandPushIfOK(1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(e);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(e);case 151:if(this.oldPrims)return this.primitiveFileClose(e);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(e);case 153:if(this.oldPrims)return this.primitiveFileOpen(e);case 154:if(this.oldPrims)return this.primitiveFileRead(e);case 155:if(this.oldPrims)return this.primitiveFileSetPosition(e);case 156:if(this.oldPrims)return this.primitiveFileDelete(e);case 157:if(this.oldPrims)return this.primitiveFileSize(e);case 158:if(this.oldPrims)return this.primitiveFileWrite(e);case 159:if(this.oldPrims)return this.primitiveFileRename(e);case 160:if(this.oldPrims)return this.primitiveDirectoryCreate(e);case 161:if(this.oldPrims)return this.primitiveDirectoryDelimitor(e);case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(e);case 163:if(this.oldPrims)return this.primitiveDirectoryDelete(e);break;case 165:case 166:return this.primitiveIntegerAtAndPut(e);case 167:return!1;case 168:return this.primitiveCopyObject(e);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(e):this.primitiveNotIdentical(e);case 170:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStart",e);case 171:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartWithSemaphore",e);case 172:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStop",e);case 173:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",e);case 174:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",e);case 175:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",e);case 176:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",e);case 177:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",e);case 178:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primPluckedSoundmixSampleCountintostartingAtpan",e);case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",e);case 180:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",e);case 181:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",e);case 182:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",e);case 183:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",e);case 184:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",e);case 185:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",e);break;case 188:if(!this.oldPrims)return this.primitiveExecuteMethodArgsArray(e);break;case 189:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",e);case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",e);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",e);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",e);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",e);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",e);
break;case 195:return!1;case 196:return!1;case 197:return!1;case 198:return!1;case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",e):this.primitiveClosureCopyWithCopiedValues(e);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",e):this.primitiveClosureValue(e);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",e):this.primitiveClosureValue(e);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",e):this.primitiveClosureValue(e);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAddressLookupResult",e):this.primitiveClosureValue(e);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",e):this.primitiveClosureValue(e);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",e):this.primitiveClosureValueWithArgs(e);case 207:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverStatus",e);case 208:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverError",e);case 209:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCreate",e);break;case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",e):this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",e):this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 212:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketError",e);case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",e);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",e);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",e);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",e);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketConnectToPort",e);case 218:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketListenOnPort",e);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",e);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",e);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",e):this.primitiveClosureValueNoContextSwitch(e);case 222:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",e):this.primitiveClosureValueNoContextSwitch(e);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",e);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",e);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(e);case 231:return this.primitiveForceDisplayUpdate(e);case 233:return this.primitiveSetFullScreen(e);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveDecompressFromByteArray",e);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",e);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",e);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",e);case 238:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",e);case 239:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortClose",e);break;case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",e):this.popNandPushIfOK(1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",e):this.popNandPushIfOK(1,this.microsecondClockLocal());case 243:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",e);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",e);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",e);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",e);break;case 248:return this.vm.primitiveInvokeObjectAsMethod(e,i);case 249:return this.primitiveArrayBecome(e,!1);case 254:return this.primitiveVMParameter(e)}else switch(t){case 521:return this.namedPrimitive("MIDIPlugin","primitiveMIDIClosePort",e);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",e);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",e);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",e);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",e);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",e);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",e);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",e);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",e);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",e);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",e);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",e);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",e);case 571:return this.primitiveUnloadModule(e);case 572:return this.primitiveListBuiltinModule(e);case 573:return this.primitiveListLoadedModule(e)}return console.error("primitive "+t+" not implemented yet"),!1},namedPrimitive:function(e,r,n){var t=""===e?this:this.loadedModules[e];void 0===t&&(t=this.loadModule(e),this.loadedModules[e]=t);var i=!1;if(t){this.interpreterProxy.argCount=n;var s=t[r];"function"==typeof s?i=t[r](n):"string"==typeof s?i=this[s](n):this.vm.warnOnce("missing primitive: "+e+"."+r)}else this.vm.warnOnce("missing module: "+e+" ("+r+")");return i===!0||i===!1?i:this.success},doNamedPrimitive:function(i,e){if(e.pointersSize()<2)return!1;var t=e.pointers[1];if(4!==t.pointersSize())return!1;this.primMethod=e;var r=t.pointers[0].bytesAsString(),n=t.pointers[1].bytesAsString();return this.namedPrimitive(r,n,i)},fakePrimitive:function(i,e,t){return this.vm.warnOnce("faking primitive: "+i),void 0===e?this.vm.popN(t):this.vm.popNandPush(t+1,this.makeStObject(e)),!0}},"modules",{loadModule:function(e){var t=Squeak.externalModules[e]||this.builtinModules[e];if(!t)return null;if(this.patchModules[e]&&this.patchModule(t,e),t.setInterpreter&&!t.setInterpreter(this.interpreterProxy))return console.log("Wrong interpreter proxy version: "+e),null;var i=t.initialiseModule;return"function"==typeof i?t.initialiseModule():"string"==typeof i&&this[i](),this.interpreterProxy.failed()?(console.log("Module initialization failed: "+e),null):(console.log("Loaded module: "+e),t)},patchModule:function(i,r){var e=this.patchModules[r];for(var t in e)i[t]=e[t]},unloadModule:function(t){var e=this.loadedModules[t];if(!t||!e||e===this)return null;delete this.loadedModules[t];var i=e.unloadModule;return"function"==typeof i?e.unloadModule(this):"string"==typeof i&&this[i](this),console.log("Unloaded module: "+t),e},loadFunctionFrom:function(r,t){var e=""===t?this:this.loadedModules[t];if(void 0===e&&(e=this.loadModule(t),this.loadedModules[t]=e),!e)return null;var i=e[r];return"function"==typeof i?i.bind(e):"string"==typeof i?this[i].bind(this):(this.vm.warnOnce("missing primitive: "+t+"."+r),null)},primitiveUnloadModule:function(t){var e=this.stackNonInteger(0).bytesAsString();return e?(this.unloadModule(e),this.popNIfOK(t)):!1},primitiveListBuiltinModule:function(e){var t=this.stackInteger(0)-1;if(!this.success)return!1;var i=Object.keys(this.builtinModules);return this.popNandPushIfOK(e+1,this.makeStObject(i[t]))},primitiveListLoadedModule:function(r){var n=this.stackInteger(0)-1;if(!this.success)return!1;var t=[];for(var i in this.loadedModules){var e=this.loadedModules[i];if(e){var s=e.getModuleName?e.getModuleName():i;t.push(s)}}return this.popNandPushIfOK(r+1,this.makeStObject(t[n]))}},"stack access",{popNIfOK:function(e){return this.success?(this.vm.popN(e),!0):!1},pop2andPushBoolIfOK:function(e){return this.vm.success=this.success,this.vm.pop2AndPushBoolResult(e)},popNandPushIfOK:function(t,e){return this.success&&null!=e?(this.vm.popNandPush(t,e),!0):!1},popNandPushIntIfOK:function(t,e){return this.success&&this.vm.canBeSmallInt(e)?this.popNandPushIfOK(t,e):!1},popNandPushFloatIfOK:function(e,t){return this.success?this.popNandPushIfOK(e,this.makeFloat(t)):!1},stackNonInteger:function(e){return this.checkNonInteger(this.vm.stackValue(e))},stackInteger:function(e){return this.checkSmallInt(this.vm.stackValue(e))},stackPos32BitInt:function(e){return this.positive32BitValueOf(this.vm.stackValue(e))},pos32BitIntFor:function(e){if(e>=0&&e<=Squeak.MaxSmallInt)return e;for(var r=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],i=this.vm.instantiateClass(r,4),n=i.bytes,t=0;4>t;t++)n[t]=e>>>8*t&255;return i},pos64BitIntFor:function(e){if(4294967295>=e)return this.pos32BitIntFor(e);for(var i=0xffffffffff>=e?5:0xffffffffffff>=e?6:72057594037927940>=e?7:8,n=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],r=this.vm.instantiateClass(n,i),s=r.bytes,t=0;i>t;t++)s[t]=255&e,e/=256;return r},stackSigned32BitInt:function(r){var e=this.vm.stackValue(r);if("number"==typeof e)return e;if(4!==e.bytesSize())return this.success=!1,0;for(var n=e.bytes,i=0,t=0;4>t;t++)i+=(255&n[t])*(1<<8*t);return this.isA(e,Squeak.splOb_ClassLargePositiveInteger)?i:this.isA(e,Squeak.splOb_ClassLargeNegativeInteger)?-i:(this.success=!1,0)},signed32BitIntegerFor:function(e){if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return e;for(var i=0>e,n=i?-e:e,s=i?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,r=this.vm.instantiateClass(this.vm.specialObjects[s],4),a=r.bytes,t=0;4>t;t++)a[t]=n>>>8*t&255;return r},stackFloat:function(e){return this.checkFloat(this.vm.stackValue(e))},stackBoolean:function(e){return this.checkBoolean(this.vm.stackValue(e))}},"numbers",{doBitAnd:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e&t):0},doBitOr:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e|t):0},doBitXor:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e^t):0},doBitShift:function(){var e=this.stackPos32BitInt(1),t=this.stackInteger(0);if(!this.success)return 0;var i=this.vm.safeShift(e,t);return i>0?this.pos32BitIntFor(this.vm.safeShift(e,t)):(this.success=!1,0)},safeFDiv:function(t,e){return 0===e?(this.success=!1,1):t/e},floatAsSmallInt:function(e){var t=e>=0?Math.floor(e):Math.ceil(e);return this.ensureSmallInt(t)},frexp_exponent:function(t){if(0==t)return 0;var e=new DataView(new ArrayBuffer(8));e.setFloat64(0,t);var i=e.getUint32(0)>>>20&2047;0===i&&(e.setFloat64(0,t*Math.pow(2,64)),i=(e.getUint32(0)>>>20&2047)-64);var r=i-1022;return r},ldexp:function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):-1074>e?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)}},"utils",{floatOrInt:function(e){return e.isFloat?e.float:"number"==typeof e?e:0},positive32BitValueOf:function(e){if("number"==typeof e)return e>=0?e:(this.success=!1,0);if(!this.isA(e,Squeak.splOb_ClassLargePositiveInteger)||4!==e.bytesSize())return this.success=!1,0;for(var r=e.bytes,i=0,t=0;4>t;t++)i+=(255&r[t])*(1<<8*t);return i},checkFloat:function(e){return e.isFloat?e.float:"number"==typeof e?e:(this.success=!1,0)},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,0)},checkNonInteger:function(e){return"number"!=typeof e?e:(this.success=!1,this.vm.nilObj)},checkBoolean:function(e){return e.isTrue?!0:e.isFalse?!1:this.success=!1},indexableSize:function(e){if("number"==typeof e)return-1;var t=e.format;return 2>t?-1:3===t&&this.vm.isContext(e)&&!this.allowAccessBeyondSP?e.pointers[Squeak.Context_stackPointer]:6>t?e.pointersSize()-e.instSize():8>t?e.wordsSize():12>t?e.bytesSize():e.bytesSize()+4*e.pointersSize()},isA:function(e,t){return e.sqClass===this.vm.specialObjects[t]},isKindOf:function(t,i){for(var e=t.sqClass,r=this.vm.specialObjects[i];!e.isNil;){if(e===r)return!0;e=e.pointers[Squeak.Class_superclass]}return!1},isAssociation:function(e){return"number"!=typeof e&&2==e.pointersSize()},ensureSmallInt:function(e){return e===(0|e)&&this.vm.canBeSmallInt(e)?e:(this.success=!1,0)},charFromInt:function(e){var t=this.vm.specialObjects[Squeak.splOb_CharacterTable];return t.pointers[e]},makeFloat:function(t){var i=this.vm.specialObjects[Squeak.splOb_ClassFloat],e=this.vm.instantiateClass(i,2);return e.float=t,e},makeLargeIfNeeded:function(e){return this.vm.canBeSmallInt(e)?e:this.makeLargeInt(e)},makeLargeInt:function(e){if(0>e)throw Error("negative large ints not implemented yet");if(e>4294967295)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(e)},makePointWithXandY:function(t,i){var r=this.vm.specialObjects[Squeak.splOb_ClassPoint],e=this.vm.instantiateClass(r,0);return e.pointers[Squeak.Point_x]=t,e.pointers[Squeak.Point_y]=i,e},makeStArray:function(t,r){for(var i=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],t.length),e=0;e<t.length;e++)i.pointers[e]=this.makeStObject(t[e],r);return i},makeStString:function(i){for(var e=[],t=0;t<i.length;++t)e.push(255&i.charCodeAt(t));var r=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],e.length);return r.bytes=e,r},makeStObject:function(e,t){if(void 0===e||null===e)return this.vm.nilObj;if(e===!0)return this.vm.trueObj;if(e===!1)return this.vm.falseObj;if(e.sqClass)return e;if("number"==typeof e)return e===(0|e)?this.makeLargeIfNeeded(e):this.makeFloat(e);if(t){var i=this.vm.instantiateClass(t,0);return i.jsObject=e,i}if("string"==typeof e||e.constructor===Uint8Array)return this.makeStString(e);if(e.constructor===Array)return this.makeStArray(e);throw Error("cannot make smalltalk object")},pointsTo:function(e,t){return e.pointers?e.pointers.indexOf(t)>=0:!1},asUint8Array:function(e){if(e.constructor===Uint8Array)return e;if(e.constructor===ArrayBuffer)return new Uint8Array(e);if("string"==typeof e){for(var i=new Uint8Array(e.length),t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}throw Error("unknown buffer type")},filenameToSqueak:function(t){var i="/"!==t[0]?"/":"",e="/SqueakJS"+i+t;return this.emulateMac&&(e=("Macintosh HD"+e).replace(/\//g,"â‚¬").replace(/:/g,"/").replace(/â‚¬/g,":")),e},filenameFromSqueak:function(e){var t=this.emulateMac?e.replace(/^[^:]*:/,":").replace(/\//g,"â‚¬").replace(/:/g,"/").replace(/â‚¬/g,":"):e;return t=t.replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(a,o,r){var e=this.stackNonInteger(1),t=this.stackPos32BitInt(0);if(!this.success)return e;var i;if(a){if(i=this.atCache[e.hash&this.atCacheMask],i.array!==e)return this.success=!1,e}else{if(e.isFloat){var n=e.floatData();return 1==t?this.pos32BitIntFor(n.getUint32(0,!1)):2==t?this.pos32BitIntFor(n.getUint32(4,!1)):(this.success=!1,e)}i=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],e,o,r)}if(1>t||t>i.size)return this.success=!1,e;if(r)return e.pointers[t-1];if(e.format<6)return e.pointers[t-1+i.ivarOffset];if(e.format<8)return this.pos32BitIntFor(e.words[t-1]);if(e.format<12)return i.convertChars?this.charFromInt(255&e.bytes[t-1]):255&e.bytes[t-1];var s=4*e.pointersSize();return 0>t-1-s?(this.success=!1,e):255&e.bytes[t-1-s]},objectAtPut:function(c,s,u){var e=this.stackNonInteger(2),i=this.stackPos32BitInt(1);if(!this.success)return e;var n;if(c){if(n=this.atPutCache[e.hash&this.atCacheMask],n.array!==e)return this.success=!1,e}else{if(e.isFloat){var l=this.stackPos32BitInt(0);if(!this.success||1!=i&&2!=i)this.success=!1;else{var o=e.floatData();o.setUint32(1==i?0:4,l,!1),e.float=o.getFloat64(0)}return this.vm.stackValue(0)}n=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],e,s,u)}if(1>i||i>n.size)return this.success=!1,e;var t=this.vm.stackValue(0);if(u)return e.pointers[i-1]=t;if(e.format<6)return e.pointers[i-1+n.ivarOffset]=t;var r;if(e.format<8)return r=this.stackPos32BitInt(0),this.success&&(e.words[i-1]=r),t;if(s){if(t.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,t;if(r=t.pointers[0],"number"!=typeof r)return this.success=!1,t}else{if("number"!=typeof t)return this.success=!1,t;r=t}if(0>r||r>255)return this.success=!1,t;if(e.format<8)return e.bytes[i-1]=r;var a=4*e.pointersSize();return 0>i-1-a?(this.success=!1,e):(e.bytes[i-1-a]=r,t)},objectSize:function(i){var e=this.vm.stackValue(0),t=-1;return i?e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?t=e.pointersSize():e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(t=e.bytesSize()):t=this.indexableSize(e),-1===t?(this.success=!1,-1):this.pos32BitIntFor(t)},initAtCache:function(){this.atCacheSize=32,this.atCacheMask=this.atCacheSize-1,this.atCache=[],this.atPutCache=[],this.nonCachedInfo={};for(var e=0;e<this.atCacheSize;e++)this.atCache.push({}),this.atPutCache.push({})},clearAtCache:function(){this.nonCachedInfo.array=null;for(var e=0;e<this.atCacheSize;e++)this.atCache[e].array=null,this.atPutCache[e].array=null},makeAtCacheInfo:function(i,r,e,n,s){var t,a=this.vm.verifyAtSelector===r&&this.vm.verifyAtClass===e.sqClass&&!(3===e.format&&this.vm.isContext(e));return t=a?i[e.hash&this.atCacheMask]:this.nonCachedInfo,t.array=e,t.convertChars=n,s?(t.size=e.instSize()+Math.max(0,this.indexableSize(e)),t.ivarOffset=0):(t.size=this.indexableSize(e),t.ivarOffset=e.format<6?e.instSize():0),t}},"basic",{instantiateClass:function(t,e){return 4*e>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory"),this.success=!1,null):this.vm.instantiateClass(t,e)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(e){return this.vm.image.objectAfter(e)||0},someInstanceOf:function(t){var e=this.vm.image.someInstanceOf(t);return e?e:(this.success=!1,0)},nextInstanceAfter:function(t){var e=this.vm.image.nextInstanceAfter(t);return e?e:(this.success=!1,0)},primitiveFullGC:function(){this.vm.image.fullGC("primitive");var e=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(e))},primitiveMakePoint:function(i,r){var e=this.vm.stackValue(1),t=this.vm.stackValue(0);return r&&(this.checkFloat(e),this.checkFloat(t),!this.success)?!1:(this.vm.popNandPush(1+i,this.makePointWithXandY(e,t)),!0)},primitiveStoreStackp:function(r){var e=this.stackNonInteger(1),t=this.stackInteger(0);if(!this.success||0>t||this.vm.decodeSqueakSP(t)>=e.pointers.length)return!1;for(var i=e.pointers[Squeak.Context_stackPointer];t>i;)e.pointers[this.vm.decodeSqueakSP(++i)]=this.vm.nilObj;return e.pointers[Squeak.Context_stackPointer]=t,this.vm.popN(r),!0},primitiveChangeClass:function(i){if(1!==i)return!1;var e=this.stackNonInteger(1),t=this.stackNonInteger(0);return this.success?e.format!==t.format||e.sqClass.isCompact!==t.sqClass.isCompact||e.sqClass.classInstSize()!==t.sqClass.classInstSize()?!1:(e.sqClass=t.sqClass,this.popNIfOK(1)):!1},primitiveDoPrimitiveWithArgs:function(){var t=this.stackNonInteger(0),r=this.stackInteger(1);if(!this.success)return!1;var e=t.pointersSize(),n=this.vm.activeContext.pointersSize();if(this.vm.sp+e>=n)return!1;this.vm.popN(2);for(var i=0;e>i;i++)this.vm.push(t.pointers[i]);return this.vm.tryPrimitive(r,e)?!0:(this.vm.popN(e),this.vm.push(r),this.vm.push(t),!1)},primitiveShortAtAndPut:function(t){var n=this.stackNonInteger(t),i=this.stackInteger(t-1)-1,r=n.wordsAsInt16Array();if(!this.success||!r||0>i||i>=r.length)return!1;var e;if(2>t)e=r[i];else{if(e=this.stackInteger(0),-32768>e||e>32767)return!1;r[i]=e}return this.popNandPushIfOK(t+1,e),!0},primitiveIntegerAtAndPut:function(e){var n=this.stackNonInteger(e),t=this.stackInteger(e-1)-1,i=n.wordsAsInt32Array();if(!this.success||!i||0>t||t>=i.length)return!1;var r;if(2>e)r=this.signed32BitIntegerFor(i[t]);else{if(r=this.stackSigned32BitInt(0),!this.success)return!1;i[t]=r}return this.popNandPushIfOK(e+1,r),!0},primitiveConstantFill:function(n){var e=this.stackNonInteger(1),r=this.stackPos32BitInt(0);if(!this.success||!e.isWordsOrBytes())return!1;var t=e.words||e.bytes;if(t){if(t===e.bytes&&r>255)return!1;for(var i=0;i<t.length;i++)t[i]=r}return this.vm.popN(n),!0},primitiveNewMethod:function(r){var t=this.stackInteger(0),n=this.stackInteger(1);if(!this.success)return 0;var s=t>>9&255,e=this.vm.instantiateClass(this.vm.stackValue(2),n);e.pointers=[t];for(var i=0;s>i;i++)e.pointers.push(this.vm.nilObj);return this.vm.popNandPush(1+r,e),this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=e),!0},primitiveExecuteMethodArgsArray:function(r){var e=this.stackNonInteger(0),n=this.stackNonInteger(1),s=this.vm.stackValue(2);if(!this.success||!this.vm.isMethod(e)||r>4)return!1;var t=e.methodNumArgs();if(t!==n.pointersSize())return!1;this.vm.popNandPush(r+1,s);for(var i=0;t>i;i++)this.vm.push(n.pointers[i]);return this.vm.executeNewMethod(s,e,t,e.methodPrimitiveIndex(),null,null),!0},primitiveArrayBecome:function(e,t){var i=this.stackNonInteger(e),r=this.stackNonInteger(e-1),n=e>1?this.stackBoolean(e-2):!0;return this.success?(this.success=this.vm.image.bulkBecome(i.pointers,r.pointers,t,n),this.popNIfOK(e)):!1},doStringReplace:function(){var e=this.stackNonInteger(4),i=this.stackInteger(3)-1,n=this.stackInteger(2)-i,a=this.stackNonInteger(1),r=this.stackInteger(0)-1;if(!this.success)return e;var o=a.format,u=e.format;if(8>u){if(u!=o)return this.success=!1,e;if((12&u)!=(12&o))return this.success=!1,e}if(4>o){var s=a.pointersSize(),l=a.instSize();if(r+=l,0>r||r+n>s)return this.success=!1,e;s=e.pointersSize();var c=e.instSize();if(i+=c,0>i||i+n>s)return this.success=!1,e;for(var t=0;n>t;t++)e.pointers[i+t]=a.pointers[r+t];return e}if(8>o){var s=a.wordsSize();if(0>r||r+n>s)return this.success=!1,e;if(s=e.wordsSize(),0>i||i+n>s)return this.success=!1,e;for(var t=0;n>t;t++)e.words[i+t]=a.words[r+t];return e}var s=a.bytesSize();if(0>r||r+n>s)return this.success=!1,e;if(s=e.bytesSize(),0>i||i+n>s)return this.success=!1,e;for(var t=0;n>t;t++)e.bytes[i+t]=a.bytes[r+t];return e},primitiveCopyObject:function(n){var e=this.stackNonInteger(1),i=this.stackNonInteger(0),r=e.pointersSize();if(!this.success||e.isWordsOrBytes()||e.sqClass!==i.sqClass||r!==i.pointersSize())return!1;for(var t=0;r>t;t++)i.pointers[t]=e.pointers[t];return this.vm.pop(n),!0},primitiveLoadImageSegment:function(r){var e=this.stackNonInteger(1),t=this.stackNonInteger(0);if(!e.words||!t.pointers)return!1;var i=this.vm.image.loadImageSegment(e,t);return i?this.popNandPushIfOK(r+1,i):!1}},"blocks/closures",{doBlockCopy:function(){var i=this.vm.stackValue(1),n=this.stackInteger(0),e=i;if(this.vm.isContext(e)||(this.success=!1),!this.success)return i;"number"==typeof e.pointers[Squeak.Context_method]&&(e=e.pointers[Squeak.BlockContext_home]);var s=e.pointersSize()-e.instSize(),t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],s),r=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method);return t.pointers[Squeak.BlockContext_initialIP]=r,t.pointers[Squeak.Context_instructionPointer]=r,t.pointers[Squeak.Context_stackPointer]=0,t.pointers[Squeak.BlockContext_argumentCount]=n,t.pointers[Squeak.BlockContext_home]=e,t.pointers[Squeak.Context_sender]=this.vm.nilObj,t},primitiveBlockValue:function(t){var i=this.vm.stackValue(t);if(!this.isA(i,Squeak.splOb_ClassBlockContext))return!1;var e=i,r=e.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof r)return!1;if(r!=t)return!1;if(!e.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-t+1,e.pointers,Squeak.Context_tempFrameStart,t);var n=e.pointers[Squeak.BlockContext_initialIP];return e.pointers[Squeak.Context_instructionPointer]=n,e.pointers[Squeak.Context_stackPointer]=t,e.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(t+1),this.vm.newActiveContext(e),!0},primitiveBlockValueWithArgs:function(r){var e=this.vm.stackValue(1),i=this.vm.stackValue(0);if(!this.isA(e,Squeak.splOb_ClassBlockContext))return!1;if(!this.isA(i,Squeak.splOb_ClassArray))return!1;var t=e.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof t)return!1;if(t!=i.pointersSize())return!1;if(!e.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(i.pointers,0,e.pointers,Squeak.Context_tempFrameStart,t);var n=e.pointers[Squeak.BlockContext_initialIP];return e.pointers[Squeak.Context_instructionPointer]=n,e.pointers[Squeak.Context_stackPointer]=t,e.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(r+1),this.vm.newActiveContext(e),!0},primitiveClosureCopyWithCopiedValues:function(){return this.vm.breakNow("primitiveClosureCopyWithCopiedValues"),!1},primitiveClosureValue:function(e){var t=this.vm.stackValue(e),i=t.pointers[Squeak.Closure_numArgs];return e!==i?!1:this.activateNewClosureMethod(t,e)},primitiveClosureValueWithArgs:function(n){var i=this.vm.top(),e=i.pointersSize(),r=this.vm.stackValue(n),s=r.pointers[Squeak.Closure_numArgs];if(e!==s)return!1;this.vm.pop();for(var t=0;e>t;t++)this.vm.push(i.pointers[t]);return this.activateNewClosureMethod(r,e)},primitiveClosureValueNoContextSwitch:function(e){return this.primitiveClosureValue(e)},activateNewClosureMethod:function(i,r){var n=i.pointers[Squeak.Closure_outerContext],o=n.pointers[Squeak.Context_method],e=this.vm.allocateOrRecycleContext(o.methodNeedsLargeFrame()),s=i.pointers.length-Squeak.Closure_firstCopiedValue;e.pointers[Squeak.Context_sender]=this.vm.activeContext,e.pointers[Squeak.Context_instructionPointer]=i.pointers[Squeak.Closure_startpc],e.pointers[Squeak.Context_stackPointer]=r+s,e.pointers[Squeak.Context_method]=n.pointers[Squeak.Context_method],e.pointers[Squeak.Context_closure]=i,e.pointers[Squeak.Context_receiver]=n.pointers[Squeak.Context_receiver];for(var a=Squeak.Context_tempFrameStart,t=0;r>t;t++)e.pointers[a++]=this.vm.stackValue(r-t-1);for(var t=0;s>t;t++)e.pointers[a++]=i.pointers[Squeak.Closure_firstCopiedValue+t];return this.vm.popN(r+1),this.vm.newActiveContext(e),!0}},"scheduling",{primitiveResume:function(){return this.resume(this.vm.top()),!0},primitiveSuspend:function(){var e=this.getScheduler().pointers[Squeak.ProcSched_activeProcess];return this.vm.top()!==e?!1:(this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.pickTopProcess()),!0)},getScheduler:function(){var e=this.vm.specialObjects[Squeak.splOb_SchedulerAssociation];return e.pointers[Squeak.Assn_value]},resume:function(e){var t=this.getScheduler().pointers[Squeak.ProcSched_activeProcess],i=t.pointers[Squeak.Proc_priority],r=e.pointers[Squeak.Proc_priority];r>i?(this.putToSleep(t),this.transferTo(e)):this.putToSleep(e)},putToSleep:function(e){var t=e.pointers[Squeak.Proc_priority],i=this.getScheduler().pointers[Squeak.ProcSched_processLists],r=i.pointers[t-1];this.linkProcessToList(e,r)},transferTo:function(e){var t=this.getScheduler(),i=t.pointers[Squeak.ProcSched_activeProcess];t.pointers[Squeak.ProcSched_activeProcess]=e,i.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.newActiveContext(e.pointers[Squeak.Proc_suspendedContext]),e.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj,this.vm.reclaimableContextCount=0,this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow())},pickTopProcess:function(){var e,t=this.getScheduler().pointers[Squeak.ProcSched_processLists],i=t.pointersSize()-1;do{if(0>i)throw Error("scheduler could not find a runnable process");e=t.pointers[i--]}while(this.isEmptyList(e));return this.removeFirstLinkOfList(e)},linkProcessToList:function(t,e){if(this.isEmptyList(e))e.pointers[Squeak.LinkedList_firstLink]=t;else{var i=e.pointers[Squeak.LinkedList_lastLink];i.pointers[Squeak.Link_nextLink]=t}e.pointers[Squeak.LinkedList_lastLink]=t,t.pointers[Squeak.Proc_myList]=e},isEmptyList:function(e){return e.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(e){var t=e.pointers[Squeak.LinkedList_firstLink],i=e.pointers[Squeak.LinkedList_lastLink];if(t===i)e.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,e.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj;else{var r=t.pointers[Squeak.Link_nextLink];e.pointers[Squeak.LinkedList_firstLink]=r}return t.pointers[Squeak.Link_nextLink]=this.vm.nilObj,t},registerSemaphore:function(t){var e=this.vm.top();return this.vm.specialObjects[t]=this.isA(e,Squeak.splOb_ClassSemaphore)?e:this.vm.nilObj,this.vm.stackValue(1)},primitiveWait:function(){var e=this.vm.top();if(!this.isA(e,Squeak.splOb_ClassSemaphore))return!1;var t=e.pointers[Squeak.Semaphore_excessSignals];if(t>0)e.pointers[Squeak.Semaphore_excessSignals]=t-1;else{var i=this.getScheduler().pointers[Squeak.ProcSched_activeProcess];this.linkProcessToList(i,e),this.transferTo(this.pickTopProcess())}return!0},primitiveSignal:function(){var e=this.vm.top();return this.isA(e,Squeak.splOb_ClassSemaphore)?(this.synchronousSignal(e),!0):!1},synchronousSignal:function(e){this.isEmptyList(e)?e.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(e))},primitiveSignalAtMilliseconds:function(t){{var i=this.stackInteger(0),e=this.stackNonInteger(1);this.stackNonInteger(2)}return this.success?(this.isA(e,Squeak.splOb_ClassSemaphore)?(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=e,this.vm.nextWakeupTick=i):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0),this.vm.popN(t),!0):!1},signalSemaphoreWithIndex:function(e){this.semaphoresToSignal.push(e)},signalExternalSemaphores:function(){for(var t=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,i=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var r=this.semaphoresToSignal.shift(),e=t[r-1];e.sqClass==i&&this.synchronousSignal(e)}}},"vm functions",{primitiveGetAttribute:function(t){var i=this.stackInteger(0);if(!this.success)return!1;var e;switch(i){case 0:e=this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:e=this.display.documentName||null;break;case 2:e=this.display.documentName||null;break;case 1001:e=Squeak.platformName;break;case 1002:e=Squeak.osVersion;break;case 1003:e=Squeak.platformSubtype;break;case 1004:e=Squeak.vmVersion;break;case 1005:e=Squeak.windowSystem;break;case 1006:e=Squeak.vmBuild;break;case 1007:e=Squeak.vmVersion;break;case 1009:e=Squeak.vmVersion;break;default:return!1}return this.vm.popNandPush(t+1,this.makeStObject(e)),!0},setLowSpaceThreshold:function(){var e=this.stackInteger(0);return this.success&&(this.vm.lowSpaceThreshold=e),this.vm.stackValue(1)},primitiveVMParameter:function(r){var t=41;switch(r){case 0:for(var i=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],t),e=0;t>e;e++)i.pointers[e]=this.makeStObject(this.vmParameterAt(e+1));return this.popNandPushIfOK(1,i);case 1:var n=this.stackInteger(0);return this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(n)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(e){switch(e){case 1:return this.vm.image.oldSpaceBytes;case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return 1;case 10:return 0;case 11:return this.vm.image.gcTenured;case 40:return 4;
case 41:return this.vm.image.formatVersion()}return null},primitiveImageName:function(e){return 0==e?this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name))):(this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString()),window.localStorage.squeakImageName=this.vm.image.name,!0)},primitiveSnapshot:function(){this.vm.popNandPush(1,this.vm.trueObj),this.vm.storeContextRegisters();var e=this.getScheduler().pointers[Squeak.ProcSched_activeProcess];e.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.image.fullGC("snapshot");var t=this.vm.image.writeToBuffer();return Squeak.flushAllFiles(),Squeak.filePut(this.vm.image.name,t),this.vm.popNandPush(1,this.vm.falseObj),!0},primitiveQuit:function(){return Squeak.flushAllFiles(),this.display.quitFlag=!0,this.vm.breakNow("quit"),!0},primitiveExitToDebugger:function(){return this.vm.breakNow("debugger primitive"),!0},primitiveSetGCBiasToGrow:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,e)},primitiveSetGCBiasToGrowGCLimit:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,e)}},"display",{primitiveBeCursor:function(t){if(this.display.cursorCanvas){var e=this.loadForm(this.stackNonInteger(t),!0),s=1===t?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!e)return!1;var i=this.display.cursorCanvas,r=i.getContext("2d"),n={left:0,top:0,right:e.width,bottom:e.height};i.width=e.width,i.height=e.height,1===e.depth?s?(e=this.cursorMergeMask(e,s),this.showForm(r,e,n,[0,4278190335,4294967295,4278190080])):this.showForm(r,e,n,[0,4278190080]):this.showForm(r,e,n,!0),this.display.cursorOffsetX=e.offsetX,this.display.cursorOffsetY=e.offsetY}return this.vm.popN(t),!0},cursorMergeMask:function(t,a){for(var s=new Uint32Array(16),e=0;16>e;e++){for(var o=t.bits[e],u=a.bits[e],r=2147483648,n=0,i=0;16>i;i++)n=n|(u&r)>>i|(o&r)>>i+1,r>>>=1;s[e]=n}return{obj:t.obj,bits:s,depth:2,width:16,height:16,offsetX:t.offsetX,offsetY:t.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(e){var t=this.vm.stackValue(0);return this.vm.specialObjects[Squeak.splOb_TheDisplay]=t,this.vm.popN(e),!0},primitiveReverseDisplay:function(){return this.reverseDisplay=!this.reverseDisplay,this.redrawDisplay(),!0},primitiveShowDisplayRect:function(e){var t={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};return this.success?(this.redrawDisplay(t),this.vm.popN(e),!0):!1},redrawDisplay:function(t){var i=this.theDisplay(),e={left:0,top:0,right:i.width,bottom:i.height};t&&(t.left>e.left&&(e.left=t.left),t.right<e.right&&(e.right=t.right),t.top>e.top&&(e.top=t.top),t.bottom<e.bottom&&(e.bottom=t.bottom)),e.left<e.right&&e.top<e.bottom&&this.displayUpdate(i,e)},showForm:function(S,e,s,b){if(s){var o=s.left,r=s.top,h=s.right-o,f=s.bottom-r,n=S.createImageData(h,f),c=n.data;c.buffer||(c=new Uint8Array(h*f*4));var v=new Uint32Array(c.buffer);switch(e.depth){case 1:case 2:case 4:case 8:var i=b||this.swappedColors;if(!i){i=[];for(var m=0;256>m;m++){var a=this.indexedColors[m],y=(4278255360&a)+((16711680&a)>>16)+((255&a)<<16);i[m]=y}this.swappedColors=i}this.reverseDisplay&&!b&&(this.reversedColors||(this.reversedColors=i.map(function(e){return 16777215^e})),i=this.reversedColors);for(var O=(1<<e.depth)-1,F=32-(o%e.pixPerWord+1)*e.depth,t=0;f>t;t++){for(var p=e.pitch*r+(o/e.pixPerWord|0),l=F,d=e.bits[p],g=n.width*t,u=0;h>u;u++)v[g++]=i[d>>>l&O],(l-=e.depth)<0&&(l=32-e.depth,d=e.bits[++p]);r++}break;case 16:for(var F=o%2?0:16,t=0;f>t;t++){for(var p=e.pitch*r+(o/2|0),l=F,d=e.bits[p],g=n.width*t,u=0;h>u;u++){var k=d>>>l;v[g++]=((31744&k)>>7)+((992&k)<<6)+((31&k)<<19)+4278190080,(l-=16)<0&&(l=16,d=e.bits[++p])}r++}break;case 32:for(var I=b?0:4278190080,t=0;f>t;t++){for(var p=e.pitch*r+o,g=n.width*t,u=0;h>u;u++){var a=e.bits[p++],y=4278255360&a|(16711680&a)>>16|(255&a)<<16|I;v[g++]=y}r++}break;default:throw Error("depth not implemented")}n.data!==c&&n.data.set(c),S.putImageData(n,s.left,s.top)}},primitiveDeferDisplayUpdates:function(e){var t=this.stackBoolean(0);return this.success?(this.deferDisplayUpdates=t,this.vm.popN(e),!0):!1},primitiveForceDisplayUpdate:function(e){return this.vm.breakOut(),this.vm.popN(e),!0},primitiveScreenSize:function(t){var e=this.display,i=e.width||e.context.canvas.width,r=e.height||e.context.canvas.height;return this.popNandPushIfOK(t+1,this.makePointWithXandY(i,r))},primitiveSetFullScreen:function(t){var e=this.stackBoolean(0);if(!this.success)return!1;if(this.display.fullscreen!=e)if(this.display.fullscreenRequest){var i=this.vm.freeze();this.display.fullscreenRequest(e,function(){i()})}else this.display.fullscreen=e,this.vm.breakOut();return this.vm.popN(t),!0},primitiveTestDisplayDepth:function(){var e=[1,2,4,8,16,32];return this.pop2andPushBoolIfOK(e.indexOf(this.stackInteger(0))>=0)},loadForm:function(t,r){if(t.isNil)return null;var e={obj:t,bits:t.pointers[Squeak.Form_bits].wordsOrBytes(),depth:t.pointers[Squeak.Form_depth],width:t.pointers[Squeak.Form_width],height:t.pointers[Squeak.Form_height]};if(r){var i=t.pointers[Squeak.Form_offset];e.offsetX=i.pointers?i.pointers[Squeak.Point_x]:0,e.offsetY=i.pointers?i.pointers[Squeak.Point_y]:0}return 0===e.width||0===e.height?e:e.width>0&&e.height>0?(e.msb=e.depth>0,e.msb||(e.depth=-e.depth),e.depth>0?(e.pixPerWord=32/e.depth,e.pitch=(e.width+(e.pixPerWord-1))/e.pixPerWord|0,e.bits.length!==e.pitch*e.height?null:e):null):null},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(e,t){this.deferDisplayUpdates||e!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),t)},displayUpdate:function(e,t){this.showForm(this.display.context,e,t),this.display.lastTick=this.vm.lastTick,this.display.idle=0},primitiveBeep:function(i){var e=Squeak.startAudioOut();if(e){var t=e.createOscillator();t.connect(e.destination),t.frequency.value=880,t.noteOn(0),t.noteOff(e.currentTime+.2)}else this.vm.warnOnce("could not initialize audio");return this.popNIfOK(i)}},"input",{primitiveClipboardText:function(e){if(0===e){if("string"!=typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}else if(1===e){var t=this.vm.top();t.bytes&&(this.display.clipboardString=t.bytesAsString(),this.display.clipboardStringChanged=!0),this.vm.pop()}return!0},primitiveKeyboardNext:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(e){var t=this.display.keys.length;return this.popNandPushIfOK(e+1,t?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.buttons)),this.vm.breakOut(),this.display.idle++>20&&this.vm.goIdle(),!0},primitiveMousePoint:function(e){var t=this.ensureSmallInt(this.display.mouseX),i=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(e+1,this.makePointWithXandY(t,i))},primitiveInputSemaphore:function(){var e=this.stackInteger(0);return this.success?(this.inputEventSemaIndex=e,this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this),!0):!1},primitiveInputWord:function(){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(){this.display.idle++;var e=this.stackNonInteger(0);return this.display.getNextEvent?(this.display.getNextEvent(e.pointers,this.vm.startupTime),!0):!1}},"time",{primitiveRelinquishProcessorForMicroseconds:function(e){return this.vm.pop(e),this.vm.goIdle(),!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(e){this.vm.startupTime=Date.now()-e},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClockUTC:function(){var e=Date.now()-Squeak.EpochUTC;return this.pos64BitIntFor(1e3*e)},microsecondClockLocal:function(){var e=Date.now()-Squeak.Epoch;return this.pos64BitIntFor(1e3*e)}},"FilePlugin",{primitiveDirectoryCreate:function(t){var i=this.stackNonInteger(0);if(!this.success)return!1;var e=this.filenameFromSqueak(i.bytesAsString());if(this.success=Squeak.dirCreate(e),!this.success){var r=Squeak.splitFilePath(e);console.log("Directory not created: "+r.fullname)}return this.popNIfOK(t)},primitiveDirectoryDelete:function(e){var t=this.stackNonInteger(0);if(!this.success)return!1;var i=this.filenameFromSqueak(t.bytesAsString());return this.success=Squeak.dirDelete(i),this.popNIfOK(e)},primitiveDirectoryDelimitor:function(){var e=this.emulateMac?":":"/";return this.popNandPushIfOK(1,this.charFromInt(e.charCodeAt(0)))},primitiveDirectoryEntry:function(){return this.vm.warnOnce("Not yet implemented: primitiveDirectoryEntry"),!1},primitiveDirectoryLookup:function(s){var i=this.stackInteger(0),a=this.stackNonInteger(1);if(!this.success)return!1;var r=a.bytesAsString(),n=this.filenameFromSqueak(r),t=Squeak.dirList(n,!0);if(!t){var o=Squeak.splitFilePath(n);return console.log("Directory not found: "+o.fullname),!1}var u=Object.keys(t).sort(),e=t[u[i-1]];return"/"===r&&(1===i?(e||(e=[0,0,0,0,0]),e[0]="SqueakJS",e[3]=!0):e=null),this.popNandPushIfOK(s+1,this.makeStObject(e)),!0},primitiveDirectorySetMacTypeAndCreator:function(e){return this.popNIfOK(e)},primitiveFileAtEnd:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.popNandPushIfOK(t+1,this.makeStObject(e.filePos>=e.file.size)),!0):!1},primitiveFileClose:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.fileClose(e.file),this.vm.breakOut(),e.file=null,this.popNIfOK(t)):!1},primitiveFileDelete:function(e){var t=this.stackNonInteger(0);if(!this.success)return!1;var i=this.filenameFromSqueak(t.bytesAsString());return this.success=Squeak.fileDelete(i),this.popNIfOK(e)},primitiveFileFlush:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(Squeak.flushFile(e.file),this.vm.breakOut(),this.popNIfOK(t)):!1},primitiveFileGetPosition:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.popNandPushIfOK(t+1,this.makeLargeIfNeeded(e.filePos)),!0):!1},primitiveFileOpen:function(r){var i=this.stackBoolean(0),n=this.stackNonInteger(1);if(!this.success)return!1;var s=this.filenameFromSqueak(n.bytesAsString()),t=this.fileOpen(s,i);if(!t)return!1;var e=this.makeStArray([t.name]);return e.file=t,e.fileWrite=i,e.filePos=0,this.popNandPushIfOK(r+1,e),!0},primitiveFileRead:function(i){var e=this.stackInteger(0),r=this.stackInteger(1)-1,n=this.stackNonInteger(2),t=this.stackNonInteger(3);return this.success&&t.file?e?n.bytes?0>r||r+e>n.bytes.length?!1:this.fileContentsDo(t.file,function(s){if(!s.contents)return this.popNandPushIfOK(i+1,0);var o=s.contents,u=n.bytes;e=Math.min(e,s.size-t.filePos);for(var a=0;e>a;a++)u[r+a]=o[t.filePos++];this.popNandPushIfOK(i+1,e)}.bind(this)):(console.log("File reading into non-bytes object not implemented yet"),!1):this.popNandPushIfOK(i+1,0):!1},primitiveFileRename:function(e){var t=this.stackNonInteger(1),i=this.stackNonInteger(0);if(!this.success)return!1;var r=this.filenameFromSqueak(t.bytesAsString()),n=this.filenameFromSqueak(i.bytesAsString());return this.success=Squeak.fileRename(r,n),this.vm.breakOut(),this.popNIfOK(e)},primitiveFileSetPosition:function(t){var i=this.stackPos32BitInt(0),e=this.stackNonInteger(1);return this.success&&e.file?(e.filePos=i,this.popNIfOK(t)):!1},primitiveFileSize:function(t){var e=this.stackNonInteger(0);return this.success&&e.file?(this.popNandPushIfOK(t+1,this.makeLargeIfNeeded(e.file.size)),!0):!1},primitiveFileStdioHandles:function(){return this.vm.warnOnce("Not yet implemented: primitiveFileStdioHandles"),!1},primitiveFileTruncate:function(){return console.warn("Not yet implemented: primitiveFileTruncate"),!1},primitiveDisableFileAccess:function(e){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,e)},primitiveFileWrite:function(n){var t=this.stackInteger(0),i=this.stackInteger(1)-1,s=this.stackNonInteger(2),e=this.stackNonInteger(3);if(!this.success||!e.file||!e.fileWrite)return!1;if(!t)return this.popNandPushIfOK(n+1,0);var r=s.bytes||s.wordsAsUint8Array();return r?0>i||i+t>r.length?!1:this.fileContentsDo(e.file,function(s){var u=r,a=s.contents||[];if(e.filePos+t>a.length){var l=0===a.length?e.filePos+t:Math.max(e.filePos+t,a.length+1e4);s.contents=new Uint8Array(l),s.contents.set(a),a=s.contents}for(var o=0;t>o;o++)a[e.filePos++]=u[i+o];e.filePos>s.size&&(s.size=e.filePos),s.modified=!0,this.popNandPushIfOK(n+1,t)}.bind(this)):!1},fileOpen:function(s,a){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});var e=Squeak.splitFilePath(s);if(!e.basename)return null;var n=Squeak.dirList(e.dirname,!0);if(!n)return null;var i=n[e.basename],r=null;if(i){var t=SqueakFiles[e.fullname];if(t)return++t.refCount,t}else{if(!a)return console.log("File not found: "+e.fullname),null;if(r=new Uint8Array,i=Squeak.filePut(e.fullname,r.buffer),!i)return console.log("Cannot create file: "+e.fullname),null}var t={name:e.fullname,size:i[4],contents:r,modified:!1,refCount:1};return SqueakFiles[t.name]=t,t},fileClose:function(e){Squeak.flushFile(e),0==--e.refCount&&delete SqueakFiles[e.name]},fileContentsDo:function(e,t){if(e.contents)t(e);else{if(e.contents===!1)return!1;var i=this.vm.freeze();Squeak.fileGet(e.name,function(r){e.contents=this.asUint8Array(r),i(),t(e)}.bind(this),function(r){console.log("File get failed: "+r),e.contents=!1,i(),t(e)}.bind(this))}return!0}},"DropPlugin",{primitiveDropRequestFileHandle:function(s){var t=this.stackInteger(0),i=this.display.droppedFiles||[];if(1>t||t>i.length)return!1;var r=i[t-1],n=this.fileOpen(r,!1);if(!n)return!1;var e=this.makeStArray([r]);return e.file=n,e.fileWrite=!1,e.filePos=0,this.popNandPushIfOK(s+1,e),!0},primitiveDropRequestFileName:function(i){var e=this.stackInteger(0),t=this.display.droppedFiles||[];if(1>e||e>t.length)return!1;var r=this.makeStString(this.filenameToSqueak(t[e-1]));return this.popNandPushIfOK(i,r)}},"SoundPlugin",{snd_primitiveSoundStart:function(e){return this.snd_primitiveSoundStartWithSemaphore(e)},snd_primitiveSoundStartWithSemaphore:function(e){var i=this.stackInteger(e-1),t=this.stackInteger(e-2),r=this.stackBoolean(e-3),n=e>3?this.stackInteger(e-4):0;return this.success?(this.audioContext=Squeak.startAudioOut(),this.audioContext?(this.audioContext.sampleRate=t,this.audioSema=n,this.audioNextTimeSlot=0,this.audioBuffersReady=[],this.audioBuffersUnused=[this.audioContext.createBuffer(r?2:1,i,t),this.audioContext.createBuffer(r?2:1,i,t)],console.log("sound: started"),this.popNIfOK(e)):(this.vm.warnOnce("could not initialize audio"),!1)):!1},snd_playNextBuffer:function(){if(this.audioContext&&0!==this.audioBuffersReady.length){var e=this.audioContext.createBufferSource();e.buffer=this.audioBuffersReady.shift(),e.connect(this.audioContext.destination),this.audioNextTimeSlot<this.audioContext.currentTime&&(this.audioNextTimeSlot>0&&console.warn("sound "+this.audioContext.currentTime.toFixed(3)+": buffer underrun by "+(this.audioContext.currentTime-this.audioNextTimeSlot).toFixed(3)+" s"),this.audioNextTimeSlot=this.audioContext.currentTime),e.start(this.audioNextTimeSlot),this.audioNextTimeSlot+=e.buffer.duration,window.setTimeout(function(){this.audioContext&&(this.audioBuffersUnused.push(e.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1e3*(this.audioNextTimeSlot-this.audioContext.currentTime)),this.snd_playNextBuffer()}},snd_primitiveSoundAvailableSpace:function(i){if(!this.audioContext)return console.log("sound: no audio context"),!1;var e=0;if(this.audioBuffersUnused.length>0){var t=this.audioBuffersUnused[0];e=t.length*t.numberOfChannels*2}return this.popNandPushIfOK(i+1,e)},snd_primitiveSoundPlaySamples:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;var o=this.stackInteger(2),r=this.stackNonInteger(1).wordsAsInt16Array(),u=this.stackInteger(0)-1;if(!this.success||!r)return!1;for(var t=this.audioBuffersUnused.shift(),n=t.numberOfChannels,e=0;n>e;e++)for(var l=t.getChannelData(e),s=u+e,i=0;o>i;i++)l[i]=r[s]/32768,s+=n;return this.audioBuffersReady.push(t),this.snd_playNextBuffer(),this.popNIfOK(a)},snd_primitiveSoundPlaySilence:function(n){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;for(var e=this.audioBuffersUnused.shift(),s=e.numberOfChannels,r=e.length,t=0;s>t;t++)for(var a=e.getChannelData(t),i=0;r>i;i++)a[i]=0;return this.audioBuffersReady.push(e),this.snd_playNextBuffer(),this.popNandPushIfOK(n+1,r)},snd_primitiveSoundStop:function(e){return this.audioContext&&(this.audioContext=null,this.audioBuffersReady=null,this.audioBuffersUnused=null,this.audioNextTimeSlot=0,this.audioSema=0,console.log("sound: stopped")),this.popNIfOK(e)},snd_primitiveSoundStartRecording:function(t){if(3!==t)return!1;var s=this.stackNonInteger(3),i=this.stackInteger(2),r=this.stackBoolean(1),a=this.stackInteger(0);if(!this.success)return!1;var o=this.primMethod,n=this.vm.freeze(),e=this;return Squeak.startAudioIn(function(s,u){for(console.log("sound: recording started"),e.audioInContext=s,e.audioInSource=u,e.audioInSema=a,e.audioInBuffers=[],e.audioInBufferIndex=0,e.audioInContext.sampleRate=i,e.audioInOverSample=1;i*e.audioInOverSample<e.audioInContext.sampleRate;)e.audioInOverSample*=2;for(var o=1024*e.audioInOverSample;o/e.audioInContext.sampleRate<.1;)o*=2;e.audioInProcessor=s.createScriptProcessor(o,r?2:1,r?2:1),e.audioInProcessor.onaudioprocess=function(t){e.snd_recordNextBuffer(t.inputBuffer)},e.audioInSource.connect(e.audioInProcessor),e.audioInProcessor.connect(s.destination),e.vm.popN(t),window.setTimeout(n,0)},function(i){console.warn(i),e.vm.sendAsPrimitiveFailure(s,o,t),window.setTimeout(n,0)}),!0},snd_recordNextBuffer:function(e){this.audioInContext&&(this.audioInBuffers.length>5&&this.audioInBuffers.shift(),this.audioInBuffers.push(e),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(t){if(!this.audioInContext)return!1;var e=this.audioInContext.sampleRate/this.audioInOverSample|0;return console.log("sound: actual recording rate "+e+"x"+this.audioInOverSample),this.popNandPushIfOK(t+1,e)},snd_primitiveSoundRecordSamples:function(p){var s=this.stackNonInteger(1).wordsAsInt16Array(),i=this.stackInteger(0)-1;if(!this.success)return!1;for(var c=0;i<s.length&&0!==this.audioInBuffers.length;){for(var e=this.audioInBuffers[0],t=e.numberOfChannels,u=t,o=this.audioInOverSample,m=(s.length-i)/u,d=(e.length-this.audioInBufferIndex)/o,a=Math.min(d,m),r=0;t>r;r++)for(var h=e.getChannelData(r),n=this.audioInBufferIndex,f=i+r,l=0;a>l;l++)s[f]=32768*h[n]&65535,f+=u,n+=o;c+=a*t,i+=a*t,n<e.length?this.audioInBufferIndex=n:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(p+1,c)},snd_primitiveSoundStopRecording:function(){return this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInBuffers=null,this.audioInSource=null,this.audioInProcessor=null,console.log("sound recording stopped")),!0},snd_primitiveSoundSetRecordLevel:function(){return!0}},"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(e){return this.popNandPushIfOK(e+1,this.vm.trueObj)},jpeg2_primImageHeight:function(t){var e=this.stackNonInteger(0).wordsOrBytes();if(!e)return!1;var i=e[1];return this.popNandPushIfOK(t+1,i)},jpeg2_primImageWidth:function(t){var e=this.stackNonInteger(0).wordsOrBytes();if(!e)return!1;var i=e[0];return this.popNandPushIfOK(t+1,i)},jpeg2_primJPEGCompressStructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGDecompressStructSize:function(e){return this.popNandPushIfOK(e+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(r){var e=this.stackNonInteger(2).wordsOrBytes(),t=this.stackNonInteger(1).bytes;if(!e||!t)return!1;var i=this.vm.freeze();return this.jpeg2_readImageFromBytes(t,function(r){this.jpeg2state={src:t,img:r},e[0]=r.width,e[1]=r.height,i()}.bind(this),function(){e[0]=0,e[1]=0,i()}.bind(this)),this.popNIfOK(r)},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(a){var n=this.stackNonInteger(3).bytes,e=this.stackNonInteger(2).pointers,o=this.stackBoolean(1);if(!this.success||!n||!e)return!1;var t=this.jpeg2state;if(!t||t.src!==n)return console.error("jpeg read did not match header info"),!1;var s=e[Squeak.Form_depth],i=this.jpeg2_getPixelsFromImage(t.img),r=e[Squeak.Form_bits].words;if(32===s)this.jpeg2_copyPixelsToForm32(i,r);else{if(16!==s)return!1;o?this.jpeg2_ditherPixelsToForm16(i,r):this.jpeg2_copyPixelsToForm16(i,r)}return this.popNIfOK(a)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(){return this.vm.warnOnce("JPEGReadWritePlugin2: writing not implemented yet"),!1},jpeg2_readImageFromBytes:function(t,i,r){var n=new Blob([t],{type:"image/jpeg"}),e=new Image;e.onload=function(){i(e)},e.onerror=function(){console.warn("could not render JPEG"),r()},e.src=(window.URL||window.webkitURL).createObjectURL(n)},jpeg2_getPixelsFromImage:function(e){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height)},jpeg2_copyPixelsToForm32:function(r,i){for(var t=r.data,e=0;e<i.length;e++){var n=t[4*e+0],s=t[4*e+1],a=t[4*e+2];i[e]=4278190080|n<<16|s<<8|a}},jpeg2_copyPixelsToForm16:function(r,o){for(var u=r.width,a=r.height,i=r.data,n=0;a>n;n++)for(var s=0;u>s;s+=2){var t=n*a+s,d=i[4*t+0]>>3,l=i[4*t+1]>>3,c=i[4*t+2]>>3,f=i[4*t+4]>>3,h=i[4*t+5]>>3,p=i[4*t+6]>>3,e=d<<10|l<<5|c;0===e&&(e=1),e=e<<16|f<<10|h<<5|p,0===(65535&e)&&(e=1|e),o[t>>1]=e}},jpeg2_ditherPixelsToForm16:function(h,y){for(var S=h.width>>1,b=h.height,s=h.data,g=[2,0,14,12,1,3,13,15],F=[10,8,6,4,9,11,5,7],a=0;b>a;a++)for(var o=0;S>o;o++){var t,i,e,n=a*b+2*o<<2,v=s[n+0],d=s[n+1],m=s[n+2],p=s[n+4],f=s[n+5],c=s[n+6],k=(3&a)<<1|1&o,l=g[k],u=F[k];t=496*v>>8,i=15&t,e=t>>4,v=i>l?e+1:e,t=496*d>>8,i=15&t,e=t>>4,d=i>l?e+1:e,t=496*m>>8,i=15&t,e=t>>4,m=i>l?e+1:e,t=496*p>>8,i=15&t,e=t>>4,p=i>u?e+1:e,t=496*f>>8,i=15&t,e=t>>4,f=i>u?e+1:e,t=496*c>>8,i=15&t,e=t>>4,c=i>u?e+1:e;var r=v<<10|d<<5|m;0===r&&(r=1),r=r<<16|p<<10|f<<5|c,0===(65535&r)&&(r=1|r),y[n>>3]=r}}},"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(r){var e=this.stackNonInteger(0).bytesAsString();if(""==e)return!1;if(/^\/SqueakJS\//.test(e)){e=e.slice(10);var t=Squeak.splitFilePath(e),i=localStorage["squeak-template:"+t.dirname];i&&(e=JSON.parse(i).url+"/"+t.basename)}return window.open(e,"_blank"),this.popNIfOK(r)},scratch_primitiveGetFolderPath:function(t){var i=this.stackInteger(0);if(!this.success)return!1;var e;switch(i){case 1:e="/"}return e?(this.vm.popNandPush(t+1,this.makeStString(this.filenameToSqueak(e))),!0):!1}},"JavaScriptPlugin",{js_primitiveDoUnderstand:function(l){var n=this.stackNonInteger(1),t=this.js_objectOrGlobal(n),o=this.stackNonInteger(0).pointers,c=o[0].bytesAsString(),i=o[1].pointers||[],a=!("jsObject"in n),e=null;try{this.js_activeCallback="Callbacks must be asynchronous";var r=c.match(/([^:]*)/)[0];if(a||"new"!==r){if(!(r in t))return this.js_setError("Property not found: "+r);var s=t[r];if("function"==typeof s&&(!a||i.length>0))e=s.apply(t,this.js_fromStArray(i));else if(0==i.length)e=s;else{if(1!=i.length)return this.js_setError("Property "+r+" is not a function");t[r]=this.js_fromStObject(i[0])}}else if(0===i.length)e=new t;else{var u=Object.create(t.prototype);e=t.apply(u,this.js_fromStArray(i)),Object(e)!==e&&(e=u)}}catch(f){return this.js_setError(f.message)}finally{this.js_activeCallback=null}var h=this.makeStObject(e,n.sqClass);return this.popNandPushIfOK(l+1,h)},js_primitiveAsString:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(String(t)))},js_primitiveTypeof:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(typeof t))},js_primitiveAt:function(i){var e,t=this.stackNonInteger(1),r=this.vm.stackValue(0);try{var n=this.js_objectOrGlobal(t),s=this.js_fromStObject(r),a=n[s];e=this.makeStObject(a,t.sqClass)}catch(o){return this.js_setError(o.message)}return this.popNandPushIfOK(i+1,e)},js_primitiveAtPut:function(t){var i=this.stackNonInteger(2),r=this.vm.stackValue(1),e=this.vm.stackValue(0);try{var n=this.js_objectOrGlobal(i),s=this.js_fromStObject(r),a=this.js_fromStObject(e);n[s]=a}catch(o){return this.js_setError(o.message)}return this.popNandPushIfOK(t+1,e)},js_primitiveInitCallbacks:function(e){return this.js_callbackSema=this.stackInteger(0),this.js_activeCallback=null,this.popNIfOK(e)},js_primitiveGetActiveCallbackBlock:function(t){var e=this.js_activeCallback;return e?this.popNandPushIfOK(t,e.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(i){var n=this.stackNonInteger(i),e=this.js_activeCallback;if(!e)return this.js_setError("No active callback");try{for(var s=e.block.pointers[Squeak.BlockContext_argumentCount],r=[],t=0;s>t;t++)r.push(e.args[t]);return this.popNandPushIfOK(i,this.makeStArray(r,n))}catch(a){return this.js_setError(a.message)}},js_primitiveReturnFromCallback:function(e){return 1!==e?!1:this.js_activeCallback?(this.js_activeCallback.result=this.vm.pop(),this.vm.breakOut(),!0):this.js_setError("No active callback")},js_primitiveGetError:function(e){var t=this.makeStObject(this.js_error);return this.js_error=null,this.popNandPushIfOK(e+1,t)},js_setError:function(e){return this.js_error=String(e),!1},js_fromStObject:function(e){if("number"==typeof e)return e;if(e.jsObject)return e.jsObject;if(e.isFloat)return e.float;if(e.isNil)return null;if(e.isTrue)return!0;if(e.isFalse)return!1;if(e.bytes||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return e.bytesAsString();if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(e.pointers||[],!0);if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(e);throw Error("asJSArgument needed for "+e)},js_fromStArray:function(e,r){if(e.length>0&&r&&this.isAssociation(e[0]))return this.js_fromStDict(e);for(var i=[],t=0;t<e.length;t++)i.push(this.js_fromStObject(e[t]));return i},js_fromStDict:function(i){for(var r={},t=0;t<i.length;t++){var e=i[t].pointers;if(!e||2!==e.length)throw Error(e+" is not an Association");var n=this.js_fromStObject(e[0]),s=this.js_fromStObject(e[1]);r[n]=s}return r},js_fromStBlock:function(e){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var t=this;return function(){return t.js_executeCallback(e,arguments)}},js_executeCallback:function(t,i){if(this.js_activeCallback){if("string"==typeof this.js_activeCallback)throw Error(this.js_activeCallback);return console.error("Callback: already active")}this.js_activeCallback={block:t,args:i,result:null},this.signalSemaphoreWithIndex(this.js_callbackSema),this.vm.forceInterruptCheck();for(var r=Date.now()+500;Date.now()<r&&!this.js_activeCallback.result;)this.vm.interpret();var e=this.js_activeCallback.result;return this.js_activeCallback=null,e?this.js_fromStObject(e):console.error("Callback error: "+(this.vm.frozen?"frozen":"timeout"))},js_objectOrGlobal:function(e){return"jsObject"in e?e.jsObject:window}},"Obsolete",{primitiveFloatArrayAt:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",e)},primitiveFloatArrayMulFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",e)},primitiveFloatArrayAddScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",e)},primitiveFloatArrayDivFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",e)},primitiveFloatArrayDivScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",e)},primitiveFloatArrayHash:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",e)},primitiveFloatArrayAtPut:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",e)},primitiveFloatArrayMulScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",e)},primitiveFloatArrayAddFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",e)},primitiveFloatArraySubScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",e)},primitiveFloatArraySubFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",e)},primitiveFloatArrayEqual:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",e)},primitiveFloatArrayDotProduct:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",e)},m23PrimitiveInvertRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",e)},m23PrimitiveTransformPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",e)},m23PrimitiveIsPureTranslation:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",e)},m23PrimitiveComposeMatrix:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",e)},m23PrimitiveTransformRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",e)},m23PrimitiveIsIdentity:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",e)},m23PrimitiveInvertPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",e)},primitiveDeflateBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",e)},primitiveDeflateUpdateHashTable:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",e)},primitiveUpdateGZipCrc32:function(e){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",e)},primitiveInflateDecompressBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",e)},primitiveZipSendBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",e)},primitiveFFTTransformData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",e)},primitiveFFTScaleData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",e)},primitiveFFTPermuteData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",e)},gePrimitiveMergeFillFrom:function(e){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",e)},gePrimitiveCopyBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",e)},gePrimitiveAddRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddRect",e)},gePrimitiveAddGradientFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",e)},gePrimitiveSetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",e)},gePrimitiveSetBitBltPlugin:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",e)},gePrimitiveRegisterExternalEdge:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",e)},gePrimitiveGetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",e)},gePrimitiveAddBezier:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",e)},gePrimitiveInitializeProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",e)},gePrimitiveRenderImage:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",e)
},gePrimitiveGetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",e)},gePrimitiveSetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",e)},gePrimitiveAddBezierShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",e)},gePrimitiveSetEdgeTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",e)},gePrimitiveGetTimes:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",e)},gePrimitiveNextActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",e)},gePrimitiveAddBitmapFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",e)},gePrimitiveGetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",e)},gePrimitiveAbortProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",e)},gePrimitiveNextGlobalEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",e)},gePrimitiveGetFailureReason:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",e)},gePrimitiveDisplaySpanBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",e)},gePrimitiveGetCounts:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",e)},gePrimitiveChangedActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",e)},gePrimitiveRenderScanline:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",e)},gePrimitiveGetBezierStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",e)},gePrimitiveFinishedProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",e)},gePrimitiveNeedsFlush:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",e)},gePrimitiveAddLine:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddLine",e)},gePrimitiveSetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",e)},gePrimitiveNextFillEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",e)},gePrimitiveInitializeBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",e)},gePrimitiveDoProfileStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",e)},gePrimitiveAddActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",e)},gePrimitiveSetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",e)},gePrimitiveNeedsFlushPut:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",e)},gePrimitiveAddCompressedShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",e)},gePrimitiveSetColorTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",e)},gePrimitiveAddOval:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddOval",e)},gePrimitiveRegisterExternalFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",e)},gePrimitiveAddPolygon:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",e)},gePrimitiveGetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",e)}}),Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(e){this.vm=e,this.remappableOops=[],Object.defineProperty(this,"successFlag",{get:function(){return e.primHandler.success},set:function(t){e.primHandler.success=t}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(){this.successFlag=!1},success:function(e){e||(this.successFlag=!1)}},"stack access",{pop:function(e){this.vm.popN(e)},popthenPush:function(e,t){this.vm.popNandPush(e,t)},push:function(e){this.vm.push(e)},pushBool:function(e){this.vm.push(e?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(e){this.vm.push(e)},pushFloat:function(e){this.vm.push(this.floatObjectOf(e))},stackValue:function(e){return this.vm.stackValue(e)},stackIntegerValue:function(t){var e=this.vm.stackValue(t);return"number"==typeof e?e:(this.successFlag=!1,0)},stackFloatValue:function(e){this.vm.success=!0;var t=this.vm.stackIntOrFloat(e);return this.vm.success?t:(this.successFlag=!1,0)},stackObjectValue:function(t){var e=this.vm.stackValue(t);return"number"!=typeof e?e:(this.successFlag=!1,this.vm.nilObj)},stackBytes:function(t){var e=this.vm.stackValue(t);return e.bytes?e.bytes:e.words?e.wordsAsUint8Array():("number"!=typeof e&&e.isWordsOrBytes()||(this.successFlag=!1),[])},stackWords:function(t){var e=this.vm.stackValue(t);return e.words?e.words:("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt32Array:function(t){var e=this.vm.stackValue(t);return e.words?e.wordsAsInt32Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt16Array:function(t){var e=this.vm.stackValue(t);return e.words?e.wordsAsInt16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackUint16Array:function(t){var e=this.vm.stackValue(t);return e.words?e.wordsAsUint16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])}},"object access",{isBytes:function(e){return"number"!=typeof e&&e.isBytes()},isWords:function(e){return"number"!=typeof e&&e.isWords()},isWordsOrBytes:function(e){return"number"!=typeof e&&e.isWordsOrBytes()},isPointers:function(e){return"number"!=typeof e&&e.isPointers()},isIntegerValue:function(e){return"number"==typeof e&&e>=-1073741824&&1073741823>=e},isArray:function(e){return e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(r,t){var i=r.sqClass.pointers[Squeak.Class_name].bytes;if(t.length!==i.length)return!1;for(var e=0;e<t.length;e++)if(t.charCodeAt(e)!==i[e])return!1;return!0},booleanValueOf:function(e){return e.isTrue?!0:e.isFalse?!1:(this.successFlag=!1,!1)},positive32BitValueOf:function(e){return this.vm.primHandler.positive32BitValueOf(e)},positive32BitIntegerFor:function(e){return this.vm.primHandler.pos32BitIntFor(e)},floatValueOf:function(e){return e.isFloat?e.float:(this.successFlag=!1,0)},floatObjectOf:function(e){return this.vm.primHandler.makeFloat(e)},fetchPointerofObject:function(e,t){return t.pointers[e]},fetchBytesofObject:function(t,i){var e=i.pointers[t];return e.bytes?e.bytes:e.words?e.wordsAsUint8Array():("number"!=typeof e&&e.isWordsOrBytes()||(this.successFlag=!1),[])},fetchWordsofObject:function(t,i){var e=i.pointers[t];return e.words?e.words:("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchInt32ArrayofObject:function(t,i){var e=i.pointers[t];return e.words?e.wordsAsInt32Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchInt16ArrayofObject:function(t,i){var e=i.pointers[t];return e.words?e.wordsAsInt16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchUint16ArrayofObject:function(t,i){var e=i.pointers[t];return e.words?e.wordsAsUint16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},fetchIntegerofObject:function(t,i){var e=i.pointers[t];return"number"==typeof e?e:(this.successFlag=!1,0)},fetchLong32ofObject:function(e,t){return t.words[e]},fetchFloatofObject:function(e,t){return this.floatValueOf(t.pointers[e])},storeIntegerofObjectwithValue:function(t,i,e){"number"==typeof e?i.pointers[t]=e:this.successFlag=!1},storePointerofObjectwithValue:function(e,t,i){t.pointers[e]=i},stObjectatput:function(e,t,i){if(e.sqClass!==this.classArray())throw Error("Array expected");return 1>t||t>=e.pointers.length?this.successFlag=!1:void(e.pointers[t]=i)}},"constant access",{isKindOfInteger:function(e){return"number"==typeof e||e.sqClass==this.classLargeNegativeInteger()||e.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{instantiateClassindexableSize:function(e,t){return this.vm.instantiateClass(e,t)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(e,t){return this.vm.primHandler.makePointWithXandY(e,t)},pushRemappableOop:function(e){this.remappableOops.push(e)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(n,e,t,i,r){if(i>e&&r>t){var s={left:e,top:t,right:i,bottom:r};this.vm.primHandler.displayDirty(n,s)}},ioLoadFunctionFrom:function(e,t){return this.vm.primHandler.loadFunctionFrom(e,t)}}),Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(e,t){this.method=e,this.vm=t}},"printing",{printInstructions:function(e,t,i){for(this.indent=e,this.highlight=t,this.highlightPC=i,this.innerIndents={},this.result="",this.scanner=new Squeak.InstructionStream(this.method,this.vm),this.oldPC=this.scanner.pc,this.endPC=0,this.done=!1;!this.done;)this.scanner.interpretNextInstructionFor(this);return this.result},print:function(t){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent),this.result+=this.oldPC;for(var e=0;e<this.innerIndents[this.oldPC];e++)this.result+="   ";this.result+=" <";for(var e=this.oldPC;e<this.scanner.pc;e++)e>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[e]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+t+"\n",this.oldPC=this.scanner.pc}},"decoding",{blockReturnTop:function(){this.print("blockReturn")},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(e){this.print("jumpTo: "+(this.scanner.pc+e)),this.scanner.pc+e>this.endPC&&(this.endPC=this.scanner.pc+e)},jumpIf:function(t,e){this.print((t?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+e)),this.scanner.pc+e>this.endPC&&(this.endPC=this.scanner.pc+e)},methodReturnReceiver:function(){this.print("return: receiver"),this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack"),this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(e){this.print("returnConst: "+e.toString()),this.done=this.scanner.pc>this.endPC},popIntoLiteralVariable:function(e){this.print("popIntoBinding: "+e.assnKeyAsString())},popIntoReceiverVariable:function(e){this.print("popIntoInstVar: "+e)},popIntoTemporaryVariable:function(e){this.print("popIntoTemp: "+e)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(e){var t=e.sqInstName?e.sqInstName():e.toString();this.print("pushConst: "+t)},pushLiteralVariable:function(e){this.print("pushBinding: "+e.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(e){this.print("pushInstVar: "+e)},pushTemporaryVariable:function(e){this.print("pushTemp: "+e)},send:function(e,i,t){this.print((t?"superSend: #":"send: #")+(e.bytesAsString?e.bytesAsString():e))},storeIntoLiteralVariable:function(e){this.print("storeIntoBinding: "+e.assnKeyAsString())},storeIntoReceiverVariable:function(e){this.print("storeIntoInstVar: "+e)},storeIntoTemporaryVariable:function(e){this.print("storeIntoTemp: "+e)},pushNewArray:function(e){this.print("push: (Array new: "+e+")")},popIntoNewArray:function(e){this.print("pop: "+e+" into: (Array new: "+e+")")},pushRemoteTemp:function(e,t){this.print("push: "+e+" ofTemp: "+t)},storeIntoRemoteTemp:function(e,t){this.print("storeInto: "+e+" ofTemp: "+t)},popIntoRemoteTemp:function(e,t){this.print("popInto: "+e+" ofTemp: "+t)},pushClosureCopy:function(r,n,s){var i=this.scanner.pc,e=i+s;this.print("closure("+i+"-"+(e-1)+"): "+r+" captured, "+n+" args");for(var t=i;e>t;t++)this.innerIndents[t]=(this.innerIndents[t]||0)+1;e>this.endPC&&(this.endPC=e)}}),Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(e,t){this.vm=t,this.method=e,this.pc=0,this.specialConstants=["true","false","nil","-1","0","1","2"],this.specialSelectors=["+","-","<",">","<=",">=","=","~=","*","/","\\","@","bitShift:","//","bitAnd:","bitOr:","at:","at:put:","size","next","nextPut:","atEnd","==","class","blockCopy:","value","value:","do:","new","new:","x","y"],this.specialSelectorsNArgs=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,1,0,1,0,1,0,1,1,0,1,0,0]}},"decoding",{interpretNextInstructionFor:function(t){var r=this.method,n=r.bytes[this.pc++],i=n/16|0,e=n%16;if(0===i)return t.pushReceiverVariable(e);if(1===i)return t.pushTemporaryVariable(e);if(2===i)return t.pushConstant(r.methodGetLiteral(e));if(3===i)return t.pushConstant(r.methodGetLiteral(e+16));if(4===i)return t.pushLiteralVariable(r.methodGetLiteral(e));if(5===i)return t.pushLiteralVariable(r.methodGetLiteral(e+16));if(6===i)return 8>e?t.popIntoReceiverVariable(e):t.popIntoTemporaryVariable(e-8);if(7===i){if(0===e)return t.pushReceiver();if(8>e)return t.pushConstant(this.specialConstants[e-1]);if(8===e)return t.methodReturnReceiver();if(12>e)return t.methodReturnConstant(this.specialConstants[e-9]);if(12===e)return t.methodReturnTop();if(13===e)return t.blockReturnTop();if(e>13)throw Error("unusedBytecode")}return 8===i?this.interpretExtension(e,r,t):9===i?8>e?t.jump(e+1):t.jumpIf(!1,e-8+1):10===i?(n=this.method.bytes[this.pc++],8>e?t.jump(256*(e-4)+n):t.jumpIf(12>e,256*(3&e)+n)):11===i?t.send(this.specialSelectors[e],this.specialSelectorsNArgs[e],!1):12===i?t.send(this.specialSelectors[e+16],this.specialSelectorsNArgs[e+16],!1):i>12?t.send(r.methodGetLiteral(e),i-13,!1):void 0},interpretExtension:function(r,o,e){if(6>=r){var i=this.method.bytes[this.pc++];if(2>=r){var t=i/64|0,s=i%64;if(0===r){if(0===t)return e.pushReceiverVariable(s);if(1===t)return e.pushTemporaryVariable(s);if(2===t)return e.pushConstant(this.method.methodGetLiteral(s));if(3===t)return e.pushLiteralVariable(this.method.methodGetLiteral(s))}if(1===r){if(0===t)return e.storeIntoReceiverVariable(s);if(1===t)return e.storeIntoTemporaryVariable(s);if(2===t)throw Error("illegalStore");if(3===t)return e.storeIntoLiteralVariable(this.method.methodGetLiteral(s))}if(2===r){if(0===t)return e.popIntoReceiverVariable(s);if(1===t)return e.popIntoTemporaryVariable(s);if(2===t)throw Error("illegalStore");if(3===t)return e.popIntoLiteralVariable(this.method.methodGetLiteral(s))}}if(3===r)return e.send(this.method.methodGetLiteral(i%32),i/32|0,!1);if(4===r){var n=this.method.bytes[this.pc++],t=i/32|0;if(0===t)return e.send(this.method.methodGetLiteral(n),i%32,!1);if(1===t)return e.send(this.method.methodGetLiteral(n),i%32,!0);if(2===t)return e.pushReceiverVariable(n);if(3===t)return e.pushConstant(this.method.methodGetLiteral(n));if(4===t)return e.pushLiteralVariable(this.method.methodGetLiteral(n));if(5===t)return e.storeIntoReceiverVariable(n);if(6===t)return e.popIntoReceiverVariable(n);if(7===t)return e.storeIntoLiteralVariable(this.method.methodGetLiteral(n))}if(5===r)return e.send(this.method.methodGetLiteral(31&i),i>>5,!0);if(6===r)return e.send(this.method.methodGetLiteral(63&i),i>>6,!1)}if(7===r)return e.doPop();if(8===r)return e.doDup();if(9===r)return e.pushActiveContext();var i=this.method.bytes[this.pc++];if(10===r)return 128>i?e.pushNewArray(i):e.popIntoNewArray(i-128);if(11===r)throw Error("unusedBytecode");var n=this.method.bytes[this.pc++];if(12===r)return e.pushRemoteTemp(i,n);if(13===r)return e.storeIntoRemoteTemp(i,n);if(14===r)return e.popIntoRemoteTemp(i,n);var a=this.method.bytes[this.pc++];return e.pushClosureCopy(i>>4,15&i,256*n+a)}})}),module("users.bert.SqueakJS.jit").requires("users.bert.SqueakJS.vm").toRun(function(){Object.subclass("Squeak.Compiler","initialization",{initialize:function(e){this.vm=e,this.comments=!!Squeak.Compiler.comments,this.specialSelectors=["+","-","<",">","<=",">=","=","~=","*","/","\\","@","bitShift:","//","bitAnd:","bitOr:","at:","at:put:","size","next","nextPut:","atEnd","==","class","blockCopy:","value","value:","do:","new","new:","x","y"]}},"accessing",{compile:function(e,t,i){if(e.isHot){this.singleStep=!1,this.debug=this.comments;var r=t&&t.className(),n=i&&i.bytesAsString();e.compiled=this.generate(e,r,n)}else e.isHot=!0},enableSingleStepping:function(e,i,r){if(!e.compiled||!e.compiled.canSingleStep){this.singleStep=!0,this.debug=!0;var t=this.vm.printMethod(e,i,r).split(">>");e.compiled=this.generate(e,t[0],t[1]),e.compiled.canSingleStep=!0}return!0},functionNameFor:function(t,e){if(!t||!e)return"Squeak_DOIT";if(!/[^a-zA-Z:_]/.test(e))return(t+"_"+e).replace(/[: ]/g,"_");var i=e.replace(/./g,function(e){var t={"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[e];return t||"OPERATOR"});return t.replace(/[ ]/,"_")+"__"+i+"__"}},"generating",{generate:function(t,r,n){for(this.method=t,this.pc=0,this.endPC=0,this.prevPC=0,this.source=[],this.sourceLabels={},this.needsLabel={0:!0},this.needsBreak=!1,r&&n&&this.source.push("// ",r,">>",n,"\n"),this.source.push("var context = vm.activeContext,\n","    stack = context.pointers,\n","    rcvr = vm.receiver,\n","    inst = rcvr.pointers,\n","    temp = vm.homeContext.pointers,\n","    lit = vm.method.pointers,\n","    bytecodes = 0 - vm.pc;\n","while (true) switch (vm.pc) {\n"),this.done=!1;!this.done;){var e=t.bytes[this.pc++],i=0;switch(248&e){case 0:case 8:this.generatePush("inst[",15&e,"]");break;case 16:case 24:this.generatePush("temp[",6+(15&e),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(31&e),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(31&e),"].pointers[1]");break;case 96:this.generatePopInto("inst[",7&e,"]");break;case 104:this.generatePopInto("temp[",6+(7&e),"]");break;case 112:switch(e){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(e){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode")}break;case 128:case 136:this.generateExtended(e);break;case 144:this.generateJump((7&e)+1);break;case 152:this.generateJumpIf(!1,(7&e)+1);break;case 160:i=t.bytes[this.pc++],this.generateJump(256*((7&e)-4)+i);break;case 168:i=t.bytes[this.pc++],this.generateJumpIf(172>e,256*(3&e)+i);break;case 176:case 184:this.generateNumericOp(e);break;case 192:case 200:this.generateQuickPrim(e);break;case 208:case 216:this.generateSend("lit[",1+(15&e),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(15&e),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(15&e),"]",2,!1)}}var s=this.functionNameFor(r,n);return this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC'); }"),new Function("return function "+s+"(vm, singleStep) {\n"+this.source.join("")+"\n}")()):(this.debug&&this.source.push("// fall back to single-stepping\n"),this.source.push("default: bytecodes += vm.pc; vm.interpretOne(true); return bytecodes;}"),this.deleteUnneededLabels(),new Function("return function "+s+"(vm) {\n"+this.source.join("")+"\n}")())},generateExtended:function(i){switch(i){case 128:var e=this.method.bytes[this.pc++];switch(e>>6){case 0:return void this.generatePush("inst[",63&e,"]");case 1:return void this.generatePush("temp[",6+(63&e),"]");case 2:return void this.generatePush("lit[",1+(63&e),"]");case 3:return void this.generatePush("lit[",1+(63&e),"].pointers[1]")}case 129:var e=this.method.bytes[this.pc++];switch(e>>6){case 0:return void this.generateStoreInto("inst[",63&e,"]");case 1:return void this.generateStoreInto("temp[",6+(63&e),"]");case 2:throw Error("illegal store into literal");case 3:return void this.generateStoreInto("lit[",1+(63&e),"].pointers[1]")}return;case 130:var e=this.method.bytes[this.pc++];switch(e>>6){case 0:return void this.generatePopInto("inst[",63&e,"]");case 1:return void this.generatePopInto("temp[",6+(63&e),"]");case 2:throw Error("illegal pop into literal");case 3:return void this.generatePopInto("lit[",1+(63&e),"].pointers[1]")}case 131:var e=this.method.bytes[this.pc++];return void this.generateSend("lit[",1+(31&e),"]",e>>5,!1);case 132:var e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++];switch(e>>5){case 0:return void this.generateSend("lit[",1+t,"]",31&e,!1);case 1:return void this.generateSend("lit[",1+t,"]",31&e,!0);case 2:return void this.generatePush("inst[",t,"]");case 3:return void this.generatePush("lit[",1+t,"]");case 4:return void this.generatePush("lit[",1+t,"].pointers[1]");case 5:return void this.generateStoreInto("inst[",t,"]");case 6:return void this.generatePopInto("inst[",t,"]");case 7:return void this.generateStoreInto("lit[",1+t,"].pointers[1]")}case 133:var e=this.method.bytes[this.pc++];return void this.generateSend("lit[",1+(31&e),"]",e>>5,!0);case 134:var e=this.method.bytes[this.pc++];return void this.generateSend("lit[",1+(63&e),"]",e>>6,!1);case 135:return void this.generateInstruction("pop","vm.sp--");case 136:return void this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");case 137:return void this.generateInstruction("thisContext","stack[++vm.sp] = context; vm.reclaimableContextCount = 0");case 138:var e=this.method.bytes[this.pc++],r=e>127,n=127&e;return void this.generateClosureTemps(n,r);case 139:throw Error("unusedBytecode");case 140:var e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++];return void this.generatePush("temp[",6+t,"].pointers[",e,"]");case 141:var e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++];return void this.generateStoreInto("temp[",6+t,"].pointers[",e,"]");case 142:var e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++];return void this.generatePopInto("temp[",6+t,"].pointers[",e,"]");case 143:var e=this.method.bytes[this.pc++],t=this.method.bytes[this.pc++],s=this.method.bytes[this.pc++],a=15&e,o=e>>4,u=t<<8|s;return void this.generateClosureCopy(a,o,u)}},generatePush:function(i,e,r,t,n){this.debug&&this.generateDebugCode("push"),this.generateLabel(),this.source.push("stack[++vm.sp] = ",i),void 0!==e&&(this.source.push(e,r),void 0!==t&&this.source.push(t,n)),this.source.push(";\n")},generateStoreInto:function(i,e,r,t,n){this.debug&&this.generateDebugCode("store into"),this.generateLabel(),this.source.push(i),void 0!==e&&(this.source.push(e,r),void 0!==t&&this.source.push(t,n)),this.source.push(" = stack[vm.sp];\n")},generatePopInto:function(i,e,r,t,n){this.debug&&this.generateDebugCode("pop into"),this.generateLabel(),this.source.push(i),void 0!==e&&(this.source.push(e,r),void 0!==t&&this.source.push(t,n)),this.source.push(" = stack[vm.sp--];\n")},generateReturn:function(e){this.debug&&this.generateDebugCode("return"),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",e,"); return bytecodes + ",this.pc,";\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateBlockReturn:function(){this.debug&&this.generateDebugCode("block return"),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.doReturn(stack[vm.sp--], context.pointers[0]); return bytecodes + ",this.pc,";\n"),this.needsBreak=!1},generateJump:function(t){var e=this.pc+t;this.debug&&this.generateDebugCode("jump to "+e),this.generateLabel(),this.source.push("vm.pc = ",e,"; "),0>t?this.source.push("bytecodes += ",-t,"; "):this.source.push("bytecodes -= ",t,"; "),0>t&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",e,";\n","}\n"),this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return bytecodes + ",e,";\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[e]=!0,e>this.endPC&&(this.endPC=e)},generateJumpIf:function(t,i){var e=this.pc+i;this.debug&&this.generateDebugCode("jump if "+t+" to "+e),this.generateLabel(),this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",t,"Obj) {vm.pc = ",e,"; bytecodes -= ",i,"; "),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",e,"; else "),this.source.push("continue}\n","else if (cond !== vm.",!t,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return bytecodes + ",this.pc,"}\n"),this.needsLabel[this.pc]=!0,this.needsLabel[e]=!0,e>this.endPC&&(this.endPC=e)},generateQuickPrim:function(e){switch(this.debug&&this.generateDebugCode("quick prim "+this.specialSelectors[(15&e)+16]),this.generateLabel(),e){case 194:return this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"; }\n"),void(this.needsLabel[this.pc]=!0);case 198:return void this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");case 199:return void this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");case 200:return this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) ","{vm.sendSpecial(",(15&e)+16,"); return bytecodes + ",this.pc,"}\n"),this.needsLabel[this.pc]=!0,void(this.needsLabel[this.pc+2]=!0);case 201:case 202:case 203:return this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) vm.sendSpecial(",(15&e)+16,"); return bytecodes + ",this.pc,";\n"),void(this.needsLabel[this.pc]=!0)}this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,"))"," vm.sendSpecial(",(15&e)+16,");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n","if (vm.pc !== ",this.pc,") throw Error('Huh?');\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateNumericOp:function(e){switch(this.debug&&this.generateDebugCode("numeric op "+this.specialSelectors[15&e]),this.generateLabel(),this.needsLabel[this.pc]=!0,e){case 176:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 177:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 178:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 179:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 180:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 181:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 182:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 183:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 184:return void this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(8); return bytecodes + ",this.pc,"}\n");case 185:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return bytecodes + ",this.pc,"}\n");case 186:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return bytecodes + ",this.pc,"}\n");case 187:return void this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",this.pc,"; vm.sendSpecial(11); return bytecodes + ",this.pc,"}\n");case 188:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return bytecodes + ",this.pc,"}\n");case 189:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return bytecodes + ",this.pc,"}\n");case 190:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(14); return bytecodes + ",this.pc,"}\n");case 191:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return bytecodes + ",this.pc,"}\n")
}},generateSend:function(e,t,i,r,n){this.debug&&this.generateDebugCode("send "+("lit["===e?this.method.pointers[t].bytesAsString():"...")),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.send(",e,t,i,", ",r,", ",n,"); ","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateClosureTemps:function(e,i){if(this.debug&&this.generateDebugCode("closure temps"),this.generateLabel(),this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",e,");\n"),i){for(var t=0;e>t;t++)this.source.push("array.pointers[",t,"] = stack[vm.sp - ",e-t-1,"];\n");this.source.push("stack[vm.sp -= ",e-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(n,e,s){var i=this.pc,t=i+s;if(this.debug&&this.generateDebugCode("push closure("+i+"-"+(t-1)+"): "+n+" args, "+e+" captured"),this.generateLabel(),this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",e+3,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",i+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",n,";\n"),e>0){for(var r=0;e>r;r++)this.source.push("closure.pointers[",r+3,"] = stack[vm.sp - ",e-r-1,"];\n");this.source.push("stack[vm.sp -= ",e-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",t,";\n"),this.source.push("bytecodes -= ",s,";\n"),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",t,";\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[i]=!0,this.needsLabel[t]=!0,t>this.endPC&&(this.endPC=t)},generateLabel:function(){this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n"),this.prevPC=this.pc},generateDebugCode:function(i){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + (vm.pc = ",this.prevPC,");\n"),this.needsLabel[this.prevPC]=!0);for(var t=[],e=this.prevPC;e<this.pc;e++)t.push((this.method.bytes[e]+256).toString(16).slice(-2).toUpperCase());this.source.push("// ",this.prevPC," <",t.join(" "),"> ",i,"\n"),this.needsBreak=this.singleStep},generateInstruction:function(e,t){this.debug&&this.generateDebugCode(e),this.generateLabel(),this.source.push(t,";\n")},deleteUnneededLabels:function(){for(var t in this.sourceLabels)if(!this.needsLabel[t])for(var e=0;3>e;e++)this.source[this.sourceLabels[t]+e]=""}})}),module("users.bert.SqueakJS.plugins.ADPCMCodecPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function u(t,e){return e>31?0:t<<e}function l(t,e){return e>31?0:t>>>e}function k(){return b}function v(r,s){var i,e,t;for(e=s-r,0>e&&(e=0-e),i=63,t=1;62>=t;t++)63===i&&n[t-1]>=e&&(i=t);return i}function s(o){var e,n,s;for(n=0,e=o;;){if(s=e-i,!(s>0))return n+=l(t,0-s),i-=e,t&=l(255,8-i),n;n+=u(t,s),e-=i,t=a[++r-1],i=8}}function o(c,f){var o,n,s,e;for(n=f,s=c;;){if(o=8-i,e=o-s,!(0>e))return t+=u(n,e),i+=s,self;t+=l(n,0-e),a[++r-1]=t,i=0,t=0,n&=u(1,0-e)-1,s-=o}}function m(){var o,S,f,h,p,c,d,F,O,g,k,b,l,y,u,m,v;if(o=e.stackValue(1),S=e.stackIntegerValue(0),u=e.fetchIntegerofObject(0,o),l=e.fetchIntegerofObject(1,o),O=e.fetchIntegerofObject(2,o),k=e.fetchIntegerofObject(3,o),g=e.fetchIntegerofObject(4,o),b=e.fetchIntegerofObject(5,o),t=e.fetchIntegerofObject(6,o),i=e.fetchIntegerofObject(7,o),r=e.fetchIntegerofObject(8,o),a=e.fetchBytesofObject(9,o),v=e.fetchInt16ArrayofObject(10,o),m=e.fetchIntegerofObject(12,o),F=e.fetchIntegerofObject(13,o),n=e.fetchInt16ArrayofObject(14,o),y=e.fetchInt16ArrayofObject(15,o),e.failed())return null;for(p=1;S>=p;p++)if(1===(p&b))u=s(16),u>32767&&(u-=65536),l=s(6),v[++m-1]=u;else{for(h=s(F),d=n[l],c=0,f=g;f>0;)(h&f)>0&&(c+=d),d>>>=1,f>>>=1;c+=d,(h&O)>0?u-=c:u+=c,u>32767?u=32767:-32768>u&&(u=-32768),l+=y[h&k],0>l?l=0:l>88&&(l=88),v[++m-1]=u}return e.failed()?null:(e.storeIntegerofObjectwithValue(0,o,u),e.storeIntegerofObjectwithValue(1,o,l),e.storeIntegerofObjectwithValue(6,o,t),e.storeIntegerofObjectwithValue(7,o,i),e.storeIntegerofObjectwithValue(8,o,r),e.storeIntegerofObjectwithValue(12,o,m),void e.pop(1))}function d(){var o,x,m,b,g,S,c,f,d,k,u,l,F,y,P,I,V,O,j,p,A,v,C,h,w;if(o=e.stackValue(1),x=e.stackIntegerValue(0),v=e.fetchInt16ArrayofObject(0,o),p=e.fetchInt16ArrayofObject(1,o),I=e.fetchIntegerofObject(2,o),O=e.fetchIntegerofObject(3,o),V=e.fetchIntegerofObject(4,o),j=e.fetchIntegerofObject(5,o),t=e.fetchIntegerofObject(6,o),i=e.fetchIntegerofObject(7,o),r=e.fetchIntegerofObject(8,o),a=e.fetchBytesofObject(9,o),w=e.fetchInt16ArrayofObject(10,o),C=e.fetchInt16ArrayofObject(11,o),h=e.fetchIntegerofObject(12,o),P=e.fetchIntegerofObject(13,o),n=e.fetchInt16ArrayofObject(14,o),A=e.fetchInt16ArrayofObject(15,o),e.failed())return null;for(u=v[0],l=v[1],c=p[0],f=p[1],S=1;x>=S;S++)if(1===(S&j))u=s(16),c=s(6),l=s(16),f=s(6),u>32767&&(u-=65536),l>32767&&(l-=65536),w[++h-1]=u,C[h-1]=l;else{for(b=s(P),g=s(P),F=n[c],y=n[f],d=k=0,m=V;m>0;)(b&m)>0&&(d+=F),(g&m)>0&&(k+=y),F>>>=1,y>>>=1,m>>>=1;d+=F,k+=y,(b&I)>0?u-=d:u+=d,(g&I)>0?l-=k:l+=k,u>32767?u=32767:-32768>u&&(u=-32768),l>32767?l=32767:-32768>l&&(l=-32768),c+=A[b&O],0>c?c=0:c>88&&(c=88),f+=A[g&O],0>f?f=0:f>88&&(f=88),w[++h-1]=u,C[h-1]=l}return v[0]=u,v[1]=l,p[0]=c,p[1]=f,e.failed()?null:(e.storeIntegerofObjectwithValue(6,o,t),e.storeIntegerofObjectwithValue(7,o,i),e.storeIntegerofObjectwithValue(8,o,r),e.storeIntegerofObjectwithValue(12,o,h),void e.pop(1))}function p(){var s,y,k,b,f,d,S,p,m,c,I,P,F,O,l,A,u,h,g;if(s=e.stackValue(1),y=e.stackIntegerValue(0),u=e.fetchIntegerofObject(0,s),l=e.fetchIntegerofObject(1,s),P=e.fetchIntegerofObject(2,s),F=e.fetchIntegerofObject(4,s),O=e.fetchIntegerofObject(5,s),t=e.fetchIntegerofObject(6,s),i=e.fetchIntegerofObject(7,s),r=e.fetchIntegerofObject(8,s),a=e.fetchBytesofObject(9,s),g=e.fetchInt16ArrayofObject(10,s),h=e.fetchIntegerofObject(12,s),I=e.fetchIntegerofObject(13,s),n=e.fetchInt16ArrayofObject(14,s),A=e.fetchInt16ArrayofObject(15,s),e.failed())return null;for(c=n[0],d=1;y>=d;d++)if(1===(d&O))u=g[++h-1],(S=u)<0&&(S+=65536),o(16,S),y>d&&(l=v(u,g[h])),o(6,l);else{for(m=0,f=g[++h-1]-u,0>f&&(m=P,f=0-f),b=0,p=0,k=F;k>0;)f>=c&&(b+=k,p+=c,f-=c),c>>>=1,k>>>=1;p+=c,m>0?u-=p:u+=p,u>32767?u=32767:-32768>u&&(u=-32768),l+=A[b],0>l?l=0:l>88&&(l=88),c=n[l],o(I,m|b)}return i>0&&(a[++r-1]=t),e.failed()?null:(e.storeIntegerofObjectwithValue(0,s,u),e.storeIntegerofObjectwithValue(1,s,l),e.storeIntegerofObjectwithValue(6,s,t),e.storeIntegerofObjectwithValue(7,s,i),e.storeIntegerofObjectwithValue(8,s,r),e.storeIntegerofObjectwithValue(12,s,h),void e.pop(1))}function c(){var s,o;return s=e.stackValue(1),o=e.stackIntegerValue(0),t=e.fetchIntegerofObject(6,s),i=e.fetchIntegerofObject(7,s),r=e.fetchIntegerofObject(8,s),a=e.fetchIntegerofObject(9,s),n=e.fetchIntegerofObject(14,s),e.failed()?null:(success(!1),e.failed()?null:(e.storeIntegerofObjectwithValue(6,s,t),e.storeIntegerofObjectwithValue(7,s,i),e.storeIntegerofObjectwithValue(8,s,r),void e.pop(1)))}function g(i){var t;return e=i,t=e.majorVersion()==f,t===!1?!1:t=e.minorVersion()>=h}var f=1,h=11,i=0,r=0,t=0,a=null,e=null,b="ADPCMCodecPlugin 3 November 2014 (e)",n=null;Squeak.registerExternalModule("ADPCMCodecPlugin",{primitiveDecodeStereo:d,primitiveEncodeStereo:c,setInterpreter:g,primitiveEncodeMono:p,primitiveDecodeMono:m,getModuleName:k})}),module("users.bert.SqueakJS.plugins.B2DPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function st(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function p(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function Gh(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function Ot(e,t){return 0|Math.floor(e/t)}function Kh(e,t){return e-Ot(e,t)*t|0}function M(t,e){return e>31?0:t<<e}function n(t,e){return e>31?0:t>>>e}function x(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}function su(e,t){return new Float32Array(e.buffer,e.byteOffset+4*t)}function D(){return t[io]}function $n(e){return t[io]=e}function tt(){return t[ro]}function Dh(e){return t[ro]=e}function _i(i,t){var e;return e=i+P()-1&~(P()-1),e>t?t:e}function Nh(e){return t[ff]=e}function Ni(t,e){return e-1&~(P()-1)}function P(){return t[no]}function Vh(e){return t[no]=e}function mt(){return t[so]}function Xn(e){return t[so]=e}function b(){return t[ao]}function In(e){return t[ao]=e}function Ql(i){var e,t;return e=65535&i,t=i>>>16&255,(e*e>>>16)+e*t*2+(t*t<<16)>>>8}function gr(e,t){var i;return 0===e?0>t?0-t:t:0===t?0>e?0-e:e:(i=e*e+t*t,yc(i))}function yn(e){return ma(1)?(B[K()]=e,void hn(K()+1)):0}function vl(e,i,t,s){var r,n;z(e)[T]=z(e)[T]-256*t,r=et(e)[T],et(e)[T]=r+256*(i-t),n=et(e)[qt],et(e)[qt]=n+256*i,So(e,s-t)}function yu(e,t,i,s){var r,n;z(e)[T]=z(e)[T]+256*i,r=et(e)[T],et(e)[T]=r-256*(t-i),n=et(e)[qt],et(e)[qt]=n+256*t,So(e,s-i+t)}function xh(e,r,l){var s,i,a,t,n,u,o;u=ss(e),o=os(e),s=fr(e),a=Ct(s),t=ls(e),n=qr(e),i=l-r,s>u&&(0>n?t-=i:(t+=i,G(e,r))),o+a===0&&(n>0?t-=Ht(e):(t+=Ht(e),G(e,r))),o+a>0&&(0>n?(t+=i,G(e,r)):t-=i),nr(e,t)}function C(){return t[oo]}function ot(e){return t[oo]=e}function W(){return t[uo]}function Ki(e){return t[uo]=e}function au(e){return X(e)}function ah(){var e;return gt(Gt)?(e=O,O=e+Gt,U(e,da),nt(e,0),pt(e,Gt),e):0}function Hr(){return lu(6),E()}function pf(i,s){var n,t,r,e;if(r=ll+i,!gt(r))return 0;if(t=O,O=t+r,U(t,oc),nt(t,0),pt(t,r),n=Ia(t),br())for(e=0;i-1>=e;e++)n[e]=q(s[e]);else for(e=0;i-1>=e;e++)n[e]=s[e];return Qf(t,i),t}function ma(e){var i,t,r,n;if(!au(e))return!1;if(0!==W())for(r=W(),i=W()+e,t=1,n=W();n>=t;t++)g[--i]=g[--r];return g=x(g,e),!0}function nf(s,i,a){var t,r,e,n;if(r=Uc+i,!gt(r))return 0;if(t=O,O=t+r,a?U(t,dc):U(t,pc),nt(t,0),pt(t,r),n=Pr(t),br())for(e=0;i-1>=e;e++)n[e]=q(s[e]);else for(e=0;i-1>=e;e++)n[e]=s[e];return Mf(t,i),t}function ef(){var e;return gt(At)?(e=O,O=e+At,U(e,ga),nt(e,0),pt(e,At),e):0}function gt(e){var i,t,r,n;if(!ma(e))return!1;if(0!==K())for(r=K(),i=K()+e,t=1,n=K();n>=t;t++)B[--i]=B[--r];return B=x(B,e),!0}function Fc(e){return X(e)}function As(){return lu(_())}function $u(){var e;return gt(Ir)?(e=O,O=e+Ir,U(e,kc),nt(e,0),pt(e,Ir),e):0}function Qu(){var e;return gt(si)?(e=O,O=e+si,U(e,bc),nt(e,0),pt(e,si),e):0}function Yu(e){return 0===(Ru(e)&kn)}function ns(e,t,i){if(t>i){if(e>t)return t;if(i>e)return i}else{if(t>e)return t;if(e>i)return i}return e}function _r(e){return s(e,qs)}function es(e,t){return a(e,qs,t)}function Mr(e){return s(e,Ms)}function Yo(e,t){return a(e,Ms,t)}function Po(e){return s(e,Bs)}function So(e,t){return a(e,Bs,t)}function z(e){return x(Z,e+ml)}function Oh(e){return s(e,Ls)}function ru(e,t){return a(e,Ls,t)}function Lu(e){return s(e,Rs)}function Us(e,t){return a(e,Rs,t)}function Jc(e){return s(e,xs)}function Qf(e,t){return a(e,xs,t)}function fh(e){return s(e,Ps)}function mh(e,t){return a(e,Ps,t)}function du(e){return s(e,Cs)}function Ll(e,t){return a(e,Cs,t)}function Uh(e){return s(e,ws)}function af(e,t){return a(e,ws,t)}function zh(e){return s(e,Vs)}function Rh(e,t){return a(e,Vs,t)}function pu(e){return s(e,Ns)}function _h(e,t){return a(e,Ns,t)}function Ui(r,h,u,f){var p,s,t,l,c,o,a,i,e;return t=fh(r),l=Uh(r),32===t?(e=0|h[l*f+u],0!==e&&0===(4278190080&e)&&(e=4278190080|e),ou(e)):(i=Pc()[t],e=h[l*f+n(u,i)],c=M(1,t)-1,i=32-t-(u&M(1,i)-1)*t,e=n(e,i)&c,16===t?0!==e&&(s=(31&e)<<3,s+=s>>>5,o=(e>>>5&31)<<3,o+=o>>>5,a=(e>>>10&31)<<3,a+=a>>>5,p=255,e=s+(o<<8)+(a<<16)+(p<<24)):e=0===Jc(r)?0:Ia(r)[e],ou(e))}function hu(e){return s(e,js)}function Mh(e,t){return a(e,js,t)}function Tt(e){return dt(E()-e+4)}function qi(e,t){return ht(E()-e+4,t)}function jt(e){return dt(E()-e+5)}function xi(e,t){return ht(E()-e+5,t)}function $t(e){return dt(E()-e+0)}function Qn(e,t){return ht(E()-e+0,t)}function wt(e){return dt(E()-e+1)}function Zn(e,t){return ht(E()-e+1,t)}function Vi(e){return dt(E()-e+2)}function Ci(e,t){return ht(E()-e+2,t)}function Pi(e){return dt(E()-e+3)}function Ai(e,t){return ht(E()-e+3,t)}function Yn(n,o,u){var t,e,s,i,a,r;for(s=p(n),t=n.wordsAsInt32Array(),i=0,e=0;s-1>=e;e++){if(a=Wt(e,t),r=Ii(e,t),!(r>=0&&o>=r))return!1;i+=a}return i===u}function wh(i){var r,n,t,s;if(!e.isWords(i))return!1;for(s=p(i),n=i.wordsAsInt32Array(),t=0;s-1>=t;t++)if(r=n[t],!L(r))return!1;return!0}function Ph(i,a){var e,r,t,n,s;for(r=p(i),n=i.wordsAsInt32Array(),t=0,e=0;r-1>=e;e++)s=Wt(e,n),t+=s;return t===a}function Ah(i,r){var t;return e.isWords(i)?(t=p(i),t!==3*r&&t!==6*r?!1:!0):!1}function Ih(r,e,n,s,a,o,i){var t;return Ah(r,e)&&wh(i)?(t=p(i),Yn(n,t,e)&&Yn(s,t,e)&&Yn(o,t,e)&&Ph(a,e)?!0:!1):!1}function yh(e){var t;return t=Ut(e)?un(e):0,Mr(e)+t<Qi()?0:A(e)-t>=rt()&&_r(e)-t>=rt()?0:void yn(e)}function Yf(e){return Iu(e)?_f(e):Jf(e)?yh(e):void yn(e)}function _f(e){var t;return t=Ut(e)?fr(e):0,xr(e)+t<Qi()?0:A(e)-t>=rt()&&_s(e)-t>=rt()?0:void yn(e)}function En(){var e=[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1];return e}function Rn(){var e=[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0];return e}function Ft(e,t){return 0>e?0:e>=t?t-1:e}function pr(){var e,t;for(e=n(Er(),b()),t=n(Gi(),b())+1,0>e&&(e=0),t>St()&&(t=St());t>e;)u[e]=0,++e;Kr(St()),zi(0)}function Wn(){return t[mo]}function Lt(e){return t[mo]=e}function Rt(){return t[vo]}function qn(e){return t[vo]=e}function jn(){return t[ko]}function Ea(e){return t[ko]=e}function zt(){return t[bo]}function Pn(e){return t[bo]=e}function An(){return t[go]}function Aa(e){return t[go]=e}function $i(){return su(t,Cf)}function Ia(e){return x(Z,e+nl)}function Fa(e,s){var f,o,u,n,t,l,a,c,i,m,h,p,d;return u=m=$t(e),n=h=wt(e),l=p=Vi(e),a=d=Pi(e),f=Tt(e),o=jt(e),c=u+=(p-m)*s|0,i=n+=(d-h)*s|0,l+=(f-p)*s|0,a+=(o-d)*s|0,c+=(l-u)*s|0,i+=(a-n)*s|0,n=ns(n,h,i),a=ns(a,i,o),t=Hr(),r?0:(Ci(e,u),Ai(e,n),qi(e,c),xi(e,i),Qn(t,c),Zn(t,i),Ci(t,l),Ai(t,a),qi(t,f),xi(t,o),t)}function Sa(e){var l,c,n,s,t,o,a,u,i,p,d,f,h;return t=Hr(),r?0:(n=p=$t(e),s=d=wt(e),o=f=Vi(e),a=h=Pi(e),l=Tt(e),c=jt(e),n+=f-p>>1,s+=h-d>>1,u=o+=l-f>>1,i=a+=c-h>>1,u+=n-o>>1,i+=s-a>>1,Ci(e,n),Ai(e,s),qi(e,u),xi(e,i),Qn(t,u),Zn(t,i),Ci(t,o),Ai(t,a),qi(t,l),xi(t,c),t)}function ya(i,r){var e,t,n;e=z(i)[T]>>8,t=et(i)[T]>>8,e>t&&(n=e,e=t,t=n),G(i,e),t-e>r?ln(i,t-e):ln(i,r)}function yc(e){return 32>e?Ec()[e]:Math.sqrt(e)+.5|0}function gc(e,t,i){return ji||kr()?ji(e,t,i):!1}function Yl(){var t,e;for(e=0,t=O;t>e;)$f(e)&&(Q(e)>=Rr()||Yf(e)),e+=Gu(e)}function y(){return t[wo]}function Jt(e){return t[wo]=e}function bn(){return t[Vo]}function Hs(e){return t[Vo]=e}function vn(){return t[jo]}function pl(e){return t[jo]=e}function pn(){return t[xo]}function Tu(e){return t[xo]=e}function cn(r){var e,t,i;return e=n(Er(),b()),e<zt()&&(e=zt()),t=n(Gi()+P()-1,b()),t>Rt()&&(t=Rt()),i=n(r,b()),i<An()||i>=jn()||t<zt()||e>=Rt()?0:void gc(e,t,i)}function or(e){return U(e,J(e)|kn)}function lr(e){return U(e,J(e)&~kn)}function Cu(e){return s(e,ua)}function on(e,t){return a(e,ua,t)}function ft(e){return s(e,ca)}function H(e,t){return a(e,ca,t)}function mu(e){return s(e,la)}function an(e,t){return a(e,la,t)}function sn(){return su(t,Rf)}function kh(e){return J(e)>>>1}function A(e){return s(e,wa)}function G(e,t){return a(e,wa,t)}function Q(e){return s(e,Va)}function hi(e,t){return a(e,Va,t)}function Jr(e){return s(e,ja)}function tr(e,t){return a(e,ja,t)}function pi(){}function fo(n,r){var e,i,t;for(e=Zi(),i=n,t=nn();r>t;){if(e=Zi(),0!==e&&cs(e,i,t))return!0;Xi(t),i=t,t=nn()}return e=Zi(),0!==e?cs(e,i,r):!1}function qf(){return cf(Di(),xt(),Nt(),y())}function hf(l,f,h){var a,r,c,o,i,s,t,e;if(t=f,e=h,r=-1,1===P())for(;e>t;)i=0|l[++r],u[t]=i,++t;else for(c=D(),o=tt(),a=b();e>t;)s=n(t,a),i=0|l[++r],i=n(i&c,o),u[s]=u[s]+i,++t;e>Gi()&&zi(e),e>Ji()&&Oi(e)}function cf(e,c,b,g){var h,s,a,d,l,n,f,r,p,v,m,o,k,i,t;if(1!==P())return lf(e,c,b,g);if(h=Ca(e),!h)return null;for(a=hu(e),s=du(e),m=1===pu(e),d=c-bt(e),l=g-ar(e),f=mr(e),p=Wr(e),n=d*f+l*Sr(e),r=d*p+l*Nr(e),o=c,k=b;k>o;)m&&(n=yt(n,a<<16),r=yt(r,s<<16)),i=n>>16,t=r>>16,m||(i=Ft(i,a),t=Ft(t,s)),i>=0&&t>=0&&a>i&&s>t&&(v=Ui(e,h,i,t),u[o]=v),n+=f,r+=p,++o}function lf(i,g,F,w){var C,y,k,l,o,d,h,O,S,s,v,r,m,a,A,f,I,p,c,t,e;if(k=Ca(i),!k)return null;for(o=hu(i),l=du(i),p=1===pu(i),O=g-bt(i),S=w-ar(i),v=mr(i),m=Wr(i),s=O*v+S*Sr(i),r=O*m+S*Nr(i),C=P(),A=_i(g,F),I=Ni(g,F),y=b(),d=D(),h=tt(),c=g;A>c;)p&&(s=yt(s,o<<16),r=yt(r,l<<16)),t=s>>16,e=r>>16,p||(t=Ft(t,o),e=Ft(e,l)),t>=0&&e>=0&&o>t&&l>e&&(a=Ui(i,k,t,e),a=n(a&d,h),f=n(c,y),u[f]=u[f]+a),s+=v,r+=m,++c;for(d=4042322160|n(D(),b()),h=b();I>c;)p&&(s=yt(s,o<<16),r=yt(r,l<<16)),t=s>>16,e=r>>16,p||(t=Ft(t,o),e=Ft(e,l)),t>=0&&e>=0&&o>t&&l>e&&(a=Ui(i,k,t,e),a=n(a&d,h),f=n(c,y),u[f]=u[f]+a),s+=M(v,h),r+=M(m,h),c+=C;for(d=D(),h=tt();F>c;)p&&(s=yt(s,o<<16),r=yt(r,l<<16)),t=s>>16,e=r>>16,p||(t=Ft(t,o),e=Ft(e,l)),t>=0&&e>=0&&o>t&&l>e&&(a=Ui(i,k,t,e),a=n(a&d,h),f=n(c,y),u[f]=u[f]+a),s+=v,r+=m,++c}function gi(t,r,n){var e,i;if(1!==P())return sf(t,r,n);for(e=r,i=n;i>e+4;)u[e]=t,u[e+1]=t,u[e+2]=t,u[e+3]=t,e+=4;for(;i>e;)u[e]=t,++e}function sf(l,a,r){var f,s,h,o,t,c,i,e;if(o=_i(a,r),c=Ni(a,r),f=P(),s=b(),e=a,o>e)for(i=n(l&D(),tt());o>e;)t=n(e,s),u[t]=u[t]+i,++e;if(c>e)for(h=4042322160|n(D(),b()),i=n(l&h,b());c>e;)t=n(e,s),u[t]=u[t]+i,e+=f;if(r>e)for(i=n(l&D(),tt());r>e;)t=n(e,s),u[t]=u[t]+i,++e}function mr(e){return s(e,Na)}function rf(e,t){return a(e,Na,t)}function Sr(e){return s(e,_a)}function tf(e,t){return a(e,_a,t)}function Yc(){return Xc(Di(),xt(),Nt(),y())}function Xc(i,c,f,h){var n,s,o,e,r,t,l,a;for(o=Pr(i),r=Li(i),s=mr(i),n=(c-bt(i))*s+(h-ar(i))*Sr(i),t=l=c,a=f;((e=n>>16)<0||e>=r)&&a>t;)++t,n+=s;if(t>l&&(0>e&&(e=0),e>=r&&(e=r-1),gi(o[e],l,t)),1===P())for(;(e=n>>16)<r&&e>=0&&a>t;)u[t]=o[e],++t,n+=s;else t=Hc(i,o,n,s,t,f);a>t&&(0>e&&(e=0),e>=r&&(e=r-1),gi(o[e],t,a))}function Hc(y,p,g,v,h,l){var k,c,o,a,r,d,s,m,e,f,i,t;for(k=P(),c=b(),f=Li(y),r=g,t=h,e=r>>16,d=_i(h,l),m=Ni(h,l),o=D(),a=tt();d>t&&f>e&&e>=0;){for(i=p[e],i=n(i&o,a);d>t&&r>>16===e;)s=n(t,c),u[s]=u[s]+i,++t,r+=v;e=r>>16}for(o=4042322160|n(D(),b()),a=b();m>t&&f>e&&e>=0;){for(i=p[e],i=n(i&o,a);m>t&&r>>16===e;)s=n(t,c),u[s]=u[s]+i,t+=k,r+=M(v,a);e=r>>16}for(o=D(),a=tt();l>t&&f>e&&e>=0;){for(i=p[e],i=n(i&o,a);l>t&&r>>16===e;)s=n(t,c),u[s]=u[s]+i,++t,r+=v;e=r>>16}return t}function rt(){return t[qo]}function zc(e){return t[qo]=e}function Rr(){return t[Mo]}function Tc(e){return t[Mo]=e}function Lr(){return t[Bo]}function Ic(e){return t[Bo]=e}function Qi(){return t[No]}function el(e){return t[No]=e}function Wr(e){return s(e,Wa)}function Uu(e,t){return a(e,Wa,t)}function Nr(e){return s(e,Da)}function xu(e,t){return a(e,Da,t)}function bt(e){return s(e,Ta)}function Wh(e,t){return a(e,Ta,t)}function ar(e){return s(e,La)}function jh(e,t){return a(e,La,t)}function Ch(f,l,a,m,d,h,p){var t,r,s,c,e,o,i,n;for(t=0|a[0],r=0|a[1],e=gr(t>>16,r>>16),o=l[e],s=(e-1)*(e-1),i=h,n=p,n>bt(f)&&(n=bt(f));n>i;){for(;n>i&&j(t>>16,r>>16)>=s;)u[i]=o,++i,t+=m,r+=d;for(c=j(t>>16,r>>16);s>c;)--e,o=l[e],s=(e-1)*(e-1)}return a[0]=t,a[1]=r,i}function Fh(I,h,m,g,S,y,F){var O,d,c,a,r,s,v,l,k,o,p,t,e,i,f;if(r=0|m[0],s=0|m[1],O=P(),d=b(),t=gr(r>>16,s>>16),o=(t-1)*(t-1),i=y,f=bt(I),f>F&&(f=F),v=_i(y,f),k=Ni(y,f),v>i)for(c=D(),a=tt(),e=h[t],e=n(e&c,a);v>i;){for(;v>i&&j(r>>16,s>>16)>=o;)l=n(i,d),u[l]=u[l]+e,++i,r+=g,s+=S;for(p=j(r>>16,s>>16);o>p;)--t,e=h[t],e=n(e&c,a),o=(t-1)*(t-1)}if(k>i)for(c=4042322160|n(D(),b()),a=b(),e=h[t],e=n(e&c,a);k>i;){for(;k>i&&j(r>>16,s>>16)>=o;)l=n(i,d),u[l]=u[l]+e,i+=O,r+=M(g,a),s+=M(S,a);for(p=j(r>>16,s>>16);o>p;)--t,e=h[t],e=n(e&c,a),o=(t-1)*(t-1)}if(f>i)for(c=D(),a=tt(),e=h[t],e=n(e&c,a);f>i;){for(;f>i&&j(r>>16,s>>16)>=o;)l=n(i,d),u[l]=u[l]+e,++i,r+=g,s+=S;for(p=j(r>>16,s>>16);o>p;)--t,e=h[t],e=n(e&c,a),o=(t-1)*(t-1)}return m[0]=r,m[1]=s,i}function Of(){return of(Di(),xt(),Nt(),y())}function of(t,c,d,v){var s,p,h,l,o,f,a,m,n,u,e,r;for(n=Pr(t),u=Li(t),p=c-bt(t),h=v-ar(t),o=mr(t),a=Wr(t),l=p*o+h*Sr(t),f=p*a+h*Nr(t),e=c,r=d,m=(u-1)*(u-1);j(l>>16,f>>16)>=m&&r>e;)++e,l+=o,f+=a;e>c&&gi(n[u-1],c,e),s=i(),s[0]=l,s[1]=f,e<bt(t)&&(e=1===P()?Ch(t,n,s,o,a,e,r):Fh(t,n,s,o,a,e,r)),r>e&&(e=1===P()?Hu(t,n,s,o,a,e,r):zu(t,n,s,o,a,e,r)),d>e&&gi(n[u-1],e,d)}function Hu(k,h,n,v,m,d,p){var i,t,a,f,s,e,l,o,r,c;for(i=0|n[0],t=0|n[1],e=gr(i>>16,t>>16),o=h[e],l=Li(k),f=(l-1)*(l-1),s=(e+1)*(e+1),a=j(i>>16,t>>16),r=d,c=p;c>r&&f>a;){for(;c>r&&j(i>>16,t>>16)<=s;)u[r]=o,++r,i+=v,t+=m;for(a=j(i>>16,t>>16);a>s;)++e,o=h[e],s=(e+1)*(e+1)}return n[0]=i,n[1]=t,r}function zu(A,p,g,F,y,S,d){var I,k,f,o,r,a,m,c,s,v,h,l,t,O,e,i;if(r=0|g[0],a=0|g[1],I=P(),k=b(),t=gr(r>>16,a>>16),O=Li(A),h=(O-1)*(O-1),l=(t+1)*(t+1),s=j(r>>16,a>>16),i=S,m=_i(S,d),v=Ni(S,d),m>i&&h>s)for(f=D(),o=tt(),e=p[t],e=n(e&f,o);m>i&&h>s;){for(;m>i&&j(r>>16,a>>16)<=l;)c=n(i,k),u[c]=u[c]+e,++i,r+=F,a+=y;for(s=j(r>>16,a>>16);s>l;)++t,e=p[t],e=n(e&f,o),l=(t+1)*(t+1)}if(v>i&&h>s)for(f=4042322160|n(D(),b()),o=b(),e=p[t],e=n(e&f,o);v>i&&h>s;){for(;v>i&&j(r>>16,a>>16)<=l;)c=n(i,k),u[c]=u[c]+e,i+=I,r+=M(F,o),a+=M(y,o);for(s=j(r>>16,a>>16);s>l;)++t,e=p[t],e=n(e&f,o),l=(t+1)*(t+1)}if(d>i&&h>s)for(f=D(),o=tt(),e=p[t],e=n(e&f,o);d>i&&h>s;){for(;d>i&&j(r>>16,a>>16)<=l;)c=n(i,k),u[c]=u[c]+e,++i,r+=F,a+=y;for(s=j(r>>16,a>>16);s>l;)++t,e=p[t],e=n(e&f,o),l=(t+1)*(t+1)}return g[0]=r,g[1]=a,i}function vs(t,i){var e;return e=Et(t)-Et(i),0!==e?e>0:Kt(t)>>>0<Kt(i)>>>0}function cs(i,n,s){var r,t,e;if(0===i)return!1;if(t=n<Ji()?Ji():n,e=s>M(St(),b())?M(St(),b()):s,t<Lr()&&(t=Lr()),e>rt()&&(e=rt()),t<Er()&&Kr(t),e>Gi()&&zi(e),e>Ji()&&Oi(e),t>=e)return!1;if(vr(i))gi(i,t,e);else{if(Ku(i),Ju(t),Xu(e),r=vh(i),1>=r)return!0;switch(r){case 0:case 1:pi();break;case 2:Yc();break;case 3:Of();break;case 4:case 5:qf()}}return!1}function vh(e){return(J(e)&ba)>>>8}function jr(){var e,t,i;for(i=y();Y()<K();){if(e=B[Y()],Q(e)>i)return!1;if(t=J(e),(t&rr)===On)return!0;if(!X(1))return!1;switch(t){case 0:case 1:case 2:case 3:pi();break;case 4:vf();break;case 5:yf();break;case 6:df();break;case 7:bf()}rs(e),yr(Y()+1)}return!1}function Cr(){var t,i,n,e;for(i=e=rt();C()<W();){if(t=n=g[C()],i=e=A(t),i>=rt())return!1;if(Xi(i),Ut(t)&&Xf(t),Yu(t)&&(Hf(t),r))return!1;ot(C()+1),C()<W()&&(n=g[C()],e=A(n),e>=Lr()&&fo(i,e))}return e<rt()&&fo(e,rt()),!1}function Ar(){for(var t,e,i;C()<W();)if(e=g[C()],t=ft(e)-1,0===t)Ds();else{if(H(e,t),i=J(e),(i&rr)===On)return!0;switch(i){case 0:case 1:case 2:case 3:pi();break;case 4:Af();break;case 5:jf();break;case 6:Ff();break;case 7:wf()}Ys(),ot(C()+1)}return!1}function Ts(t,i){var e;for(e=0;e<V()&&(Kt(e)!==t||Et(e)!==i);)e+=_();return e>=V()?-1:e}function Ri(){return _t()===Yt}function fu(){Sh(_())}function Mu(){return Eh}function ei(t,i){var e;return t===i?!0:(e=Q(t)-Q(i),0!==e?0>e:(e=A(t)-A(i),0>e))}function Y(){return t[_o]}function yr(e){return t[_o]=e}function K(){return t[Wo]}function hn(e){return t[Wo]=e}function Li(e){return s(e,Ra)}function Mf(e,t){return a(e,Ra,t)}function Pr(e){return x(Z,e+Gc)}function br(){return 0!==tl()}function tl(){return t[Do]}function wr(e){return t[Do]=e}function Nf(){return 0!==Df()}function Df(){return t[To]}function Vr(e){return t[To]=e}function oa(s,a){var e,i,r,n,t;if(e=Ts(s,a),-1===e)return!1;if(0===e)return fu(),!0;if(ki(e,Kt(0)),yi(e,Et(0)),Xt(e,dr(0)),fu(),V()<=_())return!0;for(t=0,e=_();e<V();)vs(e,t)&&(t=e),e+=_();return t+_()===V()?!0:(n=Kt(t),ki(t,tn()),rn(n),i=Et(t),yi(t,Zr()),Qr(i),r=dr(t),Xt(t,$r()),en(r),!0)}function h(e,i){return t[e]=t[e]+i}function Sc(i){var e,t;for(t=A(i),e=0;e<W()&&A(g[e])<t;)++e;for(;e<W()&&A(g[e])===t&&ei(g[e],i);)++e;return e}function Rc(){var e;e=$i(),e[0]=1,e[1]=0,e[2]=1,e[3]=0,e[4]=1,e[5]=0,e[6]=1,e[7]=0,wr(0)}function Qc(){var e;e=sn(),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,Vr(0)}function kr(){return Ti=e.ioLoadFunctionFrom("loadBitBltFrom",Fi),ji=e.ioLoadFunctionFrom("copyBitsFromtoat",Fi),!!Ti&&!!ji}function cu(){return Zs(P()),zt()<0&&Pn(0),Rt()>St()&&qn(St()),Ic(M(zt(),b())),el(M(An(),b())),zc(M(Rt(),b())),Tc(M(jn(),b())),hn(0),Ki(0),B=x(Z,O),g=x(Z,O),Yl(),r?null:0===K()?(Jt(Rr()),0):(Kc(),Jt(Q(B[0])),y()<Qi()&&Jt(Qi()),Kr(0),zi(M(St(),b())-1),void pr())}function rs(e){var t;return ft(e)<=0?null:(t=Sc(e),void Kf(e,t))}function Kf(i,t){var e;if(!au(1))return null;for(e=W()-1;!(t>e);)g[e+1]=g[e],--e;g[t]=i,Ki(W()+1)}function Jf(e){return(J(e)&rr)===da}function $f(e){var t;return t=J(e),t>va?!1:0!==(J(e)&va)}function nh(e){return vr(e)||qu(e)}function vr(e){return 0!==(4278190080&e)}function L(e){return 0===e||vr(e)||Au(e)&&nh(e)}function Iu(e){return(J(e)&rr)===ga}function Au(e){return e>=0&&O>e}function qu(e){return 0!==(J(e)&ba)}function Ut(e){return 0!==(J(e)&vc)}function _u(){return t[Lo]}function Du(e){return t[Lo]=e}function Di(){return t[Ro]}function Ku(e){return t[Ro]=e}function xt(){return t[Eo]}function Ju(e){return t[Eo]=e}function Nt(){return t[Ko]}function Xu(e){return t[Ko]=e}function _s(e){return s(e,Ka)}function hc(e,t){return a(e,Ka,t)}function xr(e){return s(e,za)}function Ac(e,t){return a(e,za,t)}function Cc(e){return s(e,Ua)}function wc(e,t){return a(e,Ua,t)}function jc(e){return s(e,Ja)}function Nc(e,t){return a(e,Ja,t)}function Lc(e){return s(e,Ga)}function ea(e,t){return a(e,Ga,t)}function qr(e){return s(e,eo)}function $c(e,t){return a(e,eo,t)}function Ht(e){return s(e,to)}function mf(e,t){return a(e,to,t)}function kf(e,t){return a(e,uf,t)}function cr(s,a,o,l){var e,u,t,n,i;if(e=Hr(),r)return 0;for(Qn(e,s[0]),Zn(e,s[1]),Ci(e,a[0]),Ai(e,a[1]),qi(e,o[0]),xi(e,o[1]),i=u=zf(e,l),t=e;u>=t;t+=6)if(n=Yr(t),n>i&&(i=n),r)return 0;return Ot(i,6)}function If(u,c,f,h,p){var t,n,s,a,o;if(I(i(),e.fetchPointerofObject(0,u)),e.failed())return null;for(n=i()[0],a=i()[1],t=1;c-1>=t;t++){if(I(i(),e.fetchPointerofObject(t,u)),e.failed())return null;if(s=i()[0],o=i()[1],i()[0]=n,i()[1]=a,l()[0]=s,l()[1]=o,at(2),ct(h,i(),l(),p,f,0),r)return null;n=s,a=o}}function Pf(s,k,p,a,o){var t,n,v,h,c,d,m,u,f;for(t=0;k-1>=t;t++){if(n=e.fetchPointerofObject(3*t,s),I(i(),n),n=e.fetchPointerofObject(3*t+1,s),I(l(),n),n=e.fetchPointerofObject(3*t+2,s),I(S(),n),e.failed())return null;if(at(3),h=i()[0],m=i()[1],c=l()[0],u=l()[1],d=S()[0],f=S()[1],h===m&&c===u||c===d&&u===f)ct(a,i(),S(),o,p,0);else{if(v=cr(i(),l(),S(),0!==a&&0!==o),r)return null;ur(a,o,p,0,v)}if(r)return null}}function Vf(r,n,s){var i,t;for(i=0;s-1>=i;i++){if(t=e.fetchPointerofObject(i,r),"number"!=typeof t&&!t.isFloat)return e.primitiveFail();n[i]="number"==typeof t?t:e.floatValueOf(t)}}function xf(e,t,r,n,i){jt(t)>=wt(t)?(G(e,$t(t)),hi(e,wt(t)-i),ru(e,Vi(t)),Us(e,Pi(t)-i),es(e,Tt(t)),Yo(e,jt(t)-i)):(G(e,Tt(t)),hi(e,jt(t)-i),ru(e,Vi(t)),Us(e,Pi(t)-i),es(e,$t(t)),Yo(e,wt(t)-i)),tr(e,bn()),on(e,r),an(e,n)}function pa(e){return Ti||kr()?Ti(e):!1}function Bf(n,u,g,b,k,v,m){var l,d,t,i,o,f,a,h,s,c;if(u.isNil)s=0,h=null;else{if(st(u)!==e.classBitmap())return e.primitiveFail();s=p(u),h=u.wordsAsInt32Array()}return"number"==typeof n?e.primitiveFail():e.isPointers(n)?p(n)<5?e.primitiveFail():(l=e.fetchPointerofObject(0,n),st(l)!==e.classBitmap()?e.primitiveFail():(d=p(l),a=e.fetchIntegerofObject(1,n),o=e.fetchIntegerofObject(2,n),t=e.fetchIntegerofObject(3,n),e.failed()?null:a>=0&&o>=0?32!==t&&8!==t&&16!==t&&1!==t&&2!==t&&4!==t?e.primitiveFail():0!==s&&s!==M(1,t)?e.primitiveFail():(c=Ot(32,t),f=Ot(a+(c-1),c),d!==f*o?e.primitiveFail():(i=pf(s,h),r?null:(Mh(i,a),Ll(i,o),mh(i,t),af(i,f),Rh(i,d),_h(i,g),nt(i,m),ho(i,b,k,v,a,o),i))):e.primitiveFail())):e.primitiveFail()}function Ca(r){var n,t,s,i;return i=ir(r),i>p(Wi)?null:(s=e.fetchPointerofObject(i,Wi),t=e.fetchPointerofObject(0,s),n=p(t),n!==zh(r)?null:t.wordsAsInt32Array())}function Wf(i){var t,e;return e=$i(),wr(0),(t=Ao(i,e,8))?(wr(1),e[1]=256*e[1],e[3]=256*e[3],e[5]=256*e[5],e[7]=256*e[7],t):!1}function Ma(k,e,v,d,p,h,f){var t,m,a,u,s,n,c,o;return d!==p||0!==h&&0!==f?(t=6*k,v?(a=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+0],n=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+1],u=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+2],c=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+3],s=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+4],o=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[t+5]):(a=0|e[t+0],n=0|e[t+1],u=0|e[t+2],c=0|e[t+3],s=0|e[t+4],o=0|e[t+5]),a===u&&n===c||u===s&&c===o?a===s&&n===o?null:(i()[0]=a,i()[1]=n,l()[0]=s,l()[1]=o,at(2),ct(h,i(),l(),f,d,p)):(i()[0]=a,i()[1]=n,l()[0]=u,l()[1]=c,S()[0]=s,S()[1]=o,at(3),m=cr(i(),l(),S(),0!==h&&0!==f),r?null:void ur(h,f,d,p,m))):null}function Tf(S,v,g,b,k,m,d,y){var l,f,u,t,p,o,n,c,s,e,h,a,i;if(0===v)return 0;for(u=s=a=o=-1,f=c=h=p=1,t=e=i=n=0,l=1;v>=l;l++){if(--f<=0&&(++u,f=Wt(u,g),t=Ii(u,g),0!==t&&(t=d[t-1],t=q(t),r)))return null;if(--c<=0&&(++s,c=Wt(s,b),e=Ii(s,b),0!==e&&(e=d[e-1],e=q(e))),--h<=0&&(++a,h=Wt(a,k),i=Ii(a,k),0!==i&&(i=ci(i))),--p<=0&&(++o,p=Wt(o,m),n=Ii(o,m),0!==n&&(n=d[n-1])),Ma(l-1,S,y,t,e,i,n),r)return null}}function lo(i){var t;return t=_u(),p(i)<fn?null:(G(t,e.fetchIntegerofObject(bs,i)),hi(t,e.fetchIntegerofObject(gs,i)),tr(t,e.fetchIntegerofObject(ys,i)),H(t,e.fetchIntegerofObject(ks,i)),t)}function Gf(r){var i,t;return Vr(0),t=sn(),i=Ao(r,t,6),e.failed()?null:i?(Vr(1),t[2]=t[2]+vn(),t[5]=t[5]+pn(),!0):!1}function ho(r,e,t,i,m,d){var a,o,l,c,f,s,h,p,n,u;t[0]=t[0]+e[0],t[1]=t[1]+e[1],i[0]=i[0]+e[0],i[1]=i[1]+e[1],Pt(e),Pt(t),Pt(i),a=t[0]-e[0],o=t[1]-e[1],n=i[0]-e[0],u=i[1]-e[1],l=a*a+o*o,l>0?(c=a*m*65536/l|0,f=o*m*65536/l|0):(c=0,f=0),s=n*n+u*u,s>0?(h=n*d*65536/s|0,p=u*d*65536/s|0):(h=0,p=0),Wh(r,e[0]),jh(r,e[1]),rf(r,c),tf(r,f),Uu(r,h),xu(r,p)}function po(o){var r,u,l,n,c,s,t,i,a;if(!e.isArray(o))return!1;for(Wi=o,i=0;i<=p(Wi)-1;i++){if(t=e.fetchPointerofObject(i,Wi),"number"==typeof t)return!1;if(!e.isPointers(t))return!1;if(p(t)<5)return!1;if(r=e.fetchPointerofObject(0,t),st(r)!==e.classBitmap())return!1;if(u=p(r),s=e.fetchIntegerofObject(1,t),n=e.fetchIntegerofObject(2,t),l=e.fetchIntegerofObject(3,t),e.failed())return!1;if(!(s>=0&&n>=0))return!1;if(a=Ot(32,l),c=Ot(s+(a-1),a),u!==c*n)return!1}return!0}function eh(i,s,a,o,u){var n,t;return st(i)!==e.classBitmap()?e.primitiveFail():(t=p(i),n=nf(i.wordsAsInt32Array(),t,u),r?null:(ho(n,s,a,o,t,t),n))}function th(e,r,n,a,o,u){var t,i,s;r[1]<=n[1]?(t=r,i=n,s=1):(t=n,i=r,s=-1),G(e,t[0]),hi(e,t[1]-a),tr(e,bn()),on(e,o),an(e,u),hc(e,i[0]),Ac(e,i[1]-a),kf(e,s)}function ih(t,n,f,h){var s,a,o,e,u,c;for(c=l()[0]-i()[0]>>1,o=l()[1]-i()[1]>>1,s=l()[0]+i()[0]>>1,a=l()[1]+i()[1]>>1,e=0;15>=e;e++){if(rh(e,c,o,s,a),at(3),u=cr(i(),l(),S(),0!==t&&0!==n),r)return null;if(ur(t,n,f,h,u),r)return null}}function rh(e,a,f,n,s){var h,t,u,c,r,o;h=En()[2*e+0]*a+n|0,c=Rn()[2*e+0]*f+s|0,i()[0]=h,i()[1]=c,u=En()[2*e+2]*a+n|0,o=Rn()[2*e+2]*f+s|0,S()[0]=u,S()[1]=o,t=En()[2*e+1]*a+n|0,r=Rn()[2*e+1]*f+s|0,t=2*t-(h+u>>1),r=2*r-(c+o>>1),l()[0]=t,l()[1]=r}function I(r,i){var t;return st(i)!==e.classPoint()?e.primitiveFail():(t=e.fetchPointerofObject(0,i),"number"==typeof t||t.isFloat?(r[0]="number"==typeof t?t:0|e.floatValueOf(t),t=e.fetchPointerofObject(1,i),"number"==typeof t||t.isFloat?void(r[1]="number"==typeof t?t:0|e.floatValueOf(t)):e.primitiveFail()):e.primitiveFail())}function sh(e,c,p,h,f,u){var t,a,s,n,o;
for(u?(a=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[0],n=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[1]):(a=0|e[0],n=0|e[1]),t=1;c-1>=t;t++){if(u?(s=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*t],o=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*t+1]):(s=0|e[2*t],o=0|e[2*t+1]),i()[0]=a,i()[1]=n,l()[0]=s,l()[1]=o,at(2),ct(h,i(),l(),f,p,0),r)return null;a=s,n=o}}function dh(e,t,r,n){ct(e,i(),l(),t,r,n),ct(e,l(),S(),t,r,n),ct(e,S(),wi(),t,r,n),ct(e,wi(),i(),t,r,n)}function Fo(){var r,t,n,i;return 2!==e.methodArgumentCount()?c:0!==(t=R(e.stackValue(2)))?t:(n=e.stackObjectValue(0),r=e.stackObjectValue(1),e.failed()?f:0!==(t=Bi(e.fetchPointerofObject(ni,o)))?t:pa(e.fetchPointerofObject(ps,o))?po(e.fetchPointerofObject(ds,o))?p(r)<fn?gn:p(n)<Or?sa:(i=_t(),i===ii||i===ri||i===ti?Sn:0):aa:Qs)}function gh(t,i,n,s,a,o){var e;for(e=1;i>=e;e++)if(Ma(e-1,t,o,n,0,s,a),r)return null}function Bi(t){return st(t)!==e.classBitmap()?$s:(u=t.words,Zc(p(t)-1),0)}function Ao(t,r,i){return t.isNil?!1:"number"==typeof t?e.primitiveFail():p(t)!==i?e.primitiveFail():(e.isWords(t)?qh(t,r,i):Vf(t,r,i),!0)}function ur(t,a,o,u,l){var e,i,s,n;for(0===t||0===a?(n=!1,s=0):(n=!0,s=Ct(t)),i=6*l;i>0;){if(e=n?$u():ah(),r)return 0;xf(e,i,o,u,s),n&&(gu(e,a),ln(e,t),ku(e,t)),i-=6}vt()}function ct(t,s,a,n,o,u){var e,i;return 0===t||0===n?(e=ef(),i=0):(e=Qu(),i=Ct(t)),r?0:(th(e,s,a,i,o,u),void(Ut(e)&&(ju(e,n),nr(e,t),wu(e,t))))}function qh(i,r,n){var e,t;for(t=i.wordsAsFloat32Array(),e=0;n-1>=e;e++)r[e]=t[e]}function sr(i){return"number"==typeof i?Gl:e.isWords(i)?p(i)<Uo?Hl:(fs(i),Lh()!==Go?zl:Qt()!==p(i)?Xl:nu()!==fi?Jl:(Z=x(t,nu()),B=x(Z,Br()),g=x(B,K()),fi+Br()+K()+W()>Qt()?kt:0)):Ul}function Lh(){return t[zo]}function vu(e){return t[zo]=e}function Fu(e){0===strcmp(e,Fi)&&(Ti=0,ji=0)}function Ou(t,i,r){var e;for(e=t;e>0&&A(g[e-1])>r;)g[e]=g[e-1],--e;g[e]=i}function X(e){return fi+O+K()+W()+e>$()?(It(Wc),!1):!0}function Co(){return 0!==Pu()}function Pu(){return t[Jo]}function Vt(e){return t[Jo]=e}function s(e,t){return Z[e+t]}function a(e,t,i){return Z[e+t]=i}function nu(){return t[Ho]}function Wu(e){return t[Ho]=e}function Br(){return t[Xo]}function uu(e){return t[Xo]=e}function Ru(e){return s(e,Fn)}function ir(e){return s(e,fa)}function nt(e,t){return a(e,fa,t)}function Gu(e){return s(e,ha)}function pt(e,t){return a(e,ha,t)}function J(e){return s(e,Fn)&mc}function U(e,t){return a(e,Fn,t)}function Ct(e){return e>>1}function i(){return x(t,oh)}function l(){return x(t,uh)}function S(){return x(t,lh)}function wi(){return x(t,ch)}function Dr(){Y()>=K()&&0===W()&&v(Yt),y()>=Rr()&&v(Yt)}function il(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(v(Yt),void k(o))}function rl(){var t,i,n;return d&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=F(e.stackValue(1),ii))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(t=lo(i))?X(1)?(ft(t)>0&&rs(t),r?e.primitiveFailFor(N):(v(lt),k(o),e.pop(1),void(d&&(h(Nn,1),h(zn,e.ioMicroMSecs()-m))))):e.primitiveFailFor(kt):e.primitiveFailFor(gn))}function sl(){var a,u,t,s,n,h,p;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(n=e.positive32BitValueOf(e.stackValue(0)),t=e.positive32BitValueOf(e.stackValue(1)),p=e.stackObjectValue(2),a=e.stackObjectValue(3),h=e.stackObjectValue(4),e.failed()?e.primitiveFailFor(f):0!==(u=F(e.stackValue(5),w))?e.primitiveFailFor(u):L(t)&&L(n)?(I(i(),h),I(l(),p),I(S(),a),e.failed()?e.primitiveFailFor(f):(at(3),s=cr(i(),l(),S(),!1),X(s*Gt),r||(t=q(t),n=q(n)),r||ur(0,0,t,n,s),r?(vt(),e.primitiveFailFor(N)):e.failed()?e.primitiveFailFor(ut):(k(o),void e.pop(5)))):e.primitiveFailFor(it))}function al(){var h,s,u,i,t,n,a,l,d;if(5!==e.methodArgumentCount())return e.primitiveFailFor(c);if(i=e.positive32BitValueOf(e.stackValue(0)),t=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),n=e.stackIntegerValue(3),a=e.stackObjectValue(4),e.failed())return e.primitiveFailFor(f);if(0!==(h=F(e.stackValue(5),w)))return e.primitiveFailFor(h);if(u=p(a),e.isWords(a)){if(l=!1,u!==3*n&&u!==6*n)return e.primitiveFailFor(f)}else{if(!e.isArray(a))return e.primitiveFailFor(f);if(u!==3*n)return e.primitiveFailFor(f);l=!0}return d=0===t||0===i?At:si,X(d*n)?L(i)&&L(s)?(i=q(i),s=q(s),r?e.primitiveFailFor(N):0!==i&&0!==t||0!==s?(0!==t&&(t=ci(t),1>t&&(t=1)),l?Pf(a,n,s,t,i):gh(a.wordsAsInt32Array(),n,s,t,i,3*n===u),r?e.primitiveFailFor(N):e.failed()?e.primitiveFailFor(ut):(Vt(1),k(o),void e.pop(5))):e.pop(5)):e.primitiveFailFor(it):e.primitiveFailFor(kt)}function ol(){var n,s,a,u,h,p,d,m,t;return 7!==e.methodArgumentCount()?e.primitiveFailFor(c):(t=e.stackIntegerValue(0),0>=t?e.primitiveFailFor(f):(p=e.stackObjectValue(1),s=e.stackObjectValue(2),d=e.stackObjectValue(3),m=e.booleanValueOf(e.stackValue(4)),n=e.stackObjectValue(5),h=e.stackObjectValue(6),e.failed()?e.primitiveFailFor(f):0!==(a=F(e.stackValue(7),w))?e.primitiveFailFor(a):(I(i(),d),I(l(),s),I(S(),p),e.failed()?e.primitiveFailFor(Si):(u=Bf(h,n,m?1:0,i(),l(),S(),t-1),r?e.primitiveFailFor(N):e.failed()?e.primitiveFailFor(ut):(k(o),void e.popthenPush(8,e.positive32BitIntegerFor(u)))))))}function ul(){var h,n,s,a,u,t,i,d,l;return 7!==e.methodArgumentCount()?e.primitiveFailFor(c):(n=e.stackObjectValue(0),a=e.stackObjectValue(1),u=e.stackObjectValue(2),l=e.stackObjectValue(3),s=e.stackObjectValue(4),t=e.stackIntegerValue(5),i=e.stackObjectValue(6),e.failed()?e.primitiveFailFor(f):0!==(h=F(e.stackValue(7),w))?e.primitiveFailFor(h):Ih(i,t,s,l,u,a,n)?X(Math.max(Gt,At)*t)?(d=p(i)===3*t,Tf(i.wordsAsInt32Array(),t,s.wordsAsInt32Array(),l.wordsAsInt32Array(),u.wordsAsInt32Array(),a.wordsAsInt32Array(),n.wordsAsInt32Array(),d),r?e.primitiveFailFor(N):e.failed()?e.primitiveFailFor(ut):(Vt(1),k(o),void e.pop(7))):e.primitiveFailFor(kt):e.primitiveFailFor(Tl))}function cl(){var t,n,s,a,u,h,p;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(a=e.booleanValueOf(e.stackValue(0)),u=e.stackValue(1),t=e.stackValue(2),h=e.stackValue(3),p=e.stackValue(4),e.failed()?e.primitiveFailFor(f):0!==(n=F(e.stackValue(5),w))?e.primitiveFailFor(n):(I(i(),h),I(l(),t),I(S(),u),e.failed()?e.primitiveFailFor(Si):(s=eh(p,i(),l(),S(),a),r?e.primitiveFailFor(N):e.failed()?e.primitiveFailFor(ut):(k(o),void e.popthenPush(6,e.positive32BitIntegerFor(s))))))}function fl(){var s,a,t,n,u;return 4!==e.methodArgumentCount()?e.primitiveFailFor(c):(n=e.positive32BitValueOf(e.stackValue(0)),t=e.positive32BitValueOf(e.stackValue(1)),s=e.stackObjectValue(2),u=e.stackObjectValue(3),e.failed()?e.primitiveFailFor(f):0!==(a=F(e.stackValue(4),w))?e.primitiveFailFor(a):L(t)&&L(n)?(I(i(),u),I(l(),s),e.failed()?e.primitiveFailFor(Si):(at(2),t=q(t),n=q(n),r?e.primitiveFailFor(N):(ct(0,i(),l(),0,t,n),r?e.primitiveFailFor(N):e.failed()?e.primitiveFailFor(ut):(k(o),void e.pop(4))))):e.primitiveFailFor(it))}function hl(){var t,n,a,u,s,h;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(t=e.positive32BitValueOf(e.stackValue(0)),n=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),a=e.stackObjectValue(3),h=e.stackObjectValue(4),e.failed()?e.primitiveFailFor(f):0!==(u=F(e.stackValue(5),w))?e.primitiveFailFor(u):L(t)&&L(s)?(s=q(s),t=q(t),r?e.primitiveFailFor(N):0===s&&(0===t||0>=n)?e.pop(5):X(16*Gt)?(n=n>0&&0!==t?ci(n):0,I(i(),h),I(l(),a),e.failed()?e.primitiveFailFor(Si):(ih(n,t,0,s),r?(vt(),e.primitiveFailFor(N)):e.failed()?e.primitiveFailFor(ut):(Vt(1),k(o),void e.pop(5)))):e.primitiveFailFor(kt)):e.primitiveFailFor(it))}function dl(){var h,s,u,t,i,n,a,l,d;if(5!==e.methodArgumentCount())return e.primitiveFailFor(c);if(t=e.positive32BitValueOf(e.stackValue(0)),i=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),n=e.stackIntegerValue(3),a=e.stackObjectValue(4),e.failed())return e.primitiveFailFor(f);if(0!==(h=F(e.stackValue(5),w)))return e.primitiveFailFor(h);if(u=p(a),e.isWords(a)){if(l=!1,u!==n&&2*n!==u)return e.primitiveFailFor(f)}else{if(!e.isArray(a))return e.primitiveFailFor(f);if(u!==n)return e.primitiveFailFor(f);l=!0}return d=0===i||0===t?At:si,X(d*n)?L(t)&&L(s)?(t=q(t),s=q(s),r?e.primitiveFailFor(N):0!==t&&0!==i||0!==s?(0!==i&&(i=ci(i)),l?If(a,n,s,i,t):sh(a.wordsAsInt32Array(),n,s,i,t,n===u),r?e.primitiveFailFor(N):e.failed()?e.primitiveFailFor(ut):(Vt(1),k(o),void e.pop(5))):e.pop(5)):e.primitiveFailFor(it):e.primitiveFail()}function kl(){var t,n,a,u,s,h;return 5!==e.methodArgumentCount()?e.primitiveFailFor(c):(t=e.positive32BitValueOf(e.stackValue(0)),n=e.stackIntegerValue(1),s=e.positive32BitValueOf(e.stackValue(2)),a=e.stackObjectValue(3),h=e.stackObjectValue(4),e.failed()?e.primitiveFailFor(f):0!==(u=F(e.stackValue(5),w))?e.primitiveFailFor(u):L(t)&&L(s)?(t=q(t),s=q(s),r?e.primitiveFailFor(N):0!==s||0!==t&&0!==n?X(4*At)?(n=n>0&&0!==t?ci(n):0,I(i(),h),I(S(),a),e.failed()?e.primitiveFailFor(Si):(l()[0]=S()[0],l()[1]=i()[1],wi()[0]=i()[0],wi()[1]=S()[1],at(4),dh(n,t,0,s),e.failed()?e.primitiveFailFor(ut):(Vt(1),k(o),void e.pop(5)))):e.primitiveFailFor(kt):e.pop(5)):e.primitiveFailFor(it))}function bl(){var t,i,r;return d&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(r=F(e.stackValue(1),ti))?e.primitiveFailFor(r):(i=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(t=lo(i))?(0===ft(t)?Ds():(Ys(),ot(C()+1)),v(Mt),k(o),e.pop(1),void(d&&(h(_n,1),h(Gn,e.ioMicroMSecs()-m)))):e.primitiveFailFor(gn))}function gl(){var o,n,s,r,u,i,a,l;if(2!==e.methodArgumentCount())return e.primitiveFailFor(c);if(n=e.stackValue(0),o=e.stackValue(1),0!==(u=sr(o)))return e.primitiveFailFor(u);if(st(o)!==st(n))return e.primitiveFailFor($s);if(s=p(n)-p(o),0>s)return e.primitiveFailFor(Kl);for(a=t,r=n.wordsAsInt32Array(),i=0,l=$()-1;l>=i;i++)r[i]=a[i];for(r[Bn]=$()+s,r[Kn]=Qt()+s,a=x(a,$()),r=x(r,$()+s),i=0,l=Qt()-$()-1;l>=i;i++)r[i]=a[i];return 0!==(u=sr(n))?e.primitiveFailFor(u):void e.pop(2)}function yl(){var t;return d&&(m=e.ioMicroMSecs()),0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=F(e.stackValue(0),Zt))?e.primitiveFailFor(t):0!==(t=Bi(e.fetchPointerofObject(ni,o)))?e.primitiveFailFor(t):pa(e.fetchPointerofObject(ps,o))?((y()&mt())===mt()&&(cn(y()),Dr()),Ri()||(ot(0),Jt(y()+1),v(Mt)),k(o),void(d&&(h(ai,1),h(mi,e.ioMicroMSecs()-m)))):e.primitiveFailFor(Qs)}function Sl(){var t,i;i=d,t=e.stackObjectValue(0),t=e.booleanValueOf(t),e.failed()||(d=t,e.pop(2),e.pushBool(i))}function Fl(){var t,i;return d&&(m=e.ioMicroMSecs()),0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(i=Ri(),k(o),e.pop(1),e.pushBool(i),void(d&&(h(Dn,1),h(Un,e.ioMicroMSecs()-m))))}function Ol(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(e.pop(1),void e.pushInteger(P()))}function Il(){var n,r,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=R(e.stackValue(1)))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),!e.failed()&&e.isWords(r)&&p(r)>=4?(i=r.wordsAsInt32Array(),i[0]=i[0]+t[Fr],i[1]=i[1]+t[xn],i[2]=i[2]+t[Mn],i[3]=i[3]+t[co],void e.pop(1)):e.primitiveFailFor(f))}function Pl(){var r,i,t;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(r=R(e.stackValue(1)))?e.primitiveFailFor(r):(t=e.stackObjectValue(0),!e.failed()&&e.isPointers(t)&&p(t)>=2?(e.pushRemappableOop(t),i=e.makePointwithxValueyValue(zt(),An()),e.storePointerofObjectwithValue(0,e.topRemappableOop(),i),i=e.makePointwithxValueyValue(Rt(),jn()),t=e.popRemappableOop(),e.storePointerofObjectwithValue(1,t,i),void e.popthenPush(2,t)):e.primitiveFailFor(f))}function Cl(){var n,r,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=R(e.stackValue(1)))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),!e.failed()&&e.isWords(r)&&p(r)>=9?(i=r.wordsAsInt32Array(),i[0]=i[0]+t[Tn],i[1]=i[1]+t[Dn],i[2]=i[2]+t[li],i[3]=i[3]+t[Nn],i[4]=i[4]+t[ui],i[5]=i[5]+t[Ln],i[6]=i[6]+t[ai],i[7]=i[7]+t[oi],i[8]=i[8]+t[_n],void e.pop(1)):e.primitiveFailFor(f))}function wl(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(e.pop(1),void e.pushInteger(bn()))}function Vl(){var t;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):(o=e.stackValue(0),"number"==typeof o?e.primitiveFailFor(ta):e.isPointers(o)?p(o)<hs?e.primitiveFailFor(na):0!==(t=sr(e.fetchPointerofObject(ms,o)))?e.primitiveFailFor(t):(e.pop(1),void e.pushInteger(Ur())):e.primitiveFailFor(ia))}function xl(){var t,i;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(i=e.makePointwithxValueyValue(vn(),pn()),void e.popthenPush(1,i))}function ql(){var n,r,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=R(e.stackValue(1)))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),!e.failed()&&e.isWords(r)&&p(r)>=9?(i=r.wordsAsInt32Array(),i[0]=i[0]+t[Jn],i[1]=i[1]+t[Un],i[2]=i[2]+t[Ei],i[3]=i[3]+t[zn],i[4]=i[4]+t[bi],i[5]=i[5]+t[Hn],i[6]=i[6]+t[mi],i[7]=i[7]+t[vi],i[8]=i[8]+t[Gn],void e.pop(1)):e.primitiveFailFor(f))}function Ml(){var r,i;return 1!==e.methodArgumentCount()?e.primitiveFail():(i=e.stackObjectValue(0),e.failed()?null:e.isWords(i)?(r=p(i))<Uo?e.primitiveFail():(fs(i),Z=x(t,fi),vu(Go),bh(r),hr(r),v(w),Wu(fi),uu(4),U(0,ka),pt(0,4),nt(0,0),yr(0),hn(0),ot(0),Ki(0),di(0),Vt(0),Pn(0),qn(0),Aa(0),Ea(0),Hs(0),Vc(),Qc(),Rc(),e.pop(2),void e.push(i)):e.primitiveFail())}function Bl(){var t;return d&&(m=e.ioMicroMSecs()),0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=F(e.stackValue(0),w))?e.primitiveFailFor(t):0!==(t=Bi(e.fetchPointerofObject(ni,o)))?e.primitiveFailFor(t):(cu(),r?e.primitiveFailFor(N):(v(lt),e.failed()||k(o),void(d&&(h(Tn,1),h(Jn,e.ioMicroMSecs()-m)))))}function Nl(){var r,n,i,t;return d&&(m=e.ioMicroMSecs()),2!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=F(e.stackValue(2),ri))?e.primitiveFailFor(n):0!==(n=Bi(e.fetchPointerofObject(ni,o)))?e.primitiveFailFor(n):(i=e.stackObjectValue(0),r=e.stackObjectValue(1),e.failed()||st(r)!==e.classBitmap()?e.primitiveFailFor(f):p(i)<Or?e.primitiveFailFor(sa):(t=e.fetchIntegerofObject(Fs,i),ir(Di())!==t?e.primitiveFailFor(it):(t=e.fetchIntegerofObject(Is,i),xt()!==t?e.primitiveFailFor(it):(t=e.fetchIntegerofObject(Os,i),Nt()!==t?e.primitiveFailFor(it):p(r)<Nt()-xt()?e.primitiveFailFor(f):e.failed()?null:(hf(r.wordsAsInt32Array(),xt(),Nt()),v(Bt),k(o),e.pop(2),void(d&&(h(Ln,1),h(Hn,e.ioMicroMSecs()-m))))))))}function _l(){var t,i;return 0!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(0)))?e.primitiveFailFor(t):(i=Co(),k(o),e.pop(1),void e.pushBool(i))}function Wl(){var t,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=R(e.stackValue(1)))?e.primitiveFailFor(t):(i=e.booleanValueOf(e.stackValue(0)),e.failed()?e.primitiveFailFor(f):(Vt(i===!0?1:0),k(o),void e.pop(1)))}function Dl(){var i,r,n,t;return d&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=Oc(e.stackValue(1),Mt,Yt))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(t=!1,_t()!==Yt&&(t=Ar(),t?(i=g[C()],er(i,r),v(ti)):v(lt)),e.failed()?null:(k(o),e.pop(2),e.pushBool(!t),void(d&&(h(oi,1),h(vi,e.ioMicroMSecs()-m))))))}function Rl(){var t,n,i;return d&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=F(e.stackValue(1),Bt))?e.primitiveFailFor(t):0!==(t=Bi(e.fetchPointerofObject(ni,o)))?e.primitiveFailFor(t):po(e.fetchPointerofObject(ds,o))?(0!==Wn()&&(0===(y()&mt())&&pr(),Lt(0)),n=e.stackObjectValue(0),i=Cr(),r?e.primitiveFailFor(N):(i&&yo(n),e.failed()?e.primitiveFailFor(it):(i?v(ri):(vt(),Oi(0),v(Zt)),k(o),e.pop(2),e.pushBool(!i),void(d&&(h(ui,1),h(bi,e.ioMicroMSecs()-m)))))):e.primitiveFailFor(aa)}function El(){var i,r,n,t;return d&&(m=e.ioMicroMSecs()),1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(n=F(e.stackValue(1),lt))?e.primitiveFailFor(n):(r=e.stackObjectValue(0),t=jr(),t&&(i=B[Y()],er(i,r),yr(Y()+1)),e.failed()?e.primitiveFailFor(Zl):(t?v(ii):(v(Bt),Lt(1),ot(0),vt()),k(o),e.pop(2),e.pushBool(!t),void(d&&(h(li,1),h(Ei,e.ioMicroMSecs()-m)))))}function $l(){var t,s,a,u,l,h,i,n;return 6!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(s=F(e.stackValue(6),w))?e.primitiveFailFor(s):(n=e.positive32BitValueOf(e.stackValue(0)),i=e.positive32BitValueOf(e.stackValue(1)),h=e.stackIntegerValue(2),l=e.stackIntegerValue(3),u=e.stackIntegerValue(4),a=e.stackIntegerValue(5),e.failed()?e.primitiveFailFor(f):gt(Hi)?L(i)&&L(n)?(t=O,O=t+Hi,U(t,On),pt(t,Hi),nt(t,a),G(t,u),hi(t,l),tr(t,h),on(t,q(i)),an(t,q(n)),r?e.primitiveFailFor(N):void(e.failed()||(k(o),e.pop(6)))):e.primitiveFailFor(it):e.primitiveFailFor(kt))}function ec(){var i,t,r;if(1!==e.methodArgumentCount())return e.primitiveFailFor(c);if(0!==(i=F(e.stackValue(1),w)))return e.primitiveFailFor(i);if(r=e.stackIntegerValue(0),e.failed())return e.primitiveFailFor(f);for(t=0;0===t;){if(!gt(Hi))return e.primitiveFailFor(kt);t=O,O=t+Xs,U(t,ka),pt(t,Xs),nt(t,r)}e.failed()||(k(o),e.pop(2),e.pushInteger(t))}function tc(){var t;return 0!==(t=Fo())?e.primitiveFailFor(t):(Ss(),r?Xr():(fc(),void Xr()))}function ic(){var t;return 0!==(t=Fo())?e.primitiveFailFor(t):(Ss(),void Xr())}function rc(){var t,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=F(e.stackValue(1),w))?e.primitiveFailFor(t):(i=e.stackIntegerValue(0),e.failed()?e.primitiveFailFor(f):(Zs(i),k(o),void e.pop(1)))}function nc(){var r,i,t,s;if(t=e.stackValue(0),!e.isBytes(t))return e.primitiveFail();if(r=Gh(t),r>=256)return e.primitiveFail();s=t.bytes,i=!1;var n=t.bytesAsString();return n!==Fi&&(Fi=n,i=!0),i&&!kr()?e.primitiveFail():void e.pop(1)}function sc(){var r,t;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(r=F(e.stackValue(1),w))?e.primitiveFailFor(r):(t=e.stackObjectValue(0),!e.failed()&&e.isPointers(t)&&p(t)>=2?(I(i(),e.fetchPointerofObject(0,t)),I(l(),e.fetchPointerofObject(1,t)),e.failed()?e.primitiveFailFor(f):(Pn(i()[0]),Aa(i()[1]),qn(l()[0]),Ea(l()[1]),k(o),void e.pop(1))):e.primitiveFailFor(f))}function ac(){var t,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=F(e.stackValue(1),w))?e.primitiveFailFor(t):(i=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(Wf(i),e.failed()?e.primitiveFailFor(ut):(k(o),void e.pop(1))))}function uc(){var t,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(i=F(e.stackValue(1),w))?e.primitiveFailFor(i):(t=e.stackIntegerValue(0),e.failed()?e.primitiveFailFor(f):(Hs(t),k(o),void e.pop(1)))}function lc(){var t,i;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(t=F(e.stackValue(1),w))?e.primitiveFailFor(t):(i=e.stackObjectValue(0),e.failed()?e.primitiveFailFor(f):(Gf(i),e.failed()?e.primitiveFailFor(f):(k(o),void e.pop(1))))}function cc(){var r,t;return 1!==e.methodArgumentCount()?e.primitiveFailFor(c):0!==(r=F(e.stackValue(1),w))?e.primitiveFailFor(r):(t=e.stackValue(0),st(t)!==e.classPoint()?e.primitiveFailFor(f):(I(i(),t),e.failed()?e.primitiveFailFor(f):(pl(i()[0]),Tu(i()[1]),k(o),void e.pop(1))))}function fc(){for(var t;!Ri();){if(d&&(m=e.ioMicroMSecs()),t=jr(),d&&(h(li,1),h(Ei,e.ioMicroMSecs()-m)),r)return v(lt);if(t)return v(ii),It(Vn);if(ot(0),vt(),Lt(1),d&&(m=e.ioMicroMSecs()),0!==Wn()&&0===(y()&mt())&&pr(),Lt(0),t=Cr(),d&&(h(ui,1),h(bi,e.ioMicroMSecs()-m)),r)return v(Bt);if(t)return v(ri),It(wn);if(vt(),Oi(0),d&&(m=e.ioMicroMSecs()),(y()&mt())===mt()&&(cn(y()),Dr()),d&&(h(ai,1),h(mi,e.ioMicroMSecs()-m)),r)return v(Zt);if(Ri())return 0;if(ot(0),Jt(y()+1),d&&(m=e.ioMicroMSecs()),t=Ar(),d&&(h(oi,1),h(vi,e.ioMicroMSecs()-m)),r)return v(Mt);if(t)return v(ti),It(Cn)}}function Ss(){var i,t;if(t=_t(),t===w){if(cu(),r)return 0;t=lt}if(t===lt){if(d&&(m=e.ioMicroMSecs()),i=jr(),d&&(h(li,1),h(Ei,e.ioMicroMSecs()-m)),r)return v(lt);if(i)return v(ii),It(Vn);ot(0),vt(),Lt(1),t=Bt}if(t===Bt){if(d&&(m=e.ioMicroMSecs()),0!==Wn()&&0===(y()&mt())&&pr(),Lt(0),i=Cr(),d&&(h(ui,1),h(bi,e.ioMicroMSecs()-m)),r)return v(Bt);if(i)return v(ri),It(wn);t=Zt,vt(),Oi(0)}if(t===Zt){if(d&&(m=e.ioMicroMSecs()),(y()&mt())===mt()&&(cn(y()),Dr()),d&&(h(ai,1),h(mi,e.ioMicroMSecs()-m)),r)return v(Zt);if(Ri())return 0;t=Mt,ot(0),Jt(y()+1)}if(t===Mt){if(d&&(m=e.ioMicroMSecs()),i=Ar(),d&&(h(oi,1),h(vi,e.ioMicroMSecs()-m)),r)return v(Mt);if(i)return v(ti),It(Cn);v(lt)}}function R(t){var i;return e.failed()?jl:"number"==typeof t?ta:e.isPointers(t)?p(t)<hs?na:(o=t,0!==(i=sr(e.fetchPointerofObject(ms,t)))?i:(di(0),O=Br(),r=!1,0)):ia}function F(t,i){var e;return 0!==(e=R(t))?e:_t()===i?0:(di(qa),Sn)}function Oc(t,i,r){var e;return 0!==(e=R(t))?e:_t()===i?0:_t()===r?0:(di(qa),Sn)}function Xi(e){if(0===V())return null;for(;nn()<=e;)if(oa(Zi(),Zf()),0===V())return null}function Tr(e,n,r){var f,t,c,o,l,u,s,a,h,i,p;if((h=r+1-n)<=1)return 0;if(c=e[n],l=e[r],t=ei(c,l),t||(i=e[n],e[n]=e[r],e[r]=i,p=c,c=l,l=p),2>=h)return 0;if(u=n+r>>1,o=e[u],t=ei(c,o),t?(t=ei(o,l),t||(i=e[r],e[r]=e[u],e[u]=i,o=l)):(i=e[n],e[n]=e[u],e[u]=i,o=c),3>=h)return 0;for(s=n,a=r,f=!0;f;){for(t=!0;t;)s<=--a?(i=e[a],t=ei(o,i)):t=!1;for(t=!0;t;)++s<=a?(i=e[s],t=ei(i,o)):t=!1;f=a>=s,f&&(i=e[s],e[s]=e[a],e[a]=i)}Tr(e,n,a),Tr(e,s,r)}function Pc(){var e=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1];return e}function Ds(){var e;for(e=C(),Ki(W()-1);e<W();)g[e]=g[e+1],++e}function yt(i,t){var e;for(e=i;0>e;)e+=t;for(;e>=t;)e-=t;return e}function Vc(){t[Jn]=0,t[Un]=0,t[Ei]=0,t[zn]=0,t[bi]=0,t[Hn]=0,t[mi]=0,t[vi]=0,t[Gn]=0,t[Tn]=0,t[Dn]=0,t[li]=0,t[Nn]=0,t[ui]=0,t[Ln]=0,t[ai]=0,t[oi]=0,t[_n]=0,t[Fr]=0,t[xn]=0,t[Mn]=0,t[co]=0}function Ys(){var e,i,t;return 0===C()?null:(e=g[C()],t=A(e),i=g[C()-1],A(i)<=t?null:void Ou(C(),e,t))}function xc(){return Dt=bu(Mi)}function qc(){return Dt=Su(Mi)}function Mc(){return Dt=Vu(Mi)}function Bc(){return Dt=ls(Mi)}function Zs(t){var e;t>=4&&(e=4),t>=2&&4>t&&(e=2),2>t&&(e=1),Vh(e),1===e&&(In(0),$n(4294967295),Xn(0)),2===e&&(In(1),$n(4244438268),Xn(1)),4===e&&(In(2),$n(4042322160),Xn(3)),Dh(2*b()),Nh(b())}function Dc(i){var t;return e=i,t=e.majorVersion()==Bu,t===!1?!1:t=e.minorVersion()>=Nu}function Wt(e,t){return(0|t[e])>>>16}function Ii(e,t){return 65535&(0|t[e])}function ra(e,t,i){return As()?(ki(0,e),yi(0,t),Xt(0,i),V()===_()?null:void(vs(0,V()-_())&&(ki(0,tn()),yi(0,Zr()),Xt(0,$r()),rn(e),Qr(t),en(i)))):null}function Ec(){var e=[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6];return e}function Kc(){Tr(B,0,K()-1)}function Ji(){return t[Qo]}function Oi(e){return t[Qo]=e}function Gi(){return t[Zo]}function zi(e){return t[Zo]=e}function St(){return t[$o]}function Zc(e){return t[$o]=e}function Er(){return t[eu]}function Kr(e){return t[eu]=e}function j(e,t){return e*e+t*t}function Et(e){return dt(e+1)}function yi(e,t){return ht(e+1,t)}function _(){return 3}function dr(e){return dt(e+2)}function Xt(e,t){return ht(e+2,t)}function V(){return E()}function Kt(e){return dt(e)}function ki(e,t){return ht(e,t)}function _t(){return t[tu]}function v(e){return t[tu]=e}function df(){return Oa(B[Y()],y())}function Oa(e,n){var r,g,f,h,p,d,u,b,y,k,v,a,o,m,s,i,t,c,l;return!Ut(e)&&n>=Mr(e)?H(e,0):(s=A(e),i=Q(e),c=Oh(e),l=Lu(e),g=_r(e),f=Mr(e),r=f-i,b=2*(c-s),y=s+g-2*c,k=2*(l-i),v=i+f-2*l,a=2*r,2>a&&(a=2),o=Ot(16777216,a),m=Ql(o),d=b*o,h=y*m*2,d+=h>>1,u=k*o,p=v*m*2,u+=p>>1,H(e,r),t=z(e),t[T]=256*s,t[qt]=256*i,t[Yi]=d,t[mn]=u,t[dn]=h,t[Ws]=p,void((i=Q(e))!==n&&(xa(e,n),H(e,r-(n-i)))))}function vf(){return Pa(B[Y()],y())}function Pa(e,s){var r,t,n,l,a,c,i,o,u;if(!Ut(e)&&s>=xr(e))return H(e,0);if(r=_s(e)-A(e),t=xr(e)-Q(e),r>=0?(o=1,i=r,n=0):(o=-1,i=0-r,n=1-t),0===t?(n=0,u=r,l=0):t>i?(u=0,l=i):(u=Ot(i,t)*o,l=Kh(i,t)),H(e,t),$c(e,o),mf(e,u),ea(e,n),Nc(e,l),wc(e,t),(c=Q(e))!==s){for(a=c;s-1>=a;a++)Gr(e,a);H(e,t-(s-c))}}function bf(){return gf(B[Y()],y())}function gf(e,u){var o,t,r,i,a,n,s,l,c;for(i=un(e),r=Ct(i),o=_r(e),n=Q(e),Oa(e,n),a=ft(e),t=0;5>=t;t++)et(e)[t]=z(e)[t];if(s=z(e)[Yi],0===s&&z(e)[dn],s=s>=0?1:-1,0>s?vl(e,i,r,o):yu(e,i,r,o),0===a&&(z(e)[T]=256*Po(e)),H(e,a+i),l=0,c=0-a-r,ts(e,l),is(e,c),l>=r&&0>c?lr(e):or(e),ya(e,i),n!==u){for(t=n;u-1>=t;t++)Ba(e,t);H(e,ft(e)-(u-n))}}function yf(){return Sf(B[Y()],y())}function Sf(e,s){var r,n,t,u,c,i,l,a,o;if(t=fr(e),n=Ct(t),c=A(e),i=Q(e),Pa(e,i),u=ft(e),l=qr(e),G(e,c-n),H(e,u+t),l>0?nr(e,Ht(e)+t):(nr(e,t-Ht(e)),G(e,A(e)+Ht(e))),a=0,o=0-u-n,as(e,a),us(e,o),a>=n&&0>o?lr(e):or(e),i!==s){for(r=i;s-1>=r;r++)Qa(e,r);H(e,ft(e)-(s-i))}}function Ff(){return xa(g[C()],y())}function zr(e,a){var i,t,r,n,s;for(r=e[T],n=e[qt],i=e[Yi],t=e[mn],s=256*a;s>n&&t>=0;)r+=i+32768>>16,n+=t+32768>>16,i+=e[dn],t+=e[Ws];return e[T]=r,e[qt]=n,e[Yi]=i,e[mn]=t,r>>8}function xa(e,i){var t;t=zr(z(e),i),G(e,t)}function Af(){return Gr(g[C()],y())}function Gr(e){var t,i;i=A(e)+Ht(e),t=Lc(e)+jc(e),t>0&&(i+=qr(e),t-=Cc(e)),ea(e,t),G(e,i)}function wf(){Ba(g[C()],y())}function Ba(e,s){var i,r,n,t;r=un(e),i=Ct(r),n=Bh(e)+1,t=Th(e)+1,ts(e,n),is(e,t),n>=i&&lr(e),t>=0&&or(e),0>t+i?zr(z(e),s):z(e)[T]=256*Po(e),zr(et(e),s),ya(e,r)}function jf(){return Qa(g[C()],y())}function Qa(e,o){var s,r,n,a,t,i;t=ss(e)+1,i=os(e)+1,as(e,t),us(e,i),n=fr(e),r=Ct(n),t>=r&&lr(e),i>=0&&or(e),s=A(e),Gr(e,o),a=A(e),(n>=t||i+r>=0)&&xh(e,s,a)}function It(e){di(e),r=!0}function Ur(){return t[iu]}function di(e){return t[iu]=e}function er(i,t){return p(t)<fn?e.primitiveFail():(e.storeIntegerofObjectwithValue(Eu,t,ir(i)),e.storeIntegerofObjectwithValue(bs,t,A(i)),e.storeIntegerofObjectwithValue(gs,t,y()),e.storeIntegerofObjectwithValue(ys,t,Jr(i)),e.storeIntegerofObjectwithValue(ks,t,ft(i)),void Du(i))}function k(){uu(O)}function yo(t){var i,r,n;return i=Di(),r=xt(),n=Nt(),p(t)<Or?e.primitiveFail():(e.storeIntegerofObjectwithValue(Fs,t,ir(i)),e.storeIntegerofObjectwithValue(Is,t,r),e.storeIntegerofObjectwithValue(Os,t,n),void e.storeIntegerofObjectwithValue(Zu,t,y()))}function Xr(){return e.failed()?null:(r&&Lf(e.stackObjectValue(1),e.stackObjectValue(0)),k(o),e.pop(3),void e.pushInteger(Ur()))}function Lf(i,r){var e,t;t=Ur(),t===Vn&&(e=B[Y()],er(e,i),yr(Y()+1)),t===wn&&yo(r),t===Cn&&(e=g[C()],er(e,i))}function Ef(e){var i,t,s,r,a,n;return n=wt(e),r=jt(e),r===n?e:(t=r-n,0>t&&(t=0-t),t>255?(h(xn,1),Sa(e)):(a=$t(e),s=Tt(e),i=s-a,0>i&&(i=0-i),i>32*t?(h(Mn,1),Sa(e)):e))}function Yr(e){var t,i,n;return n=Ef(e),n!==e?(t=Yr(e),r?0:(i=Yr(n),r?0:t>=i?t:i)):e}function zf(i,n){var r,e,t;return r=e=t=Uf(i),n&&(e=Oo(i)),e>t&&(t=e),i!==r&&n&&(e=Oo(r)),e>t&&(t=e),t}function Oo(e){var t,r,n,a,i,o,s;return o=$t(e),s=Vi(e),a=Tt(e),r=s-o,n=a-s,r*n>=0?e:(h(Fr,1),t=n-r,i=r,0>i&&(i=0-i),0>t&&(t=0-t),Fa(e,i/t))}function Uf(e){var t,r,n,a,i,o,s;return o=wt(e),s=Pi(e),a=jt(e),r=s-o,n=a-s,r*n>=0?e:(h(Fr,1),t=n-r,i=r,0>i&&(i=0-i),0>t&&(t=0-t),Fa(e,i/t))}function Io(e,t,i){var r;0===V()?As()&&(rn(e),Qr(t),en(i)):(r=oa(e,t),r||ra(e,t,i))}function Hf(t){var i,e;return X(2*_())?(i=Jr(t)<<1,e=Cu(t),0!==e&&Io(e,i,999999999),e=mu(t),0!==e&&Io(e,i,999999999),void Xi(A(t))):null}function Xf(e){var n,t,i,a,r,s;switch(s=kh(e),Mi=e,s){case 0:case 1:pi();break;case 2:Bc();break;case 3:qc()}switch(a=Dt,s){case 0:case 1:pi();break;case 2:Mc();break;case 3:xc()}return t=Dt,0===t?null:X(_())?(n=(Jr(e)<<1)+1,r=A(e)+a,i=Ts(t,n),-1===i?ra(t,n,r):dr(i)<r&&Xt(i,r),void Xi(A(e))):null}function Zf(){return 0===V()?-1:Zr()}function Zi(){return 0===V()?0:tn()}function Zr(){return Et(V()-_())}function Qr(e){return yi(V()-_(),e)}function $r(){return dr(V()-_())}function en(e){return Xt(V()-_(),e)}function tn(){return Kt(V()-_())}function rn(e){return ki(V()-_(),e)}function nn(){return 0===V()?999999999:$r()}function q(s){var e,a,i,r,n,t;return 0===s||vr(s)?(i=255&s,r=s>>>8&255,n=s>>>16&255,e=s>>>24&255,br()&&(t=$i(),a=(e*t[6]+t[7])/e,n=(n*t[0]+t[1])*a|0,r=(r*t[2]+t[3])*a|0,i=(i*t[4]+t[5])*a|0,e=e*a|0,n=Math.max(n,0),n=Math.min(n,255),r=Math.max(r,0),r=Math.min(r,255),i=Math.max(i,0),i=Math.min(i,255),e=Math.max(e,0),e=Math.min(e,255)),1>e?0:(255>e&&Co()&&It(_c),i+(r<<8)+(n<<16)+(e<<24))):s}function Pt(e){Nf()?hh(e,e):(e[0]=(e[0]+vn())*P(),e[1]=(e[1]+pn())*P())}function hh(e,t){ph(0|e[0],0|e[1],t)}function ph(t,i,r){var e,n,s;e=sn(),n=(e[0]*t+e[1]*i+e[2])*P()|0,s=(e[3]*t+e[4]*i+e[5])*P()|0,r[0]=n,r[1]=s}function at(e){e>0&&Pt(i()),e>1&&Pt(l()),e>2&&Pt(S()),e>3&&Pt(wi())}function ci(n){var e,t,r,s;return 0===n?0:(i()[0]=0,i()[1]=0,l()[0]=256*n,l()[1]=0,S()[0]=0,S()[1]=256*n,at(3),e=l()[0]-i()[0],t=l()[1]-i()[1],r=(0|Math.sqrt(e*e+t*t))+128>>8,e=S()[0]-i()[0],t=S()[1]-i()[1],s=(0|Math.sqrt(e*e+t*t))+128>>8,r>s&&(r=s),0===r?1:r)}function ou(s){var e,i,r,n,t;return br()?(i=255&s,r=s>>>8&255,n=s>>>16&255,e=s>>>24&255,t=$i(),n=n*t[0]+t[1]|0,r=r*t[2]+t[3]|0,i=i*t[4]+t[5]|0,e=e*t[6]+t[7]|0,n=Math.max(n,0),n=Math.min(n,255),r=Math.max(r,0),r=Math.min(r,255),i=Math.max(i,0),i=Math.min(i,255),e=Math.max(e,0),e=Math.min(e,255),16>e?0:i+(r<<8)+(n<<16)+(e<<24)):s}function Qt(){return t[Kn]}function bh(e){return t[Kn]=e}function vt(){hr(Qt())}function Sh(e){hr($()+e)}function lu(e){return Fc(e)?(hr($()-e),!0):!1}function E(){return Qt()-$()}function dt(e){return t[$()+e]}function ht(e,i){return t[$()+e]=i}function $(){return t[Bn]}function hr(e){return t[Bn]=e}function Bh(e){return s(e,Es)}function ts(e,t){return a(e,Es,t)}function Th(e){return s(e,Ks)}function is(e,t){return a(e,Ks,t)}function un(e){return s(e,zs)}function ku(e,t){return a(e,zs,t)}function bu(e){return s(e,Gs)}function gu(e,t){return a(e,Gs,t)}function et(e){return x(Z,e+Al)}function Su(e){return s(e,Js)}function ln(e,t){return a(e,Js,t)}function ss(e){return s(e,Ha)}function as(e,t){return a(e,Ha,t)}function os(e){return s(e,Xa)}function us(e,t){return a(e,Xa,t)}function fr(e){return s(e,Ya)}function wu(e,t){return a(e,Ya,t)}function Vu(e){return s(e,Za)}function ju(e,t){return a(e,Za,t)}function ls(e){return s(e,$a)}function nr(e,t){return a(e,$a,t)}function fs(e){t=e.wordsAsInt32Array()}var Bu=1,Nu=11,hs=12,ps=2,ds=3,ni=1,ms=0,fn=6,Eu=0,ks=4,bs=1,gs=2,ys=3,Or=6,Fs=0,Os=2,Is=1,Zu=3,Gt=16,Ps=12,Cs=11,ws=14,Vs=13,js=10,nl=18,xs=15,qs=14,Ms=15,Bs=21,ll=18,Ns=16,dn=4,Ws=5,Yi=2,mn=3,ml=10,T=0,qt=1,Ls=12,Rs=13,Es=18,Ks=19,zs=20,Gs=16,Ir=28,Al=22,Js=17,Hi=10,Xs=4,kn=65536,jl=100,Si=121,Qs=122,$s=114,gn=112,ta=101,ia=102,N=104,na=103,Tl=120,ut=119,sa=113,aa=123,Kl=115,zl=108,Gl=105,Ul=106,Jl=110,Hl=107,Xl=109,kt=111,Zl=118,it=117,Sn=116,ua=8,la=9,ca=7,fa=2,ha=1,Fn=0,da=6,oc=1024,On=2,va=255,ka=256,ba=65280,ga=4,pc=512,dc=768,mc=65535,vc=1,kc=7,bc=5,rr=254,lt=1,Zt=5,Yt=8,Bt=3,w=0,Mt=6,ti=7,ii=2,ri=4,wa=4,Va=5,ja=6,Cn=6,qa=2,wn=5,Vn=4,_c=3,Wc=1,Na=6,_a=7,Wa=8,Da=9,Ta=4,La=5,Ra=10,Gc=12,Uc=12,At=16,Ka=14,za=15,Ga=13,Ua=15,Ja=14,Ha=18,Xa=19,Ya=20,Za=16,si=21,$a=17,eo=10,to=12,uf=11,io=51,ro=50,ff=53,no=48,so=52,ao=49,oo=13,uo=14,xn=109,co=111,Fr=108,Mn=110,Bn=10,mo=69,vo=43,ko=45,bo=42,go=44,Cf=24,Nn=97,_n=107,ai=103,Dn=93,Tn=91,Ln=101,oi=105,ui=99,li=95,wo=88,Vo=113,jo=46,xo=47,Rf=18,qo=37,Mo=39,Bo=36,No=38,_o=11,Wo=12,Do=17,To=16,fi=128,Lo=65,Ro=66,Eo=67,Ko=68,zo=0,Go=1097753705,Uo=256,Jo=63,Ho=8,Xo=9,oh=80,uh=82,lh=84,ch=86,Kn=1,Zo=34,Qo=35,$o=33,eu=32,tu=2,iu=64,zn=96,Gn=106,mi=102,Un=92,Jn=90,Hn=100,vi=104,bi=98,Ei=94,f=3,c=5,g=null,Fi="BitBltPlugin",ji=null,Dt=0,Mi=0,d=0,o=0,r=0,Wi=0,m=0,B=null,e=null,Ti=null,Eh="B2DPlugin 14 November 2014 (e)",Z=null,O=0,u=null,t=null;Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:Nl,primitiveCopyBuffer:gl,primitiveAddRect:kl,primitiveAddGradientFill:cl,primitiveSetClipRect:sc,initialiseModule:kr,primitiveSetBitBltPlugin:nc,primitiveRegisterExternalEdge:$l,primitiveGetClipRect:Pl,primitiveAddBezier:sl,primitiveInitializeProcessing:Bl,primitiveRenderImage:tc,primitiveGetOffset:xl,primitiveSetDepth:uc,primitiveAddBezierShape:al,primitiveSetEdgeTransform:lc,getModuleName:Mu,primitiveGetTimes:ql,primitiveNextActiveEdgeEntry:Dl,primitiveAddBitmapFill:ol,primitiveGetDepth:wl,primitiveAbortProcessing:il,primitiveNextGlobalEdgeEntry:El,primitiveGetFailureReason:Vl,primitiveDisplaySpanBuffer:yl,moduleUnloaded:Fu,primitiveGetCounts:Cl,primitiveChangedActiveEdgeEntry:bl,primitiveRenderScanline:ic,primitiveGetBezierStats:Il,primitiveFinishedProcessing:Fl,setInterpreter:Dc,primitiveNeedsFlush:_l,primitiveAddLine:fl,primitiveSetOffset:cc,primitiveNextFillEntry:Rl,primitiveInitializeBuffer:Ml,primitiveDoProfileStats:Sl,primitiveAddActiveEdgeEntry:rl,primitiveSetAALevel:rc,primitiveNeedsFlushPut:Wl,primitiveAddCompressedShape:ul,primitiveSetColorTransform:ac,primitiveAddOval:hl,primitiveRegisterExternalFill:ec,primitiveAddPolygon:dl,primitiveGetAALevel:Ol})
}),module("users.bert.SqueakJS.plugins.BitBltPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function _i(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function E(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function Xt(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function v(e,t){return 0|Math.floor(e/t)}function wn(e,t){return e-v(e,t)*t|0}function i(t,e){return e>31?0:t<<e}function u(t,e){return e>31?0:t>>>e}function z(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function Cn(r,i){var e,n;if(16>t){for(e=r^i,n=j[t];0!==e;)0!==(e&n)&&++$,e=u(e,t);return i}return 16===t?(e=ht(r,i,5,3),$=$+(31&e)+(e>>>5&31)+(e>>>10&31),e=ht(r>>>16,i>>>16,5,3),$=$+(31&e)+(e>>>5&31)+(e>>>10&31)):(e=ht(r,i,8,3),$=$+(255&e)+(e>>>8&255)+(e>>>16&255)),i}function Pn(a,i){var s,e,n,r;if((w&(Y|ct))!==(Y|ct))return i;if(16>t){for(s=j[t]&ut,r=i,n=1;c>=n;n++)e=r&s,Lt(e,Mt(e)+1),r=u(r,t);return i}return 16===t?(e=mt(65535&i,5,R),Lt(e,Mt(e)+1),e=mt(i>>>16,5,R),Lt(e,Mt(e)+1)):(e=mt(i,8,R),Lt(e,Mt(e)+1)),i}function An(e,t){return e+t}function In(r,n){var s,t,i,a,e;return e=r>>>24,0===e?n:255===e?r:(s=255-e,t=(16711935&r)*e+(16711935&n)*s+16711935,i=(16711935&(r>>>8|16711680))*e+(n>>>8&16711935)*s+16711935,t=t+(t-65537>>>8&16711935)>>>8&16711935,i=i+(i-65537>>>8&16711935)>>>8&16711935,a=t|i<<8)}function On(e,t){return Ni(e,t,!1)}function Ni(l,a,A){var g,e,y,n,f,s,p,S,k,b,F,o,r,O,I,m,h;if(16>t)return a;if(b=255-gt,s=a,1===c)A&&0===l||(o=(16711935&l)*gt+(16711935&a)*b+16711935,r=(l>>>8&16711935)*gt+(a>>>8&16711935)*b+16711935,o=o+(o-65537>>>8&16711935)>>>8&16711935,r=r+(r-65537>>>8&16711935)>>>8&16711935,s=o|r<<8);else for(e=j[t],O=5,g=31,h=d,m=a,f=l,n=1;c>=n;n++){if(S=f&e,!(0===(h&e)||A&&0===S)){for(F=m&e,y=0,k=1;3>=k;k++)p=(k-1)*O,I=v((u(S,p)&g)*gt+(u(F,p)&g)*b+254,255)&g,y|=i(I,p);s=s&~i(e,16*(n-1))|i(y,16*(n-1))}h=u(h,t),f=u(f,t),m=u(m,t)}return s}function xt(i,n){var r,e,t;return r=255-(i>>>24),e=((16711935&n)*r>>>8&16711935)+(16711935&i),t=((n>>>8&16711935)*r>>>8&16711935)+(i>>>8&16711935),e=16711935&e|255*(16777472&e)>>>8,t=(16711935&t)<<8|255*(16777472&t),t|e}function Fn(e,t){return 0===e?t:Ni(e,t,!0)}function Sn(){var I,k,t,e,g,O,c,v,l,F,y,s,d,b;for(F=h+1,y=m,d=a,t=16*(1&r),q&&(t=16-t),S=i(65535,16-t);0!==--F;){for(g=y*P+4*p,c=d*M+4*(r>>1),I=4*(3&d),b=(3&p)-1,O=o+1,l=S,t=65535===l?16:0;0!==--O;)k=Vi[I+(b=b+1&3)],e=f[g>>>2],v=e>>>24,255===v?(e=di(e,k),e=0===e?i(1,t):i(e,t),Ut(c,e,l)):0!==v&&(s=n[c>>>2],s&=~l,s=u(s,t),s=(31744&s)<<9|(992&s)<<6|((31&s)<<3|4278190080),e=xt(e,s),e=di(e,k),e=0===e?i(1,t):i(e,t),Ut(c,e,l)),g+=4,q?0===t&&(c+=4):0!==t&&(c+=4),t=16^t,l=~l;++y,++d}}function yn(){var i,t,s,e,l,v,c,u,d;for(v=h+1,c=m,d=a;0!==--v;){for(t=c*P+4*p,e=d*M+4*r,s=o+1;0!==--s;)if(i=f[t>>>2],l=i>>>24,255===l){for(n[e>>>2]=i,t+=4,e+=4;0!==--s&&(i=f[t>>>2])>>>24===255;)n[e>>>2]=i,t+=4,e+=4;++s}else if(0===l){for(t+=4,e+=4;0!==--s&&(i=f[t>>>2])>>>24===0;)t+=4,e+=4;++s}else u=n[e>>>2],u=xt(i,u),n[e>>>2]=u,t+=4,e+=4;++c,++d}}function gn(){var e,s,g,O,F,d,t,I,b,l,y,k,c,v;for(F=Ii(),I=w&~Ft,y=h+1,k=m,v=a,S=8*(3&r),q&&(S=24-S),L=C^i(255,S),t=0===(1&r)?0:522133279,0===(1&a)&&(t=522133279^t);0!==--y;){for(t=522133279^t,g=k*P+4*p,d=v*M+4*(r>>2),O=o+1,e=S,l=L;0!==--O;)s=(f[g>>>2]&~t)+t,b=s>>>24,b>31&&(224>b&&(c=n[d>>>2],c&=~l,c=u(c,e),c=F[c],s=xt(s,c)),s=Dt(s,I),s=i(s,e),Ut(d,s,l)),g+=4,q?0===e?(d+=4,e=24,l=16777215):(e-=8,l=l>>>8|4278190080):24===e?(d+=4,e=0,l=4294967040):(e+=8,l=l<<8|255),t=522133279^t;++k,++v}}function bn(e,t){return e&t}function kn(e,t){return e&~t}function vn(e,t){return~e&t}function mn(e,t){return~e&~t}function dn(t,e){return~e}function pn(e,t){return~e|t}function hn(e,t){return~e|~t}function fn(e){return~e}function cn(e,t){return~e^t}function ln(e,t){return e|t}function un(e,t){return e|~t}function on(e,t){return e^t}function an(){var e;T===K&&a>=m&&(a>m?(dt=-1,m=m+h-1,a=a+h-1):a===m&&r>p&&(J=-1,p=p+o-1,r=r+o-1,B>1&&(e=S,S=L,L=e)),l=a*M+4*v(r,c),Pt=M*dt-4*B*J)}function sn(){return 0}function vi(){return N>=_?(p=St,r=N,o=Z):(p=St+(_-N),o=Z-(_-N),r=_),r+o>_+Vt&&(o-=r+o-(_+Vt)),D>=x?(m=Yt,a=D,h=Ot):(m=Yt+x-D,h=Ot-(x-D),a=x),a+h>x+jt&&(h-=a+h-(x+jt)),W?null:(0>p&&(r-=p,o+=p,p=0),p+o>it&&(o-=p+o-it),0>m&&(a-=m,h+=m,m=0),void(m+h>rt&&(h-=m+h-rt)))}function qt(){return vi(),0>=o||0>=h?(y=A=F=O=0,null):Di()?(rn(),void Ai()):e.primitiveFail()}function nn(e,t,i){N=e,D=i,St=e,Z=t-e,qt(),bt()}function rn(){var t;if(tn(),e.failed())return e.primitiveFail();if(t=sr())return null;if(30===k||31===k){if(1!==e.methodArgumentCount())return e.primitiveFail();if(gt=e.stackIntegerValue(0),!(!e.failed()&&gt>=0&&255>=gt))return e.primitiveFail()}$=0,_r(),(22===k||32===k)&&(y=A=F=O=0),J>0?(y=r,A=r+o):(y=r-o+1,A=r+1),dt>0?(F=a,O=a+h):(F=a-h+1,O=a+1)}function tn(){var t,i;if(41===k)if(yi=255,$t=16777215,pt=null,U=null,e.methodArgumentCount()>=2){if(yi=e.stackIntegerValue(e.methodArgumentCount()-2),e.failed())return e.primitiveFail();if($t=e.stackIntegerValue(e.methodArgumentCount()-1),e.failed())return e.primitiveFail();4===e.methodArgumentCount()&&(i=e.stackObjectValue(1),e.isBytes(i)&&(pt=i.bytes),t=e.stackObjectValue(0),e.isBytes(t)&&(U=t.bytes))}else{if(1!==e.methodArgumentCount())return e.primitiveFail();if($t=e.stackIntegerValue(0),e.failed())return e.primitiveFail()}}function en(){var g,b,p,m,v,F,e,c,r,o,O,A,t,y;for(F=s[k+1],e=4*J,-32===V?V=v=p=0:0>V?(v=V+32,p=i(C,0-V)):0===V?(v=0,p=C):(v=V-32,p=u(C,V)),y=~p,At?(m=C,Bt=0):m=Gt(0),O=a,A=1;h>=A;A++){if(Bt>1&&(m=Gt(O),O+=dt),Kt?(o=f[I>>>2],I+=e):o=0,d=S,t=f[I>>>2],I+=e,b=z(o&y,v)|z(t&p,V),o=t,c=n[l>>>2],g=F(b&m,c),c=d&g|c&~d,n[l>>>2]=c,l+=e,d=C,3===k)if(0===V&&m===C)if(-1===J)for(r=2;B-1>=r;r++)t=f[I>>>2],I+=e,n[l>>>2]=t,l+=e;else for(r=2;B-1>=r;r++)n[l>>>2]=o,l+=e,o=f[I>>>2],I+=e;else for(r=2;B-1>=r;r++)t=f[I>>>2],I+=e,b=z(o&y,v)|z(t&p,V),o=t,n[l>>>2]=b&m,l+=e;else for(r=2;B-1>=r;r++)t=f[I>>>2],I+=e,b=z(o&y,v)|z(t&p,V),o=t,g=F(b&m,n[l>>>2]),n[l>>>2]=g,l+=e;B>1&&(d=L,t=f[I>>>2],I+=e,b=z(o&y,v)|z(t&p,V),c=n[l>>>2],g=F(b&m,c),c=d&g|c&~d,n[l>>>2]=c,l+=e),I+=Jt,l+=Pt}}function $r(){var t,r,o,e,i,u;for(o=s[k+1],u=1;h>=u;u++){if(r=At?C:Gt(a+u-1),d=S,e=n[l>>>2],t=o(r,e),e=d&t|e&~d,n[l>>>2]=e,l+=4,d=C,3===k)for(e=r,i=2;B-1>=i;i++)n[l>>>2]=e,l+=4;else for(i=2;B-1>=i;i++)e=n[l>>>2],t=o(r,e),n[l>>>2]=t,l+=4;B>1&&(d=L,e=n[l>>>2],t=o(r,e),e=d&t|e&~d,n[l>>>2]=e,l+=4),l+=Pt}}function Oi(){var K,y,W,E,T,x,M,e,g,V,i,F,N,O,D,A,f,R,u,_;for(V=s[k+1],et=v(32,b),E=j[b],D=j[t],K=w&~Ft,I=m*P+4*v(p,et),_=et-(p&et-1),T=_>o?0:v(o-_,et)+1,Jt=P-4*T,g=c-(r&c-1),R=(r+o-1&c-1)+1,g>o&&(g=o),f=(p&et-1)*b,i=(r&c-1)*t,y=b,A=t,W=0,tt&&(f=32-b-f,y=0-y),q&&(i=32-t-i,A=0-A,W=32-t),F=1;h>=F;F++){N=At?C:Gt(a+F-1),Wt=f,G=i,d=S,u=g,M=B;do x=Nr(u,K,E,D,y,A),G=W,d===C?(O=V(x&N,n[l>>>2]),n[l>>>2]=d&O):(e=n[l>>>2],O=V(x&N,e&d),e=d&O|e&~d,n[l>>>2]=e),l+=4,2===M?(d=L,u=R):(d=C,u=c);while(0!==--M);I+=Jt,l+=Pt}}function Ii(){var e=[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295];return e}function Ct(e,t,i){return t>e?v(t-e+qi,i+1)+1:t===e?0:0-(v(e-t+qi,i+1)+1)}function si(){var s,e,n;n=c-1,e=c-(r&n),S=q?u(C,32-e*t):i(C,32-e*t),s=(r+o-1&n)+1,L=q?i(C,32-s*t):u(C,32-s*t),e>o?(S&=L,L=0,B=1):B=v(o-e+n,c)+1,J=dt=1,l=a*M+4*v(r,c),Pt=M*dt-4*B*J}function Qt(t,e){return e}function di(t,i){var e;return e=i<<8,(Zt[e+(t>>>16&255)]<<10)+(Zt[e+(t>>>8&255)]<<5)+Zt[e+(255&t)]}function Qr(l,c){var u,i,f,a,t,r,o,s,n,h;if(f=l>0?1:0===l?0:-1,h=c>0?1:0===c?0:-1,a=Math.abs(c),o=Math.abs(l),r=i=9999,t=n=-9999,o>a){for(u=o>>1,s=1;o>=s;s++)if(N+=f,(u-=a)<0&&(D+=h,u+=o),o>s){if(qt(),e.failed())return null;A>y&&O>F&&(r=Math.min(r,y),t=Math.max(t,A),i=Math.min(i,F),n=Math.max(n,O),(t-r)*(n-i)>4e3&&(y=r,A=t,F=i,O=n,bt(),r=i=9999,t=n=-9999))}}else for(u=a>>1,s=1;a>=s;s++)if(D+=h,(u-=o)<0&&(N+=f,u+=a),a>s){if(qt(),e.failed())return null;A>y&&O>F&&(r=Math.min(r,y),t=Math.max(t,A),i=Math.min(i,F),n=Math.max(n,O),(t-r)*(n-i)>4e3&&(y=r,A=t,F=i,O=n,bt(),r=i=9999,t=n=-9999))}y=r,A=t,F=i,O=n,e.storeIntegerofObjectwithValue(pi,g,N),e.storeIntegerofObjectwithValue(wi,g,D)}function Ut(t,i,r){var e;e=n[t>>>2],e&=r,e|=i,n[t>>>2]=e}function Zr(r,n){var e,i,t,s;return e=255&r,i=ai[7&e],t=li[e>>>3],s=i>n?t+1:t,e=r>>>8&255,i=ai[7&e],t=li[e>>>3],s|=i>n?t+1<<5:t<<5,e=r>>>16&255,i=ai[7&e],t=li[e>>>3],s|=i>n?t+1<<10:t<<10}function H(r,n){var t,i;return i=e.fetchPointerofObject(r,n),"number"==typeof i?i:(t=e.floatValueOf(i),t>=-2147483648&&2147483647>=t?0|t:(e.primitiveFail(),0))}function Q(r,n,s){var i,t;return t=e.fetchPointerofObject(r,n),"number"==typeof t?t:t.isNil?s:(i=e.floatValueOf(t),i>=-2147483648&&2147483647>=i?0|i:(e.primitiveFail(),0))}function Xr(i,e){return 32!==t?e:0===e?0:0!==(4278190080&e)?e:e|4278190080&i}function Hr(){return Yr}function Gt(e){return oi[wn(e,Bt)]}function xi(e){return e.isNil?!0:0===k?!0:5===k?!0:10===k?!0:15===k?!0:!1}function Jr(){s[1]=sn,s[2]=bn,s[3]=kn,s[4]=ur,s[5]=vn,s[6]=Qt,s[7]=on,s[8]=ln,s[9]=mn,s[10]=cn,s[11]=dn,s[12]=un,s[13]=fn,s[14]=pn,s[15]=hn,s[16]=Qt,s[17]=Qt,s[18]=Qt,s[19]=An,s[20]=or,s[21]=Or,s[22]=fr,s[23]=Cn,s[24]=Pn,s[25]=In,s[26]=qr,s[27]=Mr,s[28]=mr,s[29]=dr,s[30]=pr,s[31]=On,s[32]=Fn,s[33]=br,s[34]=ar,s[35]=xt,s[36]=xt,s[37]=xt,s[38]=hr,s[39]=xr,s[40]=Ti,s[41]=Xr,s[42]=gr}function Ur(){var e,t,i;for(t=0;255>=t;t++)for(e=0;15>=e;e++)i=Zr(t,e),Zt[(e<<8)+t]=i}function Gr(){return Jr(),Ur(),!0}function zr(e,t){return e&&t?0===e[Et]&&0===e[Tt]&&0===e[Nt]&&0===e[ei]&&16711680===t[Et]&&65280===t[Tt]&&255===t[Nt]&&4278190080===t[ei]?!0:!1:!0}function Kr(){var i;if(n=e.fetchPointerofObject(nt,K),ft=e.fetchIntegerofObject(hi,K),vt=e.fetchIntegerofObject(ti,K),!(ft>=0&&vt>=0))return!1;if(t=e.fetchIntegerofObject(mi,K),q=t>0,0>t&&(t=0-t),"number"==typeof n){if(!Ar(n))return!1;c=v(32,t),n=M=0}else{if(c=v(32,t),M=4*v(ft+(c-1),c),i=Xt(n),!e.isWordsOrBytes(n)||i!==M*vt)return!1;n=n.wordsOrBytes()}return!0}function Ht(e){return Ci(e,!1)}function Ci(i,r){var t;if(g=i,Si=r,k=e.fetchIntegerofObject(Ki,g),e.failed()||0>k||k>Hi-2)return!1;if(k>=16&&17>=k)return!1;if(T=e.fetchPointerofObject(Ei,g),W=xi(T),lt=e.fetchPointerofObject(Gi,g),At=xi(lt),K=e.fetchPointerofObject(Ui,i),!(e.isPointers(K)&&E(K)>=4))return!1;if(t=Kr(),!t)return!1;if(N=Q(pi,g,0),D=Q(wi,g,0),Z=Q(Li,g,ft),Ot=Q(zi,g,vt),e.failed())return!1;if(W)St=Yt=0;else{if(!(e.isPointers(T)&&E(T)>=4))return!1;if(t=Er(),!t)return!1;if(t=Rr(),!t)return!1;0===(w&Ft)&&ji(),St=Q(Ri,g,0),Yt=Q(Br,g,0)}return(t=Lr())?(_=Q(Yi,g,0),x=Q(Xi,g,0),Vt=Q(Zi,g,ft),jt=Q(Qi,g,vt),e.failed()?!1:(0>_&&(Vt+=_,_=0),0>x&&(jt+=x,x=0),_+Vt>ft&&(Vt=ft-_),x+jt>vt&&(jt=vt-x),!0)):!1}function Er(){var t;if(f=e.fetchPointerofObject(nt,T),it=H(hi,T),rt=H(ti,T),!(it>=0&&rt>=0))return!1;if(b=e.fetchIntegerofObject(mi,T),tt=b>0,0>b&&(b=0-b),"number"==typeof f){if(!Ir(f))return!1;et=v(32,b),f=P=0}else{if(et=v(32,b),P=4*v(it+(et-1),et),t=Xt(f),!e.isWordsOrBytes(f)||t!==P*rt)return!1;f=f.wordsOrBytes()}return!0}function Rr(){var r,t,i,n;if(w=ut=R=0,st=null,ot=null,X=null,t=e.fetchPointerofObject(Ji,g),t.isNil)return!0;if(w=Y,n=!1,e.isWords(t))i=E(t),X=t.words,n=!0;else{if(!(e.isPointers(t)&&E(t)>=3))return!1;if(st=Bi(e.fetchPointerofObject(0,t)),ot=Bi(e.fetchPointerofObject(1,t)),r=e.fetchPointerofObject(2,t),r.isNil)i=0;else{if(!e.isWords(r))return!1;i=E(r),X=r.words}w|=Ft}return 0!==(i&i-1)?!1:(ut=i-1,R=0,512===i&&(R=3),4096===i&&(R=4),32768===i&&(R=5),0===i?(X=null,ut=0):w|=ct,n&&ji(),zr(st,ot)?(ot=null,st=null):w|=Fi,!0)}function Bi(t){return t.isNil?null:"number"==typeof t?(e.primitiveFail(),null):e.isWords(t)&&4===E(t)?t.words:(e.primitiveFail(),null)}function Lr(){var t;if(At)return oi=null,!0;if(e.isPointers(lt)&&E(lt)>=4)t=e.fetchPointerofObject(nt,lt),Bt=e.fetchIntegerofObject(ti,lt),e.isWords(t)||(At=!0);else{if(e.isPointers(lt)||!e.isWords(lt))return!1;t=lt,Bt=E(t)}return oi=t.wordsOrBytes(),!0}function Rt(){return yt=e.ioLoadFunctionFrom("ioGetSurfaceFormat","SurfacePlugin"),It=e.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin"),_t=e.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin"),!!yt&&!!It&&!!_t}function Tr(e){return Ci(e,!0)}function Di(){var s,t,u,i,c,d,l;if(wt=!1,0===n){if(!It&&!Rt())return null;if(i=It,s=e.fetchIntegerofObject(nt,K),0===f&&!W&&(t=e.fetchIntegerofObject(nt,T),t===s))return Si?(l=Math.min(p,r),c=Math.max(p,r)+o,u=Math.min(m,a),d=Math.max(m,a)+h,f=i(t,function(e){P=e},l,u,c-l,d-u)):f=i(t,function(e){P=e},0,0,it,rt),n=f,M=P,wt=!0,0!==n;n=i(s,function(e){M=e},r,a,o,h),wt=!0}if(0===f&&!W){if(t=e.fetchIntegerofObject(nt,T),!It&&!Rt())return null;i=It,f=Si?i(t,function(e){P=e},0,0,it,rt):i(t,function(e){P=e},p,m,o,h),wt=!0}return 0!==n&&(0!==f||W)}function Dt(i,t){var e;return e=i,0!==(t&Y)&&(0!==(t&Fi)&&(e=vr(i,t),0===e&&0!==i&&(e=1)),0!==(t&ct)&&(e=X[e&ut])),e}function Dr(e){0===strcmp(e,"SurfacePlugin")&&(yt=It=_t=0)}function Pi(s,a,n,o){var t,r,e;for(e=j[n],t=0,r=1;o>=r;r++)(s&e)===e&&(t|=a&e),e=i(e,n);return t}function bi(r,n,o,l,s){var e,a,i,t;return t=r&s,e=n&s,i=(r^t)+(n^e),a=t&e|(t|e)&i,i^t^e|u(a,o-1)*l}function ri(s,a,n,o){var t,r,e;for(e=j[n],t=0,r=1;o>=r;r++)t|=Math.max(a&e,s&e),e=i(e,n);return t}function kt(s,a,n,o){var t,r,e;for(e=j[n],t=0,r=1;o>=r;r++)t|=Math.min(a&e,s&e),e=i(e,n);return t}function ni(a,o,e,l){var s,r,n,t;return t=j[e],s=i(t,e),r=u(((a&t)+1)*((o&t)+1)-1&s,e),1===l?r:(n=((u(a,e)&t)+1)*((u(o,e)&t)+1)-1&s,r|=n,2===l?r:(n=((u(a,2*e)&t)+1)*((u(o,2*e)&t)+1)-1&s,r|=i(n,e),3===l?r:(n=((u(a,3*e)&t)+1)*((u(o,3*e)&t)+1)-1&s,r|=i(n,2*e))))}function Wr(l,c,e,f){var t,o,r,n,a,s;for(s=j[e],o=0,n=1;f>=n;n++)r=u(l&s,(n-1)*e),t=u(c&s,(n-1)*e),32!==e&&(16===e?(r=4278190080|ui(r),t=4278190080|ui(t)):(r=4278190080|mt(r,e,32),t=4278190080|mt(t,e,32))),a=ii(r,t),32!==e&&(a=mt(a,32,e)),o|=i(a,(n-1)*e),s=i(s,e);return o}function ht(o,u,a,l){var t,n,r,s,e;for(e=j[a],n=0,s=1;l>=s;s++)r=o&e,t=u&e,n|=t>r?t-r:r-t,e=i(e,a);return n}function _r(){si(),W?$r():(an(),b!==t||0!==w||tt!==q?Oi():(lr(),en()))}function Nr(m,l,d,p,h,c){var n,e,r,t,s,o,a;if(r=f[I>>>2],a=0,e=Wt,t=G,o=m,l===(Y|ct)){do n=u(r,e)&d,s=X[n&ut],a|=i(s&p,t),t+=c,0!==(4294967264&(e+=h))&&(tt?e+=32:e-=32,r=f[(I+=4)>>>2]);while(0!==--o)}else do n=u(r,e)&d,s=Dt(n,l),a|=i(s&p,t),t+=c,0!==(4294967264&(e+=h))&&(tt?e+=32:e-=32,r=f[(I+=4)>>>2]);while(0!==--o);return Wt=e,a}function fi(t,i){var a,r,n,e,s;return 0>t||0>i||(e=t>>>14)>=it||(s=i>>>14)>=rt?0:(n=s*P+4*u(e,gi),r=f[n>>>2],Wt=Mi[e&ki],a=u(r,Wt)&Wi)}function Ti(u,n){var r,s,a,o,e;if(32===t)return u===n?0:n;for(s=t,e=j[s],a=0,o=1;c>=o;o++)r=n&e,(u&e)===r&&(r=0),a|=r,e=i(e,s);return a}function Mr(e,i){return Pi(~e,i,t,c)}function qr(e,i){return 0===e?i:e|Pi(~e,i,t,c)}function xr(l,n){var s,e,r,a,o;if(1===c)return n;if(s=0,r=i(1,t)-1,a=i(r,(c-1)*t),e=32-t,s|=i(n&r,e)|u(n&a,e),2>=c)return s;for(o=2;c>>1>=o;o++)r=i(r,t),a=u(a,t),e-=2*t,s|=i(n&r,e)|u(n&a,e);return s}function jr(){var t;return t=e.stackValue(e.methodArgumentCount()),Ht(t)?(qt(),e.failed()?null:(bt(),e.failed()?null:(e.pop(e.methodArgumentCount()),22===k||32===k?(e.pop(1),e.pushInteger($)):void 0))):e.primitiveFail()}function Vr(){var c,S,u,d,s,v,g,i,l,I,P,m,C,p;if(6!==e.methodArgumentCount())return e.primitiveFail();if(P=e.stackIntegerValue(0),s=e.stackObjectValue(1),l=e.stackObjectValue(2),_i(s)!==e.classArray()||_i(l)!==e.classArray())return e.primitiveFail();if(256!==E(l))return e.primitiveFail();if(e.failed())return null;if(v=E(s)-2,u=e.stackIntegerValue(3),m=e.stackIntegerValue(4),p=e.stackObjectValue(5),!e.isBytes(p))return e.primitiveFail();if(!(m>0&&u>0&&u<=Xt(p)))return e.primitiveFail();if(d=e.stackObjectValue(6),!Ht(d))return e.primitiveFail();if(30===k||31===k)return e.primitiveFail();for(g=0!==n&&0!==f&&W===!1&&T!==K&&(0!==w||tt!==q||b!==t),I=N,S=p.bytes,c=m;u>=c;c++){if(C=S[c-1],i=e.fetchIntegerofObject(C,l),0>i||i>v)return e.primitiveFail();if(St=e.fetchIntegerofObject(i,s),Z=e.fetchIntegerofObject(i+1,s)-St,e.failed())return null;if(vi(),o>0&&h>0&&(g?(si(),Oi(),y=r,A=r+o,F=a,O=a+h):qt()),e.failed())return null;N=N+Z+P}y=I,bt(),e.storeIntegerofObjectwithValue(pi,d,N),e.pop(6)}function wr(){var t,i,r;return i=e.stackValue(2),r=e.stackIntegerValue(1),t=e.stackIntegerValue(0),Ht(i)?(e.failed()||(Qr(r,t),bt()),void(e.failed()||e.pop(2))):e.primitiveFail()}function Cr(){var p,t,h,r,a,n,d,l,c,f,s,o,i;return s=e.stackIntegerValue(1),o=e.stackIntegerValue(0),t=e.stackValue(2),e.failed()?null:0>s||0>o?(i=0,e.failed()?null:(e.popthenPush(3,i),null)):(t=e.stackValue(e.methodArgumentCount()),e.isPointers(t)&&E(t)>=4?(a=e.fetchPointerofObject(nt,t),e.isWordsOrBytes(a)?(Z=e.fetchIntegerofObject(hi,t),Ot=e.fetchIntegerofObject(ti,t),r=e.fetchIntegerofObject(mi,t),e.failed()?null:s>=Z||o>=Ot?(i=0,e.failed()?null:(e.popthenPush(3,i),null)):0>r?(e.primitiveFail(),null):(n=v(32,r),l=v(Z+(n-1),n),c=Xt(a),c!==l*Ot*4?(e.primitiveFail(),null):(d=e.fetchLong32ofObject(o*l+v(s,n),a),f=u(4294967295,32-r),h=32-((s&n-1)+1)*r,p=u(d,h)&f,i=e.positive32BitIntegerFor(p),e.failed()?null:(e.popthenPush(3,i),null)))):(e.primitiveFail(),null)):(e.primitiveFail(),null))}function Pr(){var t;return t=e.stackValue(e.methodArgumentCount()),Tr(t)?(nr(),e.failed()?null:(bt(),e.failed()?null:void e.pop(e.methodArgumentCount()))):e.primitiveFail()}function Ar(e){return yt||Rt()?yt(e,function(e,i,r,n){ft=e,vt=i,t=r,q=n}):!1}function Ir(e){return yt||Rt()?yt(e,function(e,t,i,r){it=e,rt=t,b=i,tt=r}):!1}function Or(n,s){var r,e;return 16>t?(e=i(1,t)-1,r=i(v(4294967295,e),t-1),bi(n,s,t,e,r)):16===t?(e=31,r=1108361744,bi(2147450879&n,2147450879&s,5,e,r)):(e=255,r=2155905152,bi(n,s,8,e,r))}function Fr(){var y,F,e,t,k,O,c,I,l,g,b,s,d,v;for(g=h+1,b=m,d=a,e=16*(1&r),q&&(e=16-e),S=i(65535,16-e);0!==--g;){for(k=b*P+4*p,c=d*M+4*(r>>1),y=4*(3&d),v=(3&p)-1,O=o+1,l=S,e=65535===l?16:0;0!==--O;)F=Vi[y+(v=v+1&3)],t=f[k>>>2],I=16777215&t,0!==I&&(s=n[c>>>2],s&=~l,s=u(s,e),s=(31744&s)<<9|(992&s)<<6|((31&s)<<3|4278190080),t=ii(t,s),t=di(t,F),t=0===t?i(1,e):i(t,e),Ut(c,t,l)),k+=4,q?0===e&&(c+=4):0!==e&&(c+=4),e=16^e,l=~l;++b,++d}}function Sr(){var i,e,s,t,d,v,l,u,c;for(v=h+1,l=m,c=a;0!==--v;){for(e=l*P+4*p,t=c*M+4*r,s=o+1;0!==--s;)if(i=f[e>>>2],d=16777215&i,0===d){for(e+=4,t+=4;0!==--s&&0===(16777215&(i=f[e>>>2]));)e+=4,t+=4;++s}else u=n[t>>>2],u=ii(i,u),n[t>>>2]=u,e+=4,t+=4;++l,++c}}function ii(v,d){var s,n,c,t,p,f,l,r,a,o,u,h,i,m,e;return i=v,0===i?d:(n=$t,a=255&yi,h=255&i,i>>>=8,c=255&i,i>>>=8,l=255&i,i>>>=8,f=255&i,255!==a&&(f=f*a>>>8,l=l*a>>>8,c=c*a>>>8,h=h*a>>>8),r=d,t=255&r,e=255&n,U&&(t=U[t],e=U[e]),u=(t*(255-h)>>>8)+(e*h>>>8),u>255&&(u=255),pt&&(u=pt[u]),r>>>=8,n>>>=8,t=255&r,e=255&n,U&&(t=U[t],e=U[e]),s=(t*(255-c)>>>8)+(e*c>>>8),s>255&&(s=255),pt&&(s=pt[s]),r>>>=8,n>>>=8,t=255&r,e=255&n,U&&(t=U[t],e=U[e]),o=(t*(255-l)>>>8)+(e*l>>>8),o>255&&(o=255),pt&&(o=pt[o]),r>>>=8,n>>>=8,p=((255&r)*(255-f)>>>8)+f,p>255&&(p=255),m=(((p<<8)+o<<8)+s<<8)+u)}function yr(){var t,e,g,I,O,k,s,A,d,l,F,b,c,y;for(O=Ii(),A=w&~Ft,F=h+1,b=m,y=a,S=8*(3&r),q&&(S=24-S),L=C^i(255,S),s=0===(1&r)?0:522133279,0===(1&a)&&(s=522133279^s);0!==--F;){for(s=522133279^s,g=b*P+4*p,k=y*M+4*(r>>2),I=o+1,t=S,l=L;0!==--I;)e=(f[g>>>2]&~s)+s,d=16777215&e,d=v((d>>>16)+(d>>>8&255)+(255&d),3),d>31&&(d>224&&(e=4294967295),c=n[k>>>2],c&=~l,c=u(c,t),c=O[c],e=ii(e,c),e=Dt(e,A),e=i(e,t),Ut(k,e,l)),g+=4,q?0===t?(k+=4,t=24,l=16777215):(t-=8,l=l>>>8|4278190080):32===t?(k+=4,t=0,l=4294967040):(t+=8,l=l<<8|255),s=522133279^s;++b,++y}}function gr(e,i){var r;return r=e,0===r?i:Wr(e,i,t,c)}function br(m,p){var f,i,e,s,n,r,o,h,a,l;for(n=j[t],16===t?(i=5,r=31):(i=8,r=255),a=d,o=p,s=m,h=1;c>=h;h++)(a&n)>0&&(l=o&n,f=s&n,16>t?e=f===l?0:1:(e=ht(f,l,i,3),e=(e&r)+(u(e,i)&r)+(u(u(e,i),i)&r)),$+=e),a=u(a,t),s=u(s,t),o=u(o,t);return p}function ui(e){return(31&e)<<3|(992&e)<<6|(31744&e)<<9}function kr(e){return e}function mt(n,o,s){var r,a,t,e;return(r=s-o)>0?(e=i(1,o)-1,t=i(n,r),e=i(e,r),a=t&e,e=i(e,s),t=i(t,r),a+(t&e)+(i(t,r)&i(e,s))):0===r?5===o?32767&n:8===o?16777215&n:n:0===n?n:(r=o-s,e=i(1,s)-1,t=u(n,r),a=t&e,e=i(e,s),t=u(t,r),a=a+(t&e)+(u(t,r)&i(e,s)),0===a?1:a)}function vr(e){var t;return t=z(e&ot[0],st[0]),t|=z(e&ot[1],st[1]),t|=z(e&ot[2],st[2]),t|z(e&ot[3],st[3])}function mr(e,i){return 16>t?ri(e,i,t,c):16===t?ri(e,i,5,3)+(ri(e>>>16,i>>>16,5,3)<<16):ri(e,i,8,4)}function dr(e,i){return 16>t?kt(e,i,t,c):16===t?kt(e,i,5,3)+(kt(e>>>16,i>>>16,5,3)<<16):kt(e,i,8,4)}function pr(r,i){var e;return e=~r,16>t?kt(e,i,t,c):16===t?kt(e,i,5,3)+(kt(e>>>16,i>>>16,5,3)<<16):kt(e,i,8,4)}function hr(e,i){return 16>t?ni(e,i,t,c):16===t?ni(e,i,5,3)+(ni(e>>>16,i>>>16,5,3)<<16):ni(e,i,8,4)}function fr(e,i){return 16>t?ht(e,i,t,c):16===t?ht(e,i,5,3)+(ht(e>>>16,i>>>16,5,3)<<16):ht(e,i,8,4)}function cr(i){var t;return e=i,t=e.majorVersion()==er,t===!1?!1:t=e.minorVersion()>=$i}function ji(){var i,e;if(i=e=0,8>=b)return null;if(16===b&&(i=5),32===b&&(i=8),0===R){if(8>=t)return null;16===t&&(e=5),32===t&&(e=8)}else e=R;ci(i,e)}function ci(n,a){var e,t,s=[0,0,0,0],r=[0,0,0,0];return e=a-n,0===e?0:(0>=e?(t=i(1,a)-1,r[Et]=i(t,2*n-e),r[Tt]=i(t,n-e),r[Nt]=i(t,0-e),r[ei]=0):(t=i(1,n)-1,r[Et]=i(t,2*n),r[Tt]=i(t,n),r[Nt]=t),s[Et]=3*e,s[Tt]=2*e,s[Nt]=e,s[ei]=0,st=s,ot=r,void(w|=Y|Fi))}function bt(){e.showDisplayBitsLeftTopRightBottom(K,y,F,A,O)}function lr(){var e,i,n,s;s=c-1,i=p&s,e=r&s,J>0?(n=Math.min(o,c-e),Kt=i+n>s):(n=Math.min(o,e+1),Kt=0>i-n+1),V=tt?(i-e)*t:(e-i)*t,Kt&&(0>V?V+=32:V-=32),I=m*P+4*v(p,v(32,b)),Jt=P*dt-4*B*J,Kt&&(Jt-=4*J)}function ur(e){return e}function or(e,t){return e-t}function ar(l,n){var s,a,e,o,i,r;if((w&(Y|ct))!==(Y|ct))return n;for(s=j[t],e=n,i=d,o=1;c>=o;o++)0!==(i&s)&&(r=e&s,a=16>t?r:16===t?mt(r,5,R):mt(r,8,R),Lt(a,Mt(a)+1)),i=u(i,t),e=u(e,t);return n}function Mt(e){return X[e&ut]}function Lt(e,t){return X[e&ut]=t}function sr(){return W?!1:34!==k&&41!==k?!1:32!==b?!1:T===K?!1:41===k?32===t?(Sr(),y=r,A=r+o,F=a,O=a+h,!0):16===t?(Fr(),y=r,A=r+o,F=a,O=a+h,!0):8===t?(yr(),y=r,A=r+o,F=a,O=a+h,!0):!1:8>t?!1:8===t&&0===(w&Y)?!1:(32===t&&yn(),16===t&&Sn(),8===t&&gn(),y=r,A=r+o,F=a,O=a+h,!0)}function Ai(){var t,i,r,s;if(wt){if(!_t&&!Rt())return null;r=_t,s=!1,t=e.fetchPointerofObject(nt,K),"number"==typeof t&&(t=t,r(t,y,F,A-y,O-F),n=M=0,s=!0),W||(i=e.fetchPointerofObject(nt,T),"number"==typeof i&&(i=i,s&&i===t||r(i,0,0,0,0),f=P=0)),wt=!1}}function nr(){var t;return t=W,W=!0,vi(),W=t,W||0>=o||0>=h?(y=A=F=O=0,null):Di()?(si(),rr(),J>0?(y=r,A=r+o):(y=r-o+1,A=r+1),dt>0?(F=a,O=a+h):(F=a-h+1,O=a+1),void Ai()):e.primitiveFail()}function rr(){var nt,et,f,tt,u,z,W,Y,it,K,y,J,V,$,Q,O,U,A,P,j,I,F,rt,T,v,M;if(it=s[k+1],!(E(g)>=at+12))return e.primitiveFail();if(u=Ot-1,0>=u&&(u=1),I=H(at,g),f=H(at+3,g),v=Ct(I,f,u),0>v&&(I=f-u*v),O=H(at+1,g),f=H(at+4,g),F=Ct(O,f,u),0>F&&(O=f-u*F),A=H(at+9,g),f=H(at+6,g),K=Ct(A,f,u),0>K&&(A=f-u*K),y=H(at+10,g),f=H(at+7,g),z=Ct(y,f,u),0>z&&(y=f-u*z),e.failed())return!1;if(2===e.methodArgumentCount())if(M=e.stackIntegerValue(1),P=e.stackValue(0),P.isNil){if(16>b)return e.primitiveFail()}else{if(E(P)<i(1,b))return e.primitiveFail();P=P.wordsOrBytes()}else M=1,P=e.nilObject();for(u=Z-1,0>=u&&(u=1),Y=c-(r&c-1),rt=(r+o-1&c-1)+1,Y>o&&(Y=o),x>D&&(I+=(x-D)*v,O+=(x-D)*F,A+=(x-D)*K,y+=(x-D)*z),Vn(),M>1&&0===(w&Ft)&&(X?ci(8,R):16===t&&ci(8,5)),nt=w&~Ft,q?(U=0-t,et=32-t):(U=t,et=0),J=1;h>=J;J++){j=Ct(I,A,u),p=j>=0?I:A-u*j,V=Ct(O,y,u),m=V>=0?O:y-u*V,G=q?32-((r&c-1)+1)*t:(r&c-1)*t,_>N&&(p+=(_-N)*j,m+=(_-N)*V),$=At?C:Gt(a+J-1),d=S,T=Y,f=B;do tt=1===M?tr(T,j,V,v,F,U,nt):ir(T,j,V,v,F,P,M,U),G=et,d===C?(Q=it(tt&$,n[l>>>2]),n[l>>>2]=d&Q):(W=n[l>>>2],Q=it(tt&$,W&d),W=d&Q|W&~d,n[l>>>2]=W),l+=4,2===f?(d=L,T=rt):(d=C,T=c);while(0!==--f);I+=v,O+=F,A+=K,y+=z,l+=Pt}}function Vn(){var e,t;for(zt=0,t=b;1!==t;)++zt,t>>>=1;for(Wi=j[b],gi=5-zt,ki=i(1,gi)-1,e=0;ki>=e;e++)Mi[e]=tt?32-i(e+1,zt):i(e,zt)}function ir(N,c,f,x,A,B,n,M){var P,y,F,q,l,C,I,V,h,e,g,o,S,u,O,s,a,r,d;V=j[t],y=0,2===n?(F=c>>1,l=f>>1,I=x>>1,h=A>>1):(F=v(c,n),l=v(f,n),I=v(x,n),h=v(A,n)),C=N;do{O=p,g=m,s=a=u=o=0,r=0,q=n;do{d=O,S=g,P=n;do e=fi(d,S),(25!==k||0!==e)&&(++r,e=16>b?B[e]:16===b?ui(e):kr(e),o+=255&e,u+=e>>>8&255,a+=e>>>16&255,s+=e>>>24),d+=F,S+=l;while(0!==--P);O+=I,g+=h}while(0!==--q);0===r||25===k&&n*n>>1>r?e=0:(4===r?(a>>>=2,u>>>=2,o>>>=2,s>>>=2):(a=v(a,r),u=v(u,r),o=v(o,r),s=v(s,r)),e=(s<<24)+(a<<16)+(u<<8)+o,0===e&&a+u+o+s>0&&(e=1),e=Dt(e,w)),y|=i(e&V,G),G+=M,p+=c,m+=f}while(0!==--C);return y}function tr(f,u,c,d,h,o,l){var n,a,r,s,e;if(s=j[t],e=0,a=f,l===(Y|ct)){do n=fi(p,m),r=X[n&ut],e|=i(r&s,G),G+=o,p+=u,m+=c;while(0!==--a)}else do n=fi(p,m),r=Dt(n,l),e|=i(r&s,G),G+=o,p+=u,m+=c;while(0!==--a);return e}var er=1,$i=11,C=4294967295,ei=3,Qi=13,Zi=12,Yi=10,Xi=11,Ji=14,Ui=0,pi=4,wi=5,Gi=2,zi=7,Ki=3,Ei=1,Ri=8,Br=9,at=15,Li=6,Nt=2,Fi=2,ct=4,Ft=8,Y=1,qi=16384,nt=0,mi=3,ti=2,hi=1,Tt=1,Hi=43,Et=0,O=0,y=0,A=0,F=0,h=0,o=0,g=0,$=0,jt=0,Vt=0,_=0,x=0,R=0,w=0,X=null,ut=0,ot=null,st=null,k=0,yi=0,$t=0,n=0,Pt=0,t=0,K=0,vt=0,l=0,q=0,d=0,c=0,M=0,ft=0,N=0,D=0,Zt=new Array(4096),Vi=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],ai=[0,2,4,6,8,12,14,16],li=[0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],G=0,r=0,a=0,pt=null,J=0,oi=0,lt=0,Bt=0,wt=0,Ot=0,e=null,Si=0,It=null,S=0,L=0,j=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],Yr="BitBltPlugin 3 November 2014 (e)",B=0,At=0,W=0,s=new Array(43),Kt=0,yt=null,V=0,gt=0,f=0,Jt=0,b=0,T=0,rt=0,I=0,tt=0,et=0,P=0,it=0,St=0,Yt=0,Wt=0,p=0,m=0,U=null,_t=null,dt=0,ki=0,gi=0,Mi=new Array(32),Wi=0,zt=0,Z=0;Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:jr,copyBits:qt,moduleUnloaded:Dr,primitiveDrawLoop:wr,primitiveDisplayString:Vr,initialiseModule:Gr,loadBitBltFrom:Ht,setInterpreter:cr,primitiveWarpBits:Pr,getModuleName:Hr,primitivePixelValueAt:Cr,copyBitsFromtoat:nn})}),module("users.bert.SqueakJS.plugins.FFTPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function g(e,t){return 0|Math.floor(e/t)}function v(t,e){return e>31?0:t<<e}function c(t){return e.success(e.isWords(t)),e.failed()?0:t.wordsAsFloat32Array()}function P(t){return e.success(e.isWords(t)),t.words}function A(){return k}function h(h){var o;return e.success(n(h)>=6),e.failed()?!1:(l=e.fetchIntegerofObject(0,h),r=e.fetchIntegerofObject(1,h),o=e.fetchPointerofObject(2,h),p=n(o),s=c(o),o=e.fetchPointerofObject(3,h),m=n(o),u=P(o),o=e.fetchPointerofObject(4,h),a=n(o),t=c(o),o=e.fetchPointerofObject(5,h),f=n(o),i=c(o),e.success(v(1,l)===r&&(r>>2)+1===p&&r===a&&r===f&&a===f),e.failed()===!1)}function o(){var r,n,l,s,o;for(s=0,l=m;l>s;){if(r=u[s]-1,n=u[s+1]-1,!(a>r&&a>n))return e.success(!1);o=t[r],t[r]=t[n],t[n]=o,o=i[r],i[r]=i[n],i[n]=o,s+=2}}function O(){var t;return t=e.stackObjectValue(0),h(t)?(o(),void(e.failed()&&o())):null}function F(){var t;return t=e.stackObjectValue(0),h(t)?void d():null}function y(){var t,i;return t=e.booleanValueOf(e.stackValue(0)),i=e.stackObjectValue(1),h(i)?(C(t),void(e.failed()||e.pop(1))):null}function d(){var e,n;if(1>=r)return null;for(n=1/r,e=0;r-1>=e;e++)t[e]=t[e]*n,i[e]=i[e]*n}function b(i){var t;return e=i,t=e.majorVersion()==S,t===!1?!1:t=e.minorVersion()>=I}function C(t){return o(),e.failed()?(o(),null):(w(t),void(t||d()))}function w(O){var S,F,m,u,n,y,a,e,c,d,k,h,b,f,o;for(F=r>>1,m=r>>2,h=1;l>=h;h++)for(d=v(1,h),k=d>>1,S=g(r,d),c=1;k>=c;c++)for(o=(c-1)*S,m>o?(f=s[p-o-1],a=s[o]):(f=0-s[o-m],a=s[F-o]),O||(a=0-a),u=c;r>=u;)e=u+k-1,n=u-1,b=t[e]*f-i[e]*a,y=t[e]*a+i[e]*f,t[e]=t[n]-b,i[e]=i[n]-y,t[n]=t[n]+b,i[n]=i[n]+y,u+=d}var S=1,I=11,r=0,i=null,f=0,e=null,k="FFTPlugin 3 November 2014 (e)",l=0,u=null,m=0,t=null,a=0,s=null,p=0;Squeak.registerExternalModule("FFTPlugin",{primitiveFFTTransformData:y,setInterpreter:b,primitiveFFTPermuteData:O,primitiveFFTScaleData:F,getModuleName:A})}),module("users.bert.SqueakJS.plugins.FloatArrayPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function f(){return S}function i(){var r,o,i,s,n,a;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(n)),e.failed())return null;if(s=t(r),e.success(s===t(n)),e.failed())return null;for(a=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)a[i]=a[i]+o[i];e.pop(1)}function r(){var i,s,r,n,a;if(a=e.stackFloatValue(0),r=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.failed())return null;for(s=t(r),n=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)n[i]=n[i]+a;e.pop(1)}function n(){var n,s,i,r;return i=e.stackIntegerValue(0),r=e.stackObjectValue(1),e.failed()?null:(e.success(e.isWords(r)),e.success(i>0&&i<=t(r)),e.failed()?null:(n=r.wordsAsFloat32Array(),s=n[i-1],e.pop(2),void e.pushFloat(s)))}function s(){var s,a,r,n,i;return i=e.stackValue(0),a="number"==typeof i?i:e.floatValueOf(i),r=e.stackIntegerValue(1),n=e.stackObjectValue(2),e.failed()?null:(e.success(e.isWords(n)),e.success(r>0&&r<=t(n)),e.failed()?null:(s=n.wordsAsFloat32Array(),s[r-1]=a,void(e.failed()||e.popthenPush(3,i))))}function a(){var r,a,i,n,s,o;if(r=e.stackObjectValue(0),s=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.failed())return null;if(n=t(r),e.success(n===t(s)),e.failed())return null;for(o=s.wordsAsFloat32Array(),a=r.wordsAsFloat32Array(),i=0;n-1>=i;i++)if(0===a[i])return e.primitiveFail();for(i=0;n-1>=i;i++)o[i]=o[i]/a[i];
e.pop(1)}function o(){var i,a,o,r,n,s;if(s=e.stackFloatValue(0),r=e.stackObjectValue(1),e.failed())return null;if(0===s)return e.primitiveFail();if(e.success(e.isWords(r)),e.failed())return null;for(o=t(r),n=r.wordsAsFloat32Array(),a=1/s,i=0;o-1>=i;i++)n[i]=n[i]*a;e.pop(1)}function u(){var r,o,i,s,n,u,a;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(n)),e.failed())return null;if(s=t(r),e.success(s===t(n)),e.failed())return null;for(u=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),a=0,i=0;s-1>=i;i++)a+=u[i]*o[i];e.pop(2),e.pushFloat(a)}function l(){var r,a,i,s,n,o;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(n)),e.failed())return null;if(e.pop(2),s=t(r),s!==t(n))return e.pushBool(!1);for(o=n.wordsAsFloat32Array(),a=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)if(o[i]!==a[i])return e.pushBool(!1);return e.pushBool(!0)}function c(){var i,s,r,a,n;if(r=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(r)),e.failed())return null;for(s=t(r),a=r.wordsAsInt32Array(),n=0,i=0;s-1>=i;i++)n+=a[i];return e.pop(1),e.pushInteger(536870911&n)}function F(){var i,a,n,s,r;if(n=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(n)),e.failed())return null;for(a=t(n),e.success(!0),s=n.wordsAsFloat32Array(),r=0,i=0;a-1>=i;i++)r+=s[i]*s[i];r=Math.sqrt(r),e.popthenPush(1,e.floatObjectOf(r))}function h(){var r,o,i,s,n,a;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(n)),e.failed())return null;if(s=t(r),e.success(s===t(n)),e.failed())return null;for(a=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)a[i]=a[i]*o[i];e.pop(1)}function p(){var i,s,r,n,a;if(a=e.stackFloatValue(0),r=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.failed())return null;for(s=t(r),n=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)n[i]=n[i]*a;e.pop(1)}function d(){var i,r,a,s,n;if(s=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(s)),e.failed())return null;for(a=t(s),e.success(!0),n=s.wordsAsFloat32Array(),r=0,i=0;a-1>=i;i++)r+=n[i]*n[i];if(e.success(r>0),e.failed())return null;for(r=Math.sqrt(r),i=0;a-1>=i;i++)n[i]=n[i]/r}function m(){var r,o,i,s,n,a;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(n)),e.failed())return null;if(s=t(r),e.success(s===t(n)),e.failed())return null;for(a=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)a[i]=a[i]-o[i];e.pop(1)}function v(){var i,s,r,n,a;if(a=e.stackFloatValue(0),r=e.stackObjectValue(1),e.failed())return null;if(e.success(e.isWords(r)),e.failed())return null;for(s=t(r),n=r.wordsAsFloat32Array(),i=0;s-1>=i;i++)n[i]=n[i]-a;e.pop(1)}function k(){var i,s,r,a,n;if(r=e.stackObjectValue(0),e.failed())return null;if(e.success(e.isWords(r)),e.failed())return null;for(s=t(r),a=r.wordsAsFloat32Array(),n=0,i=0;s-1>=i;i++)n+=a[i];e.popthenPush(1,e.floatObjectOf(n))}function b(i){var t;return e=i,t=e.majorVersion()==g,t===!1?!1:t=e.minorVersion()>=y}var g=1,y=11,e=null,S="FloatArrayPlugin 3 November 2014 (e)";Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:h,primitiveEqual:l,primitiveAtPut:s,primitiveAt:n,primitiveNormalize:d,primitiveSubFloatArray:m,primitiveDivFloatArray:a,primitiveAddScalar:r,primitiveDotProduct:u,primitiveSubScalar:v,setInterpreter:b,primitiveSum:k,getModuleName:f,primitiveHashArray:c,primitiveMulScalar:p,primitiveLength:F,primitiveAddFloatArray:i,primitiveDivScalar:o})}),module("users.bert.SqueakJS.plugins.GeniePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function i(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}function r(i,r){var n,s,e,a,o,t;return n=i[0],a=i[1],s=r[0],o=r[1],e=s-n,t=o-a,e*e+t*t}function d(t,i){var e;return e=Math.abs(i-t),e>180&&(e=360-e),e*e>>>6}function u(){return s}function a(){return 2}function o(){return 0}function n(e){console.log(s+": "+e)}function l(){var Z,H,K,o,A,V,w,O,Q,h,J,D,b,y,U,f,S,g,z,Y,u,l,N,I,s,a,p,F,X,E,m,v,$,B,c,k,C,P,T,L,R,x,W,j,G,M,_,q,et;if(C=e.stackValue(11),P=e.stackValue(10),T=e.stackValue(9),L=e.stackValue(8),R=e.stackValue(7),x=e.stackValue(6),W=e.stackValue(5),j=e.stackValue(4),G=e.stackIntegerValue(3),M=e.stackValue(2),_=e.stackValue(1),q=e.stackValue(0),e.failed())return null;if(e.failed())return n("failed 1"),null;if(e.success(e.isWords(C)&&e.isWords(P)&&e.isWords(T)&&e.isWords(L)&&e.isWords(R)&&e.isWords(x)&&e.isWords(W)&&e.isWords(j)&&e.isWords(M)&&e.isWords(_)&&e.isWords(q)),e.failed())return n("failed 2"),null;if(e.success(e.isMemberOf(C,"PointArray")&&e.isMemberOf(P,"PointArray")),e.failed())return n("failed 3"),null;if(b=C.wordsAsInt32Array(),g=P.wordsAsInt32Array(),Y=T.wordsAsInt32Array(),Q=L.wordsAsInt32Array(),U=R.wordsAsInt32Array(),J=x.wordsAsInt32Array(),$=W.wordsAsInt32Array(),Z=j.wordsAsInt32Array(),l=M.wordsAsInt32Array(),c=_.wordsAsInt32Array(),u=q.wordsAsInt32Array(),z=t(P)>>>1,F=t(T)>>>1,h=t(L)>>>1,H=t(x),D=t(M),e.success(D===t(_)&&D===t(q)&&D>h),e.failed())return n("failed 4"),null;if(e.success(t(R)>=F-1&&t(C)>>>1>=F&&H>=h-1&&z>=h&&t(W)>=F-1&&t(j)>=h-1),e.failed())return n("failed 5"),null;if(K=1&G,E=G>>>1,N=1<<29,f=K?0:E*E>>>10,l[0]=0,c[0]=0,u[0]=2,a=0-f,y=h,!(z>=y-1&&H>=y-1))return e.primitiveFail(),null;for(s=1;y>=s;s++)o=s-1,a=a+(J[o]+r(i(g,o<<1),b)>>>7)+f,c[s]=a,l[s]=a*s,u[s]=s+1;for(a=c[0]-f,p=1;F>=p;p++){for(A=p-1,I=A<<1,v=l[0],a=a+(U[A]+r(i(b,I),g)>>>7)+f,c[0]=a,l[0]=a*p,u[0]=p+1,y=h,s=1;y>=s;s++)o=s-1,V=o<<1,m=l[s],k=l[o],S=U[A]+r(i(b,I),i(g,s<<1))>>>7,0===(a=c[s])?m+=S:(m=m+a+S*u[s],S+=a),O=J[o]+r(i(g,V),i(b,p<<1))>>>7,0===(a=c[o])?k+=O:(k=k+a+O*u[o],O+=a),K?v=N:(X=(r(i(Q,V),i(Y,I))+r(i(g,V),i(b,I)))*(16+d(Z[o],$[A]))>>>11,v+=X),m>=v&&k>=v?(w=v,a=0,B=1):k>=m?(w=m,a=S+f,B=u[s]+1):(w=k,a=O+f,B=u[o]+1),v=l[s],l[s]=Math.min(w,N),c[s]=Math.min(a,N),u[s]=B;a=c[0]}return et=w,e.failed()?null:(e.popthenPush(13,et),null)}function c(){var t;return t=1e3*a()+o(),e.failed()?null:(e.popthenPush(1,t),null)}function f(i){var t;return e=i,t=e.majorVersion()==h,t===!1?!1:t=e.minorVersion()>=p}var h=1,p=11,e=null,s="GeniePlugin v2.0 14 November 2014 (e)";Squeak.registerExternalModule("GeniePlugin",{primVersionNO:c,setInterpreter:f,primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:l,getModuleName:u})}),module("users.bert.SqueakJS.plugins.JPEGReaderPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function n(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function ut(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function v(e,t){return 0|Math.floor(e/t)}function V(t,e){return e>31?0:t<<e}function ft(t,e){return e>31?0:t>>>e}function ht(e){return P(u,e)&&w(rt,e)}function P(i,t){return"number"==typeof t?!1:e.isPointers(t)?n(t)<U?!1:(i[s]=e.fetchIntegerofObject(s,t),i[o]=e.fetchIntegerofObject(o,t),i[g]=e.fetchIntegerofObject(g,t),i[F]=e.fetchIntegerofObject(F,t),i[y]=e.fetchIntegerofObject(y,t),i[b]=e.fetchIntegerofObject(b,t),i[k]=e.fetchIntegerofObject(k,t),!e.failed()):!1}function w(o,s){var t,i,r,a;if("number"==typeof s)return!1;if(!e.isPointers(s))return!1;if(n(s)<U)return!1;if(t=e.fetchPointerofObject(st,s),"number"==typeof t)return!1;if(!e.isPointers(t))return!1;if(a=n(t),a>gt)return!1;for(r=0;a-1>=r;r++){if(i=e.fetchPointerofObject(r,t),"number"==typeof i)return!1;if(!e.isWords(i))return!1;if(n(i)!==d)return!1;o[r]=i.wordsAsInt32Array()}return!e.failed()}function qt(){var t,e;for(i[s]=0,i[o]=0,t=0;I-1>=t;t++)e=q(),e+=p[A],e=Math.min(e,r),p[A]=e&h,e&=r-h,e=Math.max(e,1),O[t]=4278190080+(e<<16)+(e<<8)+e}function xt(){var e,l,c,t,d,n,m;for(i[s]=0,i[o]=0,u[s]=0,u[o]=0,a[s]=0,a[o]=0,d=0;I-1>=d;d++)m=q(),l=Ft(),l-=f,c=St(),c-=f,n=m+(ot*c>>16)+p[E],n=Math.min(n,r),n=Math.max(n,0),p[E]=n&h,n&=r-h,n=Math.max(n,1),t=m-(ct*l>>16)-(lt*c>>16)+p[A],t=Math.min(t,r),t=Math.max(t,0),p[A]=t&h,t&=r-h,t=Math.max(t,1),e=m+(at*l>>16)+p[M],e=Math.min(e,r),e=Math.max(e,0),p[M]=e&h,e&=r-h,e=Math.max(e,1),O[d]=4278190080+(n<<16)+(t<<8)+e}function Vt(e){return P(a,e)&&w(J,e)}function wt(a,o){var r,t,n,i,s;if(t=et(W,_),0>t)return e.primitiveFail();for(0!==t&&(r=C(t),t=z(r,t)),t=o[k]=o[k]+t,a[0]=t,n=1;d-1>=n;n++)a[n]=0;for(i=1;d>i;){if(t=et(B,x),0>t)return e.primitiveFail();if(s=t>>>4,t=15&t,0!==t){if(i+=s,r=C(t),t=z(r,t),0>i||i>=d)return e.primitiveFail();a[It[i]]=t}else{if(15!==s)return null;i+=s}++i}}function Ct(){for(var e;16>=l;){if(!(S>c))return l;if(e=j[c],++c,255===e){if(!(S>c&&0===j[c]))return--c,l;++c}m=m<<8|e,l+=8}return l}function C(e){var t;return e>l&&(Ct(),e>l)?-1:(l-=e,t=ft(m,l),m&=V(1,l)-1,t)}function Pt(){return jt}function At(c,v){var O,A,e,I,F,a,o,k,g,b,y,s,n,i,p,h,u,m,S,l=new Array(64);for(e=0;t-1>=e;e++){for(O=-1,F=1;t-1>=F;F++)-1===O&&0!==c[F*t+e]&&(O=F);if(-1===O)for(A=c[e]*v[0]<<2,I=0;t-1>=I;I++)l[I*t+e]=A;else h=c[2*t+e]*v[2*t+e],u=c[6*t+e]*v[6*t+e],p=(h+u)*R,s=p+u*(0-X),n=p+h*K,h=c[e]*v[e],u=c[4*t+e]*v[4*t+e],a=h+u<<13,o=h-u<<13,k=a+n,y=a-n,g=o+s,b=o-s,a=c[7*t+e]*v[7*t+e],o=c[5*t+e]*v[5*t+e],s=c[3*t+e]*v[3*t+e],n=c[t+e]*v[t+e],p=a+n,h=o+s,u=a+s,m=o+n,S=(u+m)*G,a*=D,o*=Z,s*=$,n*=nt,p*=0-T,h*=0-Q,u*=0-Y,m*=0-L,u+=S,m+=S,a=a+p+u,o=o+h+m,s=s+h+u,n=n+p+m,l[e]=k+n>>11,l[7*t+e]=k-n>>11,l[1*t+e]=g+s>>11,l[6*t+e]=g-s>>11,l[2*t+e]=b+o>>11,l[5*t+e]=b-o>>11,l[3*t+e]=y+a>>11,l[4*t+e]=y-a>>11}for(e=0;d-t>=e;e+=t)h=l[e+2],u=l[e+6],p=(h+u)*R,s=p+u*(0-X),n=p+h*K,a=l[e]+l[e+4]<<13,o=l[e]-l[e+4]<<13,k=a+n,y=a-n,g=o+s,b=o-s,a=l[e+7],o=l[e+5],s=l[e+3],n=l[e+1],p=a+n,h=o+s,u=a+s,m=o+n,S=(u+m)*G,a*=D,o*=Z,s*=$,n*=nt,p*=0-T,h*=0-Q,u*=0-Y,m*=0-L,u+=S,m+=S,a=a+p+u,o=o+h+m,s=s+h+u,n=n+p+m,i=(k+n>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e]=i,i=(k-n>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+7]=i,i=(g+s>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+1]=i,i=(g-s>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+6]=i,i=(b+o>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+2]=i,i=(b-o>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+5]=i,i=(y+a>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+3]=i,i=(y-a>>18)+f,i=Math.min(i,r),i=Math.max(i,0),c[e+4]=i}function et(s,a){var i,e,r,n,t;if(e=s[0]>>>24,e>it)return-1;for(n=2;;){if(i=C(e),0>i)return-1;if(r=n+i-1,r>=a)return-1;if(t=s[r],0===(1056964608&t))return t;if(n=65535&t,e=t>>>24&255,e>it)return-1}return-1}function Ot(t){var i,r;return n(t)<5?!1:e.isPointers(t)?(i=e.fetchPointerofObject(0,t),"number"==typeof i?!1:e.isBytes(i)?(j=i.bytes,r=ut(i),c=e.fetchIntegerofObject(1,t),S=e.fetchIntegerofObject(2,t),m=e.fetchIntegerofObject(3,t),l=e.fetchIntegerofObject(4,t),e.failed()?!1:S>r?!1:0>c||c>=S?!1:!0):!1):!1}function Ft(){var a,i,e,t,l,c,r,n;return e=i=u[s],t=u[o],r=u[g],n=u[F],0!==r&&0!==n&&(e=v(e,r),t=v(t,n)),a=(t>>>3)*u[y]+(e>>>3),c=((7&t)<<3)+(7&e),l=rt[a][c],++i,i<8*u[b]?u[s]=i:(u[s]=0,u[o]++),l}function St(){var u,i,e,t,l,c,r,n;return e=i=a[s],t=a[o],r=a[g],n=a[F],0!==r&&0!==n&&(e=v(e,r),t=v(t,n)),u=(t>>>3)*a[y]+(e>>>3),c=((7&t)<<3)+(7&e),l=J[u][c],++i,i<8*a[b]?a[s]=i:(a[s]=0,a[o]++),l}function q(){var u,r,e,t,l,c,n,a;return e=r=i[s],t=i[o],n=i[g],a=i[F],0!==n&&0!==a&&(e=v(e,n),t=v(t,a)),u=(t>>>3)*i[y]+(e>>>3),c=((7&t)<<3)+(7&e),l=N[u][c],++r,r<8*i[b]?i[s]=r:(i[s]=0,i[o]++),l}function yt(){var t;return H(),4!==e.methodArgumentCount()?e.primitiveFail():(h=e.stackIntegerValue(0),t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)&&3===n(t)?(p=t.wordsAsInt32Array(),t=e.stackObjectValue(2),e.failed()?null:e.isWords(t)?(I=n(t),O=t.wordsAsInt32Array(),t=e.stackObjectValue(3),e.failed()?null:tt(t)?(qt(),void e.pop(4)):e.primitiveFail()):e.primitiveFail()):e.primitiveFail())}function Mt(){var t;return H(),4!==e.methodArgumentCount()?e.primitiveFail():(h=e.stackIntegerValue(0),t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)&&3===n(t)?(p=t.wordsAsInt32Array(),t=e.stackObjectValue(2),e.failed()?null:e.isWords(t)?(I=n(t),O=t.wordsAsInt32Array(),t=e.stackObjectValue(3),e.failed()?null:e.isPointers(t)&&3===n(t)&&tt(e.fetchPointerofObject(0,t))&&ht(e.fetchPointerofObject(1,t))&&Vt(e.fetchPointerofObject(2,t))?(xt(),void e.pop(4)):e.primitiveFail()):e.primitiveFail()):e.primitiveFail())}function bt(){var s,t,r;return 5!==e.methodArgumentCount()?e.primitiveFail():(r=e.stackObjectValue(0),e.failed()?null:Ot(r)?(t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)?(x=n(t),B=t.wordsAsInt32Array(),t=e.stackObjectValue(2),e.failed()?null:e.isWords(t)?(_=n(t),W=t.wordsAsInt32Array(),r=e.stackObjectValue(3),e.failed()?null:P(i,r)?(t=e.stackObjectValue(4),e.failed()?null:e.isWords(t)?n(t)!==d?e.primitiveFail():(s=t.wordsAsInt32Array(),e.failed()?null:(wt(s,i),e.failed()?null:(mt(e.stackValue(0)),e.storeIntegerofObjectwithValue(k,e.stackValue(3),i[k]),void e.pop(5)))):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()):e.primitiveFail())}function kt(){var i,t,r;return 2!==e.methodArgumentCount()?e.primitiveFail():(t=e.stackObjectValue(0),e.failed()?null:e.isWords(t)&&n(t)===d?(r=t.wordsAsInt32Array(),t=e.stackObjectValue(1),e.failed()?null:e.isWords(t)&&n(t)===d?(i=t.wordsAsInt32Array(),At(i,r),void e.pop(2)):e.primitiveFail()):e.primitiveFail())}function z(e,t){return e<V(1,t-1)?e-V(1,t)+1:e}function vt(i){var t;return e=i,t=e.majorVersion()==dt,t===!1?!1:t=e.minorVersion()>=pt}function H(){}function mt(t){e.storeIntegerofObjectwithValue(1,t,c),e.storeIntegerofObjectwithValue(3,t,m),e.storeIntegerofObjectwithValue(4,t,l)}function tt(e){return P(i,e)&&w(N,e)}var dt=1,pt=11,y=5,M=2,s=0,o=1,t=8,d=64,D=2446,ct=22554,L=3196,R=4433,lt=46802,K=6270,T=7373,G=9633,ot=91881,nt=12299,at=116130,X=15137,Y=16069,Z=16819,Q=20995,$=25172,A=1,g=2,st=4,b=8,it=16,gt=128,r=255,U=11,k=10,E=0,f=127,F=3,B=null,x=0,rt=new Array(128),u=new Array(11),J=new Array(128),a=new Array(11),W=null,_=0,h=0,e=null,O=null,I=0,It=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],m=0,l=0,j=null,c=0,S=0,jt="JPEGReaderPlugin 3 November 2014 (e)",p=null,N=new Array(128),i=new Array(11);Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:vt,primitiveIdctInt:kt,primitiveColorConvertMCU:Mt,primitiveColorConvertGrayscaleMCU:yt,primitiveDecodeMCU:bt,getModuleName:Pt})}),module("users.bert.SqueakJS.plugins.KedamaPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function a(e,t){return 0|Math.floor(e/t)}function h(e,t){return e-a(e,t)*t|0}function rt(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function c(t,i){var r,e;return 0===t?i>=0?90:270:(r=i/t,e=Math.atan(r),t>=0?i>=0?e/.0174532925199433:360+e/.0174532925199433:180+e/.0174532925199433)}function o(i){var e,r,t;return e=90-i,t=e/360|0,0>e&&--t,r=.0174532925199433*(e-360*t)}function it(){var d,v,o,p,h,s,a,i,r,g,k,l,c,m,n,f,b,u;if(l=e.stackValue(0),o=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),h=e.stackIntegerValue(4),a=e.stackIntegerValue(5),s=e.stackValue(6),e.failed())return null;if(!e.isWords(s))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isBytes(l))return e.primitiveFail(),null;if(h*a!==t(s))return e.primitiveFail(),null;if(r=t(n),t(u)!==r)return e.primitiveFail(),null;if(t(o)!==r)return e.primitiveFail(),null;if(t(l)!==r)return e.primitiveFail(),null;for(m=n.wordsAsFloat32Array(),b=u.wordsAsFloat32Array(),v=o.words,k=l.bytes,p=s.words,i=0;r-1>=i;i++)c=0|m[i],f=0|b[i],g=k[i],0!==g&&c>=0&&f>=0&&a>c&&h>f&&(d=f*a+c,p[d]=v[i]);return e.failed()?null:void e.pop(7)}function tt(){var i,o,n,r,u,s,a;if(s=e.stackValue(0),n=e.stackValue(1),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(a=t(n),t(s)!==a)return e.primitiveFail(),null;for(o=n.wordsAsFloat32Array(),u=s.wordsAsFloat32Array(),r=0;a-1>=r;r++)i=o[r],i/=.0174532925199433,i=90-i,i>0||(i+=360),u[r]=i;return e.failed()?null:void e.pop(2)}function $(){return et}function Q(){var i,s,r,n;return r=e.stackValue(0),n=e.stackIntegerValue(1),e.failed()?null:e.isWords(r)?t(r)<n?(e.primitiveFail(),null):(s=r.wordsAsFloat32Array(),i=s[n-1],i=p(i),e.failed()?null:(e.pop(3),void e.pushFloat(i))):(e.primitiveFail(),null)}function D(){i=17,r=16807,u=2147483647,l=a(u,r),d=h(u,r)}function f(e){var n,s,o,u,t;return o=0>e?0-e:e,n=a(i,l),s=h(i,l),i=r*s-d*n,u=65535&i,t=u*(o+1)>>>16,0>e?0-t:t}function m(){var t;return t=e.stackIntegerValue(0),e.failed()?null:(i=65536&t,void e.pop(1))}function x(){var i,c,u,s,a,l,r,f,o,h,p,n;if(n=e.stackIntegerValue(0),p=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(a=t(s),h=t(o),a!==h)return e.primitiveFail(),null;if(-32>n)return e.primitiveFail(),null;if(n>8)return e.primitiveFail(),null;for(c=s.words,f=o.words,l=4278190080,r=0;a-1>=r;r++)u=c[r],i=rt(u,n),i>255&&(i=255),0>i&&(i=0),f[r]=i<<24&l|p;e.pop(4)}function V(){var r,l,n,s,a,c,i,v,o,f,h,p,d,m,u;if(m=e.stackValue(0),u=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(p=m.words,h=p[0],e.failed())return null;if(d=Math.log(h),a=t(s),f=t(o),a!==f)return e.primitiveFail(),null;for(l=s.words,v=o.words,c=4278190080,i=0;a-1>=i;i++)n=l[i],r=0===n?0:255/d*Math.log(n)|0,r>255&&(r=255),v[i]=r<<24&c|u;e.pop(4)}function v(){var u,i,f,s,a,o,h,n,r,p,d,l,m,v,c;if(u=e.stackIntegerValue(0),r=e.stackIntegerValue(1),c=e.stackValue(2),l=e.stackValue(3),n=e.stackValue(4),a=e.stackValue(5),!e.isWords(c))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(a))return e.primitiveFail(),null;if(o=t(n),t(l)!==o)return e.primitiveFail(),null;if(t(c)!==o)return e.primitiveFail(),null;if(t(a)!==u*r)return e.primitiveFail(),null;for(d=l.wordsAsFloat32Array(),v=c.wordsAsFloat32Array(),h=n.words,f=a.words,i=0;u*r-1>=i;i++)f[i]=0;for(i=0;o-1>=i;i++)p=d[i],m=v[i],s=r*m+p,s>=0&&u*r>s&&(f[s]=h[i]);return e.failed()?null:void e.pop(6)}function W(){var u,i,a,l,o,r,n,c,s,f;return a=e.stackIntegerValue(0),r=e.stackIntegerValue(1),f=e.stackFloatValue(2),c=e.stackFloatValue(3),i=e.stackValue(4),e.failed()?null:e.isWords(i)?t(i)!==a*r?(e.primitiveFail(),null):(n=0|c,s=0|f,u=i.words,n>=0&&r>n&&s>=0&&a>s?(l=s*r+n,o=u[l]):o=0,e.failed()?null:(e.pop(6),void e.pushInteger(o))):(e.primitiveFail(),null)}function k(){var f,r,o,l,i,u,n,s,c,a,h;return o=e.stackIntegerValue(0),n=e.stackIntegerValue(1),u=e.stackIntegerValue(2),h=e.stackFloatValue(3),c=e.stackFloatValue(4),r=e.stackValue(5),e.failed()?null:e.isWords(r)?t(r)!==o*n?(e.primitiveFail(),null):(s=0|c,a=0|h,i=u,i>1073741823&&(i=1073741823),0>i&&(i=0),f=r.words,s>=0&&n>s&&a>=0&&o>a&&(l=a*n+s,f[l]=i),e.failed()?null:void e.pop(6)):(e.primitiveFail(),null)}function b(){var v,f,d,s,a,p,u,i,c,l,h,o,n,m,r;if(u=e.stackValue(0),f=e.stackIntegerValue(1),a=e.stackIntegerValue(2),s=e.stackValue(3),r=e.stackValue(4),o=e.stackValue(5),e.failed())return null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(r))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(f*a!==t(s))return e.primitiveFail(),null;if(c=t(o),t(r)!==c)return e.primitiveFail(),null;if(t(u)!==c)return e.primitiveFail(),null;for(h=o.wordsAsFloat32Array(),m=r.wordsAsFloat32Array(),p=u.words,v=s.words,i=0;c-1>=i;i++)l=0|h[i],n=0|m[i],l>=0&&n>=0&&a>l&&f>n&&(d=n*a+l,p[i]=v[d]);return e.failed()?null:void e.pop(6)}function g(){var v,p,g,l,r,o,i,y,S,F,d,m,c,k,b,f,u,h,a;return v=e.stackIntegerValue(0),k=e.stackIntegerValue(1),m=e.stackIntegerValue(2),S=e.stackIntegerValue(3),p=e.stackFloatValue(4),g=e.stackFloatValue(5),b=e.stackFloatValue(6),o=e.stackValue(7),a=e.stackValue(8),u=e.stackValue(9),y=e.stackIntegerValue(10),e.failed()?null:e.isWords(u)&&e.isWords(a)&&e.isWords(o)?(c=t(u),t(a)!==c?(e.primitiveFail(),null):t(o)!==c?(e.primitiveFail(),null):(f=u.wordsAsFloat32Array(),h=a.wordsAsFloat32Array(),r=o.wordsAsFloat32Array(),l=b,i=y-1,F=f[i]+l*Math.cos(r[i]),d=h[i]-l*Math.sin(r[i]),s(i,f,r,F,g,S,m),n(i,h,r,d,p,k,v),e.failed()?null:void e.pop(11))):(e.primitiveFail(),null)}function y(){var g,p,k,o,u,i,v,r,c,h,n,d,f,m,l,a,b,s;if(n=e.stackValue(0),p=e.stackIntegerValue(1),u=e.stackIntegerValue(2),o=e.stackValue(3),s=e.stackValue(4),l=e.stackValue(5),e.failed())return null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(p*u!==t(o))return e.primitiveFail(),null;if(c=t(l),t(s)!==c)return e.primitiveFail(),null;if(r="number"==typeof n,r&&(v=n),!r){if(!e.isMemberOf(n,"WordArray"))return e.primitiveFail(),null;if(t(n)!==c)return e.primitiveFail(),null}for(m=l.wordsAsFloat32Array(),b=s.wordsAsFloat32Array(),r||(d=n.words),g=o.words,r&&(h=v),i=0;c-1>=i;i++)f=0|m[i],a=0|b[i],f>=0&&a>=0&&u>f&&p>a&&(k=a*u+f,r||(h=d[i]),g[k]=h);return e.failed()?null:void e.pop(6)}function S(){var y,O,v,p,o,c,i,a,S,F,I,m,u,k,b,g,r,h,l,d,f;if(y=e.stackIntegerValue(0),k=e.stackIntegerValue(1),m=e.stackIntegerValue(2),S=e.stackIntegerValue(3),O=e.stackFloatValue(4),v=e.stackFloatValue(5),r=e.stackValue(6),c=e.stackValue(7),f=e.stackValue(8),l=e.stackValue(9),e.failed())return null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(c))return e.primitiveFail(),null;if(r.isFloat)a=!1;else{if(!e.isWords(r))return e.primitiveFail(),null;a=!0}if(u=t(l),t(f)!==u)return e.primitiveFail(),null;if(t(c)!==u)return e.primitiveFail(),null;if(a&&t(r)!==u)return e.primitiveFail(),null;for(h=l.wordsAsFloat32Array(),d=f.wordsAsFloat32Array(),o=c.wordsAsFloat32Array(),a?g=r.wordsAsFloat32Array():b=e.floatValueOf(r),i=0;u-1>=i;i++)p=a?g[i]:b,F=h[i]+p*Math.cos(o[i]),I=d[i]-p*Math.sin(o[i]),s(i,h,o,F,v,S,m),n(i,d,o,I,O,k,y);return e.failed()?null:void e.pop(10)}function F(){var m,f,I,O,u,d,l,F,S,y,o,A,v,k,b,g,h,r,i,n,a,s;if(o=e.stackIntegerValue(0),u=e.stackIntegerValue(1),n=e.stackIntegerValue(2),f=e.stackValue(3),k=e.stackFloatValue(4),g=e.stackFloatValue(5),b=e.stackFloatValue(6),e.failed())return null;if(!e.isWords(f))return e.primitiveFail(),null;if(t(f)!==u*n)return e.primitiveFail(),null;for(m=f.words,r=b,i=g,r=Math.max(r,0),i=Math.max(i,0),r=Math.min(r,n-1),i=Math.min(i,u-1),A=Math.max(r-o,0),I=Math.min(r+o,n-1),v=Math.max(i-o,0),O=Math.min(i+o,u-1),d=m[i*n+r],l=-1,s=v;O>=s;s++)for(y=s*n,a=A;I>=a;a++)h=m[y+a],h>d&&(l=a,F=s,d=h);return S=-1===l?p(k):c(l-r,F-i)+90|0,e.failed()?null:(e.pop(8),void e.pushFloat(S))}function O(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]+f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]+h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]+f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]+h[i];e.pop(4),e.push(r)}function I(){var s,u,f,a,i,h,c,p,o,n,r,l,d;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(o=t(n),e.success(o===t(r)),e.failed())return null;if(c="number"==typeof s,p=e.isMemberOf(n,"WordArray"),c&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(c)for(l=n.words,h=s,d=r.words,i=0;o-1>=i;i++)d[i]=l[i]+h;else for(l=n.words,u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=l[i]+u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]+h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]+u;e.pop(4),e.push(r)}function A(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]/f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]/h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]/f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]/h[i];e.pop(4),e.push(r)}function P(){var s,l,h,o,i,p,f,d,u,n,r,c,m;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(u=t(n),e.success(u===t(r)),e.failed())return null;if(f="number"==typeof s,d=e.isMemberOf(n,"WordArray"),f&&d){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(f)for(c=n.words,p=s,m=r.words,i=0;u-1>=i;i++)m[i]=a(c[i],p);else for(c=n.words,l=e.floatValueOf(s),o=r.wordsAsFloat32Array(),i=0;u-1>=i;i++)o[i]=c[i]/l;else if(f)for(h=n.wordsAsFloat32Array(),p=s,o=r.wordsAsFloat32Array(),i=0;u-1>=i;i++)o[i]=h[i]/p;else for(h=n.wordsAsFloat32Array(),l=e.floatValueOf(s),o=r.wordsAsFloat32Array(),i=0;u-1>=i;i++)o[i]=h[i]/l;e.pop(4),e.push(r)}function C(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]*f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]*h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]*f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]*h[i];e.pop(4),e.push(r)}function w(){var s,u,f,a,i,h,c,p,o,n,r,l,d;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(o=t(n),e.success(o===t(r)),e.failed())return null;if(c="number"==typeof s,p=e.isMemberOf(n,"WordArray"),c&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(c)for(l=n.words,h=s,d=r.words,i=0;o-1>=i;i++)d[i]=l[i]*h;else for(l=n.words,u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=l[i]*u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]*h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]*u;e.pop(4),e.push(r)}function nt(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]-f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]-h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]-f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]-h[i];e.pop(4),e.push(r)}function j(){var s,u,f,a,i,h,c,p,o,n,r,l,d;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(o=t(n),e.success(o===t(r)),e.failed())return null;if(c="number"==typeof s,p=e.isMemberOf(n,"WordArray"),c&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(c)for(l=n.words,h=s,d=r.words,i=0;o-1>=i;i++)d[i]=l[i]-h;else for(l=n.words,u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=l[i]-u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]-h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]-u;e.pop(4),e.push(r)}function p(i){var e,t;return t=i/.0174532925199433,e=90-t,e>0||(e+=360),e}function q(){var a,o,i,r,n,u,l,s;if(a=e.stackFloatValue(0),i=e.stackValue(1),s=e.stackIntegerValue(2),r=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(i))return e.primitiveFail(),null;if(l=t(i),!(l>=s&&r>=1&&s>=r))return e.primitiveFail(),null;if(o=i.wordsAsFloat32Array(),e.failed())return null;for(n=r;s>=n;n++)o[n-1]=f(u)*a;e.pop(5)}function M(){var a,i,r,o,n,u,l,s;if(a=e.stackFloatValue(0),n=e.stackValue(1),s=e.stackIntegerValue(2),i=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(l=t(n),!(l>=s&&i>=1&&s>=i))return e.primitiveFail(),null;if(o=n.words,e.failed())return null;for(r=i;s>=r;r++)o[r-1]=f(u)*a|0;e.pop(5)}function B(){var t,i;return t=e.stackIntegerValue(0),e.failed()?null:(i=f(t),e.failed()?null:(e.pop(2),void e.pushInteger(i)))}function N(){var i,r,t,n,s,a,o;return r=e.stackFloatValue(0),i=e.stackFloatValue(1),s=e.stackFloatValue(2),n=e.stackFloatValue(3),e.failed()?null:(a=n-i,o=s-r,t=c(a,o),t+=90,t>360&&(t-=360),e.failed()?null:(e.pop(5),void e.pushFloat(t)))}function _(){var r,n,s,a,o,t,i;return n=e.stackFloatValue(0),r=e.stackFloatValue(1),o=e.stackFloatValue(2),a=e.stackFloatValue(3),e.failed()?null:(t=r-a,i=n-o,s=Math.sqrt(t*t+i*i),e.failed()?null:(e.pop(5),void e.pushFloat(s)))}function s(r,o,n,u,i,s,a){var t,e;e=u,0>e&&(1===s&&(e+=i),2===s&&(e=0),3===s&&(e=0-e,t=n[r],n[r]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),e>=i&&(1===a&&(e-=i),2===a&&(e=i-1e-6),3===a&&(e=i-1e-6-(e-i),t=n[r],n[r]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),o[r]=e}function n(i,a,r,o,t,n,s){var e;e=o,0>e&&(1===n&&(e+=t),2===n&&(e=0),3===n&&(e=0-e,r[i]=6.283185307179586-r[i])),e>=t&&(1===s&&(e-=t),2===s&&(e=t-1e-6),3===s&&(e=t-1e-6-(e-t),r[i]=6.283185307179586-r[i])),a[i]=e}function T(){var i,l,s,n,a,c,r,u;if(r=e.stackValue(0),s=e.stackValue(1),e.failed())return null;
if(!e.isWords(s))return e.primitiveFail(),null;if(u=t(s),r.isFloat)a=!1;else{if(!e.isWords(r))return e.primitiveFail(),null;if(t(r)!==u)return e.primitiveFail(),null;a=!0}for(l=s.wordsAsFloat32Array(),a?c=r.wordsAsFloat32Array():(i=e.floatValueOf(r),i=o(i)),n=0;u-1>=n;n++)a&&(i=c[n],i=o(i)),l[n]=i;return e.failed()?null:void e.pop(2)}function L(i){var t;return e=i,t=e.majorVersion()==Y,t===!1?!1:t=e.minorVersion()>=Z}function R(){var n,s,i,r;return n=e.stackFloatValue(0),i=e.stackValue(1),r=e.stackIntegerValue(2),e.failed()?null:e.isWords(i)?t(i)<r?(e.primitiveFail(),null):(s=i.wordsAsFloat32Array(),s[r-1]=o(n),e.failed()?null:void e.pop(3)):(e.primitiveFail(),null)}function E(){return!0}function K(){var n,a,i,o,u,l,c,f,h,r;return u=e.stackIntegerValue(0),o=e.stackIntegerValue(1),n=e.stackFloatValue(2),c=e.stackFloatValue(3),i=e.stackValue(4),h=e.stackIntegerValue(5),r=e.stackValue(6),e.failed()?null:e.isWords(r)&&e.isWords(i)?(l=t(r),t(i)!==l?(e.primitiveFail(),null):(f=r.wordsAsFloat32Array(),a=i.wordsAsFloat32Array(),s(h-1,f,a,c,n,o,u),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function z(){var s,a,o,i,u,l,c,f,h,r;return s=e.stackIntegerValue(0),l=e.stackIntegerValue(1),a=e.stackFloatValue(2),c=e.stackFloatValue(3),i=e.stackValue(4),h=e.stackIntegerValue(5),r=e.stackValue(6),e.failed()?null:e.isWords(r)&&e.isWords(i)?(u=t(r),t(i)!==u?(e.primitiveFail(),null):(f=r.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),n(h-1,f,o,c,a,l,s),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function G(){var f,c,o,r,n,d,l,v,u,h,p,i,m,a;if(v=e.stackIntegerValue(0),d=e.stackIntegerValue(1),f=e.stackFloatValue(2),i=e.stackValue(3),o=e.stackValue(4),a=e.stackValue(5),e.failed())return null;if(!e.isWords(a))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(i.isFloat)n=!1;else{if(!e.isWords(i))return e.primitiveFail(),null;n=!0}if(u=t(a),t(o)!==u)return e.primitiveFail(),null;if(n&&t(i)!==u)return e.primitiveFail(),null;for(m=a.wordsAsFloat32Array(),c=o.wordsAsFloat32Array(),n?p=i.wordsAsFloat32Array():h=e.floatValueOf(i),r=0;u-1>=r;r++)l=n?p[r]:h,s(r,m,c,l,f,d,v);return e.failed()?null:void e.pop(6)}function U(){var v,c,d,u,r,s,l,a,f,h,p,i,m,o;if(v=e.stackIntegerValue(0),f=e.stackIntegerValue(1),c=e.stackFloatValue(2),i=e.stackValue(3),u=e.stackValue(4),o=e.stackValue(5),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(i.isFloat)s=!1;else{if(!e.isWords(i))return e.primitiveFail(),null;s=!0}if(a=t(o),t(u)!==a)return e.primitiveFail(),null;if(s&&t(i)!==a)return e.primitiveFail(),null;for(m=o.wordsAsFloat32Array(),d=u.wordsAsFloat32Array(),s?p=i.wordsAsFloat32Array():h=e.floatValueOf(i),r=0;a-1>=r;r++)l=s?p[r]:h,n(r,m,d,l,c,f,v);return e.failed()?null:void e.pop(6)}function J(){var i,s,k,a,d,n,p,h,u,y,o,r,m,v,f,b,g,l;if(o=e.stackValue(0),l=e.stackValue(1),f=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(r=t(o),0>r)return e.primitiveFail(),null;if(t(f)!==r)return e.primitiveFail(),null;if(t(l)!==r)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==r)return e.primitiveFail(),null;if(t(n)!==r)return e.primitiveFail(),null}for(y=o.wordsAsFloat32Array(),v=f.wordsAsFloat32Array(),g=l.wordsAsFloat32Array(),s&&(k=a.wordsAsFloat32Array(),d=n.wordsAsFloat32Array()),s||(p=e.floatValueOf(a),h=e.floatValueOf(n)),i=0;r-1>=i;i++)s&&(p=k[i],h=d[i]),m=p-v[i],b=h-g[i],u=c(m,b),u+=90,u>360&&(u-=360),y[i]=u;return e.failed()?null:(e.pop(6),void e.push(o))}function H(){var i,s,v,a,d,n,f,c,b,o,r,h,m,u,p,k,l;if(o=e.stackValue(0),l=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(r=t(o),0>r)return e.primitiveFail(),null;if(t(u)!==r)return e.primitiveFail(),null;if(t(l)!==r)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==r)return e.primitiveFail(),null;if(t(n)!==r)return e.primitiveFail(),null}for(b=o.wordsAsFloat32Array(),m=u.wordsAsFloat32Array(),k=l.wordsAsFloat32Array(),s&&(v=a.wordsAsFloat32Array(),d=n.wordsAsFloat32Array()),s||(f=e.floatValueOf(a),c=e.floatValueOf(n)),i=0;r-1>=i;i++)s&&(f=v[i],c=d[i]),h=f-m[i],p=c-k[i],b[i]=Math.sqrt(h*h+p*p);return e.failed()?null:(e.pop(6),void e.push(o))}function X(){var g,v,h,p,b,o,u,k,r,s,i,n,d,m,f,l,a,c;if(c=e.stackIntegerValue(0),l=e.stackIntegerValue(1),u=e.stackIntegerValue(2),r=e.stackIntegerValue(3),h=e.stackValue(4),s=e.stackValue(5),e.failed())return null;if(d=t(s),b=t(h),r*u!==d)return e.primitiveFail(),null;if(d*l*c!==b)return e.primitiveFail(),null;for(k=s.words,v=h.words,i=0,n=0,p=0,f=0;u-1>=f;f++){for(a=0;c-1>=a;a++){for(m=0;r-1>=m;m++)for(g=k[i],++i,o=0;l-1>=o;o++)v[p]=g,++p;i=n}n+=r,i=n}e.pop(6)}var Y=1,Z=11,e=null,i=0,et="KedamaPlugin 3 November 2014 (e)",r=0,u=0,l=0,d=0;Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:V,vectorGetDistanceTo:H,getScalarHeading:Q,shutdownModule:E,primitiveAddScalar:I,primSetPixelsAtXY:y,turtleScalarSetX:K,primPixelAtXY:W,primUpHill:F,primScalarForward:g,primitiveDivArrays:A,getModuleName:$,primitiveSubArrays:nt,scalarGetAngleTo:N,randomRange:B,setInterpreter:L,kedamaSetRandomSeed:m,drawTurtlesInArray:it,turtleScalarSetY:z,randomIntoIntegerArray:M,getHeadingArrayInto:tt,makeTurtlesMap:v,setHeadingArrayFrom:T,turtlesSetX:G,setScalarHeading:R,makeMask:x,primitiveDivScalar:P,primitiveSubScalar:j,primPixelsAtXY:b,vectorGetAngleTo:J,primitiveMulArrays:C,primPixelAtXYPut:k,zoomBitmap:X,initialiseModule:D,primitiveAddArrays:O,scalarGetDistanceTo:_,turtlesSetY:U,randomIntoFloatArray:q,primTurtlesForward:S,primitiveMulScalar:w})}),module("users.bert.SqueakJS.plugins.KedamaPlugin2").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function n(e,t){return 0|Math.floor(e/t)}function a(e,t){return e-n(e,t)*t|0}function Pt(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function c(t,i){var r,e;return 0===t?i>=0?90:270:(r=i/t,e=Math.atan(r),t>=0?i>=0?e/.0174532925199433:360+e/.0174532925199433:180+e/.0174532925199433)}function l(i){var e,r,t;return e=90-i,t=e/360|0,0>e&&--t,r=.0174532925199433*(e-360*t)}function At(){var d,v,o,p,h,s,a,i,r,g,k,l,c,m,n,f,b,u;if(l=e.stackValue(0),o=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),h=e.stackIntegerValue(4),a=e.stackIntegerValue(5),s=e.stackValue(6),e.failed())return null;if(!e.isWords(s))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isBytes(l))return e.primitiveFail(),null;if(h*a!==t(s))return e.primitiveFail(),null;if(r=t(n),t(u)!==r)return e.primitiveFail(),null;if(t(o)!==r)return e.primitiveFail(),null;if(t(l)!==r)return e.primitiveFail(),null;for(m=n.wordsAsFloat32Array(),b=u.wordsAsFloat32Array(),v=o.words,k=l.bytes,p=s.words,i=0;r-1>=i;i++)c=0|m[i],f=0|b[i],g=k[i],0!==g&&c>=0&&f>=0&&a>c&&h>f&&(d=f*a+c,p[d]=v[i]);return e.failed()?null:void e.pop(7)}function It(){var i,o,n,r,u,s,a;if(s=e.stackValue(0),n=e.stackValue(1),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(a=t(n),t(s)!==a)return e.primitiveFail(),null;for(o=n.wordsAsFloat32Array(),u=s.wordsAsFloat32Array(),r=0;a-1>=r;r++)i=o[r],i/=.0174532925199433,i=90-i,i>0||(i+=360),u[r]=i;return e.failed()?null:void e.pop(2)}function Ft(){return Ot}function St(){var i,s,r,n;return r=e.stackValue(0),n=e.stackIntegerValue(1),e.failed()?null:e.isWords(r)?t(r)<n?(e.primitiveFail(),null):(s=r.wordsAsFloat32Array(),i=s[n-1],i=p(i),e.failed()?null:(e.pop(3),void e.pushFloat(i))):(e.primitiveFail(),null)}function ot(){i=17,o=16807,u=2147483647,h=n(u,o),d=a(u,o)}function f(e){var r,s,u,l,t;return u=0>e?0-e:e,r=n(i,h),s=a(i,h),i=o*s-d*r,l=65535&i,t=l*(u+1)>>>16,0>e?0-t:t}function at(){var t;return t=e.stackIntegerValue(0),e.failed()?null:(i=65536&t,void e.pop(1))}function et(){var i,c,u,s,a,l,r,f,o,h,p,n;if(n=e.stackIntegerValue(0),p=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(a=t(s),h=t(o),a!==h)return e.primitiveFail(),null;if(-32>n)return e.primitiveFail(),null;if(n>8)return e.primitiveFail(),null;for(c=s.words,f=o.words,l=4278190080,r=0;a-1>=r;r++)u=c[r],i=Pt(u,n),i>255&&(i=255),0>i&&(i=0),f[r]=i<<24&l|p;e.pop(4)}function R(){var r,l,n,s,a,c,i,v,o,f,h,p,d,m,u;if(m=e.stackValue(0),u=e.stackIntegerValue(1),o=e.stackValue(2),s=e.stackValue(3),e.failed())return null;if(p=m.words,h=p[0],e.failed())return null;if(d=Math.log(h),a=t(s),f=t(o),a!==f)return e.primitiveFail(),null;for(l=s.words,v=o.words,c=4278190080,i=0;a-1>=i;i++)n=l[i],r=0===n?0:255/d*Math.log(n)|0,r>255&&(r=255),v[i]=r<<24&c|u;e.pop(4)}function v(){var u,i,f,s,a,o,h,n,r,p,d,l,m,v,c;if(u=e.stackIntegerValue(0),r=e.stackIntegerValue(1),c=e.stackValue(2),l=e.stackValue(3),n=e.stackValue(4),a=e.stackValue(5),!e.isWords(c))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;if(!e.isWords(a))return e.primitiveFail(),null;if(o=t(n),t(l)!==o)return e.primitiveFail(),null;if(t(c)!==o)return e.primitiveFail(),null;if(t(a)!==u*r)return e.primitiveFail(),null;for(d=l.wordsAsFloat32Array(),v=c.wordsAsFloat32Array(),h=n.words,f=a.words,i=0;u*r-1>=i;i++)f[i]=0;for(i=0;o-1>=i;i++)p=d[i],m=v[i],s=r*m+p,s>=0&&u*r>s&&(f[s]=h[i]);return e.failed()?null:void e.pop(6)}function H(){var u,i,a,l,o,r,n,c,s,f;return a=e.stackIntegerValue(0),r=e.stackIntegerValue(1),f=e.stackFloatValue(2),c=e.stackFloatValue(3),i=e.stackValue(4),e.failed()?null:e.isWords(i)?t(i)!==a*r?(e.primitiveFail(),null):(n=0|c,s=0|f,u=i.words,n>=0&&r>n&&s>=0&&a>s?(l=s*r+n,o=u[l]):o=0,e.failed()?null:(e.pop(6),void e.pushInteger(o))):(e.primitiveFail(),null)}function k(){var f,r,o,l,i,u,n,s,c,a,h;return o=e.stackIntegerValue(0),n=e.stackIntegerValue(1),u=e.stackIntegerValue(2),h=e.stackFloatValue(3),c=e.stackFloatValue(4),r=e.stackValue(5),e.failed()?null:e.isWords(r)?t(r)!==o*n?(e.primitiveFail(),null):(s=0|c,a=0|h,i=u,i>1073741823&&(i=1073741823),0>i&&(i=0),f=r.words,s>=0&&n>s&&a>=0&&o>a&&(l=a*n+s,f[l]=i),e.failed()?null:void e.pop(6)):(e.primitiveFail(),null)}function b(){var v,f,d,s,a,p,u,i,c,l,h,o,n,m,r;if(u=e.stackValue(0),f=e.stackIntegerValue(1),a=e.stackIntegerValue(2),s=e.stackValue(3),r=e.stackValue(4),o=e.stackValue(5),e.failed())return null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(r))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(f*a!==t(s))return e.primitiveFail(),null;if(c=t(o),t(r)!==c)return e.primitiveFail(),null;if(t(u)!==c)return e.primitiveFail(),null;for(h=o.wordsAsFloat32Array(),m=r.wordsAsFloat32Array(),p=u.words,v=s.words,i=0;c-1>=i;i++)l=0|h[i],n=0|m[i],l>=0&&n>=0&&a>l&&f>n&&(d=n*a+l,p[i]=v[d]);return e.failed()?null:void e.pop(6)}function g(){var v,p,g,l,n,o,i,y,S,F,d,m,c,k,b,f,u,h,a;return v=e.stackIntegerValue(0),k=e.stackIntegerValue(1),m=e.stackIntegerValue(2),S=e.stackIntegerValue(3),p=e.stackFloatValue(4),g=e.stackFloatValue(5),b=e.stackFloatValue(6),o=e.stackValue(7),a=e.stackValue(8),u=e.stackValue(9),y=e.stackIntegerValue(10),e.failed()?null:e.isWords(u)&&e.isWords(a)&&e.isWords(o)?(c=t(u),t(a)!==c?(e.primitiveFail(),null):t(o)!==c?(e.primitiveFail(),null):(f=u.wordsAsFloat32Array(),h=a.wordsAsFloat32Array(),n=o.wordsAsFloat32Array(),l=b,i=y-1,F=f[i]+l*Math.cos(n[i]),d=h[i]-l*Math.sin(n[i]),s(i,f,n,F,g,S,m),r(i,h,n,d,p,k,v),e.failed()?null:void e.pop(11))):(e.primitiveFail(),null)}function y(){var s,d,f,h,a,F,S,i,I,k,m,g,p,n,v,r,b,c,y,u,o,O,l;if(r=e.stackValue(0),d=e.stackIntegerValue(1),a=e.stackIntegerValue(2),h=e.stackValue(3),l=e.stackValue(4),u=e.stackValue(5),p=e.stackValue(6),e.failed())return null;if(!e.isBytes(p))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(h))return e.primitiveFail(),null;if(d*a!==t(h))return e.primitiveFail(),null;if(n=t(u),t(p)!==n)return e.primitiveFail(),null;if(t(l)!==n)return e.primitiveFail(),null;if(g=p.bytes,y=u.wordsAsFloat32Array(),O=l.wordsAsFloat32Array(),k="number"==typeof r)I=r,v=I;else{if(t(r)!==n)return e.primitiveFail(),null;m=e.isMemberOf(r,"WordArray"),m?b=r.words:F=r.wordsAsFloat32Array()}for(s=h.words,i=0;n-1>=i;i++)1===g[i]&&(c=0|y[i],o=0|O[i],c>=0&&o>=0&&a>c&&d>o&&(f=o*a+c,k?s[f]=v:m?s[f]=b[i]:(S=F[i],s[f]=S)));return e.failed()?null:void e.pop(7)}function S(){var b,A,v,d,o,h,i,u,F,O,I,P,l,k,n,g,y,S,a,p,c,m,f;if(b=e.stackIntegerValue(0),g=e.stackIntegerValue(1),k=e.stackIntegerValue(2),F=e.stackIntegerValue(3),A=e.stackFloatValue(4),v=e.stackFloatValue(5),a=e.stackValue(6),h=e.stackValue(7),f=e.stackValue(8),c=e.stackValue(9),l=e.stackValue(10),e.failed())return null;if(!e.isBytes(l))return e.primitiveFail(),null;if(!e.isWords(c))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(h))return e.primitiveFail(),null;if(a.isFloat)u=!1;else{if(!e.isWords(a))return e.primitiveFail(),null;u=!0}if(n=t(c),t(f)!==n)return e.primitiveFail(),null;if(t(h)!==n)return e.primitiveFail(),null;if(t(l)!==n)return e.primitiveFail(),null;if(u&&t(a)!==n)return e.primitiveFail(),null;for(P=l.bytes,p=c.wordsAsFloat32Array(),m=f.wordsAsFloat32Array(),o=h.wordsAsFloat32Array(),u?S=a.wordsAsFloat32Array():y=e.floatValueOf(a),i=0;n-1>=i;i++)1===P[i]&&(d=u?S[i]:y,O=p[i]+d*Math.cos(o[i]),I=m[i]-d*Math.sin(o[i]),s(i,p,o,O,v,F,k),r(i,m,o,I,A,g,b));return e.failed()?null:void e.pop(11)}function F(){var m,f,I,O,u,d,l,F,S,y,o,A,v,k,b,g,h,r,i,n,a,s;if(o=e.stackIntegerValue(0),u=e.stackIntegerValue(1),n=e.stackIntegerValue(2),f=e.stackValue(3),k=e.stackFloatValue(4),g=e.stackFloatValue(5),b=e.stackFloatValue(6),e.failed())return null;if(!e.isWords(f))return e.primitiveFail(),null;if(t(f)!==u*n)return e.primitiveFail(),null;for(m=f.words,r=b,i=g,r=Math.max(r,0),i=Math.max(i,0),r=Math.min(r,n-1),i=Math.min(i,u-1),A=Math.max(r-o,0),I=Math.min(r+o,n-1),v=Math.max(i-o,0),O=Math.min(i+o,u-1),d=m[i*n+r],l=-1,s=v;O>=s;s++)for(y=s*n,a=A;I>=a;a++)h=m[y+a],h>d&&(l=a,F=s,d=h);return S=-1===l?p(k):c(l-r,F-i)+90|0,e.failed()?null:(e.pop(8),void e.pushFloat(S))}function O(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]+f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]+h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]+f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]+h[i];e.pop(4),e.push(r)}function I(){var s,u,f,a,i,h,c,p,o,n,r,l,d;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(o=t(n),e.success(o===t(r)),e.failed())return null;if(c="number"==typeof s,p=e.isMemberOf(n,"WordArray"),c&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(c)for(l=n.words,h=s,d=r.words,i=0;o-1>=i;i++)d[i]=l[i]+h;else for(l=n.words,u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=l[i]+u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]+h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]+u;e.pop(4),e.push(r)}function A(){var i,s,a,o,l,r,u,n;if(r=e.stackObjectValue(0),n=e.stackValue(1),e.failed())return null;if(e.success(e.isBytes(n)),e.success(e.isBytes(r)),e.failed())return null;if(a=t(n),o=t(r),e.failed())return null;for(s=a,a>o&&(s=o),l=r.bytes,u=n.bytes,i=0;s-1>=i;i++)u[i]=u[i]+l[i]===2;e.pop(1)}function P(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]/f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]/h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]/f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]/h[i];e.pop(4),e.push(r)}function C(){var a,l,h,o,i,p,f,d,u,s,r,c,m;if(r=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(u=t(s),e.success(u===t(r)),e.failed())return null;if(f="number"==typeof a,d=e.isMemberOf(s,"WordArray"),f&&d){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(d)if(f)for(c=s.words,p=a,m=r.words,i=0;u-1>=i;i++)m[i]=n(c[i],p);else for(c=s.words,l=e.floatValueOf(a),o=r.wordsAsFloat32Array(),i=0;u-1>=i;i++)o[i]=c[i]/l;else if(f)for(h=s.wordsAsFloat32Array(),p=a,o=r.wordsAsFloat32Array(),i=0;u-1>=i;i++)o[i]=h[i]/p;else for(h=s.wordsAsFloat32Array(),l=e.floatValueOf(a),o=r.wordsAsFloat32Array(),i=0;u-1>=i;i++)o[i]=h[i]/l;e.pop(4),e.push(r)}function w(){var r,n,u,l,i,h,p,o,s,a,f,c;if(a=e.stackObjectValue(0),r=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(r),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(r,"WordArray"),p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]===f[i];else for(c=s.words,u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]===u[i];else if(h)for(l=s.wordsAsFloat32Array(),f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]===f[i];else for(l=s.wordsAsFloat32Array(),u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]===u[i];e.pop(4),e.push(a)}function V(){var a,r,u,l,i,f,h,p,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]===f;else for(c=s.words,u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]===u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]===f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]===u;e.pop(4),e.push(n)}function j(){var r,n,u,l,i,h,p,o,s,a,f,c;if(a=e.stackObjectValue(0),r=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(r),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(r,"WordArray"),p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]>=f[i];else for(c=s.words,u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]>=u[i];else if(h)for(l=s.wordsAsFloat32Array(),f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]>=f[i];else for(l=s.wordsAsFloat32Array(),u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]>=u[i];e.pop(4),e.push(a)}function x(){var a,r,u,l,i,f,h,p,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]>=f;else for(c=s.words,u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]>=u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]>=f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]>=u;e.pop(4),e.push(n)}function q(){var r,n,u,l,i,h,p,o,s,a,f,c;if(a=e.stackObjectValue(0),r=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(r),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(r,"WordArray"),p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]>f[i];else for(c=s.words,u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]>u[i];else if(h)for(l=s.wordsAsFloat32Array(),f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]>f[i];else for(l=s.wordsAsFloat32Array(),u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]>u[i];e.pop(4),e.push(a)}function M(){var a,r,u,l,i,f,h,p,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]>f;else for(c=s.words,u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]>u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]>f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]>u;e.pop(4),e.push(n)}function B(){var r,n,u,l,i,h,p,o,s,a,f,c;if(a=e.stackObjectValue(0),r=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(r),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(r,"WordArray"),p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]<=f[i];else for(c=s.words,u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]<=u[i];else if(h)for(l=s.wordsAsFloat32Array(),f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]<=f[i];else for(l=s.wordsAsFloat32Array(),u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]<=u[i];e.pop(4),e.push(a)}function N(){var a,r,u,l,i,f,h,p,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]<=f;else for(c=s.words,u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]<=u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]<=f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]<=u;e.pop(4),e.push(n)}function _(){var r,n,u,l,i,h,p,o,s,a,f,c;if(a=e.stackObjectValue(0),r=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(r),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(r,"WordArray"),p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]<f[i];else for(c=s.words,u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]<u[i];else if(h)for(l=s.wordsAsFloat32Array(),f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]<f[i];else for(l=s.wordsAsFloat32Array(),u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]<u[i];e.pop(4),e.push(a)}function W(){var a,r,u,l,i,f,h,p,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]<f;else for(c=s.words,u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]<u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]<f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]<u;e.pop(4),e.push(n)}function D(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]*f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]*h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]*f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]*h[i];e.pop(4),e.push(r)}function T(){var s,u,f,a,i,h,c,p,o,n,r,l,d;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(o=t(n),e.success(o===t(r)),e.failed())return null;if(c="number"==typeof s,p=e.isMemberOf(n,"WordArray"),c&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(c)for(l=n.words,h=s,d=r.words,i=0;o-1>=i;i++)d[i]=l[i]*h;else for(l=n.words,u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=l[i]*u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]*h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]*u;e.pop(4),e.push(r)}function L(){var r,n,u,l,i,h,p,o,s,a,f,c;if(a=e.stackObjectValue(0),r=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(r)),e.success(e.isWords(s)),e.success(e.isBytes(a)),e.failed())return null;if(o=t(r),e.success(o===t(s)),e.success(o===t(a)),e.failed())return null;if(h=e.isMemberOf(r,"WordArray"),p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]!==f[i];else for(c=s.words,u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=c[i]!==u[i];else if(h)for(l=s.wordsAsFloat32Array(),f=r.words,n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]!==f[i];else for(l=s.wordsAsFloat32Array(),u=r.wordsAsFloat32Array(),n=a.bytes,i=0;o-1>=i;i++)n[i]=l[i]!==u[i];e.pop(4),e.push(a)}function Ct(){var a,r,u,l,i,f,h,p,o,s,n,c;if(n=e.stackObjectValue(0),a=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isBytes(n)),e.failed())return null;if(o=t(s),e.success(o===t(n)),e.failed())return null;if(h="number"==typeof a,p=e.isMemberOf(s,"WordArray"))if(h)for(c=s.words,f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]!==f;else for(c=s.words,u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=c[i]!==u;else if(h)for(l=s.wordsAsFloat32Array(),f=a,r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]!==f;else for(l=s.wordsAsFloat32Array(),u=e.floatValueOf(a),r=n.bytes,i=0;o-1>=i;i++)r[i]=l[i]!==u;e.pop(4),e.push(n)}function E(){var i,s,n,r;if(r=e.stackValue(0),e.failed())return null;if(e.success(e.isBytes(r)),e.failed())return null;if(s=t(r),e.failed())return null;for(n=r.bytes,i=0;s-1>=i;i++)n[i]=0===n[i]?1:0}function K(){var i,s,a,o,l,r,u,n;if(r=e.stackObjectValue(0),n=e.stackValue(1),e.failed())return null;if(e.success(e.isBytes(n)),e.success(e.isBytes(r)),e.failed())return null;if(a=t(n),o=t(r),e.failed())return null;for(s=a,a>o&&(s=o),l=r.bytes,u=n.bytes,i=0;s-1>=i;i++)u[i]=u[i]+l[i]>0;e.pop(1)}function z(){var i,o,s,a,u,r,l,n;if(r=e.stackValue(0),a=e.stackObjectValue(1),e.failed())return null;if(u=e.isIntegerValue(r)?r:e.booleanValueOf(r),n=e.fetchPointerofObject(1,a),s=e.fetchPointerofObject(0,a),e.failed())return null;if(!e.isBytes(s))return e.primitiveFail(),null;if(!e.isBytes(n))return e.primitiveFail(),null;for(l=n.bytes,o=s.bytes,i=0;i<=t(n)-1;i++)1===o[i]&&(l[i]=u);e.pop(1)}function G(){var i,o,s,a,r,u,n;if(r=e.stackIntegerValue(0),a=e.stackObjectValue(1),e.failed())return null;if(r=4278190080|r,n=e.fetchPointerofObject(1,a),s=e.fetchPointerofObject(0,a),e.failed())return null;if(!e.isBytes(s))return e.primitiveFail(),null;if(!e.isWords(n))return e.primitiveFail(),null;for(u=n.words,o=s.bytes,i=0;i<=t(n)-1;i++)1===o[i]&&(u[i]=r);e.pop(1)}function U(){var i,a,n,s,o,u,r;if(o=e.stackFloatValue(0),s=e.stackObjectValue(1),e.failed())return null;if(r=e.fetchPointerofObject(1,s),n=e.fetchPointerofObject(0,s),e.failed())return null;if(!e.isBytes(n))return e.primitiveFail(),null;if(!e.isWords(r))return e.primitiveFail(),null;for(u=r.wordsAsFloat32Array(),a=n.bytes,i=0;i<=t(r)-1;i++)1===a[i]&&(u[i]=o);e.pop(1)}function J(){var i,a,n,s,o,u,r;if(o=e.stackValue(0),s=e.stackObjectValue(1),e.failed())return null;if(r=e.fetchPointerofObject(1,s),n=e.fetchPointerofObject(0,s),e.failed())return null;if(!e.isBytes(n))return e.primitiveFail(),null;if(!e.isPointers(r))return e.primitiveFail(),null;for(u=r.wordsAsInt32Array(),a=n.bytes,i=0;i<=t(r)-1;i++)1===a[i]&&(u[i]=o);e.pop(1)}function m(){var r,d,a,h,l,o,s,m,c,i,n,p,u,f;if(s=e.stackIntegerValue(0),o=e.stackObjectValue(1),n=e.stackIntegerValue(2),i=e.stackIntegerValue(3),l=e.stackObjectValue(4),e.failed())return null;if(u=e.fetchPointerofObject(1,l),a=e.fetchPointerofObject(0,l),e.failed())return null;if(!e.isBytes(a))return e.primitiveFail(),null;if(!e.isBytes(u)||!e.isBytes(o))return e.primitiveFail(),null;if(p=u.bytes,d=a.bytes,m=o.bytes,f=t(u),h=t(a),c=t(o),i>n)return e.primitiveFail(),null;if(1>i)return e.primitiveFail(),null;if(i>f)return e.primitiveFail(),null;if(i>h)return e.primitiveFail(),null;if(n>f)return e.primitiveFail(),null;if(n>h)return e.primitiveFail(),null;if(1>s)return e.primitiveFail(),null;if(s>c)return e.primitiveFail(),null;if(n-i+1>c-s+1)return e.primitiveFail(),null;for(r=i-1;n-1>=r;r++)1===d[r]&&(p[r]=m[s+r-i]);e.pop(4)}function X(){var d,f,y,i,u,m,b,l,k,n,o,p,v,r,a,c,h,s,g;if(o=e.stackIntegerValue(0),n=e.stackObjectValue(1),a=e.stackIntegerValue(2),r=e.stackIntegerValue(3),k=e.stackObjectValue(4),e.failed())return null;if(s=e.fetchPointerofObject(1,k),m=e.fetchPointerofObject(0,k),e.failed())return null;if(!e.isBytes(m))return e.primitiveFail(),null;if(!(e.isWords(s)&&e.isWords(n)||e.isPointers(s)&&e.isPointers(n)))return e.primitiveFail(),null;if(u=m.bytes,g=t(s),b=t(m),v=t(n),r>a)return e.primitiveFail(),null;
if(1>r)return e.primitiveFail(),null;if(r>g)return e.primitiveFail(),null;if(r>b)return e.primitiveFail(),null;if(a>g)return e.primitiveFail(),null;if(a>b)return e.primitiveFail(),null;if(1>o)return e.primitiveFail(),null;if(o>v)return e.primitiveFail(),null;if(a-r+1>v-o+1)return e.primitiveFail(),null;if(c=e.isMemberOf(s,"KedamaFloatArray"),l=e.isMemberOf(n,"KedamaFloatArray"),c&&l)for(f=s.wordsAsFloat32Array(),d=n.wordsAsFloat32Array(),i=r-1;a-1>=i;i++)1===u[i]&&(f[i]=d[o+i-r]);if(c&&!l)for(f=s.wordsAsFloat32Array(),p=n.words,i=r-1;a-1>=i;i++)1===u[i]&&(f[i]=p[o+i-r]);if(!c&&l)for(h=s.words,d=n.wordsAsFloat32Array(),i=r-1;a-1>=i;i++)1===u[i]&&(y=d[o+i-r]>>>0,h[i]=y);if(!c&&!l)for(h=s.words,p=n.words,i=r-1;a-1>=i;i++)1===u[i]&&(h[i]=p[o+i-r]);e.pop(4)}function Y(){var s,l,f,r,v,m,c,i,d,g,u,o,n,h,p,y,b,k,S;if(n=e.stackObjectValue(0),s=e.stackObjectValue(1),o=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isWords(o)),e.success(e.isWords(n)),e.failed())return null;if(u=t(s),e.success(u===t(o)),e.success(u===t(n)),e.failed())return null;if(d=e.isMemberOf(s,"WordArray"),g=e.isMemberOf(o,"WordArray"),d&&g){if(!e.isMemberOf(n,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(n,"KedamaFloatArray"))return e.primitiveFail(),null;if(g)if(d)for(k=o.words,b=s.words,S=n.words,i=0;u-1>=i;i++)p=k[i],h=b[i],y=a(p,h),S[i]=y;else for(k=o.words,v=s.wordsAsFloat32Array(),c=n.wordsAsFloat32Array(),i=0;u-1>=i;i++)p=k[i],l=v[i],r=p/l,r=Math.floor(r),c[i]=p-r*l;else if(d)for(m=o.wordsAsFloat32Array(),b=s.words,c=n.wordsAsFloat32Array(),i=0;u-1>=i;i++)f=m[i],h=b[i],r=f/h,r=Math.floor(r),c[i]=f-r*h;else for(m=o.wordsAsFloat32Array(),v=s.wordsAsFloat32Array(),c=n.wordsAsFloat32Array(),i=0;u-1>=i;i++)f=m[i],l=v[i],r=f/l,r=Math.floor(r),c[i]=f-r*l;e.pop(4),e.push(n)}function Z(){var o,c,u,r,d,l,i,h,p,k,f,s,n,v,m,b;if(n=e.stackObjectValue(0),o=e.stackValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(s)),e.success(e.isWords(n)),e.failed())return null;if(f=t(s),e.success(f===t(n)),e.failed())return null;if(p="number"==typeof o,k=e.isMemberOf(s,"WordArray"),p&&k){if(!e.isMemberOf(n,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(n,"KedamaFloatArray"))return e.primitiveFail(),null;if(k)if(p)for(m=s.words,h=o,b=n.words,i=0;f-1>=i;i++)b[i]=a(m[i],h);else for(m=s.words,c=e.floatValueOf(o),l=n.wordsAsFloat32Array(),i=0;f-1>=i;i++)v=m[i],r=v/c,r=Math.floor(r),l[i]=v-r*c;else if(p)for(d=s.wordsAsFloat32Array(),h=o,l=n.wordsAsFloat32Array(),i=0;f-1>=i;i++)u=d[i],r=u/h,r=Math.floor(r),l[i]=u-r*h;else for(d=s.wordsAsFloat32Array(),c=e.floatValueOf(o),l=n.wordsAsFloat32Array(),i=0;f-1>=i;i++)u=d[i],r=u/c,r=Math.floor(r),l[i]=u-r*c;e.pop(4),e.push(n)}function Q(){var n,h,c,o,i,l,p,a,s,r,f,u,d;if(r=e.stackObjectValue(0),n=e.stackObjectValue(1),s=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(s)),e.success(e.isWords(r)),e.failed())return null;if(a=t(n),e.success(a===t(s)),e.success(a===t(r)),e.failed())return null;if(l=e.isMemberOf(n,"WordArray"),p=e.isMemberOf(s,"WordArray"),l&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(l)for(u=s.words,f=n.words,d=r.words,i=0;a-1>=i;i++)d[i]=u[i]-f[i];else for(u=s.words,h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=u[i]-h[i];else if(l)for(c=s.wordsAsFloat32Array(),f=n.words,o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]-f[i];else for(c=s.wordsAsFloat32Array(),h=n.wordsAsFloat32Array(),o=r.wordsAsFloat32Array(),i=0;a-1>=i;i++)o[i]=c[i]-h[i];e.pop(4),e.push(r)}function $(){var s,u,f,a,i,h,c,p,o,n,r,l,d;if(r=e.stackObjectValue(0),s=e.stackValue(1),n=e.stackObjectValue(2),e.failed())return null;if(e.success(e.isWords(n)),e.success(e.isWords(r)),e.failed())return null;if(o=t(n),e.success(o===t(r)),e.failed())return null;if(c="number"==typeof s,p=e.isMemberOf(n,"WordArray"),c&&p){if(!e.isMemberOf(r,"WordArray"))return e.primitiveFail(),null}else if(!e.isMemberOf(r,"KedamaFloatArray"))return e.primitiveFail(),null;if(p)if(c)for(l=n.words,h=s,d=r.words,i=0;o-1>=i;i++)d[i]=l[i]-h;else for(l=n.words,u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=l[i]-u;else if(c)for(f=n.wordsAsFloat32Array(),h=s,a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]-h;else for(f=n.wordsAsFloat32Array(),u=e.floatValueOf(s),a=r.wordsAsFloat32Array(),i=0;o-1>=i;i++)a[i]=f[i]-u;e.pop(4),e.push(r)}function p(i){var e,t;return t=i/.0174532925199433,e=90-t,e>0||(e+=360),e}function tt(){var a,o,i,r,n,u,l,s;if(a=e.stackFloatValue(0),i=e.stackValue(1),s=e.stackIntegerValue(2),r=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(i))return e.primitiveFail(),null;if(l=t(i),!(l>=s&&r>=1&&s>=r))return e.primitiveFail(),null;if(o=i.wordsAsFloat32Array(),e.failed())return null;for(n=r;s>=n;n++)o[n-1]=f(u)*a;e.pop(5)}function it(){var a,i,r,o,n,u,l,s;if(a=e.stackFloatValue(0),n=e.stackValue(1),s=e.stackIntegerValue(2),i=e.stackIntegerValue(3),u=e.stackIntegerValue(4),e.failed())return null;if(!e.isWords(n))return e.primitiveFail(),null;if(l=t(n),!(l>=s&&i>=1&&s>=i))return e.primitiveFail(),null;if(o=n.words,e.failed())return null;for(r=i;s>=r;r++)o[r-1]=f(u)*a|0;e.pop(5)}function rt(){var t,i;return t=e.stackIntegerValue(0),e.failed()?null:(i=f(t),e.failed()?null:(e.pop(2),void e.pushInteger(i)))}function nt(){var i,r,t,n,s,a,o;return r=e.stackFloatValue(0),i=e.stackFloatValue(1),s=e.stackFloatValue(2),n=e.stackFloatValue(3),e.failed()?null:(a=n-i,o=s-r,t=c(a,o),t+=90,t>360&&(t-=360),e.failed()?null:(e.pop(5),void e.pushFloat(t)))}function st(){var r,n,s,a,o,t,i;return n=e.stackFloatValue(0),r=e.stackFloatValue(1),o=e.stackFloatValue(2),a=e.stackFloatValue(3),e.failed()?null:(t=r-a,i=n-o,s=Math.sqrt(t*t+i*i),e.failed()?null:(e.pop(5),void e.pushFloat(s)))}function s(r,o,n,u,i,s,a){var t,e;e=u,0>e&&(1===s&&(e+=i),2===s&&(e=0),3===s&&(e=0-e,t=n[r],n[r]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),e>=i&&(1===a&&(e-=i),2===a&&(e=i-1e-6),3===a&&(e=i-1e-6-(e-i),t=n[r],n[r]=3.141592653589793>t?3.141592653589793-t:9.42477796076938-t)),o[r]=e}function r(i,a,r,o,t,n,s){var e;e=o,0>e&&(1===n&&(e+=t),2===n&&(e=0),3===n&&(e=0-e,r[i]=6.283185307179586-r[i])),e>=t&&(1===s&&(e-=t),2===s&&(e=t-1e-6),3===s&&(e=t-1e-6-(e-t),r[i]=6.283185307179586-r[i])),a[i]=e}function ut(){var i,c,s,r,a,f,o,h,n,u;if(n=e.stackValue(0),s=e.stackValue(1),o=e.stackValue(2),e.failed())return null;if(!e.isBytes(o))return e.primitiveFail(),null;if(!e.isWords(s))return e.primitiveFail(),null;if(u=t(s),n.isFloat)a=!1;else{if(!e.isWords(n))return e.primitiveFail(),null;if(t(n)!==u)return e.primitiveFail(),null;a=!0}for(f=o.bytes,c=s.wordsAsFloat32Array(),a?h=n.wordsAsFloat32Array():(i=e.floatValueOf(n),i=l(i)),r=0;u-1>=r;r++)1===f[r]&&(a&&(i=h[r],i=l(i)),c[r]=i);return e.failed()?null:void e.pop(3)}function lt(i){var t;return e=i,t=e.majorVersion()==gt,t===!1?!1:t=e.minorVersion()>=yt}function ct(){var n,s,i,r;return n=e.stackFloatValue(0),i=e.stackValue(1),r=e.stackIntegerValue(2),e.failed()?null:e.isWords(i)?t(i)<r?(e.primitiveFail(),null):(s=i.wordsAsFloat32Array(),s[r-1]=l(n),e.failed()?null:void e.pop(3)):(e.primitiveFail(),null)}function ft(){return!0}function ht(){var n,a,i,o,u,l,c,f,h,r;return u=e.stackIntegerValue(0),o=e.stackIntegerValue(1),n=e.stackFloatValue(2),c=e.stackFloatValue(3),i=e.stackValue(4),h=e.stackIntegerValue(5),r=e.stackValue(6),e.failed()?null:e.isWords(r)&&e.isWords(i)?(l=t(r),t(i)!==l?(e.primitiveFail(),null):(f=r.wordsAsFloat32Array(),a=i.wordsAsFloat32Array(),s(h-1,f,a,c,n,o,u),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function pt(){var s,a,o,i,u,l,c,f,h,n;return s=e.stackIntegerValue(0),l=e.stackIntegerValue(1),a=e.stackFloatValue(2),c=e.stackFloatValue(3),i=e.stackValue(4),h=e.stackIntegerValue(5),n=e.stackValue(6),e.failed()?null:e.isWords(n)&&e.isWords(i)?(u=t(n),t(i)!==u?(e.primitiveFail(),null):(f=n.wordsAsFloat32Array(),o=i.wordsAsFloat32Array(),r(h-1,f,o,c,a,l,s),e.failed()?null:void e.pop(7))):(e.primitiveFail(),null)}function dt(){var y,h,l,r,n,c,d,k,m,o,p,a,f,v,i,b,g,u;if(p=e.stackIntegerValue(0),d=e.stackIntegerValue(1),y=e.stackFloatValue(2),i=e.stackValue(3),l=e.stackValue(4),u=e.stackValue(5),o=e.stackValue(6),e.failed())return null;if(!e.isBytes(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(i.isFloat)n=!1;else{if(!e.isWords(i))return e.primitiveFail(),null;n=!0,c=e.isMemberOf(i,"WordArray")}if(a=t(u),t(o)!==a)return e.primitiveFail(),null;if(t(l)!==a)return e.primitiveFail(),null;if(n&&t(i)!==a)return e.primitiveFail(),null;for(m=o.bytes,g=u.wordsAsFloat32Array(),h=l.wordsAsFloat32Array(),n?c?b=i.words:v=i.wordsAsFloat32Array():f=e.floatValueOf(i),r=0;a-1>=r;r++)1===m[r]&&(k=n?c?b[r]:v[r]:f,s(r,g,h,k,y,d,p));return e.failed()?null:void e.pop(7)}function mt(){var y,h,k,u,n,s,c,p,m,o,a,d,f,v,i,b,g,l;if(y=e.stackIntegerValue(0),d=e.stackIntegerValue(1),h=e.stackFloatValue(2),i=e.stackValue(3),u=e.stackValue(4),l=e.stackValue(5),o=e.stackValue(6),e.failed())return null;if(!e.isBytes(o))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(i.isFloat)s=!1;else{if(!e.isWords(i))return e.primitiveFail(),null;s=!0,c=e.isMemberOf(i,"WordArray")}if(a=t(l),t(o)!==a)return e.primitiveFail(),null;if(t(u)!==a)return e.primitiveFail(),null;if(s&&t(i)!==a)return e.primitiveFail(),null;for(m=o.bytes,g=l.wordsAsFloat32Array(),k=u.wordsAsFloat32Array(),s?c?b=i.words:v=i.wordsAsFloat32Array():f=e.floatValueOf(i),n=0;a-1>=n;n++)1===m[n]&&(p=s?c?b[n]:v[n]:f,r(n,g,k,p,h,d,y));return e.failed()?null:void e.pop(7)}function vt(){var i,s,k,a,d,n,p,h,u,y,o,r,m,v,f,b,g,l;if(o=e.stackValue(0),l=e.stackValue(1),f=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(f))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(r=t(o),0>r)return e.primitiveFail(),null;if(t(f)!==r)return e.primitiveFail(),null;if(t(l)!==r)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==r)return e.primitiveFail(),null;if(t(n)!==r)return e.primitiveFail(),null}for(y=o.wordsAsFloat32Array(),v=f.wordsAsFloat32Array(),g=l.wordsAsFloat32Array(),s&&(k=a.wordsAsFloat32Array(),d=n.wordsAsFloat32Array()),s||(p=e.floatValueOf(a),h=e.floatValueOf(n)),i=0;r-1>=i;i++)s&&(p=k[i],h=d[i]),m=p-v[i],b=h-g[i],u=c(m,b),u+=90,u>360&&(u-=360),y[i]=u;return e.failed()?null:(e.pop(6),void e.push(o))}function kt(){var i,s,v,a,d,n,f,c,b,o,r,h,m,u,p,k,l;if(o=e.stackValue(0),l=e.stackValue(1),u=e.stackValue(2),n=e.stackValue(3),a=e.stackValue(4),e.failed())return null;if(!e.isWords(o))return e.primitiveFail(),null;if(!e.isWords(u))return e.primitiveFail(),null;if(!e.isWords(l))return e.primitiveFail(),null;if(r=t(o),0>r)return e.primitiveFail(),null;if(t(u)!==r)return e.primitiveFail(),null;if(t(l)!==r)return e.primitiveFail(),null;if(a.isFloat){if(!n.isFloat)return e.primitiveFail(),null;s=!1}else{if(n.isFloat)return e.primitiveFail(),null;s=!0}if(s){if(t(a)!==r)return e.primitiveFail(),null;if(t(n)!==r)return e.primitiveFail(),null}for(b=o.wordsAsFloat32Array(),m=u.wordsAsFloat32Array(),k=l.wordsAsFloat32Array(),s&&(v=a.wordsAsFloat32Array(),d=n.wordsAsFloat32Array()),s||(f=e.floatValueOf(a),c=e.floatValueOf(n)),i=0;r-1>=i;i++)s&&(f=v[i],c=d[i]),h=f-m[i],p=c-k[i],b[i]=Math.sqrt(h*h+p*p);return e.failed()?null:(e.pop(6),void e.push(o))}function bt(){var g,v,h,p,b,o,u,k,r,s,i,n,d,m,f,l,a,c;if(c=e.stackIntegerValue(0),l=e.stackIntegerValue(1),u=e.stackIntegerValue(2),r=e.stackIntegerValue(3),h=e.stackValue(4),s=e.stackValue(5),e.failed())return null;if(d=t(s),b=t(h),r*u!==d)return e.primitiveFail(),null;if(d*l*c!==b)return e.primitiveFail(),null;for(k=s.words,v=h.words,i=0,n=0,p=0,f=0;u-1>=f;f++){for(a=0;c-1>=a;a++){for(m=0;r-1>=m;m++)for(g=k[i],++i,o=0;l-1>=o;o++)v[p]=g,++p;i=n}n+=r,i=n}e.pop(6)}var gt=1,yt=11,e=null,i=0,Ot="KedamaPlugin2 13 November 2014 (e)",o=0,u=0,h=0,d=0;Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:O,getModuleName:Ft,primitiveMulArrays:D,drawTurtlesInArray:At,primitiveGTScalar:M,setScalarHeading:ct,primitiveSubScalar:$,turtleScalarSetY:pt,vectorGetAngleTo:vt,primitiveRemArrays:Y,primitiveLTArrays:_,primitiveAddScalar:I,primPixelsAtXY:b,primitiveMulScalar:T,primSetPixelsAtXY:y,setHeadingArrayFrom:ut,primPixelAtXYPut:k,makeMaskLog:R,primitiveLTScalar:W,scalarGetAngleTo:nt,primitiveOrByteArray:K,primitiveLEArrays:B,primitiveRemScalar:Z,getHeadingArrayInto:It,turtlesSetX:dt,primitivePredicateReplaceBytes:m,primitiveDivArrays:P,makeMask:et,primitiveLEScalar:N,kedamaSetRandomSeed:at,randomIntoIntegerArray:it,setInterpreter:lt,primitivePredicateAtAllPutColor:G,makeTurtlesMap:v,randomIntoFloatArray:tt,primUpHill:F,shutdownModule:ft,primitiveDivScalar:C,primitiveGEArrays:j,primitiveNotByteArray:E,randomRange:rt,initialiseModule:ot,getScalarHeading:St,primPixelAtXY:H,primitivePredicateAtAllPutNumber:U,primitiveEQArrays:w,primitiveNEArrays:L,primScalarForward:g,vectorGetDistanceTo:kt,turtlesSetY:mt,turtleScalarSetX:ht,primTurtlesForward:S,primitiveGEScalar:x,primitiveAndByteArray:A,primitivePredicateReplaceWords:X,primitiveGTArrays:q,primitivePredicateAtAllPutObject:J,primitiveEQScalar:V,primitivePredicateAtAllPutBoolean:z,zoomBitmap:bt,primitiveNEScalar:Ct,scalarGetDistanceTo:st,primitiveSubArrays:Q})}),module("users.bert.SqueakJS.plugins.Klatt").requires("users.bert.SqueakJS.vm").toRun(function(){function Pt(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function Lt(e,t){return 0|Math.floor(e/t)}function N(e,t){return e-Lt(e,t)*t|0}function _i(){0!==N(v,2)&&(r*=1-t[B],r>0&&(r=0))}function Ni(){var i,r,n,s,e;e=I/f,i=Math.sin(2*h*12.7*e),r=Math.sin(2*h*7.1*e),n=Math.sin(2*h*4.7*e),s=2*t[Dt]*t[b]/100*(i+r+n),l+=s}function Bi(){0===N(v,2)?l+=t[B]*t[b]*(1-t[C]):l-=t[B]*t[b]*(1-t[C])}function Mi(){l+=(O()-32767)*t[_t]/32768*t[b]}function qi(){r+=(O()-32767)*t[fi]/32768*r,r>0&&(r=0)}function L(s,a,o){var e,r,t,i,n;r=(0-h)/f*o,n=Math.exp(r),i=0-n*n,r=2*h/f*a,t=n*Math.cos(r)*2,e=1-t-i,e=1/e,t=(0-t)*e,i=(0-i)*e,j(s,e),E(s,t),z(s,i)}function At(e,t){var i,r;return i=x(e)*t+R(e)*(r=X(e))+K(e)*Ft(e),It(e,r),yt(e,t),i}function xi(t){var e;return s>0?(e=At(Y,t),e=i(Q,e),e=At(G,e),e=i(J,e),s>=8&&(e=i($,e)),s>=7&&(e=i(et,e)),s>=6&&(e=i(it,e)),s>=5&&(e=i(at,e)),s>=4&&(e=i(ft,e)),s>=3&&(e=i(dt,e)),s>=2&&(e=i(gt,e)),s>=1&&(e=i(Vt,e)),e):0}function xt(t){return e.success(e.isWords(t)),e.failed()?0:t.wordsAsFloat32Array()}function ji(t){return e.success(e.isWords(t)),e.failed()?0:t.wordsAsInt16Array()}function Vi(){return Fi}function wi(){var e;return 0===a?0:(g>p?(e=S*r+F*d,d=r,r=e):(e=V*r-w,r=e),p>=a&&(p=0,Oi()),++p,e)}function n(e){return 32.767*Math.pow(2,(e-87)/6)}function Ci(t){var i;return e.success(22===Pt(t)),e.failed()?!1:(i=e.fetchPointerofObject(0,t),u=xt(i),l=e.fetchFloatofObject(2,t),a=e.fetchIntegerofObject(3,t),p=e.fetchIntegerofObject(4,t),g=e.fetchIntegerofObject(5,t),m=e.fetchIntegerofObject(6,t),S=e.fetchFloatofObject(7,t),F=e.fetchFloatofObject(8,t),r=e.fetchFloatofObject(9,t),d=e.fetchFloatofObject(10,t),V=e.fetchFloatofObject(11,t),w=e.fetchFloatofObject(12,t),A=e.fetchFloatofObject(13,t),T=e.fetchFloatofObject(14,t),y=e.fetchFloatofObject(15,t),v=e.fetchIntegerofObject(16,t),I=e.fetchIntegerofObject(17,t),P=e.fetchIntegerofObject(18,t),s=e.fetchIntegerofObject(19,t),M=e.fetchIntegerofObject(20,t),f=e.fetchIntegerofObject(21,t),e.failed()===!1)}function O(){return P=1309*P+13849&65535}function Pi(){var i,e,t,n;for(e=0,t=r,n=d,i=1;g>=i;i++)e=S*t+F*n,n=t,t=e;0!==e&&(r=r/e*1e4)}function Ai(e){return i(bt,e)-i(pt,e)+i(ct,e)-i(rt,e)+i(tt,e)}function Ii(e){return i(St,e)+i(vt,e)+i(ht,e)+i(ut,e)+i(Z,e)+i(U,e)}function Oi(){t[b]>0?(mi(),v=N(v+1,65535)):(a=1,m=a)}function Si(){var i,r,n,t,s;return i=xt(e.stackValue(2)),r=ji(n=e.stackValue(1)),s=e.stackIntegerValue(0),e.failed()?null:(t=e.stackObjectValue(3),Ci(t)?(e.success(2*Pt(n)>=M),e.failed()?null:(vi(i,r,s),gi(t)?void e.pop(3):null)):null)}function k(e,i,r,n,s){var t;return t=Math.exp(e*i),t*((s*(e*e+1)+e)*n-r)+1}function c(i,a,o){var s,e,r,n,t;e=(0-h)/f*o,t=Math.exp(e),n=0-t*t,e=2*h/f*a,r=t*Math.cos(e)*2,s=1-r-n,j(i,s),E(i,r),z(i,n)}function o(e,t,i,r){c(e,t,i),j(e,x(e)*r)}function i(e,r){var t,i;return t=x(e)*r+R(e)*(i=X(e))+K(e)*Ft(e),It(e,i),yt(e,t),t}function x(e){return u[5*e-5]}function j(e,t){u[5*e-5]=t}function R(e){return u[5*e-4]}function E(e,t){u[5*e-4]=t}function K(e){return u[5*e-3]}function z(e,t){u[5*e-3]=t}function X(e){return u[5*e-2]}function yt(e,t){u[5*e-2]=t}function Ft(e){return u[5*e-1]}function It(e,t){u[5*e-1]=t}function yi(O,g,y){var v,u,s,l,e,c,t,i,m,f,k,b,o,n,p;o=a*O|0,f=o/a,m=y,t=g,0>=t?u=1:(c=(1-f)/t,u=1-c/(Math.exp(c)-1)),e=h*(m+1),v=Math.cos(e),b=Math.sin(e),k=t/f*e*u,p=di(e,v,b,k),n=e/o,i=Math.exp(p*n),S=2*Math.cos(n)*i,F=0-i*i,d=0,r=i*Math.sin(n),s=Math.exp(-1/(t*a)),l=Math.pow(s,a-o),V=s,w=(1-s)*l/(1-l),Pi()}function gi(O){var c,n,s,o,u,t,f,h,k,b,i;return e.pushRemappableOop(O),e.pushRemappableOop(e.floatObjectOf(l)),e.pushRemappableOop(e.floatObjectOf(S)),e.pushRemappableOop(e.floatObjectOf(F)),e.pushRemappableOop(e.floatObjectOf(r)),e.pushRemappableOop(e.floatObjectOf(d)),e.pushRemappableOop(e.floatObjectOf(V)),e.pushRemappableOop(e.floatObjectOf(w)),e.pushRemappableOop(e.floatObjectOf(A)),e.pushRemappableOop(e.floatObjectOf(T)),f=e.floatObjectOf(y),k=e.popRemappableOop(),u=e.popRemappableOop(),o=e.popRemappableOop(),s=e.popRemappableOop(),i=e.popRemappableOop(),b=e.popRemappableOop(),n=e.popRemappableOop(),c=e.popRemappableOop(),h=e.popRemappableOop(),t=e.popRemappableOop(),e.failed()?!1:(e.storePointerofObjectwithValue(2,t,h),e.storeIntegerofObjectwithValue(3,t,a),e.storeIntegerofObjectwithValue(4,t,p),e.storeIntegerofObjectwithValue(5,t,g),e.storeIntegerofObjectwithValue(6,t,m),e.storePointerofObjectwithValue(7,t,c),e.storePointerofObjectwithValue(8,t,n),e.storePointerofObjectwithValue(9,t,b),e.storePointerofObjectwithValue(10,t,i),e.storePointerofObjectwithValue(11,t,s),e.storePointerofObjectwithValue(12,t,o),e.storePointerofObjectwithValue(13,t,u),e.storePointerofObjectwithValue(14,t,k),e.storePointerofObjectwithValue(15,t,f),e.storeIntegerofObjectwithValue(16,t,v),e.storeIntegerofObjectwithValue(17,t,I),e.storeIntegerofObjectwithValue(18,t,P),e.failed()===!1)}function bi(k){var h,r,a,u,l,e,p,d,m,v,i;t=k,v=.6*n(t[Qt]),i=.6*n(t[Yt]),h=.4*n(t[li]),a=.15*n(t[oi]),l=.06*n(t[si]),p=.04*n(t[ri]),r=.15*n(t[Mt]),u=.06*n(t[ai]),e=.04*n(t[ni]),d=.022*n(t[ei]),m=.03*n(t[$t]),s>=8&&(f>=16e3?c($,7500,600):s=6),s>=7&&(f>=16e3?c(et,6500,500):s=6),s>=6&&c(it,t[wt],t[zt]),s>=5&&c(at,t[Ct],t[Ut]),c(ft,t[D],t[lt]),c(dt,t[W],t[ot]),c(gt,t[_],t[st]),c(Vt,t[Ot],t[nt]),c(Q,t[jt],t[mt]),c(J,t[qt],t[kt]),L(Y,t[Wt],t[Et]),L(G,t[ui],t[Rt]),o(Z,t[jt],t[mt],v),o(U,t[qt],t[kt],i),o(St,t[Ot],t[nt],h),o(vt,t[_],t[st],a),o(ht,t[W],t[ot],l),o(ut,t[D],t[lt],p),o(bt,t[_],t[Xt],r),o(pt,t[W],t[Ht],u),o(ct,t[D],t[Jt],e),o(rt,t[Ct],t[Gt],d),o(tt,t[wt],t[Kt],m)}function ki(i){var t;return e=i,t=e.majorVersion()==pi,t===!1?!1:t=e.minorVersion()>=ci}function vi(_,N,B){var P,x,S,V,w,C,d,b,h,r,e,c,v,u,s,j,k,a,F;for(bi(_),l>0?(F=n(t[q]-7),v=n(t[q]),k=.1*n(t[hi])):F=v=k=0,w=.25*n(t[Bt]),x=.05*n(t[Zt]),V=.05*n(t[Wi]),d=t[Nt]-3,0>=d&&(d=57),P=n(d),o(H,0,f,P),r=y,h=B,j=M+B-1;j>=h;)r=(O()-32768)/4,r+=.75*y,y=r,p>m&&(r=.5*r),C=w*r,a=wi(),T=a,g>p&&(a+=k*(O()-32768)/4),b=F*a,c=v*a,S=x*r,b+=S,c+=S,e=xi(b),u=c,e+=Ii(u),u=C+c-A,A=c,e=Ai(u)-e,e=V*u-e,e=i(H,e),s=e*P|0,-32768>s&&(s=-32768),s>32767&&(s=32767),N[h-1]=s,++h,++I}function mi(){l=t[b],Ni(),Mi(),Bi(),0>l&&(l=0),a=f/l|0,m=a,t[q]>0&&(m>>=1),g=a*t[C]|0,yi(t[C],t[ti],t[ii]),qi(),_i()}function di(n,s,a,o){var r,i,l,u,t,e,c;if(u=k(0,n,s,a,o),u>0)for(t=0,e=1,r=u,i=k(e,n,s,a,o);i>0;)t=e,r=i,e=2*e,i=k(e,n,s,a,o);else for(t=-1,e=0,r=k(t,n,s,a,o),i=u;0>r;)e=t,i=r,t=2*t,r=k(t,n,s,a,o);for(;e-t>Tt;)c=(e+t)/2,l=k(c,n,s,a,o),l>0?(t=c,r=l):(e=c,i=l);return(e+t)/2}var pi=1,ci=11,li=46,Mt=34,oi=47,ai=35,si=48,ni=36,ri=49,ei=37,$t=38,Qt=45,Zt=9,Yt=50,nt=13,st=17,Xt=40,ot=19,Ht=41,lt=21,Jt=42,Ut=23,Gt=43,zt=25,Kt=44,mt=27,Et=29,kt=31,Rt=33,Wi=39,B=4,Tt=1e-4,b=0,Ot=12,_=16,W=18,D=20,Ct=22,wt=24,Dt=1,jt=26,Wt=28,Bt=10,qt=30,ui=32,Nt=51,_t=2,h=3.141592653589793,Vt=12,St=3,gt=13,bt=7,vt=4,dt=14,pt=8,ht=5,ft=15,ct=9,ut=6,at=16,rt=10,it=17,tt=11,et=18,$=19,ti=7,ii=8,Q=20,Z=1,Y=21,C=6,H=24,J=22,U=2,G=23,fi=3,hi=11,q=5,S=0,F=0,V=0,w=0,s=0,t=null,A=0,e=null,Fi="Klatt 3 November 2014 (e)",y=0,m=0,g=0,p=0,v=0,l=0,u=null,I=0,M=0,f=0,P=0,a=0,T=0,r=0,d=0;Squeak.registerExternalModule("Klatt",{setInterpreter:ki,primitiveSynthesizeFrameIntoStartingAt:Si,getModuleName:Vi})}),module("users.bert.SqueakJS.plugins.LargeIntegers").requires("users.bert.SqueakJS.vm").toRun(function(){function s(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function i(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function O(e,t){return 0|Math.floor(e/t)}function c(e,t){return e-O(e,t)*t|0}function m(t,e){return e>31?0:t<<e}function u(t,e){return e>31?0:t>>>e}function St(v,o,p){var a,h,t,l,f,i,s,d,n;if(1>o||1>p)return e.primitiveFail();if(t=v,s=Math.min(p,Ft(t)),o>s)return!1;if(i=(o-1>>3)+1,a=(s-1>>3)+1,f=c(o-1,8),l=7-c(s-1,8),i===a)return d=m(255,f)&u(255,l),h=r(t,i),0!==(h&d);if(0!==u(r(t,i),f))return!0;for(n=i+1;a-1>=n;n++)if(0!==r(t,n))return!0;return 0!==(255&m(r(t,a),l))?!0:!1}function v(t,r){var n,o,a;return a=e.instantiateClassindexableSize(s(t),r),n=i(t),o=r>n?n:r,q(t.bytes,a.bytes,o),a}function A(i,n){var s,r,t;return"number"==typeof i?(r=i,s=0>r?e.classLargeNegativeInteger():e.classLargePositiveInteger(),t=e.instantiateClassindexableSize(s,n),gt(r,t)):t=v(i,n),t}function gt(t,n){var i,e,r;for(i=n.bytes,e=1,r=g(t);r>=e;e++)i[e-1]=o(t,e)}function bt(a,r,n,o,s){var e,i,t;for(t=0,i=r-1,e=0;i>=e;e++)t=(t>>>8)+a[e]+n[e],s[e]=255&t;for(i=o-1,e=r;i>=e;e++)t=(t>>>8)+n[e],s[e]=255&t;return t>>>8}function V(r,n,s){var t,i,e;for(e=s-1;e>=0;){if((i=n[e])!==(t=r[e]))return t>i?1:-1;--e}return 0}function q(i,r,n){var t,e;for(t=n-1,e=0;t>=e;e++)r[e]=i[e];return 0}function mt(d,k,o,A,I,y){var m,a,s,f,t,n,F,b,g,r,p,i,e,u,S,h,l,v;for(u=k-1,S=y,l=d[u-1],f=1===u?0:d[u-2],p=1;S>=p;p++){if(i=A+1-p,o[i-1]===l)a=255;else for(h=o[i-1],h=(h<<8)+o[i-2],v=c(h,l),a=O(h,l),b=a*f,n=b>>>8,t=255&b,F=3>i?0:o[i-3];;){if(n>v||v===n&&t>F?(--a,f>t?(--n,t=t+256-f):t-=f,g=n>=l):g=!1,!g)break;n-=l}for(r=i-u,s=0,e=1;k>=e;e++)n=d[e-1]*(a>>>8),t=d[e-1]*(255&a),m=o[r-1]-s-(255&t),o[r-1]=255&m,m>>=8,s=n+(t>>>8)-m,++r;if(s>0)for(--a,r=i-u,s=0,e=1;k>=e;e++)s=(s>>>8)+o[r-1]+d[e-1],o[r-1]=255&s,++r;I[y-p]=a}return 0}function b(i,r){var t,e;for(e=r;0===(t=i[e-1]);)if(0===--e)return 0;return I(t)+8*(e-1)}function g(e){return 256>e&&e>-256?1:65536>e&&e>-65536?2:16777216>e&&e>-16777216?3:4}function E(h,o,p,r,l){var s,t,a,e,i,f,n;for(s=h>>3,i=c(h,8),n=s-1,e=0;n>=e;e++)r[e]=0;if(0===i)return S(r,s,l-1,o,0);for(f=8-i,t=0,n=p-1,e=0;n>=e;e++)a=o[e],r[e+s]=255&(t|m(a,i)),t=u(a,f);return 0!==t&&(r[l-1]=t),0}function R(m,u,d,l,n,c,f,r){var t,i,o,s,h,p,a,e;for(p=u-1,h=l-1,s=c-1,o=0,i=0;p>=i;i++){for(e=r[0]+m[i]*d[0],a=e*f&255,e+=a*n[0],t=1;h>=t;t++)e=(e>>>8)+r[t]+m[i]*d[t]+a*n[t],r[t-1]=255&e;for(t=l;s>=t;t++)e=(e>>>8)+r[t]+a*n[t],r[t-1]=255&e;e=(e>>>8)+o,r[s]=255&e,o=e>>>8}for(i=u;s>=i;i++){for(e=r[0],a=e*f&255,e+=a*n[0],t=1;s>=t;t++)e=(e>>>8)+r[t]+a*n[t],r[t-1]=255&e;e=(e>>>8)+o,r[s]=255&e,o=e>>>8}if(0!==o||1!==V(n,r,c))for(e=0,i=0;s>=i;i++)e=e+r[i]-n[i],r[i]=255&e,e>>=8}function L(l,a,f,u,s){var e,r,o,n,t,c,i,h;if(1===a&&0===l[0])return 0;if(1===u&&0===f[0])return 0;for(h=a-1,c=u-1,t=0;h>=t;t++)if(0!==(o=l[t])){for(i=t,n=0,r=0;c>=r;r++)e=f[r],e=e*o+n+s[i],n=e>>>8,s[i]=255&e,++i;s[i]=n}return 0}function o(i,t){return 1>t&&e.primitiveFail(),t>4?0:0>i?255&u(0-i,8*(t-1)):255&u(i,8*(t-1))}function T(a,o,s,n,u,r){var t,i;if(i=s-1,a===C){for(t=0;i>=t;t++)r[t]=o[t]&n[t];for(i=u-1,t=s;i>=t;t++)r[t]=0;return 0}if(a===F){for(t=0;i>=t;t++)r[t]=o[t]|n[t];for(i=u-1,t=s;i>=t;t++)r[t]=n[t];return 0}if(a===P){for(t=0;i>=t;t++)r[t]=o[t]^n[t];for(i=u-1,t=s;i>=t;t++)r[t]=n[t];return 0}return e.primitiveFail()}function S(t,e,i,r,n){return function(){for(var a=i-e+1,s=0;a>s;s++)t[s+e]=r[s+n];return 0}()}function D(p,a,d,o,l){var t,r,i,n,e,f,h,s;if(r=p>>3,e=c(p,8),0===e)return S(o,0,l-1,a,r);for(f=8-e,i=u(a[r],e),s=r+1,h=d-1,t=s;h>=t;t++)n=a[t],o[t-s]=255&(i|m(n,f)),i=u(n,e);return 0!==i&&(o[l-1]=i),0}function it(s,i,r,a,n){var e,t;for(t=0,e=0;i-1>=e;e++)t=t+r[e]-s[e],n[e]=255&t,t>>=8;for(e=i;a-1>=e;e++)t+=r[e],n[e]=255&t,t>>=8}function I(i){var e,t;return e=i,t=0,65536>e||(e>>>=16,t+=16),256>e||(e>>>=8,t+=8),16>e||(e>>>=4,t+=4),4>e||(e>>>=2,t+=2),2>e||(e>>>=1,++t),t+e}function t(u){var r,n,s,t,a,i;for(i=u,a=0>i?e.classLargeNegativeInteger():e.classLargePositiveInteger(),r=g(i),n=e.instantiateClassindexableSize(a,r),s=n.bytes,t=1;r>=t;t++)s[t-1]=o(i,t);return n}function h(t,o){var r,n,a,u;return n=i(t),0===(u=b(t.bytes,n))?0:(r=u+o+7>>3,a=e.instantiateClassindexableSize(s(t),r),E(o,t.bytes,n,a.bytes,r),a)}function d(t,o,l){var i,u,r,n,a;return a=b(t.bytes,l),u=a+7>>3,n=a-o,0>=n?e.instantiateClassindexableSize(s(t),0):(r=n+7>>3,i=e.instantiateClassindexableSize(s(t),r),D(o,t.bytes,u,i.bytes,r),i)}function w(n,l){var r,h,p,u,d,c,t,a,o,f;return a=i(n),o=i(l),d=s(n),o>=a?(u=n,h=a,f=l,t=o):(u=l,h=o,f=n,t=a),r=e.instantiateClassindexableSize(d,t),p=bt(u.bytes,h,f.bytes,t,r.bytes),p>0&&(c=e.instantiateClassindexableSize(d,t+1),q(r.bytes,c.bytes,t),r=c,r.bytes[t]=p),r}function p(n,a,v){var p,h,o,r,u,d,c,f,m;if("number"==typeof n){if(0>n)return e.primitiveFail();o=t(n)}else{if(s(n)===e.classLargeNegativeInteger())return e.primitiveFail();o=n}if("number"==typeof a){if(0>a)return e.primitiveFail();r=t(a)}else{if(s(a)===e.classLargeNegativeInteger())return e.primitiveFail();r=a}return c=i(o),f=i(r),f>c?(p=c,h=o,u=f,d=r):(p=f,h=r,u=c,d=o),m=e.instantiateClassindexableSize(e.classLargePositiveInteger(),u),T(v,h.bytes,p,d.bytes,u,m.bytes),e.failed()?0:l(m)}function j(r,n){var t,e;return e=i(r),t=i(n),t!==e?t>e?-1:1:V(r.bytes,n.bytes,e)}function x(m,c,k){var v,r,t,s,o,l,f,p,u;return u=i(m),p=i(c),v=k?e.classLargeNegativeInteger():e.classLargePositiveInteger(),f=u-p+1,0>=f?(r=e.instantiateClassindexableSize(e.classArray(),2),e.stObjectatput(r,1,0),e.stObjectatput(r,2,m),r):(l=8-I(n(c,p)),s=h(c,l),s=A(s,a(s)+1),t=h(m,l),a(t)===u&&(t=A(t,u+1)),o=e.instantiateClassindexableSize(v,f),mt(s.bytes,a(s),t.bytes,a(t),o.bytes,a(o)),t=d(t,l,a(s)-1),r=e.instantiateClassindexableSize(e.classArray(),2),e.stObjectatput(r,1,o),e.stObjectatput(r,2,t),r)}function a(e){return"number"==typeof e?g(e):i(e)}function W(o,u,c,r){var n,t,s,a;return s=i(o),a=i(u),t=i(c),t>=s&&t>=a&&r>=0&&255>=r?(n=e.instantiateClassindexableSize(e.classLargePositiveInteger(),t),R(o.bytes,s,u.bytes,a,c.bytes,t,r,n.bytes),l(n)):e.primitiveFail()}function B(c,a,p){var u,h,t,o,s,l,n,r;return r=i(c),n=i(a),n>=r?(o=c,t=r,u=a,s=n):(o=a,t=n,u=c,s=r),h=p?e.classLargeNegativeInteger():e.classLargePositiveInteger(),l=e.instantiateClassindexableSize(h,s+t),L(o.bytes,t,u.bytes,s,l.bytes),f(l)}function r(e,t){return t>i(e)?0:n(e,t)}function M(a,o){var m,d,u,h,v,c,p,t,n,f;if(p=s(a)===e.classLargeNegativeInteger(),t=i(a),n=i(o),t===n){for(;t>1&&r(a,t)===r(o,t);)--t;n=t}return n>t||t===n&&r(a,t)<r(o,t)?(d=o,c=n,h=a,m=t,f=p===!1):(d=a,c=t,h=o,m=n,f=p),v=c,u=e.instantiateClassindexableSize(f?e.classLargeNegativeInteger():e.classLargePositiveInteger(),v),it(h.bytes,m,d.bytes,c,u.bytes),f?y(u):l(u)}function k(){return yt}function Ft(e){return b(e.bytes,i(e))}function N(i){var r,u,t,l,c;if("number"==typeof i)return!0;if(u=a(i),0===u)return!1;if(0===n(i,u))return!1;if(t=4,u>t)return!0;if(t>u)return!1;if(s(i)===e.classLargePositiveInteger())return c=1073741823,n(i,t)>o(c,t);if(l=-1073741824,n(i,t)<o(l,t))return!1;for(r=1;t>=r;r++)if(n(i,r)!==o(l,r))return!0;return!1}function f(t){return s(t)===e.classLargePositiveInteger()?l(t):y(t)}function y(t){var i,e,s,u,c,l;for(e=c=a(t);0!==e&&0===n(t,e);)--e;if(0===e)return 0;if(s=4,s>=e){if(u=-1073741824,s>e||r(t,s)<o(u,s)){for(l=0,i=e;i>=1;i+=-1)l=256*l-n(t,i);return l}for(i=1;s>=i;i++)if(r(t,i)!==o(u,i))return c>e?v(t,e):t;return u}return c>e?v(t,e):t}function l(t){var i,e,s,u,l;for(e=l=a(t);0!==e&&0===n(t,e);)--e;if(0===e)return 0;if(s=4,s>=e&&r(t,s)<=o(1073741823,s)){for(u=0,i=e;i>=1;i+=-1)u=256*u+n(t,i);return u}return l>e?v(t,e):t}function K(){var i,r,n,s,a;return n=e.stackIntegerValue(1),s=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(2))),i=e.stackValue(2),e.failed()?null:(r="number"==typeof i?t(i):i,a=St(r,n,s)?e.trueObject():e.falseObject(),e.failed()?null:(e.popthenPush(3,a),null))}function z(){var i,r;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.failed()?null:"number"==typeof i?(r=t(i),e.failed()?null:(e.popthenPush(2,r),null)):e.failed()?null:(e.popthenPush(2,i),null)}function G(){var t;return t=e.trueObject(),e.failed()?null:(e.popthenPush(1,t),null)}function U(){var o,r,n,s,a;return e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),s=e.stackIntegerValue(0),e.failed()?null:(r="number"==typeof n?t(n):n,s>=0?(a=h(r,s),e.failed()?null:(e.popthenPush(3,a),null)):(o=0-s,a=f(d(r,o,i(r))),e.failed()?null:(e.popthenPush(3,a),null)))}function J(){var n,i,s,r,a;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),e.failed()?null:(n="number"==typeof i?t(i):i,s="number"==typeof r?t(r):r,a=w(n,s),e.failed()?null:(e.popthenPush(2,a),null))}function H(){var n,s,i,r,a;return e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.failed()?null:(n="number"==typeof i?t(i):i,s="number"==typeof r?t(r):r,a=w(n,s),e.failed()?null:(e.popthenPush(3,a),null))}function X(){var t,i,r;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),t=e.stackValue(1),e.failed()?null:(r=p(t,i,C),e.failed()?null:(e.popthenPush(2,r),null))}function Y(){var t,i,r,n;return e.success(e.isKindOfInteger(e.stackValue(2))),t=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),r=e.stackIntegerValue(0),e.failed()?null:(n=p(t,i,r),e.failed()?null:(e.popthenPush(4,n),null))}function Z(){var t,i,r;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),t=e.stackValue(1),e.failed()?null:(r=p(t,i,F),e.failed()?null:(e.popthenPush(2,r),null))}function Q(){var r,o,n,s,a;return s=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),e.failed()?null:(r="number"==typeof n?t(n):n,s>=0?(a=h(r,s),e.failed()?null:(e.popthenPush(2,a),null)):(o=0-s,a=f(d(r,o,i(r))),e.failed()?null:(e.popthenPush(2,a),null)))}function $(){var r,o,n,s,a;return s=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),e.failed()?null:(r="number"==typeof n?t(n):n,s>=0?(a=h(r,s),e.failed()?null:(e.popthenPush(2,a),null)):(o=0-s,a=f(d(r,o,i(r))),e.failed()?null:(e.popthenPush(2,a),null)))}function et(){var t,i,r;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),t=e.stackValue(1),e.failed()?null:(r=p(t,i,P),e.failed()?null:(e.popthenPush(2,r),null))}function tt(){var n,r,s,i,t;return e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),e.failed()?null:"number"==typeof r?"number"==typeof i?(n=r)>(s=i)?(t=1,e.failed()?null:(e.popthenPush(2,t),null)):s>n?(t=-1,e.failed()?null:(e.popthenPush(2,t),null)):(t=0,e.failed()?null:(e.popthenPush(2,t),null)):(t=-1,e.failed()?null:(e.popthenPush(2,t),null)):"number"==typeof i?(t=1,e.failed()?null:(e.popthenPush(2,t),null)):(t=j(r,i),e.failed()?null:(e.popthenPush(2,t),null))
}function _(){var n,s,r,i,t;return e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),e.success(e.isKindOfInteger(e.stackValue(0))),i=e.stackValue(0),e.failed()?null:"number"==typeof r?"number"==typeof i?(n=r)>(s=i)?(t=1,e.failed()?null:(e.popthenPush(3,t),null)):s>n?(t=-1,e.failed()?null:(e.popthenPush(3,t),null)):(t=0,e.failed()?null:(e.popthenPush(3,t),null)):(t=-1,e.failed()?null:(e.popthenPush(3,t),null)):"number"==typeof i?(t=1,e.failed()?null:(e.popthenPush(3,t),null)):(t=j(r,i),e.failed()?null:(e.popthenPush(3,t),null))}function rt(){var s,r,n,i,a,o;if(e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.success(e.isKindOfInteger(e.stackValue(2))),r=e.stackValue(2),e.failed())return null;if(!N(r))return e.primitiveFail(),null;if(!N(i))return e.primitiveFail(),null;if(s="number"==typeof r?t(r):r,"number"==typeof i){if(0===i)return e.primitiveFail(),null;n=t(i)}else n=i;return o=x(s,n,a),e.failed()?null:(e.popthenPush(3,o),null)}function nt(){var s,n,r,i,a,o;if(e.success(e.isKindOfInteger(e.stackValue(2))),r=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.failed())return null;if(s="number"==typeof r?t(r):r,"number"==typeof i){if(0===i)return e.primitiveFail(),null;n=t(i)}else n=i;return o=x(s,n,a),e.failed()?null:(e.popthenPush(4,o),null)}function st(){var n,i,s,r,a,o;return e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.success(e.isKindOfInteger(e.stackValue(2))),i=e.stackValue(2),e.failed()?null:(n="number"==typeof i?t(i):i,s="number"==typeof r?t(r):r,o=B(n,s,a),e.failed()?null:(e.popthenPush(3,o),null))}function at(){var n,s,i,r,a,o;return e.success(e.isKindOfInteger(e.stackValue(2))),i=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),r=e.stackValue(1),a=e.booleanValueOf(e.stackValue(0)),e.failed()?null:(n="number"==typeof i?t(i):i,s="number"==typeof r?t(r):r,o=B(n,s,a),e.failed()?null:(e.popthenPush(4,o),null))}function ot(){var n,i,s,r,a;return e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),e.failed()?null:(n="number"==typeof i?t(i):i,s="number"==typeof r?t(r):r,a=M(n,s),e.failed()?null:(e.popthenPush(2,a),null))}function ut(){var n,s,i,r,a;return e.success(e.isKindOfInteger(e.stackValue(1))),i=e.stackValue(1),e.success(e.isKindOfInteger(e.stackValue(0))),r=e.stackValue(0),e.failed()?null:(n="number"==typeof i?t(i):i,s="number"==typeof r?t(r):r,a=M(n,s),e.failed()?null:(e.popthenPush(3,a),null))}function lt(){var n,i,t,r;for(i=strlen(k()),r=e.instantiateClassindexableSize(e.classString(),i),n=r.bytes,t=0;i-1>=t;t++)n[t]=k()[t];return e.failed()?null:(e.popthenPush(1,r),null)}function ct(){var s,a,i,o,r,n,u,l;return e.success(e.isKindOfInteger(e.stackValue(2))),r=e.stackValue(2),e.success(e.isKindOfInteger(e.stackValue(1))),n=e.stackValue(1),u=e.stackIntegerValue(0),e.success(e.isKindOfInteger(e.stackValue(3))),i=e.stackValue(3),e.failed()?null:(s="number"==typeof i?t(i):i,a="number"==typeof r?t(r):r,o="number"==typeof n?t(n):n,l=W(s,a,o,u),e.failed()?null:(e.popthenPush(4,l),null))}function ft(){var t,i;return e.success(e.isKindOfInteger(e.stackValue(0))),t=e.stackValue(0),e.failed()?null:"number"==typeof t?e.failed()?null:(e.popthenPush(2,t),null):(i=f(t),e.failed()?null:(e.popthenPush(2,i),null))}function ht(){var t,i;return e.success(e.stackValue(0).sqClass===e.classLargeNegativeInteger()),t=e.stackValue(0),e.failed()?null:(i=y(t),e.failed()?null:(e.popthenPush(1,i),null))}function pt(){var t,i;return e.success(e.stackValue(0).sqClass===e.classLargePositiveInteger()),t=e.stackValue(0),e.failed()?null:(i=l(t),e.failed()?null:(e.popthenPush(1,i),null))}function dt(i){var t;return e=i,t=e.majorVersion()==vt,t===!1?!1:t=e.minorVersion()>=kt}function n(e,t){var i;return(i=e.bytes)[t-1]}var vt=1,kt=11,C=0,e=null,yt="LargeIntegers v1.5 (e)",F=1,P=2;Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:H,primDigitBitShiftMagnitude:$,primGetModuleName:lt,primDigitBitLogicWithOp:Y,primCheckIfCModuleExists:G,primDigitCompare:tt,primDigitMultiplyNegative:st,primDigitBitShift:Q,primNormalizePositive:pt,primDigitSubtractWith:ut,_primDigitBitShift:U,primDigitMultiplyWithNegative:at,primDigitSubtract:ot,primDigitDivNegative:rt,primNormalizeNegative:ht,primDigitBitOr:Z,primMontgomeryTimesModulo:ct,primDigitBitAnd:X,primDigitDivWithNegative:nt,setInterpreter:dt,primNormalize:ft,primDigitBitXor:et,primDigitCompareWith:_,primDigitAdd:J,getModuleName:k,primAsLargeInteger:z,primAnyBitFromTo:K})}),module("users.bert.SqueakJS.plugins.Matrix2x3Plugin").requires("users.bert.SqueakJS.vm").toRun(function(){function u(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function f(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function v(){return A}function s(t){return e.failed()?null:e.isWords(t)&&6===f(t)?t.wordsAsFloat32Array():(e.primitiveFail(),null)}function a(s){var i,t;return e.failed()?null:u(s)!==e.classPoint()?e.primitiveFail():(t=e.fetchPointerofObject(0,s),i="number"==typeof t,i||t.isFloat?(n=i?t:e.floatValueOf(t),t=e.fetchPointerofObject(1,s),i="number"==typeof t,i||t.isFloat?void(r=i?t:e.floatValueOf(t)):e.primitiveFail()):e.primitiveFail())}function k(e,t,i){var r,n,s,a,o,u;r=e[0]*t[0]+e[1]*t[3],n=e[0]*t[1]+e[1]*t[4],s=e[0]*t[2]+e[1]*t[5]+e[2],a=e[3]*t[0]+e[4]*t[3],o=e[3]*t[1]+e[4]*t[4],u=e[3]*t[2]+e[4]*t[5]+e[5],i[0]=r,i[1]=n,i[2]=s,i[3]=a,i[4]=o,i[5]=u}function l(s){var a,l,c,o,u;return o=n-s[2],u=r-s[5],a=s[0]*s[4]-s[1]*s[3],0===a?e.primitiveFail():(a=1/a,l=o*s[4]-s[1]*u,c=s[0]*u-o*s[3],t=l*a,void(i=c*a))}function c(e){t=n*e[0]+r*e[1]+e[2],i=n*e[3]+r*e[4]+e[5]}function o(e){return e>=-1073741824&&1073741823>=t}function S(){var t,i,r,n;return r=s(n=e.stackObjectValue(0)),i=s(e.stackObjectValue(1)),t=s(e.stackObjectValue(2)),e.failed()?null:(k(t,i,r),void e.popthenPush(3,n))}function F(){var t;return a(e.stackObjectValue(0)),t=s(e.stackObjectValue(1)),e.failed()?null:(l(t),void(e.failed()||p(2)))}function O(){var S,b,k,v,d,o,p,c,g,y,m;return k=e.stackObjectValue(0),m=e.stackObjectValue(1),v=s(e.stackObjectValue(2)),e.failed()?null:u(m)!==u(k)?e.primitiveFail():e.isPointers(m)?2!==f(m)?e.primitiveFail():(a(e.fetchPointerofObject(0,m)),e.failed()?null:(g=n,y=r,l(v),p=d=t,c=o=i,a(e.fetchPointerofObject(1,m)),e.failed()?null:(S=n,b=r,l(v),p=Math.min(p,t),d=Math.max(d,t),c=Math.min(c,i),o=Math.max(o,i),n=S,r=y,l(v),p=Math.min(p,t),d=Math.max(d,t),c=Math.min(c,i),o=Math.max(o,i),n=g,r=b,l(v),p=Math.min(p,t),d=Math.max(d,t),c=Math.min(c,i),o=Math.max(o,i),e.failed()||(k=h(k,p,c,d,o)),void(e.failed()||e.popthenPush(3,k))))):e.primitiveFail()}function I(){var t;return t=s(e.stackObjectValue(0)),e.failed()?null:(e.pop(1),void e.pushBool(1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]))}function P(){var t;return t=s(e.stackObjectValue(0)),e.failed()?null:(e.pop(1),void e.pushBool(1===t[0]&&0===t[1]&&0===t[3]&&1===t[4]))}function d(){var t;return a(e.stackObjectValue(0)),t=s(e.stackObjectValue(1)),e.failed()?null:(c(t),void p(2))}function m(){var S,b,k,v,d,o,p,l,g,y,m;return k=e.stackObjectValue(0),m=e.stackObjectValue(1),v=s(e.stackObjectValue(2)),e.failed()?null:u(m)!==u(k)?e.primitiveFail():e.isPointers(m)?2!==f(m)?e.primitiveFail():(a(e.fetchPointerofObject(0,m)),e.failed()?null:(g=n,y=r,c(v),p=d=t,l=o=i,a(e.fetchPointerofObject(1,m)),e.failed()?null:(S=n,b=r,c(v),p=Math.min(p,t),d=Math.max(d,t),l=Math.min(l,i),o=Math.max(o,i),n=S,r=y,c(v),p=Math.min(p,t),d=Math.max(d,t),l=Math.min(l,i),o=Math.max(o,i),n=g,r=b,c(v),p=Math.min(p,t),d=Math.max(d,t),l=Math.min(l,i),o=Math.max(o,i),k=h(k,p,l,d,o),void(e.failed()||e.popthenPush(3,k))))):e.primitiveFail()}function p(r){return t+=.5,i+=.5,o(t)&&o(i)?void e.popthenPush(r,e.makePointwithxValueyValue(0|t,0|i)):e.primitiveFail()}function h(p,l,h,f,c){var u,r,a,s,n,i,t;return s=l+.5,o(s)?(r=f+.5,o(r)?(n=h+.5,o(n)?(a=c+.5,o(a)?(e.pushRemappableOop(p),i=e.makePointwithxValueyValue(0|s,0|n),e.pushRemappableOop(i),u=e.makePointwithxValueyValue(0|r,0|a),i=e.popRemappableOop(),t=e.popRemappableOop(),e.storePointerofObjectwithValue(0,t,i),e.storePointerofObjectwithValue(1,t,u),t):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()):e.primitiveFail()}function b(i){var t;return e=i,t=e.majorVersion()==g,t===!1?!1:t=e.minorVersion()>=y}var g=1,y=11,e=null,n=0,r=0,t=0,i=0,A="Matrix2x3Plugin 3 November 2014 (e)";Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:F,primitiveInvertRectInto:O,primitiveIsIdentity:I,primitiveComposeMatrix:S,setInterpreter:b,primitiveTransformRectInto:m,primitiveIsPureTranslation:P,getModuleName:v,primitiveTransformPoint:d})}),module("users.bert.SqueakJS.plugins.MiscPrimitivePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function b(e,t){return 0|Math.floor(e/t)}function c(e,t){return e-b(e,t)*t|0}function n(t,e){return e>31?0:t>>>e}function i(i,r,t){var e;for(e=0;3>=e;e++)r[t+e-1]=255&n(i,8*(3-e));return t+4}function t(t,r,e){return 223>=t?(r[e-1]=t,e+1):7935>=t?(r[e-1]=(t>>8)+224,r[e]=c(t,256),e+2):(r[e-1]=255,i(t,r,e+1))}function s(){return g}function a(){var l,n,s,a,o,u,t,i,r;if(l=e.stackValue(3),n=e.stackBytes(2),s=e.stackBytes(1),a=e.stackBytes(0),e.failed())return null;for(i=n.length,r=s.length,t=1;t<=Math.min(i,r);t++)if(o=a[n[t-1]],u=a[s[t-1]],o!==u)return u>o?e.failed()?null:(e.popthenPush(4,1),null):e.failed()?null:(e.popthenPush(4,3),null);return i===r?e.failed()?null:(e.popthenPush(4,2),null):r>i?e.failed()?null:(e.popthenPush(4,1),null):e.failed()?null:(e.popthenPush(4,3),null)}function o(){var p,u,a,h,r,n,s,l,f,c,o;if(p=e.stackValue(2),u=e.stackInt32Array(1),a=e.stackBytes(0),e.failed())return null;for(c=u.length,r=t(c,a,1),s=1;c>=s;){for(o=u[s-1],l=255&o,h=(o>>>8&255)===l&&(o>>>16&255)===l&&(o>>>24&255)===l,n=s;c>n&&o===u[n];)++n;if(n>s)h?(r=t(4*(n-s+1)+1,a,r),a[r-1]=l,++r):(r=t(4*(n-s+1)+2,a,r),r=i(o,a,r)),s=n+1;else if(h)r=t(5,a,r),a[r-1]=l,++r,++s;else{for(;c>n&&u[n-1]!==u[n];)++n;for(n===c&&++n,r=t(4*(n-s)+3,a,r),f=s;n-1>=f;f++)r=i(u[f-1],a,r);s=n}}return e.failed()?null:(e.popthenPush(3,r-1),null)}function u(){var a,r,n,t,s,i;if(a=e.stackValue(2),r=e.stackBytes(1),n=e.stackUint16Array(0),e.failed())return null;for(s=r.length,t=1;s>=t;t++)i=r[t-1],n[t-1]=i>127?i-256<<8:i<<8;return e.failed()?null:void e.pop(2)}function l(){var d,o,a,h,n,l,i,f,r,t,s,c,u,p;if(d=e.stackValue(3),o=e.stackInt32Array(2),a=e.stackBytes(1),h=e.stackIntegerValue(0),e.failed())return null;for(r=h,f=a.length,s=1,p=o.length+1;f>=r;){if(n=a[r-1],++r,!(223>=n))if(254>=n)n=256*(n-224)+a[r-1],++r;else for(n=0,t=1;4>=t;t++)n=(n<<8)+a[r-1],++r;if(u=n>>>2,s+u>p)return e.primitiveFail(),null;if(l=3&n,1===l)for(i=a[r-1],++r,i|=i<<8,i|=i<<16,t=1;u>=t;t++)o[s-1]=i,++s;if(2===l){for(i=0,t=1;4>=t;t++)i=i<<8|a[r-1],++r;for(t=1;u>=t;t++)o[s-1]=i,++s}if(3===l)for(c=1;u>=c;c++){for(i=0,t=1;4>=t;t++)i=i<<8|a[r-1],++r;o[s-1]=i,++s}}return e.failed()?null:void e.pop(3)}function r(){var a,i,r,s,t,n;if(a=e.stackValue(3),i=e.stackBytes(2),r=e.stackBytes(1),s=e.stackIntegerValue(0),e.failed())return null;if(256!==r.length)return e.failed()?null:(e.popthenPush(4,0),null);for(t=s,n=i.length;n>=t&&0===r[i[t-1]];)++t;return t>n?e.failed()?null:(e.popthenPush(4,0),null):e.failed()?null:(e.popthenPush(4,t),null)}function f(){var o,t,n,a,s,i,r;if(o=e.stackValue(4),t=e.stackBytes(3),n=e.stackBytes(2),a=e.stackIntegerValue(1),s=e.stackBytes(0),e.failed())return null;if(0===t.length)return e.failed()?null:(e.popthenPush(5,0),null);for(r=a;r<=n.length-t.length+1;r++)for(i=1;s[n[r+i-1-1]]===s[t[i-1]];){if(i===t.length)return e.failed()?null:(e.popthenPush(5,r),null);++i}return e.failed()?null:(e.popthenPush(5,0),null)}function h(){var a,r,i,n,t,s;if(a=e.stackValue(3),r=e.stackIntegerValue(2),i=e.stackBytes(1),n=e.stackIntegerValue(0),e.failed())return null;for(s=i.length,t=n;s>=t;t++)if(i[t-1]===r)return e.failed()?null:(e.popthenPush(4,t),null);return e.failed()?null:(e.popthenPush(4,0),null)}function p(){var o,r,s,a,t,n,i;if(o=e.stackValue(2),r=e.stackBytes(1),s=e.stackIntegerValue(0),e.failed())return null;for(a=r.length,t=268435455&s,i=1;a>=i;i++)t+=r[i-1],n=16383&t,t=9741*n+16384*(9741*(t>>>14)+101*n&16383)&268435455;return e.failed()?null:(e.popthenPush(3,t),null)}function d(){var a,i,r,n,s,t;if(a=e.stackValue(4),i=e.stackBytes(3),r=e.stackIntegerValue(2),n=e.stackIntegerValue(1),s=e.stackBytes(0),e.failed())return null;for(t=r;n>=t;t++)i[t-1]=s[i[t-1]];return e.failed()?null:void e.pop(4)}function m(i){var t;return e=i,t=e.majorVersion()==v,t===!1?!1:t=e.minorVersion()>=k}var v=1,k=11,e=null,g="MiscPrimitivePlugin 3 November 2014 (e)";Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:u,primitiveCompareString:a,primitiveTranslateStringWithTable:d,primitiveStringHash:p,primitiveCompressToByteArray:o,primitiveFindSubstring:f,primitiveIndexOfAsciiInString:h,setInterpreter:m,primitiveDecompressFromByteArray:l,getModuleName:s,primitiveFindFirstInString:r})}),module("users.bert.SqueakJS.plugins.ScratchPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function r(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function t(e,t){return 0|Math.floor(e/t)}function n(e,i){return e-t(e,i)*i|0}function s(p,h,f,c,u){var l,r,i,e,a,o,s;return r=t(f,60),l=n(f,60),e=(1e3-c)*u,a=(1e3-t(c*l,60))*u,o=(1e3-t(c*(60-l),60))*u,s=t(1e3*u,3922),e=t(e,3922),a=t(a,3922),o=t(o,3922),0===r&&(i=(s<<16)+(o<<8)+e),1===r&&(i=(a<<16)+(s<<8)+e),2===r&&(i=(e<<16)+(s<<8)+o),3===r&&(i=(e<<16)+(a<<8)+s),4===r&&(i=(o<<16)+(e<<8)+s),5===r&&(i=(s<<16)+(e<<8)+a),0===i&&(i=1),p[h]=i,0}function l(t){return e.success(e.isWordsOrBytes(t)),e.failed()?0:t.wordsAsFloat64Array()}function i(t){return e.success(e.isWords(t)),e.failed()?0:t.words}function d(){return C}function a(r,n,a,o,s){var i,e;return e=s-o,0===e?0:(i=r===s?t(60*(n-a),e):n===s?120+t(60*(a-r),e):240+t(60*(r-n),e),0>i?i+360:i)}function o(e,t,i){var s,r,a,o,n;return 0===e?t:0===t?e:(r=1024-i,o=r*(e>>>16&255)+i*(t>>>16&255)>>10,a=r*(e>>>8&255)+i*(t>>>8&255)>>10,s=r*(255&e)+i*(255&t)>>10,n=(o<<16)+(a<<8)+s,0===n&&(n=1),n)}function u(l,c,h,u,f){var a,r,s,t,i,e,n;return t=c>>>10,-1>t||t>=u?0:(e=h>>>10,-1>e||e>=f?0:(i=1023&c,-1===t&&(t=0,i=0),t===u-1&&(i=0),n=1023&h,-1===e&&(e=0,n=0),e===f-1&&(n=0),r=e*u+t,s=16777215&l[r],i>0&&(s=o(s,16777215&l[r+1],i)),0===n?s:(r=(e+1)*u+t,a=16777215&l[r],i>0&&(a=o(a,16777215&l[r+1],i)),o(s,a,n))))}function c(){var f,c,l,h,g,b,m,n,y,p,k,u,v,d,o,a,s;if(m=e.stackValue(2),p=e.stackValue(1),o=e.stackIntegerValue(0),b=i(m),y=i(p),d=r(m),e.success(r(p)===d),e.failed())return null;for(g=t(d,o),s=1;g-2>=s;s++)for(a=1;o-2>=a;a++){for(n=v=h=f=0,l=-1;1>=l;l++)for(c=-1;1>=c;c++)u=16777215&b[(s+l)*o+(a+c)],0!==u&&(v+=u>>>16&255,h+=u>>>8&255,f+=255&u,++n);k=0===n?0:(t(v,n)<<16)+(t(h,n)<<8)+t(f,n),y[s*o+a]=k}return e.pop(3),0}function f(){var l,u,c,b,f,S,v,n,o,k,p,h,d,g,y,m;if(v=e.stackValue(2),p=e.stackValue(1),y=e.stackIntegerValue(0),S=i(v),m=r(v),k=i(p),e.success(r(p)===m),e.failed())return null;for(f=0;m-1>=f;f++)h=16777215&S[f],0!==h&&(d=h>>>16&255,c=h>>>8&255,l=255&h,n=o=d,c>n&&(n=c),l>n&&(n=l),o>c&&(o=c),o>l&&(o=l),b=a(d,c,l,o,n),g=0===n?0:t(1e3*(n-o),n),u=t(1e3*n,255),u+=10*y,u>1e3&&(u=1e3),0>u&&(u=0),s(k,f,b,g,u));return e.pop(3),0}function h(){var l,p,s,c,o,u,n,f,a,h,i,d=0,m=0;if(a=e.stackValue(2),s=e.stackValue(1),c=e.stackIntegerValue(0),e.success(e.isWords(a)),e.success(e.isWords(s)),l=t(2*r(a),c),h=2*r(s),e.success(h>=l),e.failed())return null;for(f=a.wordsAsInt16Array(),p=s.wordsAsInt16Array(),o=1;l>=o;o++){for(n=0,u=1;c>=u;u++)i=f[d++],0>i&&(i=0-i),i>n&&(n=i);p[m++]=n}return e.pop(3),0}function p(){var v,l,f,n,m,c,h,u,o,p,d,a,s,r,t;if(h=e.stackValue(7),u=e.stackIntegerValue(6),c=e.stackIntegerValue(5),d=e.stackValue(4),a=e.stackIntegerValue(3),p=e.stackIntegerValue(2),l=e.stackIntegerValue(1),f=e.stackIntegerValue(0),m=i(h),o=i(d),e.success(a>l+2*u),e.success(p>f+2*c),e.failed())return null;for(t=0;c-1>=t;t++)for(v=(f+2*t)*a+l,r=0;u-1>=r;r++)s=m[r+t*u],n=v+2*r,o[n]=s,o[n+1]=s,o[n+a]=s,o[n+a+1]=s;return e.pop(8),0}function w(){var o,t,n,u,l,i,s,a=0,c=0;if(i=e.stackValue(2),t=e.stackValue(1),u=e.booleanValueOf(e.stackValue(0)),e.success(e.isWords(i)),e.success(e.isWords(t)),s=r(i),e.success(r(t)>=s>>1),e.failed())return null;for(l=i.wordsAsInt16Array(),o=t.wordsAsInt16Array(),u&&a++,n=1;s>=n;n++)o[c++]=l[a],a+=2;return e.pop(3),0}function m(){var v,c,a,f,h,o,O,m,F,k,I,S,d,y,g,b,p,n,l,s;if(m=e.stackValue(3),k=e.stackValue(2),n=e.stackIntegerValue(1),S=e.stackIntegerValue(0),O=i(m),F=i(k),p=r(m),e.success(r(k)===p),e.failed())return null;for(o=t(p,n),c=n>>1,a=o>>1,o=t(p,n),c=n>>1,a=o>>1,y=S/100,l=0;n-1>=l;l++)for(s=0;o-1>=s;s++)f=(l-c)/c,h=(s-a)/a,d=Math.pow(Math.sqrt(f*f+h*h),y),1>=d?(v=Math.atan2(h,f),g=1024*(c+d*Math.cos(v)*c)|0,b=1024*(a+d*Math.sin(v)*a)|0):(g=1024*l,b=1024*s),I=u(O,g,b,n,o),F[s*n+l]=I;return e.pop(4),0}function v(){var n,f,k,c,h,p,u,l,y,o,S,g,v,t,s,r,d,m,b,a;if(l=i(e.stackValue(11)),o=e.stackIntegerValue(10),y=e.stackIntegerValue(9),S=i(e.stackValue(8)),v=e.stackIntegerValue(7),g=e.stackIntegerValue(6),d=e.stackIntegerValue(5),m=e.stackIntegerValue(4),h=e.stackIntegerValue(3),p=e.stackIntegerValue(2),c=e.stackIntegerValue(1),f=e.stackIntegerValue(0),e.success(d>=0&&m>=0),e.success(o>=d+2*c),e.success(y>=m+2*f),e.success(h>=0&&p>=0),e.success(v>=h+c),e.success(g>=p+f),e.failed())return null;for(a=0;f-1>=a;a++)for(r=o*(m+2*a)+d,k=v*(p+a)+h,b=0;c-1>=b;b++)t=l[r],s=16711680&t,u=65280&t,n=255&t,t=l[r+1],s+=16711680&t,u+=65280&t,n+=255&t,t=l[r+o],s+=16711680&t,u+=65280&t,n+=255&t,t=l[r+o+1],s+=16711680&t,u+=65280&t,n+=255&t,S[k]=s>>>2&16711680|(u>>>2&65280|n>>>2),r+=2,++k;return e.pop(12),0}function k(){var S,r,d,n,s,a,y,m,g,u,F,b,p,f,h,k,c,l,o,v,t;if(m=i(e.stackValue(11)),u=e.stackIntegerValue(10),g=e.stackIntegerValue(9),F=i(e.stackValue(8)),p=e.stackIntegerValue(7),b=e.stackIntegerValue(6),l=e.stackIntegerValue(5),o=e.stackIntegerValue(4),s=e.stackIntegerValue(3),a=e.stackIntegerValue(2),n=e.stackIntegerValue(1),r=e.stackIntegerValue(0),e.success(l>=0&&o>=0),e.success(u>=l+2*n),e.success(g>=o+2*r),e.success(s>=0&&a>=0),e.success(p>=s+n),e.success(b>=a+r),e.failed())return null;for(t=0;r-1>=t;t++)for(c=u*(o+2*t)+l,d=p*(a+t)+s,v=0;n-1>=v;v++)f=m[c],h=m[c+u+1],k=(16711680&f)+(16711680&h)>>>1&16711680,y=(65280&f)+(65280&h)>>>1&65280,S=(255&f)+(255&h)>>>1,F[d]=k|(y|S),c+=2,++d;return e.pop(12),0}function b(){var f,p,l,m,h,F,k,o,u,y,v,d,g,c,S,b;if(k=e.stackValue(2),v=e.stackValue(1),S=e.stackIntegerValue(0),F=i(k),b=r(k),y=i(v),e.success(r(v)===b),e.failed())return null;for(h=0;b-1>=h;h++)d=16777215&F[h],0!==d&&(g=d>>>16&255,l=d>>>8&255,f=255&d,o=u=g,l>o&&(o=l),f>o&&(o=f),u>l&&(u=l),u>f&&(u=f),p=t(1e3*o,255),c=0===o?0:t(1e3*(o-u),o),110>p&&(p=110,c=1e3),90>c&&(c=90),m=110===p||90===c?0:a(g,l,f,u,o),m=n(m+S+36e7,360),s(y,h,m,c,p));return e.pop(3),0}function g(){var a,n,o,l,s,c,f;return n=e.stackValue(3),s=e.stackIntegerValue(2),c=e.stackIntegerValue(1),f=e.stackIntegerValue(0),a=i(n),l=r(n),e.failed()?null:(o=u(a,c,f,s,t(l,s)),e.pop(5),e.pushInteger(o),0)}function y(){var l,b,c,g,f,S,v,n,u,k,p,h,d,o,y,m;if(v=e.stackValue(2),p=e.stackValue(1),y=e.stackIntegerValue(0),S=i(v),m=r(v),k=i(p),e.success(r(p)===m),e.failed())return null;for(f=0;m-1>=f;f++)h=16777215&S[f],2>h||(d=h>>>16&255,c=h>>>8&255,l=255&h,n=u=d,c>n&&(n=c),l>n&&(n=l),u>c&&(u=c),u>l&&(u=l),b=t(1e3*n,255),o=0===n?0:t(1e3*(n-u),n),o>0&&(g=a(d,c,l,u,n),o+=10*y,o>1e3&&(o=1e3),0>o&&(o=0),s(k,f,g,o,b)));return e.pop(3),0}function S(){var m,y,A,h,o,c,P,S,I,f,d,O,F,s,u,a,l,n,p,g,b,k,v,C,w;if(A=e.stackValue(5),h=e.stackIntegerValue(4),y=e.stackIntegerValue(3),I=e.stackValue(2),d=e.stackIntegerValue(1),S=e.stackIntegerValue(0),e.success(r(A)===h*y),e.success(r(I)===d*S),m=i(A),P=i(I),e.failed())return null;for(o=c=0,C=t(1024*h,d),w=t(1024*y,S),F=0;S-1>=F;F++){for(o=0,O=0;d-1>=O;O++)g=(1024-(1023&o))*(1024-(1023&c)),b=(1023&o)*(1024-(1023&c)),k=(1024-(1023&o))*(1023&c),v=(1023&o)*(1023&c),n=(c>>>10)*h+(o>>>10),s=m[n],u=h-1>o>>>10?m[n+1]:s,y-1>c>>>10&&(n+=h),a=m[n],l=h-1>o>>>10?m[n+1]:a,p=0,0===s&&(s=u,p+=g),0===u&&(u=s,p+=b),0===a&&(a=l,p+=k),0===l&&(l=a,p+=v),0===s&&(s=a,u=l),0===a&&(a=s,l=u),f=0,5e5>p&&(n=g*(s>>>16&255)+b*(u>>>16&255)+k*(a>>>16&255)+v*(l>>>16&255),f=(n>>>20&255)<<16,n=g*(s>>>8&255)+b*(u>>>8&255)+k*(a>>>8&255)+v*(l>>>8&255),f|=(n>>>20&255)<<8,n=g*(255&s)+b*(255&u)+k*(255&a)+v*(255&l),f|=n>>>20&255,0===f&&(f=1)),P[F*d+O]=f,o+=C;c+=w}return e.pop(6),0}function F(){var _,a,x,B,u,D,S,P,y,v,F,k,A,b,g,p,f,I,j,c,O,M,V,C,W,m,q,w,d,N,o,h,s,T,L;if(j=e.stackValue(5),V=e.stackValue(4),s=e.stackIntegerValue(3),I=i(j),M=i(V),x=r(j),q=e.stackIntegerValue(2),_=e.stackValue(1),B=e.stackValue(0),a=l(_),u=l(B),e.success(r(V)===x),e.failed())return null;for(p=t(x,s),d=Math.random(),D=n(d,q)-1,w=0;D/2-1>=w;w++)for(d=Math.random(),T=n(d,s),d=Math.random(),L=n(d,p),d=Math.random(),W=n(d,8),b=-4;4>=b;b++)for(g=-4;4>=g;g++)P=b*b+g*g,25>P&&P>0&&(y=T+b|0,F=L+g|0,y>0&&F>0&&p>F&&s>y&&(a[F*s+y]=W*(1-P/25)));for(A=1;s-2>=A;A++)for(S=1;p-2>=S;S++)o=S*s+A,a[o]=(u[o+1]+u[o-1]+u[o+s]+u[o-s]+u[o-1-s]/2+u[o-1+s]/2+u[o+1-s]/2+u[o+1+s]/2)/4-a[o],a[o]=.9*a[o];for(m=0;s*p>=m;m++)N=u[m],u[m]=a[m],a[m]=N;for(c=0;p-1>=c;c++)for(f=0;s-1>=f;f++)f>1&&s-1>f&&c>1&&p-1>c?(h=c*s+f,v=64*(a[h]-a[h-1]+(a[h+1]-a[h])),k=(a[h]-a[h-s]+(a[h+s]-a[h]))/64,2>v&&(v=-2),v>2&&(v=2),2>k&&(k=-2),k>2&&(k=2),O=(c+k)*s+(f+v)|0,C=s*p>O&&O>=0?I[O]:I[f+c*s]):C=I[f+c*s],M[f+c*s]=C;return e.pop(6),0}function O(){var F,s,n,O,k,w,c,f,y,m,C,v,V,b,A,h,I,d,p,S,g,P,a,l,o;if(v=e.stackValue(3),b=e.stackValue(2),a=e.stackIntegerValue(1),w=e.stackIntegerValue(0),C=i(v),V=i(b),g=r(v),e.success(r(b)===g),e.failed())return null;for(m=t(g,a),s=a>>1,n=m>>1,n>s?(h=s,d=n/s,p=1):(h=n,d=1,p=s>n?s/n:1),P=-3.141592653589793*w/180,I=h*h,l=0;a-1>=l;l++)for(o=0;m-1>=o;o++)c=d*(l-s),f=p*(o-n),k=c*c+f*f,I>k&&(y=1-Math.sqrt(k)/h,F=P*y*y,S=Math.sin(F),O=Math.cos(F),A=u(C,1024*((O*c-S*f)/d+s)|0,1024*((S*c+O*f)/p+n)|0,a,m),V[a*o+l]=A);return e.pop(4),0}function I(i){var t;return e=i,t=e.majorVersion()==A,t===!1?!1:t=e.minorVersion()>=P}var A=1,P=11,e=null,C="ScratchPlugin 3 November 2014 (e)";Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:h,getModuleName:d,primitiveFisheye:m,primitiveWaterRipples1:F,primitiveHalfSizeDiagonal:k,primitiveScale:S,primitiveDoubleSize:p,setInterpreter:I,primitiveWhirl:O,primitiveBlur:c,primitiveBrightnessShift:f,primitiveHalfSizeAverage:v,primitiveSaturationShift:y,primitiveHueShift:b,primitiveInterpolate:g,primitiveExtractChannel:w})}),module("users.bert.SqueakJS.plugins.SoundGenerationPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function u(e,t){return 0|Math.floor(e/t)}function t(e,t){return e-u(e,t)*t|0}function h(){return v}function m(){var r,o,d,k,m,f,u,s,i,l,h,a,n,c,v,p,b,g,y;if(r=e.stackValue(3),o=e.stackInt16Array(2),d=e.stackIntegerValue(1),k=e.stackIntegerValue(0),g=e.fetchInt32ArrayofObject(7,r),y=e.fetchInt32ArrayofObject(8,r),b=e.fetchIntegerofObject(9,r),c=e.fetchIntegerofObject(10,r),n=e.fetchIntegerofObject(11,r),v=e.fetchInt16ArrayofObject(12,r),p=e.fetchInt16ArrayofObject(13,r),e.failed())return null;for(l=d;d+k-1>=l;l++){for(m=f=0,a=1;b>=a;a++)u=n-g[a-1],1>u&&(u+=c),h=y[a-1],m+=h*v[u-1],f+=h*p[u-1];s=2*l-1,i=o[s-1]+(m>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),o[s-1]=i,v[n-1]=i,++s,i=o[s-1]+(f>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),o[s-1]=i,p[n-1]=i,n=t(n,c)+1}return e.failed()?null:(e.storeIntegerofObjectwithValue(11,r,n),void e.pop(3))}function n(){var i,k,c,F,y,g,A,l,O,I,r,p,f,d,m,n,v,o,b,a,s,h,u,S;if(i=e.stackValue(5),k=e.stackIntegerValue(4),c=e.stackInt16Array(3),F=e.stackIntegerValue(2),y=e.stackIntegerValue(1),g=e.stackIntegerValue(0),a=e.fetchIntegerofObject(3,i),s=e.fetchIntegerofObject(4,i),h=e.fetchIntegerofObject(5,i),d=e.fetchIntegerofObject(7,i),S=e.fetchInt16ArrayofObject(8,i),u=e.fetchIntegerofObject(9,i),n=e.fetchIntegerofObject(10,i),v=e.fetchIntegerofObject(11,i),m=e.fetchIntegerofObject(14,i),o=e.fetchIntegerofObject(15,i),b=e.fetchIntegerofObject(16,i),e.failed())return null;for(A=0!==m&&0!==b,O=F+k-1,f=F;O>=f;f++)p=a*S[n>>15]>>15,A?(I=m*S[o>>15],o=t(o+b,u),0>o&&(o+=u),n=t(n+v+I,u),0>n&&(n+=u)):n=t(n+v,u),y>0&&(l=2*f-1,r=c[l-1]+(p*y>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),c[l-1]=r),g>0&&(l=2*f,r=c[l-1]+(p*g>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),c[l-1]=r),0!==s&&(a+=s,(s>0&&a>=h||0>s&&h>=a)&&(a=h,s=0));return d-=k,e.failed()?null:(e.storeIntegerofObjectwithValue(3,i,a),e.storeIntegerofObjectwithValue(4,i,s),e.storeIntegerofObjectwithValue(7,i,d),e.storeIntegerofObjectwithValue(10,i,n),e.storeIntegerofObjectwithValue(15,i,o),void e.pop(5))}function s(){var t,I,c,g,m,k,S,F,u,x,q,j,h,v,O,r,s,P,l,A,p,V,C,y,o,w,b,n,a,d;if(t=e.stackValue(5),I=e.stackIntegerValue(4),c=e.stackInt16Array(3),g=e.stackIntegerValue(2),m=e.stackIntegerValue(1),k=e.stackIntegerValue(0),n=e.fetchIntegerofObject(3,t),a=e.fetchIntegerofObject(4,t),d=e.fetchIntegerofObject(5,t),l=e.fetchIntegerofObject(7,t),C=e.fetchIntegerofObject(8,t),p=e.fetchInt16ArrayofObject(10,t),y=e.fetchInt16ArrayofObject(11,t),A=e.fetchIntegerofObject(16,t),V=e.fetchIntegerofObject(17,t),b=e.fetchIntegerofObject(18,t),o=e.fetchIntegerofObject(19,t),w=e.fetchIntegerofObject(20,t),e.failed())return null;for(x=p!==y,S=m*n>>15,F=k*n>>15,u=2*g-1,q=g+I-1,P=g;q>=P;P++){if(s=(o+=w)>>9,s>V&&l>C&&(s=(o-=b)>>9),(v=s+1)>A){if(s>A)return l=0,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,n),e.storeIntegerofObjectwithValue(4,t,a),e.storeIntegerofObjectwithValue(7,t,l),e.storeIntegerofObjectwithValue(19,t,o),e.popthenPush(6,null),null);v=0===b?s:(o-b>>9)+1}h=o&f,O=j=p[s-1]*(i-h)+p[v-1]*h>>9,x&&(O=y[s-1]*(i-h)+y[v-1]*h>>9),m>0&&(r=c[u-1]+(S*j>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),c[u-1]=r),++u,k>0&&(r=c[u-1]+(F*O>>15),r>32767&&(r=32767),-32767>r&&(r=-32767),c[u-1]=r),++u,0!==a&&(n+=a,(a>0&&n>=d||0>a&&d>=n)&&(n=d,a=0),S=m*n>>15,F=k*n>>15)}return l-=I,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,n),e.storeIntegerofObjectwithValue(4,t,a),e.storeIntegerofObjectwithValue(7,t,l),e.storeIntegerofObjectwithValue(19,t,o),void e.pop(5))}function a(){var t,m,u,S,d,y,g,a,F,i,k,r,o,l,v,f,h,O,b,s,n,c;if(t=e.stackValue(5),m=e.stackIntegerValue(4),u=e.stackInt16Array(3),S=e.stackIntegerValue(2),d=e.stackIntegerValue(1),y=e.stackIntegerValue(0),s=e.fetchIntegerofObject(3,t),n=e.fetchIntegerofObject(4,t),c=e.fetchIntegerofObject(5,t),v=e.fetchIntegerofObject(7,t),f=e.fetchInt16ArrayofObject(8,t),h=e.fetchIntegerofObject(9,t),O=e.fetchIntegerofObject(10,t),b=e.fetchIntegerofObject(11,t),e.failed())return null;for(F=S+m-1,o=r=h,l=S;F>=l;l++)r=o+O,r>=b&&(r=p+(r-b)),g=f[(o>>15)-1]+f[(r>>15)-1]>>1,f[(o>>15)-1]=g,k=g*s>>15,o=r,d>0&&(a=2*l-1,i=u[a-1]+(k*d>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),u[a-1]=i),y>0&&(a=2*l,i=u[a-1]+(k*y>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),u[a-1]=i),0!==n&&(s+=n,(n>0&&s>=c||0>n&&c>=s)&&(s=c,n=0));return h=r,v-=m,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,s),e.storeIntegerofObjectwithValue(4,t,n),e.storeIntegerofObjectwithValue(7,t,v),e.storeIntegerofObjectwithValue(9,t,h),void e.pop(5))}function o(){var t,h,o,v,k,g,a,F,l,b,i,p,c,m,u,S,O,y,r,s,n,f;if(t=e.stackValue(5),h=e.stackIntegerValue(4),o=e.stackInt16Array(3),v=e.stackIntegerValue(2),k=e.stackIntegerValue(1),g=e.stackIntegerValue(0),s=e.fetchIntegerofObject(3,t),n=e.fetchIntegerofObject(4,t),f=e.fetchIntegerofObject(5,t),m=e.fetchIntegerofObject(7,t),S=e.fetchInt16ArrayofObject(8,t),O=e.fetchIntegerofObject(10,t),r=e.fetchIntegerofObject(11,t),u=e.fetchIntegerofObject(12,t),y=e.fetchIntegerofObject(13,t),e.failed())return null;for(F=v+h-1,l=v,c=u+(r>>>16);O>=c&&F>=l;)p=S[c-1]*s>>15,k>0&&(a=2*l-1,i=o[a-1]+(p*k>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),o[a-1]=i),g>0&&(a=2*l,i=o[a-1]+(p*g>>15),i>32767&&(i=32767),-32767>i&&(i=-32767),o[a-1]=i),0!==n&&(s+=n,(n>0&&s>=f||0>n&&f>=s)&&(s=f,n=0)),r+=y,r>=d&&(b=r>>>16,u+=b,r-=b<<16),c=u+(r>>>16),++l;return m-=h,e.failed()?null:(e.storeIntegerofObjectwithValue(3,t,s),e.storeIntegerofObjectwithValue(4,t,n),e.storeIntegerofObjectwithValue(7,t,m),e.storeIntegerofObjectwithValue(11,t,r),e.storeIntegerofObjectwithValue(12,t,u),void e.pop(5))}function r(i){var t;return e=i,t=e.majorVersion()==l,t===!1?!1:t=e.minorVersion()>=c}var l=1,c=11,f=511,i=512,p=32768,d=536870912,e=null,v="SoundGenerationPlugin 3 November 2014 (e)";Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:n,primitiveMixSampledSound:o,setInterpreter:r,getModuleName:h,primitiveApplyReverb:m,primitiveMixPluckedSound:a,primitiveMixLoopedSampledSound:s})}),module("users.bert.SqueakJS.plugins.StarSqueakPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function t(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function r(e,t){return 0|Math.floor(e/t)}function a(t,e){return 0>e?-31>e?0:t>>>0-e:e>31?0:t<<e}function i(t){return e.success(e.isWords(t)),e.failed()?0:t.words}function n(){return f}function s(){var S,s,y,k,h,p,u,g,b,l,d,m,v,n,o,f,a,c;if(l=e.stackValue(4),k=e.stackValue(3),n=e.stackIntegerValue(2),u=e.stackIntegerValue(1),s=e.stackIntegerValue(0),b=i(l),y=i(k),e.success(t(l)===t(k)),e.success(t(l)===n*u),e.failed())return null;for(S=(2*s+1)*(2*s+1),a=0;u-1>=a;a++)for(m=a-s,0>m&&(m=0),p=a+s,p>=u&&(p=u-1),o=0;n-1>=o;o++){for(d=o-s,0>d&&(d=0),h=o+s,h>=n&&(h=n-1),v=0,c=m;p>=c;c++)for(g=c*n,f=d;h>=f;f++)v+=b[g+f];y[a*n+o]=r(v,S)}e.pop(5)}function h(){var r,n,s,a,o;if(s=e.stackValue(1),a=e.stackIntegerValue(0),n=i(s),o=t(s),e.failed())return null;for(r=0;o-1>=r;r++)n[r]=n[r]*a>>>10;e.pop(2)}function o(){var F,d,c,k,u,v,n,b,p,o,l,g,y,S,m,s,f,h;if(m=e.stackValue(6),c=e.stackValue(5),s=e.stackIntegerValue(4),k=e.stackIntegerValue(3),n=e.stackIntegerValue(2),p=e.stackIntegerValue(1),g=e.stackIntegerValue(0),y=i(m),F=i(c),e.success(t(c)===s*k),e.success(t(c)===t(m)*n*n),e.failed())return null;for(o=0,(4&p)>0&&(o+=65536),(2&p)>0&&(o+=256),(1&p)>0&&++o,S=-1,h=0;h<=r(k,n)-1;h++)for(f=0;f<=r(s,n)-1;f++)for(u=a(y[++S],g),u>255&&(u=255),b=0>=u?1:u*o,v=(h*s+f)*n,l=v;v+(n-1)*s>=l;l+=s)for(d=l;l+n-1>=d;d++)F[d]=b;e.pop(7)}function u(i){var t;return e=i,t=e.majorVersion()==l,t===!1?!1:t=e.minorVersion()>=c}var l=1,c=11,e=null,f="StarSqueakPlugin 3 November 2014 (e)";Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:s,primitiveEvaporateRate:h,setInterpreter:u,primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:o,getModuleName:n})}),module("users.bert.SqueakJS.plugins.ZipPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function M(t){return"number"==typeof t?e.classSmallInteger():t.sqClass}function i(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function k(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function Pt(e,t){return 0|Math.floor(e/t)}function J(e,t){return e-Pt(e,t)*t|0}function S(t,e){return e>31?0:t<<e}function Ot(t,e){return e>31?0:t>>>e}function Ft(t,i,n){var e;if(r[t+n]!==r[i+n])return 0;if(r[t+n-1]!==r[i+n-1])return 0;if(r[t]!==r[i])return 0;if(r[t+1]!==r[i+1])return 1;for(e=2;V>e&&r[t+e]===r[i+e];)++e;return e}function yt(l,h,p){var n,a,e,t,o,f,i,u,d;if(m>l)return!1;if(s>=v)return!0;for(a=!1,e=m;l>=e;){if(a||(i=R(e,c-1,e,h,p),j(e),o=65535&i,t=i>>>16),i=R(e+1,t,o,h,p),d=65535&i,u=i>>>16,t>=u&&t>=c){for(n=vt(t,e-o),f=1;t-1>=f;f++)j(++e);a=!1,++e}else n=kt(r[e]),++e,l>=e&&!n&&(j(e),a=!0,o=d,t=u);if(n)return m=e,!0}return m=e,!1}function gt(t){var e;for(e=M(t);!e.isNil&&e.classInstSize()>=13;)e=e.superclass();return e.isNil?!1:(n=e.classInstSize(),!0)}function z(i){var e;for(e=M(i);!e.isNil&&e.classInstSize()>=7;)e=e.superclass();return e.isNil?!1:(t=e.classInstSize(),!0)}function kt(e){return C[s]=e,I[s]=0,A[e]++,++s,s===v||0===(4095&s)&&W()}function vt(t,e){var i,r;return C[s]=t-c,I[s]=e,r=G[t-c],A[r]++,i=257>e?g[e-1]:g[256+(e-1>>>7)],q[i]++,++s,++h,s===v||0===(4095&s)&&W()
}function R(e,s,p,h,f){var n,u,a,r,o,i,t;if(t=s<<16|p,s>=V)return t;if(i=y[B(e+c-1)],a=e-i,!(a>0&&F>a))return t;for(u=h,o=e>F?e-F:0,n=s;;){if(r=Ft(e,i,n),e+r>l&&(r=l-e),r===c&&e-i>F>>2&&(r=c-1),r>n){if(t=r<<16|i,n=r,n>=V)return t;if(n>f)return t}if(!(--u>0))return t;if(i=w[i&N],o>=i)return t}}function ht(){return At}function j(e){var t;d=B(e+c-1),t=y[d],y[d]=e,w[e&N]=t}function ft(a){var n;if(!(e.isPointers(a)&&i(a)>=15))return!1;if(n=e.fetchPointerofObject(0,a),!e.isBytes(n))return!1;if(0===t){if(!z(a))return!1;if(i(a)<t+5)return t=0,!1}return r=n.bytes,p=k(n),l=e.fetchIntegerofObject(1,a),u=e.fetchIntegerofObject(2,a),n=e.fetchPointerofObject(t+0,a),e.isWords(n)&&i(n)===bt?(y=n.words,n=e.fetchPointerofObject(t+1,a),e.isWords(n)&&i(n)===mt?(w=n.words,d=e.fetchIntegerofObject(t+2,a),m=e.fetchIntegerofObject(t+3,a),n=e.fetchPointerofObject(t+5,a),e.isBytes(n)?(v=i(n),C=n.bytes,n=e.fetchPointerofObject(t+6,a),e.isWords(n)&&i(n)>=v?(I=n.words,n=e.fetchPointerofObject(t+7,a),e.isWords(n)&&i(n)===st?(A=n.words,n=e.fetchPointerofObject(t+8,a),e.isWords(n)&&i(n)===nt?(q=n.words,s=e.fetchIntegerofObject(t+9,a),h=e.fetchIntegerofObject(t+10,a),!e.failed()):!1):!1):!1):!1):!1):!1}function ut(n){var s;if(0===t){if(!z(n))return!1;if(i(n)<t+3)return t=0,!1}return e.isPointers(n)&&i(n)>=t+3?(s=e.fetchPointerofObject(0,n),e.isBytes(s)?(r=s.bytes,p=k(s),l=e.fetchIntegerofObject(1,n),u=e.fetchIntegerofObject(2,n),o=e.fetchIntegerofObject(t+1,n),a=e.fetchIntegerofObject(t+2,n),!e.failed()):e.primitiveFail()):!1}function b(i,t){if(!(t>=0&&S(1,i)>t))return e.primitiveFail();for(o|=S(t,a),a+=i;a>=8&&p>l;)r[l]=255&o,++l,o>>>=8,a-=8}function at(){var r,n,a,i,o;return 3!==e.methodArgumentCount()?e.primitiveFail():(n=e.stackIntegerValue(0),r=e.stackIntegerValue(1),a=e.stackIntegerValue(2),i=e.stackObjectValue(3),e.failed()?null:ft(i)?(o=yt(a,r,n),e.failed()||(e.storeIntegerofObjectwithValue(t+2,i,d),e.storeIntegerofObjectwithValue(t+3,i,m),e.storeIntegerofObjectwithValue(t+9,i,s),e.storeIntegerofObjectwithValue(t+10,i,h)),void(e.failed()||(e.pop(4),e.pushBool(o)))):e.primitiveFail())}function it(){var n,s,t,r,a,o;if(2!==e.methodArgumentCount())return e.primitiveFail();if(n=e.stackIntegerValue(0),r=e.stackObjectValue(1),e.failed())return null;if(!e.isWords(r))return e.primitiveFail();for(o=i(r),a=r.wordsAsInt32Array(),t=0;o-1>=t;t++)s=a[t],a[t]=s>=n?s-n:0;e.pop(2)}function tt(){var s,t;if(2!==e.methodArgumentCount())return e.primitiveFail();if(s=e.stackValue(0),!e.isWords(s))return e.primitiveFail();if(D=s.words,T=i(s),s=e.stackValue(1),!e.isWords(s))return e.primitiveFail();if(E=s.words,K=i(s),t=e.stackValue(2),!e.isPointers(t))return e.primitiveFail();if(0===n){if(!gt(t))return e.primitiveFail();if(i(t)<n+8)return n=0,e.primitiveFail()}return i(t)<n+8?e.primitiveFail():(u=e.fetchIntegerofObject(2,t),O=e.fetchIntegerofObject(n+0,t),o=e.fetchIntegerofObject(n+1,t),a=e.fetchIntegerofObject(n+2,t),f=e.fetchIntegerofObject(n+4,t),P=e.fetchIntegerofObject(n+5,t),e.failed()?null:(--u,--f,--P,s=e.fetchPointerofObject(0,t),e.isBytes(s)?(r=s.bytes,p=k(s),s=e.fetchPointerofObject(n+3,t),e.isBytes(s)?(U=s.bytes,It(),void(e.failed()||(e.storeIntegerofObjectwithValue(2,t,u+1),e.storeIntegerofObjectwithValue(n+0,t,O),e.storeIntegerofObjectwithValue(n+1,t,o),e.storeIntegerofObjectwithValue(n+2,t,a),e.storeIntegerofObjectwithValue(n+4,t,f+1),e.pop(2)))):e.primitiveFail()):e.primitiveFail()))}function et(){var t,u,l,s,a,c,i,o,r,n;if(4!==e.methodArgumentCount())return e.primitiveFail();if(s=e.stackObjectValue(0),n=e.stackIntegerValue(1),r=e.stackIntegerValue(2),t=e.positive32BitValueOf(e.stackValue(3)),e.failed())return 0;if(!(e.isBytes(s)&&n>=r&&r>0))return e.primitiveFail();if(c=k(s),!(c>=n))return e.primitiveFail();for(l=s.bytes,--r,--n,i=65535&t,o=t>>>16&65535,a=r;n>=a;a++)u=l[a],i=J(i+u,65521),o=J(o+i,65521);t=(o<<16)+i,e.popthenPush(5,e.positive32BitIntegerFor(t))}function $(){var a,n,t,s,o,i,r;if(4!==e.methodArgumentCount())return e.primitiveFail();if(n=e.stackObjectValue(0),r=e.stackIntegerValue(1),i=e.stackIntegerValue(2),t=e.positive32BitValueOf(e.stackValue(3)),e.failed())return 0;if(!(e.isBytes(n)&&r>=i&&i>0))return e.primitiveFail();if(o=k(n),!(o>=r))return e.primitiveFail();for(a=n.bytes,--i,--r,s=i;r>=s;s++)t=Ct[255&(t^a[s])]^t>>>8;e.popthenPush(5,e.positive32BitIntegerFor(t))}function Q(){var r,s,u,c,t,f;return 4!==e.methodArgumentCount()?e.primitiveFail():(s=e.stackObjectValue(0),c=e.stackObjectValue(1),r=e.stackObjectValue(2),u=e.stackObjectValue(3),t=e.stackObjectValue(4),e.failed()?null:ut(t)&&e.isPointers(s)&&i(s)>=2&&e.isPointers(c)&&i(c)>=2&&e.isPointers(u)&&i(u)>=3&&e.isPointers(r)&&i(r)>=3?(f=X(u,r,c,s),e.failed()||(e.storeIntegerofObjectwithValue(1,t,l),e.storeIntegerofObjectwithValue(n+1,t,o),e.storeIntegerofObjectwithValue(n+2,t,a)),void(e.failed()||(e.pop(5),e.pushInteger(f)))):e.primitiveFail())}function X(h,d,P,O){var r,s,C,A,S,F,o,a,I,m,u,n,y,v,t,f;if(t=e.fetchPointerofObject(0,h),n=e.fetchIntegerofObject(1,h),u=e.fetchIntegerofObject(2,h),!(u>=n&&e.isBytes(t)&&u<=k(t)))return e.primitiveFail();if(I=t.bytes,t=e.fetchPointerofObject(0,d),!(e.isWords(t)&&u<=i(t)&&e.fetchIntegerofObject(1,d)===n&&e.fetchIntegerofObject(2,d)===u))return e.primitiveFail();if(C=t.words,t=e.fetchPointerofObject(0,P),!e.isWords(t))return e.primitiveFail();if(m=i(t),y=t.words,t=e.fetchPointerofObject(1,P),!e.isWords(t)||m!==i(t))return e.primitiveFail();if(v=t.words,t=e.fetchPointerofObject(0,O),!e.isWords(t))return e.primitiveFail();if(S=i(t),A=t.words,t=e.fetchPointerofObject(1,O),!e.isWords(t)||S!==i(t))return e.primitiveFail();for(F=t.words,b(0,0),f=0;u>n&&p>l+4;)if(a=I[n],s=C[n],++n,0===s){if(++f,!(m>a))return e.primitiveFail();b(y[a],v[a])}else{if(f=f+a+c,!(256>a))return e.primitiveFail();if(r=G[a],!(m>r))return e.primitiveFail();if(b(y[r],v[r]),o=ct[r-257],0!==o&&(a-=Z[r-257],b(o,a)),--s,!(32768>s))return e.primitiveFail();if(r=256>s?g[s]:g[256+(s>>>7)],!(S>r))return e.primitiveFail();b(A[r],F[r]),o=lt[r],0!==o&&(s-=Y[r],b(o,s))}return e.failed()?null:(e.storeIntegerofObjectwithValue(1,h,n),e.storeIntegerofObjectwithValue(1,d,n),f)}function H(i){var t;return e=i,t=e.majorVersion()==rt,t===!1?!1:t=e.minorVersion()>=ot}function W(){var e;return s===v?!0:0!==(4095&s)?!1:s>=10*h?!1:(e=s-h,h>=e?!1:h>=4*e)}function pt(e){return(d<<5^e)&dt}function B(e){return pt(r[e])}function L(s,o){var a,t,r,n,i;if(t=s[0]>>>24,t>_)return e.primitiveFail(),0;for(n=2;;){if(a=x(t),r=n+a-1,r>=o)return e.primitiveFail(),0;if(i=s[r],0===(1056964608&i))return i;if(n=65535&i,t=i>>>24&255,t>_)return e.primitiveFail(),0}return 0}function It(){var s,c,t,i,n,l,h,d,m,v,e;for(l=p-1;l>u&&P>=f;)if(d=o,h=a,m=f,e=L(E,K),256>e)r[++u]=e;else{if(256===e)return O&=St,0;if(t=(e>>>16)-1,n=65535&e,t>0&&(n+=x(t)),e=L(D,T),t=e>>>16,s=65535&e,t>0&&(s+=x(t)),u+n>=l)return o=d,a=h,f=m,0;for(c=u,v=u-s,i=1;n>=i;i++)r[c+i]=r[v+i];u+=n}}function x(e){for(var t,i;e>a;)i=U[++f],o+=S(i,a),a+=8;return t=o&S(1,e)-1,o=Ot(o,e),a-=e,t}var rt=1,ot=11,dt=32767,bt=32768,F=32768,nt=30,st=286,V=258,c=3,N=32767,mt=32768,_=16,St=1,e=null,At="ZipPlugin 3 November 2014 (e)",n=0,t=0,Y=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],Z=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],o=0,a=0,m=0,r=null,p=0,Ct=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],D=null,T=0,g=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],q=null,I=null,lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ct=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],y=null,w=null,d=0,E=null,K=0,s=0,A=null,v=0,C=null,h=0,G=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],l=0,u=0,U=null,P=0,f=0,O=0;Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:Q,primitiveUpdateAdler32:et,primitiveUpdateGZipCrc32:$,primitiveDeflateUpdateHashTable:it,setInterpreter:H,getModuleName:ht,primitiveDeflateBlock:at,primitiveInflateDecompressBlock:tt})});var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var n,i,r,u,l,a,s,o="",t=0;for(e=LZString.compress(e);t<2*e.length;)t%2==0?(n=e.charCodeAt(t/2)>>8,i=255&e.charCodeAt(t/2),r=t/2+1<e.length?e.charCodeAt(t/2+1)>>8:0/0):(n=255&e.charCodeAt((t-1)/2),(t+1)/2<e.length?(i=e.charCodeAt((t+1)/2)>>8,r=255&e.charCodeAt((t+1)/2)):i=r=0/0),t+=3,u=n>>2,l=(3&n)<<4|i>>4,a=(15&i)<<2|r>>6,s=63&r,isNaN(i)?a=s=64:isNaN(r)&&(s=64),o=o+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(l)+LZString._keyStr.charAt(a)+LZString._keyStr.charAt(s);return o},decompressFromBase64:function(e){if(null==e)return"";var t,a,o,u,h,c,r,n,s="",f=0,i=0,l=LZString._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<e.length;)h=LZString._keyStr.indexOf(e.charAt(i++)),c=LZString._keyStr.indexOf(e.charAt(i++)),r=LZString._keyStr.indexOf(e.charAt(i++)),n=LZString._keyStr.indexOf(e.charAt(i++)),a=h<<2|c>>4,o=(15&c)<<4|r>>2,u=(3&r)<<6|n,f%2==0?(t=a<<8,64!=r&&(s+=l(t|o)),64!=n&&(t=u<<8)):(s+=l(t|a),64!=r&&(t=o<<8),64!=n&&(s+=l(t|u))),f+=3;return LZString.decompress(s)},compressToUTF16:function(n){if(null==n)return"";var s,e,t,i="",a=0,r=LZString._f;for(n=LZString.compress(n),s=0;s<n.length;s++)switch(e=n.charCodeAt(s),a++){case 0:i+=r((e>>1)+32),t=(1&e)<<14;break;case 1:i+=r(t+(e>>2)+32),t=(3&e)<<13;break;case 2:i+=r(t+(e>>3)+32),t=(7&e)<<12;break;case 3:i+=r(t+(e>>4)+32),t=(15&e)<<11;break;case 4:i+=r(t+(e>>5)+32),t=(31&e)<<10;break;case 5:i+=r(t+(e>>6)+32),t=(63&e)<<9;break;case 6:i+=r(t+(e>>7)+32),t=(127&e)<<8;break;case 7:i+=r(t+(e>>8)+32),t=(255&e)<<7;break;case 8:i+=r(t+(e>>9)+32),t=(511&e)<<6;break;case 9:i+=r(t+(e>>10)+32),t=(1023&e)<<5;break;case 10:i+=r(t+(e>>11)+32),t=(2047&e)<<4;break;case 11:i+=r(t+(e>>12)+32),t=(4095&e)<<3;break;case 12:i+=r(t+(e>>13)+32),t=(8191&e)<<2;break;case 13:i+=r(t+(e>>14)+32),t=(16383&e)<<1;break;case 14:i+=r(t+(e>>15)+32,(32767&e)+32),a=0}return i+r(t+32)},decompressFromUTF16:function(n){if(null==n)return"";for(var t,e,i="",a=0,s=0,r=LZString._f;s<n.length;){switch(e=n.charCodeAt(s)-32,a++){case 0:t=e<<1;break;case 1:i+=r(t|e>>14),t=(16383&e)<<2;break;case 2:i+=r(t|e>>13),t=(8191&e)<<3;break;case 3:i+=r(t|e>>12),t=(4095&e)<<4;break;case 4:i+=r(t|e>>11),t=(2047&e)<<5;break;case 5:i+=r(t|e>>10),t=(1023&e)<<6;break;case 6:i+=r(t|e>>9),t=(511&e)<<7;break;case 7:i+=r(t|e>>8),t=(255&e)<<8;break;case 8:i+=r(t|e>>7),t=(127&e)<<9;break;case 9:i+=r(t|e>>6),t=(63&e)<<10;break;case 10:i+=r(t|e>>5),t=(31&e)<<11;break;case 11:i+=r(t|e>>4),t=(15&e)<<12;break;case 12:i+=r(t|e>>3),t=(7&e)<<13;break;case 13:i+=r(t|e>>2),t=(3&e)<<14;break;case 14:i+=r(t|e>>1),t=(1&e)<<15;break;case 15:i+=r(t|e),a=0}s++}return LZString.decompress(i)},compress:function(d){if(null==d)return"";var i,r,p,c={},f={},l="",h="",n="",o=2,m=3,s=2,a="",e=0,t=0,u=LZString._f;for(p=0;p<d.length;p+=1)if(l=d.charAt(p),Object.prototype.hasOwnProperty.call(c,l)||(c[l]=m++,f[l]=!0),h=n+l,Object.prototype.hasOwnProperty.call(c,h))n=h;else{if(Object.prototype.hasOwnProperty.call(f,n)){if(n.charCodeAt(0)<256){for(i=0;s>i;i++)e<<=1,15==t?(t=0,a+=u(e),e=0):t++;for(r=n.charCodeAt(0),i=0;8>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1}else{for(r=1,i=0;s>i;i++)e=e<<1|r,15==t?(t=0,a+=u(e),e=0):t++,r=0;for(r=n.charCodeAt(0),i=0;16>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1}o--,0==o&&(o=Math.pow(2,s),s++),delete f[n]}else for(r=c[n],i=0;s>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1;o--,0==o&&(o=Math.pow(2,s),s++),c[h]=m++,n=String(l)}if(""!==n){if(Object.prototype.hasOwnProperty.call(f,n)){if(n.charCodeAt(0)<256){for(i=0;s>i;i++)e<<=1,15==t?(t=0,a+=u(e),e=0):t++;for(r=n.charCodeAt(0),i=0;8>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1}else{for(r=1,i=0;s>i;i++)e=e<<1|r,15==t?(t=0,a+=u(e),e=0):t++,r=0;for(r=n.charCodeAt(0),i=0;16>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1}o--,0==o&&(o=Math.pow(2,s),s++),delete f[n]}else for(r=c[n],i=0;s>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1;o--,0==o&&(o=Math.pow(2,s),s++)}for(r=2,i=0;s>i;i++)e=e<<1|1&r,15==t?(t=0,a+=u(e),e=0):t++,r>>=1;for(;;){if(e<<=1,15==t){a+=u(e);break}t++}return a},decompress:function(d){if(null==d)return"";if(""==d)return null;var v,f,l,i,n,r,t,s,a=[],o=4,u=4,h=3,c="",m="",p=LZString._f,e={string:d,val:d.charCodeAt(0),position:32768,index:1};for(f=0;3>f;f+=1)a[f]=f;for(i=0,r=Math.pow(2,2),t=1;t!=r;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),i|=(n>0?1:0)*t,t<<=1;switch(v=i){case 0:for(i=0,r=Math.pow(2,8),t=1;t!=r;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),i|=(n>0?1:0)*t,t<<=1;s=p(i);break;case 1:for(i=0,r=Math.pow(2,16),t=1;t!=r;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),i|=(n>0?1:0)*t,t<<=1;s=p(i);break;case 2:return""}for(a[3]=s,l=m=s;;){if(e.index>e.string.length)return"";for(i=0,r=Math.pow(2,h),t=1;t!=r;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),i|=(n>0?1:0)*t,t<<=1;switch(s=i){case 0:for(i=0,r=Math.pow(2,8),t=1;t!=r;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),i|=(n>0?1:0)*t,t<<=1;a[u++]=p(i),s=u-1,o--;break;case 1:for(i=0,r=Math.pow(2,16),t=1;t!=r;)n=e.val&e.position,e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),i|=(n>0?1:0)*t,t<<=1;a[u++]=p(i),s=u-1,o--;break;case 2:return m}if(0==o&&(o=Math.pow(2,h),h++),a[s])c=a[s];else{if(s!==u)return null;c=l+l.charAt(0)}m+=c,a[u++]=l+c.charAt(0),o--,l=c,0==o&&(o=Math.pow(2,h),h++)}}};"undefined"!=typeof module&&null!=module&&(module.exports=LZString);
//# sourceMappingURL=squeak.min.js.map