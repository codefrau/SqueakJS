!function(){"use strict";if(self.Squeak||(self.Squeak={}),!Squeak.Settings){var settings;try{if(settings=self.localStorage,settings["squeak-foo:"]="bar","bar"!==settings["squeak-foo:"])throw Error();delete settings["squeak-foo:"]}catch(e){settings={}}Squeak.Settings=settings}function CroquetPlugin(){return{getModuleName:function(){return"CroquetPlugin"},interpreterProxy:null,setInterpreter:function(e){return this.interpreterProxy=e,!0},primitiveGatherEntropy:function(e){var t=this.interpreterProxy.stackObjectValue(0);return this.interpreterProxy.failed()?null:t.isBytes()?(window.crypto.getRandomValues(t.bytes),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.trueObject()),!0):this.interpreterProxy.primitiveFail()}}}function registerCroquetPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("CroquetPlugin",CroquetPlugin()):self.setTimeout(registerCroquetPlugin,100)}function MIDIPlugin(){const i=midiParameterConstants();return{debug:!1,vmProxy:null,vm:null,prims:null,timeOffset:0,midi:null,midiPromise:null,ports:new Map,getModuleName(){return"MIDIPlugin (SqueakJS)"},setInterpreter(e){return this.vmProxy=e,this.vm=e.vm,this.prims=e.vm.primHandler,!0},initialiseModule(){this.debug=this.vm.options.debugMIDI,navigator.requestMIDIAccess?(this.midiPromise||(this.midiPromise=navigator.requestMIDIAccess({software:!0,sysex:!1}).then(e=>{this.midi=e,this.initMIDI(e)}).catch(e=>{console.error("MIDIPlugin: "+e),this.midi=!1})),performance.timeOrigin&&(this.timeOffset=performance.timeOrigin-this.vm.startupTime)):(console.log("MIDIPlugin: WebMIDI not supported"),this.vmProxy.success(!1))},initMIDI(e){var t,i;for(const n of[...e.inputs.values(),...e.outputs.values()])this.portChanged(n);e.onstatechange=e=>{e=e.port;let{name:t,manufacturer:i,state:r}=e;i&&!t.includes(i)&&(t+=` (${i})`);var s=this.portChanged(e),n=!e.sqPort;n&&(e.sqPort=s),(n||"disconnected"===r||this.debug)&&console.log(`MIDIPlugin: ${t} ${r} (port ${s.handle} ${e.type} ${e.connection})`)},console.log(`MIDIPlugin: WebMIDI initialized (ports: ${this.ports.size})`);for([t,i]of this.ports){var r=3===i.dir?"in+out":2===i.dir?"out":"in",s=[];i.input&&s.push(i.input.name),i.output&&s.push(i.output.name),console.log(`MIDIPlugin: port ${t} ${r} (${s.join(", ")})`)}},portChanged(e){let{name:t,manufacturer:i}=e;t=t.replace(/(\b(in|out)(put)?\b)/i,"").replace(/(\(\)|\[\])/,"").replace(/  /," ").trim(),i&&!t.includes(i)&&(t+=` (${i})`);let r;for(const n of this.ports.values())if(n.name===t){r=n;break}var s;return r||(s=this.ports.size,r={handle:s,name:t,dir:0,input:null,output:null,runningStatus:0,receivedMessages:[]},this.ports.set(s,r)),"connected"===e.state?(r[e.type]=e,r.dir|="input"===e.type?1:2):(r[e.type]=null,r.dir&="input"===e.type?-2:-3),r},primitiveMIDIGetPortCount(e){const t=()=>this.vm.popNandPush(e+1,this.ports.size);var i;return null===this.midi?(i=this.vm.freeze(),this.midiPromise.then(t).catch(e=>{console.error("MIDIPlugin: "+e),t()}).finally(i)):t(),!0},primitiveMIDIGetPortName(e){if(!this.midi)return!1;var t=this.prims.stackInteger(0),t=this.ports.get(t);if(!t)return!1;let i=t.name;return 0===t.dir&&(i+=" [disconnected]"),this.prims.popNandPushIfOK(e+1,this.prims.makeStString(i))},primitiveMIDIGetPortDirectionality(e){var t;return!!this.midi&&(t=this.prims.stackInteger(0),!!(t=this.ports.get(t)))&&this.prims.popNandPushIfOK(e+1,t.dir)},primitiveMIDIGetClock(e){var t;return!!this.midi&&(t=this.prims.millisecondClockValue(),this.prims.popNandPushIfOK(e+1,t))},primitiveMIDIParameterGetOrSet(e){if(!this.midi)return!1;let t;switch(this.prims.stackInteger(e-1)){case i.Installed:case i.Version:t=1;break;case i.HasBuffer:case i.HasDurs:case i.CanSetClock:case i.CanUseSemaphore:case i.EchoOn:case i.UseControllerCache:case i.EventsAvailable:case i.FlushDriver:t=0;break;case i.ClockTicksPerSec:t=1e3;break;case i.HasInputClock:t=1;break;default:return!1}return this.prims.popNandPushIfOK(e+1,t)},primitiveMIDIOpenPort(e){const i=this.prims.stackInteger(2);let r;const t=()=>{(r=this.ports.get(i))?r.dir||(console.error(`MIDIPlugin: port ${i} ${r.name} is disconnected`),r=null):console.error("MIDIPlugin: invalid port "+i)},s=e=>{var t=[];r.input&&("closed"===r.input.connection?t.push(r.input.open()):console.warn(`MIDIPlugin: input port ${i} is `+r.input.connection)),r.output&&("closed"===r.output.connection?t.push(r.output.open()):console.warn(`MIDIPlugin: output port ${i} is `+r.output.connection)),r.runningStatus=0,r.receivedMessages=[],Promise.all(t).then(()=>{r.input&&(r.input.onmidimessage=e=>{var t=Math.round(e.timeStamp+this.timeOffset),e=new Uint8Array(e.data);r.receivedMessages.push({time:t,bytes:e}),this.debug&&console.log("MIDIPlugin: received",t,[...e])})}).catch(e=>console.error("MIDIPlugin: "+e)).finally(e)};if(this.midi&&(t(),!r))return!1;const n=this.vm.freeze();return this.midiPromise.then(()=>{r||t(),r?s(n):n()}),this.prims.popNIfOK(e)},primitiveMIDIClosePort(e){if(this.midi){var t=this.prims.stackInteger(0),t=this.ports.get(t);if(!t)return!1;var i=[];t.input&&"open"===t.input.connection&&(i.push(t.input.close()),t.input.onmidimessage=null,t.receivedMessages.length=0),t.output&&"open"===t.output.connection&&i.push(t.output.close()),i.length&&(t=this.vm.freeze(),Promise.all(i).catch(e=>console.error("MIDIPlugin: "+e)).finally(t))}return this.prims.popNIfOK(e)},primitiveMIDIWrite(e){if(!this.midi)return!1;var t=this.prims.stackInteger(2);let i=this.prims.stackNonInteger(1).bytes;var r=this.prims.stackInteger(0),s=this.ports.get(t);if(!s||!s.output||!i)return!1;if("open"!==s.output.connection)return console.error("MIDIPlugin: primitiveMIDIWrite error (port not open)"),this.prims.popNandPushIfOK(e+1,0);if(i[0]<128){if(0===s.runningStatus)return console.error("MIDIPlugin: no running status byte"),!1;t=new Uint8Array(i.length+1);t[0]=s.runningStatus,t.set(i,1),i=t}try{this.debug&&console.log("MIDIPlugin: send",[...i],r),0===r?s.output.send(i):s.output.send(i,r);for(let e=i.length-1;0<=e;e--)if(128<=i[e]&&i[e]<=247){s.runningStatus=i[e]<240?i[e]:0;break}}catch(e){return console.error("MIDIPlugin: "+e),!1}return this.prims.popNandPushIfOK(e+1,i.length)},primitiveMIDIRead(e){if(!this.midi)return!1;var t=this.prims.stackInteger(1),i=this.prims.stackNonInteger(0).bytes,t=this.ports.get(t);if(!t||!t.input||"open"!==t.input.connection)return!1;let r=0;var s,t=t.receivedMessages.shift();return t&&({time:t,bytes:s}=t,i[0]=t>>24&255,i[1]=t>>16&255,i[2]=t>>8&255,i[3]=255&t,i.set(s,4),r=s.length+4,this.debug)&&console.log("MIDIPlugin: read",r,[...i.subarray(0,r)]),this.prims.popNandPushIfOK(e+1,r)}}}function midiParameterConstants(){return{Installed:1,Version:2,HasBuffer:3,HasDurs:4,CanSetClock:5,CanUseSemaphore:6,EchoOn:7,UseControllerCache:8,EventsAvailable:9,FlushDriver:10,ClockTicksPerSec:11,HasInputClock:12}}function registerMIDIPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("MIDIPlugin",MIDIPlugin()):self.setTimeout(registerMIDIPlugin,100)}function SocketPlugin(){return{getModuleName:function(){return"SocketPlugin (http-only)"},interpreterProxy:null,primHandler:null,handleCounter:0,needProxy:new Set,status:0,lookupCache:{localhost:{address:[127,0,0,1],validUntil:Number.MAX_SAFE_INTEGER}},lastLookup:null,lookupSemaIdx:0,TCP_Socket_Type:0,Resolver_Uninitialized:0,Resolver_Ready:1,Resolver_Busy:2,Resolver_Error:3,Socket_InvalidSocket:-1,Socket_Unconnected:0,Socket_WaitingForConnection:1,Socket_Connected:2,Socket_OtherEndClosed:3,Socket_ThisEndClosed:4,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},_signalSemaphore:function(e){e<=0||this.primHandler.signalSemaphoreWithIndex(e)},_signalLookupSemaphore:function(){this._signalSemaphore(this.lookupSemaIdx)},_getAddressFromLookupCache:function(e,t){if(e){if(e.match(/^\d+\.\d+\.\d+\.\d+$/)){var i=e.split(".").map(function(e){return+e});if(i.every(function(e){return e<=255}))return new Uint8Array(i)}i=this.lookupCache[e];if(i&&(t||i.validUntil>=Date.now()))return new Uint8Array(i.address)}return null},_addAddressFromResponseToLookupCache:function(e){var t,i,r,s,n;e&&0===e.Status&&e.Question&&e.Answer&&(i=e.Question[0],(t=function(e,t){e[t]&&e[t].replace&&(e[t]=e[t].replace(/\.$/,""))})(i,"name"),e.Answer.forEach(function(e){t(e,"name"),t(e,"data")}),r=i.name,s=null,n=86400,e.Answer.some(function(e){if(e.name===r){if(e.TTL&&(n=Math.min(n,e.TTL)),1===e.type)return s=e.data.split(".").map(function(e){return+e}),!0;5===e.type&&(r=e.data)}return!1}))&&(this.lookupCache[i.name]={address:s,validUntil:Date.now()+1e3*n})},_compareAddresses:function(e,i){return e.every(function(e,t){return i[t]===e})},_reverseLookupNameForAddress:function(t){var i=this,r=null;return Object.keys(this.lookupCache).some(function(e){return!!i._compareAddresses(t,i.lookupCache[e].address)&&(r=e,!0)}),r||t.join(".")},_newSocketHandle:function(e,t,i,r){var l=this;return{hostAddress:null,host:null,port:null,connSemaIndex:t,readSemaIndex:i,writeSemaIndex:r,webSocket:null,sendBuffer:null,sendTimeout:null,response:null,responseReadUntil:0,responseReceived:!1,status:l.Socket_Unconnected,_signalConnSemaphore:function(){l._signalSemaphore(this.connSemaIndex)},_signalReadSemaphore:function(){l._signalSemaphore(this.readSemaIndex)},_signalWriteSemaphore:function(){l._signalSemaphore(this.writeSemaIndex)},_otherEndClosed:function(){this.status=l.Socket_OtherEndClosed,this.webSocket=null,this._signalConnSemaphore()},_hostAndPort:function(){return this.host+":"+this.port},_requestNeedsProxy:function(){return l.needProxy.has(this._hostAndPort())},_getURL:function(e,t){var i="";return(t||this._requestNeedsProxy())&&(i="object"==typeof SqueakJS&&SqueakJS.options.proxy||"https://corsproxy.io/?"),443!==this.port?i+="http://"+this._hostAndPort()+e:i+="https://"+this.host+e,i},_performRequest:function(){if(this.webSocket)this._performWebSocketSend();else{var e=new TextDecoder("utf-8").decode(this.sendBuffer),t=this.sendBuffer.findIndex(function(e,t,i){return"\r"===i[t]&&"\r"===i[t+2]&&"\n"===i[t+1]&&"\n"===i[t+3]}),i=(this.sendBuffer=0<=t?this.sendBuffer.subarray(t+4):null,e.split("\r\n\r\n")[0].split("\n")),t=i[0].split(" "),e=t[0];if("GET"!==e&&"PUT"!==e&&"POST"!==e)return this._otherEndClosed(),-1;for(var t=t[1],r=!1,s=!1,n=null,a=1;a<i.length;a++){var o,u,l,c=i[a];c.match(/Content-Length:/i)?(o=parseInt(c.substr(16)),u=this.sendBuffer.byteLength,n=this.sendBuffer.subarray(u-o,u)):c.match(/Host:/i)&&(u=(o=c.substr(6).trim()).split(":")[0],l=parseInt(o.split(":")[1])||this.port,this.host!==u&&(console.warn("Host for "+this.hostAddress+" was "+this.host+" but from HTTP request now "+u),this.host=u),this.port!==l)&&(console.warn("Port for "+this.hostAddress+" was "+this.port+" but from HTTP request now "+l),this.port=l),c.match(/Connection: Upgrade/i)?r=!0:c.match(/Upgrade: WebSocket/i)&&(s=!0)}"GET"===e&&r&&s?this._performWebSocketRequest(t,e,n,i):self.fetch?this._performFetchAPIRequest(t,e,n,i):this._performXMLHTTPRequest(t,e,n,i)}},_performFetchAPIRequest:function(i,r,s,n){for(var a=this,e={},t=1;t<n.length;t++){var o=n[t].split(":");2===o.length&&(e[o[0]]=o[1].trim())}"object"==typeof SqueakJS&&SqueakJS.options.ajax&&(e["X-Requested-With"]="XMLHttpRequest");var u={method:r,headers:e,body:s,mode:"cors"};fetch(this._getURL(i),u).then(a._handleFetchAPIResponse.bind(a)).catch(function(e){var t=a._getURL(i,!0);console.warn("Retrying with CORS proxy: "+t),fetch(t,u).then(function(e){console.log("Success: "+t),a._handleFetchAPIResponse(e),l.needProxy.add(a._hostAndPort())}).catch(function(e){console.warn("Fetch API failed, retrying with XMLHttpRequest"),a._performXMLHTTPRequest(i,r,s,n)})})},_handleFetchAPIResponse:function(e){var r;null===this.response&&(r=["HTTP/1.0 ",e.status," ",e.statusText,"\r\n"],e.headers.forEach(function(e,t,i){r=r.concat([t,": ",e,"\r\n"])}),r.push("\r\n"),this.response=[new TextEncoder("utf-8").encode(r.join(""))]),this._readIncremental(e.body.getReader())},_readIncremental:function(t){var i=this;return t.read().then(function(e){if(!e.done)return i.response.push(e.value),i._signalReadSemaphore(),i._readIncremental(t);i.responseReceived=!0})},_performXMLHTTPRequest:function(r,s,n,e){for(var t,a=this,i=1;i<e.length;i++){var o=e[i];if(o.match(/Content-Type:/i)){t=encodeURIComponent(o.substr(14));break}}var u=new XMLHttpRequest;u.open(s,this._getURL(r)),void 0!==t&&u.setRequestHeader("Content-type",t),"object"==typeof SqueakJS&&SqueakJS.options.ajax&&u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.responseType="arraybuffer",u.onload=function(e){a._handleXMLHTTPResponse(this)},u.onerror=function(e){var t=a._getURL(r,!0),i=(console.warn("Retrying with CORS proxy: "+t),new XMLHttpRequest);i.open(s,t),i.responseType=u.responseType,"object"==typeof SqueakJS&&SqueakJS.options.ajaxx&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onload=function(e){console.log("Success: "+t),a._handleXMLHTTPResponse(this),l.needProxy.add(a._hostAndPort())},i.onerror=function(){a._otherEndClosed(),console.error("Failed to download:\n"+t)},i.send(n)},u.send(n)},_handleXMLHTTPResponse:function(e){this.responseReceived=!0;var t,i=e.response;i?(e=new TextEncoder("utf-8").encode("HTTP/1.0 "+e.status+" "+e.statusText+"\r\n"+e.getAllResponseHeaders()+"\r\n"),(t=new Uint8Array(e.byteLength+i.byteLength)).set(e,0),t.set(new Uint8Array(i),e.byteLength),this.response=[t],this._signalReadSemaphore()):this._otherEndClosed()},_performWebSocketRequest:function(e,t,i,r){for(var s,n,e=this._getURL(e),a=1;a<r.length;a++){var o=r[a].split(":");if("Sec-WebSocket-Protocol"===o[0]){if(s=o[1].trim(),n)break}else if("Sec-WebSocket-Key"===o[0]&&(n=o[1].trim(),s))break}this.webSocket=new WebSocket(e.replace(/^http/,"ws"),s);var u=this;this.webSocket.onopen=function(){u.status!==l.Socket_Connected&&(u.status=l.Socket_Connected,u._signalConnSemaphore(),u._signalWriteSemaphore());var e=new Uint8Array(sha1.array(n+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11")),e=Squeak.bytesAsString(e);u._performWebSocketReceive("HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+btoa(e)+"\r\n\r\n",!0)},this.webSocket.onmessage=function(e){u._performWebSocketReceive(e.data)},this.webSocket.onerror=function(e){u._otherEndClosed(),console.error("Error in WebSocket:",e)},this.webSocket.onclose=function(){u._otherEndClosed()}},_performWebSocketReceive:function(e,t){var i,r=!e.substr;r||(e=new TextEncoder("utf-8").encode(e)),t||(t=2+e.length+4,i=e.byteLength<126?e.length:e.byteLength<65535?(t+=2,126):(t+=8,127),(t=new Uint8Array(t))[0]=r?130:129,t[1]=128|i,r=126===i?(t[2]=e.length>>>8,t[3]=255&e.length,4):127===i?(t[2]=e.length>>>56,t[3]=e.length>>>48&255,t[4]=e.length>>>40&255,t[5]=e.length>>>32&255,t[6]=e.length>>>24&255,t[7]=e.length>>>16&255,t[8]=e.length>>>8&255,t[9]=255&e.length,10):2,i=new Uint8Array(4),t.set(i,r),i=e,t.set(i,r+=4),e=t),this.response&&this.response.length?this.response.push(e):this.response=[e],this.responseReceived=!0,this._signalReadSemaphore()},_performWebSocketSend:function(){var e,t=15&this.sendBuffer[0];if(0==t)return console.error("No support for WebSocket frame continuation yet!"),!0;if(1==t)e=!1;else{if(2!=t)return 8==t?(this.webSocket.close(),void(this.webSocket=null)):9==t||10==t?void 0:void console.error("Unsupported WebSocket frame opcode "+t);e=!0}var i,t=this.sendBuffer[1],r=t>>>7,t=127&t,s=126===t?(t=this.sendBuffer[2]<<8|this.sendBuffer[3],4):127===t?(t=this.sendBuffer[2]<<56|this.sendBuffer[3]<<48|this.sendBuffer[4]<<40|this.sendBuffer[5]<<32|this.sendBuffer[6]<<24|this.sendBuffer[7]<<16|this.sendBuffer[8]<<8|this.sendBuffer[9],10):2,n=(r&&(i=this.sendBuffer.subarray(s,s+4),s+=4),this.sendBuffer.subarray(s,s+t));s+=t,r&&(n=n.map(function(e,t){return e^i[3&t]})),t=e?n:Squeak.bytesAsString(n),this.sendBuffer=this.sendBuffer.subarray(s),this.webSocket.send(t),0<this.sendBuffer.byteLength&&this._performWebSocketSend()},connect:function(e,t){this.hostAddress=e,this.host=l._reverseLookupNameForAddress(e),this.port=t,this.status=l.Socket_Connected,this._signalConnSemaphore(),this._signalWriteSemaphore()},close:function(){this.status!=l.Socket_Connected&&this.status!=l.Socket_OtherEndClosed&&this.status!=l.Socket_WaitingForConnection||(this.webSocket&&(this.webSocket.close(),this.webSocket=null),this.status=l.Socket_Unconnected,this._signalConnSemaphore())},destroy:function(){this.status=l.Socket_InvalidSocket},dataAvailable:function(){if(this.status!=l.Socket_InvalidSocket&&this.status==l.Socket_Connected){if(this.webSocket)return this.response&&0<this.response.length;if(this.response&&0<this.response.length)return this._signalReadSemaphore(),!0;this.responseSentCompletly&&(this.status=l.Socket_OtherEndClosed,this._signalConnSemaphore())}return!1},recv:function(e){var t,i;return null===this.response?[]:((t=this.response[0]).length>e?((i=t.subarray(e))?this.response[0]=i:this.response.shift(),t=t.subarray(0,e)):this.response.shift(),this.responseReceived&&0===this.response.length&&!this.webSocket&&(this.responseSentCompletly=!0),t)},send:function(e,t,i){null!==this.sendTimeout&&self.clearTimeout(this.sendTimeout),this.lastSend=Date.now();e=e.bytes.subarray(t,i);return null===this.sendBuffer?this.sendBuffer=e.slice():(t=this.sendBuffer.byteLength+e.byteLength,(i=new Uint8Array(t)).set(this.sendBuffer,0),i.set(e,this.sendBuffer.byteLength),this.sendBuffer=i),this.sendTimeout=self.setTimeout(this._performRequest.bind(this),50),e.byteLength}}},primitiveHasSocketAccess:function(e){return this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.trueObject()),!0},primitiveInitializeNetwork:function(e){return 1===e&&(this.lookupSemaIdx=this.interpreterProxy.stackIntegerValue(0),this.status=this.Resolver_Ready,this.interpreterProxy.pop(e),!0)},primitiveResolverNameLookupResult:function(e){var t;return 0===e&&(this.lastLookup&&this.lastLookup.substr?(t=this._getAddressFromLookupCache(this.lastLookup,!0),this.interpreterProxy.popthenPush(e+1,t?this.primHandler.makeStByteArray(t):this.interpreterProxy.nilObject())):this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveResolverStartNameLookup:function(e){var t,i,r,s,n;return 1===e&&(t=this.lastLookup=this.interpreterProxy.stackValue(0).bytesAsString(),this._getAddressFromLookupCache(t,!1)?(this.status=this.Resolver_Ready,this._signalLookupSemaphore()):(i="https://9.9.9.9:5053/dns-query?name="+encodeURIComponent(this.lastLookup)+"&type=A",self.fetch?(r=this,self.fetch(i,{method:"GET",mode:"cors",credentials:"omit",cache:"no-store",referrer:"no-referrer",referrerPolicy:"no-referrer"}).then(function(e){return e.json()}).then(function(e){r._addAddressFromResponseToLookupCache(e)}).catch(function(e){console.error("Name lookup failed",e)}).then(function(){t===r.lastLookup&&(r.status=r.Resolver_Ready,r._signalLookupSemaphore())})):(r=this,s=function(){t===r.lastLookup&&(r.status=r.Resolver_Ready,r._signalLookupSemaphore())},(n=new XMLHttpRequest).open("GET",i,!0),n.timeout=2e3,n.responseType="json",n.onload=function(e){r._addAddressFromResponseToLookupCache(this.response),s()},n.onerror=function(){console.error("Name lookup failed",n.statusText),s()},n.send()),!0&&(this.status=this.Resolver_Busy,this._signalLookupSemaphore())),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveResolverAddressLookupResult:function(e){var t;return 0===e&&(this.lastLookup&&this.lastLookup.every?(t=this._reverseLookupNameForAddress(this.lastLookup),t=this.primHandler.makeStString(t),this.interpreterProxy.popthenPush(e+1,t)):this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveResolverStartAddressLookup:function(e){return 1===e&&(this.lastLookup=this.interpreterProxy.stackBytes(0),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),this.status=this.Resolver_Ready,this._signalLookupSemaphore(),!0)},primitiveResolverStatus:function(e){return 0===e&&(this.interpreterProxy.popthenPush(e+1,this.status),!0)},primitiveResolverAbortLookup:function(e){return 0===e&&(this.lastLookup=null,this.status=this.Resolver_Ready,this._signalLookupSemaphore(),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveSocketRemoteAddress:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(this.interpreterProxy.popthenPush(e+1,t.hostAddress?this.primHandler.makeStByteArray(t.hostAddress):this.interpreterProxy.nilObject()),!0)},primitiveSocketRemotePort:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(this.interpreterProxy.popthenPush(e+1,t.port),!0)},primitiveSocketConnectionStatus:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(void 0===(t=t.status)&&(t=this.Socket_InvalidSocket),this.interpreterProxy.popthenPush(e+1,t),!0)},primitiveSocketConnectToPort:function(e){var t,i,r;return 3===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(2).handle)&&(i=this.interpreterProxy.stackBytes(1),r=this.interpreterProxy.stackIntegerValue(0),t.connect(i,r),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveSocketCloseConnection:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(t.close(),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveSocketCreate3Semaphores:function(e){var t,i,r,s,n;return 7===e&&(t=this.interpreterProxy.stackIntegerValue(0),i=this.interpreterProxy.stackIntegerValue(1),r=this.interpreterProxy.stackIntegerValue(2),s=this.interpreterProxy.stackIntegerValue(3),this.interpreterProxy.stackIntegerValue(5)===this.TCP_Socket_Type)&&(n="{SqueakJS Socket #"+ ++this.handleCounter+"}",(n=this.primHandler.makeStString(n)).handle=this._newSocketHandle(s,r,i,t),this.interpreterProxy.popthenPush(e+1,n),!0)},primitiveSocketDestroy:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(t.destroy(),this.interpreterProxy.popthenPush(e+1,t.status),!0)},primitiveSocketReceiveDataAvailable:function(e){var t,i;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(i=this.interpreterProxy.falseObject(),t.dataAvailable()&&(i=this.interpreterProxy.trueObject()),this.interpreterProxy.popthenPush(e+1,i),!0)},primitiveSocketReceiveDataBufCount:function(e){var t,i,r,s;return 4===e&&void 0!==(s=this.interpreterProxy.stackObjectValue(3).handle)&&(t=this.interpreterProxy.stackObjectValue(2),!((i=this.interpreterProxy.stackIntegerValue(1)-1)+(r=this.interpreterProxy.stackIntegerValue(0))>t.bytes.length||(s=s.recv(r),t.bytes.set(s,i),this.interpreterProxy.popthenPush(e+1,s.length),0)))},primitiveSocketSendDataBufCount:function(e){var t,i,r,s;return 4===e&&void 0!==(s=this.interpreterProxy.stackObjectValue(3).handle)&&(t=this.interpreterProxy.stackObjectValue(2),!((i=this.interpreterProxy.stackIntegerValue(1)-1)<0||(r=i+this.interpreterProxy.stackIntegerValue(0))>t.length||(s=s.send(t,i,r),this.interpreterProxy.popthenPush(e+1,s),0)))},primitiveSocketSendDone:function(e){return 1===e&&(this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.trueObject()),!0)},primitiveSocketListenWithOrWithoutBacklog:function(e){return!(e<2||(this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),0))}}}function registerSocketPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SocketPlugin",SocketPlugin()):self.setTimeout(registerSocketPlugin,100)}function SpeechPlugin(){return{getModuleName:function(){return"SpeechPlugin"},interpreterProxy:null,primHandler:null,voiceInput:null,semaphoreIndex:null,shouldListen:!1,recognition:null,synth:self.speechSynthesis,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},primitiveSpeak:function(e){if(1===e)t=this.interpreterProxy.stackValue(0).bytesAsString();else{if(2!==e)return!1;var t=this.interpreterProxy.stackValue(1).bytesAsString(),i=this.interpreterProxy.stackValue(0).bytesAsString(),r=this.synth.getVoices().filter(function(e){return e.name===i})}t=new SpeechSynthesisUtterance(t);return r&&0<r.length&&(t.voice=r[0]),this.synth.speak(t),this.interpreterProxy.pop(e),!0},primitiveRegisterSemaphore:function(e){return 1===e&&(this.semaphoreIndex=this.interpreterProxy.stackIntegerValue(0),this.interpreterProxy.pop(e),!0)},primitiveUnregisterSemaphore:function(e){return 0===e&&!(this.semaphoreIndex=null)},primitiveGetLastRecognitionResult:function(e){return 0===e&&null!==this.semaphoreIndex&&null!==this.voiceInput&&(e=this.primHandler.makeStArray(this.voiceInput),this.voiceInput=[],this.interpreterProxy.popthenPush(1,e),!0)},primitiveStartListening:function(e){return 0===e&&(this.recognition=new webkitSpeechRecognition,this.recognition.lang="en-US",this.recognition.interimResults=!0,this.recognition.onresult=this._onRecognitionResult.bind(this),this.recognition.onerror=function(e){console.log(e)},this.recognition.onend=function(e){this.shouldListen&&this.recognition.start()}.bind(this),this.shouldListen=!0,this.recognition.start(),!0)},_onRecognitionResult:function(e){this.voiceInput=[];for(var t=e.resultIndex;t<e.results.length;t++){for(var i=e.results[t],r=[i.isFinal,[]],s=0;s<i.length;s++){var n=i[s].transcript;r[1].push([n,i[s].confidence])}0<r[1].length&&this.voiceInput.push(r)}null!==this.semaphoreIndex&&0<this.voiceInput.length&&this.primHandler.signalSemaphoreWithIndex(this.semaphoreIndex)},primitiveStopListening:function(e){return 0===e&&(this.voiceInput=[],this.recognition.stop(),!(this.shouldListen=!1))}}}function registerSpeechPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?"webkitSpeechRecognition"in self?Squeak.registerExternalModule("SpeechPlugin",SpeechPlugin()):console.warn("SpeechPlugin: Web Speech API is not supported by this browser."):self.setTimeout(registerSpeechPlugin,100)}function SqueakSSL(){return{getModuleName:function(){return"SqueakSSL (fake)"},interpreterProxy:null,primHandler:null,handleCounter:0,SQSSL_OK:0,SQSSL_NEED_MORE_DATA:-1,SQSSL_INVALID_STATE:-2,SQSSL_BUFFER_TOO_SMALL:-3,SQSSL_INPUT_TOO_LARGE:-4,SQSSL_GENERIC_ERROR:-5,SQSSL_OUT_OF_MEMORY:-6,SQSSL_PROP_VERSION:0,SQSSL_PROP_LOGLEVEL:1,SQSSL_PROP_SSLSTATE:2,SQSSL_PROP_CERTSTATE:3,SQSSL_PROP_PEERNAME:0,SQSSL_PROP_CERTNAME:1,SQSSL_PROP_SERVERNAME:2,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},primitiveCreate:function(e){var t="{SqueakJS SSL #"+ ++this.handleCounter+"}",t=this.primHandler.makeStString(t);return t.handle=!0,this.interpreterProxy.popthenPush(e+1,t),!0},primitiveConnect:function(e){return 5===e&&(this.interpreterProxy.popthenPush(e+1,0),!0)},primitiveDestroy:function(e){return 1===e&&(this.interpreterProxy.popthenPush(e+1,1),!0)},primitiveGetIntProperty:function(e){var t;return 2===e&&void 0!==this.interpreterProxy.stackObjectValue(1).handle&&(t=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_CERTSTATE?this.SQSSL_OK:0,this.interpreterProxy.popthenPush(e+1,t),!0)},primitiveSetStringProperty:function(e){return 3===e&&void 0!==this.interpreterProxy.stackObjectValue(2).handle&&(this.interpreterProxy.pop(e),!0)},primitiveGetStringProperty:function(e){var t;return 2===e&&void 0!==this.interpreterProxy.stackObjectValue(1).handle&&(t=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_PEERNAME?this.primHandler.makeStString("*"):this.interpreterProxy.nilObject(),this.interpreterProxy.popthenPush(e+1,t),!0)},primitiveEncrypt:function(e){var t,i;return 5===e&&void 0!==this.interpreterProxy.stackObjectValue(4).handle&&(t=this.interpreterProxy.stackObjectValue(3),this.interpreterProxy.stackIntegerValue(2),i=this.interpreterProxy.stackIntegerValue(1),this.interpreterProxy.stackObjectValue(0).bytes=t.bytes,this.interpreterProxy.popthenPush(e+1,i),!0)},primitiveDecrypt:function(e){var t,i;return 5===e&&void 0!==this.interpreterProxy.stackObjectValue(4).handle&&(t=this.interpreterProxy.stackObjectValue(3),this.interpreterProxy.stackIntegerValue(2),i=this.interpreterProxy.stackIntegerValue(1),this.interpreterProxy.stackObjectValue(0).bytes=t.bytes,this.interpreterProxy.popthenPush(e+1,i),!0)}}}function registerSqueakSSL(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SqueakSSL",SqueakSSL()):self.setTimeout(registerSqueakSSL,100)}function libc(){return{getModuleName(){return"libc (SqueakJS)"},setInterpreter(e){return this.vm=e.vm,!0},bytesToString(e){var t=e.indexOf(0);return 0<=t&&(e=e.subarray(0,t)),String.fromCharCode.apply(null,e)},stringToBytes(t,i){for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i[t.length]=0,i},getenv(e){switch(e=this.bytesToString(e)){case"USER":return this.vm.options.user||"squeak";case"HOME":return this.vm.options.root||"/"}return this.vm.warnOnce("UNIMPLEMENTED getenv: "+e),null},getcwd(e,t){var i=this.vm.options.root||"/";return e=e||new Uint8Array(i.length+1),t<i.length+1?0:(this.stringToBytes(i,e),e)}}}function registerLibC(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("libc",libc()):self.setTimeout(registerLibC,100)}Object.extend||(Object.extend=function(e){for(var t=1;t<arguments.length;t++)if("object"==typeof arguments[t])for(var i in arguments[t])e[i]=arguments[t][i]}),Function.prototype.subclass||(Function.prototype.subclass=function(e){function t(){if(this.initialize){var e=this.initialize.apply(this,arguments);if(void 0!==e)return e}return this}function i(){}i.prototype=this.prototype,t.prototype=new i;for(var r=1;r<arguments.length;r++)Object.extend(t.prototype,arguments[r]);var e=e.split("."),s=e.pop();return e.reduce(function(e,t){return e[t]||(e[t]={}),e[t]},self)[s]=t}),Object.extend(Squeak,"version",{vmVersion:"SqueakJS 1.2.4",vmDate:"2025-02-19",vmBuild:"unknown",vmPath:"unknown",vmFile:"vm.js",vmMakerVersion:"[VMMakerJS-bf.17 VMMaker-bf.353]",vmInterpreterVersion:"JSInterpreter VMMaker.js-codefrau.1",platformName:"JS",platformSubtype:"unknown",osVersion:"unknown",windowSystem:"unknown"},"object header",{HeaderTypeMask:3,HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_ProcessSignalingLowSpace:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_ClassFullBlockClosure:37,splOb_ExternalObjectsArray:38,splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},"known classes",{AdditionalMethodState_selector:1,Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,ClassBinding_value:1,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:16,Context_largeFrameSize:56,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,ClosureFull_method:1,ClosureFull_receiver:3,ClosureFull_firstCopiedValue:4,Stream_array:0,Stream_position:1,Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Mutex_owner:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"error codes",{PrimNoErr:0,PrimErrGenericFailure:1,PrimErrBadReceiver:2,PrimErrBadArgument:3,PrimErrBadIndex:4,PrimErrBadNumArgs:5,PrimErrInappropriate:6,PrimErrUnsupported:7,PrimErrNoModification:8,PrimErrNoMemory:9,PrimErrNoCMemory:10,PrimErrNotFound:11,PrimErrBadMethod:12,PrimErrNamedInternal:13,PrimErrObjectMayMove:14,PrimErrLimitExceeded:15,PrimErrObjectIsPinned:16,PrimErrWritePastObject:17},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(e,t){this.externalModules[e]=t}},"time",{Epoch:Date.UTC(1901,0,1)+6e4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1e3)}},"utils",{bytesAsString:function(e){for(var t=[],i=0;i<e.length;)t.push(String.fromCharCode.apply(null,e.subarray(i,i+=16348)));return t.join("")},word64FromUint32:function(e,t){return e<2097152?4294967296*e+t:4292870144<e?4294967296*(e>>0)+t:[e,t]}}),Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(e,t,i,r){this.sqClass=e,this.hash=i;var i=e.pointers[Squeak.Class_format],s=(i>>1&63)+(i>>10&192)-1;this._format=i>>7&15,this._format<8?6!=this._format?0<s+t&&(this.pointers=this.fillArray(s+t,r)):0<t&&(e.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(t)):0<t&&(this.bytes=new Uint8Array(t))},initAsClone:function(e,t){this.sqClass=e.sqClass,this.hash=t,this._format=e._format,e.isFloat?(this.isFloat=e.isFloat,this.float=e.float):(e.pointers&&(this.pointers=e.pointers.slice(0)),e.words&&(this.words=new Uint32Array(e.words)),e.bytes&&(this.bytes=new Uint8Array(e.bytes)))},initFromImage:function(e,t,i,r){this.oop=e,this.sqClass=t,this._format=i,this.hash=r},classNameFromImage:function(e,t){e=e.get(t.get(this.oop)[Squeak.Class_name]);return e&&8<=e._format&&e._format<12?(t=t.get(e.oop),t=e.decodeBytes(t.length,t,0,3&e._format),Squeak.bytesAsString(t)):"Class"},renameFromImage:function(e,t,i){var i=this.sqClass<32?e.get(i[this.sqClass-1]):e.get(this.sqClass);return(i=i&&(i.instProto||i.classInstProto(i.classNameFromImage(e,t))))?((e=new i).oop=this.oop,e.sqClass=this.sqClass,e._format=this._format,e.hash=this.hash,e):this},installFromImage:function(e,t,i,r,s,n){var a,o=this.sqClass,i=(this.sqClass=0<o&&o<32?e.get(i[o-1]):e.get(o),t.get(this.oop)),o=i.length;this._format<5?0<o&&(this.pointers=this.decodePointers(o,a=i,e)):12<=this._format?(t=this.decodeWords(1,i,s)[0]>>10&255,a=this.decodeWords(1+t,i,s),this.pointers=this.decodePointers(1+t,a,e),this.bytes=this.decodeBytes(o-(1+t),i,1+t,3&this._format)):8<=this._format?0<o&&(this.bytes=this.decodeBytes(o,i,0,3&this._format)):this.sqClass==r?(this.isFloat=!0,this.float=this.decodeFloat(i,s,n)):0<o&&(this.words=this.decodeWords(o,i,s)),this.mark=!1},decodePointers:function(e,t,i){for(var r=new Array(e),s=0;s<e;s++){var n=t[s];r[s]=1==(1&n)?n>>1:i.get(n)||42424242}return r},decodeWords:function(e,t,i){for(var r=new DataView(t.buffer,t.byteOffset),s=new Uint32Array(e),n=0;n<e;n++)s[n]=r.getUint32(4*n,i);return s},decodeBytes:function(e,t,i,r){e=4*e-r,r=new Uint8Array(t.buffer,t.byteOffset+4*i,e),t=new Uint8Array(e);return t.set(r),t},decodeFloat:function(e,t,i){e=new DataView(e.buffer,e.byteOffset);return t?(i?e:(t=new ArrayBuffer(8),(i=new DataView(t)).setUint32(0,e.getUint32(4)),i.setUint32(4,e.getUint32(0)),i)).getFloat64(0,!0):e.getFloat64(0,!1)},fillArray:function(e,t){for(var i=[],r=0;r<e;r++)i[r]=t;return i}},"testing",{isWords:function(){return 6===this._format},isBytes:function(){var e=this._format;return 8<=e&&e<=11},isWordsOrBytes:function(){var e=this._format;return 6==e||8<=e&&e<=11},isPointers:function(){return this._format<=4},isWeak:function(){return 4===this._format},isMethod:function(){return 12<=this._format},sameFormats:function(e,t){return e<8?e===t:(12&e)==(12&t)},sameFormatAs:function(e){return this.sameFormats(this._format,e._format)}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(e){if(!this.bytes)return"";for(var t="0123456789ABCDEF",i=[],r=0,s=this.bytes.length-1;0<=s;s--)i.push(t[this.bytes[s]>>4]),i.push(t[15&this.bytes[s]]),r=256*r+this.bytes[s];var e=e?"-":"",n=9007199254740991<r?"â‰ˆ":"";return e+"16r"+i.join("")+" ("+n+e+r+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(e){var t=this.instSize();return e<=t?this.sqClass.allInstVarNames()[e-1]||"ivar"+(e-1):(e-t).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat)return e=this.float.toString(),/\./.test(e)||(e+=".0"),e;var e=this.sqClass.className();if(/ /.test(e))return"the "+e;switch(e){case"String":case"ByteString":return"'"+this.bytesAsString()+"'";case"Symbol":case"ByteSymbol":return"#"+this.bytesAsString();case"Point":return this.pointers.join("@");case"Rectangle":return this.pointers.join(" corner: ");case"Association":case"ReadOnlyVariableBinding":return this.pointers.join("->");case"LargePositiveInteger":return this.bytesAsNumberString(!1);case"LargeNegativeInteger":return this.bytesAsNumberString(!0);case"Character":var t=this.pointers?this.pointers[0]:this.hash;return"$"+String.fromCharCode(t)+" ("+t.toString()+")";case"CompiledMethod":return this.methodAsString();case"CompiledBlock":return"[] in "+this.blockOuterCode().sqInstName()}return/^[aeiou]/i.test(e)?"an"+e:"a"+e}},"accessing",{pointersSize:function(){return this.pointers?this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){var e=this._format;return 4<e||2===e?0:e<2?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(e){var t=this._format;return t<2?-1:3===t&&e.vm.isContext(this)&&!e.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:t<6?this.pointersSize()-this.instSize():t<8?this.wordsSize():t<12?this.bytesSize():this.bytesSize()+4*this.pointersSize()},floatData:function(){var e=new ArrayBuffer(8),e=new DataView(e);return e.setFloat64(0,this.float,!1),e},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words||this.uint32Array||(this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>>2):null)},setAddr:function(e){var t=this.snapshotSize();return this.oop=e+4*t.header,e+4*(t.header+t.body)},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;return this.bytes&&(e+=this.bytes.length+3>>>2),{header:63<++e?2:this.sqClass.isCompact?0:1,body:e}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var e=this.snapshotSize();return 4*(e.header+e.body)},writeTo:function(e,t,i){this.bytes&&(this._format|=3&-this.bytes.length);var r=t,s=this.snapshotSize(),n=(15&this._format)<<8|(4095&this.hash)<<17;switch(s.header){case 2:e.setUint32(t,s.body<<2|Squeak.HeaderTypeSizeAndClass),e.setUint32(t+=4,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass),e.setUint32(t+=4,n|Squeak.HeaderTypeSizeAndClass),t+=4;break;case 1:e.setUint32(t,this.sqClass.oop|Squeak.HeaderTypeClass),e.setUint32(t+=4,n|s.body<<2|Squeak.HeaderTypeClass),t+=4;break;case 0:var a=i.compactClasses.indexOf(this.sqClass)+1;e.setUint32(t,n|a<<12|s.body<<2|Squeak.HeaderTypeShort),t+=4}if(this.isFloat)e.setFloat64(t,this.float),t+=8;else if(this.words)for(var o=0;o<this.words.length;o++)e.setUint32(t,this.words[o]),t+=4;else if(this.pointers)for(o=0;o<this.pointers.length;o++)e.setUint32(t,i.objectToOop(this.pointers[o])),t+=4;if(this.bytes){for(o=0;o<this.bytes.length;o++)e.setUint8(t++,this.bytes[o]);t+=3&-this.bytes.length}if(t!==r+this.totalBytes())throw Error("written size does not match");return t}},"as class",{classInstFormat:function(){return this.pointers[Squeak.Class_format]>>7&15},classInstSize:function(){var e=this.pointers[Squeak.Class_format];return(e>>10&192)+(e>>1&63)-1},classInstIsBytes:function(){var e=this.classInstFormat();return 8<=e&&e<=11},classInstIsPointers:function(){return this.classInstFormat()<=4},instVarNames:function(){for(var e=3;e<=4;e++){var t=this.pointers[e].pointers;if(t&&t.length&&t[0].bytes)return t.map(function(e){return e.bytesAsString()})}return[]},allInstVarNames:function(){var e=this.superclass();return e.isNil?this.instVarNames():e.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";for(var e=6;e<=7;e++)if((r=this.pointers[e])&&r.bytes)return r.bytesAsString();for(var t=5;t<=6;t++){var i=this.pointers[t];if(i&&i.pointers)for(var r,e=6;e<=7;e++)if((r=i.pointers[e])&&r.bytes)return r.bytesAsString()+" class"}return"_SOMECLASS_"},defaultInst:function(){return Squeak.Object},classInstProto:function(e){if(this.instProto)return this.instProto;var t=this.defaultInst();try{var i="UndefinedObject"===(i=(e=e||this.className()).replace(/[^A-Za-z0-9]/g,"_"))?"nil":"True"===i?"true_":"False"===i?"false_":(/^[AEIOU]/.test(i)?"an":"a")+i;(t=new Function("return function "+i+"() {};")()).prototype=this.defaultInst().prototype}catch(e){}return Object.defineProperty(this,"instProto",{value:t}),t}},"as method",{methodSignFlag:function(){return!1},methodNumLits:function(){return this.pointers[0]>>9&255},methodNumArgs:function(){return this.pointers[0]>>24&15},methodPrimitiveIndex:function(){var e=805306879&this.pointers[0];return 511<e?(511&e)+(e>>19):e},methodClassForSuper:function(){return this.pointers[this.methodNumLits()].pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return 0<(131072&this.pointers[0])},methodAddPointers:function(e){this.pointers=e},methodTempCount:function(){return this.pointers[0]>>18&63},methodGetLiteral:function(e){return this.pointers[1+e]},methodGetSelector:function(e){return this.pointers[1+e]},methodAsString:function(){return"aCompiledMethod"}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"==typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(e){return e&&e.activeContext===this?e.sp+1:(e=this.pointers[Squeak.Context_stackPointer],Squeak.Context_tempFrameStart+("number"==typeof e?e:0))}}),Squeak.Object.subclass("Squeak.ObjectSpur","initialization",{initInstanceOf:function(e,t,i,r){this.sqClass=e,this.hash=i;var i=e.pointers[Squeak.Class_format],s=65535&i,i=i>>16&31;(this._format=i)<12?i<10?0<s+t&&(this.pointers=this.fillArray(s+t,r)):0<t&&(e.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(t)):0<t&&(this.bytes=new Uint8Array(t))},installFromImage:function(e,t,i,r,s,n,a){var o=this.sqClass;if(o<32)throw Error("Invalid class ID: "+o);if(this.sqClass=i[o],!this.sqClass)throw Error("Class ID not in class table: "+o);var u=t.get(this.oop),l=u.length;switch(this._format){case 0:case 1:case 2:case 3:case 4:case 5:0<l&&(this.pointers=this.decodePointers(l,f=u,e,n,a));break;case 11:l--,this._format=10;case 10:this.sqClass===r?(this.isFloat=!0,this.float=this.decodeFloat(u,s,!0)):0<l&&(this.words=this.decodeWords(l,u,s));break;case 12:case 13:throw Error("16 bit arrays not supported yet");case 20:case 21:case 22:case 23:l--,this._format-=4;case 16:case 17:case 18:case 19:0<l&&(this.bytes=this.decodeBytes(l,u,0,3&this._format));break;case 28:case 29:case 30:case 31:l--,this._format-=4;case 24:case 25:case 26:case 27:var c=this.decodeWords(1,u,s)[0]>>(a?3:1),h=32767&c,f=a?this.decodeWords64(1+h,u,s):this.decodeWords(1+h,u,s),p=a?2*(1+h):1+h;this.pointers=this.decodePointers(1+h,f,e,n,a),this.bytes=this.decodeBytes(l-p,u,p,3&this._format),a&&(this.pointers[0]=2147483648&u[1]|c);break;default:throw Error("Unknown object format: "+this._format)}this.mark=!1},decodeWords64:function(e,t,i){for(var r=new Array(e),s=0;s<e;s++){var n=t[2*s],a=t[2*s+1];r[s]=Squeak.word64FromUint32(a,n)}return r},decodePointers:function(e,t,i,r,s){for(var n=new Array(e),a=0;a<e;a++){var o=t[a];if("number"!=typeof o)if(4==(7&o[1]))n[a]=this.decodeSmallFloat(o[0],o[1],s);else{if(1!=(7&o[1]))throw 2==(7&o[1])?Error("Large Immediate Characters not implemented yet"):Error("Large OOPs not implemented yet");n[a]=s.makeLargeFromSmall(o[0],o[1])}else if(1==(1&o))n[a]=s?(0<=o?o<=8589934591:-8589934592<=o)?o/4>>1:s.makeLargeFromSmall((o-(o>>>0))/4294967296>>>0,o>>>0):o>>1;else if(2==(3&o)){if(o<0||8589934591<o)throw Error("Large Immediate Characters not implemented yet");n[a]=r(o>>>(s?3:2))}else s&&4==(7&o)?n[a]=this.decodeSmallFloat((o-(o>>>0))/4294967296>>>0,o>>>0,s):(n[a]=i.get(o)||42424242,n[a])}return n},decodeSmallFloat:function(e,t,i){var r=0,s=0,n=(8&t)<<28;return 0==(e|4294967280&t)?r=n:(r=939524096+(e>>>4)|n,s=t>>>4|(15&e)<<28),i.makeFloat(new Uint32Array([s,r]))},overhead64:function(e){var t,i=0,r=0,s=0;return this._format<=5?i=-2&e.length:24<=this._format?(i=1+(e[0]>>3&32767),t=28<=this._format,1==(1&i)&&(i+=t?1:-1),s=e.length/2,r=e.length-i):s=(r=e.length)/2,{bytes:4*i,sizeHeader:255<=r&&s<255}},initInstanceOfChar:function(e,t){this.oop=t<<2|2,this.sqClass=e,this.hash=t,this._format=7,this.mark=!0},initInstanceOfFloat:function(e,t){this.sqClass=e,this.hash=0,this._format=10,this.isFloat=!0,this.float=this.decodeFloat(t,!0,!0)},initInstanceOfLargeInt:function(e,t){this.sqClass=e,this.hash=0,this._format=16,this.bytes=new Uint8Array(t)},classNameFromImage:function(e,t){e=e.get(t.get(this.oop)[Squeak.Class_name]);return e&&16<=e._format&&e._format<24?(t=t.get(e.oop),t=e.decodeBytes(t.length,t,0,7&e._format),Squeak.bytesAsString(t)):"Class"},renameFromImage:function(e,t,i){var i=i[this.sqClass];return(i=i&&(i.instProto||i.classInstProto(i.classNameFromImage(e,t))))?((e=new i).oop=this.oop,e.sqClass=this.sqClass,e._format=this._format,e.hash=this.hash,e):this}},"accessing",{instSize:function(){return this._format<2?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(e){var t=this._format;return t<2?-1:3===t&&e.vm.isContext(this)?this.pointers[Squeak.Context_stackPointer]:t<6?this.pointersSize()-this.instSize():t<12?this.wordsSize():t<16?this.shortsSize():t<24?this.bytesSize():4*this.pointersSize()+this.bytesSize()},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;return this.bytes&&(e+=this.bytes.length+3>>>2),{header:255<=e?2:0,body:e=(e=e+(1&e)+2)<4?4:e}},writeTo:function(e,t,i,r){var s=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0,n=(this.bytes&&(s+=this.bytes.length+3>>>2,this._format|=3&-this.bytes.length),t),a=this._format<<24|4194303&this.sqClass.hash,o=s<<24|4194303&this.hash;if(255<=s&&(e.setUint32(t,s,i),o=255<<24|4194303&this.hash,e.setUint32(t+=4,o,i),t+=4),e.setUint32(t,a,i),e.setUint32(t+=4,o,i),t+=4,this.isFloat)e.setFloat64(t,this.float,i),t+=8;else if(this.words)for(var u=0;u<this.words.length;u++)e.setUint32(t,this.words[u],i),t+=4;else if(this.pointers){a=0;24<=this._format&&(o=this.methodSignFlag()?2147483648:0,o=this.pointers[0]<<1|1|o,e.setUint32(t,o,i),t+=4,a=1);for(u=a;u<this.pointers.length;u++)e.setUint32(t,r(this.pointers[u]),i),t+=4}if(this.bytes){for(u=0;u<this.bytes.length;u++)e.setUint8(t++,this.bytes[u]);t+=3&-this.bytes.length}if((t+=0===s?8:4*(1&s))!==n+this.totalBytes())throw Error("written size does not match");return t}},"testing",{isBytes:function(){var e=this._format;return 16<=e&&e<=23},isPointers:function(){return this._format<=6},isWords:function(){return 10===this._format},isWordsOrBytes:function(){var e=this._format;return 10===e||16<=e&&e<=23},isWeak:function(){return 4===this._format},isMethod:function(){return 24<=this._format},sameFormats:function(e,t){return e<16?e===t:(248&e)==(248&t)}},"as class",{defaultInst:function(){return Squeak.ObjectSpur},classInstFormat:function(){return this.pointers[Squeak.Class_format]>>16&31},classInstSize:function(){return 65535&this.pointers[Squeak.Class_format]},classInstIsBytes:function(){var e=this.classInstFormat();return 16<=e&&e<=23},classInstIsPointers:function(){return this.classInstFormat()<=6},classByteSizeOfInstance:function(e){var t=this.classInstFormat(),i=this.classInstSize();return 4*(i=(i=(i=(i+=t<9?e:16<=t?(e+3)/4|0:12<=t?(e+1)/2|0:10<=t?e:2*e)+(1&i))+(255<=i?4:2))<4?4:i)}},"as compiled block",{blockOuterCode:function(){return this.pointers[this.pointers.length-1]}},"as method",{methodSignFlag:function(){return this.pointers[0]<0},methodNumLits:function(){return 32767&this.pointers[0]},methodPrimitiveIndex:function(){return 0==(65536&this.pointers[0])?0:this.bytes[1]+256*this.bytes[2]},methodAsString:function(){var e=this.pointers[this.pointers.length-1].pointers[Squeak.ClassBinding_value],t=this.pointers[this.pointers.length-2];return t.pointers&&(t=t.pointers[Squeak.AdditionalMethodState_selector]),e.className()+">>"+t.bytesAsString()}}),Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(e){this.headRoom=1e8,this.totalMemory=0,this.headerFlags=0,this.name=e,this.gcCount=0,this.gcMilliseconds=0,this.pgcCount=0,this.pgcMilliseconds=0,this.gcTenured=0,this.allocationCount=0,this.oldSpaceCount=0,this.youngSpaceCount=0,this.newSpaceCount=0,this.hasNewInstances={}},readFromBuffer:function(r,t,i){console.log("squeak: reading "+this.name+" ("+r.byteLength+" bytes)"),this.startupTime=Date.now();for(var s=new DataView(r),n=!1,a=0,e=function(){var e=s.getUint32(a,n);return a+=4,e},o=e,u=4,N=function(e,t){if(t){for(var i=[];i.length<e;)i.push(o());return i}return t=new Uint32Array(r,a,e*u/4),a+=e*u,t},T=[6501,6502,6504,68e3,68002,68004],l=0,c=0;n=!n,a=c,l=o(),!(0<=T.indexOf(72174&l));)if(n||(c+=512),512<c)throw Error("bad image version");var E=0!=(1&(this.version=l)),h=(this.hasClosures=!(0<=[6501,6502,68e3].indexOf(l)),this.isSpur=0!=(16&l),68e3<=l);if(h&&!this.isSpur)throw Error("64 bit non-spur images not supported yet");h&&(o=function(){var e=s.getUint32(a,!0),t=s.getUint32(a+4,!0);return a+=8,Squeak.word64FromUint32(t,e)},u=8);var L=e(),D=o(),f=o(),R=o(),W=e(),z=(h&&e(),o());this.headerFlags=o(),this.savedHeaderWords=[W,z,this.headerFlags];for(var U=0;U<4;U++)this.savedHeaderWords.push(e());var p,W=o(),d=new Map,m=new Map,v=c+L,a=v;if(this.isSpur){this.oldSpaceBytes=W-16;for(var g=a+W,K=0,k=null,b=0,H={};a<g;){for(;a<g-16;){var G=a,y=e(),S=e(),I=S>>>24,F=(255===I&&(I=y,y=e(),S=e()),K+a-8-v),O=4194303&y,X=4194303&S,w=N(I,(x=y>>>24&31)<10&&0<O);a+=h?8*(I<1?1-I:0):4*(I<2?2-I:1&I),32<=O?((V=new Squeak.ObjectSpur).initFromImage(F,O,x,X),p&&(p.nextObject=V),this.oldSpaceCount++,p=V,d.set(f+F,V),m.set(F,w),H[F]=b,h&&(b+=(S=V.overhead64(w)).bytes,S.sizeHeader)&&(H[F]-=8,b-=8)):(b+=a-G,16==O&&(k=k||w),O&&d.set(f+F,w))}if(a!==g-16)throw Error("invalid segment");var Z=e(),C=e(),J=e();e(),0!==J&&(g+=J,K+=C=4278190080&C?4*(16777215&Z):0,b+=16+C,this.oldSpaceBytes+=C+J)}this.oldSpaceBytes-=b,this.firstOldObject=d.get(f),this.lastOldObject=V,this.lastOldObject.nextObject=null}else{for(;a<v+D;){var A=0,P=0,_=o();switch(_&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:A=_>>>2,P=o(),_=o();break;case Squeak.HeaderTypeClass:P=_-Squeak.HeaderTypeClass,A=(_=o())>>>2&63;break;case Squeak.HeaderTypeShort:A=_>>>2&63,P=_>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}var x,V,F=a-4-v,X=_>>>17&4095,w=N(--A,(x=_>>>8&15)<5);(V=new Squeak.Object).initFromImage(F,P,x,X),P<32&&(V.hash|=268435456),p&&(p.nextObject=V),this.oldSpaceCount++,p=V,d.set(f+F,V),m.set(F,w)}this.firstOldObject=d.get(f+4),this.lastOldObject=V,this.lastOldObject.nextObject=null,this.oldSpaceBytes=D}this.totalMemory=this.oldSpaceBytes+this.headRoom,this.totalMemory=1e6*Math.ceil(this.totalMemory/1e6);var z=d.get(R),Y=this.isSpur?this.spurClassTable(d,m,k,z):m.get(d.get(m.get(z.oop)[Squeak.splOb_CompactClasses]).oop),j=null;for(V=this.firstOldObject,p=null;V;)p=j,j=V.renameFromImage(d,m,Y),p?p.nextObject=j:this.firstOldObject=j,d.set(f+V.oop,j),V=V.nextObject;this.lastOldObject=j,this.lastOldObject.nextObject=null;var q=d.get(R),Q=m.get(d.get(m.get(q.oop)[Squeak.splOb_CompactClasses]).oop),$=d.get(m.get(q.oop)[Squeak.splOb_ClassFloat]),M=(this.isSpur&&(this.initImmediateClasses(d,m,q),Q=this.spurClassTable(d,m,k,q),E=this.getCharacter.bind(this),this.initSpurOverrides()),this.firstOldObject),B=0,ee=function(){if(M){for(var e=B+(this.oldSpaceCount/20|0);M&&B<e;)M.installFromImage(d,m,Q,$,n,E,h&&{makeFloat:function(e){return this.instantiateFloat(e)}.bind(this),makeLargeFromSmall:function(e,t){return this.instantiateLargeFromSmall(e,t)}.bind(this)}),M=M.nextObject,B++;return i&&i(B/this.oldSpaceCount),!0}return this.specialObjectsArray=q,this.decorateKnownObjects(),this.isSpur?(this.fixSkippedOops(H),h&&this.fixPCs(),this.ensureFullBlockClosureClass(this.specialObjectsArray,Q)):(this.fixCompiledMethods(),this.fixCompactOops()),!1}.bind(this);if(i)self.setTimeout(function e(){ee()?self.setTimeout(e,0):t&&t()},0);else{for(;ee(););t&&t()}},decorateKnownObjects:function(){var e=this.specialObjectsArray.pointers;if(e[Squeak.splOb_NilObject].isNil=!0,e[Squeak.splOb_TrueObject].isTrue=!0,e[Squeak.splOb_FalseObject].isFalse=!0,e[Squeak.splOb_ClassFloat].isFloatClass=!0,!this.isSpur){this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers;for(var t=0;t<this.compactClasses.length;t++)this.compactClasses[t].isNil||(this.compactClasses[t].isCompact=!0)}Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){if(!this.isSpur){for(var e=this.firstOldObject,t=0;e;){var i=268435455<e.hash;i!=!!e.sqClass.isCompact&&i!=(i=0===e.snapshotSize().header)&&(t+=i?-4:4),e.hash&=268435455,e.oop+=t,e=e.nextObject}this.oldSpaceBytes+=t}},fixCompiledMethods:function(){if(!(6502<=this.version))for(var e=this.firstOldObject,t=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];e;)e.isMethod()&&(e.sqClass=t),e=e.nextObject},fixSkippedOops:function(e){for(var t=this.firstOldObject;t;)t.oop-=e[t.oop],t=t.nextObject;if((t=this.lastOldObject).addr()+t.totalBytes()!==this.oldSpaceBytes)throw Error("image size doesn't match object sizes")},fixPCs:function(){for(var e=this.specialObjectsArray.pointers[Squeak.splOb_ClassMethodContext],t=Squeak.Context_instructionPointer,i=Squeak.Context_method,r=this.specialObjectsArray.pointers[Squeak.splOb_ClassBlockClosure],s=Squeak.Closure_startpc,n=Squeak.Closure_outerContext,a=this.firstOldObject;a;)a.sqClass===e?a.pointers[t]-=4*a.pointers[i].pointers.length:a.sqClass===r&&(a.pointers[s]-=4*a.pointers[n].pointers[i].pointers.length),a=a.nextObject},ensureFullBlockClosureClass:function(e,t){e.pointers[Squeak.splOb_ClassFullBlockClosure].isNil&&t[38]&&(e.pointers[Squeak.splOb_ClassFullBlockClosure]=t[38])}},"garbage collection - full",{fullGC:function(e){this.vm.addMessage("fullGC: "+e);var t=Date.now(),i=this.newSpaceCount,r=this.oldSpaceCount,s=this.markReachableObjects(),n=(this.removeUnmarkedOldObjects(),this.appendToOldObjects(s),this.finalizeWeakReferences(),this.allocationCount+=this.newSpaceCount,this.newSpaceCount=0,this.youngSpaceCount=0,this.hasNewInstances={},this.gcCount++,this.gcMilliseconds+=Date.now()-t,r-this.oldSpaceCount),a=s.length,o=this.oldSpaceCount-a,u=i-a,l=r-o;return console.log("Full GC ("+e+"): "+(Date.now()-t)+" ms; before: "+r.toLocaleString()+" old objects; allocated "+i.toLocaleString()+" new; surviving "+o.toLocaleString()+" old; tenuring "+a.toLocaleString()+" new; gc'ed "+l.toLocaleString()+" old and "+u.toLocaleString()+" new; total now: "+this.oldSpaceCount.toLocaleString()+" ("+(0<n?"+":"")+n.toLocaleString()+", "+this.oldSpaceBytes.toLocaleString()+" bytes)"),0<s.length?s[0]:null},gcRoots:function(){return this.vm.storeContextRegisters(),[this.specialObjectsArray,this.vm.activeContext]},markReachableObjects:function(){var e=this.gcRoots(),t=[];for(this.weakObjects=[];0<e.length;){var i=e.pop();if(!i.mark){i.oop<0&&t.push(i),i.mark=!0,i.sqClass.mark||e.push(i.sqClass);var r=i.pointers;if(r){var s=r.length;if(i.isWeak()&&(s=i.sqClass.classInstSize(),this.weakObjects.push(i)),this.vm.isContext(i))for(var n=s=i.contextSizeWithStack();n<r.length;n++)r[n]=this.vm.nilObj;for(n=0;n<s;n++)"object"!=typeof r[n]||r[n].mark||e.push(r[n])}}}return this.isSpur?t:t.sort(function(e,t){return t.oop-e.oop})},removeUnmarkedOldObjects:function(){var e=0,t=0,i=this.firstOldObject;for(i.mark=!1;;){var r=i.nextObject;if(!r)return this.lastOldObject=i,this.lastOldObject.nextObject=null,this.oldSpaceBytes-=t,void(this.oldSpaceCount-=e);r.dirty&&(r.dirty=!1),r.mark?((i=r).mark=!1,i.oop-=t):(i.nextObject=(r=r).nextObject,r.oop=-++this.newSpaceCount,t+=r.totalBytes(),e++)}},appendToOldObjects:function(e){for(var t=this.lastOldObject,i=0;i<e.length;i++){var r=e[i];r.mark=!1,this.oldSpaceBytes=r.setAddr(this.oldSpaceBytes),t.nextObject=r,t=r}t.nextObject=null,this.lastOldObject=t,this.lastOldObject.nextObject=null,this.oldSpaceCount+=e.length,this.gcTenured+=e.length,this.vm.signalLowSpaceIfNecessary(this.bytesLeft())},tenureIfYoung:function(e){e.oop<0&&this.appendToOldObjects([e])},finalizeWeakReferences:function(){var e=this.weakObjects;this.weakObjects=null;for(var t=0;t<e.length;t++){for(var i,r=e[t],s=r.pointers,n=r.sqClass.classInstSize(),a=!1,o=n;o<s.length;o++)s[o].oop<0&&(s[o]=this.vm.nilObj,a=!0);a&&(this.vm.pendingFinalizationSignals++,2<=n)&&(n=r.pointers[Squeak.WeakFinalizerItem_list]).sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]&&(i=n.pointers[Squeak.WeakFinalizationList_first],r.pointers[Squeak.WeakFinalizerItem_next]=i,n.pointers[Squeak.WeakFinalizationList_first]=r)}0<this.vm.pendingFinalizationSignals&&this.vm.forceInterruptCheck()}},"garbage collection - partial",{partialGC:function(e){this.vm.addMessage("partialGC: "+e);var t=Date.now(),i=this.newSpaceCount,r=this.findYoungObjects();return this.appendToYoungSpace(r),this.finalizeWeakReferences(),this.cleanupYoungSpace(r),this.allocationCount+=this.newSpaceCount-r.length,this.youngSpaceCount=r.length,this.newSpaceCount=this.youngSpaceCount,this.pgcCount++,this.pgcMilliseconds+=Date.now()-t,console.log("Partial GC ("+e+"): "+(Date.now()-t)+" ms, found "+this.youngRootsCount.toLocaleString()+" roots in "+this.oldSpaceCount.toLocaleString()+" old, kept "+this.youngSpaceCount.toLocaleString()+" young ("+(i-this.youngSpaceCount).toLocaleString()+" gc'ed)"),r[0]},youngRoots:function(){for(var e=this.gcRoots().filter(function(e){return e.oop<0}),t=this.firstOldObject;t;){if(t.dirty){for(var i=t.pointers,r=!1,s=0;s<i.length;s++){var n=i[s];"object"==typeof n&&n.oop<0&&(e.push(n),r=!0)}r||(t.dirty=!1)}t=t.nextObject}return e},findYoungObjects:function(){var e=this.youngRoots(),t=[];for(this.youngRootsCount=e.length,this.weakObjects=[];0<e.length;){var i=e.pop();if(!i.mark){t.push(i),i.mark=!0,i.sqClass.oop<0&&e.push(i.sqClass);var r=i.pointers;if(r){var s=r.length;if(i.isWeak()&&(s=i.sqClass.classInstSize(),this.weakObjects.push(i)),this.vm.isContext(i))for(var n=s=i.contextSizeWithStack();n<r.length;n++)r[n]=this.vm.nilObj;for(n=0;n<s;n++){var a=r[n];"object"==typeof a&&a.oop<0&&e.push(a)}}}}return this.isSpur?t:t.sort(function(e,t){return t.oop-e.oop})},appendToYoungSpace:function(e){for(var t=this.lastOldObject.oop+1,i=0;i<e.length;i++){var r=e[i];this.hasNewInstances[r.oop]&&(delete this.hasNewInstances[r.oop],this.hasNewInstances[t]=!0),r.oop=t,r.nextObject=e[i+1],t++}},cleanupYoungSpace:function(e){for(var t=e[0],i=-1;t;)this.hasNewInstances[t.oop]&&(delete this.hasNewInstances[t.oop],this.hasNewInstances[i]=!0),t.oop=i,t.mark=!1,t=t.nextObject,i--}},"creating",{registerObject:function(e){return e.oop=-++this.newSpaceCount,this.lastHash=13849+27181*this.lastHash&4294967295,4095&this.lastHash},registerObjectSpur:function(e){return e.oop=-++this.newSpaceCount,0},instantiateClass:function(e,t,i){var r=new(e.classInstProto()),s=this.registerObject(r);return r.initInstanceOf(e,t,s,i),this.hasNewInstances[e.oop]=!0,r},clone:function(e){var t=new(e.sqClass.classInstProto()),i=this.registerObject(t);return t.initAsClone(e,i),this.hasNewInstances[t.sqClass.oop]=!0,t}},"operations",{bulkBecome:function(e,t,i,r){if(!e)return!t;var s=e.length;if(s!==t.length)return!1;for(var n=null,a=(0<this.newSpaceCount?n=this.partialGC("become"):this.vm.storeContextRegisters(),{}),o=0;o<s;o++){if(!(l=e[o]).sqClass)return!1;if(a[l.oop])return!1;a[l.oop]=t[o]}if(i)for(o=0;o<s;o++){if(!(l=t[o]).sqClass)return!1;if(a[l.oop])return!1;a[l.oop]=e[o]}if(r)for(o=0;o<s;o++){if(!t[o].sqClass)return!1;var u=e[o].hash;e[o].hash=t[o].hash,t[o].hash=u,this.isSpur&&this.classTable[u]===e[o]&&(this.classTable[u]=t[o])}this.lastOldObject.nextObject=n;for(var l=this.firstOldObject;l;){var c=a[l.sqClass.oop],h=(c&&(l.sqClass=c).oop<0&&(l.dirty=!0),l.pointers);if(h)for(var f=0;f<h.length;f++)(c=a[h[f].oop])&&(h[f]=c).oop<0&&(l.dirty=!0);l=l.nextObject}return this.lastOldObject.nextObject=null,this.vm.flushMethodCacheAfterBecome(a),!0},objectAfter:function(e){return e.nextObject||this.nextObjectWithGC("nextObject",e)},someInstanceOf:function(e){for(var t=this.firstOldObject;t;){if(t.sqClass===e)return t;t=t.nextObject||this.nextObjectWithGCFor(t,e)}return null},nextInstanceAfter:function(e){for(var t=e.sqClass;;){if(!(e=e.nextObject||this.nextObjectWithGCFor(e,t)))return null;if(e.sqClass===t)return e}},nextObjectWithGC:function(e,t){var i=0<t.oop?0:this.youngSpaceCount;return this.newSpaceCount<=i?null:(t.oop<0&&this.fullGC(e),this.partialGC(e))},nextObjectWithGCFor:function(e,t){return this.hasNewInstances[t.oop]?this.nextObjectWithGC("instance of "+t.className(),e):null},allInstancesOf:function(e){for(var t=this.firstOldObject,i=[];t;)t.sqClass===e&&i.push(t),t=t.nextObject||this.nextObjectWithGCFor(t,e);return i},writeToBuffer:function(){function e(e){t.setUint32(i,e),i+=4}var t=new DataView(new ArrayBuffer(64+this.oldSpaceBytes)),i=0;for(e(this.formatVersion()),e(64),e(this.oldSpaceBytes),e(this.firstOldObject.addr()),e(this.objectToOop(this.specialObjectsArray)),e(this.lastHash),e(52429400);i<64;)e(0);for(var r=this.firstOldObject,s=0;r;)i=r.writeTo(t,i,this),r=r.nextObject,s++;if(i!==t.byteLength)throw Error("wrong image size");if(s!==this.oldSpaceCount)throw Error("wrong object count");return t.buffer},objectToOop:function(e){if("number"==typeof e)return e<<1|1;if(e.oop<0)throw Error("temporary oop");return e.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.isSpur?6521:this.hasClosures?6504:6502},segmentVersion:function(){var e=this.isSpur?"seod":"does";return this.formatVersion()|e.charCodeAt(0)<<24},storeImageSegment:function(e,t,i){var r=new DataView(e.words.buffer),s=0,n=t.pointers,a=0;r.setUint32(s,this.segmentVersion()),s+=4,this.fullGC("storeImageSegment"),i.mark=!0;for(var o=0;o<i.pointers.length;o++)"object"==typeof i.pointers[o]&&(i.pointers[o].mark=!0);this.markReachableObjects(),i.mark=!1;for(o=0;o<i.pointers.length;o++)"object"==typeof i.pointers[o]&&(i.pointers[o].mark=!1);var u={},l=[];function c(e){var t=u[e.oop];if(!t){if(e.mark){if(a>=n.length)return 0;t=2147483652+4*a,n[a++]=e}else{if(s+e.totalBytes()>r.byteLength)return 0;t=s+4*(e.snapshotSize().header+1),s=e.writeTo(r,s,this),l.push(e)}u[e.oop]=t}return t}function h(){for(var e=this.firstOldObject;e;)e.mark=!1,e=e.nextObject;return this.weakObjects=null,!1}for(c=c.bind(this),h=h.bind(this),c(i);0<l.length;){var f=l.shift(),p=u[f.oop],d=f.snapshotSize().header,m=f.pointers;if(0<d){var v=c(f.sqClass);if(!v)return h();d=1===d?Squeak.HeaderTypeClass:Squeak.HeaderTypeSizeAndClass;r.setUint32(p-8,v|d)}if(m)for(o=0;o<m.length;o++){var g=m[o];if("object"==typeof g){g=c(g);if(!g)return h();r.setUint32(p+4*o,g)}}}for(var f=e.oop<t.oop?e:t,k=0;f;)f.oop-=k,f===e?(k+=4*f.words.length-s,f.words=new Uint32Array(f.words.buffer.slice(0,s))):f===t&&(k+=4*(f.pointers.length-a),f.pointers.length=a),f=f.nextObject;return this.oldSpaceBytes-=k,h(),!0},loadImageSegment:function(e,t){if(1===e.words.length)return e.nextObject;var r=new DataView(e.words.buffer),i=!1,s=0,n=function(){var e=r.getUint32(s,i);return s+=4,e},a=n();if(!0&a&&(i=!0,!(s=0)&n()))return console.error("image segment format not supported"),null;this.tenureIfYoung(e);for(var o=e,u=o.nextObject,l=e.oop,c=new Map,h=new Map;s<r.byteLength;){var f=0,p=0,d=n();switch(d&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:f=d>>>2,p=n(),d=n();break;case Squeak.HeaderTypeClass:p=d-Squeak.HeaderTypeClass,f=(d=n())>>>2&63;break;case Squeak.HeaderTypeShort:f=d>>>2&63,p=d>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}var m=s,v=d>>>8&15,g=d>>>17&4095,k=function(e,t){if(t<5){for(var i=[];i.length<e;)i.push(n());return i}return t=new Uint32Array(r.buffer,s,e),s+=4*e,t}(--f,v),b=new Squeak.Object;b.initFromImage(m+l,p,v,g),o.nextObject=b,this.oldSpaceCount++,c.set(m,o=b),h.set(m+l,k)}b.nextObject=u;for(var y=0;y<t.pointers.length;y++)c.set(2147483652+4*y,t.pointers[y]);for(var a=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,S=0,I=a.map(function(e){return c.set(--S,e),S}),a=(e.words=new Uint32Array([e.words[0]]),delete e.uint8Array,e.nextObject),F=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat],O=a;O.installFromImage(c,h,I,F,i,!1),(O=O.nextObject)!==u;);return a}},"spur support",{initSpurOverrides:function(){this.registerObject=this.registerObjectSpur,this.writeToBuffer=this.writeToBufferSpur,this.storeImageSegment=this.storeImageSegmentSpur,this.loadImageSegment=this.loadImageSegmentSpur},spurClassTable:function(e,t,i,r){for(var s,n,a={},o=this.firstOldObject,u=0;u<4096;u++){var l=e.get(i[u]);if(1024===(l=l.oop?t.get(l.oop):l).length)for(var c=0;c<1024;c++){var h,f=e.get(l[c]);if(!f)throw Error("Invalid class table entry (oop "+l[c]+")");f!==o&&(a[h=1024*u+c]=f)}}for(s in Squeak)/^splOb_Class/.test(s)&&(n=e.get(t.get(r.oop)[Squeak[s]]))!==o&&0<(h=n.hash)&&h<1024&&(a[h]=n);return a[3]=a[1],this.classTable=a,this.classTableIndex=1024,a},enterIntoClassTable:function(e){for(var t=this.classTableIndex,i=this.classTable;t<=4194303;){if(!i[t])return(i[t]=e).hash=t,this.classTableIndex=t;t++}return console.error("class table full?"),null},initImmediateClasses:function(e,t,i){t=t.get(i.oop);this.characterClass=e.get(t[Squeak.splOb_ClassCharacter]),this.floatClass=e.get(t[Squeak.splOb_ClassFloat]),this.largePosIntClass=e.get(t[Squeak.splOb_ClassLargePositiveInteger]),this.largeNegIntClass=e.get(t[Squeak.splOb_ClassLargeNegativeInteger]),this.characterClass.classInstProto("Character"),this.floatClass.classInstProto("BoxedFloat64"),this.largePosIntClass.classInstProto("LargePositiveInteger"),this.largeNegIntClass.classInstProto("LargeNegativeInteger"),this.characterTable={}},getCharacter:function(e){var t=this.characterTable[e];return t||((t=new this.characterClass.instProto).initInstanceOfChar(this.characterClass,e),this.characterTable[e]=t),t},instantiateFloat:function(e){var t=new this.floatClass.instProto;return this.registerObjectSpur(t),this.hasNewInstances[this.floatClass.oop]=!0,t.initInstanceOfFloat(this.floatClass,e),t},instantiateLargeFromSmall:function(e,t){t=e<<29|t>>>3;for(var i=(e>>=3)<0,r=(i&&(e=-e,0!==(t=-t))&&e--,0===e?4:e<=255?5:e<=65535?6:e<=16777215?7:8),i=i?this.largeNegIntClass:this.largePosIntClass,s=new i.instProto,n=(this.registerObjectSpur(s),this.hasNewInstances[i.oop]=!0,s.initInstanceOfLargeInt(i,r),s.bytes),a=0;a<4;a++)n[a]=255&t,t>>=8;for(a=4;a<r;a++)n[a]=255&e,e>>=8;return s},ensureClassesInTable:function(){for(var e=this.firstOldObject,t=1024;e;){var i=e.sqClass;if(0===i.hash&&this.enterIntoClassTable(i),i.hash>t&&(t=i.hash),this.classTable[i.hash]!==i)throw Error("Class not in class table");e=e.nextObject}return 1+(t>>10)},classTableBytes:function(e){return 4*(4108+1028*e)},writeFreeLists:function(e,t,i,r){return e.setUint32(t,167772178,i),e.setUint32(t+=4,536870912,i),t=t+4+128},writeClassTable:function(e,t,i,r,s){e.setUint32(t,4104,i),e.setUint32(t+=4,4278190080,i),e.setUint32(t+=4,33554448,i),e.setUint32(t+=4,4278190080,i),t+=4;for(var n=0;n<s;n++)e.setUint32(t,16624+4112*n,i),t+=4;t+=4*(4104-s);for(var a=0,n=0;n<s;n++){e.setUint32(t,1024,i),t+=4,e.setUint32(t,4278190080,i),t+=4,e.setUint32(t,33554448,i),t+=4,e.setUint32(t,4278190080,i),t+=4;for(var o=0;o<1024;o++){var u=this.classTable[a];if(u&&u.pointers){if(!u.hash)throw Error("class without id");(u.hash!==a&&32<=a||u.oop<0)&&(console.warn("freeing class index "+a+" "+u.className()),u=null,delete this.classTable[a])}u&&e.setUint32(t,r(u),i),t+=4,a++}}return t},writeToBufferSpur:function(){var e=this.ensureClassesInTable(),t=136+this.classTableBytes(e),i=new DataView(new ArrayBuffer(64+t+this.oldSpaceBytes+16)),r=!0,s=Date.now(),n=0;function a(e){i.setUint32(n,e,r),n+=4}function o(e){if("number"==typeof e)return e<<1|1;if(7===e._format){if(e.hash!==e.oop>>2||2!=(3&e.oop))throw Error("Bad immediate char");return e.oop}if(e.oop<0)throw Error("temporary oop");return e.oop<48?e.oop:e.oop+t}for(a(this.formatVersion()),a(64),a(t+this.oldSpaceBytes+16),a(this.firstOldObject.addr()),a(o(this.specialObjectsArray)),this.savedHeaderWords.forEach(a),a(t+this.oldSpaceBytes+16);n<64;)a(0);var u=0,n=(l=this.firstOldObject).writeTo(i,n,r,o),l=l.nextObject;for(u++,n=l.writeTo(i,n,r,o),l=l.nextObject,u++,n=l.writeTo(i,n,r,o),l=l.nextObject,u++,n=this.writeFreeLists(i,n,r,o),n=this.writeClassTable(i,n,r,o,e);l;)n=l.writeTo(i,n,r,o),l=l.nextObject,u++;if(a(1241513987),a(8388608),a(0),a(0),n!==i.byteLength)throw Error("wrong image size");if(u!==this.oldSpaceCount)throw Error("wrong object count");e=Date.now()-s;return console.log("Wrote "+u+" objects in "+e+" ms, image size "+n+" bytes"),i.buffer},storeImageSegmentSpur:function(e,t,i){return this.vm.warnOnce("not implemented for Spur yet: primitive 98 (primitiveStoreImageSegment)"),!1},loadImageSegmentSpur:function(e,t){return this.vm.warnOnce("not implemented for Spur yet: primitive 99 (primitiveLoadImageSegment)"),null}}),Object.subclass("Squeak.Interpreter","initialization",{initialize:function(e,t,i){console.log("squeak: initializing interpreter "+Squeak.vmVersion+" ("+Squeak.vmDate+")"),this.Squeak=Squeak,this.image=e,(this.image.vm=this).options=i||{},this.primHandler=new Squeak.Primitives(this,t),this.loadImageState(),this.initVMState(),this.loadInitialContext(),this.hackImage(),this.initCompiler(),console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers,this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers,this.nilObj=this.specialObjects[Squeak.splOb_NilObject],this.falseObj=this.specialObjects[Squeak.splOb_FalseObject],this.trueObj=this.specialObjects[Squeak.splOb_TrueObject],this.hasClosures=this.image.hasClosures,this.getGlobals=this.globalsGetter(),this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0),6501==this.image.version&&(this.primHandler.reverseDisplay=!0)},initVMState:function(){this.byteCodeCount=0,this.sendCount=0,this.interruptCheckCounter=0,this.interruptCheckCounterFeedBackReset=1e3,this.interruptChecksEveryNms=3,this.lowSpaceThreshold=1e6,this.signalLowSpace=!1,this.nextPollTick=0,this.nextWakeupTick=0,this.lastTick=0,this.interruptKeycode=2094,this.interruptPending=!1,this.pendingFinalizationSignals=0,this.freeContexts=this.nilObj,this.freeLargeContexts=this.nilObj,this.reclaimableContextCount=0,this.nRecycledContexts=0,this.nAllocatedContexts=0,this.methodCacheSize=1024,this.methodCacheMask=this.methodCacheSize-1,this.methodCacheRandomish=0,this.methodCache=[];for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1,this.breakOutTick=0,this.breakOnMethod=null,this.breakOnNewMethod=!1,this.breakOnMessageNotUnderstood=!1,this.breakOnContextChanged=!1,this.breakOnContextReturned=null,this.messages={},this.startupTime=Date.now()},loadInitialContext:function(){var e=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess];this.activeContext=e.pointers[Squeak.Proc_suspendedContext],this.activeContext.dirty=!0,this.fetchContextRegisters(this.activeContext),this.reclaimableContextCount=0},globalsGetter:function(){var e=this.specialObjects[Squeak.splOb_SmalltalkDictionary],t=e.sqClass.className();if("SystemDictionary"===(t="Association"===t?(e=e.pointers[1]).sqClass.className():t))return function(){return e.pointers[1].pointers};if("SmalltalkImage"===t){var i=e.pointers[0],t=i.sqClass.className();if("SystemDictionary"===t)return function(){return i.pointers[1].pointers};if("Environment"===t)return function(){return i.pointers[2].pointers[1].pointers}}return console.warn("cannot find global dict"),function(){return[]}},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==new Function("return 42")())return console.warn("function constructor not working, disabling JIT")}catch(e){return console.warn("disabling JIT: "+e)}var e=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(e<10)return console.warn("Slow machine detected (loaded "+(1e3*e|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler");var t=new Squeak.Compiler(this);t.compile&&(this.compiler=t)}catch(e){console.warn("Compiler: "+e)}this.compiler||console.warn("SqueakJS will be running in interpreter mode only (slow)")},hackImage:function(){var e="object"==typeof location?location.hash:"",t=this.method.methodSignFlag();[{method:"SmalltalkImage>>wordSize",literal:{index:1,old:8,hack:4},enabled:!0},{method:"ReleaseBuilder class>>prepareEnvironment",bytecode:{pc:28,old:216,hack:135},enabled:e.includes("wizard=false")},{method:"Latin1Environment class>>systemConverterClass",bytecode:{pc:53,old:69,hack:73},enabled:!this.image.isSpur},{method:"Latin1Environment class>>systemConverterClass",bytecode:{pc:38,old:22,hack:19},enabled:this.image.isSpur&&t},{method:"Latin1Environment class>>systemConverterClass",bytecode:{pc:50,old:68,hack:72},enabled:this.image.isSpur&&!t}].forEach(function(t){try{var e,i,r,s,n=t.enabled&&this.findMethod(t.method);n&&(e=t.primitive,i=t.bytecode,r=t.literal,s=!0,e?n.pointers[0]|=e:i&&n.bytes[i.pc]===i.old?n.bytes[i.pc]=i.hack:i&&n.bytes[i.pc]===i.hack?s=!1:r&&n.pointers[r.index].pointers[1]===r.old?n.pointers[r.index].pointers[1]=r.hack:r&&n.pointers[r.index].pointers[1]===r.hack?s=!1:(s=!1,console.warn("Not hacking "+t.method)),s)&&console.warn("Hacking "+t.method)}catch(e){console.error("Failed to hack "+t.method+" with error "+e)}},this)}},"interpreting",{interpretOne:function(e){if(!this.method.compiled){if(this.method.methodSignFlag())return this.interpretOneSistaWithExtensions(e,0,0);var t,i=this.Squeak;switch(this.byteCodeCount++,t=this.nextByte()){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&t]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.homeContext.pointers[i.Context_tempFrameStart+(15&t)]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&t));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:return void this.push(this.method.methodGetLiteral(31&t).pointers[i.Assn_value]);case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:return this.receiver.dirty=!0,void(this.receiver.pointers[7&t]=this.pop());case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:return void(this.homeContext.pointers[i.Context_tempFrameStart+(7&t)]=this.pop());case 112:return void this.push(this.receiver);case 113:return void this.push(this.trueObj);case 114:return void this.push(this.falseObj);case 115:return void this.push(this.nilObj);case 116:return void this.push(-1);case 117:return void this.push(0);case 118:return void this.push(1);case 119:return void this.push(2);case 120:return void this.doReturn(this.receiver);case 121:return void this.doReturn(this.trueObj);case 122:return void this.doReturn(this.falseObj);case 123:return void this.doReturn(this.nilObj);case 124:return void this.doReturn(this.pop());case 125:return void this.doReturn(this.pop(),this.activeContext.pointers[i.BlockContext_caller]);case 126:case 127:return void this.nono();case 128:return void this.extendedPush(this.nextByte());case 129:return void this.extendedStore(this.nextByte());case 130:return void this.extendedStorePop(this.nextByte());case 131:return s=this.nextByte(),void this.send(this.method.methodGetSelector(31&s),s>>5,!1);case 132:return void this.doubleExtendedDoAnything(this.nextByte());case 133:return s=this.nextByte(),void this.send(this.method.methodGetSelector(31&s),s>>5,!0);case 134:return s=this.nextByte(),void this.send(this.method.methodGetSelector(63&s),s>>6,!1);case 135:return void this.pop();case 136:return void this.push(this.top());case 137:return void this.push(this.exportThisContext());case 138:return void this.pushNewArray(this.nextByte());case 139:return void this.callPrimBytecode(129);case 140:return s=this.nextByte(),void this.push(this.homeContext.pointers[i.Context_tempFrameStart+this.nextByte()].pointers[s]);case 141:var r,s=this.nextByte();return(r=this.homeContext.pointers[i.Context_tempFrameStart+this.nextByte()]).pointers[s]=this.top(),void(r.dirty=!0);case 142:return s=this.nextByte(),(r=this.homeContext.pointers[i.Context_tempFrameStart+this.nextByte()]).pointers[s]=this.pop(),void(r.dirty=!0);case 143:return void this.pushClosureCopy();case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:return void(this.pc+=1+(7&t));case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.jumpIfFalse(1+(7&t));case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:return s=this.nextByte(),this.pc+=256*((7&t)-4)+s,void((7&t)<4&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 168:case 169:case 170:case 171:return void this.jumpIfTrue(256*(3&t)+this.nextByte());case 172:case 173:case 174:case 175:return void this.jumpIfFalse(256*(3&t)+this.nextByte());case 176:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 177:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 178:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 179:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 180:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 181:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 182:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 183:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 184:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 185:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 186:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 187:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&t));case 188:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 189:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 190:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&t));case 191:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&t));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return void(this.primHandler.quickSendOther(this.receiver,15&t)||this.sendSpecial(16+(15&t)));case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:return void this.send(this.method.methodGetSelector(15&t),0,!1);case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:return void this.send(this.method.methodGetSelector(15&t),1,!1);case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:return void this.send(this.method.methodGetSelector(15&t),2,!1)}throw Error("not a bytecode: "+t)}if(e){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(e);this.breakNow()}this.method.compiled(this)},interpretOneSistaWithExtensions:function(e,t,i){var r,s,n,a=this.Squeak;switch(this.byteCodeCount++,r=this.nextByte()){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&r]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.method.methodGetLiteral(15&r).pointers[a.Assn_value]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&r));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:return void this.push(this.homeContext.pointers[a.Context_tempFrameStart+(7&r)]);case 72:case 73:case 74:case 75:return void this.push(this.homeContext.pointers[a.Context_tempFrameStart+(3&r)+8]);case 76:return void this.push(this.receiver);case 77:return void this.push(this.trueObj);case 78:return void this.push(this.falseObj);case 79:return void this.push(this.nilObj);case 80:return void this.push(0);case 81:return void this.push(1);case 82:return 0==i?void this.push(this.exportThisContext()):void this.nono();case 83:return void this.push(this.top());case 84:case 85:case 86:case 87:return void this.nono();case 88:return void this.doReturn(this.receiver);case 89:return void this.doReturn(this.trueObj);case 90:return void this.doReturn(this.falseObj);case 91:return void this.doReturn(this.nilObj);case 92:return void this.doReturn(this.pop());case 93:return void this.doReturn(this.nilObj,this.activeContext.pointers[a.BlockContext_caller]);case 94:return 0==t?void this.doReturn(this.pop(),this.activeContext.pointers[a.BlockContext_caller]):void this.nono();case 95:return;case 96:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 97:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 98:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 99:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 100:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 101:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 102:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 103:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 104:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&r));case 105:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&r));case 106:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&r));case 107:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&r));case 108:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&r));case 109:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&r));case 110:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&r));case 111:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&r));case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:return void(this.primHandler.quickSendOther(this.receiver,15&r)||this.sendSpecial(16+(15&r)));case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:case 141:case 142:case 143:return void this.send(this.method.methodGetSelector(15&r),0,!1);case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.send(this.method.methodGetSelector(15&r),1,!1);case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:return void this.send(this.method.methodGetSelector(15&r),2,!1);case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:return void(this.pc+=1+(7&r));case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:return void this.jumpIfTrue(1+(7&r));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:return void this.jumpIfFalse(1+(7&r));case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return this.receiver.dirty=!0,void(this.receiver.pointers[7&r]=this.pop());case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:return void(this.homeContext.pointers[a.Context_tempFrameStart+(7&r)]=this.pop());case 216:return void this.pop();case 217:return void this.nono();case 218:case 219:case 220:case 221:case 222:case 223:return void this.nono();case 224:return o=this.nextByte(),void this.interpretOneSistaWithExtensions(e,(t<<8)+o,i);case 225:return o=this.nextByte(),void this.interpretOneSistaWithExtensions(e,t,(i<<8)+(o<128?o:o-256));case 226:return o=this.nextByte(),void this.push(this.receiver.pointers[o+(t<<8)]);case 227:return o=this.nextByte(),void this.push(this.method.methodGetLiteral(o+(t<<8)).pointers[a.Assn_value]);case 228:return o=this.nextByte(),void this.push(this.method.methodGetLiteral(o+(t<<8)));case 229:return o=this.nextByte(),void this.push(this.homeContext.pointers[a.Context_tempFrameStart+o]);case 230:return void this.nono();case 231:return void this.pushNewArray(this.nextByte());case 232:return o=this.nextByte(),void this.push(o+(i<<8));case 233:return o=this.nextByte(),void this.push(this.image.getCharacter(o+(i<<8)));case 234:return o=this.nextByte(),void this.send(this.method.methodGetSelector((o>>3)+(t<<5)),(7&o)+(i<<3),!1);case 235:var o=this.nextByte(),u=this.method.methodGetSelector((o>>3)+(t<<5));return 64<=i?void this.sendSuperDirected(u,(7&o)+((63&i)<<3)):void this.send(u,(7&o)+(i<<3),!0);case 236:return void this.nono();case 237:u=this.nextByte()+(i<<8);return this.pc+=u,void(u<0&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 238:return void this.jumpIfTrue(this.nextByte()+(i<<8));case 239:return void this.jumpIfFalse(this.nextByte()+(i<<8));case 240:return this.receiver.dirty=!0,void(this.receiver.pointers[this.nextByte()+(t<<8)]=this.pop());case 241:return(s=this.method.methodGetLiteral(this.nextByte()+(t<<8))).dirty=!0,void(s.pointers[a.Assn_value]=this.pop());case 242:return void(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]=this.pop());case 243:return this.receiver.dirty=!0,void(this.receiver.pointers[this.nextByte()+(t<<8)]=this.top());case 244:return(s=this.method.methodGetLiteral(this.nextByte()+(t<<8))).dirty=!0,void(s.pointers[a.Assn_value]=this.top());case 245:return void(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]=this.top());case 246:case 247:return void this.nono();case 248:return void this.callPrimBytecode(245);case 249:return void this.pushFullClosure(t);case 250:return void this.pushClosureCopyExtended(t,i);case 251:return o=this.nextByte(),void this.push(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[o]);case 252:return o=this.nextByte(),(n=this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]).pointers[o]=this.top(),void(n.dirty=!0);case 253:return o=this.nextByte(),(n=this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]).pointers[o]=this.pop(),void(n.dirty=!0);case 254:case 255:return void this.nono()}throw Error("not a bytecode: "+r)},interpret:function(e,t){if(this.frozen)return"frozen";for(this.isIdle=!1,this.breakOutOfInterpreter=!1,this.breakAfter(e||500);!1===this.breakOutOfInterpreter;)this.method.compiled?this.method.compiled(this):this.interpretOne();return"function"==typeof this.breakOutOfInterpreter?this.breakOutOfInterpreter(t):(e="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0,t&&t(e),e)},goIdle:function(){var e=0!==this.nextWakeupTick,t=(this.forceInterruptCheck(),this.checkForInterrupts(),0!==this.nextWakeupTick);this.isIdle=t||!e,this.breakOut()},freeze:function(e){this.frozen=!0,this.breakOutOfInterpreter=function(e){if(e)return t=e,"frozen";throw Error("need function to restart interpreter")}.bind(this);var t,i=function(){if(this.frozen=!1,!t)throw Error("no continue function");t(0)}.bind(this);return e&&self.setTimeout(function(){e(i)},0),i},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.method.bytes[this.pc++]},nono:function(){throw Error("Oh No!")},forceInterruptCheck:function(){this.interruptCheckCounter=-1e3},checkForInterrupts:function(){var e,t=this.primHandler.millisecondClockValue();t<this.lastTick&&(this.nextPollTick=t+(this.nextPollTick-this.lastTick),this.breakOutTick=t+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick)&&(this.nextWakeupTick=t+(this.nextWakeupTick-this.lastTick)),-100<this.interruptCheckCounter&&(t-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+=10:this.interruptCheckCounterFeedBackReset<=1e3?this.interruptCheckCounterFeedBackReset=1e3:this.interruptCheckCounterFeedBackReset-=12),this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset,this.lastTick=t,this.signalLowSpace&&(this.signalLowSpace=!1,(e=this.specialObjects[Squeak.splOb_TheLowSpaceSemaphore]).isNil||this.primHandler.synchronousSignal(e)),this.interruptPending&&(this.interruptPending=!1,(e=this.specialObjects[Squeak.splOb_TheInterruptSemaphore]).isNil||this.primHandler.synchronousSignal(e)),0!==this.nextWakeupTick&&t>=this.nextWakeupTick&&(this.nextWakeupTick=0,(e=this.specialObjects[Squeak.splOb_TheTimerSemaphore]).isNil||this.primHandler.synchronousSignal(e)),0<this.pendingFinalizationSignals&&(e=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore],this.pendingFinalizationSignals=0,e.isNil||this.primHandler.synchronousSignal(e)),0<this.primHandler.semaphoresToSignal.length&&this.primHandler.signalExternalSemaphores(),this.method.compiled||this.compileIfPossible(this.method),t>=this.breakOutTick&&this.breakOut()},extendedPush:function(e){var t=63&e;switch(e>>6){case 0:this.push(this.receiver.pointers[t]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+t]);break;case 2:this.push(this.method.methodGetLiteral(t));break;case 3:this.push(this.method.methodGetLiteral(t).pointers[Squeak.Assn_value])}},extendedStore:function(e){var t=63&e;switch(e>>6){case 0:this.receiver.dirty=!0,this.receiver.pointers[t]=this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+t]=this.top();break;case 2:this.nono();break;case 3:var i=this.method.methodGetLiteral(t);i.dirty=!0,i.pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(e){var t=63&e;switch(e>>6){case 0:this.receiver.dirty=!0,this.receiver.pointers[t]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+t]=this.pop();break;case 2:this.nono();break;case 3:var i=this.method.methodGetLiteral(t);i.dirty=!0,i.pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(e){var t=this.nextByte();switch(e>>5){case 0:this.send(this.method.methodGetSelector(t),31&e,!1);break;case 1:this.send(this.method.methodGetSelector(t),31&e,!0);break;case 2:this.push(this.receiver.pointers[t]);break;case 3:this.push(this.method.methodGetLiteral(t));break;case 4:this.push(this.method.methodGetLiteral(t).pointers[Squeak.Assn_value]);break;case 5:this.receiver.dirty=!0,this.receiver.pointers[t]=this.top();break;case 6:this.receiver.dirty=!0,this.receiver.pointers[t]=this.pop();break;case 7:var i=this.method.methodGetLiteral(t);i.dirty=!0,i.pointers[Squeak.Assn_value]=this.top()}},jumpIfTrue:function(e){var t=this.pop();t.isTrue?this.pc+=e:t.isFalse||(this.push(t),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},jumpIfFalse:function(e){var t=this.pop();t.isFalse?this.pc+=e:t.isTrue||(this.push(t),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},sendSpecial:function(e){this.send(this.specialSelectors[2*e],this.specialSelectors[2*e+1],!1)},callPrimBytecode:function(e){this.pc+=2,this.primFailCode&&(this.method.bytes[this.pc]===e&&this.stackTopPut(this.getErrorObjectFromPrimFailCode()),this.primFailCode=0)},getErrorObjectFromPrimFailCode:function(){var e=this.specialObjects[Squeak.splOb_PrimErrTableIndex];if(e&&e.pointers){e=e.pointers[this.primFailCode-1];if(e)return e}return this.primFailCode}},"closures",{pushNewArray:function(e){var t=127<e,i=127&e,r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],i);if(t){for(var s=0;s<i;s++)r.pointers[s]=this.stackValue(i-s-1);this.popN(i)}this.push(r)},pushClosureCopy:function(){var e=this.nextByte(),t=15&e,i=e>>4,e=256*this.nextByte()+this.nextByte(),r=this.encodeSqueakPC(this.pc,this.method),s=this.newClosure(t,r,i);if(s.pointers[Squeak.Closure_outerContext]=this.activeContext,(this.reclaimableContextCount=0)<i){for(var n=0;n<i;n++)s.pointers[Squeak.Closure_firstCopiedValue+n]=this.stackValue(i-n-1);this.popN(i)}this.pc+=e,this.push(s)},pushClosureCopyExtended:function(e,t){var i=this.nextByte(),r=this.nextByte(),s=(7&i)+8*this.mod(e,16),n=(i>>3&7)+8*this.div(e,16),i=r+(t<<8),e=this.encodeSqueakPC(this.pc,this.method),a=this.newClosure(s,e,n);if(a.pointers[Squeak.Closure_outerContext]=this.activeContext,(this.reclaimableContextCount=0)<n){for(var o=0;o<n;o++)a.pointers[Squeak.Closure_firstCopiedValue+o]=this.stackValue(n-o-1);this.popN(n)}this.pc+=i,this.push(a)},pushFullClosure:function(e){var t=this.nextByte(),i=this.nextByte(),r=63&i,s=1==(i>>6&1)?this.vm.nilObj:this.activeContext,t=this.method.methodGetLiteral(t+(e<<8)),n=this.newFullClosure(s,r,t);if(1==(i>>7&1))throw Error("on-stack receiver not yet supported");if(n.pointers[Squeak.ClosureFull_receiver]=this.receiver,(this.reclaimableContextCount=0)<r){for(var a=0;a<r;a++)n.pointers[Squeak.ClosureFull_firstCopiedValue+a]=this.stackValue(r-a-1);this.popN(r)}this.push(n)},newClosure:function(e,t,i){i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],i);return i.pointers[Squeak.Closure_startpc]=t,i.pointers[Squeak.Closure_numArgs]=e,i},newFullClosure:function(e,t,i){t=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassFullBlockClosure],t);return t.pointers[Squeak.Closure_outerContext]=e,t.pointers[Squeak.ClosureFull_method]=i,t.pointers[Squeak.Closure_numArgs]=i.methodNumArgs(),t}},"sending",{send:function(e,t,i){var r=this.stackValue(t),s=i?(s=this.method.methodClassForSuper()).superclass():this.getClass(r),i=this.findSelectorInClass(e,t,s);i.primIndex&&(this.verifyAtSelector=e,this.verifyAtClass=s),this.executeNewMethod(r,i.method,i.argCount,i.primIndex,i.mClass,e)},sendSuperDirected:function(e,t){var i=this.pop().superclass(),r=this.stackValue(t),t=this.findSelectorInClass(e,t,i);t.primIndex&&(this.verifyAtSelector=e,this.verifyAtClass=i),this.executeNewMethod(r,t.method,t.argCount,t.primIndex,t.mClass,e)},sendAsPrimitiveFailure:function(e,t,i){this.executeNewMethod(e,t,i,0)},findSelectorInClass:function(e,t,i,r=t){this.currentSelector=e;var s=this.findMethodCacheEntry(e,i);if(s.method)return s;for(var n,a,o=i;!o.isNil;){if((a=o.pointers[Squeak.Class_mdict]).isNil)return n=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],u=this.createActualMessage(e,t,i),this.popNandPush(r+1,u),this.findSelectorInClass(n,1,o.superclass());var u=this.lookupSelectorInDict(a,e);if(!u.isNil)return(s.method=u).isMethod()?(s.primIndex=u.methodPrimitiveIndex(),s.argCount=u.methodNumArgs()):(s.primIndex=576,s.argCount=t),s.mClass=o,s;o=o.superclass()}var l=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(e===l)throw Error("Recursive not understood error encountered");var c,h=this.createActualMessage(e,t,i);return this.breakOnMessageNotUnderstood&&(c=this.stackValue(r),this.breakNow("Message not understood: "+c+" "+i.className()+">>"+e.bytesAsString())),this.popNandPush(r,h),this.findSelectorInClass(l,1,i)},lookupSelectorInDict:function(e,t){for(var i=e.pointersSize(),r=(i-Squeak.MethodDict_selectorStart-1&t.hash)+Squeak.MethodDict_selectorStart,s=!1;;){var n=e.pointers[r];if(n===t)return e.pointers[Squeak.MethodDict_array].pointers[r-Squeak.MethodDict_selectorStart];if(n.isNil)return this.nilObj;if(++r===i){if(s)return this.nilObj;r=Squeak.MethodDict_selectorStart,s=!0}}},executeNewMethod:function(e,t,i,r,s,n){if(this.sendCount++,t===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(t,s,n)),this.logSends){for(var a=" ",o=this.activeContext;!o.isNil;)a+="| ",o=o.pointers[Squeak.Context_sender];var u=this.activeContext.pointers.slice(this.sp+1-i,this.sp+1);console.log(this.sendCount+a+this.printMethod(t,s,n,u))}if(this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow()),!(0<r&&this.tryPrimitive(r,i,t))){var u=this.allocateOrRecycleContext(t.methodNeedsLargeFrame()),r=t.methodTempCount(),l=Squeak.Context_tempFrameStart+r-1;if(u.pointers[Squeak.Context_method]=t,u.pointers[Squeak.BlockContext_initialIP]=this.nilObj,u.pointers[Squeak.Context_sender]=this.activeContext,this.arrayCopy(this.activeContext.pointers,this.sp-i,u.pointers,Squeak.Context_tempFrameStart-1,i+1),this.arrayFill(u.pointers,Squeak.Context_tempFrameStart+i,Squeak.Context_tempFrameStart+r,this.nilObj),this.popN(i+1),this.reclaimableContextCount++,this.storeContextRegisters(),this.activeContext=u,this.activeContext.dirty=!0,this.homeContext=u,this.method=t,this.pc=0,this.sp=l,this.receiver=u.pointers[Squeak.Context_receiver],this.receiver!==e)throw Error("receivers don't match");t.compiled||this.compileIfPossible(t,s,n),this.interruptCheckCounter--<=0&&this.checkForInterrupts()}},compileIfPossible(e,t,i){!e.compiled&&this.compiler&&this.compiler.compile(e,t,i)},doReturn:function(e,t){if(!t){var i,r=this.homeContext;if(this.hasClosures)for(;!(i=r.pointers[Squeak.Context_closure]).isNil;)r=i.pointers[Squeak.Closure_outerContext];t=r.pointers[Squeak.Context_sender]}if(t.isNil||t.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(e);for(var s,n=this.activeContext.pointers[Squeak.Context_sender];n!==t;){if(n.isNil)return this.cannotReturn(e);if(this.isUnwindMarked(n))return this.aboutToReturnThrough(e,n);n=n.pointers[Squeak.Context_sender]}for(n=this.activeContext;n!==t;)this.breakOnContextReturned===n&&(this.breakOnContextReturned=null,this.breakNow()),s=n.pointers[Squeak.Context_sender],n.pointers[Squeak.Context_sender]=this.nilObj,n.pointers[Squeak.Context_instructionPointer]=this.nilObj,0<this.reclaimableContextCount&&(this.reclaimableContextCount--,this.recycleIfPossible(n)),n=s;this.activeContext=n,this.activeContext.dirty=!0,this.fetchContextRegisters(this.activeContext),this.push(e),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(e,t){this.push(this.exportThisContext()),this.push(e),this.push(t);e=this.specialObjects[Squeak.splOb_SelectorAboutToReturn];this.send(e,2)},cannotReturn:function(e){this.push(this.exportThisContext()),this.push(e);e=this.specialObjects[Squeak.splOb_SelectorCannotReturn];this.send(e,1)},tryPrimitive:function(e,t,i){if(255<e&&e<520){if(264<=e)this.popNandPush(1,this.top().pointers[e-264]);else{switch(e){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}this.popNandPush(1,e-261)}return!0}var r=this.sp,s=this.activeContext,i=this.primHandler.doPrimitive(e,t,i);return i&&this.sp!==r-t&&s===this.activeContext&&117!==e&&118!==e&&218!==e&&!this.frozen&&this.warnOnce("stack unbalanced after primitive "+e,"error"),i},createActualMessage:function(e,t,i){var r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],0),s=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],t);return this.arrayCopy(this.activeContext.pointers,this.sp-t+1,s.pointers,0,t),r.pointers[Squeak.Message_selector]=e,r.pointers[Squeak.Message_arguments]=s,r.pointers.length>Squeak.Message_lookupClass&&(r.pointers[Squeak.Message_lookupClass]=i),r},primitivePerform:function(e){var t=this.stackValue(e-1),i=this.stackValue(e),r=e-1,e=this.findSelectorInClass(t,r,this.getClass(i),e);if(e.selector===t){if(e.argCount!==r)return!1;var s=this.activeContext.pointers,n=this.sp-r;this.arrayCopy(s,1+n,s,n,r),this.sp--}else i=this.stackValue(e.argCount);return this.executeNewMethod(i,e.method,e.argCount,e.primIndex,e.mClass,t),!0},primitivePerformWithArgs:function(e,t){var i=t?3:2,r=this.stackValue(i),s=this.stackValue(i-1),i=this.stackValue(i-2);if(i.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var n=t?this.top():this.getClass(r);if(t)for(var a=this.getClass(r);a!==n;)if((a=a.superclass()).isNil)return!1;var t=i.pointersSize(),o=this.findSelectorInClass(s,t,n,e);if(o.selector===s){if(o.argCount!==t)return!1;var u=this.activeContext.pointers,l=this.sp-(e-1);u[l-1]=r,this.arrayCopy(i.pointers,0,u,l,t),this.sp+=t-e}else r=this.stackValue(o.argCount);return this.executeNewMethod(r,o.method,o.argCount,o.primIndex,o.mClass,s),!0},primitiveInvokeObjectAsMethod:function(e,t){for(var i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],e),r=0;r<e;r++)i.pointers[e-r-1]=this.pop();var s=this.pop(),n=this.currentSelector,a=this.specialObjects[Squeak.splOb_SelectorRunWithIn];return this.push(t),this.push(n),this.push(i),this.push(s),this.send(a,3,!1),!0},findMethodCacheEntry:function(e,t){this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var i,r=(e.hash^t.hash)&this.methodCacheMask,s=r,n=0;n<4;n++){if((i=this.methodCache[s]).selector===e&&i.lkupClass===t)return i;n===this.methodCacheRandomish&&(r=s),s=s+e.hash&this.methodCacheMask}return(i=this.methodCache[r]).lkupClass=t,i.selector=e,i.method=null,i},flushMethodCache:function(){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].selector=null,this.methodCache[e].method=null;return!0},flushMethodCacheForSelector:function(e){for(var t=0;t<this.methodCacheSize;t++)this.methodCache[t].selector===e&&(this.methodCache[t].selector=null,this.methodCache[t].method=null);return!0},flushMethodCacheForMethod:function(e){for(var t=0;t<this.methodCacheSize;t++)this.methodCache[t].method===e&&(this.methodCache[t].selector=null,this.methodCache[t].method=null);return!0},flushMethodCacheAfterBecome:function(e){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(e){return!!this.isMethodContext(e)&&198==e.pointers[Squeak.Context_method].methodPrimitiveIndex()},newActiveContext:function(e){this.storeContextRegisters(),this.activeContext=e,this.activeContext.dirty=!0,this.fetchContextRegisters(e),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},exportThisContext:function(){return this.storeContextRegisters(),this.reclaimableContextCount=0,this.activeContext},fetchContextRegisters:function(e){var t=e.pointers[Squeak.Context_method];this.isSmallInt(t)?(this.homeContext=e.pointers[Squeak.BlockContext_home],t=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=e,this.receiver=this.homeContext.pointers[Squeak.Context_receiver],this.method=t,this.pc=this.decodeSqueakPC(e.pointers[Squeak.Context_instructionPointer],t),this.sp=this.decodeSqueakSP(e.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method),this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(e,t){return e+4*t.pointers.length+1},decodeSqueakPC:function(e,t){return e-4*t.pointers.length-1},encodeSqueakSP:function(e){return e-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(e){return e+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(e){this.isMethodContext(e)&&(e.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize?(e.pointers[0]=this.freeContexts,this.freeContexts=e):e.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize&&(e.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=e))},allocateOrRecycleContext:function(e){var t;return e?this.freeLargeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)):(t=this.freeLargeContexts,this.freeLargeContexts=t.pointers[0],this.nRecycledContexts++,t):this.freeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)):(t=this.freeContexts,this.freeContexts=t.pointers[0],this.nRecycledContexts++,t)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},popN:function(e){this.sp-=e},push:function(e){this.activeContext.pointers[++this.sp]=e},popNandPush:function(e,t){this.activeContext.pointers[this.sp-=e-1]=t},top:function(){return this.activeContext.pointers[this.sp]},stackTopPut:function(e){this.activeContext.pointers[this.sp]=e},stackValue:function(e){return this.activeContext.pointers[this.sp-e]},stackInteger:function(e){return this.checkSmallInt(this.stackValue(e))},stackIntOrFloat:function(e){e=this.stackValue(e);if("number"==typeof e)return e;if(void 0!==e){if(e.isFloat)return this.resultIsFloat=!0,e.float;var t=e.bytes;if(t&&4==t.length){for(var i=0,r=3;0<=r;r--)i=256*i+t[r];if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return i;if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-i}}return this.success=!1,0},pop2AndPushIntResult:function(e){return!(!this.success||!this.canBeSmallInt(e)||(this.popNandPush(2,e),0))},pop2AndPushNumResult:function(e){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,this.primHandler.makeFloat(e)),!0;if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return this.popNandPush(2,e),!0;var t,i;if(-4294967295<=e&&e<=4294967295)return e=(t=e<0)?-e:e,t=t?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,(i=(t=this.instantiateClass(this.specialObjects[t],4)).bytes)[0]=255&e,i[1]=e>>8&255,i[2]=e>>16&255,i[3]=e>>24&255,this.popNandPush(2,t),!0}return!1},pop2AndPushBoolResult:function(e){return!!this.success&&(this.popNandPush(2,e?this.trueObj:this.falseObj),!0)}},"numbers",{getClass:function(e){return this.isSmallInt(e)?this.specialObjects[Squeak.splOb_ClassInteger]:e.sqClass},canBeSmallInt:function(e){return e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt},isSmallInt:function(e){return"number"==typeof e},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,1)},quickDivide:function(e,t){var i;return 0!==t&&(i=e/t|0)*t===e?i:Squeak.NonSmallInt},div:function(e,t){return 0===t?Squeak.NonSmallInt:Math.floor(e/t)},mod:function(e,t){return 0===t?Squeak.NonSmallInt:e-Math.floor(e/t)*t},safeShift:function(e,t){var i;return t<0?t<-31?e<0?-1:0:e>>-t:31<t?0===e?0:Squeak.NonSmallInt:(i=e<<t)>>t!==e?Squeak.NonSmallInt:i}},"utils",{isContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]||e.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]},isMethodContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},instantiateClass:function(e,t){return this.image.instantiateClass(e,t,this.nilObj)},arrayFill:function(e,t,i,r){for(var s=t;s<i;s++)e[s]=r},arrayCopy:function(e,t,i,r,s){if(e===i&&t<r)for(var n=s-1;0<=n;n--)i[r+n]=e[t+n];else for(n=0;n<s;n++)i[r+n]=e[t+n]},signalLowSpaceIfNecessary:function(e){var t;e<this.lowSpaceThreshold&&0<this.lowSpaceThreshold&&((t=prompt&&prompt("Out of memory, "+Math.ceil(this.image.totalMemory/1e6)+" MB used.\nEnter additional MB, or 0 to signal low space in image","0"))?(t=1e6*parseInt(t,10),this.image.totalMemory+=t,this.signalLowSpaceIfNecessary(this.image.bytesLeft())):(console.warn("squeak: low memory ("+e+"/"+this.image.totalMemory+" bytes left), signaling low space"),this.signalLowSpace=!0,this.lowSpaceThreshold=0,this.specialObjects[Squeak.splOb_ProcessSignalingLowSpace].isNil&&(this.specialObjects[Squeak.splOb_ProcessSignalingLowSpace]=this.primHandler.activeProcess()),this.forceInterruptCheck()))}},"debugging",{addMessage:function(e){return this.messages[e]?++this.messages[e]:this.messages[e]=1},warnOnce:function(e,t){if(1==this.addMessage(e))return console[t||"warn"](e),!0},printMethod:function(r,e,t,i){if(r.sqClass!=this.specialObjects[Squeak.splOb_ClassCompiledMethod])return this.printMethod(r.blockOuterCode(),e,t,i);var s;if(t){var n=e.className()+">>",t=t.bytesAsString();if(i&&i.length)for(var a=t.split(/(?<=:)/),o=0;o<i.length;o++)0<o&&(n+=" "),n+=a[o]+" "+i[o];else n+=t;return n}return r=r||this.activeContext.contextMethod(),this.allMethodsDo(function(e,t,i){if(t===r)return s=e.className()+">>"+i.bytesAsString()}),s||(e?"("+e.pointers[Squeak.Context_receiver]+")>>?":"?>>?")},allInstancesOf:function(e,t){"string"==typeof e&&(e=this.globalNamed(e));for(var i=[],r=this.image.someInstanceOf(e);r;)t?t(r):i.push(r),r=this.image.nextInstanceAfter(r);return i},globalNamed:function(i){return this.allGlobalsDo(function(e,t){if(e.bytesAsString()===i)return t})},allGlobalsDo:function(e){for(var t=this.getGlobals(),i=0;i<t.length;i++){var r=t[i];if(!r.isNil){r=e(r.pointers[0],r.pointers[1]);if(r)return r}}},allMethodsDo:function(h){this.allGlobalsDo(function(e,t){if(t.pointers&&9<=t.pointers.length)for(var i=[t,t.sqClass],r=0;r<i.length;r++){var s=i[r],n=s.pointers[1];if(n.pointers&&n.pointers[1]){var a=n.pointers[1].pointers;if(a){var o=n.pointers;if(a.length+2===o.length)for(var u=0;u<a.length;u++){var l=a[u],c=o[2+u];if(l.isMethod&&l.isMethod())if(c.bytesSize&&c.bytesSize())if(h.call(null,s,l,c))return!0}}}}})},printStack:function(e,t,i){"number"==typeof e&&(t=e,e=null),e=e||this.activeContext,t=t||100;for(var r=[],s=Math.max(t,1e6);!e.isNil&&0<s--;)r.push(e),e=e.pointers[Squeak.Context_sender];r.length>t+200&&(e.isNil||r.push("..."),r=r.slice(0,t).concat(["..."]).concat(r.slice(-200)));var n,a,o=[],u=r.length,l="";for(i&&this.logSends&&(l=Array((""+this.sendCount).length+2).join(" "));0<u--;)(e=r[u]).pointers?(a="","number"==typeof(n=e.pointers[Squeak.Context_method])?(n=e.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],a="[] in "):e.pointers[Squeak.Context_closure].isNil||(a="[] in "),a=a+this.printMethod(n,e),o.push((a=i?l+a:a)+"\n"),i&&(l+=i)):o.push("...\n");return o.join("")},findMethod:function(e){var r,s=e.split(">>")[0],n=e.split(">>")[1];return this.allMethodsDo(function(e,t,i){if(n.length==i.bytesSize()&&n==i.bytesAsString()&&s==e.className())return r=t}),r},breakAfter:function(e){this.breakOutTick=this.primHandler.millisecondClockValue()+e},breakNow:function(e){e&&console.log("Break: "+e),this.breakOutOfInterpreter="break"},breakOn:function(e){return this.breakOnMethod=e&&this.findMethod(e)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1,this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=!0,this.breakOnContextReturned=null},printContext:function(e,t){if(!this.isContext(e))return"NOT A CONTEXT: "+i(e);function i(e){e="number"==typeof e||"object"==typeof e?e.sqInstName():"<"+e+">";return e=(e=JSON.stringify(e).slice(1,-1)).length>t-3?e.slice(0,t-3)+"...":e}t=t||72;for(var r="number"==typeof e.pointers[Squeak.BlockContext_argumentCount],s=e.pointers[Squeak.Context_closure],n=!r&&!s.isNil,a=r?e.pointers[Squeak.BlockContext_home]:e,n=n?s.pointers[Squeak.Closure_numArgs]:a.pointers[Squeak.Context_method].methodTempCount(),o=this.decodeSqueakSP(0),u=a.contextSizeWithStack(this)-1,l=o+1,c=l+n-1,h=l+a.pointers[Squeak.Context_method].methodNumArgs()-1,f="",p=o;p<=u;p++){var d="";p===o?d="=rcvr":(p<=c&&(d="=tmp"+(p-l)),p<=h&&(d+="/arg"+(p-l))),f+="\nctx["+p+"]"+d+": "+i(a.pointers[p])}if(r){f+="\n";var s=e.pointers[Squeak.BlockContext_argumentCount],m=this.decodeSqueakSP(1),h=m+s,v=e===this.activeContext?this.sp:e.pointers[Squeak.Context_stackPointer];v<m&&(f+="\nblk <stack empty>");for(p=m;p<=v;p++)f+="\nblk["+p+"]"+(d=p<h?"=arg"+(p-m):"")+": "+i(e.pointers[p])}return f},printActiveContext:function(e){return this.printContext(this.activeContext,e)},printAllProcesses:function(){for(var e=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value],t=e.pointers[Squeak.ProcSched_activeProcess],i="Active: "+this.printProcess(t,!0),r=e.pointers[Squeak.ProcSched_processLists].pointers,s=r.length-1;0<=s;s--)for(var n=r[s].pointers[Squeak.LinkedList_firstLink];!n.isNil;)i=(i+="\n------------------------------------------")+"\nRunnable: "+this.printProcess(n),n=n.pointers[Squeak.Link_nextLink];for(var t=this.specialObjects[Squeak.splOb_ClassSemaphore],a=this.image.someInstanceOf(t),o=[];a;){for(n=a.pointers[Squeak.LinkedList_firstLink];!n.isNil;)o.push(n),n=n.pointers[Squeak.Link_nextLink];a=this.image.nextInstanceAfter(a)}o.sort(function(e,t){return t.pointers[Squeak.Proc_priority]-e.pointers[Squeak.Proc_priority]});for(var u=0;u<o.length;u++)i=(i+="\n------------------------------------------")+"\nWaiting: "+this.printProcess(o[u]);return i},printProcess:function(e,t,i){e||(e=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess],t=!0);var t=t?this.activeContext:e.pointers[Squeak.Proc_suspendedContext],r=e.pointers[Squeak.Proc_priority],s=this.printStack(t,20,i),i=i&&this.logSends?"":this.printContext(t)+"\n";return e.toString()+" at priority "+r+"\n"+s+i},printByteCodes:function(e,t,i,r){return e=e||this.method,new Squeak.InstructionPrinter(e,this).printInstructions(t,i,r)},logStack:function(){console.log(this.printStack()+this.printActiveContext()+"\n\n"+this.printByteCodes(this.method,"Â Â Â ","=> ",this.pc),this.activeContext.pointers.slice(0,this.sp+1))},willSendOrReturn:function(){var e,t=this.method.bytes[this.pc];if(this.method.methodSignFlag()){if(96<=t&&t<=127)i=this.specialSelectors[2*(t-96)];else if(128<=t&&t<=175)i=this.method.methodGetSelector(15&t);else if(234==t||235==t)this.method.methodGetSelector(this.method.bytes[this.pc+1]>>3);else if(88<=t&&t<=94)return!0}else{if(120<=t&&t<=125)return!0;if(t<131||200==t)return!1;if(176<=t)return!0;if(t<=134){if(132===t){if(1<this.method.bytes[this.pc+1]>>5)return!1;e=this.method.bytes[this.pc+2]}else e=this.method.bytes[this.pc+1]&(134===t?63:31);var i=this.method.methodGetLiteral(e);if("blockCopy:"!==i.bytesAsString())return!0}}return!1},nextSendSelector:function(){var e,t,i=this.method.bytes[this.pc];if(this.method.methodSignFlag())if(96<=i&&i<=127)e=this.specialSelectors[2*(i-96)];else if(128<=i&&i<=175)e=this.method.methodGetSelector(15&i);else{if(234!=i&&235!=i)return null;this.method.methodGetSelector(this.method.bytes[this.pc+1]>>3)}else{if(i<131||200==i)return null;if(208<=i)e=this.method.methodGetLiteral(15&i);else if(176<=i)e=this.specialSelectors[2*(i-176)];else if(i<=134){if(132===i){if(1<this.method.bytes[this.pc+1]>>5)return null;t=this.method.bytes[this.pc+2]}else t=this.method.bytes[this.pc+1]&(134===i?63:31);e=this.method.methodGetLiteral(t)}}if(e){i=e.bytesAsString();if("blockCopy:"!==i)return i}}}),Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(t){this.vm=t,this.remappableOops=[],Object.defineProperty(this,"successFlag",{get:function(){return t.primHandler.success},set:function(e){t.primHandler.success=e}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(e){this.successFlag=!1},success:function(e){e||(this.successFlag=!1)}},"stack access",{pop:function(e){this.vm.popN(e)},popthenPush:function(e,t){this.vm.popNandPush(e,t)},push:function(e){this.vm.push(e)},pushBool:function(e){this.vm.push(e?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(e){this.vm.push(e)},pushFloat:function(e){this.vm.push(this.floatObjectOf(e))},stackValue:function(e){return this.vm.stackValue(e)},stackIntegerValue:function(e){e=this.vm.stackValue(e);return"number"==typeof e?e:(this.successFlag=!1,0)},stackFloatValue:function(e){this.vm.success=!0;e=this.vm.stackIntOrFloat(e);return this.vm.success?e:(this.successFlag=!1,0)},stackObjectValue:function(e){e=this.vm.stackValue(e);return"number"!=typeof e?e:(this.successFlag=!1,this.vm.nilObj)},stackBytes:function(e){e=this.vm.stackValue(e);return e.bytes||("number"!=typeof e&&e.isBytes()||(this.successFlag=!1),[])},stackWords:function(e){e=this.vm.stackValue(e);return e.words||("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt32Array:function(e){e=this.vm.stackValue(e);return e.words?e.wordsAsInt32Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt16Array:function(e){e=this.vm.stackValue(e);return e.words?e.wordsAsInt16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackUint16Array:function(e){e=this.vm.stackValue(e);return e.words?e.wordsAsUint16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])}},"object access",{isBytes:function(e){return"number"!=typeof e&&e.isBytes()},isWords:function(e){return"number"!=typeof e&&e.isWords()},isWordsOrBytes:function(e){return"number"!=typeof e&&e.isWordsOrBytes()},isPointers:function(e){return"number"!=typeof e&&e.isPointers()},isIntegerValue:function(e){return"number"==typeof e&&-1073741824<=e&&e<=1073741823},isArray:function(e){return e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(e,t){var i=e.sqClass.pointers[Squeak.Class_name].bytes;if(t.length!==i.length)return!1;for(var r=0;r<t.length;r++)if(t.charCodeAt(r)!==i[r])return!1;return!0},booleanValueOf:function(e){return!!e.isTrue||(e.isFalse||(this.successFlag=!1),!1)},positive32BitValueOf:function(e){return this.vm.primHandler.positive32BitValueOf(e)},positive32BitIntegerFor:function(e){return this.vm.primHandler.pos32BitIntFor(e)},floatValueOf:function(e){return e.isFloat?e.float:(this.successFlag=!1,0)},floatObjectOf:function(e){return this.vm.primHandler.makeFloat(e)},fetchPointerofObject:function(e,t){return t.pointers[e]},fetchBytesofObject:function(e,t){t=t.pointers[e];return t.bytes||(t.words?t.wordsAsUint8Array():("number"!=typeof t&&t.isWordsOrBytes()||(this.successFlag=!1),[]))},fetchWordsofObject:function(e,t){t=t.pointers[e];return t.words||("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchInt32ArrayofObject:function(e,t){t=t.pointers[e];return t.words?t.wordsAsInt32Array():("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchInt16ArrayofObject:function(e,t){t=t.pointers[e];return t.words?t.wordsAsInt16Array():("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchUint16ArrayofObject:function(e,t){t=t.pointers[e];return t.words?t.wordsAsUint16Array():("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchIntegerofObject:function(e,t){t=t.pointers[e];return"number"==typeof t?t:(this.successFlag=!1,0)},fetchLong32ofObject:function(e,t){return t.words[e]},fetchFloatofObject:function(e,t){return this.floatValueOf(t.pointers[e])},storeIntegerofObjectwithValue:function(e,t,i){"number"==typeof i?t.pointers[e]=i:this.successFlag=!1},storePointerofObjectwithValue:function(e,t,i){t.pointers[e]=i},stObjectatput:function(e,t,i){if(e.sqClass!==this.classArray())throw Error("Array expected");if(t<1||t>e.pointers.length)return this.successFlag=!1;e.pointers[t-1]=i}},"constant access",{isKindOfInteger:function(e){return"number"==typeof e||e.sqClass==this.classLargeNegativeInteger()||e.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},classByteArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassByteArray]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{clone:function(e){return this.vm.image.clone(e)},instantiateClassindexableSize:function(e,t){return this.vm.instantiateClass(e,t)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(e,t){return this.vm.primHandler.makePointWithXandY(e,t)},pushRemappableOop:function(e){this.remappableOops.push(e)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(e,t,i,r,s){t<r&&i<s&&this.vm.primHandler.displayDirty(e,{left:t,top:i,right:r,bottom:s})},ioLoadFunctionFrom:function(e,t){return this.vm.primHandler.loadFunctionFrom(e,t)}}),Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(e,t){this.vm=t,this.method=e,this.pc=0,this.specialConstants=[t.trueObj,t.falseObj,t.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(e){var t=this.method,i=t.bytes[this.pc++],r=i/16|0,s=i%16;if(0==r)return e.pushReceiverVariable(s);if(1==r)return e.pushTemporaryVariable(s);if(2==r)return e.pushConstant(t.methodGetLiteral(s));if(3==r)return e.pushConstant(t.methodGetLiteral(16+s));if(4==r)return e.pushLiteralVariable(t.methodGetLiteral(s));if(5==r)return e.pushLiteralVariable(t.methodGetLiteral(16+s));if(6==r)return s<8?e.popIntoReceiverVariable(s):e.popIntoTemporaryVariable(s-8);if(7==r){if(0==s)return e.pushReceiver();if(s<8)return e.pushConstant(this.specialConstants[s-1]);if(8==s)return e.methodReturnReceiver();if(s<12)return e.methodReturnConstant(this.specialConstants[s-9]);if(12==s)return e.methodReturnTop();if(13==s)return e.blockReturnTop();if(13<s)throw Error("unusedBytecode")}return 8==r?this.interpretExtension(s,t,e):9==r?s<8?e.jump(1+s):e.jumpIf(!1,s-8+1):10==r?(i=this.method.bytes[this.pc++],s<8?e.jump(256*(s-4)+i):e.jumpIf(s<12,256*(3&s)+i)):11==r?e.send(this.vm.specialSelectors[2*s],this.vm.specialSelectors[2*s+1],!1):12==r?e.send(this.vm.specialSelectors[2*(16+s)],this.vm.specialSelectors[2*(16+s)+1],!1):12<r?e.send(t.methodGetLiteral(s),r-13,!1):void 0},interpretExtension:function(e,t,i){if(e<=6){var r=this.method.bytes[this.pc++];if(e<=2){var s=r/64|0,n=r%64;if(0===e){if(0===s)return i.pushReceiverVariable(n);if(1===s)return i.pushTemporaryVariable(n);if(2===s)return i.pushConstant(this.method.methodGetLiteral(n));if(3===s)return i.pushLiteralVariable(this.method.methodGetLiteral(n))}if(1===e){if(0===s)return i.storeIntoReceiverVariable(n);if(1===s)return i.storeIntoTemporaryVariable(n);if(2===s)throw Error("illegalStore");if(3===s)return i.storeIntoLiteralVariable(this.method.methodGetLiteral(n))}if(2===e){if(0===s)return i.popIntoReceiverVariable(n);if(1===s)return i.popIntoTemporaryVariable(n);if(2===s)throw Error("illegalStore");if(3===s)return i.popIntoLiteralVariable(this.method.methodGetLiteral(n))}}if(3===e)return i.send(this.method.methodGetLiteral(r%32),r/32|0,!1);if(4===e){var a=this.method.bytes[this.pc++];if(0===(s=r/32|0))return i.send(this.method.methodGetLiteral(a),r%32,!1);if(1===s)return i.send(this.method.methodGetLiteral(a),r%32,!0);if(2===s)return i.pushReceiverVariable(a);if(3===s)return i.pushConstant(this.method.methodGetLiteral(a));if(4===s)return i.pushLiteralVariable(this.method.methodGetLiteral(a));if(5===s)return i.storeIntoReceiverVariable(a);if(6===s)return i.popIntoReceiverVariable(a);if(7===s)return i.storeIntoLiteralVariable(this.method.methodGetLiteral(a))}if(5===e)return i.send(this.method.methodGetLiteral(31&r),r>>5,!0);if(6===e)return i.send(this.method.methodGetLiteral(63&r),r>>6,!1)}return 7===e?i.doPop():8===e?i.doDup():9===e?i.pushActiveContext():(r=this.method.bytes[this.pc++],10===e?r<128?i.pushNewArray(r):i.popIntoNewArray(r-128):(a=this.method.bytes[this.pc++],11===e?i.callPrimitive(r+256*a):12===e?i.pushRemoteTemp(r,a):13===e?i.storeIntoRemoteTemp(r,a):14===e?i.popIntoRemoteTemp(r,a):(n=this.method.bytes[this.pc++],i.pushClosureCopy(r>>4,15&r,256*a+n))))}}),Squeak.InstructionStream.subclass("Squeak.InstructionStreamSista","decoding",{interpretNextInstructionFor:function(e){return this.interpretNextInstructionExtFor(e,0,0)},interpretNextInstructionExtFor:function(e,t,i){this.Squeak;var r=this.method.bytes[this.pc++];switch(r){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return e.pushReceiverVariable(15&r);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return e.pushLiteralVariable(this.method.methodGetLiteral(15&r));case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return e.pushConstant(this.method.methodGetLiteral(31&r));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:return e.pushTemporaryVariable(15&r);case 72:case 73:case 74:case 75:return e.pushTemporaryVariable(8+(3&r));case 76:return e.pushReceiver();case 77:return e.pushConstant(this.vm.trueObj);case 78:return e.pushConstant(this.vm.falseObj);case 79:return e.pushConstant(this.vm.nilObj);case 80:return e.pushConstant(0);case 81:return e.pushConstant(1);case 82:return e.pushActiveContext();case 83:return e.doDup();case 88:return e.methodReturnReceiver();case 89:return e.methodReturnConstant(this.vm.trueObj);case 90:return e.methodReturnConstant(this.vm.falseObj);case 91:return e.methodReturnConstant(this.vm.nilObj);case 92:return e.methodReturnTop();case 93:return e.blockReturnConstant(this.vm.nilObj);case 94:if(0===t)return e.blockReturnTop();break;case 95:return e.nop();case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:return e.send(this.vm.specialSelectors[2*(r-96)],this.vm.specialSelectors[2*(r-96)+1],!1);case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:case 141:case 142:case 143:return e.send(this.method.methodGetLiteral(15&r),0,!1);case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return e.send(this.method.methodGetLiteral(15&r),1,!1);case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:return e.send(this.method.methodGetLiteral(15&r),2,!1);case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:return e.jump(1+(7&r));case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:return e.jumpIf(!0,1+(7&r));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:return e.jumpIf(!1,1+(7&r));case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return e.popIntoReceiverVariable(7&r);case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:return e.popIntoTemporaryVariable(r-208);case 216:return e.doPop()}var s=this.method.bytes[this.pc++];switch(r){case 224:return this.interpretNextInstructionExtFor(e,(t<<8)+s,i);case 225:return this.interpretNextInstructionExtFor(e,t,(i<<8)+(s<128?s:s-256));case 226:return e.pushReceiverVariable(s+(t<<8));case 227:return e.pushLiteralVariable(this.method.methodGetLiteral(s+(t<<8)));case 228:return e.pushConstant(this.method.methodGetLiteral(s+(t<<8)));case 229:return e.pushTemporaryVariable(s);case 231:return s<128?e.pushNewArray(s):e.popIntoNewArray(s-128);case 232:return e.pushConstant(s+(i<<8));case 233:var n=s+(i<<8);return e.pushConstant("$"+String.fromCodePoint(n)+" ("+n+")");case 234:return e.send(this.method.methodGetSelector((s>>3)+(t<<5)),(7&s)+(i<<3),!1);case 235:n=this.method.methodGetSelector((s>>3)+(t<<5));return 64<=i?e.sendSuperDirected(n):e.send(n,(7&s)+(i<<3),!0);case 237:return e.jump(s+(i<<8));case 238:return e.jumpIf(!0,s+(i<<8));case 239:return e.jumpIf(!1,s+(i<<8));case 240:return e.popIntoReceiverVariable(s+(t<<8));case 241:return e.popIntoLiteralVariable(this.method.methodGetLiteral(s+(t<<8)));case 242:return e.popIntoTemporaryVariable(s);case 243:return e.storeIntoReceiverVariable(s+(t<<8));case 244:return e.storeIntoLiteralVariable(this.method.methodGetLiteral(s+(t<<8)));case 245:return e.storeIntoTemporaryVariable(s)}var a=this.method.bytes[this.pc++];switch(r){case 248:return e.callPrimitive(s+(a<<8));case 249:var o=s+(t<<8),u=63&a,l=this.method.methodGetLiteral(o);return e.pushFullClosure(o,u,l.methodNumArgs());case 250:o=(7&s)+8*this.mod(t,16),u=(s>>3&7)+8*this.div(t,16);return e.pushClosureCopy(u,o,a+(i<<8));case 251:return e.pushRemoteTemp(s,a);case 252:return e.storeIntoRemoteTemp(s,a);case 253:return e.popIntoRemoteTemp(s,a)}throw Error("Unknown bytecode: "+r)}}),Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(e,t){this.method=e,this.vm=t}},"printing",{printInstructions:function(e,t,i){this.indent=e,this.highlight=t,this.highlightPC=i,this.innerIndents={},this.result="",this.scanner=new(this.method.methodSignFlag()?Squeak.InstructionStreamSista:Squeak.InstructionStream)(this.method,this.vm),this.oldPC=this.scanner.pc,this.endPC=0,this.done=!1;try{for(;!this.done;)this.scanner.interpretNextInstructionFor(this)}catch(e){this.print("!!! "+e.message)}return this.result},print:function(e){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent),this.result+=this.oldPC;for(var t=0;t<this.innerIndents[this.oldPC];t++)this.result+="   ";this.result+=" <";for(t=this.oldPC;t<this.scanner.pc;t++)t>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[t]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+e+"\n",this.oldPC=this.scanner.pc}},"decoding",{blockReturnConstant:function(e){this.print("blockReturn: "+e.toString()),this.done=this.scanner.pc>this.endPC},blockReturnTop:function(){this.print("blockReturn"),this.done=this.scanner.pc>this.endPC},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(e){this.print("jumpTo: "+(this.scanner.pc+e)),this.scanner.pc+e>this.endPC&&(this.endPC=this.scanner.pc+e)},jumpIf:function(e,t){this.print((e?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+t)),this.scanner.pc+t>this.endPC&&(this.endPC=this.scanner.pc+t)},methodReturnReceiver:function(){this.print("return: receiver"),this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack"),this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(e){this.print("returnConst: "+e.toString()),this.done=this.scanner.pc>this.endPC},nop:function(){this.print("nop")},popIntoLiteralVariable:function(e){this.print("popIntoBinding: "+e.assnKeyAsString())},popIntoReceiverVariable:function(e){this.print("popIntoInstVar: "+e)},popIntoTemporaryVariable:function(e){this.print("popIntoTemp: "+e)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(e){e=e.sqInstName?e.sqInstName():e.toString();this.print("pushConst: "+e)},pushLiteralVariable:function(e){this.print("pushBinding: "+e.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(e){this.print("pushInstVar: "+e)},pushTemporaryVariable:function(e){this.print("pushTemp: "+e)},send:function(e,t,i){this.print((i?"superSend: #":"send: #")+(e.bytesAsString?e.bytesAsString():e))},sendSuperDirected:function(e){this.print("directedSuperSend: #"+(e.bytesAsString?e.bytesAsString():e))},storeIntoLiteralVariable:function(e){this.print("storeIntoBinding: "+e.assnKeyAsString())},storeIntoReceiverVariable:function(e){this.print("storeIntoInstVar: "+e)},storeIntoTemporaryVariable:function(e){this.print("storeIntoTemp: "+e)},pushNewArray:function(e){this.print("push: (Array new: "+e+")")},popIntoNewArray:function(e){this.print("pop: "+e+" into: (Array new: "+e+")")},pushRemoteTemp:function(e,t){this.print("push: "+e+" ofTemp: "+t)},storeIntoRemoteTemp:function(e,t){this.print("storeInto: "+e+" ofTemp: "+t)},popIntoRemoteTemp:function(e,t){this.print("popInto: "+e+" ofTemp: "+t)},pushClosureCopy:function(e,t,i){var r=this.scanner.pc,s=r+i;this.print("closure("+r+"-"+(s-1)+"): "+e+" copied, "+t+" args");for(var n=r;n<s;n++)this.innerIndents[n]=(this.innerIndents[n]||0)+1;s>this.endPC&&(this.endPC=s)},pushFullClosure:function(e,t,i){this.print("pushFullClosure: (self literalAt: "+(e+1)+") numCopied: "+t+" numArgs: "+i)},callPrimitive:function(e){this.print("primitive: "+e)}}),Object.subclass("Squeak.Primitives","initialization",{initialize:function(e,t){this.vm=e,this.oldPrims=!this.vm.image.hasClosures,this.allowAccessBeyondSP=this.oldPrims,this.deferDisplayUpdates=!1,this.semaphoresToSignal=[],this.initDisplay(t),this.initAtCache(),this.initModules(),this.initPlugins(),e.image.isSpur&&(this.charFromInt=this.charFromIntSpur,this.charToInt=this.charToIntSpur,this.identityHash=this.identityHashSpur)},initDisplay:function(e){this.display=e},initModules:function(){this.loadedModules={},this.builtinModules={},this.patchModules={},this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},initPlugins:function(){}},"dispatch",{quickSendOther:function(e,t){switch(this.success=!0,t){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.popNandPushBoolIfOK(2,this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(e,t,i){switch(this.success=!0,e){case 1:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)-this.stackInteger(0));case 3:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)<this.stackInteger(0));case 4:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)>this.stackInteger(0));case 5:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)<=this.stackInteger(0));case 6:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)>=this.stackInteger(0));case 7:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)===this.stackInteger(0));case 8:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(t+1,this.vm.quickDivide(this.stackInteger(1),this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(t+1,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(t+1,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(t+1,this.doBitAnd());case 15:return this.popNandPushIfOK(t+1,this.doBitOr());case 16:return this.popNandPushIfOK(t+1,this.doBitXor());case 17:return this.popNandPushIfOK(t+1,this.doBitShift());case 18:return this.primitiveMakePoint(t,!1);case 19:return!1;case 20:return this.vm.warnOnce("missing primitive: 20 (primitiveRemLargeIntegers)"),!1;case 21:return this.vm.warnOnce("missing primitive: 21 (primitiveAddLargeIntegers)"),!1;case 22:return this.vm.warnOnce("missing primitive: 22 (primitiveSubtractLargeIntegers)"),!1;case 23:return this.primitiveLessThanLargeIntegers(t);case 24:return this.primitiveGreaterThanLargeIntegers(t);case 25:return this.primitiveLessOrEqualLargeIntegers(t);case 26:return this.primitiveGreaterOrEqualLargeIntegers(t);case 27:return this.primitiveEqualLargeIntegers(t);case 28:return this.primitiveNotEqualLargeIntegers(t);case 29:return this.vm.warnOnce("missing primitive: 29 (primitiveMultiplyLargeIntegers)"),!1;case 30:return this.vm.warnOnce("missing primitive: 30 (primitiveDivideLargeIntegers)"),!1;case 31:return this.vm.warnOnce("missing primitive: 31 (primitiveModLargeIntegers)"),!1;case 32:return this.vm.warnOnce("missing primitive: 32 (primitiveDivLargeIntegers)"),!1;case 33:return this.vm.warnOnce("missing primitive: 33 (primitiveQuoLargeIntegers)"),!1;case 34:return this.vm.warnOnce("missing primitive: 34 (primitiveBitAndLargeIntegers)"),!1;case 35:return this.vm.warnOnce("missing primitive: 35 (primitiveBitOrLargeIntegers)"),!1;case 36:return this.vm.warnOnce("missing primitive: 36 (primitiveBitXorLargeIntegers)"),!1;case 37:return this.vm.warnOnce("missing primitive: 37 (primitiveBitShiftLargeIntegers)"),!1;case 38:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(t+1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(t+1,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(t+1,this.stackFloat(1)-this.stackFloat(0));case 43:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)<this.stackFloat(0));case 44:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)>this.stackFloat(0));case 45:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)<=this.stackFloat(0));case 46:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)>=this.stackFloat(0));case 47:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)===this.stackFloat(0));case 48:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(t+1,this.stackFloat(1)*this.stackFloat(0));case 50:return this.popNandPushFloatIfOK(t+1,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(t+1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return this.popNandPushFloatIfOK(t+1,this.floatFractionPart(this.stackFloat(0)));case 53:return this.popNandPushIntIfOK(t+1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(t+1,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(t+1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(t+1,Math.sin(this.stackFloat(0)));case 57:return this.popNandPushFloatIfOK(t+1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(t+1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(t+1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(t+1,this.objectSize(!1));case 63:return this.popNandPushIfOK(t+1,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!0,!1));case 65:return this.vm.warnOnce("missing primitive: 65 (primitiveNext)"),!1;case 66:return this.vm.warnOnce("missing primitive: 66 (primitiveNextPut)"),!1;case 67:return this.vm.warnOnce("missing primitive: 67 (primitiveAtEnd)"),!1;case 68:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(t+1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(t+1,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(t,!1,!0);case 73:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(t+1,this.identityHash(this.stackNonInteger(0)));case 76:return this.primitiveStoreStackp(t);case 77:return this.popNandPushIfOK(t+1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(t+1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(t);case 80:return this.popNandPushIfOK(t+1,this.doBlockCopy());case 81:return this.primitiveBlockValue(t);case 82:return this.primitiveBlockValueWithArgs(t);case 83:return this.vm.primitivePerform(t);case 84:return this.vm.primitivePerformWithArgs(t,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(t);case 91:return this.primitiveTestDisplayDepth(t);case 92:return this.vm.warnOnce("missing primitive: 92 (primitiveSetDisplayMode)"),!1;case 93:return this.primitiveInputSemaphore(t);case 94:return this.primitiveGetNextEvent(t);case 95:return this.primitiveInputWord(t);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",t);case 97:return this.primitiveSnapshot(t);case 98:return this.primitiveStoreImageSegment(t);case 99:return this.primitiveLoadImageSegment(t);case 100:return this.vm.primitivePerformWithArgs(t,!0);case 101:return this.primitiveBeCursor(t);case 102:return this.primitiveBeDisplay(t);case 103:return this.primitiveScanCharacters(t);case 104:return this.vm.warnOnce("missing primitive: 104 (primitiveDrawLoop)"),!1;case 105:return this.popNandPushIfOK(t+1,this.doStringReplace());case 106:return this.primitiveScreenSize(t);case 107:return this.primitiveMouseButtons(t);case 108:return this.primitiveKeyboardNext(t);case 109:return this.primitiveKeyboardPeek(t);case 110:return this.popNandPushBoolIfOK(t+1,this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(t+1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(t+1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(t);case 114:return this.primitiveExitToDebugger(t);case 115:return this.primitiveChangeClass(t);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());case 117:return this.doNamedPrimitive(t,i);case 118:return this.primitiveDoPrimitiveWithArgs(t);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return this.primitiveCalloutToFFI(t,i);case 121:return this.primitiveImageName(t);case 122:return this.primitiveReverseDisplay(t);case 123:return this.vm.warnOnce("missing primitive: 123 (primitiveValueUninterruptably)"),!1;case 124:return this.popNandPushIfOK(t+1,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(t+1,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(t);case 127:return this.primitiveShowDisplayRect(t);case 128:return this.primitiveArrayBecome(t,!0,!0);case 129:return this.popNandPushIfOK(t+1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(t);case 131:return this.primitivePartialGC(t);case 132:return this.popNandPushBoolIfOK(t+1,this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return this.popNIfOK(t);case 134:return this.popNandPushIfOK(t+1,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(t+1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(t);case 137:return this.popNandPushIfOK(t+1,this.secondClock());case 138:return this.popNandPushIfOK(t+1,this.someObject());case 139:return this.popNandPushIfOK(t+1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(t);case 141:return this.primitiveClipboardText(t);case 142:return this.popNandPushIfOK(t+1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(t);case 145:return this.primitiveConstantFill(t);case 146:return this.namedPrimitive("JoystickTabletPlugin","primitiveReadJoystick",t);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",t);case 148:return this.popNandPushIfOK(t+1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(t);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(t);case 151:if(this.oldPrims)return this.primitiveFileClose(t);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(t);case 153:if(this.oldPrims)return this.primitiveFileOpen(t);case 154:if(this.oldPrims)return this.primitiveFileRead(t);case 155:if(this.oldPrims)return this.primitiveFileSetPosition(t);case 156:if(this.oldPrims)return this.primitiveFileDelete(t);case 157:if(this.oldPrims)return this.primitiveFileSize(t);break;case 158:return this.oldPrims?this.primitiveFileWrite(t):(this.vm.warnOnce("missing primitive: 158 (primitiveCompareWith)"),!1);case 159:return this.oldPrims?this.primitiveFileRename(t):this.popNandPushIntIfOK(t+1,1664525*this.stackSigned53BitInt(0)&268435455);case 160:return this.oldPrims?this.primitiveDirectoryCreate(t):this.primitiveAdoptInstance(t);case 161:return this.oldPrims?this.primitiveDirectoryDelimitor(t):(this.vm.warnOnce("missing primitive: 161 (primitiveSetIdentityHash)"),!1);case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(t);break;case 163:return this.oldPrims?this.primitiveDirectoryDelete(t):(this.vm.warnOnce("missing primitive: 163 (primitiveGetImmutability)"),!1);case 164:return this.popNandPushIfOK(t+1,this.vm.trueObj);case 165:case 166:return this.primitiveIntegerAtAndPut(t);case 167:return!1;case 168:return this.primitiveCopyObject(t);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(t):this.popNandPushBoolIfOK(t+1,this.vm.stackValue(1)!==this.vm.stackValue(0));case 170:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStart",t):this.primitiveAsCharacter(t);case 171:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStartWithSemaphore",t):this.popNandPushIfOK(t+1,this.stackNonInteger(0).hash);case 172:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStop",t):(this.vm.warnOnce("missing primitive: 172 (primitiveFetchMourner)"),this.popNandPushIfOK(t,this.vm.nilObj));case 173:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",t):this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!0));case 174:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",t):this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!0));case 175:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",t):this.vm.image.isSpur?this.popNandPushIfOK(t+1,this.behaviorHash(this.stackNonInteger(0))):(this.vm.warnOnce("primitive 175 called in non-spur image"),this.popNandPushIfOK(t+1,this.identityHash(this.stackNonInteger(0))));case 176:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",t):this.popNandPushIfOK(t+1,this.vm.image.isSpur?4194303:4095);case 177:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",t):this.popNandPushIfOK(t+1,this.allInstancesOf(this.stackNonInteger(0)));case 178:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primPluckedSoundmixSampleCountintostartingAtpan",t):!1;case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",t);break;case 180:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",t):!1;case 181:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",t):this.primitiveSizeInBytesOfInstance(t);case 182:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",t):this.primitiveSizeInBytes(t);case 183:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",t):this.primitiveIsPinned(t);case 184:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",t):this.primitivePin(t);case 185:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",t):this.primitiveExitCriticalSection(t);case 186:if(this.oldPrims)break;return this.primitiveEnterCriticalSection(t);case 187:if(this.oldPrims)break;return this.primitiveTestAndSetOwnershipOfCriticalSection(t);case 188:if(this.oldPrims)break;return this.primitiveExecuteMethodArgsArray(t);case 189:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",t):!1;case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",t);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",t);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",t);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",t);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",t);break;case 195:case 196:case 197:case 198:case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",t):this.primitiveClosureCopyWithCopiedValues(t);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",t):this.primitiveClosureValue(t);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",t):this.primitiveClosureValue(t);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",t):this.primitiveClosureValue(t);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAddressLookupResult",t):this.primitiveClosureValue(t);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",t):this.primitiveClosureValue(t);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",t):this.primitiveClosureValueWithArgs(t);case 207:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStatus",t):this.primitiveFullClosureValue(t);case 208:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverError",t):this.primitiveFullClosureValueWithArgs(t);case 209:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketCreate",t):this.primitiveFullClosureValueNoContextSwitch(t);case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",t):this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",t):this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",t):this.popNandPushIfOK(t+1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",t);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",t);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",t);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",t);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketConnectToPort",t);case 218:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketListenWithOrWithoutBacklog",t):this.primitiveDoNamedPrimitive(t);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",t);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",t);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",t):this.primitiveClosureValueNoContextSwitch(t);case 222:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",t):this.primitiveClosureValueNoContextSwitch(t);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",t);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",t);case 225:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAccept",t);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(t);case 231:return this.primitiveForceDisplayUpdate(t);case 232:return this.vm.warnOnce("missing primitive: 232 (primitiveFormPrint)"),!1;case 233:return this.primitiveSetFullScreen(t);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveDecompressFromByteArray",t);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",t);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",t);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",t);break;case 238:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",t):this.namedPrimitive("FloatArrayPlugin","primitiveAt",t);case 239:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortClose",t):this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",t);case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",t):this.popNandPushIfOK(t+1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",t):this.popNandPushIfOK(t+1,this.microsecondClockLocal());case 242:if(this.oldPrims)break;return this.primitiveSignalAtUTCMicroseconds(t);case 243:return this.oldPrims?this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",t):(this.vm.warnOnce("missing primitive: 243 (primitiveUpdateTimeZone)"),!1);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",t);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",t);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",t);break;case 248:return this.primitiveArrayBecome(t,!1,!1);case 249:return this.primitiveArrayBecome(t,!1,!0);case 254:return this.primitiveVMParameter(t);case 521:return this.namedPrimitive("MIDIPlugin","primitiveMIDIClosePort",t);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",t);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",t);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",t);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",t);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",t);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",t);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",t);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",t);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",t);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",t);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",t);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",t);case 571:return this.primitiveUnloadModule(t);case 572:return this.primitiveListBuiltinModule(t);case 573:return this.primitiveListLoadedModule(t);case 575:return this.vm.warnOnce("missing primitive: 575 (primitiveHighBit)"),!1;case 576:return this.vm.primitiveInvokeObjectAsMethod(t,i);case 578:return this.vm.warnOnce("missing primitive: 578 (primitiveSuspendAndBackupPC)"),!1}return console.error("primitive "+e+" not implemented yet"),!1},namedPrimitive:function(e,t,i){var r,s=""===e?this:this.loadedModules[e],n=!1,a=(void 0===s&&(s=this.loadModule(e),this.loadedModules[e]=s,n=!0),!1),o=this.vm.sp;return s?(this.interpreterProxy.argCount=i,"function"==typeof(r=s[this.interpreterProxy.primitiveName=t])?a=s[t](i):"string"==typeof r?a=this[r](i):this.vm.warnOnce("missing primitive: "+e+"."+t)):n&&(this.success?this.vm.warnOnce("missing module: "+e+" ("+t+")"):this.vm.warnOnce("failed to load module: "+e+" ("+t+")")),(!0===a||!1!==a&&this.success)&&this.vm.sp!==o-i&&!this.vm.frozen&&this.vm.warnOnce("stack unbalanced after primitive "+e+"."+t,"error"),!0===a||!1===a?a:this.success},doNamedPrimitive:function(e,t){if(t.pointersSize()<2)return!1;var i=t.pointers[1];if(4!==i.pointersSize())return!1;this.primMethod=t;t=i.pointers[0].bytesAsString(),i=i.pointers[1].bytesAsString();return this.namedPrimitive(t,i,e)},fakePrimitive:function(e,t,i){return this.vm.warnOnce("faking primitive: "+e),void 0===t?this.vm.popN(i):this.vm.popNandPush(i+1,this.makeStObject(t)),!0}},"modules",{loadModule:function(e){var t,i=Squeak.externalModules[e]||this.builtinModules[e]||this.loadModuleDynamically(e);return i?(this.patchModules[e]&&this.patchModule(i,e),i.setInterpreter&&!i.setInterpreter(this.interpreterProxy)?(console.log("Wrong interpreter proxy version: "+e),null):("function"==typeof(t=i.initialiseModule)?i.initialiseModule():"string"==typeof t&&this[t](),this.interpreterProxy.failed()?(console.log("Module initialization failed: "+e),null):(i.getModuleName&&(e=i.getModuleName()),console.log("Loaded module: "+e),i))):null},loadModuleDynamically:function(e){},patchModule:function(e,t){var i,r=this.patchModules[t];for(i in r)e[i]=r[i]},unloadModule:function(e){var t=this.loadedModules[e];if(!e||!t||t===this)return null;delete this.loadedModules[e];var i=t.unloadModule;return"function"==typeof i?t.unloadModule(this):"string"==typeof i&&this[i](this),console.log("Unloaded module: "+e),t},loadFunctionFrom:function(e,t){var i=""===t?this:this.loadedModules[t];if(void 0===i&&(i=this.loadModule(t),this.loadedModules[t]=i),i){var r=i[e];if("function"==typeof r)return r.bind(i);if("string"==typeof r)return this[r].bind(this);this.vm.warnOnce("missing primitive: "+t+"."+e)}return null},primitiveUnloadModule:function(e){var t=this.stackNonInteger(0).bytesAsString();return!!t&&(this.unloadModule(t),this.popNIfOK(e))},primitiveListBuiltinModule:function(e){var t,i=this.stackInteger(0)-1;return!!this.success&&(t=Object.keys(this.builtinModules),this.popNandPushIfOK(e+1,this.makeStObject(t[i])))},primitiveListLoadedModule:function(e){var t=this.stackInteger(0)-1;if(!this.success)return!1;var i,r=[];for(i in this.loadedModules){var s=this.loadedModules[i];s&&(s=s.getModuleName?s.getModuleName():i,r.push(s))}return this.popNandPushIfOK(e+1,this.makeStObject(r[t]))}},"stack access",{popNIfOK:function(e){return!!this.success&&(this.vm.popN(e),!0)},pop2andPushBoolIfOK:function(e){return this.vm.success=this.success,this.vm.pop2AndPushBoolResult(e)},popNandPushBoolIfOK:function(e,t){return!!this.success&&(this.vm.popNandPush(e,t?this.vm.trueObj:this.vm.falseObj),!0)},popNandPushIfOK:function(e,t){return!(!this.success||null==t||(this.vm.popNandPush(e,t),0))},popNandPushIntIfOK:function(e,t){return!(!this.success||!this.vm.canBeSmallInt(t)||(this.vm.popNandPush(e,t),0))},popNandPushFloatIfOK:function(e,t){return!!this.success&&(this.vm.popNandPush(e,this.makeFloat(t)),!0)},stackNonInteger:function(e){return this.checkNonInteger(this.vm.stackValue(e))},stackInteger:function(e){return this.checkSmallInt(this.vm.stackValue(e))},stackPos32BitInt:function(e){return this.positive32BitValueOf(this.vm.stackValue(e))},pos32BitIntFor:function(e){if(0<=e&&e<=Squeak.MaxSmallInt)return e;for(var t=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],t=this.vm.instantiateClass(t,4),i=t.bytes,r=0;r<4;r++)i[r]=e>>>8*r&255;return t},pos53BitIntFor:function(e){if(e<=4294967295)return this.pos32BitIntFor(e);if(9007199254740991<e)return console.warn("Out of range: pos53BitIntFor("+e+")"),this.success=!1,0;for(var t=e<=0xffffffffff?5:e<=0xffffffffffff?6:7,i=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],i=this.vm.instantiateClass(i,t),r=i.bytes,s=0;s<t;s++)r[s]=255&e,e/=256;return i},stackSigned32BitInt:function(e){e=this.vm.stackValue(e);if("number"==typeof e)return e;if(4===e.bytesSize()){for(var t=e.bytes,i=0,r=0,s=1;r<4;r++,s*=256)i+=t[r]*s;if(this.isA(e,Squeak.splOb_ClassLargePositiveInteger)&&i<=2147483647)return i;if(this.isA(e,Squeak.splOb_ClassLargeNegativeInteger)&&-2147483648<=-i)return-i}return this.success=!1,0},signed32BitIntegerFor:function(e){if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return e;for(var t=e<0,i=t?-e:e,e=t?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,t=this.vm.instantiateClass(this.vm.specialObjects[e],4),r=t.bytes,s=0;s<4;s++)r[s]=i>>>8*s&255;return t},stackFloat:function(e){return this.checkFloat(this.vm.stackValue(e))},stackBoolean:function(e){return this.checkBoolean(this.vm.stackValue(e))},stackSigned53BitInt:function(e){e=this.vm.stackValue(e);if("number"==typeof e)return e;var t=e.bytesSize();if(t<=7){for(var i=e.bytes,r=0,s=0,n=1;s<t;s++,n*=256)r+=i[s]*n;if(r<=9007199254740991){if(this.isA(e,Squeak.splOb_ClassLargePositiveInteger))return r;if(this.isA(e,Squeak.splOb_ClassLargeNegativeInteger))return-r}}return this.success=!1,0}},"numbers",{doBitAnd:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e&t):0},doBitOr:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e|t):0},doBitXor:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e^t):0},doBitShift:function(){var e,t=this.stackPos32BitInt(1),i=this.stackInteger(0);if(!this.success)return 0;if(i<0){if(i<-31)return 0;e=t>>>-i}else{if(31<i)return this.success=!1,0;if((e=t<<i)>>>i!==t)return this.success=!1,0}return this.pos32BitIntFor(e)},safeFDiv:function(e,t){return 0===t?(this.success=!1,1):e/t},floatAsSmallInt:function(e){e=0<=e?Math.floor(e):Math.ceil(e);return this.ensureSmallInt(e)},floatFractionPart:function(e){return-9007199254740991<=e&&e<=9007199254740991?e-Math.floor(e):(this.success=!1,0)},frexp_exponent:function(e){var t,i;return 0==e?0:((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e),0===(i=t.getUint32(0)>>>20&2047)&&(t.setFloat64(0,e*Math.pow(2,64)),i=(t.getUint32(0)>>>20&2047)-64),i-1022)},ldexp:function(e,t){for(var i=Math.min(3,Math.ceil(Math.abs(t)/1023)),r=e,s=0;s<i;s++)r*=Math.pow(2,Math.floor((t+s)/i));return r},primitiveLessThanLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)>this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},primitiveGreaterOrEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)>=this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)!==this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(e){return e.isFloat?e.float:"number"==typeof e?e:0},positive32BitValueOf:function(e){if("number"==typeof e)return 0<=e?e:(this.success=!1,0);if(!this.isA(e,Squeak.splOb_ClassLargePositiveInteger)||4!==e.bytesSize())return this.success=!1,0;for(var t=e.bytes,i=0,r=0,s=1;r<4;r++,s*=256)i+=t[r]*s;return i},checkFloat:function(e){return e.isFloat?e.float:"number"==typeof e?e:(this.success=!1,0)},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,0)},checkNonInteger:function(e){return"number"!=typeof e?e:(this.success=!1,this.vm.nilObj)},checkBoolean:function(e){return!!e.isTrue||!e.isFalse&&(this.success=!1)},indexableSize:function(e){return"number"==typeof e?-1:e.indexableSize(this)},isA:function(e,t){return e.sqClass===this.vm.specialObjects[t]},isKindOf:function(e,t){for(var i=e.sqClass,r="number"==typeof t?this.vm.specialObjects[t]:t;!i.isNil;){if(i===r)return!0;i=i.superclass()}return!1},isAssociation:function(e){if(this.associationClass&&e.sqClass===this.associationClass)return!0;if(!e.pointers||2!==e.pointers.length)return!1;for(var t=this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].sqClass;0<t.superclass().classInstSize();)t=t.superclass();var i=this.isKindOf(e,t);return i&&(this.associationClass=e.sqClass),i},ensureSmallInt:function(e){return e===(0|e)&&this.vm.canBeSmallInt(e)?e:(this.success=!1,0)},charFromInt:function(e){var t,i=this.vm.specialObjects[Squeak.splOb_CharacterTable].pointers[e];return i||(t=this.vm.specialObjects[Squeak.splOb_ClassCharacter],(i=this.vm.instantiateClass(t,0)).pointers[0]=e),i},charFromIntSpur:function(e){return this.vm.image.getCharacter(e)},charToInt:function(e){return e.pointers[0]},charToIntSpur:function(e){return e.hash},makeFloat:function(e){var t=this.vm.specialObjects[Squeak.splOb_ClassFloat],t=this.vm.instantiateClass(t,2);return t.float=e,t},makeLargeIfNeeded:function(e){return this.vm.canBeSmallInt(e)?e:this.makeLargeInt(e)},makeLargeInt:function(e){if(e<0)throw Error("negative large ints not implemented yet");if(4294967295<e)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(e)},makePointWithXandY:function(e,t){var i=this.vm.specialObjects[Squeak.splOb_ClassPoint],i=this.vm.instantiateClass(i,0);return i.pointers[Squeak.Point_x]=e,i.pointers[Squeak.Point_y]=t,i},makeStArray:function(e,t){for(var i=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],e.length),r=0;r<e.length;r++)i.pointers[r]=this.makeStObject(e[r],t);return i},makeStByteArray:function(e){for(var t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassByteArray],e.length),i=0;i<e.length;i++)t.bytes[i]=255&e[i];return t},makeStString:function(e){for(var t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],e.length),i=0;i<e.length;++i)t.bytes[i]=255&e.charCodeAt(i);return t},makeStStringFromBytes:function(e,t){for(var i=e.length,r=(t&&(i=e.indexOf(0))<0&&(i=e.length),this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],i)),s=0;s<i;++s)r.bytes[s]=e[s];return r},makeStObject:function(e,t){if(null==e)return this.vm.nilObj;if(!0===e)return this.vm.trueObj;if(!1===e)return this.vm.falseObj;if(e.sqClass)return e;if("number"==typeof e)return e===(0|e)?this.makeLargeIfNeeded(e):this.makeFloat(e);if(t)return(t=this.vm.instantiateClass(t,0)).jsObject=e,t;if("string"==typeof e||"Uint8Array"===e.constructor.name)return this.makeStString(e);if("Array"===e.constructor.name)return this.makeStArray(e);throw Error("cannot make smalltalk object")},pointsTo:function(e,t){return!!e.pointers&&0<=e.pointers.indexOf(t)},asUint8Array:function(e){if("Uint8Array"===e.constructor.name)return e;if("ArrayBuffer"===e.constructor.name)return new Uint8Array(e);if("string"!=typeof e)throw Error("unknown buffer type");for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t},filenameToSqueak:function(e){e="/SqueakJS"+("/"!==e[0]?"/":"")+e;return e=this.emulateMac?("Macintosh HD"+e).replace(/\//g,"â‚¬").replace(/:/g,"/").replace(/â‚¬/g,":"):e},filenameFromSqueak:function(e){return(this.emulateMac?e.replace(/^[^:]*:/,":").replace(/\//g,"â‚¬").replace(/:/g,"/").replace(/â‚¬/g,":"):e).replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(e,t,i){var r,s=this.stackNonInteger(1),n=this.stackPos32BitInt(0);if(!this.success)return s;if(e){if((r=this.atCache[s.hash&this.atCacheMask]).array!==s)return this.success=!1,s}else{if(s.isFloat)return e=s.floatData(),1==n?this.pos32BitIntFor(e.getUint32(0,!1)):2==n?this.pos32BitIntFor(e.getUint32(4,!1)):(this.success=!1,s);r=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],s,t,i)}return n<1||n>r.size?(this.success=!1,s):i?s.pointers[n-1]:s.isPointers()?s.pointers[n-1+r.ivarOffset]:s.isWords()?r.convertChars?this.charFromInt(1073741823&s.words[n-1]):this.pos32BitIntFor(s.words[n-1]):s.isBytes()?r.convertChars?this.charFromInt(255&s.bytes[n-1]):255&s.bytes[n-1]:n-1-(e=4*s.pointersSize())<0?(this.success=!1,s):255&s.bytes[n-1-e]},objectAtPut:function(e,t,i){var r,s=this.stackNonInteger(2),n=this.stackPos32BitInt(1);if(!this.success)return s;if(e){if((r=this.atPutCache[s.hash&this.atCacheMask]).array!==s)return this.success=!1,s}else{if(s.isFloat)return e=this.stackPos32BitInt(0),!this.success||1!=n&&2!=n?this.success=!1:((o=s.floatData()).setUint32(1==n?0:4,e,!1),s.float=o.getFloat64(0)),this.vm.stackValue(0);r=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],s,t,i)}if(n<1||n>r.size)return this.success=!1,s;var a,e=this.vm.stackValue(0);if(i)return s.dirty=!0,s.pointers[n-1]=e;if(s.isPointers())return s.dirty=!0,s.pointers[n-1+r.ivarOffset]=e;if(s.isWords()){if(t){if(e.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,e;if("number"!=typeof(a=this.charToInt(e)))return this.success=!1,e}else a=this.stackPos32BitInt(0);this.success&&(s.words[n-1]=a)}else{if(t){if(e.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,e;if("number"!=typeof(a=this.charToInt(e)))return this.success=!1,e}else{if("number"!=typeof e)return this.success=!1,e;a=e}if(a<0||255<a)this.success=!1;else if(s.isBytes())s.bytes[n-1]=a;else{var o=4*s.pointersSize();if(n-1-o<0)return this.success=!1,s;s.bytes[n-1-o]=a}}return e},objectSize:function(e){var t=this.vm.stackValue(0),i=-1;return e?t.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?i=t.pointersSize():t.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(i=t.bytesSize()):i=this.indexableSize(t),-1===i?(this.success=!1,-1):this.pos32BitIntFor(i)},initAtCache:function(){this.atCacheSize=32,this.atCacheMask=this.atCacheSize-1,this.atCache=[],this.atPutCache=[],this.nonCachedInfo={};for(var e=0;e<this.atCacheSize;e++)this.atCache.push({}),this.atPutCache.push({})},makeAtCacheInfo:function(e,t,i,r,s){t=this.vm.verifyAtSelector===t&&this.vm.verifyAtClass===i.sqClass&&!this.vm.isContext(i)?e[i.hash&this.atCacheMask]:this.nonCachedInfo;return t.array=i,t.convertChars=r,s?(t.size=i.instSize()+Math.max(0,i.indexableSize(this)),t.ivarOffset=0):(t.size=i.indexableSize(this),t.ivarOffset=i.isPointers()?i.instSize():0),t}},"basic",{instantiateClass:function(e,t){return 4*t>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory, failing allocation"),this.success=!1,this.vm.primFailCode=Squeak.PrimErrNoMemory,null):this.vm.instantiateClass(e,t)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(e){return this.vm.image.objectAfter(e)||0},someInstanceOf:function(e){e=this.vm.image.someInstanceOf(e);return e||(this.success=!1,0)},nextInstanceAfter:function(e){e=this.vm.image.nextInstanceAfter(e);return e||(this.success=!1,0)},allInstancesOf:function(e){var e=this.vm.image.allInstancesOf(e),t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],e.length);return t.pointers=e,t},identityHash:function(e){return e.hash},identityHashSpur:function(e){var t=e.hash;return 0<t?t:e.hash=this.newObjectHash()},behaviorHash:function(e){var t=e.hash;return 0<t?t:this.vm.image.enterIntoClassTable(e)},newObjectHash:function(e){return Math.floor(4194302*Math.random())+1},primitivePin:function(e){var t,i=this.stackNonInteger(1),r=this.stackBoolean(0);return!!this.success&&(t=i.pinned,i.pinned=r,this.popNandPushIfOK(e+1,this.makeStObject(!!t)))},primitiveIsPinned:function(e){var t=this.stackNonInteger(0);return!!this.success&&this.popNandPushIfOK(e+1,this.makeStObject(!!t.pinned))},primitiveSizeInBytesOfInstance:function(e){var t,i;return!(1<e)&&(i=this.stackNonInteger(e),t=e?this.stackInteger(0):0,i=i.classByteSizeOfInstance(t),this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(i)))},primitiveSizeInBytes:function(e){var t=this.stackNonInteger(0).totalBytes();return this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t))},primitiveAsCharacter:function(e){var t=this.stackInteger(0);return!(t<0||1073741823<t||!(t=this.charFromInt(t)))&&this.popNandPushIfOK(e+1,t)},primitiveFullGC:function(e){this.vm.image.fullGC("primitive");var t=this.vm.image.bytesLeft();return this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t))},primitivePartialGC:function(e){for(var t=this.vm.image.partialGC("primitive"),i=0;t;)i+=t.totalBytes(),t=t.nextObject;console.log("    old space: "+this.vm.image.oldSpaceBytes.toLocaleString()+" bytes, young space: "+i.toLocaleString()+" bytes, total: "+(this.vm.image.oldSpaceBytes+i).toLocaleString()+" bytes");var r=this.vm.image.bytesLeft()-i;return this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(r))},primitiveMakePoint:function(e,t){var i=this.vm.stackValue(1),r=this.vm.stackValue(0);return!(t&&(this.checkFloat(i),this.checkFloat(r),!this.success)||(this.vm.popNandPush(1+e,this.makePointWithXandY(i,r)),0))},primitiveStoreStackp:function(e){var t=this.stackNonInteger(1),i=this.stackInteger(0);if(!this.success||i<0||this.vm.decodeSqueakSP(i)>=t.pointers.length)return!1;for(var r=t.pointers[Squeak.Context_stackPointer];r<i;)t.pointers[this.vm.decodeSqueakSP(++r)]=this.vm.nilObj;return t.pointers[Squeak.Context_stackPointer]=i,this.vm.popN(e),!0},primitiveChangeClass:function(e){var t,i;return!(2<e||(t=this.stackNonInteger(1),i=this.stackNonInteger(0),!this.changeClassTo(t,i.sqClass)))&&this.popNIfOK(e)},primitiveAdoptInstance:function(e){var t,i;return!(2<e||(t=this.stackNonInteger(1),i=this.stackNonInteger(0),!this.changeClassTo(i,t)))&&this.popNIfOK(e)},changeClassTo:function(e,t){if(e.sqClass.isCompact!==t.isCompact)return!1;var i=t.classInstIsPointers();if(e.isPointers()){if(!i)return!1;if(e.sqClass.classInstSize()!==t.classInstSize())return!1}else{if(i)return!1;var i=e.isBytes(),r=t.classInstIsBytes();if(i&&!r){if(e.bytes){if(3&e.bytes.length)return!1;e.words=new Uint32Array(e.bytes.buffer),delete e.bytes}}else!i&&r&&e.words&&(e.bytes=new Uint8Array(e.words.buffer),delete e.words)}return e._format=t.classInstFormat(),e.sqClass=t,!0},primitiveDoPrimitiveWithArgs:function(e){var t=this.stackNonInteger(0),i=this.stackInteger(1);if(this.success){var r=t.pointersSize(),s=this.vm.activeContext.pointersSize();if(!(this.vm.sp+r>=s)){this.vm.popN(2);for(var n=0;n<r;n++)this.vm.push(t.pointers[n]);if(this.vm.tryPrimitive(i,r))return!0;this.vm.popN(r),this.vm.push(i),this.vm.push(t)}}return!1},primitiveDoNamedPrimitive:function(e){var t=this.stackNonInteger(0),i=this.stackNonInteger(1),r=this.stackNonInteger(2);if(this.success){var s=t.pointersSize(),n=this.vm.activeContext.pointersSize();if(!(this.vm.sp+s>=n)){this.vm.popN(3),this.vm.push(i);for(var a=0;a<s;a++)this.vm.push(t.pointers[a]);if(this.doNamedPrimitive(s,r))return!0;this.vm.popN(s+1),this.vm.push(r),this.vm.push(i),this.vm.push(t)}}return!1},primitiveShortAtAndPut:function(e){var t,i=this.stackNonInteger(e),r=this.stackInteger(e-1)-1,i=i.wordsAsInt16Array();if(!this.success||!i||r<0||r>=i.length)return!1;if(e<2)t=i[r];else{if((t=this.stackInteger(0))<-32768||32767<t)return!1;i[r]=t}return this.popNandPushIfOK(e+1,t),!0},primitiveIntegerAtAndPut:function(e){var t,i=this.stackNonInteger(e),r=this.stackInteger(e-1)-1,i=i.wordsAsInt32Array();if(!this.success||!i||r<0||r>=i.length)return!1;if(e<2)t=this.signed32BitIntegerFor(i[r]);else{if(t=this.stackSigned32BitInt(0),!this.success)return!1;i[r]=t}return this.popNandPushIfOK(e+1,t),!0},primitiveConstantFill:function(e){var t=this.stackNonInteger(1),i=this.stackPos32BitInt(0);if(!this.success||!t.isWordsOrBytes())return!1;var r=t.words||t.bytes;if(r){if(r===t.bytes&&255<i)return!1;for(var s=0;s<r.length;s++)r[s]=i}return this.vm.popN(e),!0},primitiveNewMethod:function(e){var t=this.stackInteger(0),i=this.stackInteger(1);if(!this.success)return 0;for(var r=this.vm.instantiateClass(this.vm.stackValue(2),i),s=(r.pointers=[t],r.methodNumLits()),n=0;n<s;n++)r.pointers.push(this.vm.nilObj);return this.vm.popNandPush(1+e,r),this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=r),!0},primitiveExecuteMethodArgsArray:function(e){var t=this.stackNonInteger(0),i=this.stackNonInteger(1),r=this.vm.stackValue(2);if(!this.success||!t.isMethod()||4<e)return!1;var s=t.methodNumArgs();if(s!==i.pointersSize())return!1;this.vm.popNandPush(e+1,r);for(var n=0;n<s;n++)this.vm.push(i.pointers[n]);return this.vm.executeNewMethod(r,t,s,t.methodPrimitiveIndex(),null,null),!0},primitiveArrayBecome:function(e,t,i){var r=this.stackNonInteger(e),s=this.stackNonInteger(e-1);return 1<e&&(i=this.stackBoolean(e-2)),!!this.success&&(this.success=this.vm.image.bulkBecome(r.pointers,s.pointers,t,i),this.popNIfOK(e))},doStringReplace:function(){var e=this.stackNonInteger(4),t=this.stackInteger(3)-1,i=this.stackInteger(2)-t,r=this.stackNonInteger(1),s=this.stackInteger(0)-1;if(this.success)if(r.sameFormatAs(e))if(r.isPointers()){var n=r.pointersSize(),a=r.instSize();if((s+=a)<0||n<s+i)this.success=!1;else if(n=e.pointersSize(),(t+=e.instSize())<0||n<t+i)this.success=!1;else for(var o=0;o<i;o++)e.pointers[t+o]=r.pointers[s+o]}else if(r.isWords()){n=r.wordsSize();if(s<0||n<s+i)this.success=!1;else if(n=e.wordsSize(),t<0||n<t+i)this.success=!1;else if(r.isFloat&&e.isFloat)e.float=r.float;else if(r.isFloat)e.wordsAsFloat64Array()[t]=r.float;else if(e.isFloat)e.float=r.wordsAsFloat64Array()[s];else for(o=0;o<i;o++)e.words[t+o]=r.words[s+o]}else{n=r.bytesSize();if(s<0||n<s+i)this.success=!1;else if(n=e.bytesSize(),t<0||n<t+i)this.success=!1;else for(o=0;o<i;o++)e.bytes[t+o]=r.bytes[s+o]}else this.success=!1;return e},primitiveCopyObject:function(e){var t=this.stackNonInteger(1),i=this.stackNonInteger(0),r=t.pointersSize();if(!this.success||t.isWordsOrBytes()||t.sqClass!==i.sqClass||r!==i.pointersSize())return!1;for(var s=0;s<r;s++)t.pointers[s]=i.pointers[s];return t.dirty=i.dirty,this.vm.popN(e),!0},primitiveStoreImageSegment:function(e){var t=this.stackNonInteger(2),i=this.stackNonInteger(1),r=this.stackNonInteger(0);return!!(t.pointers&&i.words&&r.pointers)&&!!this.vm.image.storeImageSegment(i,r,t)&&(this.vm.popN(e),!0)},primitiveLoadImageSegment:function(e){var t=this.stackNonInteger(1),i=this.stackNonInteger(0);return!(!t.words||!i.pointers||!(t=this.vm.image.loadImageSegment(t,i)))&&this.popNandPushIfOK(e+1,t)}},"blocks/closures",{doBlockCopy:function(){var e,t,i=this.vm.stackValue(1),r=this.stackInteger(0),s=i;return this.vm.isContext(s)||(this.success=!1),this.success?(e=(s="number"==typeof s.pointers[Squeak.Context_method]?s.pointers[Squeak.BlockContext_home]:s).pointersSize()-s.instSize(),e=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],e),t=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method),e.pointers[Squeak.BlockContext_initialIP]=t,e.pointers[Squeak.Context_instructionPointer]=t,e.pointers[Squeak.Context_stackPointer]=0,e.pointers[Squeak.BlockContext_argumentCount]=r,e.pointers[Squeak.BlockContext_home]=s,e.pointers[Squeak.Context_sender]=this.vm.nilObj,e):i},primitiveBlockValue:function(e){var t=this.vm.stackValue(e);if(!this.isA(t,Squeak.splOb_ClassBlockContext))return!1;var i=t.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof i)return!1;if(i!=e)return!1;if(!t.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-e+1,t.pointers,Squeak.Context_tempFrameStart,e);i=t.pointers[Squeak.BlockContext_initialIP];return t.pointers[Squeak.Context_instructionPointer]=i,t.pointers[Squeak.Context_stackPointer]=e,t.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(e+1),this.vm.newActiveContext(t),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveBlockValueWithArgs:function(e){var t=this.vm.stackValue(1),i=this.vm.stackValue(0);if(!this.isA(t,Squeak.splOb_ClassBlockContext))return!1;if(!this.isA(i,Squeak.splOb_ClassArray))return!1;var r=t.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof r)return!1;if(r!=i.pointersSize())return!1;if(!t.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(i.pointers,0,t.pointers,Squeak.Context_tempFrameStart,r);i=t.pointers[Squeak.BlockContext_initialIP];return t.pointers[Squeak.Context_instructionPointer]=i,t.pointers[Squeak.Context_stackPointer]=r,t.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(e+1),this.vm.newActiveContext(t),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveClosureCopyWithCopiedValues:function(e){return this.vm.breakNow("primitiveClosureCopyWithCopiedValues"),!1},primitiveClosureValue:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewClosureMethod(t,e),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0)},primitiveClosureValueWithArgs:function(e){var t=this.vm.top(),i=t.pointersSize(),e=this.vm.stackValue(e);if(i!==e.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var r=0;r<i;r++)this.vm.push(t.pointers[r]);return this.activateNewClosureMethod(e,i),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveClosureValueNoContextSwitch:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewClosureMethod(t,e),!0)},primitiveFullClosureValue:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewFullClosure(t,e),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0)},primitiveFullClosureValueWithArgs:function(e){var t=this.vm.top(),i=t.pointersSize(),e=this.vm.stackValue(e);if(i!==e.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var r=0;r<i;r++)this.vm.push(t.pointers[r]);return this.activateNewFullClosure(e,i),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveFullClosureValueNoContextSwitch:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewFullClosure(t,e),!0)},activateNewClosureMethod:function(e,t){for(var i=e.pointers[Squeak.Closure_outerContext],r=i.pointers[Squeak.Context_method],s=this.vm.allocateOrRecycleContext(r.methodNeedsLargeFrame()),n=e.pointers.length-Squeak.Closure_firstCopiedValue,a=(s.pointers[Squeak.Context_sender]=this.vm.activeContext,s.pointers[Squeak.Context_instructionPointer]=e.pointers[Squeak.Closure_startpc],s.pointers[Squeak.Context_stackPointer]=t+n,s.pointers[Squeak.Context_method]=i.pointers[Squeak.Context_method],s.pointers[Squeak.Context_closure]=e,s.pointers[Squeak.Context_receiver]=i.pointers[Squeak.Context_receiver],Squeak.Context_tempFrameStart),o=0;o<t;o++)s.pointers[a++]=this.vm.stackValue(t-o-1);for(o=0;o<n;o++)s.pointers[a++]=e.pointers[Squeak.Closure_firstCopiedValue+o];this.vm.popN(t+1),this.vm.newActiveContext(s)},activateNewFullClosure:function(e,t){for(var i=e.pointers[Squeak.ClosureFull_method],r=this.vm.allocateOrRecycleContext(i.methodNeedsLargeFrame()),s=e.pointers.length-Squeak.ClosureFull_firstCopiedValue,n=(r.pointers[Squeak.Context_sender]=this.vm.activeContext,r.pointers[Squeak.Context_instructionPointer]=this.vm.encodeSqueakPC(0,i),r.pointers[Squeak.Context_stackPointer]=i.methodTempCount(),r.pointers[Squeak.Context_method]=i,r.pointers[Squeak.Context_closure]=e,r.pointers[Squeak.Context_receiver]=e.pointers[Squeak.ClosureFull_receiver],Squeak.Context_tempFrameStart),a=0;a<t;a++)r.pointers[n++]=this.vm.stackValue(t-a-1);for(a=0;a<s;a++)r.pointers[n++]=e.pointers[Squeak.ClosureFull_firstCopiedValue+a];this.vm.popN(t+1),this.vm.newActiveContext(r),i.compiled||this.vm.compileIfPossible(i)}},"scheduling",{primitiveResume:function(){return this.resume(this.vm.top()),!0},primitiveSuspend:function(){var e=this.vm.top();if(e===this.activeProcess())this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.wakeHighestPriority());else{var t=e.pointers[Squeak.Proc_myList];if(t.isNil)return!1;if(this.removeProcessFromList(e,t),!this.success)return!1;e.pointers[Squeak.Proc_myList]=this.vm.nilObj,this.vm.popNandPush(1,t)}return!0},getScheduler:function(){return this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value]},activeProcess:function(){return this.getScheduler().pointers[Squeak.ProcSched_activeProcess]},resume:function(e){var t=this.activeProcess();t.pointers[Squeak.Proc_priority]<e.pointers[Squeak.Proc_priority]?(this.putToSleep(t),this.transferTo(e)):this.putToSleep(e)},putToSleep:function(e){var t=e.pointers[Squeak.Proc_priority],t=this.getScheduler().pointers[Squeak.ProcSched_processLists].pointers[t-1];this.linkProcessToList(e,t)},transferTo:function(e){var t=this.getScheduler(),i=t.pointers[Squeak.ProcSched_activeProcess];t.pointers[Squeak.ProcSched_activeProcess]=e,t.dirty=!0,i.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,i.dirty=!0,this.vm.newActiveContext(e.pointers[Squeak.Proc_suspendedContext]),e.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj,this.oldPrims||(e.pointers[Squeak.Proc_myList]=this.vm.nilObj),this.vm.reclaimableContextCount=0,this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow()),this.vm.logProcess&&console.log("\n============= Process Switch ==================\n"+this.vm.printProcess(e,!0,this.vm.logSends?"| ":"")+"===============================================")},wakeHighestPriority:function(){var e,t=this.getScheduler().pointers[Squeak.ProcSched_processLists],i=t.pointersSize()-1;do{if(i<0)throw Error("scheduler could not find a runnable process")}while(e=t.pointers[i--],this.isEmptyList(e));return this.removeFirstLinkOfList(e)},linkProcessToList:function(e,t){var i;this.isEmptyList(t)?t.pointers[Squeak.LinkedList_firstLink]=e:((i=t.pointers[Squeak.LinkedList_lastLink]).pointers[Squeak.Link_nextLink]=e,i.dirty=!0),t.pointers[Squeak.LinkedList_lastLink]=e,t.dirty=!0,e.pointers[Squeak.Proc_myList]=t,e.dirty=!0},isEmptyList:function(e){return e.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(e){var t,i=e.pointers[Squeak.LinkedList_firstLink];return i===e.pointers[Squeak.LinkedList_lastLink]?(e.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,e.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj):(t=i.pointers[Squeak.Link_nextLink],e.pointers[Squeak.LinkedList_firstLink]=t,e.dirty=!0),i.pointers[Squeak.Link_nextLink]=this.vm.nilObj,i},removeProcessFromList:function(e,t){var i=t.pointers[Squeak.LinkedList_firstLink],r=t.pointers[Squeak.LinkedList_lastLink];if(e===i){var s=e.pointers[Squeak.Link_nextLink];t.pointers[Squeak.LinkedList_firstLink]=s,e===r&&(t.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj)}else{for(var n=i;;){if(n.isNil)return void(this.oldPrims&&(this.success=!1));if((s=n.pointers[Squeak.Link_nextLink])===e)break;n=s}s=e.pointers[Squeak.Link_nextLink],n.pointers[Squeak.Link_nextLink]=s,e===r&&(t.pointers[Squeak.LinkedList_lastLink]=n)}e.pointers[Squeak.Link_nextLink]=this.vm.nilObj},registerSemaphore:function(e){var t=this.vm.top();return this.isA(t,Squeak.splOb_ClassSemaphore)?this.vm.specialObjects[e]=t:this.vm.specialObjects[e]=this.vm.nilObj,this.vm.stackValue(1)},primitiveWait:function(){var e,t=this.vm.top();return!!this.isA(t,Squeak.splOb_ClassSemaphore)&&(0<(e=t.pointers[Squeak.Semaphore_excessSignals])?t.pointers[Squeak.Semaphore_excessSignals]=e-1:(this.linkProcessToList(this.activeProcess(),t),this.transferTo(this.wakeHighestPriority())),!0)},primitiveSignal:function(){var e=this.vm.top();return!!this.isA(e,Squeak.splOb_ClassSemaphore)&&(this.synchronousSignal(e),!0)},synchronousSignal:function(e){this.isEmptyList(e)?e.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(e))},signalAtMilliseconds:function(e,t){this.isA(e,Squeak.splOb_ClassSemaphore)?(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=e,this.vm.nextWakeupTick=t):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0)},primitiveSignalAtMilliseconds:function(e){var t=this.stackInteger(0),i=this.stackNonInteger(1);return!!this.success&&(this.signalAtMilliseconds(i,t),this.vm.popN(e),!0)},primitiveSignalAtUTCMicroseconds:function(e){var t=this.stackSigned53BitInt(0),i=this.stackNonInteger(1);return!!this.success&&(t=t/1e3+Squeak.EpochUTC-this.vm.startupTime&Squeak.MillisecondClockMask,this.signalAtMilliseconds(i,t),this.vm.popN(e),!0)},signalSemaphoreWithIndex:function(e){this.semaphoresToSignal.push(e)},signalExternalSemaphores:function(){for(var e=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,t=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var i=e[this.semaphoresToSignal.shift()-1];i.sqClass==t&&this.synchronousSignal(i)}},primitiveEnterCriticalSection:function(e){var t,i,r;return!(1<e||(t=this.vm.stackValue(e),i=e?this.vm.top():this.activeProcess(),(r=t.pointers[Squeak.Mutex_owner]).isNil?(t.pointers[Squeak.Mutex_owner]=i,t.dirty=!0,this.popNandPushIfOK(e+1,this.vm.falseObj)):r===i?this.popNandPushIfOK(e+1,this.vm.trueObj):(this.popNandPushIfOK(e+1,this.vm.falseObj),this.linkProcessToList(i,t),this.transferTo(this.wakeHighestPriority())),0))},primitiveExitCriticalSection:function(e){var t,i=this.vm.top();return this.isEmptyList(i)?i.pointers[Squeak.Mutex_owner]=this.vm.nilObj:(t=this.removeFirstLinkOfList(i),i.pointers[Squeak.Mutex_owner]=t,i.dirty=!0,this.resume(t)),!0},primitiveTestAndSetOwnershipOfCriticalSection:function(e){var t,i,r;return!(1<e||(t=this.vm.stackValue(e),i=e?this.vm.top():this.activeProcess(),(r=t.pointers[Squeak.Mutex_owner]).isNil?(t.pointers[Squeak.Mutex_owner]=i,t.dirty=!0,this.popNandPushIfOK(e+1,this.vm.falseObj)):r===i?this.popNandPushIfOK(e+1,this.vm.trueObj):this.popNandPushIfOK(e+1,this.vm.nilObj),0))}},"vm functions",{primitiveGetAttribute:function(e){var t=this.stackInteger(0);if(!this.success)return!1;var i=this.display.argv,r=this.display.vmOptions,s=null;switch(t){case 0:s=i&&i[0]||this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:s=i&&i[1]||this.display.documentName;break;case 2:s=i&&i[2]||this.display.documentName;break;case 1001:s=this.vm.options.unix?"unix":Squeak.platformName;break;case 1002:s=Squeak.osVersion;break;case 1003:s=Squeak.platformSubtype;break;case 1004:s=Squeak.vmVersion+" "+Squeak.vmMakerVersion;break;case 1005:s=Squeak.windowSystem;break;case 1006:s=Squeak.vmBuild;break;case 1007:s=Squeak.vmInterpreterVersion;break;case 1009:s=Squeak.vmVersion+" Date: "+Squeak.vmDate;break;default:if(0<=t&&i&&i.length>t)s=i[t];else{if(!(t<0&&r&&r.length>-t-1))return!1;s=r[-t-1]}}return this.vm.popNandPush(e+1,this.makeStObject(s)),!0},setLowSpaceThreshold:function(){var e=this.stackInteger(0);return this.success&&(this.vm.lowSpaceThreshold=e),this.vm.stackValue(1)},primitiveVMParameter:function(e){var t=this.vm.image.isSpur?71:44;switch(e){case 0:for(var i=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],t),r=0;r<t;r++)i.pointers[r]=this.makeStObject(this.vmParameterAt(r+1));return this.popNandPushIfOK(1,i);case 1:var s=this.stackInteger(0);return s<1||t<s?!1:this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(s)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(e){switch(e){case 1:case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return this.vm.image.pgcCount;case 10:return this.vm.image.pgcMilliseconds;case 11:return this.vm.image.gcTenured;case 15:case 16:case 17:case 18:case 19:case 20:case 22:return 0;case 23:return this.vm.image.extraVMMemory;case 40:return 4;case 41:return this.vm.image.formatVersion();case 44:case 46:case 48:return 0;case 54:return this.vm.image.bytesLeft();case 65:return 0;case 67:return this.vm.image.totalMemory}return null},primitiveImageName:function(e){return 0==e?this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name))):(this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString()),Squeak.Settings.squeakImageName=this.vm.image.name,this.vm.popN(e),!0)},primitiveSnapshot:function(e){this.vm.popNandPush(1,this.vm.trueObj),this.vm.storeContextRegisters(),this.activeProcess().pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.image.fullGC("snapshot");var t=this.vm.image.writeToBuffer();return Squeak.flushAllFiles&&(Squeak.flushAllFiles(),Squeak.filePut(this.vm.image.name,t)),this.vm.popNandPush(1,this.vm.falseObj),!0},primitiveQuit:function(e){return Squeak.flushAllFiles&&Squeak.flushAllFiles(),this.display.quitFlag=!0,this.vm.breakNow("quit"),!0},primitiveExitToDebugger:function(e){return this.vm.breakNow("debugger primitive"),!0},primitiveSetGCBiasToGrow:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,e)},primitiveSetGCBiasToGrowGCLimit:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,e)}},"time",{primitiveRelinquishProcessorForMicroseconds:function(e){return this.vm.popN(e),this.vm.goIdle(),!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(e){this.vm.startupTime=Date.now()-e},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClock:function(e){var t,i,r,s=Date.now()-e.epoch;return"object"!=typeof performance?this.pos53BitIntFor(1e3*s):(t=1e3*performance.now()%1e3|0,i=e.millis,r=e.micros,(s=s<i?i:s)===i&&t<r&&s++,e.millis=s,e.micros=t,this.pos53BitIntFor(1e3*s+t))},microsecondClockUTC:function(){return this.microsecondClockUTCState||(this.microsecondClockUTCState={epoch:Squeak.EpochUTC,millis:0,micros:0}),this.microsecondClock(this.microsecondClockUTCState)},microsecondClockLocal:function(){return this.microsecondClockLocalState||(this.microsecondClockLocalState={epoch:Squeak.Epoch,millis:0,micros:0}),this.microsecondClock(this.microsecondClockLocalState)},primitiveUtcWithOffset:function(e){var t,i=new Date,r=this.pos53BitIntFor(1e3*i.getTime()),i=-60*i.getTimezoneOffset();return 0<e?((t=this.vm.stackValue(0)).pointers[0]=r,t.pointers[1]=i,this.popNandPushIfOK(e+1,t)):this.popNandPushIfOK(e+1,this.makeStArray([r,i])),!0}}),Object.subclass("Squeak.Compiler","initialization",{initialize:function(e){this.vm=e,this.comments=!!Squeak.Compiler.comments,this.specialSelectors=["+","-","<",">","<=",">=","=","~=","*","/","\\\\","@","bitShift:","//","bitAnd:","bitOr:","at:","at:put:","size","next","nextPut:","atEnd","==","class","blockCopy:","value","value:","do:","new","new:","x","y"],this.doitCounter=0,this.blockCounter=0}},"accessing",{compile:function(r,s,n){var e,a,t,i;void 0===r.compiled?r.compiled=!1:(this.singleStep=!1,this.debug=this.comments,this.debug&&!s&&(a=r.sqClass===this.vm.specialObjects[Squeak.splOb_ClassCompiledMethod],this.vm.allMethodsDo(function(e,t,i){if(a?t===r:t.pointers.includes(r))return s=e,n=i,!0})),s&&(t=s.className(),i=n.bytesAsString(),this.debug)&&((a=r.sqClass===this.vm.specialObjects[Squeak.splOb_ClassCompiledMethod])||(t="[] in "+t),e=s.allInstVarNames()),r.compiled=this.generate(r,t,i,e))},enableSingleStepping:function(r,s,n){var e,t,i;return r.compiled&&r.compiled.canSingleStep||(this.singleStep=!0,this.debug=!0,s||this.vm.allMethodsDo(function(e,t,i){if(t===r)return s=e,n=i,!0}),e=s&&s.className(),t=n&&n.bytesAsString(),i=s&&s.allInstVarNames(),r.compiled=this.generate(r,e,t,i),r.compiled.canSingleStep=!0),!0},functionNameFor:function(e,t){return void 0===e||"?"===e?this.method.sqClass===this.vm.specialObjects[Squeak.splOb_ClassCompiledMethod]?"DOIT_"+ ++this.doitCounter:"BLOCK_"+ ++this.blockCounter:(e=e.replace(/ /g,"_").replace("[]","Block"),/[^a-zA-Z0-9:_]/.test(t)?e+"__"+t.replace(/./g,function(e){return{"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[e]||"OPERATOR"})+"__":e+"_"+t.replace(/:/g,"Ë"))}},"generating",{generate:function(e,t,i,r){this.method=e,this.sista=e.methodSignFlag(),this.pc=0,this.endPC=0,this.prevPC=0,this.source=[],this.sourceLabels={},this.needsLabel={},this.sourcePos={},this.needsVar={},this.needsBreak=!1,t&&i&&this.source.push("// ",t,">>",i,"\n"),this.instVarNames=r,this.allVars=["context","stack","rcvr","inst[","temp[","lit["],this.sourcePos.context=this.source.length,this.source.push("var context = vm.activeContext;\n"),this.sourcePos.stack=this.source.length,this.source.push("var stack = context.pointers;\n"),this.sourcePos.rcvr=this.source.length,this.source.push("var rcvr = vm.receiver;\n"),this.sourcePos["inst["]=this.source.length,this.source.push("var inst = rcvr.pointers;\n"),this.sourcePos["temp["]=this.source.length,this.source.push("var temp = vm.homeContext.pointers;\n"),this.sourcePos["lit["]=this.source.length,this.source.push("var lit = vm.method.pointers;\n"),this.sourcePos["loop-start"]=this.source.length,this.source.push("while (true) switch (vm.pc) {\ncase 0:\n"),this.sista?this.generateSista(e):this.generateV3(e);r=this.functionNameFor(t,i),this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC');\n}")):(this.sourcePos["loop-end"]=this.source.length,this.source.push("default: vm.interpretOne(true); return;\n}"),this.deleteUnneededLabels()),this.deleteUnneededVariables(),e="'use strict';\nreturn function "+r+"(vm) {\n"+this.source.join("")+"}";return new Function(e)()},generateV3:function(e){for(this.done=!1;!this.done;){var t=e.bytes[this.pc++],i=0;switch(248&t){case 0:case 8:this.generatePush("inst[",15&t,"]");break;case 16:case 24:this.generatePush("temp[",6+(15&t),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(31&t),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(31&t),"].pointers[1]");break;case 96:this.generatePopInto("inst[",7&t,"]");break;case 104:this.generatePopInto("temp[",6+(7&t),"]");break;case 112:switch(t){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(t){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode "+t)}break;case 128:case 136:this.generateV3Extended(t);break;case 144:this.generateJump(1+(7&t));break;case 152:this.generateJumpIf(!1,1+(7&t));break;case 160:i=e.bytes[this.pc++],this.generateJump(256*((7&t)-4)+i);break;case 168:i=e.bytes[this.pc++],this.generateJumpIf(t<172,256*(3&t)+i);break;case 176:case 184:this.generateNumericOp(t);break;case 192:case 200:this.generateQuickPrim(t);break;case 208:case 216:this.generateSend("lit[",1+(15&t),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(15&t),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(15&t),"]",2,!1)}}},generateV3Extended:function(e){switch(e){case 128:switch((t=this.method.bytes[this.pc++])>>6){case 0:return void this.generatePush("inst[",63&t,"]");case 1:return void this.generatePush("temp[",6+(63&t),"]");case 2:return void this.generatePush("lit[",1+(63&t),"]");case 3:return void this.generatePush("lit[",1+(63&t),"].pointers[1]")}case 129:switch((t=this.method.bytes[this.pc++])>>6){case 0:return void this.generateStoreInto("inst[",63&t,"]");case 1:return void this.generateStoreInto("temp[",6+(63&t),"]");case 2:throw Error("illegal store into literal");case 3:return void this.generateStoreInto("lit[",1+(63&t),"].pointers[1]")}return;case 130:switch((t=this.method.bytes[this.pc++])>>6){case 0:return void this.generatePopInto("inst[",63&t,"]");case 1:return void this.generatePopInto("temp[",6+(63&t),"]");case 2:throw Error("illegal pop into literal");case 3:return void this.generatePopInto("lit[",1+(63&t),"].pointers[1]")}case 131:return t=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&t),"]",t>>5,!1);case 132:switch(t=this.method.bytes[this.pc++],i=this.method.bytes[this.pc++],t>>5){case 0:return void this.generateSend("lit[",1+i,"]",31&t,!1);case 1:return void this.generateSend("lit[",1+i,"]",31&t,!0);case 2:return void this.generatePush("inst[",i,"]");case 3:return void this.generatePush("lit[",1+i,"]");case 4:return void this.generatePush("lit[",1+i,"].pointers[1]");case 5:return void this.generateStoreInto("inst[",i,"]");case 6:return void this.generatePopInto("inst[",i,"]");case 7:return void this.generateStoreInto("lit[",1+i,"].pointers[1]")}case 133:return t=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&t),"]",t>>5,!0);case 134:return t=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(63&t),"]",t>>6,!1);case 135:return void this.generateInstruction("pop","vm.sp--");case 136:return this.needsVar.stack=!0,void this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");case 137:return this.needsVar.stack=!0,void this.generateInstruction("push thisContext","stack[++vm.sp] = vm.exportThisContext()");case 138:var t=this.method.bytes[this.pc++];return void this.generateClosureTemps(127&t,127<t);case 139:return t=this.method.bytes[this.pc++],i=this.method.bytes[this.pc++],void this.generateCallPrimitive(t+256*i,129);case 140:return t=this.method.bytes[this.pc++],i=this.method.bytes[this.pc++],void this.generatePush("temp[",6+i,"].pointers[",t,"]");case 141:return t=this.method.bytes[this.pc++],i=this.method.bytes[this.pc++],void this.generateStoreInto("temp[",6+i,"].pointers[",t,"]");case 142:return t=this.method.bytes[this.pc++],i=this.method.bytes[this.pc++],void this.generatePopInto("temp[",6+i,"].pointers[",t,"]");case 143:t=this.method.bytes[this.pc++];var i=this.method.bytes[this.pc++],r=this.method.bytes[this.pc++];return void this.generateClosureCopy(15&t,t>>4,i<<8|r)}},generateSista:function(){var e,t=this.method.bytes,i=0,r=0;for(this.done=!1;!this.done;){switch(e=t[this.pc++]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.generatePush("inst[",15&e,"]");break;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.generatePush("lit[",1+(15&e),"].pointers[1]");break;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:this.generatePush("lit[",1+(31&e),"]");break;case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:this.generatePush("temp[",6+(7&e),"]");break;case 72:case 73:case 74:case 75:this.generatePush("temp[",6+(3&e)+8,"]");break;case 76:this.generatePush("rcvr");break;case 77:this.generatePush("vm.trueObj");break;case 78:this.generatePush("vm.falseObj");break;case 79:this.generatePush("vm.nilObj");break;case 80:this.generatePush(0);break;case 81:this.generatePush(1);break;case 82:this.needsVar.stack=!0,this.generateInstruction("push thisContext","stack[++vm.sp] = vm.exportThisContext()");break;case 83:this.needsVar.stack=!0,this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");break;case 84:case 85:case 86:case 87:throw Error("unusedBytecode "+e);case 88:this.generateReturn("rcvr");break;case 89:this.generateReturn("vm.trueObj");break;case 90:this.generateReturn("vm.falseObj");break;case 91:this.generateReturn("vm.nilObj");break;case 92:this.generateReturn("stack[vm.sp]");break;case 93:this.generateBlockReturn("vm.nilObj");break;case 94:this.generateBlockReturn();break;case 95:break;case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:this.generateNumericOp(e);break;case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:this.generateQuickPrim(e);break;case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:case 141:case 142:case 143:this.generateSend("lit[",1+(15&e),"]",0,!1);break;case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:this.generateSend("lit[",1+(15&e),"]",1,!1);break;case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:this.generateSend("lit[",1+(15&e),"]",2,!1);break;case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:this.generateJump(1+(7&e));break;case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:this.generateJumpIf(!0,1+(7&e));break;case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:this.generateJumpIf(!1,1+(7&e));break;case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:this.generatePopInto("inst[",7&e,"]");break;case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:this.generatePopInto("temp[",6+(7&e),"]");break;case 216:this.generateInstruction("pop","vm.sp--");break;case 217:throw Error("unumplementedBytecode: 0xD9 (unconditional trap)");case 218:case 219:case 220:case 221:case 222:case 223:throw Error("unusedBytecode "+e);case 224:i=256*i+(s=t[this.pc++]);continue;case 225:r=256*r+((s=t[this.pc++])<128?s:s-256);continue;case 226:s=t[this.pc++],this.generatePush("inst[",s+256*i,"]");break;case 227:s=t[this.pc++],this.generatePush("lit[",1+s+256*i,"].pointers[1]");break;case 228:s=t[this.pc++],this.generatePush("lit[",1+s+256*i,"]");break;case 229:s=t[this.pc++],this.generatePush("temp[",6+s,"]");break;case 230:throw Error("unusedBytecode 0xE6");case 231:var s=t[this.pc++];this.generateClosureTemps(127&s,127<s);break;case 232:s=t[this.pc++],this.generatePush(s+256*r);break;case 233:s=t[this.pc++],this.generatePush("vm.image.getCharacter(",s+256*r,")");break;case 234:s=t[this.pc++],this.generateSend("lit[",1+(s>>3)+(i<<5),"]",(7&s)+(r<<3),!1);break;case 235:var n=(7&(s=t[this.pc++]))+((63&r)<<3);this.generateSend("lit[",1+((s>>3)+(i<<5)),"]",n,!(64<=r)||"directed");break;case 236:throw Error("unimplemented bytecode: 0xEC (class trap)");case 237:s=t[this.pc++],this.generateJump(s+256*r);break;case 238:s=t[this.pc++],this.generateJumpIf(!0,s+256*r);break;case 239:s=t[this.pc++],this.generateJumpIf(!1,s+256*r);break;case 240:s=t[this.pc++],this.generatePopInto("inst[",s+256*i,"]");break;case 241:s=t[this.pc++],this.generatePopInto("lit[",1+s+256*i,"].pointers[1]");break;case 242:s=t[this.pc++],this.generatePopInto("temp[",6+s,"]");break;case 243:s=t[this.pc++],this.generateStoreInto("inst[",s+256*i,"]");break;case 244:s=t[this.pc++],this.generateStoreInto("lit[",1+s+256*i,"].pointers[1]");break;case 245:s=t[this.pc++],this.generateStoreInto("temp[",6+s,"]");break;case 246:case 247:throw Error("unusedBytecode "+e);case 248:s=t[this.pc++],a=t[this.pc++],this.generateCallPrimitive(s+256*a,245);break;case 249:s=t[this.pc++],a=t[this.pc++],this.generatePushFullClosure(s+255*i,a);break;case 250:s=t[this.pc++];var a=t[this.pc++],n=(7&s)+8*(15&i);this.generateClosureCopy(n,(s>>3&7)+8*(i>>4),a+(r<<8));break;case 251:s=t[this.pc++],a=t[this.pc++],this.generatePush("temp[",6+a,"].pointers[",s,"]");break;case 252:s=t[this.pc++],a=t[this.pc++],this.generateStoreInto("temp[",6+a,"].pointers[",s,"]");break;case 253:s=t[this.pc++],a=t[this.pc++],this.generatePopInto("temp[",6+a,"].pointers[",s,"]");break;case 254:case 255:throw Error("unusedBytecode "+e);default:throw Error("illegal bytecode: "+e)}r=i=0}},generatePush:function(e,t,i,r,s){this.debug&&this.generateDebugCode("push",e,t,i,r,s),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.stack=!0,this.source.push("stack[++vm.sp] = ",e),void 0!==t&&(this.source.push(t,i),void 0!==r)&&this.source.push(r,s),this.source.push(";\n")},generateStoreInto:function(e,t,i,r,s){this.debug&&this.generateDebugCode("store into",e,t,i,r,s),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.stack=!0,this.source.push(e),void 0!==t&&(this.source.push(t,i),void 0!==r)&&this.source.push(r,s),this.source.push(" = stack[vm.sp];\n"),this.generateDirty(e,t,i)},generatePopInto:function(e,t,i,r,s){this.debug&&this.generateDebugCode("pop into",e,t,i,r,s),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.stack=!0,this.source.push(e),void 0!==t&&(this.source.push(t,i),void 0!==r)&&this.source.push(r,s),this.source.push(" = stack[vm.sp--];\n"),this.generateDirty(e,t,i)},generateReturn:function(e){this.debug&&this.generateDebugCode("return",e),this.generateLabel(),this.needsVar[e]=!0,this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",e,"); return;\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateBlockReturn:function(e){this.debug&&this.generateDebugCode("block return"),this.generateLabel(),e||(this.needsVar.stack=!0,e="stack[vm.sp--]"),this.needsVar.context=!0,this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",e,", context.pointers[0]); return;\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateJump:function(e){var t=this.pc+e;this.debug&&this.generateDebugCode("jump to "+t),this.generateLabel(),this.needsVar.context=!0,this.source.push("vm.pc = ",t,"; "),e<0&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n","}\n"),this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return;\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[t]=!0,t>this.endPC&&(this.endPC=t)},generateJumpIf:function(e,t){t=this.pc+t;this.debug&&this.generateDebugCode("jump if "+e+" to "+t),this.generateLabel(),this.needsVar.stack=!0,this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",e,"Obj) {vm.pc = ",t,"; "),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return; else "),this.source.push("continue}\n","else if (cond !== vm.",!e,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return}\n"),this.needsLabel[this.pc]=!0,this.needsLabel[t]=!0,t>this.endPC&&(this.endPC=t)},generateQuickPrim:function(e){switch(this.debug&&this.generateDebugCode("quick send #"+this.specialSelectors[16+(15&e)]),this.generateLabel(),15&e){case 0:return this.needsVar.stack=!0,this.source.push("var a, b; if ((a=stack[vm.sp-1]).sqClass === vm.specialObjects[7] && a.pointers && typeof (b=stack[vm.sp]) === 'number' && b>0 && b<=a.pointers.length) {\n","  stack[--vm.sp] = a.pointers[b-1];","} else { var c = vm.primHandler.objectAt(true,true,false); if (vm.primHandler.success) stack[--vm.sp] = c; else {\n","  vm.pc = ",this.pc,"; vm.sendSpecial(16); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }}\n"),void(this.needsLabel[this.pc]=!0);case 1:return this.needsVar.stack=!0,this.source.push("var a, b; if ((a=stack[vm.sp-2]).sqClass === vm.specialObjects[7] && a.pointers && typeof (b=stack[vm.sp-1]) === 'number' && b>0 && b<=a.pointers.length) {\n","  var c = stack[vm.sp]; stack[vm.sp-=2] = a.pointers[b-1] = c; a.dirty = true;","} else { vm.primHandler.objectAtPut(true,true,false); if (vm.primHandler.success) stack[vm.sp-=2] = c; else {\n","  vm.pc = ",this.pc,"; vm.sendSpecial(17); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }}\n"),void(this.needsLabel[this.pc]=!0);case 2:return this.needsVar.stack=!0,this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }\n"),void(this.needsLabel[this.pc]=!0);case 6:return this.needsVar.stack=!0,void this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");case 7:return this.needsVar.stack=!0,void this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");case 8:return this.needsVar.rcvr=!0,this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) ","{vm.sendSpecial(",16+(15&e),"); return}\n"),this.needsLabel[this.pc]=!0,void(this.needsLabel[this.pc+2]=!0);case 9:case 10:case 11:return this.needsVar.rcvr=!0,this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) vm.sendSpecial(",16+(15&e),"); return;\n"),void(this.needsLabel[this.pc]=!0)}this.needsVar.rcvr=!0,this.needsVar.context=!0,this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,"))"," vm.sendSpecial(",16+(15&e),");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateNumericOp:function(e){switch(this.debug&&this.generateDebugCode("quick send #"+this.specialSelectors[15&e]),this.generateLabel(),this.needsLabel[this.pc]=!0,15&e){case 0:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 1:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 2:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 3:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 4:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 5:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 6:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 7:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 8:return void this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(8); return}\n");case 9:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return}\n");case 10:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return}\n");case 11:return void this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",this.pc,"; vm.sendSpecial(11); return}\n");case 12:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return}\n");case 13:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return}\n");case 14:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(14); return}\n");case 15:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return}\n")}},generateSend:function(e,t,i,r,s){this.debug&&this.generateDebugCode(("directed"===s?"directed super send ":s?"super send ":"send ")+("lit["===e?this.method.pointers[t].bytesAsString():"...")),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.context=!0,this.source.push("vm.pc = ",this.pc),"directed"===s?this.source.push("; vm.sendSuperDirected(",e,t,i,", ",r,"); "):this.source.push("; vm.send(",e,t,i,", ",r,", ",s,"); "),this.source.push("if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateClosureTemps:function(e,t){if(this.debug&&this.generateDebugCode("closure temps"),this.generateLabel(),this.needsVar.stack=!0,this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",e,");\n"),t){for(var i=0;i<e;i++)this.source.push("array.pointers[",i,"] = stack[vm.sp - ",e-i-1,"];\n");this.source.push("stack[vm.sp -= ",e-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(e,t,i){var r=this.pc,i=r+i;if(this.debug&&this.generateDebugCode("push closure("+r+"-"+(i-1)+"): "+t+" copied, "+e+" args"),this.generateLabel(),this.needsVar.stack=!0,this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",t,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",r+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",e,";\n"),0<t){for(var s=0;s<t;s++)this.source.push("closure.pointers[",s+3,"] = stack[vm.sp - ",t-s-1,"];\n");this.source.push("stack[vm.sp -= ",t-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",i,";\n"),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return;\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[r]=!0,this.needsLabel[i]=!0,i>this.endPC&&(this.endPC=i)},generatePushFullClosure:function(e,t){this.debug&&this.generateDebugCode("push full closure "+(e+1)),this.generateLabel(),this.needsVar["lit["]=!0,this.needsVar.rcvr=!0,this.needsVar.stack=!0;var i=63&t,r=1==(t>>6&1)?"vm.nilObj":"context";if(1==(t>>7&1))throw Error("on-stack receiver not yet supported");if(this.source.push("var closure = vm.newFullClosure(",r,", ",i,", lit[",1+e,"]);\n"),this.source.push("closure.pointers[",Squeak.ClosureFull_receiver,"] = rcvr;\n"),"context"===r&&this.source.push("vm.reclaimableContextCount = 0;\n"),0<i){for(var s=0;s<i;s++)this.source.push("closure.pointers[",s+Squeak.ClosureFull_firstCopiedValue,"] = stack[vm.sp - ",i-s-1,"];\n");this.source.push("stack[vm.sp -= ",i-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n")},generateCallPrimitive:function(e,t){this.debug&&this.generateDebugCode("call primitive "+e),this.generateLabel(),this.method.bytes[this.pc]===t&&(this.needsVar.stack=!0,this.source.push("if (vm.primFailCode) {stack[vm.sp] = vm.getErrorObjectFromPrimFailCode(); vm.primFailCode = 0;}\n"))},generateDirty:function(e,t,i){switch(e){case"inst[":this.source.push("rcvr.dirty = true;\n");break;case"lit[":this.source.push(e,t,"].dirty = true;\n");break;case"temp[":"]"!==i&&this.source.push(e,t,"].dirty = true;\n");break;default:throw Error("unexpected target "+e)}},generateLabel:function(){this.prevPC&&(this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n")),this.prevPC=this.pc},generateDebugCode:function(e,t,i,r,s,n){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) {vm.pc = ",this.prevPC,"; return}\n"),this.needsLabel[this.prevPC]=!0);for(var a=[],o=this.prevPC;o<this.pc;o++)a.push((this.method.bytes[o]+256).toString(16).slice(-2).toUpperCase());if(this.source.push("// ",this.prevPC," <",a.join(" "),"> ",e),void 0!==t)switch(this.source.push(" "),t){case"vm.nilObj":this.source.push("nil");break;case"vm.trueObj":this.source.push("true");break;case"vm.falseObj":this.source.push("false");break;case"rcvr":this.source.push("self");break;case"stack[vm.sp]":this.source.push("top of stack");break;case"inst[":this.instVarNames?this.source.push(this.instVarNames[i]):this.source.push("inst var ",i);break;case"temp[":this.source.push("tmp",i-6),"]"!==r&&this.source.push("[",s,"]");break;case"lit[":var u=this.method.pointers[i];"]"===r?this.source.push(u):this.source.push(u.pointers[0].bytesAsString());break;default:this.source.push(t)}this.source.push("\n"),this.needsBreak=this.singleStep},generateInstruction:function(e,t){this.debug&&this.generateDebugCode(e),this.generateLabel(),this.source.push(t,";\n")},deleteUnneededLabels:function(){var e,t=!1;for(e in this.sourceLabels)if(this.needsLabel[e])t=!0;else for(var i=0;i<3;i++)this.source[this.sourceLabels[e]+i]="";t||(this.source[this.sourcePos["loop-start"]]="",this.source[this.sourcePos["loop-end"]]="")},deleteUnneededVariables:function(){this.needsVar.stack&&(this.needsVar.context=!0),this.needsVar["inst["]&&(this.needsVar.rcvr=!0);for(var e=0;e<this.allVars.length;e++){var t=this.allVars[e];this.needsVar[t]||(this.source[this.sourcePos[t]]="")}}}),Object.extend(Squeak,"audio",{startAudioOut:function(){return this.audioOutContext||(this.audioOutContext=new AudioContext),this.audioOutContext},stopAudioOut:function(){this.audioOutContext&&(this.audioOutContext.close(),this.audioOutContext=null)},startAudioIn:function(t,i){return this.audioInContext?(this.audioInSource.disconnect(),t(this.audioInContext,this.audioInSource)):navigator.mediaDevices?void navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.audioInContext=new AudioContext,this.audioInSource=this.audioInContext.createMediaStreamSource(e),t(this.audioInContext,this.audioInSource)}).catch(e=>i("cannot access microphone. "+e.name+": "+e.message)):i("test: audio input not supported")},stopAudioIn:function(){this.audioInSource&&(this.audioInSource.disconnect(),this.audioInSource=null,this.audioInContext.close(),this.audioInContext=null)}}),Object.extend(Squeak,"known classes",{BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4}),Object.extend(Squeak.Primitives.prototype,"display",{displayDirty:function(){}}),Object.extend(Squeak.Primitives.prototype,"display",{initDisplay:function(e){this.display=e,this.display.vm=this.vm,this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]},primitiveBeCursor:function(e){if(this.display.cursorCanvas){var t=this.loadForm(this.stackNonInteger(e),!0),i=1===e?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!t)return!1;var r=this.display.cursorCanvas,s=r.getContext("2d"),n={left:0,top:0,right:t.width,bottom:t.height},i=(r.width=t.width,r.height=t.height,1===t.depth?i?(t=this.cursorMergeMask(t,i),this.showForm(s,t,n,[0,4278190335,4294967295,4278190080])):this.showForm(s,t,n,[0,4278190080]):this.showForm(s,t,n,!0),this.display.scale||1);t.width<=16&&t.height<=16&&(i=1),r.style.width=Math.round(r.width*i)+"px",r.style.height=Math.round(r.height*i)+"px",this.display.cursorOffsetX=t.offsetX*i|0,this.display.cursorOffsetY=t.offsetY*i|0}return this.vm.popN(e),!0},cursorMergeMask:function(e,t){for(var i=new Uint32Array(16),r=0;r<16;r++){for(var s=e.bits[r],n=t.bits[r],a=2147483648,o=0,u=0;u<16;u++)o=o|(n&a)>>u|(s&a)>>u+1,a>>>=1;i[r]=o}return{obj:e.obj,bits:i,depth:2,width:16,height:16,offsetX:e.offsetX,offsetY:e.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(e){var t=this.vm.stackValue(0);return this.vm.specialObjects[Squeak.splOb_TheDisplay]=t,this.vm.popN(e),!0},primitiveReverseDisplay:function(e){if(this.reverseDisplay=!this.reverseDisplay,this.redrawDisplay(),this.display.cursorCanvas){for(var t=this.display.cursorCanvas,i=t.getContext("2d"),t=i.getImageData(0,0,t.width,t.height),r=new Uint32Array(t.data.buffer),s=0;s<r.length;s++)r[s]=16777215^r[s];i.putImageData(t,0,0)}return!0},primitiveShowDisplayRect:function(e){var t={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};return!!this.success&&(this.redrawDisplay(t),this.vm.popN(e),!0)},redrawDisplay:function(e){var t=this.theDisplay(),i={left:0,top:0,right:t.width,bottom:t.height};e&&(e.left>i.left&&(i.left=e.left),e.right<i.right&&(i.right=e.right),e.top>i.top&&(i.top=e.top),e.bottom<i.bottom)&&(i.bottom=e.bottom),i.left<i.right&&i.top<i.bottom&&this.displayUpdate(t,i)},showForm:function(e,t,i,r){if(i){var s=i.left,n=i.top,a=i.right-s,o=i.bottom-n,u=e.createImageData(a,o),l=u.data,c=(l.buffer||(l=new Uint8Array(a*o*4)),new Uint32Array(l.buffer));switch(t.depth){case 1:case 2:case 4:case 8:if(!(h=r||this.swappedColors)){for(var h=[],f=0;f<256;f++){var p=(4278255360&(O=this.indexedColors[f]))+((16711680&O)>>16)+((255&O)<<16);h[f]=p}this.swappedColors=h}this.reverseDisplay&&(h=r?r.map(function(e){return 16777215^e}):(this.reversedColors||(this.reversedColors=h.map(function(e){return 16777215^e})),this.reversedColors));for(var d=(1<<t.depth)-1,m=32-(s%t.pixPerWord+1)*t.depth,v=0;v<o;v++){for(var g=t.pitch*n+(s/t.pixPerWord|0),k=m,b=t.bits[g],y=u.width*v,S=0;S<a;S++)c[y++]=h[b>>>k&d],(k-=t.depth)<0&&(k=32-t.depth,b=t.bits[++g]);n++}break;case 16:for(m=s%2?0:16,v=0;v<o;v++){for(g=t.pitch*n+(s/2|0),k=m,b=t.bits[g],y=u.width*v,S=0;S<a;S++){var I=b>>>k;c[y++]=((31744&I)>>7)+((992&I)<<6)+((31&I)<<19)+4278190080,(k-=16)<0&&(k=16,b=t.bits[++g])}n++}break;case 32:for(var F=r?0:4278190080,v=0;v<o;v++){for(g=t.pitch*n+s,y=u.width*v,S=0;S<a;S++){var O,p=4278255360&(O=t.bits[g++])|(16711680&O)>>16|(255&O)<<16|F;c[y++]=p}n++}break;default:throw Error("depth not implemented")}u.data!==l&&u.data.set(l),e.putImageData(u,i.left,i.top)}},primitiveDeferDisplayUpdates:function(e){var t=this.stackBoolean(0);return!!this.success&&(this.deferDisplayUpdates=t,this.vm.popN(e),!0)},primitiveForceDisplayUpdate:function(e){return this.vm.breakOut(),this.vm.popN(e),!0},primitiveScanCharacters:function(e){if(6!==e)return!1;var t=this.stackInteger(0),i=this.stackNonInteger(1),r=this.stackInteger(2),s=this.stackNonInteger(3),n=this.stackInteger(4),e=this.stackInteger(5);if(!this.success)return!1;if(i.pointersSize()<258||!s.isBytes())return!1;if(!(0<e&&0<n&&n<=s.bytesSize()))return!1;var a=this.stackNonInteger(6);if(!this.success||a.pointersSize()<4)return!1;var o=this.checkSmallInt(a.pointers[0]),u=this.checkSmallInt(a.pointers[1]),l=this.checkNonInteger(a.pointers[2]),c=this.checkNonInteger(a.pointers[3]);if(!this.success||256!==c.pointersSize())return!1;for(var h=l.pointersSize()-2,u=e;u<=n;){var f=s.bytes[u-1],p=i.pointers[f];if(!p.isNil)return this.ensureSmallInt(o),!!this.success&&(a.pointers[0]=o,a.pointers[1]=u,this.popNandPushIfOK(7,p));f=this.checkSmallInt(c.pointers[f]);if(!this.success||f<0||h<f)return!1;var d=this.checkSmallInt(l.pointers[f]),f=this.checkSmallInt(l.pointers[f+1]);if(!this.success)return!1;f=o+f-d;if(r<f)return this.ensureSmallInt(o),!!this.success&&(a.pointers[0]=o,a.pointers[1]=u,p=i.pointers[257],this.popNandPushIfOK(7,p));o=f+t,u+=1}return this.ensureSmallInt(o),!!this.success&&(a.pointers[0]=o,a.pointers[1]=n,p=i.pointers[256],this.popNandPushIfOK(7,p))},primitiveScreenSize:function(e){var t=this.display,i=t.width||t.context.canvas.width,t=t.height||t.context.canvas.height;return this.popNandPushIfOK(e+1,this.makePointWithXandY(i,t))},primitiveScreenScaleFactor:function(e){var t=this.display.scale||1,t=Math.min(1/t,window.devicePixelRatio||1);return this.popNandPushIfOK(e+1,this.makeFloat(t))},primitiveSetFullScreen:function(e){var t,i=this.stackBoolean(0);return!!this.success&&(this.display.fullscreen!=i&&(this.display.fullscreenRequest?(t=this.vm.freeze(),this.display.fullscreenRequest(i,function(){t()})):(this.display.fullscreen=i,this.vm.breakOut())),this.vm.popN(e),!0)},primitiveTestDisplayDepth:function(e){return this.popNandPushBoolIfOK(e+1,0<=[1,2,4,8,16,32].indexOf(this.stackInteger(0)))},loadForm:function(e,t){if(e.isNil)return null;var i={obj:e,bits:e.pointers[Squeak.Form_bits].wordsOrBytes(),depth:e.pointers[Squeak.Form_depth],width:e.pointers[Squeak.Form_width],height:e.pointers[Squeak.Form_height]};if(t&&(t=e.pointers[Squeak.Form_offset],i.offsetX=t.pointers?t.pointers[Squeak.Point_x]:0,i.offsetY=t.pointers?t.pointers[Squeak.Point_y]:0),0!==i.width&&0!==i.height){if(!(0<i.width&&0<i.height))return null;if(i.msb=0<i.depth,i.msb||(i.depth=-i.depth),!(0<i.depth))return null;if(i.pixPerWord=32/i.depth,i.pitch=(i.width+(i.pixPerWord-1))/i.pixPerWord|0,i.bits.length!==i.pitch*i.height){if(!(i.bits.length>i.pitch*i.height))return null;this.vm.warnOnce("loadForm(): "+i.bits.length+" !== "+i.pitch+"*"+i.height+"="+i.pitch*i.height)}}return i},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(e,t){this.deferDisplayUpdates||e!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),t)},displayUpdate:function(e,t){this.showForm(this.display.context,e,t),this.display.lastTick=this.vm.lastTick,this.display.idle=0},primitiveBeep:function(e){var t,i=Squeak.startAudioOut();return i?((t=i.createOscillator()).connect(i.destination),t.type="square",t.frequency.value=880,t.start(),t.stop(i.currentTime+.05)):this.vm.warnOnce("could not initialize audio"),this.popNIfOK(e)},hostWindow_primitiveHostWindowTitle:function(e){var t;return this.display.setTitle&&(t=this.stackNonInteger(0).bytes,t=(new TextDecoder).decode(t),this.display.setTitle(t)),this.popNIfOK(e)}}),Object.extend(Squeak,"files",{fsck:function(t,i,r,s,n){if(i=i||"",s=s||{dirs:[],files:[]},n=n||{dirs:0,files:0,bytes:0,deleted:0},!r&&(r={},Object.keys(Squeak.Settings).forEach(function(e){e=e.match(/squeak-file(\.lz)?:(.*)$/);e&&(r[e[2]]=!0)}),window.SqueakDBFake&&Object.keys(SqueakDBFake.bigFiles).forEach(function(e){r[e]=!0}),"undefined"!=typeof indexedDB))return this.dbTransaction("readonly","fsck cursor",function(e){e=e.openCursor();e.onsuccess=function(e){e=e.target.result;e?(r[e.key]=e.value.byteLength,e.continue()):Squeak.fsck(t,i,r,s,n)},e.onerror=function(e){console.error("fsck failed")}});var e,a=Squeak.dirList(i);for(e in a){var o=i+"/"+e;a[e][3]?(n.dirs++,"squeak:"+o in Squeak.Settings?Squeak.fsck(null,o,r,s,n):s.dirs.push(o)):(n.files++,o in r?(r[o]=null,n.bytes+=a[e][4]):s.files.push(o))}if(""===i){console.log("squeak fsck: "+n.dirs+" directories, "+n.files+" files, "+(n.bytes/1e6).toFixed(1)+" MBytes");var u=[];for(o in r)null!==(c=r[o])&&u.push({path:o,size:c});for(var l=0;l<u.length;l++){var o=Squeak.splitFilePath(u[l].path),c=u[l].size,h=(console.log("squeak fsck: restoring "+o.fullname+" ("+c+" bytes)"),Squeak.dirCreate(o.dirname,!0,"force"),Squeak.dirList(o.dirname)),f=Squeak.totalSeconds(),f=[o.basename,f,0,!1,c];h[o.basename]=f,Squeak.Settings["squeak:"+o.dirname]=JSON.stringify(h)}for(l=0;l<s.dirs.length;l++){i=s.dirs[l];Squeak.Settings["squeak:"+i]||(console.log("squeak fsck: cleaning up directory "+i),Squeak.dirDelete(i),n.dirs--,n.deleted++)}for(l=0;l<s.files.length;l++)(o=s.files[l])in r||Squeak.Settings["squeak:"+o]||(console.log("squeak fsck: cleaning up file entry "+o),Squeak.fileDelete(o),n.files--,n.deleted++);t&&t(n)}},dbTransaction:function(i,r,s,n){function t(){s(Squeak.dbFake()),n&&n()}if("undefined"==typeof indexedDB)return t();function a(){var e=SqueakDB.transaction("files",i),t=e.objectStore("files");e.oncomplete=function(e){n&&n()},e.onerror=function(e){console.error("Transaction error during "+r,e)},e.onabort=function(e){console.error("Transaction error: aborting "+r,e),s(Squeak.dbFake()),n&&n()},s(t)}if(window.SqueakDB)return a();var e;try{e=indexedDB.open("squeak")}catch(e){}if(!e)return t();e.onsuccess=function(e){Squeak.debugFiles&&console.log("Opened files database."),window.SqueakDB=this.result,SqueakDB.onversionchange=function(e){delete window.SqueakDB,this.close()},SqueakDB.onerror=function(e){console.error("Error accessing database",e)},a()},e.onupgradeneeded=function(e){Squeak.debugFiles&&console.log("Creating files database"),e.target.result.createObjectStore("files")},e.onerror=function(e){console.error("Error opening files database",e),console.warn("Falling back to local storage"),t()},e.onblocked=function(e){console.log("Database upgrade needed, but was blocked."),console.warn("Falling back to local storage"),t()}},dbFake:function(){return"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1e5,get:function(e){var t=SqueakDBFake.bigFiles[e];if(!t){var i,r=Squeak.Settings["squeak-file:"+e];if(r||(i=Squeak.Settings["squeak-file.lz:"+e])&&("object"==typeof LZString?r=LZString.decompressFromUTF16(i):console.error("LZString not loaded: cannot decompress "+e)),r){for(var s=new Uint8Array(r.length),n=0;n<s.length;n++)s[n]=255&r.charCodeAt(n);t=s.buffer}}var a={result:t};return setTimeout(function(){a.onsuccess&&a.onsuccess({target:a})},0),a},put:function(e,t){e.byteLength>SqueakDBFake.bigFileThreshold?(SqueakDBFake.bigFiles[t]||console.log("File "+t+" ("+e.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[t]=e):(e=Squeak.bytesAsString(new Uint8Array(e)),"object"==typeof LZString?(i=LZString.compressToUTF16(e),Squeak.Settings["squeak-file.lz:"+t]=i,delete Squeak.Settings["squeak-file:"+t]):Squeak.Settings["squeak-file:"+t]=e);var i,r={};return setTimeout(function(){r.onsuccess&&r.onsuccess()},0),r},delete:function(e){delete Squeak.Settings["squeak-file:"+e],delete Squeak.Settings["squeak-file.lz:"+e],delete SqueakDBFake.bigFiles[e];var t={};return setTimeout(function(){t.onsuccess&&t.onsuccess()},0),t},openCursor:function(){var e={};return setTimeout(function(){e.onsuccess&&e.onsuccess({target:e})},0),e}}),SqueakDBFake},fileGet:function(e,t,i){i=i||function(e){console.log(e)};var r,s=this.splitFilePath(e);return s.basename?(Squeak.debugFiles&&(console.log("Reading "+s.fullname),r=t,t=function(e){console.log("Read "+e.byteLength+" bytes from "+s.fullname),r(e)}),window.SqueakDBFake&&SqueakDBFake.bigFiles[s.fullname]?t(SqueakDBFake.bigFiles[s.fullname]):void this.dbTransaction("readonly","get "+e,function(e){e=e.get(s.fullname);e.onerror=function(e){i(e)},e.onsuccess=function(e){if(void 0!==this.result)return t(this.result);Squeak.fetchTemplateFile(s.fullname,function(e){t(e)},function(){if("undefined"==typeof indexedDB)return i("file not found: "+s.fullname);var e=Squeak.dbFake().get(s.fullname);e.onerror=function(e){i("file not found: "+s.fullname)},e.onsuccess=function(e){t(this.result)}})}})):i("Invalid path: "+e)},filePut:function(e,t,i){var r=this.splitFilePath(e);if(!r.basename)return null;var s=this.dirList(r.dirname);if(!s)return null;var n=s[r.basename],a=this.totalSeconds();if(n){if(n[3])return null}else n=[r.basename,a,0,!1,0],s[r.basename]=n;return Squeak.debugFiles&&(console.log("Writing "+r.fullname+" ("+t.byteLength+" bytes)"),0<t.byteLength)&&e.endsWith(".log")&&console.log((new TextDecoder).decode(t).replace(/\r/g,"\n")),n[2]=a,n[4]=t.byteLength||t.length||0,Squeak.Settings["squeak:"+r.dirname]=JSON.stringify(s),this.dbTransaction("readwrite","put "+e,function(e){e.put(t,r.fullname)},function(){i&&i()}),n},fileDelete:function(e,t){var i,r,s=this.splitFilePath(e);return!!s.basename&&!!(i=this.dirList(s.dirname))&&!(!(r=i[s.basename])||r[3]||(delete i[s.basename],Squeak.Settings["squeak:"+s.dirname]=JSON.stringify(i),Squeak.debugFiles&&console.log("Deleting "+s.fullname),t||this.dbTransaction("readwrite","delete "+e,function(e){e.delete(s.fullname)}),0))},fileRename:function(e,t){var i,r,s,n=this.splitFilePath(e);return!(!n.basename||!(i=this.splitFilePath(t)).basename||!(e=this.dirList(n.dirname))||!(t=e[n.basename])||t[3]||!(s=(r=n.dirname==i.dirname)?e:this.dirList(i.dirname))||s[i.basename]||(Squeak.debugFiles&&console.log("Renaming "+n.fullname+" to "+i.fullname),delete e[n.basename],t[0]=i.basename,s[i.basename]=t,Squeak.Settings["squeak:"+i.dirname]=JSON.stringify(s),r||(Squeak.Settings["squeak:"+n.dirname]=JSON.stringify(e)),this.fileGet(n.fullname,function(t){this.dbTransaction("readwrite","rename "+n.fullname+" to "+i.fullname,function(e){e.delete(n.fullname),e.put(t,i.fullname)})}.bind(this),function(e){console.log("File rename failed: "+e)}.bind(this)),0))},fileExists:function(e){var t,e=this.splitFilePath(e);return!!e.basename&&!!(t=this.dirList(e.dirname))&&!(!(t=t[e.basename])||t[3])},dirCreate:function(e,t,i){e=this.splitFilePath(e);if(!e.basename)return!1;t&&!Squeak.Settings["squeak:"+e.dirname]&&Squeak.dirCreate(e.dirname,!0);t=this.dirList(e.dirname);if(!t)return!1;var r=t[e.basename];if(r){if(!r[3]){if(!i)return!1;r[3]=!0,Squeak.Settings["squeak:"+e.dirname]=JSON.stringify(t)}if(Squeak.Settings["squeak:"+e.fullname])return!0}Squeak.debugFiles&&console.log("Creating directory "+e.fullname);i=this.totalSeconds(),r=[e.basename,i,i,!0,0];return t[e.basename]=r,Squeak.Settings["squeak:"+e.fullname]=JSON.stringify({}),Squeak.Settings["squeak:"+e.dirname]=JSON.stringify(t),!0},dirDelete:function(e){e=this.splitFilePath(e);if(!e.basename)return!1;var t=this.dirList(e.dirname);if(!t)return!1;if(!t[e.basename])return!1;var i=this.dirList(e.fullname);if(i)for(var r in i)return!1;return Squeak.debugFiles&&console.log("Deleting directory "+e.fullname),delete t[e.basename],Squeak.Settings["squeak:"+e.dirname]=JSON.stringify(t),delete Squeak.Settings["squeak:"+e.fullname],!0},dirList:function(e,t){var i,e=this.splitFilePath(e),r=Squeak.Settings["squeak:"+e.fullname],t=t&&Squeak.Settings["squeak-template:"+e.fullname];function s(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[(i=t[i])[0]]=i)}return r||t?(i={},t&&s(i,JSON.parse(t).entries),r&&s(i,JSON.parse(r)),i):"/"==e.fullname?{}:null},splitFilePath:function(e){var t=(e=(e="/"!==e[0]?"/"+e:e).replace(/\/\//g,"/")).match(/(.*)\/(.*)/);return{fullname:e,dirname:t[1]||"/",basename:t[2]||null}},splitUrl:function(e,t){var i=e.match(/(.*\/)?(.*)/),r=i[1]||"",i=i[2]||"";return r.match(/^[a-z]+:\/\//)||(t&&!t.match(/\/$/)&&(t+="/"),e=(r=(t||"")+r)+i),{full:e,uptoslash:r,filename:i}},flushFile:function(e){var t;e.modified&&((t=e.contents.buffer).byteLength!==e.size&&(t=new ArrayBuffer(e.size),new Uint8Array(t).set(e.contents.subarray(0,e.size))),Squeak.filePut(e.name,t),e.modified=!1)},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var e in SqueakFiles)this.flushFile(SqueakFiles[e])},closeAllFiles:function(){Squeak.flushAllFiles(),delete window.SqueakFiles},fetchTemplateDir:function(n,a){function o(e,t){var i,r=JSON.parse(Squeak.Settings["squeak-template:"+e]);for(i in r.entries){var s=r.entries[i];s[3]&&Squeak.fetchTemplateDir(e+"/"+s[0],t+"/"+s[0])}}var t,u;n=Squeak.splitFilePath(n).fullname,Squeak.Settings["squeak-template:"+n]?o(n,a):(t=a+"/sqindex.json",(u=new XMLHttpRequest).open("GET",t,!0),u.onload=function(e){if(200==u.status){console.log("adding template dir "+n),!function e(t){var i,r=Squeak.splitFilePath(t);"/"!==r.dirname&&e(r.dirname),(t=JSON.parse(Squeak.Settings["squeak-template:"+r.dirname]||'{"entries": {}}')).entries[r.basename]||(i=Squeak.totalSeconds(),t.entries[r.basename]=[r.basename,i,i,!0,0],Squeak.Settings["squeak-template:"+r.dirname]=JSON.stringify(t))}(n);var t,i=JSON.parse(u.response),r={url:a,entries:{}};for(t in i){var s=i[t];r.entries[s[0]]=s}Squeak.Settings["squeak-template:"+n]=JSON.stringify(r),o(n,a)}else u.onerror(u.statusText)},u.onerror=function(e){console.log("cannot load template index "+t)},u.send())},fetchTemplateFile:function(t,i,r){t=Squeak.splitFilePath(t);var e=Squeak.Settings["squeak-template:"+t.dirname];if(!e)return r();var s=JSON.parse(e).url;if(!s)return r();s+="/"+t.basename;e=new XMLHttpRequest;e.open("get",s,!0),e.responseType="arraybuffer",e.timeout=3e4,e.onreadystatechange=function(){var e;this.readyState==this.DONE&&(200==this.status?(e=this.response,console.log("Got "+e.byteLength+" bytes from "+s),Squeak.dirCreate(t.dirname,!0),Squeak.filePut(t.fullname,e),i(e)):(console.error("Download failed ("+this.status+") "+s),r()))},console.log("Fetching "+s),e.send()}}),Object.extend(Squeak,"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4,EventTypeWindow:5,EventTypeComplex:6,EventTypeMouseWheel:7,WindowEventMetricChange:1,WindowEventClose:2,WindowEventIconise:3,WindowEventActivated:4,WindowEventPaint:5,WindowEventScreenChange:6,EventTouchDown:1,EventTouchUp:2,EventTouchMoved:3,EventTouchStationary:4,EventTouchCancelled:5}),Object.extend(Squeak.Primitives.prototype,"input",{primitiveClipboardText:function(e){if(0===e){var t=null;if(t=this.display.readFromSystemClipboard?this.display.readFromSystemClipboard():t){var i=this.vm.freeze();t.then(()=>this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))).catch(()=>this.vm.popNandPush(1,this.vm.nilObj)).finally(i)}else{if("string"!=typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}}else 1===e&&((t=this.vm.top()).bytes&&(this.display.clipboardString=t.bytesAsString(),this.display.clipboardStringChanged=!0,this.display.writeToSystemClipboard)&&this.display.writeToSystemClipboard(),this.vm.pop());return!0},primitiveKeyboardNext:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(e){var t=this.display.keys.length;return this.popNandPushIfOK(e+1,t?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.buttons)),this.vm.breakOut(),20<this.display.idle++&&this.vm.goIdle(),!0},primitiveMousePoint:function(e){var t=this.ensureSmallInt(this.display.mouseX),i=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(e+1,this.makePointWithXandY(t,i))},primitiveInputSemaphore:function(e){var t=this.stackInteger(0);return!!this.success&&(this.inputEventSemaIndex=t,this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this),this.popNIfOK(e))},primitiveInputWord:function(e){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(e){this.display.idle++;var t=this.stackNonInteger(0);return!!this.display.getNextEvent&&(this.display.getNextEvent(t.pointers,this.vm.startupTime),this.popNIfOK(e))}}),Object.extend(Squeak.Primitives.prototype,"initialization",{initPlugins:function(){Object.extend(this.builtinModules,{JavaScriptPlugin:this.findPluginFunctions("js_"),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SqueakFFIPrims:this.findPluginFunctions("ffi_","",!0),HostWindowPlugin:this.findPluginFunctions("hostWindow_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0),primitiveGetUntrustedUserDirectory:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveGetUntrustedUserDirectory","/SqueakJS")},LocalePlugin:{primitiveTimezoneOffset:this.fakePrimitive.bind(this,"LocalePlugin.primitiveTimezoneOffset",0)}}),Object.extend(this.patchModules,{ScratchPlugin:this.findPluginFunctions("scratch_")})},findPluginFunctions:function(e,t,i){t=t||"(initialise|shutdown|prim)";var r,s,n={},a=new RegExp("^"+e+t,"i");for(r in this)a.test(r)&&"function"==typeof this[r]&&(s=r,n[s=e?r[e.length].toLowerCase()+r.slice(e.length+1):s]=i?r:this[r].bind(this));return n}}),Object.extend(Squeak,"known classes",{ExtLibFunc_handle:0,ExtLibFunc_flags:1,ExtLibFunc_argTypes:2,ExtLibFunc_name:3,ExtLibFunc_module:4,ExtLibFunc_errorCodeName:5},"FFI error codes",{FFINoCalloutAvailable:-1,FFIErrorGenericError:0,FFIErrorNotFunction:1,FFIErrorBadArgs:2,FFIErrorBadArg:3,FFIErrorIntAsPointer:4,FFIErrorBadAtomicType:5,FFIErrorCoercionFailed:6,FFIErrorWrongType:7,FFIErrorStructSize:8,FFIErrorCallType:9,FFIErrorBadReturn:10,FFIErrorBadAddress:11,FFIErrorNoModule:12,FFIErrorAddressNotFound:13,FFIErrorAttemptToPassVoid:14,FFIErrorModuleNotFound:15,FFIErrorBadExternalLibrary:16,FFIErrorBadExternalFunction:17,FFIErrorInvalidPointer:18,FFIErrorCallFrameTooBig:19},"FFI types",{FFITypeVoid:0,FFITypeBool:1,FFITypeUnsignedInt8:2,FFITypeSignedInt8:3,FFITypeUnsignedInt16:4,FFITypeSignedInt16:5,FFITypeUnsignedInt32:6,FFITypeSignedInt32:7,FFITypeUnsignedInt64:8,FFITypeSignedInt64:9,FFITypeUnsignedChar8:10,FFITypeSignedChar8:11,FFITypeSingleFloat:12,FFITypeDoubleFloat:13,FFITypeUnsignedChar16:14,FFITypeUnsignedChar32:15,FFIFlagAtomic:262144,FFIFlagPointer:131072,FFIFlagStructure:65536,FFIFlagAtomicPointer:393216,FFIFlagMask:458752,FFIStructSizeMask:65535,FFIAtomicTypeMask:251658240,FFIAtomicTypeShift:24}),Object.extend(Squeak.Primitives.prototype,"FFI",{ffi_lastError:0,ffiModules:{},ffiDoCallout:function(e,t,i){this.ffi_lastError=Squeak.FFIErrorGenericError;var r=t.pointers[Squeak.ExtLibFunc_module].bytesAsString(),s=t.pointers[Squeak.ExtLibFunc_name].bytesAsString(),r=r||"libc",n=this.ffiModules[r];if(void 0===n){if(!Squeak.externalModules[r]){var a=["","lib"],o=["",".so",".so.9",".9",".so.8",".8",".so.7",".7",".so.6",".6",".so.5",".5",".so.4",".4",".so.3",".3",".so.2",".2",".so.1",".1"];e:for(var u=0;u<a.length;u++)for(var l=a[u],c=0;c<o.length;c++){var h=o[c];if(Squeak.externalModules[l+r+h]){n=l+r+h;break e}if(l&&r.startsWith(l)&&Squeak.externalModules[r.slice(l.length)+h]){n=r.slice(l.length)+h;break e}if(h&&r.endsWith(h)&&Squeak.externalModules[l+r.slice(0,-h.length)]){n=l+r.slice(0,-h.length);break e}}n&&console.log("FFI: found library "+r+" as module "+n)}this.ffiModules[r]=n=n||r}var f=this.loadedModules[n];if(void 0!==f||(f=this.loadModule(n),this.loadedModules[n]=f)||this.vm.warnOnce("FFI: library not found: "+r),!f)return this.ffi_lastError=Squeak.FFIErrorModuleNotFound,!1;for(var p,d=t.pointers[Squeak.ExtLibFunc_argTypes].pointers,m=[],v=0;v<i.length;v++)m.push(this.ffiArgFromSt(i[v],d[v+1]));if(s in f)p=f[s].apply(f,m);else if(this.vm.warnOnce("FFI: function not found: "+r+"::"+s)&&console.warn(m),void 0===(p=f.ffiFunctionNotFoundHandler?f.ffiFunctionNotFoundHandler(s,m):p))return this.ffi_lastError=Squeak.FFIErrorAddressNotFound,!1;t=this.ffiResultToSt(p,d[0]);return this.popNandPushIfOK(e+1,t)},ffiArgFromSt:function(e,t){var i,r,s=t.pointers[0].words[0];switch(s&Squeak.FFIFlagMask){case Squeak.FFIFlagAtomic:switch(i=(s&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeVoid:return null;case Squeak.FFITypeBool:if(e.isTrue)return!0;if(e.isFalse)return!1;if("number"==typeof e)return!!e;if(e.isFloat)return!!e.float;throw Error("FFI: expected bool, got "+e);case Squeak.FFITypeUnsignedInt8:case Squeak.FFITypeSignedInt8:case Squeak.FFITypeUnsignedInt16:case Squeak.FFITypeSignedInt16:case Squeak.FFITypeUnsignedInt32:case Squeak.FFITypeSignedInt32:case Squeak.FFITypeUnsignedInt64:case Squeak.FFITypeSignedInt64:case Squeak.FFITypeUnsignedChar8:case Squeak.FFITypeSignedChar8:case Squeak.FFITypeUnsignedChar16:case Squeak.FFITypeUnsignedChar32:if("number"==typeof e)return e;throw Error("FFI: expected integer, got "+e);case Squeak.FFITypeSingleFloat:case Squeak.FFITypeDoubleFloat:if("number"==typeof e)return e;if(e.isFloat)return e.float;throw Error("FFI: expected float, got "+e);default:throw Error("FFI: unimplemented atomic arg type: "+i)}case Squeak.FFIFlagAtomicPointer:switch(i=(s&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeUnsignedChar8:case Squeak.FFITypeUnsignedInt8:if(e.bytes)return e.bytes;if(e.words)return e.wordsAsUint8Array();if(this.interpreterProxy.isWordsOrBytes(e))return new Uint8Array(0);if(e.pointers&&e.pointers[0].jsData){if((r=e.pointers[0].jsData)instanceof Uint8Array)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r)}throw Error("FFI: expected bytes, got "+e);case Squeak.FFITypeUnsignedInt32:if(e.words)return e.words;if(this.interpreterProxy.isWords(e))return new Uint32Array(0);if(e.pointers&&e.pointers[0].jsData){if((r=e.pointers[0].jsData)instanceof Uint32Array)return r;if(r instanceof ArrayBuffer)return new Uint32Array(r)}throw Error("FFI: expected words, got "+e);case Squeak.FFITypeSignedInt32:if(e.words)return e.wordsAsInt32Array();if(this.interpreterProxy.isWords(e))return new Int32Array(0);if(e.pointers&&e.pointers[0].jsData){if((r=e.pointers[0].jsData)instanceof Int32Array)return r;if(r instanceof ArrayBuffer)return new Int32Array(r)}throw Error("FFI: expected words, got "+e);case Squeak.FFITypeSingleFloat:if(e.words)return e.wordsAsFloat32Array();if(e.isFloat)return new Float32Array([e.float]);if(this.interpreterProxy.isWords(e))return new Float32Array(0);if(e.pointers&&e.pointers[0].jsData){if((r=e.pointers[0].jsData)instanceof Float32Array)return r;if(r instanceof ArrayBuffer)return new Float32Array(r)}throw Error("FFI: expected floats, got "+e);case Squeak.FFITypeDoubleFloat:if(e.words)return e.wordsAsFloat64Array();if(e.isFloat)return new Float64Array([e.float]);if(this.interpreterProxy.isWords(e))return new Float64Array(0);if(e.pointers&&e.pointers[0].jsData){if((r=e.pointers[0].jsData)instanceof Float64Array)return r;if(r instanceof ArrayBuffer)return new Float64Array(r)}throw Error("FFI: expected floats, got "+e);case Squeak.FFITypeVoid:if(e.words)return e.words.buffer;if(e.bytes)return e.bytes.buffer;if(e.isNil||this.interpreterProxy.isWordsOrBytes(e))return new ArrayBuffer(0);if(e.pointers&&e.pointers[0].jsData)if((r=e.pointers[0].jsData)instanceof ArrayBuffer)return r;throw Error("FFI: expected words or bytes, got "+e);default:throw Error("FFI: unimplemented atomic array arg type: "+i)}default:throw Error("FFI: unimplemented arg type flags: "+s)}},ffiResultToSt:function(e,t){var i,r=t.pointers[0].words[0];switch(r&Squeak.FFIFlagMask){case Squeak.FFIFlagAtomic:switch(i=(r&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeVoid:return this.vm.nilObj;case Squeak.FFITypeBool:return e?this.vm.trueObj:this.vm.falseObj;case Squeak.FFITypeUnsignedInt8:case Squeak.FFITypeSignedInt8:case Squeak.FFITypeUnsignedInt16:case Squeak.FFITypeSignedInt16:case Squeak.FFITypeUnsignedInt32:case Squeak.FFITypeSignedInt32:case Squeak.FFITypeUnsignedInt64:case Squeak.FFITypeSignedInt64:case Squeak.FFITypeUnsignedChar8:case Squeak.FFITypeSignedChar8:case Squeak.FFITypeUnsignedChar16:case Squeak.FFITypeUnsignedChar32:case Squeak.FFITypeSingleFloat:case Squeak.FFITypeDoubleFloat:if("number"!=typeof e)throw Error("FFI: expected number, got "+e);return this.makeStObject(e);default:throw Error("FFI: unimplemented atomic return type: "+i)}case Squeak.FFIFlagAtomicPointer:if(!e)return this.vm.nilObj;switch(i=(r&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeSignedChar8:case Squeak.FFITypeUnsignedChar8:return"string"==typeof e?this.makeStString(e):this.makeStStringFromBytes(e,!0);default:return this.ffiMakeStExternalData(e,t)}default:throw Error("FFI: unimplemented return type flags: "+r)}},ffiNextExtAddr:0,ffiMakeStExternalAddress:function(){var e=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassExternalAddress],4);return new Uint32Array(e.bytes.buffer)[0]=++this.ffiNextExtAddr,e},ffiMakeStExternalData:function(e,t){var i=this.ffiMakeStExternalAddress(),e=(i.jsData=e,this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassExternalData],0));return e.pointers[0]=i,e.pointers[1]=t,e},ffiDataFromStack:function(e){e=this.stackNonInteger(e);return void 0!==e.jsData?e.jsData:e.bytes||e.words||(this.vm.warnOnce("FFI: expected ExternalAddress with jsData, got "+e),void(this.success=!1))},ffi_primitiveFFIAllocate:function(e){var t,i=this.stackInteger(0);return!!this.success&&((t=this.ffiMakeStExternalAddress()).jsData=new ArrayBuffer(i),this.popNandPushIfOK(e+1,t))},ffi_primitiveFFIFree:function(e){var t=this.stackNonInteger(0);return!!this.success&&(void 0===t.jsData?(this.vm.warnOnce("primitiveFFIFree: expected ExternalAddress with jsData, got "+t),!1):(delete t.jsData,!0))},primitiveCalloutToFFI:function(e,t){t=t.pointers[1];if(!this.isKindOf(t,Squeak.splOb_ClassExternalFunction))return!1;for(var i=[],r=e-1;0<=r;r--)i.push(this.vm.stackValue(r));return this.ffiDoCallout(e,t,i)},ffi_primitiveCalloutWithArgs:function(e){var t=this.stackNonInteger(1),i=this.stackNonInteger(0);return!!this.isKindOf(t,Squeak.splOb_ClassExternalFunction)&&this.ffiDoCallout(e,t,i.pointers)},ffi_primitiveFFIGetLastError:function(e){return this.popNandPushIfOK(e+1,this.ffi_lastError)},ffi_primitiveFFIIntegerAt:function(e){var t,i=this.ffiDataFromStack(3),r=this.stackInteger(2),s=this.stackInteger(1),n=this.stackBoolean(0);if(!this.success)return!1;if(--r<0||s<1||8<s||0!=(s&s-1))return!1;if(1!==s||n){if(4!==s||n)return this.vm.warnOnce("FFI: unimplemented integer type size: "+s+" signed: "+n),!1;if(i instanceof Uint32Array)t=i[r]||0;else{if(!(i instanceof Uint8Array))return this.vm.warnOnce("FFI: expected Uint32Array, got "+typeof i),!1;t=new DataView(i.buffer).getUint32(i.byteOffset+r,!0)||0}}else if("string"==typeof i)t=i.charCodeAt(r)||0;else{if(!(i instanceof Uint8Array))return this.vm.warnOnce("FFI: expected string or Uint8Array, got "+typeof i),!1;t=i[r]||0}return this.popNandPushIfOK(e+1,t)},ffi_primitiveFFIDoubleAtPut:function(e){var t=this.ffiDataFromStack(2),i=this.stackInteger(1),r=this.vm.stackValue(0),s=r.isFloat?r.float:r;return!(!this.success||"number"!=typeof s)&&(7&--i?new DataView(t).setFloat64(i,s,!0):new Float64Array(t)[i/8]=s,this.popNandPushIfOK(e+1,r))}}),Object.extend(Squeak.Primitives.prototype,"JavaScriptPlugin",{js_primitiveDoUnderstand:function(e){var t=this.stackNonInteger(1),i=this.js_objectOrGlobal(t),r=this.stackNonInteger(0).pointers,s=r[0].bytesAsString(),r=r[1].pointers||[],n=!("jsObject"in t),a=null;try{var o,u=s.match(/([^:]*)/)[0];if(n||"new"!==u){if(!(u in i))return this.js_setError("Property not found: "+u);var l=i[u];if("function"==typeof l&&(!n||0<r.length))a=l.apply(i,this.js_fromStArray(r));else if(0==r.length)a=l;else{if(1!=r.length)return this.js_setError("Property "+u+" is not a function");i[u]=this.js_fromStObject(r[0])}}else a=new(0===r.length?i:(o=[null].concat(this.js_fromStArray(r)),Function.prototype.bind.apply(i,o)))}catch(e){return this.js_setError(e)}s=this.makeStObject(a,t.sqClass);return this.popNandPushIfOK(e+1,s)},js_primitiveAsString:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(String(t)))},js_primitiveTypeof:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(typeof t))},js_primitiveAt:function(e){var t=this.stackNonInteger(1),i=this.vm.stackValue(0);try{var r=this.js_objectOrGlobal(t)[this.js_fromStObject(i)],s=this.makeStObject(r,t.sqClass)}catch(e){return this.js_setError(e)}return this.popNandPushIfOK(e+1,s)},js_primitiveAtPut:function(e){var t=this.stackNonInteger(2),i=this.vm.stackValue(1),r=this.vm.stackValue(0);try{var s=this.js_objectOrGlobal(t),n=this.js_fromStObject(i),a=this.js_fromStObject(r);s[n]=a}catch(e){return this.js_setError(e)}return this.popNandPushIfOK(e+1,r)},js_primitiveSqueakAsJSObject:function(e){var t=this.stackNonInteger(1),i=this.vm.stackValue(0);return this.success&&(t.jsObject=i),this.popNIfOK(e)},js_primitiveInitCallbacks:function(e){return this.js_callbackSema=this.stackInteger(0),this.js_activeCallback=null,this.popNIfOK(e)},js_primitiveGetActiveCallbackBlock:function(e){var t=this.js_activeCallback;return t?this.popNandPushIfOK(e+1,t.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(e){var t=this.stackNonInteger(e),i=this.js_activeCallback;if(!i)return this.js_setError("No active callback");try{var r=this.makeStArray(i.args,t);return this.popNandPushIfOK(e+1,r)}catch(e){return this.js_setError(e)}},js_primitiveReturnFromCallback:function(e){return 1===e&&(this.js_activeCallback?(this.js_activeCallback.result=this.vm.pop(),this.vm.breakOut(),!0):this.js_setError("No active callback"))},js_primitiveGetError:function(e){var t;return null!=this.js_error&&((t=this.js_error)instanceof Error&&(t=t.message),t=this.makeStString(""+t),this.js_error=null,this.popNandPushIfOK(e+1,t))},js_primitiveGetErrorObject:function(e){var t;return null!=this.js_error&&(t=this.stackNonInteger(e),t=this.makeStObject(this.js_error,t.sqClass),this.js_error=null,this.popNandPushIfOK(e+1,t))},js_setError:function(e){return this.js_error=e,!1},js_fromStObject:function(e){if("number"==typeof e)return e;if(e.jsObject)return e.jsObject;if(e.isFloat)return e.float;if(e.isNil)return null;if(e.isTrue)return!0;if(e.isFalse)return!1;if(e.bytes||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return e.bytesAsString();if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(e.pointers||[],!0);if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(e);throw Error("asJSArgument needed for "+e)},js_fromStArray:function(e,t){if(0<e.length&&t&&e.every(e=>this.isAssociation(e)))return this.js_fromStDict(e);for(var i=[],r=0;r<e.length;r++)i.push(this.js_fromStObject(e[r]));return i},js_fromStDict:function(e){for(var t={},i=0;i<e.length;i++){var r=e[i].pointers;if(!r||2!==r.length)throw Error(r+" is not an Association");var s=this.js_fromStObject(r[0]),r=this.js_fromStObject(r[1]);t[s]=r}return t},js_fromStBlock:function(r){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var t=r.pointers[Squeak.BlockContext_argumentCount],s=("number"!=typeof t&&(t=r.pointers[Squeak.Closure_numArgs]),this);return function(){for(var i=[],e=0;e<t;e++)i.push(arguments[e]);return new Promise(function(e,t){self.setTimeout(function(){s.js_executeCallbackAsync(r,i,e,t)},0)})}},js_executeCallbackAsync:function(e,t,i,r){var s=this;this.js_activeCallback||this.vm.frozen?self.setTimeout(function(){s.js_executeCallbackAsync(e,t,i,r)},0):this.js_executeCallback(e,t,i,r)},js_executeCallback:function(t,e,i,r){if(this.js_activeCallback)return console.error("Callback: already active");this.js_activeCallback={block:t,args:e,result:null},this.signalSemaphoreWithIndex(this.js_callbackSema),this.vm.forceInterruptCheck();for(var s=Date.now()+500;Date.now()<s&&!this.js_activeCallback.result;)this.vm.interpret();t=this.js_activeCallback.result;if(this.js_activeCallback=null,t)try{i(this.js_fromStObject(t))}catch(e){i(t.toString())}else r(Error("SqueakJS timeout"))},js_objectOrGlobal:function(e){return"jsObject"in e?e.jsObject:self}}),Object.extend(Squeak.Primitives.prototype,"Obsolete",{primitiveFloatArrayAt:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",e)},primitiveFloatArrayMulFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",e)},primitiveFloatArrayAddScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",e)},primitiveFloatArrayDivFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",e)},primitiveFloatArrayDivScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",e)},primitiveFloatArrayHash:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",e)},primitiveFloatArrayAtPut:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",e)},primitiveFloatArrayMulScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",e)},primitiveFloatArrayAddFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",e)},primitiveFloatArraySubScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",e)},primitiveFloatArraySubFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",e)},primitiveFloatArrayEqual:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",e)},primitiveFloatArrayDotProduct:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",e)},m23PrimitiveInvertRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",e)},m23PrimitiveTransformPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",e)},m23PrimitiveIsPureTranslation:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",e)},m23PrimitiveComposeMatrix:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",e)},m23PrimitiveTransformRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",e)},m23PrimitiveIsIdentity:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",e)},m23PrimitiveInvertPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",e)},primitiveDeflateBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",e)},primitiveDeflateUpdateHashTable:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",e)},primitiveUpdateGZipCrc32:function(e){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",e)},primitiveInflateDecompressBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",e)},primitiveZipSendBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",e)},primitiveFFTTransformData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",e)},primitiveFFTScaleData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",e)},primitiveFFTPermuteData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",e)},gePrimitiveMergeFillFrom:function(e){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",e)},gePrimitiveCopyBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",e)},gePrimitiveAddRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddRect",e)},gePrimitiveAddGradientFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",e)},gePrimitiveSetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",e)},gePrimitiveSetBitBltPlugin:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",e)},gePrimitiveRegisterExternalEdge:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",e)},gePrimitiveGetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",e)},gePrimitiveAddBezier:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",e)},gePrimitiveInitializeProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",e)},gePrimitiveRenderImage:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",e)},gePrimitiveGetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",e)},gePrimitiveSetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",e)},gePrimitiveAddBezierShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",e)},gePrimitiveSetEdgeTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",e)},gePrimitiveGetTimes:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",e)},gePrimitiveNextActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",e)},gePrimitiveAddBitmapFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",e)},gePrimitiveGetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",e)},gePrimitiveAbortProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",e)},gePrimitiveNextGlobalEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",e)},gePrimitiveGetFailureReason:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",e)},gePrimitiveDisplaySpanBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",e)},gePrimitiveGetCounts:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",e)},gePrimitiveChangedActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",e)},gePrimitiveRenderScanline:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",e)},gePrimitiveGetBezierStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",e)},gePrimitiveFinishedProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",e)},gePrimitiveNeedsFlush:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",e)},gePrimitiveAddLine:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddLine",e)},gePrimitiveSetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",e)},gePrimitiveNextFillEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",e)},gePrimitiveInitializeBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",e)},gePrimitiveDoProfileStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",e)},gePrimitiveAddActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",e)},gePrimitiveSetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",e)},gePrimitiveNeedsFlushPut:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",e)},gePrimitiveAddCompressedShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",e)},gePrimitiveSetColorTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",e)},gePrimitiveAddOval:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddOval",e)},gePrimitiveRegisterExternalFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",e)},gePrimitiveAddPolygon:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",e)},gePrimitiveGetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",e)}}),Object.extend(Squeak.Primitives.prototype,"DropPlugin",{primitiveDropRequestFileHandle:function(e){var t=this.stackInteger(0),i=this.display.droppedFiles||[];return!(t<1||t>i.length||(i=i[t-1],!(t=this.fileOpen(i,!1)))||(i=this.makeFileHandle(i,t,!1),this.popNandPushIfOK(e+1,i),0))},primitiveDropRequestFileName:function(e){var t=this.stackInteger(0),i=this.display.droppedFiles||[];return!(t<1||t>i.length)&&(i=this.makeStString(this.filenameToSqueak(i[t-1])),this.popNandPushIfOK(e+1,i))}}),Object.extend(Squeak.Primitives.prototype,"FilePlugin",{primitiveDirectoryCreate:function(e){var t=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),this.success=Squeak.dirCreate(t),this.success||(t=Squeak.splitFilePath(t),Squeak.debugFiles&&console.warn("Directory not created: "+t.fullname)),this.popNIfOK(e))},primitiveDirectoryDelete:function(e){var t=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),this.success=Squeak.dirDelete(t),this.popNIfOK(e))},primitiveDirectoryDelimitor:function(e){var t=this.emulateMac?":":"/";return this.popNandPushIfOK(1,this.charFromInt(t.charCodeAt(0)))},primitiveDirectoryEntry:function(e){var t,i=this.stackNonInteger(1),r=this.stackNonInteger(0);return!!this.success&&(r=r.bytesAsString(),r=this.filenameFromSqueak(r),i=i.bytesAsString(),i=this.filenameFromSqueak(i),(t=Squeak.dirList(i,!0))?(t="."===r?[".",0,0,!0,0]:t[r],this.popNandPushIfOK(e+1,this.makeStObject(t)),!0):(r=Squeak.splitFilePath(i),Squeak.debugFiles&&console.log("Directory not found: "+r.fullname),!1))},primitiveDirectoryLookup:function(e){var t=this.stackInteger(0),i=this.stackNonInteger(1);if(!this.success)return!1;var i=i.bytesAsString(),r=this.filenameFromSqueak(i),s=Squeak.dirList(r,!0);if(!s)return n=Squeak.splitFilePath(r),Squeak.debugFiles&&console.log("Directory not found: "+n.fullname),!1;Squeak.debugFiles&&1===t&&console.log("Reading directory "+r+" with "+Object.keys(s).length+" entries");var n=s[Object.keys(s).sort()[t-1]];return"/"===i&&(1===t?((n=n||[0,0,0,0,0])[0]="SqueakJS",n[3]=!0):n=null),this.popNandPushIfOK(e+1,this.makeStObject(n)),!0},primitiveDirectorySetMacTypeAndCreator:function(e){return this.popNIfOK(e)},primitiveFileAtEnd:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file||(this.popNandPushIfOK(e+1,this.makeStObject(t.filePos>=t.file.size)),0))},primitiveFileClose:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file)&&("string"==typeof t.file?this.fileConsoleFlush(t.file):(this.fileClose(t.file),this.vm.breakOut(),t.file=null),this.popNIfOK(e))},primitiveFileDelete:function(e){var t=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),this.success=Squeak.fileDelete(t),this.popNIfOK(e))},primitiveFileFlush:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file)&&("string"==typeof t.file?this.fileConsoleFlush(t.file):(Squeak.flushFile(t.file),this.vm.breakOut()),this.popNIfOK(e))},primitiveFileGetPosition:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file||(this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t.filePos)),0))},makeFileHandle:function(e,t,i){e=this.makeStString("squeakjs:"+e);return e.file=t,e.fileWrite=i,e.filePos=0,e},primitiveFileOpen:function(e){var t=this.stackBoolean(0),i=this.stackNonInteger(1);return!!this.success&&(i=this.filenameFromSqueak(i.bytesAsString()),!!(i=this.fileOpen(i,t)))&&(i=this.makeFileHandle(i.name,i,t),this.popNandPushIfOK(e+1,i),!0)},primitiveFileRead:function(s){var n,a=this.stackInteger(0),o=this.stackInteger(1)-1,u=this.stackNonInteger(2),l=this.stackNonInteger(3);return!!(this.success&&u.isWordsOrBytes()&&l.file)&&(a?((n=u.bytes)||(n=u.wordsAsUint8Array(),o*=4,a*=4),!(o<0||o+a>n.length)&&("string"==typeof l.file?(this.popNandPushIfOK(s+1,0),!0):this.fileContentsDo(l.file,function(e){if(!e.contents)return this.popNandPushIfOK(s+1,0);var t=e.contents,i=n;a=Math.min(a,e.size-l.filePos);for(var r=0;r<a;r++)i[o+r]=t[l.filePos++];u.bytes||(a>>=2),this.popNandPushIfOK(s+1,Math.max(0,a))}.bind(this)))):this.popNandPushIfOK(s+1,0))},primitiveFileRename:function(e){var t=this.stackNonInteger(1),i=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),i=this.filenameFromSqueak(i.bytesAsString()),this.success=Squeak.fileRename(t,i),this.vm.breakOut(),this.popNIfOK(e))},primitiveFileSetPosition:function(e){var t=this.stackPos32BitInt(0),i=this.stackNonInteger(1);return!(!this.success||!i.file)&&(i.filePos=t,this.popNIfOK(e))},primitiveFileSize:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file||(this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t.file.size)),0))},primitiveFileStdioHandles:function(e){var t=[null,this.makeFileHandle("console.log","log",!0),this.makeFileHandle("console.error","error",!0)];return this.popNandPushIfOK(e+1,this.makeStArray(t)),!0},primitiveFileTruncate:function(e){var t=this.stackPos32BitInt(0),i=this.stackNonInteger(1);return!!(this.success&&i.file&&i.fileWrite)&&(i.file.size>t&&(i.file.size=t,i.file.modified=!0,i.filePos>i.file.size)&&(i.filePos=i.file.size),this.popNIfOK(e))},primitiveDisableFileAccess:function(e){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,e)},primitiveFileWrite:function(n){var a,o=this.stackInteger(0),u=this.stackInteger(1)-1,l=this.stackNonInteger(2),c=this.stackNonInteger(3);return!!(this.success&&c.file&&c.fileWrite)&&(o?((a=l.bytes)||(a=l.wordsAsUint8Array(),u*=4,o*=4),!!a&&!(u<0||u+o>a.length)&&("string"==typeof c.file?(this.fileConsoleWrite(c.file,a,u,o),this.popNandPushIfOK(n+1,o),!0):this.fileContentsDo(c.file,function(e){var t,i=a,r=e.contents||[];c.filePos+o>r.length&&(t=0===r.length?c.filePos+o:Math.max(c.filePos+o,r.length+1e4),e.contents=new Uint8Array(t),e.contents.set(r),r=e.contents);for(var s=0;s<o;s++)r[c.filePos++]=i[u+s];c.filePos>e.size&&(e.size=c.filePos),e.modified=!0,l.bytes||(o>>=2),this.popNandPushIfOK(n+1,o)}.bind(this)))):this.popNandPushIfOK(n+1,0))},fileOpen:function(e,t){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});e=Squeak.splitFilePath(e);if(!e.basename)return null;var i=Squeak.dirList(e.dirname,!0);if(!i)return null;var i=i[e.basename],r=null;if(i){if(s=SqueakFiles[e.fullname])return++s.refCount,s}else{if(!t)return Squeak.debugFiles&&console.log("File not found: "+e.fullname),null;if(r=new Uint8Array,!(i=Squeak.filePut(e.fullname,r.buffer)))return Squeak.debugFiles&&console.log("Cannot create file: "+e.fullname),null}var s={name:e.fullname,size:i[4],contents:r,modified:!1,refCount:1};return SqueakFiles[s.name]=s},fileClose:function(e){Squeak.flushFile(e),0==--e.refCount&&delete SqueakFiles[e.name]},fileContentsDo:function(r,s){if(r.contents)s(r);else{if(!1===r.contents)return!1;this.vm.freeze(function(t){var i=function(e){console.warn("File get failed: "+e),r.contents=!1,t(),s(r)}.bind(this),e=function(e){if(null==e)return i(r.name);r.contents=this.asUint8Array(e),t(),s(r)}.bind(this);Squeak.fileGet(r.name,e,i)}.bind(this))}return!0},fileConsoleBuffer:{log:"",error:""},fileConsoleWrite:function(e,t,i,r){t=t.subarray(i,i+r),i=this.fileConsoleBuffer[e]+Squeak.bytesAsString(t),r=i.match("([^]*)\n(.*)");r&&(console[e](r[1]),i=r[2]),this.fileConsoleBuffer[e]=i},fileConsoleFlush:function(e){var t=this.fileConsoleBuffer[e];t&&(console[e](t),this.fileConsoleBuffer[e]="")}}),Object.extend(Squeak.Primitives.prototype,"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(e){return this.popNandPushIfOK(e+1,this.vm.trueObj)},jpeg2_primImageHeight:function(e){var t=this.stackNonInteger(0).wordsOrBytes();return!!t&&(t=t[1],this.popNandPushIfOK(e+1,t))},jpeg2_primImageWidth:function(e){var t=this.stackNonInteger(0).wordsOrBytes();return!!t&&(t=t[0],this.popNandPushIfOK(e+1,t))},jpeg2_primJPEGCompressStructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGDecompressStructSize:function(e){return this.popNandPushIfOK(e+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(e){var t,i=this.stackNonInteger(2).wordsOrBytes(),r=this.stackNonInteger(1).bytes;return!(!i||!r)&&(t=this.vm.freeze(),this.jpeg2_readImageFromBytes(r,function(e){this.jpeg2state={src:r,img:e},i[0]=e.width,i[1]=e.height,t()}.bind(this),function(){i[0]=0,i[1]=0,t()}.bind(this)),this.popNIfOK(e))},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(e){var t=this.stackNonInteger(3).bytes,i=this.stackNonInteger(2).pointers,r=this.stackBoolean(1);if(!this.success||!t||!i)return!1;var s=this.jpeg2state;if(!s||s.src!==t)return console.error("jpeg read did not match header info"),!1;t=i[Squeak.Form_depth],s=this.jpeg2_getPixelsFromImage(s.img),i=i[Squeak.Form_bits].words;if(32===t)this.jpeg2_copyPixelsToForm32(s,i);else{if(16!==t)return!1;r?this.jpeg2_ditherPixelsToForm16(s,i):this.jpeg2_copyPixelsToForm16(s,i)}return this.popNIfOK(e)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(e){var t,i,r,s,n,a;return!(e<6||(t=this.stackNonInteger(4).bytes,n=this.stackNonInteger(3).pointers,i=this.stackInteger(2),!(this.success&&t&&n)))&&(r=n[Squeak.Form_width],s=n[Squeak.Form_height],a=n[Squeak.Form_depth],n=n[Squeak.Form_bits].words,32!==a?(this.vm.warnOnce("JPEG2WriteImage: only 32 bit depth supported"),!1):(a=this.jpeg2_writeFormToBytes(n,r,s,i,t),this.popNandPushIfOK(e+1,a)))},jpeg2_writeFormToBytes:function(e,t,i,r,s){for(var n=document.createElement("canvas"),a=n.getContext("2d"),t=(n.width=t,n.height=i,a.createImageData(t,i)),o=t.data,u=0;u<e.length;u++){var l=e[u];o[4*u+0]=l>>16&255,o[4*u+1]=l>>8&255,o[4*u+2]=255&l,o[4*u+3]=255}a.putImageData(t,0,0);i=n.toDataURL("image/jpeg",r/100);return this.jpeg2_dataURLToBytes(i,s)},jpeg2_dataURLToBytes:function(e,t){e=e.split(",")[1];if(!e)return 0;if(3*e.length/4-3>t.length)return 0;var i=atob(e);if(i.length>t.length)return 0;for(var r=0;r<i.length;r++)t[r]=i.charCodeAt(r);return i.length},jpeg2_readImageFromBytes:function(e,t,i){var e=new Blob([e],{type:"image/jpeg"}),r=new Image;r.onload=function(){t(r),URL.revokeObjectURL(r.src)},r.onerror=function(){console.warn("could not render JPEG"),i(),URL.revokeObjectURL(r.src)},r.src=URL.createObjectURL(e)},jpeg2_getPixelsFromImage:function(e){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height)},jpeg2_copyPixelsToForm32:function(e,t){for(var i=e.data,r=0;r<t.length;r++){var s=i[4*r+0],n=i[4*r+1],a=i[4*r+2];t[r]=4278190080|s<<16|n<<8|a}},jpeg2_copyPixelsToForm16:function(e,t){for(var i=e.width,r=e.height,s=e.data,n=0;n<r;n++)for(var a=0;a<i;a+=2){var o=n*r+a,u=s[4*o+0]>>3<<10|s[4*o+1]>>3<<5|s[4*o+2]>>3;0==(65535&(u=(u=0===u?1:u)<<16|s[4*o+4]>>3<<10|s[4*o+5]>>3<<5|s[4*o+6]>>3))&&(u|=1),t[o>>1]=u}},jpeg2_ditherPixelsToForm16:function(e,t){for(var i=e.width>>1,r=e.height,s=e.data,n=[2,0,14,12,1,3,13,15],a=[10,8,6,4,9,11,5,7],o=0;o<r;o++)for(var u=0;u<i;u++){var l=o*r+2*u<<2,c=s[l],h=s[1+l],f=s[2+l],p=s[4+l],d=s[5+l],m=s[6+l],v=(3&o)<<1|1&u,g=n[v],v=a[v],k=496*c>>8,b=15&k,y=k>>4,c=g<b?1+y:y;y=(k=496*h>>8)>>4,h=g<(15&k)?1+y:y,y=(k=496*f>>8)>>4,f=g<(15&k)?1+y:y,y=(k=496*p>>8)>>4,p=v<(15&k)?1+y:y,y=(k=496*d>>8)>>4,d=v<(15&k)?1+y:y,y=(k=496*m>>8)>>4;b=c<<10|h<<5|f;0==(65535&(b=(b=0===b?1:b)<<16|p<<10|d<<5|(m=v<(15&k)?1+y:y)))&&(b|=1),t[l>>3]=b}}}),Object.extend(Squeak.Primitives.prototype,"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(e){var t,i,r=this.stackNonInteger(0).bytesAsString();return""!=r&&(/^\/SqueakJS\//.test(r)&&(r=r.slice(10),t=Squeak.splitFilePath(r),i=Squeak.Settings["squeak-template:"+t.dirname])&&(r=JSON.parse(i).url+"/"+t.basename),window.open(r,"_blank"),this.popNIfOK(e))},scratch_primitiveGetFolderPath:function(e){var t,i=this.stackInteger(0);return!!this.success&&!!(t=1===i?"/":t)&&(this.vm.popNandPush(e+1,this.makeStString(this.filenameToSqueak(t))),!0)}}),Object.extend(Squeak.Primitives.prototype,"SoundPlugin",{snd_primitiveSoundStart:function(e){return this.snd_primitiveSoundStartWithSemaphore(e)},snd_primitiveSoundStartWithSemaphore:function(e){var t=this.stackInteger(e-1),i=this.stackInteger(e-2),r=this.stackBoolean(e-3),s=3<e?this.stackInteger(e-4):0;return!!this.success&&(this.audioContext=Squeak.startAudioOut(),this.audioContext?(this.audioSema=s,this.audioNextTimeSlot=0,this.audioBuffersReady=[],this.audioBuffersUnused=[this.audioContext.createBuffer(r?2:1,t,i),this.audioContext.createBuffer(r?2:1,t,i)],this.popNIfOK(e)):(this.vm.warnOnce("could not initialize audio"),!1))},snd_playNextBuffer:function(){var e;this.audioContext&&0!==this.audioBuffersReady.length&&((e=this.audioContext.createBufferSource()).buffer=this.audioBuffersReady.shift(),e.connect(this.audioContext.destination),this.audioNextTimeSlot<this.audioContext.currentTime&&(this.audioNextTimeSlot=this.audioContext.currentTime),e.start(this.audioNextTimeSlot),this.audioNextTimeSlot+=e.buffer.duration,window.setTimeout(function(){this.audioContext&&this.vm.forceInterruptCheck&&(this.audioBuffersUnused.push(e.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1e3*(this.audioNextTimeSlot-this.audioContext.currentTime)),this.snd_playNextBuffer())},snd_primitiveSoundAvailableSpace:function(e){var t,i;return this.audioContext?((i=0)<this.audioBuffersUnused.length&&(i=(t=this.audioBuffersUnused[0]).length*t.numberOfChannels*2),this.popNandPushIfOK(e+1,i)):(console.warn("sound: no audio context"),!1)},snd_primitiveSoundPlaySamples:function(e){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.warn("sound: play but no free buffers"),!1;var t=this.stackInteger(2),i=this.stackNonInteger(1).wordsAsInt16Array(),r=this.stackInteger(0)-1;if(!this.success||!i)return!1;for(var s=this.audioBuffersUnused.shift(),n=s.numberOfChannels,a=0;a<n;a++)for(var o=s.getChannelData(a),u=r+a,l=0;l<t;l++)o[l]=i[u]/32768,u+=n;return this.audioBuffersReady.push(s),this.snd_playNextBuffer(),this.popNIfOK(e)},snd_primitiveSoundPlaySilence:function(e){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.warn("sound: play but no free buffers"),!1;for(var t=this.audioBuffersUnused.shift(),i=t.numberOfChannels,r=t.length,s=0;s<i;s++)for(var n=t.getChannelData(s),a=0;a<r;a++)n[a]=0;return this.audioBuffersReady.push(t),this.snd_playNextBuffer(),this.popNandPushIfOK(e+1,r)},snd_primitiveSoundStop:function(e){return this.audioContext&&(this.audioContext=null,this.audioBuffersReady=null,this.audioBuffersUnused=null,this.audioNextTimeSlot=0,this.audioSema=0),this.popNIfOK(e)},snd_primitiveSoundStartRecording:function(r){var t,s,n,a,i,o,u;return 3===r&&(t=this.stackNonInteger(3),s=this.stackInteger(2),n=this.stackBoolean(1),a=this.stackInteger(0),!!this.success)&&(i=this.primMethod,o=this.vm.freeze(),u=this,Squeak.startAudioIn(function(e,t){for(u.audioInContext=e,u.audioInSource=t,u.audioInSema=a,u.audioInBuffers=[],u.audioInBufferIndex=0,u.audioInOverSample=1;s*u.audioInOverSample<u.audioInContext.sampleRate;)u.audioInOverSample*=2;for(var i=1024*u.audioInOverSample;i/u.audioInContext.sampleRate<.1;)i*=2;u.audioInProcessor=e.createScriptProcessor(i,n?2:1,n?2:1),u.audioInProcessor.onaudioprocess=function(e){u.snd_recordNextBuffer(e.inputBuffer)},u.audioInSource.connect(u.audioInProcessor),u.audioInProcessor.connect(e.destination),u.vm.popN(r),window.setTimeout(o,0)},function(e){console.warn(e),u.vm.sendAsPrimitiveFailure(t,i,r),window.setTimeout(o,0)}),!0)},snd_recordNextBuffer:function(e){this.audioInContext&&(5<this.audioInBuffers.length&&this.audioInBuffers.shift(),this.audioInBuffers.push(e),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(e){var t;return!!this.audioInContext&&(t=this.audioInContext.sampleRate/this.audioInOverSample|0,this.popNandPushIfOK(e+1,t))},snd_primitiveSoundRecordSamples:function(e){var t=this.stackNonInteger(1).wordsAsInt16Array(),i=this.stackInteger(0)-1;if(!this.success)return!1;for(var r=0;i<t.length&&0!==this.audioInBuffers.length;){for(var s=this.audioInBuffers[0],n=s.numberOfChannels,a=n,o=this.audioInOverSample,u=(t.length-i)/a,l=(s.length-this.audioInBufferIndex)/o,c=Math.min(l,u),h=0;h<n;h++)for(var f=s.getChannelData(h),p=this.audioInBufferIndex,d=i+h,m=0;m<c;m++)t[d]=32768*f[p]&65535,d+=a,p+=o;r+=c*n,i+=c*n,p<s.length?this.audioInBufferIndex=p:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(e+1,r)},snd_primitiveSoundStopRecording:function(e){return this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInBuffers=null,this.audioInSource=null,this.audioInProcessor=null,console.log("sound recording stopped")),Squeak.stopAudioIn(),this.popNIfOK(e)},snd_primitiveSoundSetRecordLevel:function(e){return this.vm.warnOnce("sound set record level not supported"),this.popNIfOK(e)}}),!function(){var t=1,i=11;function a(e,t){return 31<t?0:e<<t}function o(e,t){return 31<t?0:e>>>t}var w=0,C=0,A=0,P=null,_=null,e="ADPCMCodecPlugin 3 November 2014 (e)",x=null;function r(){return e}function V(e){for(var t,i=0,r=e;;){if(!(0<(t=r-w)))return i+=o(A,0-t),A&=o(255,8-(w-=r)),i;i+=a(A,t),r-=w,A=P[++C-1],w=8}}function k(e,t){for(var i,r,s=t,n=e;;){if(!((r=(i=8-w)-n)<0))return A+=a(s,r),w+=n,self;A+=o(s,0-r),P[++C-1]=A,s&=a(1,(A=w=0)-r)-1,n-=i}}function s(){var e,t,i,r,s,n,a,o,u,l=_.stackValue(1),c=_.stackIntegerValue(0),h=_.fetchIntegerofObject(0,l),f=_.fetchIntegerofObject(1,l),p=_.fetchIntegerofObject(2,l),d=_.fetchIntegerofObject(3,l),m=_.fetchIntegerofObject(4,l),v=_.fetchIntegerofObject(5,l);if(A=_.fetchIntegerofObject(6,l),w=_.fetchIntegerofObject(7,l),C=_.fetchIntegerofObject(8,l),P=_.fetchBytesofObject(9,l),u=_.fetchInt16ArrayofObject(10,l),o=_.fetchIntegerofObject(12,l),n=_.fetchIntegerofObject(13,l),x=_.fetchInt16ArrayofObject(14,l),a=_.fetchInt16ArrayofObject(15,l),_.failed())return null;for(i=1;i<=c;i++){if(1==(i&v))32767<(h=V(16))&&(h-=65536),f=V(6);else{for(t=V(n),s=x[f],r=0,e=m;0<e;)0<(t&e)&&(r+=s),s>>>=1,e>>>=1;r+=s,0<(t&p)?h-=r:h+=r,32767<h?h=32767:h<-32768&&(h=-32768),(f+=a[t&d])<0?f=0:88<f&&(f=88)}u[++o-1]=h}if(_.failed())return null;_.storeIntegerofObjectwithValue(0,l,h),_.storeIntegerofObjectwithValue(1,l,f),_.storeIntegerofObjectwithValue(6,l,A),_.storeIntegerofObjectwithValue(7,l,w),_.storeIntegerofObjectwithValue(8,l,C),_.storeIntegerofObjectwithValue(12,l,o),_.pop(1)}function n(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g=_.stackValue(1),k=_.stackIntegerValue(0),b=_.fetchInt16ArrayofObject(0,g),y=_.fetchInt16ArrayofObject(1,g),S=_.fetchIntegerofObject(2,g),I=_.fetchIntegerofObject(3,g),F=_.fetchIntegerofObject(4,g),O=_.fetchIntegerofObject(5,g);if(A=_.fetchIntegerofObject(6,g),w=_.fetchIntegerofObject(7,g),C=_.fetchIntegerofObject(8,g),P=_.fetchBytesofObject(9,g),v=_.fetchInt16ArrayofObject(10,g),d=_.fetchInt16ArrayofObject(11,g),m=_.fetchIntegerofObject(12,g),f=_.fetchIntegerofObject(13,g),x=_.fetchInt16ArrayofObject(14,g),p=_.fetchInt16ArrayofObject(15,g),_.failed())return null;for(u=b[0],l=b[1],s=y[0],n=y[1],r=1;r<=k;r++){if(1==(r&O))u=V(16),s=V(6),l=V(16),n=V(6),32767<u&&(u-=65536),32767<l&&(l-=65536);else{for(t=V(f),i=V(f),c=x[s],h=x[n],a=o=0,e=F;0<e;)0<(t&e)&&(a+=c),0<(i&e)&&(o+=h),c>>>=1,h>>>=1,e>>>=1;a+=c,o+=h,0<(t&S)?u-=a:u+=a,0<(i&S)?l-=o:l+=o,32767<u?u=32767:u<-32768&&(u=-32768),32767<l?l=32767:l<-32768&&(l=-32768),(s+=p[t&I])<0?s=0:88<s&&(s=88),(n+=p[i&I])<0?n=0:88<n&&(n=88)}v[++m-1]=u,d[m-1]=l}if(b[0]=u,b[1]=l,y[0]=s,y[1]=n,_.failed())return null;_.storeIntegerofObjectwithValue(6,g,A),_.storeIntegerofObjectwithValue(7,g,w),_.storeIntegerofObjectwithValue(8,g,C),_.storeIntegerofObjectwithValue(12,g,m),_.pop(1)}function u(){var e,t,i,r,s,n,a,o,u,l,c,h=_.stackValue(1),f=_.stackIntegerValue(0),p=_.fetchIntegerofObject(0,h),d=_.fetchIntegerofObject(1,h),m=_.fetchIntegerofObject(2,h),v=_.fetchIntegerofObject(4,h),g=_.fetchIntegerofObject(5,h);if(A=_.fetchIntegerofObject(6,h),w=_.fetchIntegerofObject(7,h),C=_.fetchIntegerofObject(8,h),P=_.fetchBytesofObject(9,h),c=_.fetchInt16ArrayofObject(10,h),l=_.fetchIntegerofObject(12,h),o=_.fetchIntegerofObject(13,h),x=_.fetchInt16ArrayofObject(14,h),u=_.fetchInt16ArrayofObject(15,h),_.failed())return null;for(a=x[0],r=1;r<=f;r++)if(1==(r&g))(n=p=c[++l-1])<0&&(n+=65536),k(16,n),k(6,d=r<f?function(e,t){var i,r,s=t-e;for(s<0&&(s=0-s),i=63,r=1;r<=62;r++)63===i&&x[r-1]>=s&&(i=r);return i}(p,c[l]):d);else{for((i=c[++l-1]-p)<(n=0)&&(n=m,i=0-i),s=t=0,e=v;0<e;)a<=i&&(t+=e,s+=a,i-=a),a>>>=1,e>>>=1;s+=a,0<n?p-=s:p+=s,32767<p?p=32767:p<-32768&&(p=-32768),(d+=u[t])<0?d=0:88<d&&(d=88),a=x[d],k(o,n|t)}if(0<w&&(P[++C-1]=A),_.failed())return null;_.storeIntegerofObjectwithValue(0,h,p),_.storeIntegerofObjectwithValue(1,h,d),_.storeIntegerofObjectwithValue(6,h,A),_.storeIntegerofObjectwithValue(7,h,w),_.storeIntegerofObjectwithValue(8,h,C),_.storeIntegerofObjectwithValue(12,h,l),_.pop(1)}function l(){var e=_.stackValue(1);return _.stackIntegerValue(0),A=_.fetchIntegerofObject(6,e),w=_.fetchIntegerofObject(7,e),C=_.fetchIntegerofObject(8,e),P=_.fetchIntegerofObject(9,e),x=_.fetchIntegerofObject(14,e),_.failed()||(success(!1),_.failed())?null:(_.storeIntegerofObjectwithValue(6,e,A),_.storeIntegerofObjectwithValue(7,e,w),_.storeIntegerofObjectwithValue(8,e,C),void _.pop(1))}function c(e){return!1!=((_=e).majorVersion()==t)&&_.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("ADPCMCodecPlugin",{primitiveDecodeStereo:n,primitiveEncodeStereo:l,setInterpreter:c,primitiveEncodeMono:u,primitiveDecodeMono:s,getModuleName:r}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function q(e){return"number"==typeof e?k.classSmallInteger():e.sqClass}function f(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function M(e,t){return 0|Math.floor(e/t)}function D(e,t){return 31<t?0:e<<t}function R(e,t){return 31<t?0:e>>>t}function o(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}function e(e,t){return new Float32Array(e.buffer,e.byteOffset+4*t)}var r=12,B=2,N=3,T=1,E=0,L=6,G=0,X=4,Z=1,J=2,Y=3,Q=6,$=0,ee=2,te=1,ie=3,re=16,se=11,ne=13,ae=10,oe=18,ue=15,le=21,ce=16,he=4,fe=5,pe=2,de=3,me=10,ve=0,ge=1,ke=18,be=19,ye=20,Se=16,Ie=28,Fe=22,Oe=17,we=10,Ce=4,Ae=65536,Pe=100,_e=121,xe=122,Ve=114,je=112,qe=101,Me=102,u=104,Be=103,Ne=120,Te=119,Ee=113,Le=123,De=115,Re=108,We=105,ze=106,Ue=110,Ke=107,He=109,Ge=111,Xe=118,Ze=117,Je=116,Ye=8,Qe=9,$e=7,et=2,tt=1,it=0,rt=6,st=2,nt=255,at=256,ot=65280,ut=4,lt=65535,ct=1,ht=7,ft=5,pt=254,dt=1,mt=5,vt=8,gt=3,l=0,kt=6,bt=7,yt=2,St=4,It=4,Ft=5,Ot=6,wt=6,Ct=2,At=5,Pt=4,_t=3,xt=1,Vt=6,jt=7,qt=8,Mt=9,Bt=4,Nt=5,Tt=10,Et=12,Lt=16,Dt=14,Rt=15,Wt=13,zt=15,Ut=14,Kt=18,Ht=19,Gt=20,Xt=16,Zt=21,Jt=17,Yt=10,Qt=12,$t=51,ei=50,ti=53,ii=48,ri=52,si=49,ni=13,ai=14,oi=109,ui=111,li=108,ci=110,hi=10,fi=69,pi=43,di=45,mi=42,vi=44,gi=24,ki=97,bi=107,yi=103,Si=93,Ii=91,Fi=101,Oi=105,wi=99,Ci=95,Ai=88,Pi=113,_i=46,xi=47,Vi=37,ji=39,qi=36,Mi=38,Bi=11,Ni=12,Ti=17,Ei=16,Li=128,Di=66,Ri=67,Wi=68,zi=0,Ui=1097753705,Ki=256,Hi=63,Gi=8,Xi=9,Zi=80,Ji=82,Yi=84,Qi=86,$i=1,er=34,tr=35,ir=33,rr=32,sr=2,nr=64,ar=96,or=106,ur=102,lr=92,cr=90,hr=100,fr=104,pr=98,dr=94,p=3,d=5,n=null,mr="BitBltPlugin",vr=null,gr=0,kr=0,m=0,br=0,S=0,yr=0,v=0,g=null,k=null,Sr=null,Ir="B2DPlugin 14 November 2014 (e)",Fr=null,b=0,W=null,c=null;function z(){return c[$t]}function Or(e){c[$t]=e}function wr(){return c[ei]}function Cr(e,t){e=e+U()-1&~(U()-1);return t<e?t:e}function Ar(e,t){return t-1&~(U()-1)}function U(){return c[ii]}function Pr(){return c[ri]}function _r(e){c[ri]=e}function K(){return c[si]}function xr(e){c[si]=e}function Vr(e,t){return 0===e?t<0?0-t:t:0===t?e<0?0-e:e:(e=e*e+t*t)<32?[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6][e]:Math.sqrt(e)+.5|0}function jr(e){Lr(1)&&(g[Vn()]=e,jn(Vn()+1))}function a(){return c[ni]}function qr(e){c[ni]=e}function Mr(){return c[ai]}function Br(e){c[ai]=e}function Nr(e){return ka(e)}function Tr(){return Iu(6),s()}function Er(e,t){var i,r,s,n=18+e;if(!Rr(n))return 0;if(b=(r=b)+n,Pa(r,1024),wa(r,0),Ca(r,n),i=Ms(r),Bn())for(s=0;s<=e-1;s++)i[s]=j(t[s]);else for(s=0;s<=e-1;s++)i[s]=t[s];return O(r,ue,e),r}function Lr(e){var t,i,r,s;if(Nr(e)){if(0!==Mr())for(r=Mr(),t=Mr()+e,i=1,s=Mr();i<=s;i++)n[--t]=n[--r];return n=o(n,e),1}}function Dr(e,t,i){var r,s,n,a=12+t;if(!Rr(a))return 0;if(b=(r=b)+a,Pa(r,i?768:512),wa(r,0),Ca(r,a),n=Mn(r),Bn())for(s=0;s<=t-1;s++)n[s]=j(e[s]);else for(s=0;s<=t-1;s++)n[s]=e[s];return O(r,Tt,t),r}function Rr(e){var t,i,r,s;if(Lr(e)){if(0!==Vn())for(r=Vn(),t=Vn()+e,i=1,s=Vn();i<=s;i++)g[--t]=g[--r];return g=o(g,e),1}}function Wr(){return Iu(3)}function zr(e){return 0==(h(e,it)&Ae)}function Ur(e,t,i){if(i<t){if(t<e)return t;if(e<i)return i}else{if(e<t)return t;if(i<e)return i}return e}function Kr(e){return h(e,14)}function Hr(e,t){O(e,14,t)}function Gr(e){return h(e,15)}function Xr(e,t){O(e,15,t)}function Zr(e){return h(e,le)}function Jr(e,t){O(e,le,t)}function Yr(e){return o(Fr,e+me)}function Qr(e,t){O(e,12,t)}function $r(e,t){O(e,13,t)}function es(e){return h(e,se)}function ts(e){return h(e,ce)}function is(e,t,i,r){var s,n=h(e,12),a=h(e,14);return 32===n?0!==(s=0|t[a*r+i])&&0==(4278190080&s)&&(s|=4278190080):(s=t[a*r+R(i,t=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1][n])],a=D(1,n)-1,s=R(s,32-n-(i&D(1,t)-1)*n)&a,16===n?0!==s&&(r=(31&s)<<3,i=(s>>>5&31)<<3,t=(s>>>10&31)<<3,s=(r+=r>>>5)+((i+=i>>>5)<<8)+((t+=t>>>5)<<16)+(255<<24)):s=0===h(e,ue)?0:Ms(e)[s]),bu(s)}function rs(e){return h(e,ae)}function ss(e){return Fu(s()-e+4)}function ns(e,t){Ou(s()-e+4,t)}function as(e){return Fu(s()-e+5)}function os(e,t){Ou(s()-e+5,t)}function us(e){return Fu(s()-e+0)}function ls(e,t){Ou(s()-e+0,t)}function cs(e){return Fu(s()-e+1)}function hs(e,t){Ou(s()-e+1,t)}function fs(e){return Fu(s()-e+2)}function ps(e,t){Ou(s()-e+2,t)}function ds(e){return Fu(s()-e+3)}function ms(e,t){Ou(s()-e+3,t)}function vs(e,t,i){for(var r,s,n=f(e),a=e.wordsAsInt32Array(),o=0,u=0;u<=n-1;u++){if(r=_o(u,a),!(0<=(s=xo(u,a))&&s<=t))return;o+=r}return o===i}function gs(e,t,i,r,s,n,a){if((e=e,o=t,k.isWords(e)&&((e=f(e))===3*o||e===6*o))&&(function(e){var t,i,r;if(k.isWords(e)){for(r=f(e),t=e.wordsAsInt32Array(),i=0;i<=r-1;i++)if(!Kn(t[i]))return;return 1}}(a)&&vs(i,e=f(a),t)&&vs(r,e,t)&&vs(n,e,t))){for(var o=s,i=t,u=f(o),l=o.wordsAsInt32Array(),c=0,h=0;h<=u-1;h++)c+=_o(h,l);return!!(c===i)}}function ks(e){var t,i;return(Aa(e)&pt)===ut?(t=Hn(i=e)?Nu(i):0,Yn(i)+t<pn()||y(i)-t>=cn()&&Jn(i)-t>=cn()?0:void jr(i)):(Aa(e)&pt)===rt?(i=Hn(t=e)?_u(t):0,Gr(t)+i<pn()||y(t)-i>=cn()&&Kr(t)-i>=cn()?0:void jr(t)):void jr(e)}function bs(){return[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1]}function ys(){return[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0]}function Ss(e,t){return e<0?0:t<=e?t-1:e}function Is(){var e=R(To(),K()),t=R(Mo(),K())+1;for(e<0&&(e=0),t>No()&&(t=No());e<t;)W[e]=0,++e;Eo(No()),Bo(0)}function Fs(){return c[fi]}function Os(e){c[fi]=e}function ws(){return c[pi]}function Cs(e){c[pi]=e}function As(){return c[di]}function Ps(e){c[di]=e}function _s(){return c[mi]}function xs(e){c[mi]=e}function Vs(){return c[vi]}function js(e){c[vi]=e}function qs(){return e(c,gi)}function Ms(e){return o(Fr,e+oe)}function Bs(e,t){var i,r,s,n=h=us(e),a=i=cs(e),o=r=fs(e),u=s=ds(e),l=ss(e),c=as(e),h=n+=(r-h)*t|0,f=a+=(s-i)*t|0;return h+=((o+=(l-r)*t|0)-n)*t|0,a=Ur(a,i,f+=((u+=(c-s)*t|0)-a)*t|0),u=Ur(u,f,c),r=Tr(),S?0:(ps(e,n),ms(e,a),ns(e,h),os(e,f),ls(r,h),hs(r,f),ps(r,o),ms(r,u),ns(r,l),os(r,c),r)}function Ns(e){var t,i,r,s,n,a,o,u,l,c,h,f,p=Tr();return S?0:(r=l=us(e),s=c=cs(e),n=h=fs(e),a=f=ds(e),o=n+=(t=ss(e))-h>>1,u=a+=(i=as(e))-f>>1,o+=(r+=h-l>>1)-n>>1,u+=(s+=f-c>>1)-a>>1,ps(e,r),ms(e,s),ns(e,o),os(e,u),ls(p,o),hs(p,u),ps(p,n),ms(p,a),ns(p,t),os(p,i),p)}function Ts(e,t){var i,r=Yr(e)[ve]>>8,s=xu(e)[ve]>>8;s<r&&(i=r,r=s,s=i),Qs(e,r),Vu(e,t<s-r?s-r:t)}function Es(){for(var e=0,t=b;e<t;)!function(e){if(Aa(e)>nt)return;return 0!=(Aa(e)&nt)}(e)||$s(e)>=hn()||ks(e),e+=h(e,tt)}function H(){return c[Ai]}function Ls(e){c[Ai]=e}function Ds(){return c[Pi]}function Rs(e){c[Pi]=e}function Ws(){return c[_i]}function zs(){return c[xi]}function Us(e){var t,i=R(To(),K());i<_s()&&(i=_s()),(t=R(Mo()+U()-1,K()))>ws()&&(t=ws()),(e=R(e,K()))<Vs()||e>=As()||t<_s()||i>=ws()||(i=i,t=t,e=e,(vr||Dn())&&vr(i,t,e))}function Ks(e){Pa(e,Aa(e)|Ae)}function Hs(e){Pa(e,Aa(e)&~Ae)}function Gs(e,t){O(e,Ye,t)}function Xs(e){return h(e,$e)}function Zs(e,t){return O(e,$e,t)}function Js(e,t){O(e,Qe,t)}function Ys(){return e(c,18)}function y(e){return h(e,It)}function Qs(e,t){O(e,It,t)}function $s(e){return h(e,Ft)}function en(e,t){O(e,Ft,t)}function tn(e){return h(e,Ot)}function rn(e,t){O(e,Ot,t)}function sn(e,t){for(var i=uu(),r=e,s=mu();s<t;){if(0!==(i=uu())&&yn(i,r,s))return;Fo(s),r=s,s=mu()}if(0!==(i=uu()))return yn(i,r,t)}function nn(){var e,t,i,r,s,n,a,o,u,l,c,h,N,f,p,d,m,v,g,k,b,y,S,I,F,T,O,E,w,C,A,P,_=Gn(),x=Xn(),L=Zn(),V=H();if(1!==U()){var j=_,q=x,M=L,B=V;if(p=sa(j)){for(m=rs(j),d=es(j),w=1===ts(j),k=q-vn(j),B=B-gn(j),y=on(j),I=dn(j),b=k*y+B*un(j),S=k*I+B*mn(j),N=U(),T=Cr(q,M),E=Ar(0,M),f=K(),v=z(),g=wr(),C=q;C<T;)w&&(b=wo(b,m<<16),S=wo(S,d<<16)),A=b>>16,P=S>>16,w||(A=Ss(A,m),P=Ss(P,d)),0<=A&&0<=P&&A<m&&P<d&&(F=R((F=is(j,p,A,P))&v,g),O=R(C,f),W[O]=W[O]+F),b+=y,S+=I,++C;for(v=4042322160|R(z(),K()),g=K();C<E;)w&&(b=wo(b,m<<16),S=wo(S,d<<16)),A=b>>16,P=S>>16,w||(A=Ss(A,m),P=Ss(P,d)),0<=A&&0<=P&&A<m&&P<d&&(F=R((F=is(j,p,A,P))&v,g),O=R(C,f),W[O]=W[O]+F),b+=D(y,g),S+=D(I,g),C+=N;for(v=z(),g=wr();C<M;)w&&(b=wo(b,m<<16),S=wo(S,d<<16)),A=b>>16,P=S>>16,w||(A=Ss(A,m),P=Ss(P,d)),0<=A&&0<=P&&A<m&&P<d&&(F=R((F=is(j,p,A,P))&v,g),O=R(C,f),W[O]=W[O]+F),b+=y,S+=I,++C}}else if(e=sa(_))for(i=rs(_),t=es(_),o=1===ts(_),k=x-vn(_),V=V-gn(_),s=on(_),a=dn(_),r=k*s+V*un(_),n=k*a+V*mn(_),u=x,l=L;u<l;)o&&(r=wo(r,i<<16),n=wo(n,t<<16)),c=r>>16,h=n>>16,o||(c=Ss(c,i),h=Ss(h,t)),0<=c&&0<=h&&c<i&&h<t&&(c=is(_,e,c,h),W[u]=c),r+=s,n+=a,++u}function an(e,t,i){var r,s;if(1!==U()){var n,a,o,u,l,c,h,f=e,p=t,d=i;if(o=Cr(p,d),l=Ar(0,d),n=U(),a=K(),(h=p)<o)for(c=R(f&z(),wr());h<o;)u=R(h,a),W[u]=W[u]+c,++h;if(h<l)for(p=4042322160|R(z(),K()),c=R(f&p,K());h<l;)u=R(h,a),W[u]=W[u]+c,h+=n;if(h<d)for(c=R(f&z(),wr());h<d;)u=R(h,a),W[u]=W[u]+c,++h}else{for(r=t,s=i;r+4<s;)W[r]=e,W[r+1]=e,W[r+2]=e,W[r+3]=e,r+=4;for(;r<s;)W[r]=e,++r}}function on(e){return h(e,Vt)}function un(e){return h(e,jt)}function ln(){var e,t,i,r,s,n,a,o=Gn(),u=Xn(),l=Zn(),c=H();for(i=Mn(o),s=qn(o),t=on(o),e=(u-vn(o))*t+(c-gn(o))*un(o),n=c=u,a=l;((r=e>>16)<0||s<=r)&&n<a;)++n,e+=t;if(c<n&&an(i[r=s<=(r=r<0?0:r)?s-1:r],c,n),1===U())for(;(r=e>>16)<s&&0<=r&&n<a;)W[n]=i[r],++n,e+=t;else n=function(e,t,i,r,s,n){var a,o,u,l,c,h,f,p,d,m,v,g;a=U(),o=K(),m=qn(e),d=(c=i)>>16,h=Cr(g=s,n),p=Ar(0,n),u=z(),l=wr();for(;g<h&&d<m&&0<=d;){for(v=R((v=t[d])&u,l);g<h&&c>>16===d;)f=R(g,o),W[f]=W[f]+v,++g,c+=r;d=c>>16}u=4042322160|R(z(),K()),l=K();for(;g<p&&d<m&&0<=d;){for(v=R((v=t[d])&u,l);g<p&&c>>16===d;)f=R(g,o),W[f]=W[f]+v,g+=a,c+=D(r,l);d=c>>16}u=z(),l=wr();for(;g<n&&d<m&&0<=d;){for(v=R((v=t[d])&u,l);g<n&&c>>16===d;)f=R(g,o),W[f]=W[f]+v,++g,c+=r;d=c>>16}return g}(o,i,e,t,n,l);n<a&&an(i[r=s<=(r=r<0?0:r)?s-1:r],n,a)}function cn(){return c[Vi]}function hn(){return c[ji]}function fn(){return c[qi]}function pn(){return c[Mi]}function dn(e){return h(e,qt)}function mn(e){return h(e,Mt)}function vn(e){return h(e,Bt)}function gn(e){return h(e,Nt)}function kn(){var e,t,i,r,s,n,a,o,u,l,c=Gn(),h=Xn(),f=Zn(),p=H();for(a=Mn(c),o=qn(c),e=h-vn(c),p=p-gn(c),i=on(c),s=dn(c),t=e*i+p*un(c),r=e*s+p*mn(c),u=h,l=f,n=(o-1)*(o-1);_(t>>16,r>>16)>=n&&u<l;)++u,t+=i,r+=s;h<u&&an(a[o-1],h,u),(e=w())[0]=t,e[1]=r,(u=(u=u<vn(c)?(1===U()?function(e,t,i,r,s,n,a){var o,u=0|i[0],l=0|i[1],c=Vr(u>>16,l>>16),h=t[c],f=(c-1)*(c-1),p=n,d=a;for(d>vn(e)&&(d=vn(e));p<d;){for(;p<d&&_(u>>16,l>>16)>=f;)W[p]=h,++p,u+=r,l+=s;for(o=_(u>>16,l>>16);o<f;)h=t[--c],f=(c-1)*(c-1)}return i[0]=u,i[1]=l,p}:function(e,t,i,r,s,n,a){var o,u,l,c,h,f=0|i[0],p=0|i[1],d=U(),m=K(),v=Vr(f>>16,p>>16),g=(v-1)*(v-1),k=n,b=vn(e),y=Cr(n,b=a<b?a:b),S=Ar(0,b);if(k<y)for(o=z(),u=wr(),h=R((h=t[v])&o,u);k<y;){for(;k<y&&_(f>>16,p>>16)>=g;)l=R(k,m),W[l]=W[l]+h,++k,f+=r,p+=s;for(c=_(f>>16,p>>16);c<g;)h=R((h=t[--v])&o,u),g=(v-1)*(v-1)}if(k<S)for(o=4042322160|R(z(),K()),u=K(),h=R((h=t[v])&o,u);k<S;){for(;k<S&&_(f>>16,p>>16)>=g;)l=R(k,m),W[l]=W[l]+h,k+=d,f+=D(r,u),p+=D(s,u);for(c=_(f>>16,p>>16);c<g;)h=R((h=t[--v])&o,u),g=(v-1)*(v-1)}if(k<b)for(o=z(),u=wr(),h=R((h=t[v])&o,u);k<b;){for(;k<b&&_(f>>16,p>>16)>=g;)l=R(k,m),W[l]=W[l]+h,++k,f+=r,p+=s;for(c=_(f>>16,p>>16);c<g;)h=R((h=t[--v])&o,u),g=(v-1)*(v-1)}return i[0]=f,i[1]=p,k})(c,a,e,i,s,u,l):u)<l?(1===U()?function(e,t,i,r,s,n,a){var o,u,l,c,h,f,p,d,m;o=0|i[0],u=0|i[1],f=Vr(o>>16,u>>16),p=t[f],e=qn(e),c=(e-1)*(e-1),h=(f+1)*(f+1),l=_(o>>16,u>>16),d=n,m=a;for(;d<m&&l<c;){for(;d<m&&_(o>>16,u>>16)<=h;)W[d]=p,++d,o+=r,u+=s;for(l=_(o>>16,u>>16);h<l;)p=t[++f],h=(f+1)*(f+1)}return i[0]=o,i[1]=u,d}:function(e,t,i,r,s,n,a){var o,u,l,c,h,f,p,d,m,v,g,k,b,y,S;if(h=0|i[0],f=0|i[1],o=U(),u=K(),b=Vr(h>>16,f>>16),e=qn(e),g=(e-1)*(e-1),k=(b+1)*(b+1),m=_(h>>16,f>>16),p=Cr(S=n,a),v=Ar(0,a),S<p&&m<g)for(l=z(),c=wr(),y=R((y=t[b])&l,c);S<p&&m<g;){for(;S<p&&_(h>>16,f>>16)<=k;)d=R(S,u),W[d]=W[d]+y,++S,h+=r,f+=s;for(m=_(h>>16,f>>16);k<m;)y=R((y=t[++b])&l,c),k=(b+1)*(b+1)}if(S<v&&m<g)for(l=4042322160|R(z(),K()),c=K(),y=R((y=t[b])&l,c);S<v&&m<g;){for(;S<v&&_(h>>16,f>>16)<=k;)d=R(S,u),W[d]=W[d]+y,S+=o,h+=D(r,c),f+=D(s,c);for(m=_(h>>16,f>>16);k<m;)y=R((y=t[++b])&l,c),k=(b+1)*(b+1)}if(S<a&&m<g)for(l=z(),c=wr(),y=R((y=t[b])&l,c);S<a&&m<g;){for(;S<a&&_(h>>16,f>>16)<=k;)d=R(S,u),W[d]=W[d]+y,++S,h+=r,f+=s;for(m=_(h>>16,f>>16);k<m;)y=R((y=t[++b])&l,c),k=(b+1)*(b+1)}return i[0]=h,i[1]=f,S})(c,a,e,i,s,u,l):u)<f&&an(a[o-1],u,f)}function bn(e,t){var i=Lo(e)-Lo(t);return 0!=i?0<i:zo(e)>>>0<zo(t)>>>0}function yn(e,t,i){if(0!==e){var t=t<jo()?jo():t,i=i>D(No(),K())?D(No(),K()):i;if(t<fn()&&(t=fn()),i>cn()&&(i=cn()),t<To()&&Eo(t),i>Mo()&&Bo(i),i>jo()&&qo(i),!(i<=t))if(Un(e))an(e,t,i);else{if(c[Di]=e,t=t,c[Ri]=t,t=i,c[Wi]=t,(i=(Aa(e)&ot)>>>8)<=1)return!0;switch(i){case 0:case 1:break;case 2:ln();break;case 3:kn();break;case 4:case 5:nn()}}}return!1}function Sn(){for(var e,t,i=H();_n()<Vn();){if($s(e=g[_n()])>i)return!1;if(((t=Aa(e))&pt)===st)return!0;if(!ka(1))return!1;switch(t){case 0:case 1:case 2:case 3:break;case 4:Go(g[_n()],H());break;case 5:a=f=h=l=u=c=r=n=s=void 0;var r,s=g[_n()],n=H();if(u=Nu(s),c=u>>1,h=y(s),f=$s(s),Go(s,f),l=Xs(s),a=$n(s),Qs(s,h-c),Zs(s,l+u),0<a?Eu(s,ea(s)+u):(Eu(s,u-ea(s)),Qs(s,y(s)+ea(s))),h=0-l-c,qu(s,0),Bu(s,h),(c<=0&&h<0?Hs:Ks)(s),f!==n){for(r=f;r<=n-1;r++)Qo(s);Zs(s,Xs(s)-(n-f))}break;case 6:Ho(g[_n()],H());break;case 7:f=h=c=l=u=o=a=d=p=void 0;var a,o,u,l,c,h,f,p=g[_n()],d=H();for(l=_u(p),u=l>>1,a=Kr(p),h=$s(p),Ho(p,h),c=Xs(p),o=0;o<=5;o++)xu(p)[o]=Yr(p)[o];if(0===(f=Yr(p)[pe])&&Yr(p)[he],((f=0<=f?1:-1)<0?function(e,t,i,r){var s;Yr(e)[ve]=Yr(e)[ve]-256*i,s=xu(e)[ve],xu(e)[ve]=s+256*(t-i),s=xu(e)[ge],xu(e)[ge]=s+256*t,Jr(e,r-i)}:function(e,t,i,r){var s;Yr(e)[ve]=Yr(e)[ve]+256*i,s=xu(e)[ve],xu(e)[ve]=s-256*(t-i),s=xu(e)[ge],xu(e)[ge]=s+256*t,Jr(e,r-i+t)})(p,l,u,a),0===c&&(Yr(p)[ve]=256*Zr(p)),Zs(p,c+l),f=0-c-u,Au(p,0),Pu(p,f),(u<=0&&f<0?Hs:Ks)(p),Ts(p,l),h!==d){for(o=h;o<=d-1;o++)Yo(p,o);Zs(p,Xs(p)-(d-h))}}Wn(e),xn(_n()+1)}return!1}function In(){var e,t,i;for(t=cn();a()<Mr();){if((i=t=y(e=n[a()]))>=cn())return!1;if(Fo(i),Hn(e)&&!function(e){var t,i,r,s;switch(s=function(e){return Aa(e)>>>1}(e),kr=e,s){case 0:case 1:break;case 2:gr=Tu(kr);break;case 3:gr=function(e){return h(e,Oe)}(kr)}switch(r=gr,s){case 0:case 1:break;case 2:gr=function(e){return h(e,Xt)}(kr);break;case 3:gr=function(e){return h(e,Se)}(kr)}if(0===(s=gr))return;if(!ka(3))return;t=1+(tn(e)<<1),r=y(e)+r,-1===(i=On(s,t))?Vo(s,t,r):Ro(i)<r&&Wo(i,r);Fo(y(e))}(e),zr(e)&&(function(e){var t,i;if(!ka(6))return;t=tn(e)<<1,0!==(i=function(e){return h(e,Ye)}(e))&&ou(i,t,999999999);0!==(i=function(e){return h(e,Qe)}(e))&&ou(i,t,999999999);Fo(y(e))}(e),S))return!1;qr(a()+1),a()<Mr()&&(t=y(n[a()]))>=fn()&&sn(i,t)}return t<cn()&&sn(t,cn()),!1}function Fn(){for(var e,t;a()<Mr();)if(0==(t=Xs(e=n[a()])-1))Oo();else{if(Zs(e,t),((t=Aa(e))&pt)===st)return!0;switch(t){case 0:case 1:case 2:case 3:break;case 4:Jo(n[a()],H());break;case 5:Qo(n[a()],H());break;case 6:Zo(n[a()],H());break;case 7:Yo(n[a()],H())}Co(),qr(a()+1)}return!1}function On(e,t){for(var i=0;i<s()&&(zo(i)!==e||Lo(i)!==t);)i+=3;return i>=s()?-1:i}function wn(){return Ko()===vt}function Cn(){Cu(wu()+3)}function An(){return Ir}function Pn(e,t){var i;return e===t||(i=0==(i=$s(e)-$s(t))?y(e)-y(t):i)<0}function _n(){return c[Bi]}function xn(e){c[Bi]=e}function Vn(){return c[Ni]}function jn(e){c[Ni]=e}function qn(e){return h(e,Tt)}function Mn(e){return o(Fr,e+Et)}function Bn(){return 0!==c[Ti]}function Nn(e){c[Ti]=e}function Tn(){return 0!==c[Ei]}function En(e){c[Ei]=e}function Ln(e,t){var i,r=On(e,t);if(-1===r)return!1;if(0===r)Cn();else if(Uo(r,Fu(0)),Do(r,Lo(0)),Wo(r,Ro(0)),Cn(),!(s()<=3)){for(i=0,r=3;r<s();)bn(r,i)&&(i=r),r+=3;i+3!==s()&&(e=zo(i),Uo(i,pu()),du(e),t=Lo(i),Do(i,lu()),cu(t),e=Ro(i),Wo(i,hu()),fu(e))}return!0}function I(e,t){c[e]=c[e]+t}function Dn(){return Sr=k.ioLoadFunctionFrom("loadBitBltFrom",mr),vr=k.ioLoadFunctionFrom("copyBitsFromtoat",mr),!!Sr&&!!vr}function Rn(){var e;Ao(U()),_s()<0&&xs(0),ws()>No()&&Cs(No()),e=D(_s(),K()),c[qi]=e,e=D(Vs(),K()),c[Mi]=e,e=D(ws(),K()),c[Vi]=e,e=D(As(),K()),c[ji]=e,jn(0),Br(0),g=o(Fr,b),n=o(Fr,b),Es(),S||(0===Vn()?Ls(hn()):(function e(t,i,r){var s;var n;var a;var o;var u;var l;var c;var h;var f;var p;if((h=r+1-i)<=1)return 0;a=t[i];u=t[r];n=Pn(a,u);n||(f=t[i],t[i]=t[r],t[r]=f,p=a,a=u,u=p);if(h<=2)return 0;p=i+r>>1;o=t[p];n=Pn(a,o);n?(n=Pn(o,u))||(f=t[r],t[r]=t[p],t[p]=f,o=u):(f=t[i],t[i]=t[p],t[p]=f,o=a);if(h<=3)return 0;l=i;c=r;s=!0;for(;s;){for(n=!0;n;)n=l<=--c&&(f=t[c],Pn(o,f));for(n=!0;n;)n=++l<=c&&Pn(f=t[l],o);(s=l<=c)&&(f=t[l],t[l]=t[c],t[c]=f)}e(t,i,c);e(t,l,r)}(g,0,Vn()-1),Ls($s(g[0])),H()<pn()&&Ls(pn()),Eo(0),Bo(D(No(),K())-1),Is()))}function Wn(e){if(!(Xs(e)<=0)){var t,i=function(e){for(var t=y(e),i=0;i<Mr()&&y(n[i])<t;)++i;for(;i<Mr()&&y(n[i])===t&&Pn(n[i],e);)++i;return i}(e),r=i;if(ka(1)){for(t=Mr()-1;!(t<r);)n[t+1]=n[t],--t;n[r]=e,Br(Mr()+1)}}}function zn(e){return Un(e)||0!=(Aa(e)&ot)}function Un(e){return 0!=(4278190080&e)}function Kn(e){return 0===e||Un(e)||0<=(t=e)&&t<b&&zn(e);var t}function Hn(e){return 0!=(Aa(e)&ct)}function Gn(){return c[Di]}function Xn(){return c[Ri]}function Zn(){return c[Wi]}function Jn(e){return h(e,Dt)}function Yn(e){return h(e,Rt)}function Qn(e,t){O(e,Wt,t)}function $n(e){return h(e,Yt)}function ea(e){return h(e,Qt)}function ta(e,t,i,r){var s,n,a,o,u=Tr();if(S)return 0;for(ls(u,e[0]),hs(u,e[1]),ps(u,t[0]),ms(u,t[1]),ns(u,i[0]),os(u,i[1]),o=s=function(e,t){var i,r,s;i=r=s=function(e){var t,i,r;if(i=cs(e),r=ds(e),t=as(e),0<=(i=r-i)*(t=t-r))return e;I(li,1),(r=i)<0&&(r=0-r);(t=t-i)<0&&(t=0-t);return Bs(e,r/t)}(e),t&&(r=au(e));s<r&&(s=r);e!==i&&t&&(r=au(i));s<r&&(s=r);return s}(u,r),n=u;n<=s;n+=6)if(o<(a=function e(t){var i;var r;r=nu(t);if(r!==t)return i=e(t),S||(r=e(r),S)?0:r<=i?i:r;return t}(n))&&(o=a),S)return 0;return M(o,6)}function ia(e){return(Sr||Dn())&&Sr(e)}function ra(e,t,i,r,s,n,a){var o,u,l,c,h;if(t.isNil)c=0,l=null;else{if(q(t)!==k.classBitmap())return k.primitiveFail();c=f(t),l=t.wordsAsInt32Array()}return"number"==typeof e||!k.isPointers(e)||f(e)<5||q(t=k.fetchPointerofObject(0,e))!==k.classBitmap()?k.primitiveFail():(t=f(t),u=k.fetchIntegerofObject(1,e),o=k.fetchIntegerofObject(2,e),e=k.fetchIntegerofObject(3,e),k.failed()?null:!(0<=u&&0<=o)||32!==e&&8!==e&&16!==e&&1!==e&&2!==e&&4!==e||0!==c&&c!==D(1,e)||(h=M(32,e),h=M(u+(h-1),h),t!==h*o)?k.primitiveFail():(c=Er(c,l),S?null:(O(c,ae,u),O(c,se,o),O(c,12,e),O(c,14,h),O(c,ne,t),O(c,ce,i),wa(c,a),oa(c,r,s,n,u,o),c)))}function sa(e){var t=Oa(e);return t>f(yr)||(t=k.fetchPointerofObject(t,yr),f(t=k.fetchPointerofObject(0,t))!==h(e,ne))?null:t.wordsAsInt32Array()}function na(e,t,i,r,s,n,a){var o,u,l,c,h;if(r!==s||0!==n&&0!==a){if(e=6*e,i=i?(o=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[0+e],c=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[1+e],u=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[2+e],h=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[3+e],l=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[4+e],(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[5+e]):(o=0|t[0+e],c=0|t[1+e],u=0|t[2+e],h=0|t[3+e],l=0|t[4+e],0|t[5+e]),o===u&&c===h||u===l&&h===i)return o===l&&c===i?void 0:(w()[0]=o,w()[1]=c,C()[0]=l,C()[1]=i,gu(2),ma(n,w(),C(),a,r,s));w()[0]=o,w()[1]=c,C()[0]=u,C()[1]=h,A()[0]=l,A()[1]=i,gu(3),t=ta(w(),C(),A(),0!==n&&0!==a),S||da(n,a,r,s,t)}}function aa(e){var t=c[65];return f(e)<L?null:(Qs(t,k.fetchIntegerofObject(Z,e)),en(t,k.fetchIntegerofObject(J,e)),rn(t,k.fetchIntegerofObject(Y,e)),Zs(t,k.fetchIntegerofObject(X,e)),t)}function oa(e,t,i,r,s,n){var a,o,u,l,c;i[0]=i[0]+t[0],i[1]=i[1]+t[1],r[0]=r[0]+t[0],r[1]=r[1]+t[1],vu(t),vu(i),vu(r),o=i[0]-t[0],i=i[1]-t[1],c=r[0]-t[0],r=r[1]-t[1],o=0<(l=o*o+i*i)?(a=o*s*65536/l|0,i*s*65536/l|0):a=0,s=0<(i=c*c+r*r)?(u=c*n*65536/i|0,r*n*65536/i|0):u=0,l=t[0],O(e,Bt,l),c=t[1],O(e,Nt,c),O(e,Vt,a),O(e,jt,o),O(e,qt,u),O(e,Mt,s)}function ua(e){var t,i,r,s,n;if(k.isArray(e)){for(yr=e,s=0;s<=f(yr)-1;s++){if("number"==typeof(n=k.fetchPointerofObject(s,yr)))return;if(!k.isPointers(n))return;if(f(n)<5)return;if(q(t=k.fetchPointerofObject(0,n))!==k.classBitmap())return;if(t=f(t),r=k.fetchIntegerofObject(1,n),i=k.fetchIntegerofObject(2,n),n=k.fetchIntegerofObject(3,n),k.failed())return;if(!(0<=r&&0<=i))return;if(n=M(32,n),t!==M(r+(n-1),n)*i)return}return 1}}function la(e,t,i,r,s,n){var a,o,i=t[1]<=i[1]?(o=t,a=i,1):(o=i,a=t,-1);Qs(e,o[0]),en(e,o[1]-r),rn(e,Ds()),Gs(e,s),Js(e,n),t=a[0],O(e,Dt,t),o=a[1]-r,O(e,Rt,o),O(e,11,i)}function ca(e,t,i,r){for(var s,n,a,o,u,l,c,h,f,p=C()[0]-w()[0]>>1,d=C()[1]-w()[1]>>1,m=C()[0]+w()[0]>>1,v=C()[1]+w()[1]>>1,g=0;g<=15;g++){if(n=p,a=d,o=m,u=v,f=h=c=l=void 0,l=bs()[2*(s=g)+0]*n+o|0,h=ys()[2*s+0]*a+u|0,w()[0]=l,w()[1]=h,c=bs()[2*s+2]*n+o|0,f=ys()[2*s+2]*a+u|0,A()[0]=c,A()[1]=f,n=bs()[2*s+1]*n+o|0,o=ys()[2*s+1]*a+u|0,n=2*n-(l+c>>1),o=2*o-(h+f>>1),C()[0]=n,C()[1]=o,gu(3),s=ta(w(),C(),A(),0!==e&&0!==t),S)return;if(da(e,t,i,r,s),S)return}}function F(e,t){var i;return q(t)===k.classPoint()&&("number"==typeof(i=k.fetchPointerofObject(0,t))||i.isFloat)&&(e[0]="number"==typeof i?i:0|k.floatValueOf(i),"number"==typeof(i=k.fetchPointerofObject(1,t))||i.isFloat)?void(e[1]="number"==typeof i?i:0|k.floatValueOf(i)):k.primitiveFail()}function ha(){var e,t,i;return 2!==k.methodArgumentCount()?d:0!==(i=Io(k.stackValue(2)))?i:(t=k.stackObjectValue(0),e=k.stackObjectValue(1),k.failed()?p:0!==(i=fa(k.fetchPointerofObject(T,br)))?i:ia(k.fetchPointerofObject(B,br))?ua(k.fetchPointerofObject(N,br))?f(e)<L?je:f(t)<Q?Ee:(i=Ko())===yt||i===St||i===bt?Je:0:Le:xe)}function fa(e){return q(e)!==k.classBitmap()?Ve:(W=e.words,e=f(e)-1,c[ir]=e,0)}function pa(e,t,i){if(e.isNil)return!1;if("number"==typeof e)return k.primitiveFail();if(f(e)!==i)return k.primitiveFail();if(k.isWords(e)){var r,s,n=t,a=i;for(s=e.wordsAsFloat32Array(),r=0;r<=a-1;r++)n[r]=s[r]}else!function(e,t,i){for(var r,s=0;s<=i-1;s++){if("number"!=typeof(r=k.fetchPointerofObject(s,e))&&!r.isFloat)return k.primitiveFail();t[s]="number"==typeof r?r:k.floatValueOf(r)}}(e,t,i);return!0}function da(e,t,i,r,s){for(var n,a,o,u,l,c,h,f,p=0===e||0===t?(a=!1,0):(a=!0,e>>1),d=6*s;0<d;){if(n=a?(f=void 0,Rr(Ie)?(b=(f=b)+Ie,Pa(f,ht),wa(f,0),Ca(f,Ie),f):0):(f=void 0,Rr(re)?(b=(f=b)+re,Pa(f,rt),wa(f,0),Ca(f,re),f):0),S)return;o=n,l=i,c=r,h=p,as(u=d)>=cs(u)?(Qs(o,us(u)),en(o,cs(u)-h),Qr(o,fs(u)),$r(o,ds(u)-h),Hr(o,ss(u)),Xr(o,as(u)-h)):(Qs(o,ss(u)),en(o,as(u)-h),Qr(o,fs(u)),$r(o,ds(u)-h),Hr(o,us(u)),Xr(o,cs(u)-h)),rn(o,Ds()),Gs(o,l),Js(o,c),a&&(O(n,Se,t),Vu(n,e),O(n,ye,e)),d-=6}Su()}function ma(e,t,i,r,s,n){var a,o=0===e||0===r?(a=Rr(Lt)?(b=(a=b)+Lt,Pa(a,ut),wa(a,0),Ca(a,Lt),a):0,0):(a=Rr(Zt)?(b=(o=b)+Zt,Pa(o,ft),wa(o,0),Ca(o,Zt),o):0,e>>1);if(S)return 0;la(a,t,i,o,s,n),Hn(a)&&(O(a,Xt,r),Eu(a,e),O(a,Gt,e))}function va(e){return"number"==typeof e?We:k.isWords(e)?f(e)<Ki?Ke:(Lu(e),c[zi]!==Ui?Re:yu()!==f(e)?He:Sa()!==Li?Ue:(Fr=o(c,Sa()),g=o(Fr,Ia()),n=o(g,Vn()),Li+Ia()+Vn()+Mr()>yu()?Ge:0)):ze}function ga(e){0===strcmp(e,mr)&&(vr=Sr=0)}function ka(e){return!(Li+b+Vn()+Mr()+e>wu()&&($o(xt),1))}function ba(){return 0!==c[Hi]}function ya(e){c[Hi]=e}function h(e,t){return Fr[e+t]}function O(e,t,i){return Fr[e+t]=i}function Sa(){return c[Gi]}function Ia(){return c[Xi]}function Fa(e){c[Xi]=e}function Oa(e){return h(e,et)}function wa(e,t){O(e,et,t)}function Ca(e,t){O(e,tt,t)}function Aa(e){return h(e,it)&lt}function Pa(e,t){return O(e,it,t)}function w(){return o(c,Zi)}function C(){return o(c,Ji)}function A(){return o(c,Yi)}function _a(){return o(c,Qi)}function xa(){_n()>=Vn()&&0===Mr()&&x(vt),H()>=hn()&&x(vt)}function Va(){var e;return 0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(0)))?k.primitiveFailFor(e):(x(vt),void V())}function ja(){var e;return m&&(v=k.ioMicroMSecs()),1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),yt))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),k.failed()?k.primitiveFailFor(p):(e=aa(e))?ka(1)?(0<Xs(e)&&Wn(e),S?k.primitiveFailFor(u):(x(dt),V(),k.pop(1),void(m&&(I(ki,1),I(ar,k.ioMicroMSecs()-v))))):k.primitiveFailFor(Ge):k.primitiveFailFor(je))}function qa(){var e,t,i,r,s,n;return 5!==k.methodArgumentCount()?k.primitiveFailFor(d):(r=k.positive32BitValueOf(k.stackValue(0)),t=k.positive32BitValueOf(k.stackValue(1)),n=k.stackObjectValue(2),e=k.stackObjectValue(3),s=k.stackObjectValue(4),k.failed()?k.primitiveFailFor(p):0!==(i=P(k.stackValue(5),l))?k.primitiveFailFor(i):Kn(t)&&Kn(r)?(F(w(),s),F(C(),n),F(A(),e),k.failed()?k.primitiveFailFor(p):(gu(3),ka((i=ta(w(),C(),A(),!1))*re),S||(t=j(t),r=j(r)),S||da(0,0,t,r,i),S?(Su(),k.primitiveFailFor(u)):k.failed()?k.primitiveFailFor(Te):(V(),void k.pop(5)))):k.primitiveFailFor(Ze))}function Ma(){var e,t,i,r,s,n,a;if(5!==k.methodArgumentCount())return k.primitiveFailFor(d);if(i=k.positive32BitValueOf(k.stackValue(0)),r=k.stackIntegerValue(1),e=k.positive32BitValueOf(k.stackValue(2)),s=k.stackIntegerValue(3),n=k.stackObjectValue(4),k.failed())return k.primitiveFailFor(p);if(0!==(t=P(k.stackValue(5),l)))return k.primitiveFailFor(t);if(t=f(n),k.isWords(n)){if(a=!1,t!==3*s&&t!==6*s)return k.primitiveFailFor(p)}else{if(!k.isArray(n))return k.primitiveFailFor(p);if(t!==3*s)return k.primitiveFailFor(p);a=!0}return ka((0===r||0===i?Lt:Zt)*s)?Kn(i)&&Kn(e)?(i=j(i),e=j(e),S?k.primitiveFailFor(u):0!==i&&0!==r||0!==e?(0!==r&&(r=ku(r))<1&&(r=1),a?function(e,t,i,r,s){for(var n,a,o,u,l,c,h=0;h<=t-1;h++){if(n=k.fetchPointerofObject(3*h,e),F(w(),n),n=k.fetchPointerofObject(3*h+1,e),F(C(),n),n=k.fetchPointerofObject(3*h+2,e),F(A(),n),k.failed())return;if(gu(3),n=w()[0],u=w()[1],a=C()[0],l=C()[1],o=A()[0],c=A()[1],n===u&&a===l||a===o&&l===c)ma(r,w(),A(),s,i,0);else{if(n=ta(w(),C(),A(),0!==r&&0!==s),S)return;da(r,s,i,0,n)}if(S)return}}(n,s,e,r,i):function(e,t,i,r,s,n){for(var a=1;a<=t;a++)if(na(a-1,e,n,i,0,r,s),S)return}(n.wordsAsInt32Array(),s,e,r,i,3*s===t),S?k.primitiveFailFor(u):k.failed()?k.primitiveFailFor(Te):(ya(1),V(),void k.pop(5))):k.pop(5)):k.primitiveFailFor(Ze):k.primitiveFailFor(Ge)}function Ba(){var e,t,i,r,s,n,a,o;return 7!==k.methodArgumentCount()?k.primitiveFailFor(d):(o=k.stackIntegerValue(0))<=0||(s=k.stackObjectValue(1),t=k.stackObjectValue(2),n=k.stackObjectValue(3),a=k.booleanValueOf(k.stackValue(4)),e=k.stackObjectValue(5),r=k.stackObjectValue(6),k.failed())?k.primitiveFailFor(p):0!==(i=P(k.stackValue(7),l))?k.primitiveFailFor(i):(F(w(),n),F(C(),t),F(A(),s),k.failed()?k.primitiveFailFor(_e):(i=ra(r,e,a?1:0,w(),C(),A(),o-1),S?k.primitiveFailFor(u):k.failed()?k.primitiveFailFor(Te):(V(),void k.popthenPush(8,k.positive32BitIntegerFor(i)))))}function Na(){var e,t,i,r,s,n,a,o;return 7!==k.methodArgumentCount()?k.primitiveFailFor(d):(e=k.stackObjectValue(0),i=k.stackObjectValue(1),r=k.stackObjectValue(2),o=k.stackObjectValue(3),t=k.stackObjectValue(4),s=k.stackIntegerValue(5),n=k.stackObjectValue(6),k.failed()?k.primitiveFailFor(p):0!==(a=P(k.stackValue(7),l))?k.primitiveFailFor(a):gs(n,s,t,o,r,i,e)?ka(Math.max(re,Lt)*s)?(a=f(n)===3*s,function(e,t,i,r,s,n,a,o){var u,l,c,h,f,p,d,m,v,g,k,b,y;if(0!==t)for(c=v=b=p=-1,h=g=y=d=0,u=l=m=k=f=1;u<=t;u++){if(--l<=0&&(l=_o(++c,i),0!==(h=xo(c,i)))&&(h=j(h=a[h-1]),S))return;if(na(u-1,e,o,h,g=--m<=0&&(m=_o(++v,r),0!==(g=xo(v,r)))?j(g=a[g-1]):g,y=--k<=0&&(k=_o(++b,s),0!==(y=xo(b,s)))?ku(y):y,d=--f<=0&&(f=_o(++p,n),0!==(d=xo(p,n)))?a[d-1]:d),S)return}}(n.wordsAsInt32Array(),s,t.wordsAsInt32Array(),o.wordsAsInt32Array(),r.wordsAsInt32Array(),i.wordsAsInt32Array(),e.wordsAsInt32Array(),a),S?k.primitiveFailFor(u):k.failed()?k.primitiveFailFor(Te):(ya(1),V(),void k.pop(7))):k.primitiveFailFor(Ge):k.primitiveFailFor(Ne))}function Ta(){var e,t,i,r,s,n;return 5!==k.methodArgumentCount()?k.primitiveFailFor(d):(n=k.booleanValueOf(k.stackValue(0)),r=k.stackValue(1),i=k.stackValue(2),t=k.stackValue(3),s=k.stackValue(4),k.failed()?k.primitiveFailFor(p):0!==(e=P(k.stackValue(5),l))?k.primitiveFailFor(e):(F(w(),t),F(C(),i),F(A(),r),k.failed()?k.primitiveFailFor(_e):(e=s,t=w(),i=C(),r=A(),s=n,s=q(e)!==k.classBitmap()?k.primitiveFail():(n=f(e),e=Dr(e.wordsAsInt32Array(),n,s),S?null:(oa(e,t,i,r,n,n),e)),S?k.primitiveFailFor(u):k.failed()?k.primitiveFailFor(Te):(V(),void k.popthenPush(6,k.positive32BitIntegerFor(s))))))}function Ea(){var e,t,i,r,s;return 4!==k.methodArgumentCount()?k.primitiveFailFor(d):(r=k.positive32BitValueOf(k.stackValue(0)),i=k.positive32BitValueOf(k.stackValue(1)),e=k.stackObjectValue(2),s=k.stackObjectValue(3),k.failed()?k.primitiveFailFor(p):0!==(t=P(k.stackValue(4),l))?k.primitiveFailFor(t):Kn(i)&&Kn(r)?(F(w(),s),F(C(),e),k.failed()?k.primitiveFailFor(_e):(gu(2),i=j(i),r=j(r),S||(ma(0,w(),C(),0,i,r),S)?k.primitiveFailFor(u):k.failed()?k.primitiveFailFor(Te):(V(),void k.pop(4)))):k.primitiveFailFor(Ze))}function La(){var e,t,i,r,s,n;return 5!==k.methodArgumentCount()?k.primitiveFailFor(d):(e=k.positive32BitValueOf(k.stackValue(0)),t=k.stackIntegerValue(1),s=k.positive32BitValueOf(k.stackValue(2)),i=k.stackObjectValue(3),n=k.stackObjectValue(4),k.failed()?k.primitiveFailFor(p):0!==(r=P(k.stackValue(5),l))?k.primitiveFailFor(r):Kn(e)&&Kn(s)?(s=j(s),e=j(e),S?k.primitiveFailFor(u):0===s&&(0===e||t<=0)?k.pop(5):ka(16*re)?(t=0<t&&0!==e?ku(t):0,F(w(),n),F(C(),i),k.failed()?k.primitiveFailFor(_e):(ca(t,e,0,s),S?(Su(),k.primitiveFailFor(u)):k.failed()?k.primitiveFailFor(Te):(ya(1),V(),void k.pop(5)))):k.primitiveFailFor(Ge)):k.primitiveFailFor(Ze))}function Da(){var e,t,i,r,s,n,a;if(5!==k.methodArgumentCount())return k.primitiveFailFor(d);if(i=k.positive32BitValueOf(k.stackValue(0)),r=k.stackIntegerValue(1),e=k.positive32BitValueOf(k.stackValue(2)),s=k.stackIntegerValue(3),n=k.stackObjectValue(4),k.failed())return k.primitiveFailFor(p);if(0!==(t=P(k.stackValue(5),l)))return k.primitiveFailFor(t);if(t=f(n),k.isWords(n)){if(a=!1,t!==s&&2*s!==t)return k.primitiveFailFor(p)}else{if(!k.isArray(n))return k.primitiveFailFor(p);if(t!==s)return k.primitiveFailFor(p);a=!0}return ka((0===r||0===i?Lt:Zt)*s)?Kn(i)&&Kn(e)?(i=j(i),e=j(e),S?k.primitiveFailFor(u):0!==i&&0!==r||0!==e?(0!==r&&(r=ku(r)),a?function(e,t,i,r,s){var n,a,o,u,l;if(F(w(),k.fetchPointerofObject(0,e)),!k.failed())for(a=w()[0],u=w()[1],n=1;n<=t-1;n++){if(F(w(),k.fetchPointerofObject(n,e)),k.failed())return;if(o=w()[0],l=w()[1],w()[0]=a,w()[1]=u,C()[0]=o,C()[1]=l,gu(2),ma(r,w(),C(),s,i,0),S)return;a=o,u=l}}(n,s,e,r,i):function(e,t,i,r,s,n){for(var a,o,u,l=n?(a=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[0],(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[1]):(a=0|e[0],0|e[1]),c=1;c<=t-1;c++){if(u=n?(o=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*c],(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*c+1]):(o=0|e[2*c],0|e[2*c+1]),w()[0]=a,w()[1]=l,C()[0]=o,C()[1]=u,gu(2),ma(r,w(),C(),s,i,0),S)return;a=o,l=u}}(n.wordsAsInt32Array(),s,e,r,i,s===t),S?k.primitiveFailFor(u):k.failed()?k.primitiveFailFor(Te):(ya(1),V(),void k.pop(5))):k.pop(5)):k.primitiveFailFor(Ze):k.primitiveFail()}function Ra(){var e,t,i,r,s,n;return 5!==k.methodArgumentCount()?k.primitiveFailFor(d):(i=k.positive32BitValueOf(k.stackValue(0)),e=k.stackIntegerValue(1),t=k.positive32BitValueOf(k.stackValue(2)),n=k.stackObjectValue(3),s=k.stackObjectValue(4),k.failed()?k.primitiveFailFor(p):0!==(r=P(k.stackValue(5),l))?k.primitiveFailFor(r):Kn(i)&&Kn(t)?(i=j(i),t=j(t),S?k.primitiveFailFor(u):0!==t||0!==i&&0!==e?ka(4*Lt)?(e=0<e&&0!==i?ku(e):0,F(w(),s),F(A(),n),k.failed()?k.primitiveFailFor(_e):(C()[0]=A()[0],C()[1]=w()[1],_a()[0]=w()[0],_a()[1]=A()[1],gu(4),r=i,s=0,n=t,ma(i=e,w(),C(),r,s,n),ma(i,C(),A(),r,s,n),ma(i,A(),_a(),r,s,n),ma(i,_a(),w(),r,s,n),k.failed()?k.primitiveFailFor(Te):(ya(1),V(),void k.pop(5)))):k.primitiveFailFor(Ge):k.pop(5)):k.primitiveFailFor(Ze))}function Wa(){var e;return m&&(v=k.ioMicroMSecs()),1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),bt))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),k.failed()?k.primitiveFailFor(p):(e=aa(e))?(0===Xs(e)?Oo():(Co(),qr(a()+1)),x(kt),V(),k.pop(1),void(m&&(I(bi,1),I(or,k.ioMicroMSecs()-v)))):k.primitiveFailFor(je))}function za(){var e,t,i,r,s,n,a;if(2!==k.methodArgumentCount())return k.primitiveFailFor(d);if(e=k.stackValue(0),0!==(r=va(t=k.stackValue(1))))return k.primitiveFailFor(r);if(q(t)!==q(e))return k.primitiveFailFor(Ve);if((t=f(e)-f(t))<0)return k.primitiveFailFor(De);for(n=c,i=e.wordsAsInt32Array(),s=0,a=wu()-1;s<=a;s++)i[s]=n[s];for(i[hi]=wu()+t,i[$i]=yu()+t,n=o(n,wu()),i=o(i,wu()+t),s=0,a=yu()-wu()-1;s<=a;s++)i[s]=n[s];if(0!==(r=va(e)))return k.primitiveFailFor(r);k.pop(2)}function Ua(){var e;return m&&(v=k.ioMicroMSecs()),0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(0),mt))||0!==(e=fa(k.fetchPointerofObject(T,br)))?k.primitiveFailFor(e):ia(k.fetchPointerofObject(B,br))?((H()&Pr())===Pr()&&(Us(H()),xa()),wn()||(qr(0),Ls(H()+1),x(kt)),V(),void(m&&(I(yi,1),I(ur,k.ioMicroMSecs()-v)))):k.primitiveFailFor(xe)}function Ka(){var e=m,t=k.stackObjectValue(0);t=k.booleanValueOf(t),k.failed()||(m=t,k.pop(2),k.pushBool(e))}function Ha(){var e;return m&&(v=k.ioMicroMSecs()),0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(0)))?k.primitiveFailFor(e):(e=wn(),V(),k.pop(1),k.pushBool(e),void(m&&(I(Si,1),I(lr,k.ioMicroMSecs()-v))))}function Ga(){var e;return 0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(0)))?k.primitiveFailFor(e):(k.pop(1),void k.pushInteger(U()))}function Xa(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(1)))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),!k.failed()&&k.isWords(e)&&4<=f(e)?((e=e.wordsAsInt32Array())[0]=e[0]+c[li],e[1]=e[1]+c[oi],e[2]=e[2]+c[ci],e[3]=e[3]+c[ui],void k.pop(1)):k.primitiveFailFor(p))}function Za(){var e,t;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(t=Io(k.stackValue(1)))?k.primitiveFailFor(t):(t=k.stackObjectValue(0),!k.failed()&&k.isPointers(t)&&2<=f(t)?(k.pushRemappableOop(t),e=k.makePointwithxValueyValue(_s(),Vs()),k.storePointerofObjectwithValue(0,k.topRemappableOop(),e),e=k.makePointwithxValueyValue(ws(),As()),t=k.popRemappableOop(),k.storePointerofObjectwithValue(1,t,e),void k.popthenPush(2,t)):k.primitiveFailFor(p))}function Ja(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(1)))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),!k.failed()&&k.isWords(e)&&9<=f(e)?((e=e.wordsAsInt32Array())[0]=e[0]+c[Ii],e[1]=e[1]+c[Si],e[2]=e[2]+c[Ci],e[3]=e[3]+c[ki],e[4]=e[4]+c[wi],e[5]=e[5]+c[Fi],e[6]=e[6]+c[yi],e[7]=e[7]+c[Oi],e[8]=e[8]+c[bi],void k.pop(1)):k.primitiveFailFor(p))}function Ya(){var e;return 0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(0)))?k.primitiveFailFor(e):(k.pop(1),void k.pushInteger(Ds()))}function Qa(){var e;return 0!==k.methodArgumentCount()?k.primitiveFailFor(d):"number"==typeof(br=k.stackValue(0))?k.primitiveFailFor(qe):k.isPointers(br)?f(br)<r?k.primitiveFailFor(Be):0!==(e=va(k.fetchPointerofObject(E,br)))?k.primitiveFailFor(e):(k.pop(1),void k.pushInteger(eu())):k.primitiveFailFor(Me)}function $a(){var e;return 0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(0)))?k.primitiveFailFor(e):(e=k.makePointwithxValueyValue(Ws(),zs()),void k.popthenPush(1,e))}function eo(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(1)))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),!k.failed()&&k.isWords(e)&&9<=f(e)?((e=e.wordsAsInt32Array())[0]=e[0]+c[cr],e[1]=e[1]+c[lr],e[2]=e[2]+c[dr],e[3]=e[3]+c[ar],e[4]=e[4]+c[pr],e[5]=e[5]+c[hr],e[6]=e[6]+c[ur],e[7]=e[7]+c[fr],e[8]=e[8]+c[or],void k.pop(1)):k.primitiveFailFor(p))}function to(){var e,t;return 1!==k.methodArgumentCount()?k.primitiveFail():(e=k.stackObjectValue(0),k.failed()?null:!k.isWords(e)||(t=f(e))<Ki?k.primitiveFail():(Lu(e),Fr=o(c,Li),c[zi]=Ui,c[$i]=t,Cu(t),x(l),c[Gi]=Li,Fa(4),Pa(0,at),Ca(0,4),wa(0,0),xn(0),jn(0),qr(0),Br(0),tu(0),ya(0),xs(0),Cs(0),js(0),Ps(0),Rs(0),c[cr]=0,c[lr]=0,c[dr]=0,c[ar]=0,c[pr]=0,c[hr]=0,c[ur]=0,c[fr]=0,c[or]=0,c[Ii]=0,c[Si]=0,c[Ci]=0,c[ki]=0,c[wi]=0,c[Fi]=0,c[yi]=0,c[Oi]=0,c[bi]=0,c[li]=0,c[oi]=0,c[ci]=0,c[ui]=0,(t=Ys())[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,En(t[5]=0),(t=qs())[0]=1,t[1]=0,t[2]=1,t[3]=0,t[4]=1,t[5]=0,t[6]=1,Nn(t[7]=0),k.pop(2),void k.push(e)))}function io(){var e;return m&&(v=k.ioMicroMSecs()),0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(0),l))||0!==(e=fa(k.fetchPointerofObject(T,br)))?k.primitiveFailFor(e):(Rn(),S?k.primitiveFailFor(u):(x(dt),k.failed()||V(),void(m&&(I(Ii,1),I(cr,k.ioMicroMSecs()-v)))))}function ro(){var e;if(m&&(v=k.ioMicroMSecs()),2!==k.methodArgumentCount())return k.primitiveFailFor(d);if(0!==(o=P(k.stackValue(2),St)))return k.primitiveFailFor(o);if(0!==(o=fa(k.fetchPointerofObject(T,br))))return k.primitiveFailFor(o);if(o=k.stackObjectValue(0),e=k.stackObjectValue(1),k.failed()||q(e)!==k.classBitmap())return k.primitiveFailFor(p);if(f(o)<Q)return k.primitiveFailFor(Ee);if(u=k.fetchIntegerofObject($,o),Oa(Gn())!==u)return k.primitiveFailFor(Ze);if(u=k.fetchIntegerofObject(te,o),Xn()!==u)return k.primitiveFailFor(Ze);if(u=k.fetchIntegerofObject(ee,o),Zn()!==u)return k.primitiveFailFor(Ze);if(f(e)<Zn()-Xn())return k.primitiveFailFor(p);if(k.failed())return null;var t,i,r,s,n,a=e.wordsAsInt32Array(),o=Xn(),u=Zn(),l=o,c=u,h=-1;if(1===U())for(;l<c;)s=0|a[++h],W[l]=s,++l;else for(i=z(),r=wr(),t=K();l<c;)n=R(l,t),s=R((s=0|a[++h])&i,r),W[n]=W[n]+s,++l;c>Mo()&&Bo(c),c>jo()&&qo(c),x(gt),V(),k.pop(2),m&&(I(Fi,1),I(hr,k.ioMicroMSecs()-v))}function so(){var e;return 0!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(0)))?k.primitiveFailFor(e):(e=ba(),V(),k.pop(1),void k.pushBool(e))}function no(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=Io(k.stackValue(1)))?k.primitiveFailFor(e):(e=k.booleanValueOf(k.stackValue(0)),k.failed()?k.primitiveFailFor(p):(ya(!0===e?1:0),V(),void k.pop(1)))}function ao(){var e,t,i;return m&&(v=k.ioMicroMSecs()),1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=k.stackValue(1),t=kt,i=vt,t=0===(e=Io(e))?Ko()!==t&&Ko()!==i?(tu(Ct),Je):0:e)?k.primitiveFailFor(t):(i=k.stackObjectValue(0),k.failed()?k.primitiveFailFor(p):(e=!1,Ko()!==vt&&((e=Fn())?(iu(n[a()],i),x(bt)):x(dt)),k.failed()?null:(V(),k.pop(2),k.pushBool(!e),void(m&&(I(Oi,1),I(fr,k.ioMicroMSecs()-v))))))}function oo(){var e,t;return m&&(v=k.ioMicroMSecs()),1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),gt))||0!==(e=fa(k.fetchPointerofObject(T,br)))?k.primitiveFailFor(e):ua(k.fetchPointerofObject(N,br))?(0!==Fs()&&(0==(H()&Pr())&&Is(),Os(0)),e=k.stackObjectValue(0),t=In(),S?k.primitiveFailFor(u):(t&&ru(e),k.failed()?k.primitiveFailFor(Ze):(t?x(St):(Su(),qo(0),x(mt)),V(),k.pop(2),k.pushBool(!t),void(m&&(I(wi,1),I(pr,k.ioMicroMSecs()-v)))))):k.primitiveFailFor(Le)}function uo(){var e,t;return m&&(v=k.ioMicroMSecs()),1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),dt))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),(t=Sn())&&(iu(g[_n()],e),xn(_n()+1)),k.failed()?k.primitiveFailFor(Xe):(t?x(yt):(x(gt),Os(1),qr(0),Su()),V(),k.pop(2),k.pushBool(!t),void(m&&(I(Ci,1),I(dr,k.ioMicroMSecs()-v)))))}function lo(){var e,t,i,r,s,n,a;return 6!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(a=P(k.stackValue(6),l))?k.primitiveFailFor(a):(a=k.positive32BitValueOf(k.stackValue(0)),n=k.positive32BitValueOf(k.stackValue(1)),s=k.stackIntegerValue(2),r=k.stackIntegerValue(3),i=k.stackIntegerValue(4),t=k.stackIntegerValue(5),k.failed()?k.primitiveFailFor(p):Rr(we)?Kn(n)&&Kn(a)?(b=(e=b)+we,Pa(e,st),Ca(e,we),wa(e,t),Qs(e,i),en(e,r),rn(e,s),Gs(e,j(n)),Js(e,j(a)),S?k.primitiveFailFor(u):void(k.failed()||(V(),k.pop(6)))):k.primitiveFailFor(Ze):k.primitiveFailFor(Ge))}function co(){var e,t,i;if(1!==k.methodArgumentCount())return k.primitiveFailFor(d);if(0!==(e=P(k.stackValue(1),l)))return k.primitiveFailFor(e);if(i=k.stackIntegerValue(0),k.failed())return k.primitiveFailFor(p);for(t=0;0===t;){if(!Rr(we))return k.primitiveFailFor(Ge);b=(t=b)+Ce,Pa(t,at),Ca(t,Ce),wa(t,i)}k.failed()||(V(),k.pop(2),k.pushInteger(t))}function ho(){var e;return 0!==(e=ha())?k.primitiveFailFor(e):(So(),S?su():(function(){var e;for(;!wn();){if(m&&(v=k.ioMicroMSecs()),e=Sn(),m&&(I(Ci,1),I(dr,k.ioMicroMSecs()-v)),S)return x(dt);if(e)return x(yt),$o(Pt);if(qr(0),Su(),Os(1),m&&(v=k.ioMicroMSecs()),0!==Fs()&&0==(H()&Pr())&&Is(),Os(0),e=In(),m&&(I(wi,1),I(pr,k.ioMicroMSecs()-v)),S)return x(gt);if(e)return x(St),$o(At);if(Su(),qo(0),m&&(v=k.ioMicroMSecs()),(H()&Pr())===Pr()&&(Us(H()),xa()),m&&(I(yi,1),I(ur,k.ioMicroMSecs()-v)),S)return x(mt);if(wn())return;if(qr(0),Ls(H()+1),m&&(v=k.ioMicroMSecs()),e=Fn(),m&&(I(Oi,1),I(fr,k.ioMicroMSecs()-v)),S)return x(kt);if(e)return x(bt),$o(wt)}}(),void su()))}function fo(){var e;if(0!==(e=ha()))return k.primitiveFailFor(e);So(),su()}function po(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),l))?k.primitiveFailFor(e):(e=k.stackIntegerValue(0),k.failed()?k.primitiveFailFor(p):(Ao(e),V(),void k.pop(1)))}function mo(){var e=k.stackValue(0);if(!k.isBytes(e))return k.primitiveFail();if(256<=((t=e).bytes?t.bytes.length:t.words?4*t.words.length:0))return k.primitiveFail();e.bytes;var t=!1,e=e.bytesAsString();if(e!==mr&&(mr=e,t=!0),t&&!Dn())return k.primitiveFail();k.pop(1)}function vo(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),l))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),!(!k.failed()&&k.isPointers(e)&&2<=f(e))||(F(w(),k.fetchPointerofObject(0,e)),F(C(),k.fetchPointerofObject(1,e)),k.failed())?k.primitiveFailFor(p):(xs(w()[0]),js(w()[1]),Cs(C()[0]),Ps(C()[1]),V(),void k.pop(1)))}function go(){var e,t;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),l))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),k.failed()?k.primitiveFailFor(p):(e=e,t=qs(),Nn(0),pa(e,t,8)&&(Nn(1),t[1]=256*t[1],t[3]=256*t[3],t[5]=256*t[5],t[7]=256*t[7]),k.failed()?k.primitiveFailFor(Te):(V(),void k.pop(1))))}function ko(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),l))?k.primitiveFailFor(e):(e=k.stackIntegerValue(0),k.failed()?k.primitiveFailFor(p):(Rs(e),V(),void k.pop(1)))}function bo(){var e,t;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),l))?k.primitiveFailFor(e):(e=k.stackObjectValue(0),k.failed()||(e=e,En(0),t=pa(e,e=Ys(),6),k.failed()||t&&(En(1),e[2]=e[2]+Ws(),e[5]=e[5]+zs()),k.failed())?k.primitiveFailFor(p):(V(),void k.pop(1)))}function yo(){var e;return 1!==k.methodArgumentCount()?k.primitiveFailFor(d):0!==(e=P(k.stackValue(1),l))?k.primitiveFailFor(e):q(e=k.stackValue(0))!==k.classPoint()||(F(w(),e),k.failed())?k.primitiveFailFor(p):(e=w()[0],c[_i]=e,e=w()[1],c[xi]=e,V(),void k.pop(1))}function So(){var e,t=Ko();if(t===l){if(Rn(),S)return;t=dt}if(t===dt){if(m&&(v=k.ioMicroMSecs()),e=Sn(),m&&(I(Ci,1),I(dr,k.ioMicroMSecs()-v)),S)return x(dt);if(e)return x(yt),$o(Pt);qr(0),Su(),Os(1),t=gt}if(t===gt){if(m&&(v=k.ioMicroMSecs()),0!==Fs()&&0==(H()&Pr())&&Is(),Os(0),e=In(),m&&(I(wi,1),I(pr,k.ioMicroMSecs()-v)),S)return x(gt);if(e)return x(St),$o(At);t=mt,Su(),qo(0)}if(t===mt){if(m&&(v=k.ioMicroMSecs()),(H()&Pr())===Pr()&&(Us(H()),xa()),m&&(I(yi,1),I(ur,k.ioMicroMSecs()-v)),S)return x(mt);if(wn())return;t=kt,qr(0),Ls(H()+1)}if(t===kt)return m&&(v=k.ioMicroMSecs()),e=Fn(),m&&(I(Oi,1),I(fr,k.ioMicroMSecs()-v)),S?x(kt):e?(x(bt),$o(wt)):void x(dt)}function Io(e){return k.failed()?Pe:"number"==typeof e?qe:k.isPointers(e)?f(e)<r?Be:(br=e,0!==(e=va(k.fetchPointerofObject(E,e)))?e:(tu(0),b=Ia(),S=!1,0)):Me}function P(e,t){return 0!==(e=Io(e))?e:Ko()===t?0:(tu(Ct),Je)}function Fo(e){if(0!==s())for(;mu()<=e;)if(Ln(uu(),0===s()?-1:lu()),0===s())return}function Oo(){var e=a();for(Br(Mr()-1);e<Mr();)n[e]=n[e+1],++e}function wo(e,t){for(var i=e;i<0;)i+=t;for(;t<=i;)i-=t;return i}function Co(){var e;if(0!==a()&&(e=y(t=n[a()]),!(y(n[a()-1])<=e))){for(var t,i=a(),r=e,s=i;0<s&&y(n[s-1])>r;)n[s]=n[s-1],--s;n[s]=t}}function Ao(e){var t;4<=e&&(t=4),2<=e&&e<4&&(t=2),e=t=e<2?1:t,c[ii]=e,1===t&&(xr(0),Or(4294967295),_r(0)),2===t&&(xr(1),Or(4244438268),_r(1)),4===t&&(xr(2),Or(4042322160),_r(3)),e=2*K(),c[ei]=e,t=K(),c[ti]=t}function Po(e){return!1!=((k=e).majorVersion()==t)&&k.minorVersion()>=i}function _o(e,t){return(0|t[e])>>>16}function xo(e,t){return 65535&(0|t[e])}function Vo(e,t,i){Wr()&&(Uo(0,e),Do(0,t),Wo(0,i),3!==s())&&bn(0,s()-3)&&(Uo(0,pu()),Do(0,lu()),Wo(0,hu()),du(e),cu(t),fu(i))}function jo(){return c[tr]}function qo(e){c[tr]=e}function Mo(){return c[er]}function Bo(e){c[er]=e}function No(){return c[ir]}function To(){return c[rr]}function Eo(e){c[rr]=e}function _(e,t){return e*e+t*t}function Lo(e){return Fu(e+1)}function Do(e,t){return Ou(e+1,t)}function Ro(e){return Fu(e+2)}function Wo(e,t){return Ou(e+2,t)}function zo(e){return Fu(e)}function Uo(e,t){return Ou(e,t)}function Ko(){return c[sr]}function x(e){return c[sr]=e}function Ho(e,t){var i,r,s,n,a,o,u,l,c;if(!Hn(e)&&t>=Gr(e))return Zs(e,0);a=y(e),o=$s(e),c=h(e,12),u=h(e,13),l=2*(c-a),c=a+Kr(e)-2*c,s=2*(u-o),u=o+(i=Gr(e))-2*u,n=M(16777216,n=(n=2*(i=i-o))<2?2:n),r=l*(l=n),r+=(l=c*(c=((c=65535&l)*c>>>16)+c*(l=l>>>16&255)*2+(l*l<<16)>>>8)*2)>>1,s=s*n,s+=(n=u*c*2)>>1,Zs(e,i),(u=Yr(e))[ve]=256*a,u[ge]=256*o,u[pe]=r,u[de]=s,u[he]=l,u[fe]=n,(o=$s(e))!==t&&(Zo(e,t),Zs(e,i-(t-o)))}function Go(e,t){var i,r,s,n,a,o,u;if(!Hn(e)&&t>=Yn(e))return Zs(e,0);if(u=Jn(e)-y(e),i=Yn(e)-$s(e),s=0<=u?(a=1,n=u,0):(a=-1,n=0-u,1-i),u=0==i?(o=u,s=0):n<i?(o=0,n):(o=M(n,i)*a,n-M(n,u=i)*u|0),Zs(e,i),O(e,Yt,a),O(e,Qt,o),Qn(e,s),O(e,Ut,u),O(e,zt,i),(s=$s(e))!==t){for(r=s;r<=t-1;r++)Jo(e);Zs(e,i-(t-s))}}function Xo(e,t){for(var i=e[ve],r=e[ge],s=e[pe],n=e[de],a=256*t;r<a&&0<=n;)i+=s+32768>>16,r+=n+32768>>16,s+=e[he],n+=e[fe];return e[ve]=i,e[ge]=r,e[pe]=s,e[de]=n,i>>8}function Zo(e,t){Qs(e,Xo(Yr(e),t))}function Jo(e){var t,i=y(e)+ea(e);0<(t=h(e,Wt)+h(e,Ut))&&(i+=$n(e),t-=h(e,zt)),Qn(e,t),Qs(e,i)}function Yo(e,t){var i=_u(e),r=i>>1,s=h(e,ke)+1,n=h(e,be)+1;Au(e,s),Pu(e,n),r<=s&&Hs(e),0<=n&&Ks(e),n+r<0?Xo(Yr(e),t):Yr(e)[ve]=256*Zr(e),Xo(xu(e),t),Ts(e,i)}function Qo(e){var t,i,r,s,n,a,o=ju(e)+1,u=Mu(e)+1;qu(e,o),Bu(e,u),(i=(t=Nu(e))>>1)<=o&&Hs(e),0<=u&&Ks(e),r=y(e),Jo(e),s=y(e),(o<=t||0<=u+i)&&(o=r,t=s,i=ju(u=e),r=Mu(u),s=Nu(u),e=s>>1,n=Tu(u),a=$n(u),t-=o,i<s&&(a<0?n-=t:(n+=t,Qs(u,o))),r+e===0&&(0<a?n-=ea(u):(n+=ea(u),Qs(u,o))),0<r+e&&(a<0?(n+=t,Qs(u,o)):n-=t),Eu(u,n))}function $o(e){tu(e),S=!0}function eu(){return c[nr]}function tu(e){c[nr]=e}function iu(e,t){if(f(t)<L)return k.primitiveFail();k.storeIntegerofObjectwithValue(G,t,Oa(e)),k.storeIntegerofObjectwithValue(Z,t,y(e)),k.storeIntegerofObjectwithValue(J,t,H()),k.storeIntegerofObjectwithValue(Y,t,tn(e)),k.storeIntegerofObjectwithValue(X,t,Xs(e)),c[65]=e}function V(){Fa(b)}function ru(e){var t=Gn(),i=Xn(),r=Zn();if(f(e)<Q)return k.primitiveFail();k.storeIntegerofObjectwithValue($,e,Oa(t)),k.storeIntegerofObjectwithValue(te,e,i),k.storeIntegerofObjectwithValue(ee,e,r),k.storeIntegerofObjectwithValue(ie,e,H())}function su(){if(k.failed())return null;var e,t,i;S&&(e=k.stackObjectValue(1),t=k.stackObjectValue(0),(i=eu())===Pt&&(iu(g[_n()],e),xn(_n()+1)),i===At&&ru(t),i===wt)&&iu(n[a()],e),V(),k.pop(3),k.pushInteger(eu())}function nu(e){var t=cs(e),i=as(e);return i===t?e:255<(i=(i=i-t)<0?0-i:i)?(I(oi,1),Ns(e)):(t=us(e),32*i<(i=(i=ss(e)-t)<0?0-i:i)?(I(ci,1),Ns(e)):e)}function au(e){var t=us(e),i=fs(e),t=i-t,i=ss(e)-i;return 0<=t*i?e:(I(li,1),Bs(e,(t<0?0-t:t)/(e=(e=i-t)<0?0-e:e)))}function ou(e,t,i){0===s()?Wr()&&(du(e),cu(t),fu(i)):Ln(e,t)||Vo(e,t,i)}function uu(){return 0===s()?0:pu()}function lu(){return Lo(s()-3)}function cu(e){Do(s()-3,e)}function hu(){return Ro(s()-3)}function fu(e){Wo(s()-3,e)}function pu(){return zo(s()-3)}function du(e){Uo(s()-3,e)}function mu(){return 0===s()?999999999:hu()}function j(e){var t,i,r,s,n,a;return 0===e||Un(e)?(r=255&e,s=e>>>8&255,n=e>>>16&255,t=e>>>24&255,Bn()&&(i=(t*(a=qs())[6]+a[7])/t,n=(n*a[0]+a[1])*i|0,s=(s*a[2]+a[3])*i|0,r=(r*a[4]+a[5])*i|0,t=t*i|0,n=Math.max(n,0),n=Math.min(n,255),s=Math.max(s,0),s=Math.min(s,255),r=Math.max(r,0),r=Math.min(r,255),t=Math.max(t,0),t=Math.min(t,255)),t<1?0:(t<255&&ba()&&$o(_t),r+(s<<8)+(n<<16)+(t<<24))):e}function vu(e){var t,i,r,s,n;Tn()?(t=0|e[0],i=0|e[1],r=e,s=Ys(),n=(s[0]*t+s[1]*i+s[2])*U()|0,t=(s[3]*t+s[4]*i+s[5])*U()|0,r[0]=n,r[1]=t):(e[0]=(e[0]+Ws())*U(),e[1]=(e[1]+zs())*U())}function gu(e){0<e&&vu(w()),1<e&&vu(C()),2<e&&vu(A()),3<e&&vu(_a())}function ku(e){var t,i;return 0===e?0:(w()[0]=0,w()[1]=0,C()[0]=256*e,C()[1]=0,A()[0]=0,A()[1]=256*e,gu(3),e=C()[0]-w()[0],t=C()[1]-w()[1],i=128+(0|Math.sqrt(e*e+t*t))>>8,e=A()[0]-w()[0],t=A()[1]-w()[1],0===(i=(e=128+(0|Math.sqrt(e*e+t*t))>>8)<i?e:i)?1:i)}function bu(e){var t,i,r,s,n;return Bn()?(i=255&e,r=e>>>8&255,t=e>>>24&255,s=(e>>>16&255)*(n=qs())[0]+n[1]|0,r=r*n[2]+n[3]|0,i=i*n[4]+n[5]|0,t=t*n[6]+n[7]|0,s=Math.max(s,0),s=Math.min(s,255),r=Math.max(r,0),r=Math.min(r,255),i=Math.max(i,0),i=Math.min(i,255),t=Math.max(t,0),(t=Math.min(t,255))<16?0:i+(r<<8)+(s<<16)+(t<<24)):e}function yu(){return c[$i]}function Su(){Cu(yu())}function Iu(e){return!!ka(e)&&(Cu(wu()-e),!0)}function s(){return yu()-wu()}function Fu(e){return c[wu()+e]}function Ou(e,t){return c[wu()+e]=t}function wu(){return c[hi]}function Cu(e){c[hi]=e}function Au(e,t){O(e,ke,t)}function Pu(e,t){O(e,be,t)}function _u(e){return h(e,ye)}function xu(e){return o(Fr,e+Fe)}function Vu(e,t){O(e,Oe,t)}function ju(e){return h(e,Kt)}function qu(e,t){O(e,Kt,t)}function Mu(e){return h(e,Ht)}function Bu(e,t){O(e,Ht,t)}function Nu(e){return h(e,Gt)}function Tu(e){return h(e,Jt)}function Eu(e,t){O(e,Jt,t)}function Lu(e){c=e.wordsAsInt32Array()}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:ro,primitiveCopyBuffer:za,primitiveAddRect:Ra,primitiveAddGradientFill:Ta,primitiveSetClipRect:vo,initialiseModule:Dn,primitiveSetBitBltPlugin:mo,primitiveRegisterExternalEdge:lo,primitiveGetClipRect:Za,primitiveAddBezier:qa,primitiveInitializeProcessing:io,primitiveRenderImage:ho,primitiveGetOffset:$a,primitiveSetDepth:ko,primitiveAddBezierShape:Ma,primitiveSetEdgeTransform:bo,getModuleName:An,primitiveGetTimes:eo,primitiveNextActiveEdgeEntry:ao,primitiveAddBitmapFill:Ba,primitiveGetDepth:Ya,primitiveAbortProcessing:Va,primitiveNextGlobalEdgeEntry:uo,primitiveGetFailureReason:Qa,primitiveDisplaySpanBuffer:Ua,moduleUnloaded:ga,primitiveGetCounts:Ja,primitiveChangedActiveEdgeEntry:Wa,primitiveRenderScanline:fo,primitiveGetBezierStats:Xa,primitiveFinishedProcessing:Ha,setInterpreter:Po,primitiveNeedsFlush:so,primitiveAddLine:Ea,primitiveSetOffset:yo,primitiveNextFillEntry:oo,primitiveInitializeBuffer:to,primitiveDoProfileStats:Ka,primitiveAddActiveEdgeEntry:ja,primitiveSetAALevel:po,primitiveNeedsFlushPut:no,primitiveAddCompressedShape:Na,primitiveSetColorTransform:go,primitiveAddOval:La,primitiveRegisterExternalFill:co,primitiveAddPolygon:Da,primitiveGetAALevel:Ga}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function F(e){return"number"==typeof e?K.classSmallInteger():e.sqClass}function Q(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function O(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function A(e,t){return 0|Math.floor(e/t)}function P(e,t){return 31<t?0:e<<t}function k(e,t){return 31<t?0:e>>>t}function w(e,t){return t<0?t<-31?0:e>>>0-t:31<t?0:e<<t}var C=4294967295,a=3,r=13,s=12,n=10,o=11,u=14,l=0,$=4,f=5,c=2,h=7,ee=3,te=1,ie=8,re=9,se=15,ne=6,ae=2,oe=2,ue=4,le=8,ce=1,he=16384,fe=0,pe=3,de=2,me=1,ve=1,ge=43,ke=0,p=0,d=0,m=0,v=0,_=0,x=0,V=0,be=0,ye=0,Se=0,j=0,q=0,Ie=0,M=0,Fe=null,Oe=0,we=null,Ce=null,B=0,Ae=0,Pe=0,N=0,_e=0,T=0,xe=0,Ve=0,E=0,L=0,D=0,R=0,g=0,je=0,W=0,qe=0,Me=new Array(4096),Be=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],Ne=[0,2,4,6,8,12,14,16],Te=[0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],Ee=0,z=0,U=0,Le=null,De=0,Re=0,We=0,ze=0,Ue=0,Ke=0,K=null,He=0,Ge=null,H=0,Xe=0,G=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],e="BitBltPlugin 3 November 2014 (e)",Ze=0,Je=0,Ye=0,X=new Array(43),Qe=0,$e=null,b=0,et=0,y=0,tt=0,Z=0,it=0,rt=0,S=0,st=0,nt=0,I=0,at=0,ot=0,ut=0,lt=0,J=0,Y=0,ct=null,ht=null,ft=0,pt=0,dt=0,mt=new Array(32),vt=0,gt=0,kt=0;function bt(e,t){var i,r;if(T<16)for(i=e^t,r=G[T];0!==i;)0!=(i&r)&&++be,i=k(i,T);else be=16===T?(i=gi(e,t,5,3),be=be+(31&i)+(i>>>5&31)+(i>>>10&31),i=gi(e>>>16,t>>>16,5,3),be+(31&i)+(i>>>5&31)+(i>>>10&31)):(i=gi(e,t,8,3),be+(255&i)+(i>>>8&255)+(i>>>16&255));return t}function yt(e,t){var i,r,s,n;if((M&(ce|ue))==(ce|ue))if(T<16)for(i=G[T]&Oe,n=t,s=1;s<=R;s++)Gi(r=n&i,Hi(r)+1),n=k(n,T);else 16===T?(Gi(r=qi(65535&t,5,Ie),Hi(r)+1),Gi(r=qi(t>>>16,5,Ie),Hi(r)+1)):Gi(r=qi(t,8,Ie),Hi(r)+1);return t}function St(e,t){return e+t}function It(e,t){var i,r,s=e>>>24;return 0==s?t:255==s?e:(r=(16711935&e)*s+(16711935&t)*(i=255-s)+16711935)+(r-65537>>>8&16711935)>>>8&16711935|((r=(16711935&(e>>>8|16711680))*s+(t>>>8&16711935)*i+16711935)+(r-65537>>>8&16711935)>>>8&16711935)<<8}function Ft(e,t){return Ot(e,t,!1)}function Ot(e,t,i){var r,s,n,a,o,u,l,c,h,f,p,d,m;if(T<16)return t;if(h=255-et,o=t,1===R)i&&0===e||(o=(p=(16711935&e)*et+(16711935&t)*h+16711935)+(p-65537>>>8&16711935)>>>8&16711935|((p=(e>>>8&16711935)*et+(t>>>8&16711935)*h+16711935)+(p-65537>>>8&16711935)>>>8&16711935)<<8);else for(r=G[T],m=D,d=t,a=e,n=1;n<=R;n++){if(l=a&r,!(0==(m&r)||i&&0==l)){for(f=d&r,s=0,c=1;c<=3;c++)s|=P(31&A((31&k(l,u=5*(c-1)))*et+(31&k(f,u))*h+254,255),u);o=o&~P(r,16*(n-1))|P(s,16*(n-1))}m=k(m,T),a=k(a,T),d=k(d,T)}return o}function wt(e,t){var i=255-(e>>>24),r=((16711935&t)*i>>>8&16711935)+(16711935&e),t=((t>>>8&16711935)*i>>>8&16711935)+(e>>>8&16711935);return(16711935&t)<<8|255*(16777472&t)|(16711935&r|255*(16777472&r)>>>8)}function Ct(e,t){return 0===e?t:Ot(e,t,!0)}function At(e,t){return e&t}function Pt(e,t){return e&~t}function _t(e,t){return~e&t}function xt(e,t){return~e&~t}function Vt(e,t){return~t}function jt(e,t){return~e|t}function qt(e,t){return~e|~t}function Mt(e,t){return~e}function Bt(e,t){return~e^t}function Nt(e,t){return e|t}function Tt(e,t){return e|~t}function Et(e,t){return e^t}function Lt(e,t){return 0}function Dt(){j<=W?(J=ot,z=W,x=kt):(J=ot+(j-W),x=kt-(j-W),z=j),j+Se<z+x&&(x-=z+x-(j+Se)),q<=qe?(Y=ut,U=qe,_=Ke):(Y=ut+q-qe,_=Ke-(q-qe),U=q),q+ye<U+_&&(_-=U+_-(q+ye)),Ye||(J<0&&(z-=J,x+=J,J=0),at<J+x&&(x-=J+x-at),Y<0&&(U-=Y,_+=Y,Y=0),rt<Y+_&&(_-=Y+_-rt))}function Rt(){return Dt(),x<=0||_<=0?(d=m=v=p=0,null):li()?(function(){if(function(){var e;if(41===B)Ae=255,Pe=16777215,ct=Le=null,2<=K.methodArgumentCount()?(Ae=K.stackIntegerValue(K.methodArgumentCount()-2),K.failed()||(Pe=K.stackIntegerValue(K.methodArgumentCount()-1),K.failed())?K.primitiveFail():4===K.methodArgumentCount()&&(e=K.stackObjectValue(1),K.isBytes(e)&&(Le=e.bytes),e=K.stackObjectValue(0),K.isBytes(e))&&(ct=e.bytes)):(1!==K.methodArgumentCount()||(Pe=K.stackIntegerValue(0),K.failed()))&&K.primitiveFail()}(),K.failed())return K.primitiveFail();if(function(){if(Ye)return!1;if(34!==B&&41!==B)return!1;if(32!==Z)return!1;if(it===xe)return!1;if(41===B)return 32===T?(function(){var e,t,i,r,s,n,a,o;s=_+1,n=Y,o=U;for(;0!=--s;){for(t=n*I+4*J,r=o*g+4*z,i=x+1;0!=--i;)if(e=y[t>>>2],0==(16777215&e)){for(t+=4,r+=4;0!=--i&&0==(16777215&(e=y[t>>>2]));)t+=4,r+=4;++i}else a=N[r>>>2],a=_i(e,a),N[r>>>2]=a,t+=4,r+=4;++n,++o}}(),m=(d=z)+x,p=(v=U)+_,!0):16===T?(function(){var e,t,i,r,s,n,a,o,u,l,c,h,f;u=_+1,l=Y,h=U,i=16*(1&z),L&&(i=16-i);H=P(65535,16-i);for(;0!=--u;){for(s=l*I+4*J,a=h*g+4*(z>>1),e=4*(3&h),f=(3&J)-1,n=x+1,i=65535===(o=H)?16:0;0!=--n;)t=Be[e+(f=f+1&3)],r=y[s>>>2],0!=(16777215&r)&&(c=N[a>>>2],c=k(c&=~o,i),r=P(0===(r=Xt(r=_i(r,c=(31744&c)<<9|(992&c)<<6|(31&c)<<3|4278190080),t))?1:r,i),Zt(a,r,o)),s+=4,L?0===i&&(a+=4):0!==i&&(a+=4),i^=16,o=~o;++l,++h}}(),m=(d=z)+x,p=(v=U)+_,!0):8===T&&(function(){var e,t,i,r,s,n,a,o,u,l,c,h,f;s=Ut(),o=M&~le,l=_+1,c=Y,H=8*(3&z),L&&(H=24-H);Xe=C^P(255,H),a=0==(1&z)?0:522133279;0==(1&(f=U))&&(a^=522133279);for(;0!=--l;){for(a^=522133279,i=c*I+4*J,n=f*g+4*(z>>2),r=x+1,e=H,u=Xe;0!=--r;)t=(y[i>>>2]&~a)+a,31<(h=A(((h=16777215&t)>>>16)+(h>>>8&255)+(255&h),3))&&(224<h&&(t=4294967295),h=N[n>>>2],h=k(h&=~u,e),h=s[h],t=P(t=ci(t=_i(t,h),o),e),Zt(n,t,u)),i+=4,u=L?0===e?(n+=4,e=24,16777215):(e-=8,u>>>8|4278190080):32===e?(n+=4,e=0,4294967040):(e+=8,u<<8|255),a^=522133279;++c,++f}}(),m=(d=z)+x,p=(v=U)+_,!0);if(T<8)return!1;if(8===T&&0==(M&ce))return!1;32===T&&!function(){for(var e,t,i,r,s,n=_+1,a=Y,o=U;0!=--n;){for(t=a*I+4*J,r=o*g+4*z,i=x+1;0!=--i;)if(255==(s=(e=y[t>>>2])>>>24)){for(N[r>>>2]=e,t+=4,r+=4;0!=--i&&(e=y[t>>>2])>>>24==255;)N[r>>>2]=e,t+=4,r+=4;++i}else if(0==s){for(t+=4,r+=4;0!=--i&&(e=y[t>>>2])>>>24==0;)t+=4,r+=4;++i}else s=wt(e,N[r>>>2]),N[r>>>2]=s,t+=4,r+=4;++a,++o}}();16===T&&!function(){var e,t,i,r,s,n,a,o,u,l=_+1,c=Y,h=U,f=16*(1&z);for(H=P(65535,16-(f=L?16-f:f));0!=--l;){for(r=c*I+4*J,n=h*g+4*(z>>1),e=4*(3&h),u=(3&J)-1,s=x+1,f=65535===(a=H)?16:0;0!=--s;)t=Be[e+(u=u+1&3)],255==(o=(i=y[r>>>2])>>>24)?Zt(n,i=P(0===(i=Xt(i,t))?1:i,f),a):0!=o&&(o=N[n>>>2],Zt(n,i=P(0===(i=Xt(i=wt(i,o=(31744&(o=k(o&=~a,f)))<<9|(992&o)<<6|(31&o)<<3|4278190080),t))?1:i,f),a)),r+=4,L?0===f&&(n+=4):0!==f&&(n+=4),f^=16,a=~a;++c,++h}}();8===T&&!function(){var e,t,i,r,s,n,a,o,u=Ut(),l=M&~le,c=_+1,h=Y,f=U;for(H=8*(3&z),Xe=C^P(255,H=L?24-H:H),n=0==(1&z)?0:522133279,0==(1&U)&&(n^=522133279);0!=--c;){for(n^=522133279,i=h*I+4*J,s=f*g+4*(z>>2),r=x+1,e=H,a=Xe;0!=--r;)31<(o=(t=(y[i>>>2]&~n)+n)>>>24)&&(o<224&&(o=N[s>>>2],t=wt(t,o=u[o=k(o&=~a,e)])),Zt(s,t=P(t=ci(t,l),e),a)),i+=4,a=L?0===e?(s+=4,e=24,16777215):(e-=8,a>>>8|4278190080):24===e?(s+=4,e=0,4294967040):(e+=8,a<<8|255),n^=522133279;++h,++f}}();return m=(d=z)+x,p=(v=U)+_,!0}())return;if(30===B||31===B){if(1!==K.methodArgumentCount())return K.primitiveFail();if(et=K.stackIntegerValue(0),!(!K.failed()&&0<=et&&et<=255))return K.primitiveFail()}be=0,Ht(),(Ye?function(){var e,t,i,r,s,n;for(i=X[B+1],n=1;n<=_;n++){if(t=Je?C:ei(U+n-1),D=H,r=N[E>>>2],e=i(t,r),r=D&e|r&~D,N[E>>>2]=r,E+=4,D=C,3===B)for(r=t,s=2;s<=Ze-1;s++)N[E>>>2]=r,E+=4;else for(s=2;s<=Ze-1;s++)r=N[E>>>2],e=i(t,r),N[E>>>2]=e,E+=4;1<Ze&&(D=Xe,r=N[E>>>2],e=i(t,r),r=D&e|r&~D,N[E>>>2]=r,E+=4),E+=_e}}:(function(){var e;it===xe&&Y<=U&&(Y<U?(ft=-1,Y=Y+_-1,U=U+_-1):U===Y&&J<z&&(De=-1,J=J+x-1,z=z+x-1,1<Ze)&&(e=H,H=Xe,Xe=e),E=U*g+4*A(z,R),_e=g*ft-Ze*De*4)}(),Z!==T||0!==M||st!==L?zt:(function(){var e,t,i,r;t=J&(r=R-1),e=z&r,Qe=0<De?(i=Math.min(x,R-e),r<t+i):(i=Math.min(x,1+e),t-i+1<0);b=st?(t-e)*T:(e-t)*T;Qe&&(b<0?b+=32:b-=32);S=Y*I+4*A(J,A(32,Z)),tt=I*ft-Ze*De*4,Qe&&(tt-=4*De)}(),function(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p;n=X[B+1],a=4*De,-32===b?b=s=i=0:i=b<0?(s=b+32,P(C,0-b)):0===b?(s=0,C):(s=b-32,k(C,b));p=~i,Je?(r=C,ze=0):r=ei(0);for(c=U,h=1;h<=_;h++){if(1<ze&&(r=ei(c),c+=ft),Qe?(l=y[S>>>2],S+=a):l=0,D=H,f=y[S>>>2],S+=a,t=w(l&p,s)|w(f&i,b),l=f,o=N[E>>>2],e=n(t&r,o),o=D&e|o&~D,N[E>>>2]=o,E+=a,D=C,3===B)if(0===b&&r===C)if(-1===De)for(u=2;u<=Ze-1;u++)f=y[S>>>2],S+=a,N[E>>>2]=f,E+=a;else for(u=2;u<=Ze-1;u++)N[E>>>2]=l,E+=a,l=y[S>>>2],S+=a;else for(u=2;u<=Ze-1;u++)f=y[S>>>2],S+=a,t=w(l&p,s)|w(f&i,b),l=f,N[E>>>2]=t&r,E+=a;else for(u=2;u<=Ze-1;u++)f=y[S>>>2],S+=a,t=w(l&p,s)|w(f&i,b),l=f,e=n(t&r,N[E>>>2]),N[E>>>2]=e,E+=a;1<Ze&&(D=Xe,f=y[S>>>2],S+=a,t=w(l&p,s)|w(f&i,b),o=N[E>>>2],e=n(t&r,o),o=D&e|o&~D,N[E>>>2]=o,E+=a),S+=tt,E+=_e}})))(),22!==B&&32!==B||(d=m=v=p=0);m=0<De?(d=z)+x:(d=z-x+1,z+1);p=0<ft?(v=U)+_:(v=U-_+1,U+1)}(),void Xi()):K.primitiveFail()}function Wt(e,t,i){qe=i,kt=t-(ot=W=e),Rt(),Wi()}function zt(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g=X[B+1];for(nt=A(32,Z),r=G[Z],h=G[T],e=M&~le,S=Y*I+4*A(J,nt),v=x<(v=nt-(J&nt-1))?0:A(x-v,nt)+1,tt=I-4*v,d=1+(z+x-1&R-1),x<(a=R-(z&R-1))&&(a=x),p=(J&nt-1)*Z,o=(z&R-1)*T,t=Z,f=T,i=0,st&&(p=32-Z-p,t=0-Z),L&&(o=32-T-o,f=0-T,i=32-T),u=1;u<=_;u++){for(l=Je?C:ei(U+u-1),lt=p,Ee=o,D=H,m=a,s=Ze;n=function(e,t,i,r,s,n){var a,o,u,l,c,h,f;if(u=y[S>>>2],f=0,o=lt,l=Ee,h=e,t===(ce|ue))for(;a=k(u,o)&i,c=Fe[a&Oe],f|=P(c&r,l),l+=n,0!=(4294967264&(o+=s))&&(st?o+=32:o-=32,u=y[(S+=4)>>>2]),0!=--h;);else for(;a=k(u,o)&i,c=ci(a,t),f|=P(c&r,l),l+=n,0!=(4294967264&(o+=s))&&(st?o+=32:o-=32,u=y[(S+=4)>>>2]),0!=--h;);return lt=o,f}(m,e,r,h,t,f),Ee=i,D===C?(c=g(n&l,N[E>>>2]),N[E>>>2]=D&c):(c=g(n&l,(n=N[E>>>2])&D),n=D&c|n&~D,N[E>>>2]=n),E+=4,m=2===s?(D=Xe,d):(D=C,R),0!=--s;);S+=tt,E+=_e}}function Ut(){return[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}function Kt(e,t,i){return e<t?A(t-e+he,i+1)+1:t===e?0:0-(A(e-t+he,i+1)+1)}function Ht(){var e=R-1,t=R-(z&e);H=(L?k:P)(C,32-t*T),Xe=(L?P:k)(C,32-(1+(z+x-1&e))*T),Ze=x<t?(H&=Xe,Xe=0,1):A(x-t+e,R)+1,De=ft=1,E=U*g+4*A(z,R),_e=g*ft-Ze*De*4}function Gt(e,t){return t}function Xt(e,t){t<<=8;return(Me[t+(e>>>16&255)]<<10)+(Me[t+(e>>>8&255)]<<5)+Me[t+(255&e)]}function Zt(e,t,i){var r=N[e>>>2];N[e>>>2]=r=r&i|t}function Jt(e,t){e=K.fetchPointerofObject(e,t);return"number"==typeof e?e:-2147483648<=(t=K.floatValueOf(e))&&t<=2147483647?0|t:(K.primitiveFail(),0)}function Yt(e,t,i){e=K.fetchPointerofObject(e,t);return"number"==typeof e?e:e.isNil?i:-2147483648<=(t=K.floatValueOf(e))&&t<=2147483647?0|t:(K.primitiveFail(),0)}function Qt(e,t){return 32!==T?t:0===t?0:0!=(4278190080&t)?t:t|4278190080&e}function $t(){return e}function ei(e){return Re[e-A(e,e=ze)*e|0]}function ti(e){return!!e.isNil||0===B||5===B||10===B||15===B}function ii(){for(var e,t,i,r,s,n,a=0;a<=255;a++)for(e=0;e<=15;e++)i=e,s=n=s=r=void 0,n=Te[(r=255&(t=a))>>>3],s=i<(s=Ne[7&r])?n+1:n,n=Te[(r=t>>>8&255)>>>3],s|=i<Ne[7&r]?n+1<<5:n<<5,n=Te[(r=t>>>16&255)>>>3],t=s|=i<Ne[7&r]?n+1<<10:n<<10,Me[(e<<8)+a]=t}function ri(){return X[1]=Lt,X[2]=At,X[3]=Pt,X[4]=zi,X[5]=_t,X[6]=Gt,X[7]=Et,X[8]=Nt,X[9]=xt,X[10]=Bt,X[11]=Vt,X[12]=Tt,X[13]=Mt,X[14]=jt,X[15]=qt,X[16]=Gt,X[17]=Gt,X[18]=Gt,X[19]=St,X[20]=Ui,X[21]=Pi,X[22]=Ei,X[23]=bt,X[24]=yt,X[25]=It,X[26]=Si,X[27]=yi,X[28]=Mi,X[29]=Bi,X[30]=Ni,X[31]=Ft,X[32]=Ct,X[33]=Vi,X[34]=Ki,X[35]=wt,X[36]=wt,X[37]=wt,X[38]=Ti,X[39]=Ii,X[40]=bi,X[41]=Qt,X[42]=xi,ii(),!0}function si(){var e;if(N=K.fetchPointerofObject(fe,xe),je=K.fetchIntegerofObject(me,xe),Ve=K.fetchIntegerofObject(de,xe),!(0<=je&&0<=Ve))return!1;if(T=K.fetchIntegerofObject(pe,xe),L=0<T,T<0&&(T=0-T),"number"==typeof N){if(!function(e){if(!$e&&!ui())return;return $e(e,function(e,t,i,r){je=e,Ve=t,T=i,L=r})}(N))return!1;R=A(32,T),N=g=0}else{if(R=A(32,T),g=4*A(je+(R-1),R),e=O(N),!K.isWordsOrBytes(N)||e!==g*Ve){if(!(K.isWordsOrBytes(N)&&g*Ve<e))return!1;K.vm.warnOnce("BitBlt>>loadBitBltDestForm: destBitsSize != destPitch * destHeight, expected "+g+"*"+Ve+"="+g*Ve+", got "+e)}N=N.wordsOrBytes()}return!0}function ni(e){return ai(e,!1)}function ai(e,t){if(V=e,He=t,B=K.fetchIntegerofObject(ee,V),K.failed()||B<0||ge-2<B)return!1;if(16<=B&&B<=17)return!1;if(it=K.fetchPointerofObject(te,V),Ye=ti(it),We=K.fetchPointerofObject(c,V),Je=ti(We),xe=K.fetchPointerofObject(l,e),!(K.isPointers(xe)&&4<=Q(xe)))return!1;if(!si())return!1;if(W=Yt($,V,0),qe=Yt(f,V,0),kt=Yt(ne,V,je),Ke=Yt(h,V,Ve),K.failed())return!1;if(Ye)ot=ut=0;else{if(!(K.isPointers(it)&&4<=Q(it)))return!1;if(!function(){var e;if(y=K.fetchPointerofObject(fe,it),at=Jt(me,it),rt=Jt(de,it),!(0<=at&&0<=rt))return!1;Z=K.fetchIntegerofObject(pe,it),st=0<Z,Z<0&&(Z=0-Z);if("number"==typeof y){if(!function(e){if(!$e&&!ui())return;return $e(e,function(e,t,i,r){at=e,rt=t,Z=i,st=r})}(y))return!1;nt=A(32,Z),y=I=0}else{if(nt=A(32,Z),I=4*A(at+(nt-1),nt),e=O(y),!K.isWordsOrBytes(y)||e!==I*rt){if(!(K.isWordsOrBytes(y)&&I*rt<e))return!1;K.vm.warnOnce("BitBlt>>loadBitBltSourceForm: sourceBitsSize != sourcePitch * sourceHeight, expected "+I+"*"+rt+"="+I*rt+", got "+e)}y=y.wordsOrBytes()}return!0}())return!1;if(!function(){var e,t,i;if(M=Oe=Ie=0,Fe=we=Ce=null,!(e=K.fetchPointerofObject(u,V)).isNil){if(M=ce,i=!1,K.isWords(e))t=Q(e),Fe=e.words,i=!0;else{if(!(K.isPointers(e)&&3<=Q(e)))return!1;if(Ce=oi(K.fetchPointerofObject(0,e)),we=oi(K.fetchPointerofObject(1,e)),(e=K.fetchPointerofObject(2,e)).isNil)t=0;else{if(!K.isWords(e))return!1;t=Q(e),Fe=e.words}M|=le}if(0!=(t&t-1))return!1;Oe=t-1,Ie=0,512===t&&(Ie=3),4096===t&&(Ie=4),32768===t&&(Ie=5),0===t?(Fe=null,Oe=0):M|=ue,i&&Di(),!function(e,t){return!e||!t||0===e[ke]&&0===e[ve]&&0===e[ae]&&0===e[a]&&16711680===t[ke]&&65280===t[ve]&&255===t[ae]&&4278190080===t[a]}(Ce,we)?M|=oe:Ce=we=null}return!0}())return!1;0==(M&le)&&Di(),ot=Yt(ie,V,0),ut=Yt(re,V,0)}return!!function(){var e;if(Je)Re=null;else{if(K.isPointers(We)&&4<=Q(We))e=K.fetchPointerofObject(fe,We),ze=K.fetchIntegerofObject(de,We),K.isWords(e)||(Je=!0);else{if(K.isPointers(We)||!K.isWords(We))return!1;ze=Q(e=We)}Re=e.wordsOrBytes()}return!0}()&&(j=Yt(n,V,0),q=Yt(o,V,0),Se=Yt(s,V,je),ye=Yt(r,V,Ve),!K.failed())&&(j<0&&(Se+=j,j=0),q<0&&(ye+=q,q=0),je<j+Se&&(Se=je-j),Ve<q+ye&&(ye=Ve-q),!0)}function oi(e){return e.isNil?null:"number"!=typeof e&&K.isWords(e)&&4===Q(e)?e.wordsAsInt32Array():(K.primitiveFail(),null)}function ui(){return $e=K.ioLoadFunctionFrom("ioGetSurfaceFormat","SurfacePlugin"),Ge=K.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin"),ht=K.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin"),$e&&Ge&&ht}function li(){var e,t,i,r,s,n;if(Ue=!1,0===N){if(!Ge&&!ui())return;if(r=Ge,e=K.fetchIntegerofObject(fe,xe),0===y&&!Ye&&(t=K.fetchIntegerofObject(fe,it))===e)return y=He?(n=Math.min(J,z),s=Math.max(J,z)+x,r(t,function(e){I=e},n,i=Math.min(Y,U),s-n,Math.max(Y,U)+_-i)):r(t,function(e){I=e},0,0,at,rt),g=I,Ue=!0,0!==(N=y);N=r(e,function(e){g=e},z,U,x,_),Ue=!0}if(0===y&&!Ye){if(t=K.fetchIntegerofObject(fe,it),!Ge&&!ui())return;r=Ge,y=He?r(t,function(e){I=e},0,0,at,rt):r(t,function(e){I=e},J,Y,x,_),Ue=!0}return 0!==N&&(0!==y||Ye)}function ci(e,t){var i,r=e;return r=0!=(t&ce)&&(0!=(t&oe)&&0===(r=w((i=e)&we[0],Ce[0])|w(i&we[1],Ce[1])|w(i&we[2],Ce[2])|w(i&we[3],Ce[3]))&&0!==e&&(r=1),0!=(t&ue))?Fe[r&Oe]:r}function hi(e){0===strcmp(e,"SurfacePlugin")&&($e=Ge=ht=0)}function fi(e,t,i,r){for(var s=G[i],n=0,a=1;a<=r;a++)(e&s)===s&&(n|=t&s),s=P(s,i);return n}function pi(e,t,i,r,s){var n=e&s,s=t&s,e=(e^n)+(t^s);return e^n^s|k(n&s|(n|s)&e,i-1)*r}function di(e,t,i,r){for(var s=G[i],n=0,a=1;a<=r;a++)n|=Math.max(t&s,e&s),s=P(s,i);return n}function mi(e,t,i,r){for(var s=G[i],n=0,a=1;a<=r;a++)n|=Math.min(t&s,e&s),s=P(s,i);return n}function vi(e,t,i,r){var s=G[i],n=P(s,i),a=k((1+(e&s))*(1+(t&s))-1&n,i);return 1!==r&&(a|=(1+(k(e,i)&s))*(1+(k(t,i)&s))-1&n,2!==r&&(a|=P((1+(k(e,2*i)&s))*(1+(k(t,2*i)&s))-1&n,i),3!==r))&&(a|=P((1+(k(e,3*i)&s))*(1+(k(t,3*i)&s))-1&n,2*i)),a}function gi(e,t,i,r){for(var s,n,a=G[i],o=0,u=1;u<=r;u++)o|=(n=e&a)<(s=t&a)?s-n:n-s,a=P(a,i);return o}function ki(e,t){return e<0||t<0||(e=e>>>14)>=at||(t=t>>>14)>=rt?0:(t=t*I+4*k(e,dt),k(y[t>>>2],lt=mt[e&pt])&vt)}function bi(e,t){var i,r,s,n,a;if(32===T)return e===t?0:t;for(a=G[r=T],s=0,n=1;n<=R;n++)s|=i=(e&a)===(i=t&a)?0:i,a=P(a,r);return s}function yi(e,t){return fi(~e,t,T,R)}function Si(e,t){return 0===e?t:e|fi(~e,t,T,R)}function Ii(e,t){var i,r,s,n,a;if(1===R)return t;if(i=0,s=P(1,T)-1,n=P(s,(R-1)*T),i|=P(t&s,r=32-T)|k(t&n,r),!(R<=2))for(a=2;a<=R>>1;a++)s=P(s,T),n=k(n,T),i|=P(t&s,r-=2*T)|k(t&n,r);return i}function Fi(){return ni(K.stackValue(K.methodArgumentCount()))?(Rt(),K.failed()||(Wi(),K.failed())?null:(K.pop(K.methodArgumentCount()),22===B||32===B?(K.pop(1),K.pushInteger(be)):void 0)):K.primitiveFail()}function Oi(){var e,t,i,r,s,n,a,o,u,l,c,h,f;if(6!==K.methodArgumentCount())return K.primitiveFail();if(l=K.stackIntegerValue(0),s=K.stackObjectValue(1),o=K.stackObjectValue(2),F(s)!==K.classArray()||F(o)!==K.classArray())return K.primitiveFail();if(256!==Q(o))return K.primitiveFail();if(K.failed())return null;if(n=Q(s)-2,i=K.stackIntegerValue(3),c=K.stackIntegerValue(4),f=K.stackObjectValue(5),!K.isBytes(f))return K.primitiveFail();if(!(0<c&&0<i&&i<=O(f)))return K.primitiveFail();if(!ni(r=K.stackObjectValue(6)))return K.primitiveFail();if(30===B||31===B)return K.primitiveFail();for(a=0!==N&&0!==y&&!1===Ye&&it!==xe&&(0!==M||st!==L||Z!==T),u=W,t=f.bytes,e=c;e<=i;e++){if(h=t[e-1],(h=K.fetchIntegerofObject(h,o))<0||n<h)return K.primitiveFail();if(ot=K.fetchIntegerofObject(h,s),kt=K.fetchIntegerofObject(h+1,s)-ot,K.failed())return null;if(Dt(),0<x&&0<_&&(a?(Ht(),zt(),m=(d=z)+x,p=(v=U)+_):Rt()),K.failed())return null;W=W+kt+l}d=u,Wi(),K.storeIntegerofObjectwithValue($,r,W),K.pop(6)}function wi(){var e=K.stackValue(2),t=K.stackIntegerValue(1),i=K.stackIntegerValue(0);if(!ni(e))return K.primitiveFail();K.failed()||(!function(e,t){var i,r,s,n,a=0<e?1:0===e?0:-1,o=0<t?1:0===t?0:-1,u=Math.abs(t),l=Math.abs(e),c=r=9999,h=n=-9999;if(u<l){for(i=l>>1,s=1;s<=l;s++)if(W+=a,(i-=u)<0&&(qe+=o,i+=l),s<l){if(Rt(),K.failed())return;d<m&&v<p&&(c=Math.min(c,d),h=Math.max(h,m),r=Math.min(r,v),4e3<(h-c)*((n=Math.max(n,p))-r))&&(d=c,m=h,v=r,p=n,Wi(),h=n=-(c=r=9999))}}else for(i=u>>1,s=1;s<=u;s++)if(qe+=o,(i-=l)<0&&(W+=a,i+=u),s<u){if(Rt(),K.failed())return;d<m&&v<p&&(c=Math.min(c,d),h=Math.max(h,m),r=Math.min(r,v),4e3<(h-c)*((n=Math.max(n,p))-r))&&(d=c,m=h,v=r,p=n,Wi(),h=n=-(c=r=9999))}d=c,m=h,v=r,p=n,K.storeIntegerofObjectwithValue($,V,W),K.storeIntegerofObjectwithValue(f,V,qe)}(t,i),Wi()),K.failed()||K.pop(2)}function Ci(){var e,t,i,r,s,n=K.stackIntegerValue(1),a=K.stackIntegerValue(0);K.stackValue(2);return K.failed()||(n<0||a<0?(r=0,K.failed()||K.popthenPush(3,r)):(s=K.stackValue(K.methodArgumentCount()),K.isPointers(s)&&4<=Q(s)&&(e=K.fetchPointerofObject(fe,s),K.isWordsOrBytes(e))?(kt=K.fetchIntegerofObject(me,s),Ke=K.fetchIntegerofObject(de,s),s=K.fetchIntegerofObject(pe,s),K.failed()||(kt<=n||Ke<=a?(r=0,K.failed()||K.popthenPush(3,r)):s<0||(t=A(32,s),i=A(kt+(t-1),t),O(e)!==i*Ke*4)?K.primitiveFail():(a=K.fetchLong32ofObject(a*i+A(n,t),e),i=k(4294967295,32-s),e=k(a,32-(1+(n&t-1))*s)&i,r=K.positive32BitIntegerFor(e),K.failed()||K.popthenPush(3,r)))):K.primitiveFail())),null}function Ai(){return ai(K.stackValue(K.methodArgumentCount()),!0)?(function(){var e;if(e=Ye,Ye=!0,Dt(),(Ye=e)||x<=0||_<=0)return d=m=v=p=0;if(!li())return K.primitiveFail();Ht(),function(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g,k,b,y,S,I,F,O,w;if(u=X[B+1],!(Q(V)>=se+12))return K.primitiveFail();(s=Ke-1)<=0&&(s=1);y=Jt(se,V),i=Jt(se+3,V),(O=Kt(y,i,s))<0&&(y=i-s*O);m=Jt(se+1,V),i=Jt(se+4,V),(S=Kt(m,i,s))<0&&(m=i-s*S);g=Jt(se+9,V),i=Jt(se+6,V),(l=Kt(g,i,s))<0&&(g=i-s*l);c=Jt(se+10,V),i=Jt(se+7,V),(n=Kt(c,i,s))<0&&(c=i-s*n);if(K.failed())return;if(2===K.methodArgumentCount())if(w=K.stackIntegerValue(1),(k=K.stackValue(0)).isNil){if(Z<16)return K.primitiveFail()}else{if(Q(k)<P(1,Z))return K.primitiveFail();k=k.wordsOrBytes()}else w=1,k=K.nilObject();(s=kt-1)<=0&&(s=1);I=1+(z+x-1&R-1),x<(o=R-(z&R-1))&&(o=x);qe<q&&(y+=(q-qe)*O,m+=(q-qe)*S,g+=(q-qe)*l,c+=(q-qe)*n);(function(){var e,t;gt=0,t=Z;for(;1!==t;)++gt,t>>>=1;for(vt=G[Z],pt=P(1,dt=5-gt)-1,e=0;e<=pt;e++)mt[e]=st?32-P(e+1,gt):P(e,gt)})(),1<w&&0==(M&le)&&(Fe?Ri(8,Ie):16===T&&Ri(8,5));e=M&~le,t=L?(v=0-T,32-T):(v=T,0);for(h=1;h<=_;h++){for(b=Kt(y,g,s),J=0<=b?y:g-s*b,f=Kt(m,c,s),Y=0<=f?m:c-s*f,Ee=L?32-(1+(z&R-1))*T:(z&R-1)*T,W<j&&(J+=(j-W)*b,Y+=(j-W)*f),p=Je?C:ei(U+h-1),D=H,F=o,i=Ze;r=1===w?function(e,t,i,r,s){var n,a,o,u,l;if(u=G[T],l=0,a=e,s===(ce|ue))for(;n=ki(J,Y),o=Fe[n&Oe],l|=P(o&u,Ee),Ee+=r,J+=t,Y+=i,0!=--a;);else for(;n=ki(J,Y),o=ci(n,s),l|=P(o&u,Ee),Ee+=r,J+=t,Y+=i,0!=--a;);return l}(F,b,f,v,e):function(e,t,i,r,s,n,a,o){var u,l,c,h,f,p,d,m,v,g,k,b,y,S,I,F,O,w,C;m=G[T],l=0,v=2===a?(c=t>>1,f=i>>1,d=r>>1,s>>1):(c=A(t,a),f=A(i,a),d=A(r,a),A(s,a));p=e;do{I=J,k=Y,F=O=S=b=0,w=0,h=a;do{for(C=I,y=k,u=a;g=ki(C,y),25===B&&0===g||(++w,Z<16?g=n[g]:16===Z&&(g=ji(g)),b+=255&g,S+=g>>>8&255,O+=g>>>16&255,F+=g>>>24),C+=c,y+=f,0!=--u;);}while(I+=d,k+=v,0!=--h)}while(g=0===w||25===B&&w<a*a>>1?0:(4===w?(O>>>=2,S>>>=2,b>>>=2,F>>>=2):(O=A(O,w),S=A(S,w),b=A(b,w),F=A(F,w)),ci(g=0===(g=(F<<24)+(O<<16)+(S<<8)+b)&&0<O+S+b+F?1:g,M)),l|=P(g&m,Ee),Ee+=o,J+=t,Y+=i,0!=--p);return l}(F,b,f,O,S,k,w,v),Ee=t,D===C?(d=u(r&p,N[E>>>2]),N[E>>>2]=D&d):(a=N[E>>>2],d=u(r&p,a&D),a=D&d|a&~D,N[E>>>2]=a),E+=4,F=2===i?(D=Xe,I):(D=C,R),0!=--i;);y+=O,m+=S,g+=l,c+=n,E+=_e}}(),m=0<De?(d=z)+x:(d=z-x+1,z+1);p=0<ft?(v=U)+_:(v=U-_+1,U+1);Xi()}(),K.failed()||(Wi(),K.failed())?null:void K.pop(K.methodArgumentCount())):K.primitiveFail()}function Pi(e,t){var i,r;return T<16?(r=P(1,T)-1,i=P(A(4294967295,r),T-1),pi(e,t,T,r,i)):16===T?pi(2147450879&e,2147450879&t,5,r=31,i=1108361744):pi(e,t,8,r=255,i=2155905152)}function _i(e,t){var i,r,s,n,a,o;return 0===e?t:(a=255&e,r=255&(e>>>=8),s=255&(e>>>=8),e=255&(e>>>=8),255!=(n=255&Ae)&&(e=e*n>>>8,s=s*n>>>8,r=r*n>>>8,a=a*n>>>8),t=255&(n=t),o=255&(i=Pe),ct&&(t=ct[t],o=ct[o]),255<(a=(t*(255-a)>>>8)+(o*a>>>8))&&(a=255),Le&&(a=Le[a]),t=255&(n>>>=8),o=255&(i>>>=8),ct&&(t=ct[t],o=ct[o]),255<(r=(t*(255-r)>>>8)+(o*r>>>8))&&(r=255),Le&&(r=Le[r]),t=255&(n>>>=8),o=255&(i>>>=8),ct&&(t=ct[t],o=ct[o]),255<(t=(t*(255-s)>>>8)+(o*s>>>8))&&(t=255),i>>>=8,((((o=255<(o=((255&(n>>>=8))*(255-e)>>>8)+e)?255:o)<<8)+(t=Le?Le[t]:t)<<8)+r<<8)+a)}function xi(e,t){if(0===e)return t;for(var i,r,s=e,n=t,a=T,o=R,u=G[a],l=0,c=1;c<=o;c++)r=k(s&u,(c-1)*a),i=k(n&u,(c-1)*a),32!==a&&(i=16===a?(r=4278190080|ji(r),4278190080|ji(i)):(r=4278190080|qi(r,a,32),4278190080|qi(i,a,32))),r=_i(r,i),l|=P(r=32!==a?qi(r,32,a):r,(c-1)*a),u=P(u,a);return l}function Vi(e,t){for(var i,r,s,n,a=G[T],o=16===T?(r=5,31):(r=8,255),u=D,l=t,c=e,h=1;h<=R;h++)0<(u&a)&&(n=l&a,i=c&a,s=T<16?i==n?0:1:((s=gi(i,n,r,3))&o)+(k(s,r)&o)+(k(k(s,r),r)&o),be+=s),u=k(u,T),c=k(c,T),l=k(l,T);return t}function ji(e){return(31&e)<<3|(992&e)<<6|(31744&e)<<9}function qi(e,t,i){var r,s,n,a;return 0<(r=i-t)?(a=P(1,t)-1,s=(n=P(e,r))&(a=P(a,r)),a=P(a,i),s+((n=P(n,r))&a)+(P(n,r)&P(a,i))):0==r?5===t?32767&e:8===t?16777215&e:e:0===e?e:(a=P(1,i)-1,s=(n=k(e,r=t-i))&a,a=P(a,i),0===(s=s+((n=k(n,r))&a)+(k(n,r)&P(a,i)))?1:s)}function Mi(e,t){return T<16?di(e,t,T,R):16===T?di(e,t,5,3)+(di(e>>>16,t>>>16,5,3)<<16):di(e,t,8,4)}function Bi(e,t){return T<16?mi(e,t,T,R):16===T?mi(e,t,5,3)+(mi(e>>>16,t>>>16,5,3)<<16):mi(e,t,8,4)}function Ni(e,t){e=~e;return T<16?mi(e,t,T,R):16===T?mi(e,t,5,3)+(mi(e>>>16,t>>>16,5,3)<<16):mi(e,t,8,4)}function Ti(e,t){return T<16?vi(e,t,T,R):16===T?vi(e,t,5,3)+(vi(e>>>16,t>>>16,5,3)<<16):vi(e,t,8,4)}function Ei(e,t){return T<16?gi(e,t,T,R):16===T?gi(e,t,5,3)+(gi(e>>>16,t>>>16,5,3)<<16):gi(e,t,8,4)}function Li(e){return!1!=((K=e).majorVersion()==t)&&K.minorVersion()>=i}function Di(){var e,t=e=0;if(!(Z<=8)){if(16===Z&&(t=5),0===Ie){if(T<=8)return;16===T&&(e=5),32===T&&(e=8)}else e=Ie;Ri(t=32===Z?8:t,e)}}function Ri(e,t){var i,r=[0,0,0,0],s=[0,0,0,0],n=t-e;0!=n&&(n<=0?(i=P(1,t)-1,s[ke]=P(i,2*e-n),s[ve]=P(i,e-n),s[ae]=P(i,0-n),s[a]=0):(i=P(1,e)-1,s[ke]=P(i,2*e),s[ve]=P(i,e),s[ae]=i),r[ke]=3*n,r[ve]=2*n,r[ae]=n,r[a]=0,Ce=r,we=s,M=M|ce|oe)}function Wi(){K.showDisplayBitsLeftTopRightBottom(xe,d,v,m,p)}function zi(e,t){return e}function Ui(e,t){return e-t}function Ki(e,t){var i,r,s,n,a;if((M&(ce|ue))==(ce|ue))for(i=G[T],r=t,n=D,s=1;s<=R;s++)0!=(n&i)&&(a=r&i,Gi(a=T<16?a:qi(a,16===T?5:8,Ie),Hi(a)+1)),n=k(n,T),r=k(r,T);return t}function Hi(e){return Fe[e&Oe]}function Gi(e,t){Fe[e&Oe]=t}function Xi(){var e,t,i,r;Ue&&(ht||ui())&&(i=ht,r=!1,"number"==typeof(e=K.fetchPointerofObject(fe,xe))&&(i(e,d,v,m-d,p-v),r=!(N=g=0)),Ye||"number"==typeof(t=K.fetchPointerofObject(fe,it))&&(r&&t===e||i(t,0,0,0,0),y=I=0),Ue=!1)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:Fi,copyBits:Rt,moduleUnloaded:hi,primitiveDrawLoop:wi,primitiveDisplayString:Oi,initialiseModule:ri,loadBitBltFrom:ni,setInterpreter:Li,primitiveWarpBits:Ai,getModuleName:$t,primitivePixelValueAt:Ci,copyBitsFromtoat:Wt}):self.setTimeout(e,100)}()}(),registerCroquetPlugin(),!function(){var t=1,i=11;function r(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function v(e,t){return 31<t?0:e<<t}var g=0,k=null,s=0,n=null,e="FFTPlugin 3 November 2014 (e)",b=0,a=null,o=0,y=null,u=0,S=null,I=0;function l(e){return n.success(n.isWords(e)),n.failed()?0:e.wordsAsFloat32Array()}function c(){return e}function h(e){var t,i;return n.success(6<=r(e)),!n.failed()&&(b=n.fetchIntegerofObject(0,e),g=n.fetchIntegerofObject(1,e),t=n.fetchPointerofObject(2,e),I=r(t),S=l(t),t=n.fetchPointerofObject(3,e),o=r(t),i=t,n.success(n.isWords(i)),a=i.words,t=n.fetchPointerofObject(4,e),u=r(t),y=l(t),t=n.fetchPointerofObject(5,e),s=r(t),k=l(t),n.success(v(1,b)===g&&1+(g>>2)===I&&g===u&&g===s&&u===s),!1===n.failed())}function f(){for(var e,t,i,r=0,s=o;r<s;){if(e=a[r]-1,t=a[r+1]-1,!(e<u&&t<u))return n.success(!1);i=y[e],y[e]=y[t],y[t]=i,i=k[e],k[e]=k[t],k[t]=i,r+=2}}function p(){if(!h(n.stackObjectValue(0)))return null;f(),n.failed()&&f()}function d(){if(!h(n.stackObjectValue(0)))return null;F()}function m(){var e=n.booleanValueOf(n.stackValue(0));if(!h(n.stackObjectValue(1)))return null;!function(e){if(f(),n.failed())return f();(function(e){var t,i,r,s,n,a,o,u,l,c,h,f,p,d,m;for(i=g>>1,r=g>>2,f=1;f<=b;f++)for(c=v(1,f),h=c>>1,t=function(e,t){return 0|Math.floor(e/t)}(g,c),l=1;l<=h;l++)for(o=(m=(l-1)*t)<r?(d=S[I-m-1],S[m]):(d=0-S[m-r],S[i-m]),e||(o=0-o),s=l;s<=g;)n=s-1,p=y[u=s+h-1]*d-k[u]*o,a=y[u]*o+k[u]*d,y[u]=y[n]-p,k[u]=k[n]-a,y[n]=y[n]+p,k[n]=k[n]+a,s+=c})(e),e||F()}(e),n.failed()||n.pop(1)}function F(){var e,t;if(!(g<=1))for(t=1/g,e=0;e<=g-1;e++)y[e]=y[e]*t,k[e]=k[e]*t}function O(e){return!1!=((n=e).majorVersion()==t)&&n.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("FFTPlugin",{primitiveFFTTransformData:m,setInterpreter:O,primitiveFFTPermuteData:p,primitiveFFTScaleData:d,getModuleName:c}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function o(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}var u=null,e="FloatArrayPlugin 3 November 2014 (e)";function r(){return e}function s(){var e,t,i,r,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(i=o(s),u.success(i===o(n)),u.failed())return null;for(r=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=i-1;t++)r[t]=r[t]+e[t];u.pop(1)}function n(){var e,t,i,r=u.stackFloatValue(0),s=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),i=s.wordsAsFloat32Array(),e=0;e<=t-1;e++)i[e]=i[e]+r;u.pop(1)}function a(){var e=u.stackIntegerValue(0),t=u.stackObjectValue(1);return u.failed()||(u.success(u.isWords(t)),u.success(0<e&&e<=o(t)),u.failed())?null:(t=t.wordsAsFloat32Array()[e-1],u.pop(2),void u.pushFloat(t))}function l(){var e=u.stackValue(0),t="number"==typeof e?e:u.floatValueOf(e),i=u.stackIntegerValue(1),r=u.stackObjectValue(2);return u.failed()||(u.success(u.isWords(r)),u.success(0<i&&i<=o(r)),u.failed())?null:(r.wordsAsFloat32Array()[i-1]=t,void(u.failed()||u.popthenPush(3,e)))}function c(){var e,t,i,r,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(i=o(s),u.success(i===o(n)),u.failed())return null;for(r=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=i-1;t++)if(0===e[t])return u.primitiveFail();for(t=0;t<=i-1;t++)r[t]=r[t]/e[t];u.pop(1)}function h(){var e,t,i,r,s=u.stackFloatValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(0===s)return u.primitiveFail();if(u.success(u.isWords(n)),u.failed())return null;for(i=o(n),r=n.wordsAsFloat32Array(),t=1/s,e=0;e<=i-1;e++)r[e]=r[e]*t;u.pop(1)}function f(){var e,t,i,r,s,n=u.stackObjectValue(0),a=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(n)),u.success(u.isWords(a)),u.failed())return null;if(i=o(n),u.success(i===o(a)),u.failed())return null;for(r=a.wordsAsFloat32Array(),e=n.wordsAsFloat32Array(),t=s=0;t<=i-1;t++)s+=r[t]*e[t];u.pop(2),u.pushFloat(s)}function p(){var e,t,i,r,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(u.pop(2),(i=o(s))!==o(n))return u.pushBool(!1);for(r=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=i-1;t++)if(r[t]!==e[t])return u.pushBool(!1);return u.pushBool(!0)}function d(){var e,t,i,r,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),i=s.wordsAsInt32Array(),e=r=0;e<=t-1;e++)r+=i[e];return u.pop(1),u.pushInteger(536870911&r)}function m(){var e,t,i,r,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),u.success(!0),i=s.wordsAsFloat32Array(),e=r=0;e<=t-1;e++)r+=i[e]*i[e];r=Math.sqrt(r),u.popthenPush(1,u.floatObjectOf(r))}function v(){var e,t,i,r,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(i=o(s),u.success(i===o(n)),u.failed())return null;for(r=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=i-1;t++)r[t]=r[t]*e[t];u.pop(1)}function g(){var e,t,i,r=u.stackFloatValue(0),s=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),i=s.wordsAsFloat32Array(),e=0;e<=t-1;e++)i[e]=i[e]*r;u.pop(1)}function k(){var e,t,i,r,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(i=o(s),u.success(!0),r=s.wordsAsFloat32Array(),e=t=0;e<=i-1;e++)t+=r[e]*r[e];if(u.success(0<t),u.failed())return null;for(t=Math.sqrt(t),e=0;e<=i-1;e++)r[e]=r[e]/t}function b(){var e,t,i,r,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(i=o(s),u.success(i===o(n)),u.failed())return null;for(r=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=i-1;t++)r[t]=r[t]-e[t];u.pop(1)}function y(){var e,t,i,r=u.stackFloatValue(0),s=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),i=s.wordsAsFloat32Array(),e=0;e<=t-1;e++)i[e]=i[e]-r;u.pop(1)}function S(){var e,t,i,r,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),i=s.wordsAsFloat32Array(),e=r=0;e<=t-1;e++)r+=i[e];u.popthenPush(1,u.floatObjectOf(r))}function I(e){return!1!=((u=e).majorVersion()==t)&&u.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:v,primitiveEqual:p,primitiveAtPut:l,primitiveAt:a,primitiveNormalize:k,primitiveSubFloatArray:b,primitiveDivFloatArray:c,primitiveAddScalar:n,primitiveDotProduct:f,primitiveSubScalar:y,setInterpreter:I,primitiveSum:S,getModuleName:r,primitiveHashArray:d,primitiveMulScalar:g,primitiveLength:m,primitiveAddFloatArray:s,primitiveDivScalar:h}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function W(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function z(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}var U=null,r="GeniePlugin v2.0 14 November 2014 (e)";function K(e,t){var i=e[0],e=e[1],i=t[0]-i,t=t[1]-e;return i*i+t*t}function s(){return r}function H(e){console.log(r+": "+e)}function n(){var N,T,e,t,i,r,E,s,n,a,o,u,l,c,h,L,f,p,d,m,v,g,k,b,y,D,S,I,F=U.stackValue(11),O=U.stackValue(10),w=U.stackValue(9),C=U.stackValue(8),A=U.stackValue(7),P=U.stackValue(6),_=U.stackValue(5),x=U.stackValue(4),R=U.stackIntegerValue(3),V=U.stackValue(2),j=U.stackValue(1),q=U.stackValue(0);if(!U.failed())if(U.failed())H("failed 1");else if(U.success(U.isWords(F)&&U.isWords(O)&&U.isWords(w)&&U.isWords(C)&&U.isWords(A)&&U.isWords(P)&&U.isWords(_)&&U.isWords(x)&&U.isWords(V)&&U.isWords(j)&&U.isWords(q)),U.failed())H("failed 2");else if(U.success(U.isMemberOf(F,"PointArray")&&U.isMemberOf(O,"PointArray")),U.failed())H("failed 3");else if(a=F.wordsAsInt32Array(),h=O.wordsAsInt32Array(),L=w.wordsAsInt32Array(),E=C.wordsAsInt32Array(),u=A.wordsAsInt32Array(),n=P.wordsAsInt32Array(),D=_.wordsAsInt32Array(),N=x.wordsAsInt32Array(),p=V.wordsAsInt32Array(),S=j.wordsAsInt32Array(),f=q.wordsAsInt32Array(),O=W(O)>>>1,k=W(w)>>>1,s=W(C)>>>1,w=W(P),C=W(V),U.success(C===W(j)&&C===W(q)&&s<C),U.failed())H("failed 4");else if(U.success(W(A)>=k-1&&W(F)>>>1>=k&&s-1<=w&&s<=O&&W(_)>=k-1&&W(x)>=s-1),U.failed())H("failed 5");else if(P=R>>>1,l=(T=1&R)?0:P*P>>>10,f[S[p[0]=0]=0]=2,v=0-l,(o=s)-1<=O&&o-1<=w){for(m=1;m<=o;m++)v=v+(n[e=m-1]+K(z(h,e<<1),a)>>>7)+l,S[m]=v,p[m]=v*m,f[m]=m+1;for(v=S[0]-l,g=1;g<=k;g++){for(y=p[0],v=v+(u[t=g-1]+K(z(a,d=t<<1),h)>>>7)+l,S[0]=v,p[0]=v*g,f[0]=g+1,o=s,m=1;m<=o;m++)M=(e=m-1)<<1,b=p[m],I=p[e],c=u[t]+K(z(a,d),z(h,m<<1))>>>7,0===(v=S[m])?b+=c:(b=b+v+c*f[m],c+=v),r=n[e]+K(z(h,M),z(a,g<<1))>>>7,0===(v=S[e])?I+=r:(I=I+v+r*f[e],r+=v),T?y=1<<29:y+=(K(z(E,M),z(L,d))+K(z(h,M),z(a,d)))*(16+(M=N[e],B=D[t],(B=180<(B=Math.abs(B-M))?360-B:B)*B>>>6))>>>11,M=y<=b&&y<=I?(i=y,v=0,1):b<=I?(i=b,v=c+l,f[m]+1):(i=I,v=r+l,f[e]+1),y=p[m],p[m]=Math.min(i,1<<29),S[m]=Math.min(v,1<<29),f[m]=M;v=S[0]}var M,B,V=i;U.failed()||U.popthenPush(13,V)}else U.primitiveFail();return null}function a(){return U.failed()||U.popthenPush(1,2e3),null}function o(e){return!1!=((U=e).majorVersion()==t)&&U.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("GeniePlugin",{primVersionNO:a,setInterpreter:o,primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:n,getModuleName:s}):self.setTimeout(e,100)}()}(),!function(){var t=1,E=11;function O(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function n(e,t){return 0|Math.floor(e/t)}function i(e,t){return 31<t?0:e<<t}var a=5,o=2,u=0,l=1,w=8,C=64,A=2446,L=22554,P=3196,_=4433,D=46802,x=6270,R=7373,W=9633,z=91881,U=12299,K=116130,H=15137,G=16069,X=16819,Z=20995,J=25172,c=1,h=2,Y=4,f=8,Q=16,$=128,V=255,ee=11,p=10,te=0,j=127,d=3,ie=null,re=0,se=new Array(128),m=new Array(11),ne=new Array(128),v=new Array(11),ae=null,oe=0,g=0,q=null,k=null,b=0,ue=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],r=0,s=0,y=null,S=0,I=0,e="JPEGReaderPlugin 3 November 2014 (e)",F=null,le=new Array(128),M=new Array(11);function B(e,t){return"number"!=typeof t&&!!q.isPointers(t)&&!(O(t)<ee||(e[u]=q.fetchIntegerofObject(u,t),e[l]=q.fetchIntegerofObject(l,t),e[h]=q.fetchIntegerofObject(h,t),e[d]=q.fetchIntegerofObject(d,t),e[a]=q.fetchIntegerofObject(a,t),e[f]=q.fetchIntegerofObject(f,t),e[p]=q.fetchIntegerofObject(p,t),q.failed()))}function N(e,t){var i,r,s,n;if("number"==typeof t)return!1;if(!q.isPointers(t))return!1;if(O(t)<ee)return!1;if("number"==typeof(i=q.fetchPointerofObject(Y,t)))return!1;if(!q.isPointers(i))return!1;if(n=O(i),$<n)return!1;for(s=0;s<=n-1;s++){if("number"==typeof(r=q.fetchPointerofObject(s,i)))return!1;if(!q.isWords(r))return!1;if(O(r)!==C)return!1;e[s]=r.wordsAsInt32Array()}return!q.failed()}function ce(){var e,t,i,r,s;for(M[u]=0,M[l]=0,m[u]=0,m[l]=0,v[u]=0,i=v[l]=0;i<=b-1;i++)s=pe(),e=function(){var e,t,i,r,s;t=e=m[u],i=m[l],r=m[h],s=m[d],0!==r&&0!==s&&(t=n(t,r),i=n(i,s));r=(i>>>3)*m[a]+(t>>>3),s=((7&i)<<3)+(7&t),i=se[r][s],++e<8*m[f]?m[u]=e:(m[u]=0,m[l]++);return i}(),e-=j,t=function(){var e,t,i,r,s;t=e=v[u],i=v[l],r=v[h],s=v[d],0!==r&&0!==s&&(t=n(t,r),i=n(i,s));r=(i>>>3)*v[a]+(t>>>3),s=((7&i)<<3)+(7&t),i=ne[r][s],++e<8*v[f]?v[u]=e:(v[u]=0,v[l]++);return i}(),r=s+(z*(t-=j)>>16)+F[te],r=Math.min(r,V),r=Math.max(r,0),F[te]=r&g,r&=V-g,r=Math.max(r,1),t=s-(L*e>>16)-(D*t>>16)+F[c],t=Math.min(t,V),t=Math.max(t,0),F[c]=t&g,t&=V-g,t=Math.max(t,1),s=s+(K*e>>16)+F[o],s=Math.min(s,V),s=Math.max(s,0),F[o]=s&g,s&=V-g,s=Math.max(s,1),k[i]=4278190080+(r<<16)+(t<<8)+s}function T(e){var t;return s<e&&(function(){for(var e;s<=16;){if(!(S<I))return;if(e=y[S],++S,255===e){if(!(S<I&&0===y[S]))return--S;++S}r=r<<8|e,s+=8}}(),s<e)?-1:(t=r,r&=i(1,e=s-=e)-1,31<e?0:t>>>e)}function he(){return e}function fe(e,t){var i,r,s=e[0]>>>24;if(!(Q<s))for(i=2;;){if((r=T(s))<0)return-1;if(t<=(r=i+r-1))return-1;if(0==(1056964608&(r=e[r])))return r;if(i=65535&r,Q<(s=r>>>24&255))return-1}return-1}function pe(){var e,t=e=M[u],i=M[l],r=M[h],s=M[d];return 0!==r&&0!==s&&(t=n(t,r),i=n(i,s)),r=(i>>>3)*M[a]+(t>>>3),s=le[r][((7&i)<<3)+(7&t)],++e<8*M[f]?M[u]=e:(M[u]=0,M[l]++),s}function de(){var e,t,i;if(4!==q.methodArgumentCount())return q.primitiveFail();if(g=q.stackIntegerValue(0),e=q.stackObjectValue(1),q.failed())return null;if(!q.isWords(e)||3!==O(e))return q.primitiveFail();if(F=e.wordsAsInt32Array(),e=q.stackObjectValue(2),q.failed())return null;if(!q.isWords(e))return q.primitiveFail();if(b=O(e),k=e.wordsAsInt32Array(),e=q.stackObjectValue(3),q.failed())return null;if(!ye(e))return q.primitiveFail();for(M[u]=0,t=M[l]=0;t<=b-1;t++)i=pe(),i+=F[c],i=Math.min(i,V),F[c]=i&g,i&=V-g,i=Math.max(i,1),k[t]=4278190080+(i<<16)+(i<<8)+i;q.pop(4)}function me(){var e,t;return 4!==q.methodArgumentCount()?q.primitiveFail():(g=q.stackIntegerValue(0),e=q.stackObjectValue(1),q.failed()?null:q.isWords(e)&&3===O(e)?(F=e.wordsAsInt32Array(),e=q.stackObjectValue(2),q.failed()?null:q.isWords(e)?(b=O(e),k=e.wordsAsInt32Array(),e=q.stackObjectValue(3),q.failed()?null:q.isPointers(e)&&3===O(e)&&ye(q.fetchPointerofObject(0,e))&&(t=q.fetchPointerofObject(1,e),B(m,t))&&N(se,t)&&(t=q.fetchPointerofObject(2,e),B(v,t))&&N(ne,t)?(ce(),void q.pop(4)):q.primitiveFail()):q.primitiveFail()):q.primitiveFail())}function ve(){var e,t,i;return 5!==q.methodArgumentCount()?q.primitiveFail():(i=q.stackObjectValue(0),q.failed()?null:O(e=i)<5||!q.isPointers(e)||"number"==typeof(t=q.fetchPointerofObject(0,e))||!q.isBytes(t)||(y=t.bytes,t=(t=t).bytes?t.bytes.length:t.words?4*t.words.length:0,S=q.fetchIntegerofObject(1,e),I=q.fetchIntegerofObject(2,e),r=q.fetchIntegerofObject(3,e),s=q.fetchIntegerofObject(4,e),q.failed())||(t<I||S<0||I<=S)?q.primitiveFail():(e=q.stackObjectValue(1),q.failed()?null:q.isWords(e)?(re=O(e),ie=e.wordsAsInt32Array(),e=q.stackObjectValue(2),q.failed()?null:q.isWords(e)?(oe=O(e),ae=e.wordsAsInt32Array(),i=q.stackObjectValue(3),q.failed()?null:B(M,i)?(e=q.stackObjectValue(4),q.failed()?null:!q.isWords(e)||O(e)!==C?q.primitiveFail():(t=e.wordsAsInt32Array(),q.failed()||(function(e,t){var i,r,s,n=fe(ae,oe);if(n<0)return q.primitiveFail();for(0!==n&&(n=ke(T(n),n)),n=t[p]=t[p]+n,e[0]=n,i=1;i<=C-1;i++)e[i]=0;for(r=1;r<C;){if((n=fe(ie,re))<0)return q.primitiveFail();if(s=n>>>4,0!==(n&=15)){if(r+=s,n=ke(T(n),n),r<0||C<=r)return q.primitiveFail();e[ue[r]]=n}else{if(15!=s)return;r+=s}++r}}(t,M),q.failed())?null:(i=q.stackValue(0),q.storeIntegerofObjectwithValue(1,i,S),q.storeIntegerofObjectwithValue(3,i,r),q.storeIntegerofObjectwithValue(4,i,s),q.storeIntegerofObjectwithValue(p,q.stackValue(3),M[p]),void q.pop(5)))):q.primitiveFail()):q.primitiveFail()):q.primitiveFail()))}function ge(){var e,t;if(2!==q.methodArgumentCount())return q.primitiveFail();if(e=q.stackObjectValue(0),q.failed())return null;if(!q.isWords(e)||O(e)!==C)return q.primitiveFail();if(t=e.wordsAsInt32Array(),e=q.stackObjectValue(1),q.failed())return null;if(!q.isWords(e)||O(e)!==C)return q.primitiveFail();for(var i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g,k,b,y=e.wordsAsInt32Array(),S=t,I=new Array(64),F=0;F<=w-1;F++){for(i=-1,n=1;n<=w-1;n++)-1===i&&0!==y[n*w+F]&&(i=n);if(-1===i)for(r=y[F]*S[0]<<2,s=0;s<=w-1;s++)I[s*w+F]=r;else f=(m=((v=y[2*w+F]*S[2*w+F])+(g=y[6*w+F]*S[6*w+F]))*_)+g*(0-H),p=m+v*x,u=(a=(v=y[F]*S[F])+(g=y[4*w+F]*S[4*w+F])<<13)+p,h=a-p,l=(o=v-g<<13)+f,c=o-f,a=y[7*w+F]*S[7*w+F],o=y[5*w+F]*S[5*w+F],f=y[3*w+F]*S[3*w+F],m=a+(p=y[w+F]*S[w+F]),v=o+f,g=a+f,k=o+p,p*=U,a=(a*=A)+(m*=0-R)+(g=g*(0-G)+(b=(g+k)*W)),o=(o*=X)+(v*=0-Z)+(k=k*(0-P)+b),f=(f*=J)+v+g,I[F]=u+(p=p+m+k)>>11,I[7*w+F]=u-p>>11,I[+w+F]=l+f>>11,I[6*w+F]=l-f>>11,I[2*w+F]=c+o>>11,I[5*w+F]=c-o>>11,I[3*w+F]=h+a>>11,I[4*w+F]=h-a>>11}for(F=0;F<=C-w;F+=w)v=I[F+2],g=I[F+6],u=(a=I[F]+I[F+4]<<13)+(p=(m=(v+g)*_)+v*x),h=a-p,l=(o=I[F]-I[F+4]<<13)+(f=m+g*(0-H)),c=o-f,a=I[F+7],o=I[F+5],f=I[F+3],m=a+(p=I[F+1]),v=o+f,g=a+f,a=(a*=A)+(m*=0-R)+(g=g*(0-G)+(b=(g+(k=o+p))*W)),o=(o*=X)+(v*=0-Z)+(k=k*(0-P)+b),f=(f*=J)+v+g,p=(p*=U)+m+k,d=Math.min((u+p>>18)+j,V),d=Math.max(d,0),y[F]=d,d=Math.min((u-p>>18)+j,V),d=Math.max(d,0),y[F+7]=d,d=Math.min((l+f>>18)+j,V),d=Math.max(d,0),y[F+1]=d,d=Math.min((l-f>>18)+j,V),d=Math.max(d,0),y[F+6]=d,d=Math.min((c+o>>18)+j,V),d=Math.max(d,0),y[F+2]=d,d=Math.min((c-o>>18)+j,V),d=Math.max(d,0),y[F+5]=d,d=Math.min((h+a>>18)+j,V),d=Math.max(d,0),y[F+3]=d,d=Math.min((h-a>>18)+j,V),d=Math.max(d,0),y[F+4]=d;q.pop(2)}function ke(e,t){return e<i(1,t-1)?e-i(1,t)+1:e}function be(e){return!1!=((q=e).majorVersion()==t)&&q.minorVersion()>=E}function ye(e){return B(M,e)&&N(le,e)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:be,primitiveIdctInt:ge,primitiveColorConvertMCU:me,primitiveColorConvertGrayscaleMCU:de,primitiveDecodeMCU:ve,getModuleName:he}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function y(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function p(e,t){return 0|Math.floor(e/t)}function s(e,t){return e-p(e,t)*t|0}var S=null,n=0,e="KedamaPlugin 3 November 2014 (e)",a=0,r=0,o=0,u=0;function k(e,t){var i;return 0===e?0<=t?90:270:(i=Math.atan(t/e),0<=e?0<=t?i/.0174532925199433:360+i/.0174532925199433:180+i/.0174532925199433)}function l(e){var e=90-e,t=e/360|0;return e<0&&--t,.0174532925199433*(e-360*t)}function c(){var e,t,i,r,s,n,a,o,u,l=S.stackValue(0),c=S.stackValue(1),h=S.stackValue(2),f=S.stackValue(3),p=S.stackIntegerValue(4),d=S.stackIntegerValue(5),m=S.stackValue(6);if(S.failed())return null;if(!S.isWords(m))return S.primitiveFail(),null;if(!S.isWords(f))return S.primitiveFail(),null;if(!S.isWords(h))return S.primitiveFail(),null;if(!S.isWords(c))return S.primitiveFail(),null;if(!S.isBytes(l))return S.primitiveFail(),null;if(p*d!==y(m))return S.primitiveFail(),null;if(r=y(f),y(h)!==r)return S.primitiveFail(),null;if(y(c)!==r)return S.primitiveFail(),null;if(y(l)!==r)return S.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),u=h.wordsAsFloat32Array(),e=c.words,s=l.bytes,t=m.words,i=0;i<=r-1;i++)n=0|a[i],o=0|u[i],0!==s[i]&&0<=n&&0<=o&&n<d&&o<p&&(t[o*d+n]=e[i]);if(S.failed())return null;S.pop(7)}function h(){var e,t,i,r,s,n=S.stackValue(0),a=S.stackValue(1);if(S.failed())return null;if(!S.isWords(a))return S.primitiveFail(),null;if(!S.isWords(n))return S.primitiveFail(),null;if(s=y(a),y(n)!==s)return S.primitiveFail(),null;for(t=a.wordsAsFloat32Array(),r=n.wordsAsFloat32Array(),i=0;i<=s-1;i++)e=t[i],0<(e=90-(e/=.0174532925199433))||(e+=360),r[i]=e;if(S.failed())return null;S.pop(2)}function f(){return e}function d(){var e=S.stackValue(0),t=S.stackIntegerValue(1);return S.failed()?null:!S.isWords(e)||y(e)<t?(S.primitiveFail(),null):(e=q(e.wordsAsFloat32Array()[t-1]),S.failed()?null:(S.pop(3),void S.pushFloat(e)))}function m(){n=17,o=p(r=2147483647,a=16807),u=s(r,a)}function v(e){var t=e<0?0-e:e,i=p(n,o),r=s(n,o),r=(65535&(n=a*r-u*i))*(t+1)>>>16;return e<0?0-r:r}function g(){var e=S.stackIntegerValue(0);if(S.failed())return null;n=65536&e,S.pop(1)}function b(){var e,t,i,r,s,n,a=S.stackIntegerValue(0),o=S.stackIntegerValue(1),u=S.stackValue(2),l=S.stackValue(3);if(S.failed())return null;if((t=y(l))!==y(u))return S.primitiveFail(),null;if(a<-32)return S.primitiveFail(),null;if(8<a)return S.primitiveFail(),null;for(e=l.words,r=u.words,i=0;i<=t-1;i++)s=e[i],s=s,(s=255<(s=(n=a)<0?n<-31?0:s>>>0-n:31<n?0:s<<n)?255:s)<0&&(s=0),r[i]=s<<24&4278190080|o;S.pop(4)}function I(){var e,t,i,r,s,n,a=S.stackValue(0),o=S.stackIntegerValue(1),u=S.stackValue(2),l=S.stackValue(3);if(S.failed())return null;if(a=a.words[0],S.failed())return null;if(n=Math.log(a),(i=y(l))!==y(u))return S.primitiveFail(),null;for(e=l.words,s=u.words,r=0;r<=i-1;r++)255<(t=0===(t=e[r])?0:255/n*Math.log(t)|0)&&(t=255),s[r]=t<<24&4278190080|o;S.pop(4)}function F(){var e,t,i,r,s,n,a,o=S.stackIntegerValue(0),u=S.stackIntegerValue(1),l=S.stackValue(2),c=S.stackValue(3),h=S.stackValue(4),f=S.stackValue(5);if(!S.isWords(l))return S.primitiveFail(),null;if(!S.isWords(c))return S.primitiveFail(),null;if(!S.isWords(h))return S.primitiveFail(),null;if(!S.isWords(f))return S.primitiveFail(),null;if(i=y(h),y(c)!==i)return S.primitiveFail(),null;if(y(l)!==i)return S.primitiveFail(),null;if(y(f)!==o*u)return S.primitiveFail(),null;for(n=c.wordsAsFloat32Array(),a=l.wordsAsFloat32Array(),r=h.words,t=f.words,e=0;e<=o*u-1;e++)t[e]=0;for(e=0;e<=i-1;e++)s=n[e],0<=(s=u*a[e]+s)&&s<o*u&&(t[s]=r[e]);if(S.failed())return null;S.pop(6)}function O(){var e=S.stackIntegerValue(0),t=S.stackIntegerValue(1),i=S.stackFloatValue(2),r=S.stackFloatValue(3),s=S.stackValue(4);return S.failed()?null:!S.isWords(s)||y(s)!==e*t?(S.primitiveFail(),null):(i=0|i,s=s.words,e=0<=(r=0|r)&&r<t&&0<=i&&i<e?s[i*t+r]:0,S.failed()?null:(S.pop(6),void S.pushInteger(e)))}function w(){var e,t=S.stackIntegerValue(0),i=S.stackIntegerValue(1),r=S.stackIntegerValue(2),s=S.stackFloatValue(3),n=S.stackFloatValue(4),a=S.stackValue(5);return S.failed()?null:!S.isWords(a)||y(a)!==t*i?(S.primitiveFail(),null):(s=0|s,(e=1073741823<(e=r)?1073741823:r)<0&&(e=0),r=a.words,0<=(a=0|n)&&a<i&&0<=s&&s<t&&(r[s*i+a]=e),S.failed()?null:void S.pop(6))}function C(){var e,t,i,r,s,n,a,o,u=S.stackValue(0),l=S.stackIntegerValue(1),c=S.stackIntegerValue(2),h=S.stackValue(3),f=S.stackValue(4),p=S.stackValue(5);if(S.failed())return null;if(!S.isWords(u))return S.primitiveFail(),null;if(!S.isWords(p))return S.primitiveFail(),null;if(!S.isWords(f))return S.primitiveFail(),null;if(!S.isWords(h))return S.primitiveFail(),null;if(l*c!==y(h))return S.primitiveFail(),null;if(r=y(p),y(f)!==r)return S.primitiveFail(),null;if(y(u)!==r)return S.primitiveFail(),null;for(n=p.wordsAsFloat32Array(),o=f.wordsAsFloat32Array(),t=u.words,e=h.words,i=0;i<=r-1;i++)s=0|n[i],a=0|o[i],0<=s&&0<=a&&s<c&&a<l&&(t[i]=e[a*c+s]);if(S.failed())return null;S.pop(6)}function A(){var e,t=S.stackIntegerValue(0),i=S.stackIntegerValue(1),r=S.stackIntegerValue(2),s=S.stackIntegerValue(3),n=S.stackFloatValue(4),a=S.stackFloatValue(5),o=S.stackFloatValue(6),u=S.stackValue(7),l=S.stackValue(8),c=S.stackValue(9),h=S.stackIntegerValue(10);return S.failed()?null:!S.isWords(c)||!S.isWords(l)||!S.isWords(u)||(e=y(c),y(l)!==e)||y(u)!==e?(S.primitiveFail(),null):(e=c.wordsAsFloat32Array(),c=l.wordsAsFloat32Array(),l=u.wordsAsFloat32Array(),o=e[u=h-1]+(h=o)*Math.cos(l[u]),h=c[u]-h*Math.sin(l[u]),M(u,e,l,o,a,s,r),B(u,c,l,h,n,i,t),S.failed()?null:void S.pop(11))}function P(){var e,t,i,r,s,n,a,o,u,l,c,h=S.stackValue(0),f=S.stackIntegerValue(1),p=S.stackIntegerValue(2),d=S.stackValue(3),m=S.stackValue(4),v=S.stackValue(5);if(S.failed())return null;if(!S.isWords(v))return S.primitiveFail(),null;if(!S.isWords(m))return S.primitiveFail(),null;if(!S.isWords(d))return S.primitiveFail(),null;if(f*p!==y(d))return S.primitiveFail(),null;if(s=y(v),y(m)!==s)return S.primitiveFail(),null;if((r="number"==typeof h)&&(i=h),!r){if(!S.isMemberOf(h,"WordArray"))return S.primitiveFail(),null;if(y(h)!==s)return S.primitiveFail(),null}for(u=v.wordsAsFloat32Array(),c=m.wordsAsFloat32Array(),r||(a=h.words),e=d.words,r&&(n=i),t=0;t<=s-1;t++)o=0|u[t],l=0|c[t],0<=o&&0<=l&&o<p&&l<f&&(r||(n=a[t]),e[l*p+o]=n);if(S.failed())return null;S.pop(6)}function _(){var e,t,i,r,s,n,a,o,u,l,c=S.stackIntegerValue(0),h=S.stackIntegerValue(1),f=S.stackIntegerValue(2),p=S.stackIntegerValue(3),d=S.stackFloatValue(4),m=S.stackFloatValue(5),v=S.stackValue(6),g=S.stackValue(7),k=S.stackValue(8),b=S.stackValue(9);if(S.failed())return null;if(!S.isWords(b))return S.primitiveFail(),null;if(!S.isWords(k))return S.primitiveFail(),null;if(!S.isWords(g))return S.primitiveFail(),null;if(v.isFloat)i=!1;else{if(!S.isWords(v))return S.primitiveFail(),null;i=!0}if(n=y(b),y(k)!==n)return S.primitiveFail(),null;if(y(g)!==n)return S.primitiveFail(),null;if(i&&y(v)!==n)return S.primitiveFail(),null;for(u=b.wordsAsFloat32Array(),l=k.wordsAsFloat32Array(),e=g.wordsAsFloat32Array(),i?o=v.wordsAsFloat32Array():a=S.floatValueOf(v),t=0;t<=n-1;t++)s=i?o[t]:a,r=u[t]+s*Math.cos(e[t]),s=l[t]-s*Math.sin(e[t]),M(t,u,e,r,m,p,f),B(t,l,e,s,d,h,c);if(S.failed())return null;S.pop(10)}function x(){var e,t,i,r,s,n,a,o,u,l,c,h=S.stackIntegerValue(0),f=S.stackIntegerValue(1),p=S.stackIntegerValue(2),d=S.stackValue(3),m=S.stackFloatValue(4),v=S.stackFloatValue(5),g=S.stackFloatValue(6);if(S.failed())return null;if(!S.isWords(d))return S.primitiveFail(),null;if(y(d)!==f*p)return S.primitiveFail(),null;for(e=d.words,d=v,v=Math.max(g,0),d=Math.max(d,0),v=Math.min(v,p-1),d=Math.min(d,f-1),o=Math.max(v-h,0),t=Math.min(v+h,p-1),g=Math.max(d-h,0),i=Math.min(d+h,f-1),r=e[d*p+v],s=-1,c=g;c<=i;c++)for(a=c*p,l=o;l<=t;l++)r<(u=e[a+l])&&(s=l,n=c,r=u);if(h=-1===s?q(m):k(s-v,n-d)+90|0,S.failed())return null;S.pop(8),S.pushFloat(h)}function V(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackObjectValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(h)),S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(a=y(h),S.success(a===y(f)),S.success(a===y(c)),S.failed())return null;if(s=S.isMemberOf(h,"WordArray"),n=S.isMemberOf(f,"WordArray"),s&&n){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]+o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]+e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]+o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]+e[r];S.pop(4),S.push(c)}function j(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(o=y(f),S.success(o===y(c)),S.failed())return null;if(n="number"==typeof h,a=S.isMemberOf(f,"WordArray"),n&&a){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=u[r]+s;else for(u=f.words,e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]+e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]+s;else for(t=f.wordsAsFloat32Array(),e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]+e;S.pop(4),S.push(c)}function N(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackObjectValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(h)),S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(a=y(h),S.success(a===y(f)),S.success(a===y(c)),S.failed())return null;if(s=S.isMemberOf(h,"WordArray"),n=S.isMemberOf(f,"WordArray"),s&&n){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]/o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]/e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]/o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]/e[r];S.pop(4),S.push(c)}function T(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(o=y(f),S.success(o===y(c)),S.failed())return null;if(n="number"==typeof h,a=S.isMemberOf(f,"WordArray"),n&&a){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=p(u[r],s);else for(u=f.words,e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]/e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]/s;else for(t=f.wordsAsFloat32Array(),e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]/e;S.pop(4),S.push(c)}function E(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackObjectValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(h)),S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(a=y(h),S.success(a===y(f)),S.success(a===y(c)),S.failed())return null;if(s=S.isMemberOf(h,"WordArray"),n=S.isMemberOf(f,"WordArray"),s&&n){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]*o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]*e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]*o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]*e[r];S.pop(4),S.push(c)}function L(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(o=y(f),S.success(o===y(c)),S.failed())return null;if(n="number"==typeof h,a=S.isMemberOf(f,"WordArray"),n&&a){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=u[r]*s;else for(u=f.words,e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]*e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]*s;else for(t=f.wordsAsFloat32Array(),e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]*e;S.pop(4),S.push(c)}function D(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackObjectValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(h)),S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(a=y(h),S.success(a===y(f)),S.success(a===y(c)),S.failed())return null;if(s=S.isMemberOf(h,"WordArray"),n=S.isMemberOf(f,"WordArray"),s&&n){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]-o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]-e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]-o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]-e[r];S.pop(4),S.push(c)}function R(){var e,t,i,r,s,n,a,o,u,l,c=S.stackObjectValue(0),h=S.stackValue(1),f=S.stackObjectValue(2);if(S.failed())return null;if(S.success(S.isWords(f)),S.success(S.isWords(c)),S.failed())return null;if(o=y(f),S.success(o===y(c)),S.failed())return null;if(n="number"==typeof h,a=S.isMemberOf(f,"WordArray"),n&&a){if(!S.isMemberOf(c,"WordArray"))return S.primitiveFail(),null}else if(!S.isMemberOf(c,"KedamaFloatArray"))return S.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=u[r]-s;else for(u=f.words,e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]-e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]-s;else for(t=f.wordsAsFloat32Array(),e=S.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]-e;S.pop(4),S.push(c)}function q(e){e=90-e/.0174532925199433;return 0<e||(e+=360),e}function W(){var e,t,i=S.stackFloatValue(0),r=S.stackValue(1),s=S.stackIntegerValue(2),n=S.stackIntegerValue(3),a=S.stackIntegerValue(4);if(S.failed())return null;if(!S.isWords(r))return S.primitiveFail(),null;if(!(s<=y(r)&&1<=n&&n<=s))return S.primitiveFail(),null;if(e=r.wordsAsFloat32Array(),S.failed())return null;for(t=n;t<=s;t++)e[t-1]=v(a)*i;S.pop(5)}function z(){var e,t,i=S.stackFloatValue(0),r=S.stackValue(1),s=S.stackIntegerValue(2),n=S.stackIntegerValue(3),a=S.stackIntegerValue(4);if(S.failed())return null;if(!S.isWords(r))return S.primitiveFail(),null;if(!(s<=y(r)&&1<=n&&n<=s))return S.primitiveFail(),null;if(t=r.words,S.failed())return null;for(e=n;e<=s;e++)t[e-1]=v(a)*i|0;S.pop(5)}function U(){var e=S.stackIntegerValue(0);return S.failed()||(e=v(e),S.failed())?null:(S.pop(2),void S.pushInteger(e))}function K(){var e=S.stackFloatValue(0),t=S.stackFloatValue(1),i=S.stackFloatValue(2),r=S.stackFloatValue(3);return S.failed()||(r=k(r-t,i-e),360<(r+=90)&&(r-=360),S.failed())?null:(S.pop(5),void S.pushFloat(r))}function H(){var e=S.stackFloatValue(0),t=S.stackFloatValue(1),i=S.stackFloatValue(2),r=S.stackFloatValue(3);return S.failed()||(t=t-r,r=e-i,e=Math.sqrt(t*t+r*r),S.failed())?null:(S.pop(5),void S.pushFloat(e))}function M(e,t,i,r,s,n,a){var o;r<0&&(1===n&&(r+=s),2===n&&(r=0),3===n)&&(r=0-r,o=i[e],i[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),s<=r&&(1===a&&(r-=s),2===a&&(r=s-1e-6),3===a)&&(r=s-1e-6-(r-s),o=i[e],i[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),t[e]=r}function B(e,t,i,r,s,n,a){r<0&&(1===n&&(r+=s),2===n&&(r=0),3===n)&&(r=0-r,i[e]=6.283185307179586-i[e]),s<=r&&(1===a&&(r-=s),2===a&&(r=s-1e-6),3===a)&&(r=s-1e-6-(r-s),i[e]=6.283185307179586-i[e]),t[e]=r}function G(){var e,t,i,r,s,n,a=S.stackValue(0),o=S.stackValue(1);if(S.failed())return null;if(!S.isWords(o))return S.primitiveFail(),null;if(n=y(o),a.isFloat)r=!1;else{if(!S.isWords(a))return S.primitiveFail(),null;if(y(a)!==n)return S.primitiveFail(),null;r=!0}for(t=o.wordsAsFloat32Array(),r?s=a.wordsAsFloat32Array():e=l(e=S.floatValueOf(a)),i=0;i<=n-1;i++)r&&(e=l(e=s[i])),t[i]=e;if(S.failed())return null;S.pop(2)}function X(e){return!1!=((S=e).majorVersion()==t)&&S.minorVersion()>=i}function Z(){var e=S.stackFloatValue(0),t=S.stackValue(1),i=S.stackIntegerValue(2);return S.failed()?null:!S.isWords(t)||y(t)<i?(S.primitiveFail(),null):(t.wordsAsFloat32Array()[i-1]=l(e),S.failed()?null:void S.pop(3))}function J(){return!0}function Y(){var e,t=S.stackIntegerValue(0),i=S.stackIntegerValue(1),r=S.stackFloatValue(2),s=S.stackFloatValue(3),n=S.stackValue(4),a=S.stackIntegerValue(5),o=S.stackValue(6);return S.failed()?null:!S.isWords(o)||!S.isWords(n)||(e=y(o),y(n)!==e)?(S.primitiveFail(),null):(M(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,r,i,t),S.failed()?null:void S.pop(7))}function Q(){var e,t=S.stackIntegerValue(0),i=S.stackIntegerValue(1),r=S.stackFloatValue(2),s=S.stackFloatValue(3),n=S.stackValue(4),a=S.stackIntegerValue(5),o=S.stackValue(6);return S.failed()?null:!S.isWords(o)||!S.isWords(n)||(e=y(o),y(n)!==e)?(S.primitiveFail(),null):(B(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,r,i,t),S.failed()?null:void S.pop(7))}function $(){var e,t,i,r,s,n,a,o=S.stackIntegerValue(0),u=S.stackIntegerValue(1),l=S.stackFloatValue(2),c=S.stackValue(3),h=S.stackValue(4),f=S.stackValue(5);if(S.failed())return null;if(!S.isWords(f))return S.primitiveFail(),null;if(!S.isWords(h))return S.primitiveFail(),null;if(c.isFloat)i=!1;else{if(!S.isWords(c))return S.primitiveFail(),null;i=!0}if(r=y(f),y(h)!==r)return S.primitiveFail(),null;if(i&&y(c)!==r)return S.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i?n=c.wordsAsFloat32Array():s=S.floatValueOf(c),t=0;t<=r-1;t++)M(t,a,e,i?n[t]:s,l,u,o);if(S.failed())return null;S.pop(6)}function ee(){var e,t,i,r,s,n,a,o=S.stackIntegerValue(0),u=S.stackIntegerValue(1),l=S.stackFloatValue(2),c=S.stackValue(3),h=S.stackValue(4),f=S.stackValue(5);if(S.failed())return null;if(!S.isWords(f))return S.primitiveFail(),null;if(!S.isWords(h))return S.primitiveFail(),null;if(c.isFloat)i=!1;else{if(!S.isWords(c))return S.primitiveFail(),null;i=!0}if(r=y(f),y(h)!==r)return S.primitiveFail(),null;if(i&&y(c)!==r)return S.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i?n=c.wordsAsFloat32Array():s=S.floatValueOf(c),t=0;t<=r-1;t++)B(t,a,e,i?n[t]:s,l,u,o);if(S.failed())return null;S.pop(6)}function te(){var e,t,i,r,s,n,a,o,u,l,c,h=S.stackValue(0),f=S.stackValue(1),p=S.stackValue(2),d=S.stackValue(3),m=S.stackValue(4);if(S.failed())return null;if(!S.isWords(h))return S.primitiveFail(),null;if(!S.isWords(p))return S.primitiveFail(),null;if(!S.isWords(f))return S.primitiveFail(),null;if((u=y(h))<0)return S.primitiveFail(),null;if(y(p)!==u)return S.primitiveFail(),null;if(y(f)!==u)return S.primitiveFail(),null;if(m.isFloat){if(!d.isFloat)return S.primitiveFail(),null;t=!1}else{if(d.isFloat)return S.primitiveFail(),null;t=!0}if(t){if(y(m)!==u)return S.primitiveFail(),null;if(y(d)!==u)return S.primitiveFail(),null}for(o=h.wordsAsFloat32Array(),l=p.wordsAsFloat32Array(),c=f.wordsAsFloat32Array(),t&&(i=m.wordsAsFloat32Array(),r=d.wordsAsFloat32Array()),t||(s=S.floatValueOf(m),n=S.floatValueOf(d)),e=0;e<=u-1;e++)t&&(s=i[e],n=r[e]),a=k(s-l[e],n-c[e]),360<(a+=90)&&(a-=360),o[e]=a;if(S.failed())return null;S.pop(6),S.push(h)}function ie(){var e,t,i,r,s,n,a,o,u,l,c,h,f=S.stackValue(0),p=S.stackValue(1),d=S.stackValue(2),m=S.stackValue(3),v=S.stackValue(4);if(S.failed())return null;if(!S.isWords(f))return S.primitiveFail(),null;if(!S.isWords(d))return S.primitiveFail(),null;if(!S.isWords(p))return S.primitiveFail(),null;if((o=y(f))<0)return S.primitiveFail(),null;if(y(d)!==o)return S.primitiveFail(),null;if(y(p)!==o)return S.primitiveFail(),null;if(v.isFloat){if(!m.isFloat)return S.primitiveFail(),null;t=!1}else{if(m.isFloat)return S.primitiveFail(),null;t=!0}if(t){if(y(v)!==o)return S.primitiveFail(),null;if(y(m)!==o)return S.primitiveFail(),null}for(a=f.wordsAsFloat32Array(),l=d.wordsAsFloat32Array(),h=p.wordsAsFloat32Array(),t&&(i=v.wordsAsFloat32Array(),r=m.wordsAsFloat32Array()),t||(s=S.floatValueOf(v),n=S.floatValueOf(m)),e=0;e<=o-1;e++)t&&(s=i[e],n=r[e]),u=s-l[e],c=n-h[e],a[e]=Math.sqrt(u*u+c*c);if(S.failed())return null;S.pop(6),S.push(f)}function re(){var e,t,i,r,s,n,a,o,u,l,c,h,f=S.stackIntegerValue(0),p=S.stackIntegerValue(1),d=S.stackIntegerValue(2),m=S.stackIntegerValue(3),v=S.stackValue(4),g=S.stackValue(5);if(S.failed())return null;if(u=y(g),r=y(v),m*d!==u)return S.primitiveFail(),null;if(u*p*f!==r)return S.primitiveFail(),null;for(n=g.words,t=v.words,c=i=o=a=0;c<=d-1;c++){for(h=0;h<=f-1;h++){for(l=0;l<=m-1;l++)for(e=n[a],++a,s=0;s<=p-1;s++)t[i]=e,++i;a=o}a=o+=m}S.pop(6)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:I,vectorGetDistanceTo:ie,getScalarHeading:d,shutdownModule:J,primitiveAddScalar:j,primSetPixelsAtXY:P,turtleScalarSetX:Y,primPixelAtXY:O,primUpHill:x,primScalarForward:A,primitiveDivArrays:N,getModuleName:f,primitiveSubArrays:D,scalarGetAngleTo:K,randomRange:U,setInterpreter:X,kedamaSetRandomSeed:g,drawTurtlesInArray:c,turtleScalarSetY:Q,randomIntoIntegerArray:z,getHeadingArrayInto:h,makeTurtlesMap:F,setHeadingArrayFrom:G,turtlesSetX:$,setScalarHeading:Z,makeMask:b,primitiveDivScalar:T,primitiveSubScalar:R,primPixelsAtXY:C,vectorGetAngleTo:te,primitiveMulArrays:E,primPixelAtXYPut:w,zoomBitmap:re,initialiseModule:m,primitiveAddArrays:V,scalarGetDistanceTo:H,turtlesSetY:ee,randomIntoFloatArray:W,primTurtlesForward:_,primitiveMulScalar:L}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function I(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function p(e,t){return 0|Math.floor(e/t)}function b(e,t){return e-p(e,t)*t|0}var F=null,s=0,e="KedamaPlugin2 13 November 2014 (e)",n=0,r=0,a=0,o=0;function k(e,t){var i;return 0===e?0<=t?90:270:(i=Math.atan(t/e),0<=e?0<=t?i/.0174532925199433:360+i/.0174532925199433:180+i/.0174532925199433)}function c(e){var e=90-e,t=e/360|0;return e<0&&--t,.0174532925199433*(e-360*t)}function u(){var e,t,i,r,s,n,a,o,u,l=F.stackValue(0),c=F.stackValue(1),h=F.stackValue(2),f=F.stackValue(3),p=F.stackIntegerValue(4),d=F.stackIntegerValue(5),m=F.stackValue(6);if(F.failed())return null;if(!F.isWords(m))return F.primitiveFail(),null;if(!F.isWords(f))return F.primitiveFail(),null;if(!F.isWords(h))return F.primitiveFail(),null;if(!F.isWords(c))return F.primitiveFail(),null;if(!F.isBytes(l))return F.primitiveFail(),null;if(p*d!==I(m))return F.primitiveFail(),null;if(r=I(f),I(h)!==r)return F.primitiveFail(),null;if(I(c)!==r)return F.primitiveFail(),null;if(I(l)!==r)return F.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),u=h.wordsAsFloat32Array(),e=c.words,s=l.bytes,t=m.words,i=0;i<=r-1;i++)n=0|a[i],o=0|u[i],0!==s[i]&&0<=n&&0<=o&&n<d&&o<p&&(t[o*d+n]=e[i]);if(F.failed())return null;F.pop(7)}function l(){var e,t,i,r,s,n=F.stackValue(0),a=F.stackValue(1);if(F.failed())return null;if(!F.isWords(a))return F.primitiveFail(),null;if(!F.isWords(n))return F.primitiveFail(),null;if(s=I(a),I(n)!==s)return F.primitiveFail(),null;for(t=a.wordsAsFloat32Array(),r=n.wordsAsFloat32Array(),i=0;i<=s-1;i++)e=t[i],0<(e=90-(e/=.0174532925199433))||(e+=360),r[i]=e;if(F.failed())return null;F.pop(2)}function h(){return e}function f(){var e=F.stackValue(0),t=F.stackIntegerValue(1);return F.failed()?null:!F.isWords(e)||I(e)<t?(F.primitiveFail(),null):(e=q(e.wordsAsFloat32Array()[t-1]),F.failed()?null:(F.pop(3),void F.pushFloat(e)))}function d(){s=17,a=p(r=2147483647,n=16807),o=b(r,n)}function m(e){var t=e<0?0-e:e,i=p(s,a),r=b(s,a),r=(65535&(s=n*r-o*i))*(t+1)>>>16;return e<0?0-r:r}function v(){var e=F.stackIntegerValue(0);if(F.failed())return null;s=65536&e,F.pop(1)}function g(){var e,t,i,r,s,n,a=F.stackIntegerValue(0),o=F.stackIntegerValue(1),u=F.stackValue(2),l=F.stackValue(3);if(F.failed())return null;if((t=I(l))!==I(u))return F.primitiveFail(),null;if(a<-32)return F.primitiveFail(),null;if(8<a)return F.primitiveFail(),null;for(e=l.words,r=u.words,i=0;i<=t-1;i++)s=e[i],s=s,(s=255<(s=(n=a)<0?n<-31?0:s>>>0-n:31<n?0:s<<n)?255:s)<0&&(s=0),r[i]=s<<24&4278190080|o;F.pop(4)}function y(){var e,t,i,r,s,n,a=F.stackValue(0),o=F.stackIntegerValue(1),u=F.stackValue(2),l=F.stackValue(3);if(F.failed())return null;if(a=a.words[0],F.failed())return null;if(n=Math.log(a),(i=I(l))!==I(u))return F.primitiveFail(),null;for(e=l.words,s=u.words,r=0;r<=i-1;r++)255<(t=0===(t=e[r])?0:255/n*Math.log(t)|0)&&(t=255),s[r]=t<<24&4278190080|o;F.pop(4)}function S(){var e,t,i,r,s,n,a,o=F.stackIntegerValue(0),u=F.stackIntegerValue(1),l=F.stackValue(2),c=F.stackValue(3),h=F.stackValue(4),f=F.stackValue(5);if(!F.isWords(l))return F.primitiveFail(),null;if(!F.isWords(c))return F.primitiveFail(),null;if(!F.isWords(h))return F.primitiveFail(),null;if(!F.isWords(f))return F.primitiveFail(),null;if(i=I(h),I(c)!==i)return F.primitiveFail(),null;if(I(l)!==i)return F.primitiveFail(),null;if(I(f)!==o*u)return F.primitiveFail(),null;for(n=c.wordsAsFloat32Array(),a=l.wordsAsFloat32Array(),r=h.words,t=f.words,e=0;e<=o*u-1;e++)t[e]=0;for(e=0;e<=i-1;e++)s=n[e],0<=(s=u*a[e]+s)&&s<o*u&&(t[s]=r[e]);if(F.failed())return null;F.pop(6)}function O(){var e=F.stackIntegerValue(0),t=F.stackIntegerValue(1),i=F.stackFloatValue(2),r=F.stackFloatValue(3),s=F.stackValue(4);return F.failed()?null:!F.isWords(s)||I(s)!==e*t?(F.primitiveFail(),null):(i=0|i,s=s.words,e=0<=(r=0|r)&&r<t&&0<=i&&i<e?s[i*t+r]:0,F.failed()?null:(F.pop(6),void F.pushInteger(e)))}function w(){var e,t=F.stackIntegerValue(0),i=F.stackIntegerValue(1),r=F.stackIntegerValue(2),s=F.stackFloatValue(3),n=F.stackFloatValue(4),a=F.stackValue(5);return F.failed()?null:!F.isWords(a)||I(a)!==t*i?(F.primitiveFail(),null):(s=0|s,(e=1073741823<(e=r)?1073741823:r)<0&&(e=0),r=a.words,0<=(a=0|n)&&a<i&&0<=s&&s<t&&(r[s*i+a]=e),F.failed()?null:void F.pop(6))}function C(){var e,t,i,r,s,n,a,o,u=F.stackValue(0),l=F.stackIntegerValue(1),c=F.stackIntegerValue(2),h=F.stackValue(3),f=F.stackValue(4),p=F.stackValue(5);if(F.failed())return null;if(!F.isWords(u))return F.primitiveFail(),null;if(!F.isWords(p))return F.primitiveFail(),null;if(!F.isWords(f))return F.primitiveFail(),null;if(!F.isWords(h))return F.primitiveFail(),null;if(l*c!==I(h))return F.primitiveFail(),null;if(r=I(p),I(f)!==r)return F.primitiveFail(),null;if(I(u)!==r)return F.primitiveFail(),null;for(n=p.wordsAsFloat32Array(),o=f.wordsAsFloat32Array(),t=u.words,e=h.words,i=0;i<=r-1;i++)s=0|n[i],a=0|o[i],0<=s&&0<=a&&s<c&&a<l&&(t[i]=e[a*c+s]);if(F.failed())return null;F.pop(6)}function A(){var e,t=F.stackIntegerValue(0),i=F.stackIntegerValue(1),r=F.stackIntegerValue(2),s=F.stackIntegerValue(3),n=F.stackFloatValue(4),a=F.stackFloatValue(5),o=F.stackFloatValue(6),u=F.stackValue(7),l=F.stackValue(8),c=F.stackValue(9),h=F.stackIntegerValue(10);return F.failed()?null:!F.isWords(c)||!F.isWords(l)||!F.isWords(u)||(e=I(c),I(l)!==e)||I(u)!==e?(F.primitiveFail(),null):(e=c.wordsAsFloat32Array(),c=l.wordsAsFloat32Array(),l=u.wordsAsFloat32Array(),o=e[u=h-1]+(h=o)*Math.cos(l[u]),h=c[u]-h*Math.sin(l[u]),M(u,e,l,o,a,s,r),B(u,c,l,h,n,i,t),F.failed()?null:void F.pop(11))}function P(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p=F.stackValue(0),d=F.stackIntegerValue(1),m=F.stackIntegerValue(2),v=F.stackValue(3),g=F.stackValue(4),k=F.stackValue(5),b=F.stackValue(6);if(F.failed())return null;if(!F.isBytes(b))return F.primitiveFail(),null;if(!F.isWords(k))return F.primitiveFail(),null;if(!F.isWords(g))return F.primitiveFail(),null;if(!F.isWords(v))return F.primitiveFail(),null;if(d*m!==I(v))return F.primitiveFail(),null;if(a=I(k),I(b)!==a)return F.primitiveFail(),null;if(I(g)!==a)return F.primitiveFail(),null;if(n=b.bytes,c=k.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),r="number"==typeof p)o=p;else{if(I(p)!==a)return F.primitiveFail(),null;(s=F.isMemberOf(p,"WordArray"))?u=p.words:t=p.wordsAsFloat32Array()}for(e=v.words,i=0;i<=a-1;i++)1===n[i]&&(l=0|c[i],h=0|f[i],0<=l)&&0<=h&&l<m&&h<d&&(h=h*m+l,r?e[h]=o:s?e[h]=u[i]:(l=t[i],e[h]=l));if(F.failed())return null;F.pop(7)}function _(){var e,t,i,r,s,n,a,o,u,l,c,h=F.stackIntegerValue(0),f=F.stackIntegerValue(1),p=F.stackIntegerValue(2),d=F.stackIntegerValue(3),m=F.stackFloatValue(4),v=F.stackFloatValue(5),g=F.stackValue(6),k=F.stackValue(7),b=F.stackValue(8),y=F.stackValue(9),S=F.stackValue(10);if(F.failed())return null;if(!F.isBytes(S))return F.primitiveFail(),null;if(!F.isWords(y))return F.primitiveFail(),null;if(!F.isWords(b))return F.primitiveFail(),null;if(!F.isWords(k))return F.primitiveFail(),null;if(g.isFloat)i=!1;else{if(!F.isWords(g))return F.primitiveFail(),null;i=!0}if(a=I(y),I(b)!==a)return F.primitiveFail(),null;if(I(k)!==a)return F.primitiveFail(),null;if(I(S)!==a)return F.primitiveFail(),null;if(i&&I(g)!==a)return F.primitiveFail(),null;for(n=S.bytes,l=y.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),i?u=g.wordsAsFloat32Array():o=F.floatValueOf(g),t=0;t<=a-1;t++)1===n[t]&&(s=i?u[t]:o,r=l[t]+s*Math.cos(e[t]),s=c[t]-s*Math.sin(e[t]),M(t,l,e,r,v,d,p),B(t,c,e,s,m,f,h));if(F.failed())return null;F.pop(11)}function x(){var e,t,i,r,s,n,a,o,u,l,c,h=F.stackIntegerValue(0),f=F.stackIntegerValue(1),p=F.stackIntegerValue(2),d=F.stackValue(3),m=F.stackFloatValue(4),v=F.stackFloatValue(5),g=F.stackFloatValue(6);if(F.failed())return null;if(!F.isWords(d))return F.primitiveFail(),null;if(I(d)!==f*p)return F.primitiveFail(),null;for(e=d.words,d=v,v=Math.max(g,0),d=Math.max(d,0),v=Math.min(v,p-1),d=Math.min(d,f-1),o=Math.max(v-h,0),t=Math.min(v+h,p-1),g=Math.max(d-h,0),i=Math.min(d+h,f-1),r=e[d*p+v],s=-1,c=g;c<=i;c++)for(a=c*p,l=o;l<=t;l++)r<(u=e[a+l])&&(s=l,n=c,r=u);if(h=-1===s?q(m):k(s-v,n-d)+90|0,F.failed())return null;F.pop(8),F.pushFloat(h)}function V(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackObjectValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(h)),F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(a=I(h),F.success(a===I(f)),F.success(a===I(c)),F.failed())return null;if(s=F.isMemberOf(h,"WordArray"),n=F.isMemberOf(f,"WordArray"),s&&n){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]+o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]+e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]+o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]+e[r];F.pop(4),F.push(c)}function j(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(o=I(f),F.success(o===I(c)),F.failed())return null;if(n="number"==typeof h,a=F.isMemberOf(f,"WordArray"),n&&a){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=u[r]+s;else for(u=f.words,e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]+e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]+s;else for(t=f.wordsAsFloat32Array(),e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]+e;F.pop(4),F.push(c)}function N(){var e,t,i,r,s,n,a=F.stackObjectValue(0),o=F.stackValue(1);if(F.failed())return null;if(F.success(F.isBytes(o)),F.success(F.isBytes(a)),F.failed())return null;if(i=I(o),r=I(a),F.failed())return null;for(r<(t=i)&&(t=r),s=a.bytes,n=o.bytes,e=0;e<=t-1;e++)n[e]=n[e]+s[e]===2;F.pop(1)}function T(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackObjectValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(h)),F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(a=I(h),F.success(a===I(f)),F.success(a===I(c)),F.failed())return null;if(s=F.isMemberOf(h,"WordArray"),n=F.isMemberOf(f,"WordArray"),s&&n){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]/o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]/e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]/o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]/e[r];F.pop(4),F.push(c)}function E(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(o=I(f),F.success(o===I(c)),F.failed())return null;if(n="number"==typeof h,a=F.isMemberOf(f,"WordArray"),n&&a){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=p(u[r],s);else for(u=f.words,e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]/e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]/s;else for(t=f.wordsAsFloat32Array(),e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]/e;F.pop(4),F.push(c)}function L(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackObjectValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(l)),F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(n=I(l),F.success(n===I(c)),F.success(n===I(u)),F.failed())return null;if(s=F.isMemberOf(l,"WordArray"),F.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]===a[r];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]===t[r];else if(s)for(i=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]===a[r];else for(i=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]===t[r];F.pop(4),F.push(u)}function D(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(a=I(c),F.success(a===I(u)),F.failed())return null;if(n="number"==typeof l,F.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]===s;else for(o=c.words,t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]===t;else if(n)for(i=c.wordsAsFloat32Array(),s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]===s;else for(i=c.wordsAsFloat32Array(),t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]===t;F.pop(4),F.push(u)}function R(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackObjectValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(l)),F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(n=I(l),F.success(n===I(c)),F.success(n===I(u)),F.failed())return null;if(s=F.isMemberOf(l,"WordArray"),F.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]>=a[r];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]>=t[r];else if(s)for(i=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]>=a[r];else for(i=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]>=t[r];F.pop(4),F.push(u)}function W(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(a=I(c),F.success(a===I(u)),F.failed())return null;if(n="number"==typeof l,F.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]>=s;else for(o=c.words,t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]>=t;else if(n)for(i=c.wordsAsFloat32Array(),s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]>=s;else for(i=c.wordsAsFloat32Array(),t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]>=t;F.pop(4),F.push(u)}function z(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackObjectValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(l)),F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(n=I(l),F.success(n===I(c)),F.success(n===I(u)),F.failed())return null;if(s=F.isMemberOf(l,"WordArray"),F.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]>a[r];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]>t[r];else if(s)for(i=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]>a[r];else for(i=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]>t[r];F.pop(4),F.push(u)}function U(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(a=I(c),F.success(a===I(u)),F.failed())return null;if(n="number"==typeof l,F.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]>s;else for(o=c.words,t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]>t;else if(n)for(i=c.wordsAsFloat32Array(),s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]>s;else for(i=c.wordsAsFloat32Array(),t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]>t;F.pop(4),F.push(u)}function K(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackObjectValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(l)),F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(n=I(l),F.success(n===I(c)),F.success(n===I(u)),F.failed())return null;if(s=F.isMemberOf(l,"WordArray"),F.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]<=a[r];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]<=t[r];else if(s)for(i=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]<=a[r];else for(i=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]<=t[r];F.pop(4),F.push(u)}function H(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(a=I(c),F.success(a===I(u)),F.failed())return null;if(n="number"==typeof l,F.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]<=s;else for(o=c.words,t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]<=t;else if(n)for(i=c.wordsAsFloat32Array(),s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]<=s;else for(i=c.wordsAsFloat32Array(),t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]<=t;F.pop(4),F.push(u)}function G(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackObjectValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(l)),F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(n=I(l),F.success(n===I(c)),F.success(n===I(u)),F.failed())return null;if(s=F.isMemberOf(l,"WordArray"),F.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]<a[r];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]<t[r];else if(s)for(i=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]<a[r];else for(i=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]<t[r];F.pop(4),F.push(u)}function X(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(a=I(c),F.success(a===I(u)),F.failed())return null;if(n="number"==typeof l,F.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]<s;else for(o=c.words,t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]<t;else if(n)for(i=c.wordsAsFloat32Array(),s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]<s;else for(i=c.wordsAsFloat32Array(),t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]<t;F.pop(4),F.push(u)}function Z(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackObjectValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(h)),F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(a=I(h),F.success(a===I(f)),F.success(a===I(c)),F.failed())return null;if(s=F.isMemberOf(h,"WordArray"),n=F.isMemberOf(f,"WordArray"),s&&n){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]*o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]*e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]*o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]*e[r];F.pop(4),F.push(c)}function J(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(o=I(f),F.success(o===I(c)),F.failed())return null;if(n="number"==typeof h,a=F.isMemberOf(f,"WordArray"),n&&a){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=u[r]*s;else for(u=f.words,e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]*e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]*s;else for(t=f.wordsAsFloat32Array(),e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]*e;F.pop(4),F.push(c)}function Y(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackObjectValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(l)),F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(n=I(l),F.success(n===I(c)),F.success(n===I(u)),F.failed())return null;if(s=F.isMemberOf(l,"WordArray"),F.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]!==a[r];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=o[r]!==t[r];else if(s)for(i=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]!==a[r];else for(i=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,r=0;r<=n-1;r++)e[r]=i[r]!==t[r];F.pop(4),F.push(u)}function Q(){var e,t,i,r,s,n,a,o,u=F.stackObjectValue(0),l=F.stackValue(1),c=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(c)),F.success(F.isBytes(u)),F.failed())return null;if(a=I(c),F.success(a===I(u)),F.failed())return null;if(n="number"==typeof l,F.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]!==s;else for(o=c.words,t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=o[r]!==t;else if(n)for(i=c.wordsAsFloat32Array(),s=l,e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]!==s;else for(i=c.wordsAsFloat32Array(),t=F.floatValueOf(l),e=u.bytes,r=0;r<=a-1;r++)e[r]=i[r]!==t;F.pop(4),F.push(u)}function $(){var e,t,i,r=F.stackValue(0);if(F.failed())return null;if(F.success(F.isBytes(r)),F.failed())return null;if(t=I(r),F.failed())return null;for(i=r.bytes,e=0;e<=t-1;e++)0===i[e]?i[e]=1:i[e]=0}function ee(){var e,t,i,r,s,n,a=F.stackObjectValue(0),o=F.stackValue(1);if(F.failed())return null;if(F.success(F.isBytes(o)),F.success(F.isBytes(a)),F.failed())return null;if(i=I(o),r=I(a),F.failed())return null;for(r<(t=i)&&(t=r),s=a.bytes,n=o.bytes,e=0;e<=t-1;e++)n[e]=0<n[e]+s[e];F.pop(1)}function te(){var e,t,i,r,s,n=F.stackValue(0),a=F.stackObjectValue(1);if(F.failed())return null;if(i=F.isIntegerValue(n)?n:F.booleanValueOf(n),s=F.fetchPointerofObject(1,a),n=F.fetchPointerofObject(0,a),F.failed())return null;if(!F.isBytes(n))return F.primitiveFail(),null;if(!F.isBytes(s))return F.primitiveFail(),null;for(r=s.bytes,t=n.bytes,e=0;e<=I(s)-1;e++)1===t[e]&&(r[e]=i);F.pop(1)}function ie(){var e,t,i,r,s=F.stackIntegerValue(0),n=F.stackObjectValue(1);if(F.failed())return null;if(s|=4278190080,r=F.fetchPointerofObject(1,n),n=F.fetchPointerofObject(0,n),F.failed())return null;if(!F.isBytes(n))return F.primitiveFail(),null;if(!F.isWords(r))return F.primitiveFail(),null;for(i=r.words,t=n.bytes,e=0;e<=I(r)-1;e++)1===t[e]&&(i[e]=s);F.pop(1)}function re(){var e,t,i,r,s=F.stackFloatValue(0),n=F.stackObjectValue(1);if(F.failed())return null;if(r=F.fetchPointerofObject(1,n),n=F.fetchPointerofObject(0,n),F.failed())return null;if(!F.isBytes(n))return F.primitiveFail(),null;if(!F.isWords(r))return F.primitiveFail(),null;for(i=r.wordsAsFloat32Array(),t=n.bytes,e=0;e<=I(r)-1;e++)1===t[e]&&(i[e]=s);F.pop(1)}function se(){var e,t,i,r,s=F.stackValue(0),n=F.stackObjectValue(1);if(F.failed())return null;if(r=F.fetchPointerofObject(1,n),n=F.fetchPointerofObject(0,n),F.failed())return null;if(!F.isBytes(n))return F.primitiveFail(),null;if(!F.isPointers(r))return F.primitiveFail(),null;for(i=r.wordsAsInt32Array(),t=n.bytes,e=0;e<=I(r)-1;e++)1===t[e]&&(i[e]=s);F.pop(1)}function ne(){var e,t,i,r,s,n=F.stackIntegerValue(0),a=F.stackObjectValue(1),o=F.stackIntegerValue(2),u=F.stackIntegerValue(3),l=F.stackObjectValue(4);if(F.failed())return null;if(s=F.fetchPointerofObject(1,l),l=F.fetchPointerofObject(0,l),F.failed())return null;if(!F.isBytes(l))return F.primitiveFail(),null;if(!F.isBytes(s)||!F.isBytes(a))return F.primitiveFail(),null;if(r=s.bytes,t=l.bytes,i=a.bytes,s=I(s),l=I(l),a=I(a),o<u)return F.primitiveFail(),null;if(u<1)return F.primitiveFail(),null;if(s<u)return F.primitiveFail(),null;if(l<u)return F.primitiveFail(),null;if(s<o)return F.primitiveFail(),null;if(l<o)return F.primitiveFail(),null;if(n<1)return F.primitiveFail(),null;if(a<n)return F.primitiveFail(),null;if(a-n+1<o-u+1)return F.primitiveFail(),null;for(e=u-1;e<=o-1;e++)1===t[e]&&(r[e]=i[n+e-u]);F.pop(4)}function ae(){var e,t,i,r,s,n,a,o,u,l,c=F.stackIntegerValue(0),h=F.stackObjectValue(1),f=F.stackIntegerValue(2),p=F.stackIntegerValue(3),d=F.stackObjectValue(4);if(F.failed())return null;if(u=F.fetchPointerofObject(1,d),d=F.fetchPointerofObject(0,d),F.failed())return null;if(!F.isBytes(d))return F.primitiveFail(),null;if(!(F.isWords(u)&&F.isWords(h)||F.isPointers(u)&&F.isPointers(h)))return F.primitiveFail(),null;if(s=d.bytes,l=I(u),d=I(d),a=I(h),f<p)return F.primitiveFail(),null;if(p<1)return F.primitiveFail(),null;if(l<p)return F.primitiveFail(),null;if(d<p)return F.primitiveFail(),null;if(l<f)return F.primitiveFail(),null;if(d<f)return F.primitiveFail(),null;if(c<1)return F.primitiveFail(),null;if(a<c)return F.primitiveFail(),null;if(a-c+1<f-p+1)return F.primitiveFail(),null;if(l=F.isMemberOf(u,"KedamaFloatArray"),d=F.isMemberOf(h,"KedamaFloatArray"),l&&d)for(t=u.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=p-1;r<=f-1;r++)1===s[r]&&(t[r]=e[c+r-p]);if(l&&!d)for(t=u.wordsAsFloat32Array(),n=h.words,r=p-1;r<=f-1;r++)1===s[r]&&(t[r]=n[c+r-p]);if(!l&&d)for(o=u.words,e=h.wordsAsFloat32Array(),r=p-1;r<=f-1;r++)1===s[r]&&(i=e[c+r-p]>>>0,o[r]=i);if(!l&&!d)for(o=u.words,n=h.words,r=p-1;r<=f-1;r++)1===s[r]&&(o[r]=n[c+r-p]);F.pop(4)}function oe(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m,v=F.stackObjectValue(0),g=F.stackObjectValue(1),k=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(g)),F.success(F.isWords(k)),F.success(F.isWords(v)),F.failed())return null;if(l=I(g),F.success(l===I(k)),F.success(l===I(v)),F.failed())return null;if(o=F.isMemberOf(g,"WordArray"),u=F.isMemberOf(k,"WordArray"),o&&u){if(!F.isMemberOf(v,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(v,"KedamaFloatArray"))return F.primitiveFail(),null;if(u)if(o)for(d=k.words,p=g.words,m=v.words,a=0;a<=l-1;a++)f=b(h=d[a],c=p[a]),m[a]=f;else for(d=k.words,r=g.wordsAsFloat32Array(),n=v.wordsAsFloat32Array(),a=0;a<=l-1;a++)i=(h=d[a])/(e=r[a]),i=Math.floor(i),n[a]=h-i*e;else if(o)for(s=k.wordsAsFloat32Array(),p=g.words,n=v.wordsAsFloat32Array(),a=0;a<=l-1;a++)i=(t=s[a])/(c=p[a]),i=Math.floor(i),n[a]=t-i*c;else for(s=k.wordsAsFloat32Array(),r=g.wordsAsFloat32Array(),n=v.wordsAsFloat32Array(),a=0;a<=l-1;a++)i=(t=s[a])/(e=r[a]),i=Math.floor(i),n[a]=t-i*e;F.pop(4),F.push(v)}function ue(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p=F.stackObjectValue(0),d=F.stackValue(1),m=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(m)),F.success(F.isWords(p)),F.failed())return null;if(l=I(m),F.success(l===I(p)),F.failed())return null;if(o="number"==typeof d,u=F.isMemberOf(m,"WordArray"),o&&u){if(!F.isMemberOf(p,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(p,"KedamaFloatArray"))return F.primitiveFail(),null;if(u)if(o)for(h=m.words,a=d,f=p.words,n=0;n<=l-1;n++)f[n]=b(h[n],a);else for(h=m.words,e=F.floatValueOf(d),s=p.wordsAsFloat32Array(),n=0;n<=l-1;n++)i=(c=h[n])/e,i=Math.floor(i),s[n]=c-i*e;else if(o)for(r=m.wordsAsFloat32Array(),a=d,s=p.wordsAsFloat32Array(),n=0;n<=l-1;n++)i=(t=r[n])/a,i=Math.floor(i),s[n]=t-i*a;else for(r=m.wordsAsFloat32Array(),e=F.floatValueOf(d),s=p.wordsAsFloat32Array(),n=0;n<=l-1;n++)i=(t=r[n])/e,i=Math.floor(i),s[n]=t-i*e;F.pop(4),F.push(p)}function le(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackObjectValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(h)),F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(a=I(h),F.success(a===I(f)),F.success(a===I(c)),F.failed())return null;if(s=F.isMemberOf(h,"WordArray"),n=F.isMemberOf(f,"WordArray"),s&&n){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,r=0;r<=a-1;r++)l[r]=u[r]-o[r];else for(u=f.words,e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=u[r]-e[r];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]-o[r];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=c.wordsAsFloat32Array(),r=0;r<=a-1;r++)i[r]=t[r]-e[r];F.pop(4),F.push(c)}function ce(){var e,t,i,r,s,n,a,o,u,l,c=F.stackObjectValue(0),h=F.stackValue(1),f=F.stackObjectValue(2);if(F.failed())return null;if(F.success(F.isWords(f)),F.success(F.isWords(c)),F.failed())return null;if(o=I(f),F.success(o===I(c)),F.failed())return null;if(n="number"==typeof h,a=F.isMemberOf(f,"WordArray"),n&&a){if(!F.isMemberOf(c,"WordArray"))return F.primitiveFail(),null}else if(!F.isMemberOf(c,"KedamaFloatArray"))return F.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,r=0;r<=o-1;r++)l[r]=u[r]-s;else for(u=f.words,e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=u[r]-e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]-s;else for(t=f.wordsAsFloat32Array(),e=F.floatValueOf(h),i=c.wordsAsFloat32Array(),r=0;r<=o-1;r++)i[r]=t[r]-e;F.pop(4),F.push(c)}function q(e){e=90-e/.0174532925199433;return 0<e||(e+=360),e}function he(){var e,t,i=F.stackFloatValue(0),r=F.stackValue(1),s=F.stackIntegerValue(2),n=F.stackIntegerValue(3),a=F.stackIntegerValue(4);if(F.failed())return null;if(!F.isWords(r))return F.primitiveFail(),null;if(!(s<=I(r)&&1<=n&&n<=s))return F.primitiveFail(),null;if(e=r.wordsAsFloat32Array(),F.failed())return null;for(t=n;t<=s;t++)e[t-1]=m(a)*i;F.pop(5)}function fe(){var e,t,i=F.stackFloatValue(0),r=F.stackValue(1),s=F.stackIntegerValue(2),n=F.stackIntegerValue(3),a=F.stackIntegerValue(4);if(F.failed())return null;if(!F.isWords(r))return F.primitiveFail(),null;if(!(s<=I(r)&&1<=n&&n<=s))return F.primitiveFail(),null;if(t=r.words,F.failed())return null;for(e=n;e<=s;e++)t[e-1]=m(a)*i|0;F.pop(5)}function pe(){var e=F.stackIntegerValue(0);return F.failed()||(e=m(e),F.failed())?null:(F.pop(2),void F.pushInteger(e))}function de(){var e=F.stackFloatValue(0),t=F.stackFloatValue(1),i=F.stackFloatValue(2),r=F.stackFloatValue(3);return F.failed()||(r=k(r-t,i-e),360<(r+=90)&&(r-=360),F.failed())?null:(F.pop(5),void F.pushFloat(r))}function me(){var e=F.stackFloatValue(0),t=F.stackFloatValue(1),i=F.stackFloatValue(2),r=F.stackFloatValue(3);return F.failed()||(t=t-r,r=e-i,e=Math.sqrt(t*t+r*r),F.failed())?null:(F.pop(5),void F.pushFloat(e))}function M(e,t,i,r,s,n,a){var o;r<0&&(1===n&&(r+=s),2===n&&(r=0),3===n)&&(r=0-r,o=i[e],i[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),s<=r&&(1===a&&(r-=s),2===a&&(r=s-1e-6),3===a)&&(r=s-1e-6-(r-s),o=i[e],i[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),t[e]=r}function B(e,t,i,r,s,n,a){r<0&&(1===n&&(r+=s),2===n&&(r=0),3===n)&&(r=0-r,i[e]=6.283185307179586-i[e]),s<=r&&(1===a&&(r-=s),2===a&&(r=s-1e-6),3===a)&&(r=s-1e-6-(r-s),i[e]=6.283185307179586-i[e]),t[e]=r}function ve(){var e,t,i,r,s,n,a,o=F.stackValue(0),u=F.stackValue(1),l=F.stackValue(2);if(F.failed())return null;if(!F.isBytes(l))return F.primitiveFail(),null;if(!F.isWords(u))return F.primitiveFail(),null;if(a=I(u),o.isFloat)r=!1;else{if(!F.isWords(o))return F.primitiveFail(),null;if(I(o)!==a)return F.primitiveFail(),null;r=!0}for(s=l.bytes,t=u.wordsAsFloat32Array(),r?n=o.wordsAsFloat32Array():e=c(e=F.floatValueOf(o)),i=0;i<=a-1;i++)1===s[i]&&(r&&(e=c(e=n[i])),t[i]=e);if(F.failed())return null;F.pop(3)}function ge(e){return!1!=((F=e).majorVersion()==t)&&F.minorVersion()>=i}function ke(){var e=F.stackFloatValue(0),t=F.stackValue(1),i=F.stackIntegerValue(2);return F.failed()?null:!F.isWords(t)||I(t)<i?(F.primitiveFail(),null):(t.wordsAsFloat32Array()[i-1]=c(e),F.failed()?null:void F.pop(3))}function be(){return!0}function ye(){var e,t=F.stackIntegerValue(0),i=F.stackIntegerValue(1),r=F.stackFloatValue(2),s=F.stackFloatValue(3),n=F.stackValue(4),a=F.stackIntegerValue(5),o=F.stackValue(6);return F.failed()?null:!F.isWords(o)||!F.isWords(n)||(e=I(o),I(n)!==e)?(F.primitiveFail(),null):(M(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,r,i,t),F.failed()?null:void F.pop(7))}function Se(){var e,t=F.stackIntegerValue(0),i=F.stackIntegerValue(1),r=F.stackFloatValue(2),s=F.stackFloatValue(3),n=F.stackValue(4),a=F.stackIntegerValue(5),o=F.stackValue(6);return F.failed()?null:!F.isWords(o)||!F.isWords(n)||(e=I(o),I(n)!==e)?(F.primitiveFail(),null):(B(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,r,i,t),F.failed()?null:void F.pop(7))}function Ie(){var e,t,i,r,s,n,a,o,u,l,c=F.stackIntegerValue(0),h=F.stackIntegerValue(1),f=F.stackFloatValue(2),p=F.stackValue(3),d=F.stackValue(4),m=F.stackValue(5),v=F.stackValue(6);if(F.failed())return null;if(!F.isBytes(v))return F.primitiveFail(),null;if(!F.isWords(m))return F.primitiveFail(),null;if(!F.isWords(d))return F.primitiveFail(),null;if(p.isFloat)i=!1;else{if(!F.isWords(p))return F.primitiveFail(),null;i=!0,r=F.isMemberOf(p,"WordArray")}if(n=I(m),I(v)!==n)return F.primitiveFail(),null;if(I(d)!==n)return F.primitiveFail(),null;if(i&&I(p)!==n)return F.primitiveFail(),null;for(s=v.bytes,l=m.wordsAsFloat32Array(),e=d.wordsAsFloat32Array(),i?r?u=p.words:o=p.wordsAsFloat32Array():a=F.floatValueOf(p),t=0;t<=n-1;t++)1===s[t]&&M(t,l,e,i?(r?u:o)[t]:a,f,h,c);if(F.failed())return null;F.pop(7)}function Fe(){var e,t,i,r,s,n,a,o,u,l,c=F.stackIntegerValue(0),h=F.stackIntegerValue(1),f=F.stackFloatValue(2),p=F.stackValue(3),d=F.stackValue(4),m=F.stackValue(5),v=F.stackValue(6);if(F.failed())return null;if(!F.isBytes(v))return F.primitiveFail(),null;if(!F.isWords(m))return F.primitiveFail(),null;if(!F.isWords(d))return F.primitiveFail(),null;if(p.isFloat)i=!1;else{if(!F.isWords(p))return F.primitiveFail(),null;i=!0,r=F.isMemberOf(p,"WordArray")}if(n=I(m),I(v)!==n)return F.primitiveFail(),null;if(I(d)!==n)return F.primitiveFail(),null;if(i&&I(p)!==n)return F.primitiveFail(),null;for(s=v.bytes,l=m.wordsAsFloat32Array(),e=d.wordsAsFloat32Array(),i?r?u=p.words:o=p.wordsAsFloat32Array():a=F.floatValueOf(p),t=0;t<=n-1;t++)1===s[t]&&B(t,l,e,i?(r?u:o)[t]:a,f,h,c);if(F.failed())return null;F.pop(7)}function Oe(){var e,t,i,r,s,n,a,o,u,l,c,h=F.stackValue(0),f=F.stackValue(1),p=F.stackValue(2),d=F.stackValue(3),m=F.stackValue(4);if(F.failed())return null;if(!F.isWords(h))return F.primitiveFail(),null;if(!F.isWords(p))return F.primitiveFail(),null;if(!F.isWords(f))return F.primitiveFail(),null;if((u=I(h))<0)return F.primitiveFail(),null;if(I(p)!==u)return F.primitiveFail(),null;if(I(f)!==u)return F.primitiveFail(),null;if(m.isFloat){if(!d.isFloat)return F.primitiveFail(),null;t=!1}else{if(d.isFloat)return F.primitiveFail(),null;t=!0}if(t){if(I(m)!==u)return F.primitiveFail(),null;if(I(d)!==u)return F.primitiveFail(),null}for(o=h.wordsAsFloat32Array(),l=p.wordsAsFloat32Array(),c=f.wordsAsFloat32Array(),t&&(i=m.wordsAsFloat32Array(),r=d.wordsAsFloat32Array()),t||(s=F.floatValueOf(m),n=F.floatValueOf(d)),e=0;e<=u-1;e++)t&&(s=i[e],n=r[e]),a=k(s-l[e],n-c[e]),360<(a+=90)&&(a-=360),o[e]=a;if(F.failed())return null;F.pop(6),F.push(h)}function we(){var e,t,i,r,s,n,a,o,u,l,c,h,f=F.stackValue(0),p=F.stackValue(1),d=F.stackValue(2),m=F.stackValue(3),v=F.stackValue(4);if(F.failed())return null;if(!F.isWords(f))return F.primitiveFail(),null;if(!F.isWords(d))return F.primitiveFail(),null;if(!F.isWords(p))return F.primitiveFail(),null;if((o=I(f))<0)return F.primitiveFail(),null;if(I(d)!==o)return F.primitiveFail(),null;if(I(p)!==o)return F.primitiveFail(),null;if(v.isFloat){if(!m.isFloat)return F.primitiveFail(),null;t=!1}else{if(m.isFloat)return F.primitiveFail(),null;t=!0}if(t){if(I(v)!==o)return F.primitiveFail(),null;if(I(m)!==o)return F.primitiveFail(),null}for(a=f.wordsAsFloat32Array(),l=d.wordsAsFloat32Array(),h=p.wordsAsFloat32Array(),t&&(i=v.wordsAsFloat32Array(),r=m.wordsAsFloat32Array()),t||(s=F.floatValueOf(v),n=F.floatValueOf(m)),e=0;e<=o-1;e++)t&&(s=i[e],n=r[e]),u=s-l[e],c=n-h[e],a[e]=Math.sqrt(u*u+c*c);if(F.failed())return null;F.pop(6),F.push(f)}function Ce(){var e,t,i,r,s,n,a,o,u,l,c,h,f=F.stackIntegerValue(0),p=F.stackIntegerValue(1),d=F.stackIntegerValue(2),m=F.stackIntegerValue(3),v=F.stackValue(4),g=F.stackValue(5);if(F.failed())return null;if(u=I(g),r=I(v),m*d!==u)return F.primitiveFail(),null;if(u*p*f!==r)return F.primitiveFail(),null;for(n=g.words,t=v.words,c=i=o=a=0;c<=d-1;c++){for(h=0;h<=f-1;h++){for(l=0;l<=m-1;l++)for(e=n[a],++a,s=0;s<=p-1;s++)t[i]=e,++i;a=o}a=o+=m}F.pop(6)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:V,getModuleName:h,primitiveMulArrays:Z,drawTurtlesInArray:u,primitiveGTScalar:U,setScalarHeading:ke,primitiveSubScalar:ce,turtleScalarSetY:Se,vectorGetAngleTo:Oe,primitiveRemArrays:oe,primitiveLTArrays:G,primitiveAddScalar:j,primPixelsAtXY:C,primitiveMulScalar:J,primSetPixelsAtXY:P,setHeadingArrayFrom:ve,primPixelAtXYPut:w,makeMaskLog:y,primitiveLTScalar:X,scalarGetAngleTo:de,primitiveOrByteArray:ee,primitiveLEArrays:K,primitiveRemScalar:ue,getHeadingArrayInto:l,turtlesSetX:Ie,primitivePredicateReplaceBytes:ne,primitiveDivArrays:T,makeMask:g,primitiveLEScalar:H,kedamaSetRandomSeed:v,randomIntoIntegerArray:fe,setInterpreter:ge,primitivePredicateAtAllPutColor:ie,makeTurtlesMap:S,randomIntoFloatArray:he,primUpHill:x,shutdownModule:be,primitiveDivScalar:E,primitiveGEArrays:R,primitiveNotByteArray:$,randomRange:pe,initialiseModule:d,getScalarHeading:f,primPixelAtXY:O,primitivePredicateAtAllPutNumber:re,primitiveEQArrays:L,primitiveNEArrays:Y,primScalarForward:A,vectorGetDistanceTo:we,turtlesSetY:Fe,turtleScalarSetX:ye,primTurtlesForward:_,primitiveGEScalar:W,primitiveAndByteArray:N,primitivePredicateReplaceWords:ae,primitiveGTArrays:z,primitivePredicateAtAllPutObject:se,primitiveEQScalar:D,primitivePredicateAtAllPutBoolean:te,zoomBitmap:Ce,primitiveNEScalar:Q,scalarGetDistanceTo:me,primitiveSubArrays:le}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function se(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function f(e,t){return e-(0|Math.floor(e/t))*t|0}var ne=9,ae=39,g=1e-4,p=0,oe=10,ue=51,d=3.141592653589793,k=7,b=8,m=6,le=24,ce=11,_=5,x=0,V=0,j=0,q=0,M=0,B=null,N=0,T=null,e="Klatt 3 November 2014 (e)",E=0,L=0,D=0,R=0,W=0,z=0,U=null,K=0,H=0,G=0,X=0,Z=0,J=0,Y=0,Q=0;function he(e,t,i){var i=(0-d)/G*i,r=Math.exp(i),s=0-r*r;i=2*d/G*t,t=(0-(t=r*Math.cos(i)*2))*(r=1/(1-t-s)),s=(0-s)*r,n(e,r),u(e,t),c(e,s)}function fe(e,t){var i,r=s(e)*t+o(e)*(i=h(e))+l(e)*S(e);return I(e,i),y(e,t),r}function pe(e){return T.success(T.isWords(e)),T.failed()?0:e.wordsAsFloat32Array()}function r(){return e}function de(){var e;if(0===Z)return 0;if(Y=R<D?(e=x*Y+V*Q,Q=Y,e):e=j*Y-q,Z<=R)if((R=0)<B[p]){z=B[p];var t,i,r,s,n,a,o,u,l=K/G,c=Math.sin(2*d*12.7*l),h=Math.sin(2*d*7.1*l),l=Math.sin(2*d*4.7*l),c=2*B[1]*B[p]/100*(c+h+l),h=(z=(z+=c)+(ee()-32767)*B[2]/32768*B[p],0===f(W,2)?z+=B[4]*B[p]*(1-B[m]):z-=B[4]*B[p]*(1-B[m]),L=Z=G/(z=z<0?0:z)|0,0<B[_]&&(L>>=1),D=Z*B[m]|0,B[m]),l=B[k],c=B[b];for(i=(h=Z*h|0)/Z,c=c,t=(l=l)<=0?1:1-(t=(1-i)/l)/(Math.exp(t)-1),c=d*(c+1),s=Math.cos(c),r=Math.sin(c),s=function(e,t,i,r){var s,n,a,o,u,l,c;if(0<(o=v(0,e,t,i,r)))for(u=0,s=o,n=v(l=1,e,t,i,r);0<n;)u=l,s=n,n=v(l*=2,e,t,i,r);else for(l=0,s=v(u=-1,e,t,i,r),n=o;s<0;)l=u,n=s,s=v(u*=2,e,t,i,r);for(;g<l-u;)0<(a=v(c=(l+u)/2,e,t,i,r))?(u=c,s=a):(l=c,n=a);return(l+u)/2}(c,s,r,l/i*c*t),r=c/h,i=Math.exp(s*r),x=2*Math.cos(r)*i,V=0-i*i,Q=0,Y=i*Math.sin(r),t=Math.exp(-1/(l*Z)),c=Math.pow(t,Z-h),q=(1-(j=t))*c/(1-c),a=0,o=Y,u=Q,n=1;n<=D;n++)a=x*o+V*u,u=o,o=a;0!==a&&(Y=Y/a*1e4),0<(Y+=(ee()-32767)*B[3]/32768*Y)&&(Y=0),0!==f(W,2)&&0<(Y*=1-B[4])&&(Y=0),W=f(W+1,65535)}else L=Z=1;return++R,e}function $(e){return 32.767*Math.pow(2,(e-87)/6)}function ee(){return X=1309*X+13849&65535}function a(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m=pe(T.stackValue(2));if(v=P=T.stackValue(1),T.success(T.isWords(v)),v=T.failed()?0:v.wordsAsInt16Array(),k=T.stackIntegerValue(0),T.failed())return null;if(e=T.stackObjectValue(3),A=e,T.success(22===se(A)),T.failed()||(w=T.fetchPointerofObject(0,A),U=pe(w),z=T.fetchFloatofObject(2,A),Z=T.fetchIntegerofObject(3,A),R=T.fetchIntegerofObject(4,A),D=T.fetchIntegerofObject(5,A),L=T.fetchIntegerofObject(6,A),x=T.fetchFloatofObject(7,A),V=T.fetchFloatofObject(8,A),Y=T.fetchFloatofObject(9,A),Q=T.fetchFloatofObject(10,A),j=T.fetchFloatofObject(11,A),q=T.fetchFloatofObject(12,A),N=T.fetchFloatofObject(13,A),J=T.fetchFloatofObject(14,A),E=T.fetchFloatofObject(15,A),W=T.fetchIntegerofObject(16,A),K=T.fetchIntegerofObject(17,A),X=T.fetchIntegerofObject(18,A),M=T.fetchIntegerofObject(19,A),H=T.fetchIntegerofObject(20,A),G=T.fetchIntegerofObject(21,A),!1!==T.failed()))return null;if(T.success(2*se(P)>=H),T.failed())return null;var v,g,k,b,y,S,I,F,O,w=m,C=v,A=k,P=w;for(P=.6*$((B=w)[45]),m=.6*$(B[50]),v=.4*$(B[46]),k=.15*$(B[47]),y=.06*$(B[48]),I=.04*$(B[49]),g=.15*$(B[34]),b=.06*$(B[35]),S=.04*$(B[36]),F=.022*$(B[37]),O=.03*$(B[38]),8<=M&&(16e3<=G?te(19,7500,600):M=6),7<=M&&(16e3<=G?te(18,6500,500):M=6),6<=M&&te(17,B[24],B[25]),5<=M&&te(16,B[22],B[23]),te(15,B[20],B[21]),te(14,B[18],B[19]),te(13,B[16],B[17]),te(12,B[12],B[13]),te(20,B[26],B[27]),te(22,B[30],B[31]),he(21,B[28],B[29]),he(23,B[32],B[33]),ie(1,B[26],B[27],P),ie(2,B[30],B[31],m),ie(3,B[12],B[13],v),ie(4,B[16],B[17],k),ie(5,B[18],B[19],y),ie(6,B[20],B[21],I),ie(7,B[16],B[40],g),ie(8,B[18],B[41],b),ie(9,B[20],B[42],S),ie(10,B[22],B[43],F),ie(11,B[24],B[44],O),0<z?(d=$(B[_]-7),u=$(B[_]),f=.1*$(B[ce])):d=u=f=0,s=.25*$(B[oe]),i=.05*$(B[ne]),r=.05*$(B[ae]),(w=B[ue]-3)<=0&&(w=57),t=$(w),ie(le,0,G,t),a=E,h=H+(n=A)-1;n<=h;)a=(ee()-32768)/4,E=a+=.75*E,L<R&&(a*=.5),c=s*a,p=de(),J=p,R<D&&(p+=f*(ee()-32768)/4),l=d*p,p=u*p,p+=o=i*a,o=function(e){return 0<M?(e=re(20,e=fe(21,e)),e=re(22,e=fe(23,e)),8<=M&&(e=re(19,e)),7<=M&&(e=re(18,e)),6<=M&&(e=re(17,e)),5<=M&&(e=re(16,e)),4<=M&&(e=re(15,e)),3<=M&&(e=re(14,e)),2<=M&&(e=re(13,e)),1<=M?re(12,e):e):0}(l+=o),o+=function(e){return re(3,e)+re(4,e)+re(5,e)+re(6,e)+re(1,e)+re(2,e)}(l=p),l=c+p-N,N=p,o=function(e){return re(7,e)-re(8,e)+re(9,e)-re(10,e)+re(11,e)}(l)-o,o=re(le,o=r*l-o),32767<(c=(c=o*t|0)<-32768?-32768:c)&&(c=32767),C[n-1]=c,++n,++K;if(!function(e){var t,i,r,s,n,a,o,u,l,c;if(T.pushRemappableOop(e),T.pushRemappableOop(T.floatObjectOf(z)),T.pushRemappableOop(T.floatObjectOf(x)),T.pushRemappableOop(T.floatObjectOf(V)),T.pushRemappableOop(T.floatObjectOf(Y)),T.pushRemappableOop(T.floatObjectOf(Q)),T.pushRemappableOop(T.floatObjectOf(j)),T.pushRemappableOop(T.floatObjectOf(q)),T.pushRemappableOop(T.floatObjectOf(N)),T.pushRemappableOop(T.floatObjectOf(J)),e=T.floatObjectOf(E),u=T.popRemappableOop(),n=T.popRemappableOop(),s=T.popRemappableOop(),r=T.popRemappableOop(),c=T.popRemappableOop(),l=T.popRemappableOop(),i=T.popRemappableOop(),t=T.popRemappableOop(),o=T.popRemappableOop(),a=T.popRemappableOop(),T.failed())return;return T.storePointerofObjectwithValue(2,a,o),T.storeIntegerofObjectwithValue(3,a,Z),T.storeIntegerofObjectwithValue(4,a,R),T.storeIntegerofObjectwithValue(5,a,D),T.storeIntegerofObjectwithValue(6,a,L),T.storePointerofObjectwithValue(7,a,t),T.storePointerofObjectwithValue(8,a,i),T.storePointerofObjectwithValue(9,a,l),T.storePointerofObjectwithValue(10,a,c),T.storePointerofObjectwithValue(11,a,r),T.storePointerofObjectwithValue(12,a,s),T.storePointerofObjectwithValue(13,a,n),T.storePointerofObjectwithValue(14,a,u),T.storePointerofObjectwithValue(15,a,e),T.storeIntegerofObjectwithValue(16,a,W),T.storeIntegerofObjectwithValue(17,a,K),T.storeIntegerofObjectwithValue(18,a,X),!1===T.failed()}(e))return null;T.pop(3)}function v(e,t,i,r,s){return Math.exp(e*t)*((s*(e*e+1)+e)*r-i)+1}function te(e,t,i){var i=(0-d)/G*i,r=Math.exp(i),s=0-r*r;i=2*d/G*t,n(e,1-(t=r*Math.cos(i)*2)-s),u(e,t),c(e,s)}function ie(e,t,i,r){te(e,t,i),n(e,s(e)*r)}function re(e,t){var i=s(e)*t+o(e)*(t=h(e))+l(e)*S(e);return I(e,t),y(e,i),i}function s(e){return U[5*e-5]}function n(e,t){U[5*e-5]=t}function o(e){return U[5*e-4]}function u(e,t){U[5*e-4]=t}function l(e){return U[5*e-3]}function c(e,t){U[5*e-3]=t}function h(e){return U[5*e-2]}function y(e,t){U[5*e-2]=t}function S(e){return U[5*e-1]}function I(e,t){U[5*e-1]=t}function F(e){return!1!=((T=e).majorVersion()==t)&&T.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("Klatt",{setInterpreter:F,primitiveSynthesizeFrameIntoStartingAt:a,getModuleName:r}):self.setTimeout(e,100)}()}(),!function(){var t=1,P=11;function v(e){return"number"==typeof e?j.classSmallInteger():e.sqClass}function _(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function x(e,t){return 0|Math.floor(e/t)}function V(e,t){return e-x(e,t)*t|0}function p(e,t){return 31<t?0:e<<t}function d(e,t){return 31<t?0:e>>>t}var m=0,j=null,s="LargeIntegers v1.5 (e)",g=1,k=2;function L(e,t,i){var r,s,n,a;if(t<1||i<1)return j.primitiveFail();if(s=e,!((e=Math.min(i,o(s.bytes,_(s))))<t)){if(i=1+(t-1>>3),r=1+(e-1>>3),t=V(t-1,8),e=7-V(e-1,8),i==r)return n=p(255,t)&d(255,e),0!=(S(s,i)&n);if(0!==d(S(s,i),t))return 1;for(a=1+i;a<=r-1;a++)if(0!==S(s,a))return 1;return 0!=(255&p(S(s,r),e))}}function u(e,t){var i=j.instantiateClassindexableSize(v(e),t),r=_(e),r=r<t?r:t;return l(e.bytes,i.bytes,r),i}function q(e,t){var i;if("number"==typeof e){var r,s,n,a=(i=e)<0?j.classLargeNegativeInteger():j.classLargePositiveInteger(),a=j.instantiateClassindexableSize(a,t),o=i;for(r=a.bytes,s=1,n=c(o);s<=n;s++)r[s-1]=h(o,s)}else a=u(e,t);return a}function I(e,t,i){for(var r,s,n=i-1;0<=n;){if((s=t[n])!==(r=e[n]))return s<r?1:-1;--n}return 0}function l(e,t,i){for(var r=i-1,s=0;s<=r;s++)t[s]=e[s]}function o(e,t){for(var i,r=t;0===(i=e[r-1]);)if(0==--r)return 0;return M(i)+8*(r-1)}function c(e){return e<256&&-256<e?1:e<65536&&-65536<e?2:e<16777216&&-16777216<e?3:4}function h(e,t){return t<1&&j.primitiveFail(),4<t?0:e<0?255&d(0-e,8*(t-1)):255&d(e,8*(t-1))}function b(e,t,i,r,s){for(var n=i-t+1,a=0;a<n;a++)e[a+t]=r[a+s];return 0}function M(e){var t=0;return e<65536||(e>>>=16,t+=16),e<256||(e>>>=8,t+=8),e<16||(e>>>=4,t+=4),e<4||(e>>>=2,t+=2),e<2||(e>>>=1,++t),t+e}function y(e){for(var t=e,e=t<0?j.classLargeNegativeInteger():j.classLargePositiveInteger(),i=c(t),e=j.instantiateClassindexableSize(e,i),r=e.bytes,s=1;s<=i;s++)r[s-1]=h(t,s);return e}function B(e,t){var i,r,s=_(e);return 0===(r=o(e.bytes,s))?0:(r=r+t+7>>3,i=j.instantiateClassindexableSize(v(e),r),function(e,t,i,r,s){for(var n,a,o,u=e>>3,l=V(e,8),c=u-1,h=0;h<=c;h++)r[h]=0;if(0===l)return b(r,u,s-1,t,0);for(o=8-l,c=i-1,h=n=0;h<=c;h++)a=t[h],r[h+u]=255&(n|p(a,l)),n=d(a,o);0!==n&&(r[s-1]=n)}(t,e.bytes,s,i.bytes,r),i)}function N(e,t,i){var r,i=o(e.bytes,i),s=i+7>>3,i=i-t;return i<=0?j.instantiateClassindexableSize(v(e),0):(i=7+i>>3,r=j.instantiateClassindexableSize(v(e),i),function(e,t,i,r,s){var n,a,o,u,l,c,h=e>>3,f=V(e,8);if(0===f)return b(r,0,s-1,t,h);for(u=8-f,a=d(t[h],f),l=i-1,n=c=1+h;n<=l;n++)o=t[n],r[n-c]=255&(a|p(o,u)),a=d(o,f);0!==a&&(r[s-1]=a)}(t,e.bytes,s,r.bytes,i),r)}function i(e,t){var i,r,s,n=_(e),a=_(t),o=v(e),t=n<=a?(r=e,i=n,s=t,a):(r=t,i=a,s=e,n),a=j.instantiateClassindexableSize(o,t),e=function(e,t,i,r,s){for(var n=0,a=t-1,o=0;o<=a;o++)n=(n>>>8)+e[o]+i[o],s[o]=255&n;for(a=r-1,o=t;o<=a;o++)n=(n>>>8)+i[o],s[o]=255&n;return n>>>8}(r.bytes,i,s.bytes,t,a.bytes);return 0<e&&(n=j.instantiateClassindexableSize(o,t+1),l(a.bytes,n.bytes,t),(a=n).bytes[t]=e),a}function r(e,t,i){var r,s,n;if("number"==typeof e){if(e<0)return j.primitiveFail();l=y(e)}else{if(v(e)===j.classLargeNegativeInteger())return j.primitiveFail();l=e}if("number"==typeof t){if(t<0)return j.primitiveFail();o=y(t)}else{if(v(t)===j.classLargeNegativeInteger())return j.primitiveFail();o=t}var a,t=(e=_(l))<(t=_(o))?(r=e,s=l,n=t,o):(r=t,s=o,n=e,l),o=j.instantiateClassindexableSize(j.classLargePositiveInteger(),n),e=i,u=s.bytes,l=r,c=t.bytes,i=n,h=o.bytes,f=l-1;if(e===m){for(a=0;a<=f;a++)h[a]=u[a]&c[a];for(f=i-1,a=l;a<=f;a++)h[a]=0}else if(e===g){for(a=0;a<=f;a++)h[a]=u[a]|c[a];for(f=i-1,a=l;a<=f;a++)h[a]=c[a]}else if(e===k){for(a=0;a<=f;a++)h[a]=u[a]^c[a];for(f=i-1,a=l;a<=f;a++)h[a]=c[a]}else j.primitiveFail();return j.failed()?0:A(o)}function n(e,t){var i=_(e),r=_(t);return r!==i?i<r?-1:1:I(e.bytes,t.bytes,i)}function a(e,t,i){var r,s=_(e),n=_(t),i=i?j.classLargeNegativeInteger():j.classLargePositiveInteger(),a=s-n+1;if(a<=0)r=j.instantiateClassindexableSize(j.classArray(),2),j.stObjectatput(r,1,0),j.stObjectatput(r,2,e);else{n=q(n=B(t,t=8-M(E(t,n))),T(n)+1),T(e=B(e,t))===s&&(e=q(e,s+1));for(var o,u,l,c,h,f,p,d,m,v,g,s=j.instantiateClassindexableSize(i,a),k=n.bytes,b=T(n),y=e.bytes,S=T(e),I=s.bytes,F=T(s),O=b-1,w=F,C=k[O-1],A=1==O?0:k[O-2],P=1;P<=w;P++){if(y[(d=S+1-P)-1]===C)u=255;else for(g=V(v=(y[d-1]<<8)+y[d-2],C),h=(v=(u=x(v,C))*A)>>>8,c=255&v,f=d<3?0:y[d-3];;){if(!((g<h||g===h&&f<c)&&(--u,c<A?(--h,c=c+256-A):c-=A,C<=h)))break;h-=C}for(p=d-O,l=0,m=1;m<=b;m++)h=k[m-1]*(u>>>8),c=k[m-1]*(255&u),o=y[p-1]-l-(255&c),y[p-1]=255&o,l=h+(c>>>8)-(o>>=8),++p;if(0<l)for(--u,p=d-O,l=0,m=1;m<=b;m++)l=(l>>>8)+y[p-1]+k[m-1],y[p-1]=255&l,++p;I[F-P]=u}e=N(e,t,T(n)-1),r=j.instantiateClassindexableSize(j.classArray(),2),j.stObjectatput(r,1,s),j.stObjectatput(r,2,e)}return r}function T(e){return("number"==typeof e?c:_)(e)}function D(e,t,i,r){var s=_(e),n=_(t),a=_(i);if(!(s<=a))return j.primitiveFail();if(!(n<=a))return j.primitiveFail();if(!(0<=r&&r<=255))return j.primitiveFail();for(var o,u,l,c=j.instantiateClassindexableSize(j.classLargePositiveInteger(),a),h=e.bytes,e=s,f=t.bytes,p=n,d=i.bytes,s=a,m=r,v=c.bytes,g=e-1,k=p-1,b=s-1,y=0,S=0;S<=g;S++){for(l=v[0]+h[S]*f[0],l+=(u=l*m&255)*d[0],o=1;o<=k;o++)l=(l>>>8)+v[o]+h[S]*f[o]+u*d[o],v[o-1]=255&l;for(o=p;o<=b;o++)l=(l>>>8)+v[o]+u*d[o],v[o-1]=255&l;v[b]=255&(l=(l>>>8)+y),y=l>>>8}for(S=e;S<=b;S++){for(l=v[0],l+=(u=l*m&255)*d[0],o=1;o<=b;o++)l=(l>>>8)+v[o]+u*d[o],v[o-1]=255&l;v[b]=255&(l=(l>>>8)+y),y=l>>>8}if(0!==y||1!==I(d,v,s))for(S=l=0;S<=b;S++)l=l+v[S]-d[S],v[S]=255&l,l>>=8;return A(c)}function f(e,t,i){var r,s,n,a,o,u,l,c,h,f,p,d=_(e),m=_(t),t=d<=m?(n=e,s=d,r=t,m):(n=t,s=m,r=e,d),m=i?j.classLargeNegativeInteger():j.classLargePositiveInteger(),e=j.instantiateClassindexableSize(m,t+s),v=n.bytes,d=s,g=r.bytes,i=t,k=e.bytes;if(!(1===d&&0===v[0]||1===i&&0===g[0]))for(p=d-1,h=i-1,c=0;c<=p;c++)if(0!==(u=v[c])){for(f=c,o=l=0;o<=h;o++)l=(a=g[o]*u+l+k[f])>>>8,k[f]=255&a,++f;k[f]=l}return w(e)}function S(e,t){return t>_(e)?0:E(e,t)}function F(e,t){var i,r,s,n,a=v(e)===j.classLargeNegativeInteger(),o=_(e),u=_(t);if(o===u){for(;1<o&&S(e,o)===S(t,o);)--o;u=o}for(var u=o<u||o===u&&S(e,o)<S(t,o)?(r=t,n=u,s=e,i=o,!1==a):(r=e,n=o,s=t,i=u,a),a=n,a=j.instantiateClassindexableSize(u?j.classLargeNegativeInteger():j.classLargePositiveInteger(),a),l=s.bytes,c=i,h=r.bytes,f=n,p=a.bytes,d=0,m=0;m<=c-1;m++)d=d+h[m]-l[m],p[m]=255&d,d>>=8;for(m=c;m<=f-1;m++)d+=h[m],p[m]=255&d,d>>=8;return(u?C:A)(a)}function R(){return s}function O(e){var t,i;if("number"==typeof e)return 1;if(0!==(i=T(e))&&0!==E(e,i)){if(4<i)return 1;if(!(i<4)){if(v(e)===j.classLargePositiveInteger())return E(e,4)>h(1073741823,4);if(!(E(e,4)<h(-1073741824,4)))for(t=1;t<=4;t++)if(E(e,t)!==h(-1073741824,t))return 1}}}function w(e){return(v(e)===j.classLargePositiveInteger()?A:C)(e)}function C(e){for(var t,i,r,s,n=r=T(e);0!==n&&0===E(e,n);)--n;if(0===n)return 0;if(n<=4){if(i=-1073741824,n<4||S(e,4)<h(i,4)){for(s=0,t=n;1<=t;t+=-1)s=256*s-E(e,t);return s}for(t=1;t<=4;t++)if(S(e,t)!==h(i,t))return n<r?u(e,n):e;return i}return n<r?u(e,n):e}function A(e){for(var t,i,r,s=r=T(e);0!==s&&0===E(e,s);)--s;if(0===s)return 0;if(s<=4&&S(e,4)<=h(1073741823,4)){for(i=0,t=s;1<=t;t+=-1)i=256*i+E(e,t);return i}return s<r?u(e,s):e}function W(){var e,t=j.stackIntegerValue(1),i=j.stackIntegerValue(0);return j.success(j.isKindOfInteger(j.stackValue(2))),e=j.stackValue(2),j.failed()||(e=L("number"==typeof e?y(e):e,t,i)?j.trueObject():j.falseObject(),j.failed())||j.popthenPush(3,e),null}function z(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.failed()||("number"==typeof e?(t=y(e),j.failed()||j.popthenPush(2,t)):j.failed()||j.popthenPush(2,e)),null}function U(){var e=j.trueObject();return j.failed()||j.popthenPush(1,e),null}function K(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(1))),e=j.stackValue(1),t=j.stackIntegerValue(0),j.failed()||(e="number"==typeof e?y(e):e,t=0<=t?B(e,t):w(N(e,0-t,_(e))),j.failed())||j.popthenPush(3,t),null}function H(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.failed()||(t=i("number"==typeof t?y(t):t,"number"==typeof e?y(e):e),j.failed())||j.popthenPush(2,t),null}function G(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.failed()||(t=i("number"==typeof t?y(t):t,"number"==typeof e?y(e):e),j.failed())||j.popthenPush(3,t),null}function X(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.failed()||(t=r(t,e,m),j.failed())||j.popthenPush(2,t),null}function Z(){var e,t,i;return j.success(j.isKindOfInteger(j.stackValue(2))),i=j.stackValue(2),j.success(j.isKindOfInteger(j.stackValue(1))),e=j.stackValue(1),t=j.stackIntegerValue(0),j.failed()||(i=r(i,e,t),j.failed())||j.popthenPush(4,i),null}function J(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.failed()||(t=r(t,e,g),j.failed())||j.popthenPush(2,t),null}function Y(){var e,t=j.stackIntegerValue(0);return j.success(j.isKindOfInteger(j.stackValue(1))),e=j.stackValue(1),j.failed()||(e="number"==typeof e?y(e):e,t=0<=t?B(e,t):w(N(e,0-t,_(e))),j.failed())||j.popthenPush(2,t),null}function Q(){var e,t=j.stackIntegerValue(0);return j.success(j.isKindOfInteger(j.stackValue(1))),e=j.stackValue(1),j.failed()||(e="number"==typeof e?y(e):e,t=0<=t?B(e,t):w(N(e,0-t,_(e))),j.failed())||j.popthenPush(2,t),null}function $(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.failed()||(t=r(t,e,k),j.failed())||j.popthenPush(2,t),null}function ee(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.failed()||(t="number"==typeof t?"number"==typeof e?t>e?1:t<e?-1:0:-1:"number"==typeof e?1:n(t,e),j.failed())||j.popthenPush(2,t),null}function te(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.failed()||(t="number"==typeof t?"number"==typeof e?t>e?1:t<e?-1:0:-1:"number"==typeof e?1:n(t,e),j.failed())||j.popthenPush(3,t),null}function ie(){var e,t,i,r;if(j.success(j.isKindOfInteger(j.stackValue(1))),r=j.stackValue(1),i=j.booleanValueOf(j.stackValue(0)),j.success(j.isKindOfInteger(j.stackValue(2))),e=j.stackValue(2),!j.failed())if(O(e))if(O(r)){if(e="number"==typeof e?y(e):e,"number"==typeof r){if(0===r)return j.primitiveFail(),null;t=y(r)}else t=r;r=a(e,t,i),j.failed()||j.popthenPush(3,r)}else j.primitiveFail();else j.primitiveFail();return null}function re(){var e,t,i,r;if(j.success(j.isKindOfInteger(j.stackValue(2))),t=j.stackValue(2),j.success(j.isKindOfInteger(j.stackValue(1))),r=j.stackValue(1),i=j.booleanValueOf(j.stackValue(0)),!j.failed()){if(t="number"==typeof t?y(t):t,"number"==typeof r){if(0===r)return j.primitiveFail(),null;e=y(r)}else e=r;r=a(t,e,i),j.failed()||j.popthenPush(4,r)}return null}function se(){var e,t,i;return j.success(j.isKindOfInteger(j.stackValue(1))),e=j.stackValue(1),t=j.booleanValueOf(j.stackValue(0)),j.success(j.isKindOfInteger(j.stackValue(2))),i=j.stackValue(2),j.failed()||(i=f("number"==typeof i?y(i):i,"number"==typeof e?y(e):e,t),j.failed())||j.popthenPush(3,i),null}function ne(){var e,t,i;return j.success(j.isKindOfInteger(j.stackValue(2))),i=j.stackValue(2),j.success(j.isKindOfInteger(j.stackValue(1))),e=j.stackValue(1),t=j.booleanValueOf(j.stackValue(0)),j.failed()||(i=f("number"==typeof i?y(i):i,"number"==typeof e?y(e):e,t),j.failed())||j.popthenPush(4,i),null}function ae(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.failed()||(t=F("number"==typeof t?y(t):t,"number"==typeof e?y(e):e),j.failed())||j.popthenPush(2,t),null}function oe(){var e,t;return j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.failed()||(t=F("number"==typeof t?y(t):t,"number"==typeof e?y(e):e),j.failed())||j.popthenPush(3,t),null}function ue(){for(var e=s.length,t=j.instantiateClassindexableSize(j.classString(),e),i=t.bytes,r=0;r<=e-1;r++)i[r]=s[r];return j.failed()||j.popthenPush(1,t),null}function le(){var e,t,i,r;return j.success(j.isKindOfInteger(j.stackValue(2))),e=j.stackValue(2),j.success(j.isKindOfInteger(j.stackValue(1))),t=j.stackValue(1),i=j.stackIntegerValue(0),j.success(j.isKindOfInteger(j.stackValue(3))),r=j.stackValue(3),j.failed()||(r=D("number"==typeof r?y(r):r,"number"==typeof e?y(e):e,"number"==typeof t?y(t):t,i),j.failed())||j.popthenPush(4,r),null}function ce(){var e;return j.success(j.isKindOfInteger(j.stackValue(0))),e=j.stackValue(0),j.failed()||("number"==typeof e?j.failed()||j.popthenPush(2,e):(e=w(e),j.failed()||j.popthenPush(2,e))),null}function he(){var e;return j.success(j.stackValue(0).sqClass===j.classLargeNegativeInteger()),e=j.stackValue(0),j.failed()||(e=C(e),j.failed())||j.popthenPush(1,e),null}function fe(){var e;return j.success(j.stackValue(0).sqClass===j.classLargePositiveInteger()),e=j.stackValue(0),j.failed()||(e=A(e),j.failed())||j.popthenPush(1,e),null}function pe(e){return!1!=((j=e).majorVersion()==t)&&j.minorVersion()>=P}function E(e,t){return e.bytes[t-1]}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:G,primDigitBitShiftMagnitude:Q,primGetModuleName:ue,primDigitBitLogicWithOp:Z,primCheckIfCModuleExists:U,primDigitCompare:ee,primDigitMultiplyNegative:se,primDigitBitShift:Y,primNormalizePositive:fe,primDigitSubtractWith:oe,_primDigitBitShift:K,primDigitMultiplyWithNegative:ne,primDigitSubtract:ae,primDigitDivNegative:ie,primNormalizeNegative:he,primDigitBitOr:J,primMontgomeryTimesModulo:le,primDigitBitAnd:X,primDigitDivWithNegative:re,setInterpreter:pe,primNormalize:ce,primDigitBitXor:$,primDigitCompareWith:te,primDigitAdd:H,getModuleName:R,primAsLargeInteger:z,primAnyBitFromTo:W}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function h(e){return"number"==typeof e?p.classSmallInteger():e.sqClass}function f(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}var p=null,d=0,m=0,v=0,g=0,e="Matrix2x3Plugin 3 November 2014 (e)";function r(){return e}function k(e){return p.failed()?null:p.isWords(e)&&6===f(e)?e.wordsAsFloat32Array():(p.primitiveFail(),null)}function b(e){var t,i;if(!p.failed())return h(e)===p.classPoint()&&((t="number"==typeof(i=p.fetchPointerofObject(0,e)))||i.isFloat)&&(d=t?i:p.floatValueOf(i),(t="number"==typeof(i=p.fetchPointerofObject(1,e)))||i.isFloat)?void(m=t?i:p.floatValueOf(i)):p.primitiveFail()}function y(e){var t,i=d-e[2],r=m-e[5],s=e[0]*e[4]-e[1]*e[3];if(0==s)return p.primitiveFail();t=i*e[4]-e[1]*r,r=e[0]*r-i*e[3],v=t*(s=1/s),g=r*s}function S(e){v=d*e[0]+m*e[1]+e[2],g=d*e[3]+m*e[4]+e[5]}function n(e){return-1073741824<=e&&v<=1073741823}function s(e){var t,i,r,s,n,a,o,u=k(t=p.stackObjectValue(0)),l=k(p.stackObjectValue(1)),c=k(p.stackObjectValue(2));if(p.failed())return null;i=l,u=u,r=c[0]*l[0]+c[1]*l[3],s=c[0]*l[1]+c[1]*l[4],n=c[0]*l[2]+c[1]*l[5]+c[2],a=c[3]*l[0]+c[4]*l[3],o=c[3]*l[1]+c[4]*l[4],i=c[3]*l[2]+c[4]*l[5]+c[5],u[0]=r,u[1]=s,u[2]=n,u[3]=a,u[4]=o,u[5]=i,p.popthenPush(e+1,t)}function a(e){var t;if(b(p.stackObjectValue(0)),t=k(p.stackObjectValue(1)),p.failed())return null;y(t),p.failed()||F(e)}function o(e){var t,i,r,s,n,a,o,u=p.stackObjectValue(0),l=p.stackObjectValue(1),c=k(p.stackObjectValue(2));return p.failed()?null:h(l)!==h(u)||!p.isPointers(l)||2!==f(l)?p.primitiveFail():(b(p.fetchPointerofObject(0,l)),p.failed()||(a=d,o=m,y(c),s=i=v,n=r=g,b(p.fetchPointerofObject(1,l)),p.failed())?null:(l=d,t=m,y(c),s=Math.min(s,v),i=Math.max(i,v),n=Math.min(n,g),r=Math.max(r,g),d=l,m=o,y(c),s=Math.min(s,v),i=Math.max(i,v),n=Math.min(n,g),r=Math.max(r,g),d=a,m=t,y(c),s=Math.min(s,v),i=Math.max(i,v),n=Math.min(n,g),r=Math.max(r,g),p.failed()||(u=O(u,s,n,i,r)),void(p.failed()||p.popthenPush(e+1,u))))}function u(e){var t=k(p.stackObjectValue(0));if(p.failed())return null;p.pop(1),p.pushBool(1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5])}function l(e){var t=k(p.stackObjectValue(0));if(p.failed())return null;p.pop(1),p.pushBool(1===t[0]&&0===t[1]&&0===t[3]&&1===t[4])}function c(e){var t;if(b(p.stackObjectValue(0)),t=k(p.stackObjectValue(1)),p.failed())return null;S(t),F(e)}function I(e){var t,i,r,s,n,a,o,u=p.stackObjectValue(0),l=p.stackObjectValue(1),c=k(p.stackObjectValue(2));return p.failed()?null:h(l)!==h(u)||!p.isPointers(l)||2!==f(l)?p.primitiveFail():(b(p.fetchPointerofObject(0,l)),p.failed()||(a=d,o=m,S(c),s=i=v,n=r=g,b(p.fetchPointerofObject(1,l)),p.failed())?null:(l=d,t=m,S(c),s=Math.min(s,v),i=Math.max(i,v),n=Math.min(n,g),r=Math.max(r,g),d=l,m=o,S(c),s=Math.min(s,v),i=Math.max(i,v),n=Math.min(n,g),r=Math.max(r,g),d=a,m=t,S(c),s=Math.min(s,v),i=Math.max(i,v),u=O(u,s,Math.min(n,g),i,Math.max(r,g)),void(p.failed()||p.popthenPush(e+1,u))))}function F(e){return g+=.5,n(v+=.5)&&n(g)?void p.popthenPush(e+1,p.makePointwithxValueyValue(0|v,0|g)):p.primitiveFail()}function O(e,t,i,r,s){var t=t+.5;return n(t)&&n(r=r+.5)&&n(i=i+.5)&&n(s=s+.5)?(p.pushRemappableOop(e),e=p.makePointwithxValueyValue(0|t,0|i),p.pushRemappableOop(e),t=p.makePointwithxValueyValue(0|r,0|s),e=p.popRemappableOop(),i=p.popRemappableOop(),p.storePointerofObjectwithValue(0,i,e),p.storePointerofObjectwithValue(1,i,t),i):p.primitiveFail()}function w(e){return!1!=((p=e).majorVersion()==t)&&p.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:a,primitiveInvertRectInto:o,primitiveIsIdentity:u,primitiveComposeMatrix:s,setInterpreter:w,primitiveTransformRectInto:I,primitiveIsPureTranslation:l,getModuleName:r,primitiveTransformPoint:c}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function r(e,t){return e-(0|Math.floor(e/t))*t|0}var d=null,e="MiscPrimitivePlugin 3 November 2014 (e)";function h(e,t,i){for(var r,s,n=0;n<=3;n++)t[i+n-1]=255&(r=e,31<(s=8*(3-n))?0:r>>>s);return i+4}function f(e,t,i){return e<=223?(t[i-1]=e,i+1):e<=7935?(t[i-1]=224+(e>>8),t[i]=r(e,256),i+2):(t[i-1]=255,h(e,t,i+1))}function s(){return e}function n(e){var t,i,r,s,n,a,o,u;if(d.stackValue(3),t=d.stackBytes(2),i=d.stackBytes(1),r=d.stackBytes(0),!d.failed()){for(o=t.length,u=i.length,a=1;a<=Math.min(o,u);a++)if((s=r[t[a-1]])!==(n=r[i[a-1]]))return s<n?d.failed()||d.popthenPush(e+1,1):d.failed()||d.popthenPush(e+1,3),null;o===u?d.failed()||d.popthenPush(e+1,2):o<u?d.failed()||d.popthenPush(e+1,1):d.failed()||d.popthenPush(e+1,3)}return null}function a(e){var t,i,r,s,n,a,o,u,l,c;if(d.stackValue(2),t=d.stackInt32Array(1),i=d.stackBytes(0),!d.failed()){for(s=f(l=t.length,i,1),a=1;a<=l;){for(r=((c=t[a-1])>>>8&255)==(o=255&c)&&(c>>>16&255)==o&&(c>>>24&255)==o,n=a;n<l&&c===t[n];)++n;if(a<n)r?(i[(s=f(4*(n-a+1)+1,i,s))-1]=o,++s):s=h(c,i,s=f(4*(n-a+1)+2,i,s)),a=n+1;else if(r)i[(s=f(5,i,s))-1]=o,++s,++a;else{for(;n<l&&t[n-1]!==t[n];)++n;for(n===l&&++n,s=f(4*(n-a)+3,i,s),u=a;u<=n-1;u++)s=h(t[u-1],i,s);a=n}}d.failed()||d.popthenPush(e+1,s-1)}return null}function o(e){var t,i,r,s,n;if(d.stackValue(2),t=d.stackBytes(1),i=d.stackUint16Array(0),d.failed())return null;for(s=t.length,r=1;r<=s;r++)n=t[r-1],i[r-1]=127<n?n-256<<8:n<<8;if(d.failed())return null;d.pop(e)}function u(e){var t,i,r,s,n,a,o,u,l,c,h,f,p;if(d.stackValue(3),t=d.stackInt32Array(2),i=d.stackBytes(1),r=d.stackIntegerValue(0),d.failed())return null;for(u=r,o=i.length,p=t.length+(c=1);u<=o;){if(s=i[u-1],++u,!(s<=223))if(s<=254)s=256*(s-224)+i[u-1],++u;else for(s=0,l=1;l<=4;l++)s=(s<<8)+i[u-1],++u;if(p<c+(f=s>>>2))return d.primitiveFail(),null;if(1==(n=3&s))for(a=i[u-1],++u,a=(a|=a<<8)|a<<16,l=1;l<=f;l++)t[c-1]=a,++c;if(2==n){for(a=0,l=1;l<=4;l++)a=a<<8|i[u-1],++u;for(l=1;l<=f;l++)t[c-1]=a,++c}if(3==n)for(h=1;h<=f;h++){for(a=0,l=1;l<=4;l++)a=a<<8|i[u-1],++u;t[c-1]=a,++c}}if(d.failed())return null;d.pop(e)}function l(e){var t,i,r,s,n;if(d.stackValue(3),t=d.stackBytes(2),i=d.stackBytes(1),r=d.stackIntegerValue(0),!d.failed())if(256!==i.length)d.failed()||d.popthenPush(e+1,0);else{for(s=r,n=t.length;s<=n&&0===i[t[s-1]];)++s;n<s?d.failed()||d.popthenPush(e+1,0):d.failed()||d.popthenPush(e+1,s)}return null}function c(e){var t,i,r,s,n,a;if(d.stackValue(4),t=d.stackBytes(3),i=d.stackBytes(2),r=d.stackIntegerValue(1),s=d.stackBytes(0),!d.failed()){if(0!==t.length)for(a=r;a<=i.length-t.length+1;a++)for(n=1;s[i[a+n-1-1]]===s[t[n-1]];){if(n===t.length)return d.failed()||d.popthenPush(e+1,a),null;++n}d.failed()||d.popthenPush(e+1,0)}return null}function p(e){var t,i,r,s,n;if(d.stackValue(3),t=d.stackIntegerValue(2),i=d.stackBytes(1),r=d.stackIntegerValue(0),!d.failed()){for(n=i.length,s=r;s<=n;s++)if(i[s-1]===t)return d.failed()||d.popthenPush(e+1,s),null;d.failed()||d.popthenPush(e+1,0)}return null}function m(e){var t,i,r,s,n,a;if(d.stackValue(2),t=d.stackBytes(1),i=d.stackIntegerValue(0),!d.failed()){for(r=t.length,s=268435455&i,a=1;a<=r;a++)s=9741*(n=16383&(s+=t[a-1]))+16384*(9741*(s>>>14)+101*n&16383)&268435455;d.failed()||d.popthenPush(e+1,s)}return null}function v(e){var t,i,r,s,n;if(d.stackValue(4),t=d.stackBytes(3),i=d.stackIntegerValue(2),r=d.stackIntegerValue(1),s=d.stackBytes(0),d.failed())return null;for(n=i;n<=r;n++)t[n-1]=s[t[n-1]];if(d.failed())return null;d.pop(e)}function g(e){return!1!=((d=e).majorVersion()==t)&&d.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:o,primitiveCompareString:n,primitiveTranslateStringWithTable:v,primitiveStringHash:m,primitiveCompressToByteArray:a,primitiveFindSubstring:c,primitiveIndexOfAsciiInString:p,setInterpreter:g,primitiveDecompressFromByteArray:u,getModuleName:s,primitiveFindFirstInString:l}):self.setTimeout(e,100)}()}(),registerMIDIPlugin(),!function(){var t=1,i=11;function x(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function V(e,t){return 0|Math.floor(e/t)}function j(e,t){return e-V(e,t)*t|0}var q=null,e="ScratchPlugin 3 November 2014 (e)";function d(e,t,i,r,s){var n,a=V(i,60),i=j(i,60),o=(1e3-r)*s,u=(1e3-V(r*i,60))*s,r=(1e3-V(r*(60-i),60))*s,i=V(1e3*s,3922);o=V(o,3922),u=V(u,3922),r=V(r,3922),0===a&&(n=(i<<16)+(r<<8)+o),1===a&&(n=(u<<16)+(i<<8)+o),2===a&&(n=(o<<16)+(i<<8)+r),3===a&&(n=(o<<16)+(u<<8)+i),4===a&&(n=(r<<16)+(o<<8)+i),e[t]=n=0===(n=5===a?(i<<16)+(o<<8)+u:n)?1:n}function M(e){return q.success(q.isWordsOrBytes(e)),q.failed()?0:e.wordsAsFloat64Array()}function B(e){return q.success(q.isWords(e)),q.failed()?0:e.words}function r(){return e}function m(e,t,i,r,s){r=s-r;return 0==r?0:(s=e===s?V(60*(t-i),r):t===s?120+V(60*(i-e),r):240+V(60*(e-t),r))<0?s+360:s}function l(e,t,i){var r;return 0===e?t:0===t?e:0===(r=((r=1024-i)*(e>>>16&255)+i*(t>>>16&255)>>10<<16)+(r*(e>>>8&255)+i*(t>>>8&255)>>10<<8)+(r*(255&e)+i*(255&t)>>10))?1:r}function y(e,t,i,r,s){var n,a,o,u=t>>>10;return u<-1||r<=u||(o=i>>>10)<-1||s<=o?0:(t=1023&t,-1===u&&(t=u=0),i=1023&i,-1===o&&(i=o=0),a=16777215&e[n=o*r+u],0<(t=u===r-1?0:t)&&(a=l(a,16777215&e[n+1],t)),0===(i=o===s-1?0:i)?a:(s=16777215&e[n=(o+1)*r+u],0<t&&(s=l(s,16777215&e[n+1],t)),l(a,s,i)))}function s(){var e,t,i,r,s,n,a,o,u,l,c,h=q.stackValue(2),f=q.stackValue(1),p=q.stackIntegerValue(0),d=B(h),m=B(f),h=x(h);if(q.success(x(f)===h),q.failed())return null;for(s=V(h,p),c=1;c<=s-2;c++)for(l=1;l<=p-2;l++){for(n=u=r=e=0,i=-1;i<=1;i++)for(t=-1;t<=1;t++)0!=(o=16777215&d[(c+i)*p+(l+t)])&&(u+=o>>>16&255,r+=o>>>8&255,e+=255&o,++n);a=0===n?0:(V(u,n)<<16)+(V(r,n)<<8)+V(e,n),m[c*p+l]=a}return q.pop(3),0}function n(){var e,t,i,r,s,n=q.stackValue(2),a=q.stackValue(1),o=q.stackIntegerValue(0),u=B(n),l=x(n),c=B(a);if(q.success(x(a)===l),q.failed())return null;for(t=0;t<=l-1;t++)0!=(s=16777215&u[t])&&(e=m(i=r=s>>>16&255,e=s>>>8&255,s=255&s,r=s<(r=e<r?e:r)?s:r,i=(i=i<e?e:i)<s?s:i),s=0===i?0:V(1e3*(i-r),i),r=V(1e3*i,255),d(c,t,e,s,r=(r=1e3<(r+=10*o)?1e3:r)<0?0:r));return q.pop(3),0}function a(){var e,t,i,r,s,n,a,o,u=0,l=0,c=q.stackValue(2),h=q.stackValue(1),f=q.stackIntegerValue(0);if(q.success(q.isWords(c)),q.success(q.isWords(h)),e=V(2*x(c),f),a=2*x(h),q.success(e<=a),q.failed())return null;for(n=c.wordsAsInt16Array(),t=h.wordsAsInt16Array(),i=1;i<=e;i++){for(s=0,r=1;r<=f;r++)s<(o=(o=n[u++])<0?0-o:o)&&(s=o);t[l++]=s}return q.pop(3),0}function o(){var e,t,i,r,s,n=q.stackValue(7),a=q.stackIntegerValue(6),o=q.stackIntegerValue(5),u=q.stackValue(4),l=q.stackIntegerValue(3),c=q.stackIntegerValue(2),h=q.stackIntegerValue(1),f=q.stackIntegerValue(0),p=B(n),d=B(u);if(q.success(h+2*a<l),q.success(f+2*o<c),q.failed())return null;for(s=0;s<=o-1;s++)for(e=(f+2*s)*l+h,r=0;r<=a-1;r++)i=p[r+s*a],d[t=e+2*r]=i,d[t+1]=i,d[t+l]=i,d[t+l+1]=i;return q.pop(8),0}function u(){var e,t,i,r,s=0,n=0,a=q.stackValue(2),o=q.stackValue(1),u=q.booleanValueOf(q.stackValue(0));if(q.success(q.isWords(a)),q.success(q.isWords(o)),r=x(a),q.success(x(o)>=r>>1),q.failed())return null;for(i=a.wordsAsInt16Array(),e=o.wordsAsInt16Array(),u&&s++,t=1;t<=r;t++)e[n++]=i[s],s+=2;return q.pop(3),0}function c(){var e,t,i,r,s,n,a,o,u,l,c=q.stackValue(3),h=q.stackValue(2),f=q.stackIntegerValue(1),p=q.stackIntegerValue(0),d=B(c),m=B(h),c=x(c);if(q.success(x(h)===c),q.failed())return null;for(V(c,f),e=f>>1,t=(r=V(c,f))>>1,n=p/100,u=0;u<=f-1;u++)for(l=0;l<=r-1;l++)o=(u-e)/e,i=(l-t)/t,o=(s=Math.pow(Math.sqrt(o*o+i*i),n))<=1?(i=Math.atan2(i,o),a=1024*(e+s*Math.cos(i)*e)|0,1024*(t+s*Math.sin(i)*t)|0):(a=1024*u,1024*l),s=y(d,a,o,f,r),m[l*f+u]=s;return q.pop(4),0}function h(){var e,t,i,r,s,n,a,o,u=B(q.stackValue(11)),l=q.stackIntegerValue(10),c=q.stackIntegerValue(9),h=B(q.stackValue(8)),f=q.stackIntegerValue(7),p=q.stackIntegerValue(6),d=q.stackIntegerValue(5),m=q.stackIntegerValue(4),v=q.stackIntegerValue(3),g=q.stackIntegerValue(2),k=q.stackIntegerValue(1),b=q.stackIntegerValue(0);if(q.success(0<=d&&0<=m),q.success(d+2*k<=l),q.success(m+2*b<=c),q.success(0<=v&&0<=g),q.success(v+k<=f),q.success(g+b<=p),q.failed())return null;for(o=0;o<=b-1;o++)for(n=l*(m+2*o)+d,t=f*(g+o)+v,a=0;a<=k-1;a++)s=16711680&(r=u[n]),i=65280&r,e=255&r,s+=16711680&(r=u[n+1]),e+=255&r,i=(i+=65280&r)+(65280&(r=u[n+l])),e+=255&r,s=(s+=16711680&r)+(16711680&(r=u[n+l+1])),h[t]=s>>>2&16711680|(i+=65280&r)>>>2&65280|(e+=255&r)>>>2,n+=2,++t;return q.pop(12),0}function f(){var e,t,i,r,s,n,a=B(q.stackValue(11)),o=q.stackIntegerValue(10),u=q.stackIntegerValue(9),l=B(q.stackValue(8)),c=q.stackIntegerValue(7),h=q.stackIntegerValue(6),f=q.stackIntegerValue(5),p=q.stackIntegerValue(4),d=q.stackIntegerValue(3),m=q.stackIntegerValue(2),v=q.stackIntegerValue(1),g=q.stackIntegerValue(0);if(q.success(0<=f&&0<=p),q.success(f+2*v<=o),q.success(p+2*g<=u),q.success(0<=d&&0<=m),q.success(d+v<=c),q.success(m+g<=h),q.failed())return null;for(n=0;n<=g-1;n++)for(r=o*(p+2*n)+f,e=c*(m+n)+d,s=0;s<=v-1;s++)t=a[r],i=a[r+o+1],l[e]=(65280&t)+(65280&i)>>>1&65280|(255&t)+(255&i)>>>1|(16711680&t)+(16711680&i)>>>1&16711680,r+=2,++e;return q.pop(12),0}function p(){var e,t,i,r,s,n,a,o,u=q.stackValue(2),l=q.stackValue(1),c=q.stackIntegerValue(0),h=B(u),f=x(u),p=B(l);if(q.success(x(l)===f),q.failed())return null;for(i=0;i<=f-1;i++)0!=(n=16777215&h[i])&&(r=s=a=n>>>16&255,(e=255&n)<(s=(n=n>>>8&255)<s?n:s)&&(s=e),t=V(1e3*(r=(r=r<n?n:r)<e?e:r),255),o=0===r?0:V(1e3*(r-s),r),t<110&&(t=110,o=1e3),o<90&&(o=90),d(p,i,j((110===t||90===o?0:m(a,n,e,s,r))+c+36e7,360),o,t));return q.pop(3),0}function v(){var e=q.stackValue(3),t=q.stackIntegerValue(2),i=q.stackIntegerValue(1),r=q.stackIntegerValue(0),s=B(e),e=x(e);return q.failed()?null:(s=y(s,i,r,t,V(e,t)),q.pop(5),q.pushInteger(s),0)}function g(){var e,t,i,r,s,n,a,o,u=q.stackValue(2),l=q.stackValue(1),c=q.stackIntegerValue(0),h=B(u),f=x(u),p=B(l);if(q.success(x(l)===f),q.failed())return null;for(i=0;i<=f-1;i++)(n=16777215&h[i])<2||(r=s=a=n>>>16&255,(e=255&n)<(s=(n=n>>>8&255)<s?n:s)&&(s=e),t=V(1e3*(r=(r=r<n?n:r)<e?e:r),255),0<(o=0===r?0:V(1e3*(r-s),r))&&d(p,i,m(a,n,e,s,r),o=(o=1e3<(o+=10*c)?1e3:o)<0?0:o,t));return q.pop(3),0}function k(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g,k,b=q.stackValue(5),y=q.stackIntegerValue(4),S=q.stackIntegerValue(3),I=q.stackValue(2),F=q.stackIntegerValue(1),O=q.stackIntegerValue(0);if(q.success(x(b)===y*S),q.success(x(I)===F*O),e=B(b),r=B(I),q.failed())return null;for(t=i=0,g=V(1024*y,F),k=V(1024*S,O),a=0;a<=O-1;a++){for(n=t=0;n<=F-1;n++)p=(1024-(1023&t))*(1024-(1023&i)),d=(1023&t)*(1024-(1023&i)),m=(1024-(1023&t))*(1023&i),v=(1023&t)*(1023&i),o=e[h=(i>>>10)*y+(t>>>10)],u=t>>>10<y-1?e[h+1]:o,i>>>10<S-1&&(h+=y),l=e[h],c=t>>>10<y-1?e[h+1]:l,(f=0)===o&&(o=u,f+=p),0===u&&(u=o,f+=d),0===l&&(l=c,f+=m),0===c&&(c=l,f+=v),0===o&&(o=l,u=c),0===l&&(l=o,c=u),s=0,f<5e5&&0===(s=(s=((h=p*(o>>>16&255)+d*(u>>>16&255)+m*(l>>>16&255)+v*(c>>>16&255))>>>20&255)<<16)|((h=p*(o>>>8&255)+d*(u>>>8&255)+m*(l>>>8&255)+v*(c>>>8&255))>>>20&255)<<8|(h=p*(255&o)+d*(255&u)+m*(255&l)+v*(255&c))>>>20&255)&&(s=1),r[a*F+n]=s,t+=g;i+=k}return q.pop(6),0}function b(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g,k,b,y=q.stackValue(5),S=q.stackValue(4),I=q.stackIntegerValue(3),F=B(y),O=B(S),y=x(y),w=q.stackIntegerValue(2),C=q.stackValue(1),A=q.stackValue(0),P=M(C),_=M(A);if(q.success(x(S)===y),q.failed())return null;for(u=V(y,I),e=j(Math.random(),w)-1,d=0;d<=e/2-1;d++)for(k=j(Math.random(),I),b=j(Math.random(),u),f=j(Math.random(),8),a=-4;a<=4;a++)for(o=-4;o<=4;o++)(i=a*a+o*o)<25&&0<i&&(s=b+o|0,0<(r=k+a|0))&&0<s&&s<u&&r<I&&(P[s*I+r]=f*(1-i/25));for(n=1;n<=I-2;n++)for(t=1;t<=u-2;t++)P[v=t*I+n]=(_[v+1]+_[v-1]+_[v+I]+_[v-I]+_[v-1-I]/2+_[v-1+I]/2+_[v+1-I]/2+_[v+1+I]/2)/4-P[v],P[v]=.9*P[v];for(p=0;p<=I*u;p++)m=_[p],_[p]=P[p],P[p]=m;for(c=0;c<=u-1;c++)for(l=0;l<=I-1;l++)h=1<l&&l<I-1&&1<c&&c<u-1&&(h=64*(P[g=c*I+l]-P[g-1]+(P[g+1]-P[g])),(g=(c+(g=2<(g=(g=(P[g]-P[g-I]+(P[g+I]-P[g]))/64)<2?-2:g)?2:g))*I+(l+(h=2<(h=h<2?-2:h)?2:h))|0)<I*u)&&0<=g?F[g]:F[l+c*I],O[l+c*I]=h;return q.pop(6),0}function S(){var e,t,i,r,s,n,a,o,u,l,c,h,f,p,d=q.stackValue(3),m=q.stackValue(2),v=q.stackIntegerValue(1),g=q.stackIntegerValue(0),k=B(d),b=B(m),d=x(d);if(q.success(x(m)===d),q.failed())return null;for(l=(e=v>>1)<(t=(n=V(d,v))>>1)?(u=t/(a=e),1):(u=1,(a=t)<e?e/t:1),h=-3.141592653589793*g/180,o=a*a,f=0;f<=v-1;f++)for(p=0;p<=n-1;p++)(s=(i=u*(f-e))*i+(r=l*(p-t))*r)<o&&(s=(s=1-Math.sqrt(s)/a)*s*h,c=Math.sin(s),c=y(k,1024*(((s=Math.cos(s))*i-c*r)/u+e)|0,1024*((c*i+s*r)/l+t)|0,v,n),b[v*p+f]=c);return q.pop(4),0}function I(e){return!1!=((q=e).majorVersion()==t)&&q.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:a,getModuleName:r,primitiveFisheye:c,primitiveWaterRipples1:b,primitiveHalfSizeDiagonal:f,primitiveScale:k,primitiveDoubleSize:o,setInterpreter:I,primitiveWhirl:S,primitiveBlur:s,primitiveBrightnessShift:n,primitiveHalfSizeAverage:h,primitiveSaturationShift:g,primitiveHueShift:p,primitiveInterpolate:v,primitiveExtractChannel:u}):self.setTimeout(e,100)}()}(),registerSocketPlugin(),registerSpeechPlugin(),registerSqueakSSL(),!function(){var t=1,i=11;function O(e,t){return e-(0|Math.floor(e/t))*t|0}var x=511,V=512,S=32768,I=536870912,j=null,e="SoundGenerationPlugin 3 November 2014 (e)";function r(){return e}function s(){var e,t,i,r,s,n,a,o,u=j.stackValue(3),l=j.stackInt16Array(2),c=j.stackIntegerValue(1),h=j.stackIntegerValue(0),f=j.fetchInt32ArrayofObject(7,u),p=j.fetchInt32ArrayofObject(8,u),d=j.fetchIntegerofObject(9,u),m=j.fetchIntegerofObject(10,u),v=j.fetchIntegerofObject(11,u),g=j.fetchInt16ArrayofObject(12,u),k=j.fetchInt16ArrayofObject(13,u);if(j.failed())return null;for(n=c;n<=c+h-1;n++){for(e=t=0,o=1;o<=d;o++)(i=v-f[o-1])<1&&(i+=m),e+=(a=p[o-1])*g[i-1],t+=a*k[i-1];(s=32767<(s=l[(r=2*n-1)-1]+(e>>15))?32767:s)<-32767&&(s=-32767),l[r-1]=s,g[v-1]=s,(s=32767<(s=l[++r-1]+(t>>15))?32767:s)<-32767&&(s=-32767),l[r-1]=s,k[v-1]=s,v=O(v,m)+1}if(j.failed())return null;j.storeIntegerofObjectwithValue(11,u,v),j.pop(3)}function n(){var e,t,i,r,s,n,a,o=j.stackValue(5),u=j.stackIntegerValue(4),l=j.stackInt16Array(3),c=j.stackIntegerValue(2),h=j.stackIntegerValue(1),f=j.stackIntegerValue(0),p=j.fetchIntegerofObject(3,o),d=j.fetchIntegerofObject(4,o),m=j.fetchIntegerofObject(5,o),v=j.fetchIntegerofObject(7,o),g=j.fetchInt16ArrayofObject(8,o),k=j.fetchIntegerofObject(9,o),b=j.fetchIntegerofObject(10,o),y=j.fetchIntegerofObject(11,o),S=j.fetchIntegerofObject(14,o),I=j.fetchIntegerofObject(15,o),F=j.fetchIntegerofObject(16,o);if(j.failed())return null;for(e=0!==S&&0!==F,i=c+u-1,a=c;a<=i;a++)n=p*g[b>>15]>>15,e?(r=S*g[I>>15],(I=O(I+F,k))<0&&(I+=k),(b=O(b+y+r,k))<0&&(b+=k)):b=O(b+y,k),0<h&&((s=32767<(s=l[(t=2*a-1)-1]+(n*h>>15))?32767:s)<-32767&&(s=-32767),l[t-1]=s),0<f&&((s=32767<(s=l[(t=2*a)-1]+(n*f>>15))?32767:s)<-32767&&(s=-32767),l[t-1]=s),0!==d&&(p+=d,0<d&&m<=p||d<0&&p<=m)&&(p=m,d=0);if(v-=u,j.failed())return null;j.storeIntegerofObjectwithValue(3,o,p),j.storeIntegerofObjectwithValue(4,o,d),j.storeIntegerofObjectwithValue(7,o,v),j.storeIntegerofObjectwithValue(10,o,b),j.storeIntegerofObjectwithValue(15,o,I),j.pop(5)}function a(){var e,t,i,r,s,n,a,o,u,l,c,h,f=j.stackValue(5),p=j.stackIntegerValue(4),d=j.stackInt16Array(3),m=j.stackIntegerValue(2),v=j.stackIntegerValue(1),g=j.stackIntegerValue(0),k=j.fetchIntegerofObject(3,f),b=j.fetchIntegerofObject(4,f),y=j.fetchIntegerofObject(5,f),S=j.fetchIntegerofObject(7,f),I=j.fetchIntegerofObject(8,f),F=j.fetchInt16ArrayofObject(10,f),O=j.fetchInt16ArrayofObject(11,f),w=j.fetchIntegerofObject(16,f),C=j.fetchIntegerofObject(17,f),A=j.fetchIntegerofObject(18,f),P=j.fetchIntegerofObject(19,f),_=j.fetchIntegerofObject(20,f);if(j.failed())return null;for(r=F!==O,e=v*k>>15,t=g*k>>15,i=2*m-1,s=m+p-1,h=m;h<=s;h++){if((o=(c=C<(c=(P+=_)>>9)&&I<S?(P-=A)>>9:c)+1)>w){if(w<c)return S=0,j.failed()||(j.storeIntegerofObjectwithValue(3,f,k),j.storeIntegerofObjectwithValue(4,f,b),j.storeIntegerofObjectwithValue(7,f,S),j.storeIntegerofObjectwithValue(19,f,P),j.popthenPush(6,null)),null;o=0===A?c:1+(P-A>>9)}u=n=F[c-1]*(V-(a=P&x))+F[o-1]*a>>9,r&&(u=O[c-1]*(V-a)+O[o-1]*a>>9),0<v&&((l=32767<(l=d[i-1]+(e*n>>15))?32767:l)<-32767&&(l=-32767),d[i-1]=l),++i,0<g&&((l=32767<(l=d[i-1]+(t*u>>15))?32767:l)<-32767&&(l=-32767),d[i-1]=l),++i,0!==b&&(k+=b,(0<b&&y<=k||b<0&&k<=y)&&(k=y,b=0),e=v*k>>15,t=g*k>>15)}if(S-=p,j.failed())return null;j.storeIntegerofObjectwithValue(3,f,k),j.storeIntegerofObjectwithValue(4,f,b),j.storeIntegerofObjectwithValue(7,f,S),j.storeIntegerofObjectwithValue(19,f,P),j.pop(5)}function o(){var e,t,i,r,s,n,a,o=j.stackValue(5),u=j.stackIntegerValue(4),l=j.stackInt16Array(3),c=j.stackIntegerValue(2),h=j.stackIntegerValue(1),f=j.stackIntegerValue(0),p=j.fetchIntegerofObject(3,o),d=j.fetchIntegerofObject(4,o),m=j.fetchIntegerofObject(5,o),v=j.fetchIntegerofObject(7,o),g=j.fetchInt16ArrayofObject(8,o),k=j.fetchIntegerofObject(9,o),b=j.fetchIntegerofObject(10,o),y=j.fetchIntegerofObject(11,o);if(j.failed())return null;for(t=c+u-1,n=s=k,a=c;a<=t;a++)y<=(s=n+b)&&(s=S+(s-y)),r=g[(n>>15)-1]+g[(s>>15)-1]>>1,r=(g[(n>>15)-1]=r)*p>>15,n=s,0<h&&((i=32767<(i=l[(e=2*a-1)-1]+(r*h>>15))?32767:i)<-32767&&(i=-32767),l[e-1]=i),0<f&&((i=32767<(i=l[(e=2*a)-1]+(r*f>>15))?32767:i)<-32767&&(i=-32767),l[e-1]=i),0!==d&&(p+=d,0<d&&m<=p||d<0&&p<=m)&&(p=m,d=0);if(k=s,v-=u,j.failed())return null;j.storeIntegerofObjectwithValue(3,o,p),j.storeIntegerofObjectwithValue(4,o,d),j.storeIntegerofObjectwithValue(7,o,v),j.storeIntegerofObjectwithValue(9,o,k),j.pop(5)}function u(){var e,t,i,r,s,n,a=j.stackValue(5),o=j.stackIntegerValue(4),u=j.stackInt16Array(3),l=j.stackIntegerValue(2),c=j.stackIntegerValue(1),h=j.stackIntegerValue(0),f=j.fetchIntegerofObject(3,a),p=j.fetchIntegerofObject(4,a),d=j.fetchIntegerofObject(5,a),m=j.fetchIntegerofObject(7,a),v=j.fetchInt16ArrayofObject(8,a),g=j.fetchIntegerofObject(10,a),k=j.fetchIntegerofObject(11,a),b=j.fetchIntegerofObject(12,a),y=j.fetchIntegerofObject(13,a);if(j.failed())return null;for(t=l+o-1,i=l,n=b+(k>>>16);n<=g&&i<=t;)s=v[n-1]*f>>15,0<c&&((r=32767<(r=u[(e=2*i-1)-1]+(s*c>>15))?32767:r)<-32767&&(r=-32767),u[e-1]=r),0<h&&((r=32767<(r=u[(e=2*i)-1]+(s*h>>15))?32767:r)<-32767&&(r=-32767),u[e-1]=r),0!==p&&(f+=p,0<p&&d<=f||p<0&&f<=d)&&(f=d,p=0),I<=(k+=y)&&(b+=s=k>>>16,k-=s<<16),n=b+(k>>>16),++i;if(m-=o,j.failed())return null;j.storeIntegerofObjectwithValue(3,a,f),j.storeIntegerofObjectwithValue(4,a,p),j.storeIntegerofObjectwithValue(7,a,m),j.storeIntegerofObjectwithValue(11,a,k),j.storeIntegerofObjectwithValue(12,a,b),j.pop(5)}function l(e){return!1!=((j=e).majorVersion()==t)&&j.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:n,primitiveMixSampledSound:u,setInterpreter:l,getModuleName:r,primitiveApplyReverb:s,primitiveMixPluckedSound:o,primitiveMixLoopedSampledSound:a}):self.setTimeout(e,100)}()}(),!function(){var t=1,i=11;function b(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function y(e,t){return 0|Math.floor(e/t)}var S=null,e="StarSqueakPlugin 3 November 2014 (e)";function I(e){return S.success(S.isWords(e)),S.failed()?0:e.words}function r(){return e}function s(){var e,t,i,r,s,n,a,o,u,l,c,h=S.stackValue(4),f=S.stackValue(3),p=S.stackIntegerValue(2),d=S.stackIntegerValue(1),m=S.stackIntegerValue(0),v=I(h),g=I(f);if(S.success(b(h)===b(f)),S.success(b(h)===p*d),S.failed())return null;for(e=(2*m+1)*(2*m+1),l=0;l<=d-1;l++)for((n=l-m)<0&&(n=0),d<=(i=l+m)&&(i=d-1),o=0;o<=p-1;o++){for((s=o-m)<0&&(s=0),p<=(t=o+m)&&(t=p-1),a=0,c=n;c<=i;c++)for(r=c*p,u=s;u<=t;u++)a+=v[r+u];g[l*p+o]=y(a,e)}S.pop(5)}function n(){var e,t=S.stackValue(1),i=S.stackIntegerValue(0),r=I(t),s=b(t);if(S.failed())return null;for(e=0;e<=s-1;e++)r[e]=r[e]*i>>>10;S.pop(2)}function a(){var e,t,i,r,s,n,a,o,u,l,c=S.stackValue(6),h=S.stackValue(5),f=S.stackIntegerValue(4),p=S.stackIntegerValue(3),d=S.stackIntegerValue(2),m=S.stackIntegerValue(1),v=S.stackIntegerValue(0),g=I(c),k=I(h);if(S.success(b(h)===f*p),S.success(b(h)===b(c)*d*d),S.failed())return null;for((r=0)<(4&m)&&(r+=65536),0<(2&m)&&(r+=256),0<(1&m)&&++r,n=-1,o=0;o<=y(p,d)-1;o++)for(a=0;a<=y(f,d)-1;a++)for(u=g[++n],i=(u=255<(u=(l=v)<0?l<-31?0:u>>>0-l:31<l?0:u<<l)?255:u)<=0?1:u*r,s=t=(o*f+a)*d;s<=t+(d-1)*f;s+=f)for(e=s;e<=s+d-1;e++)k[e]=i;S.pop(7)}function o(e){return!1!=((S=e).majorVersion()==t)&&S.minorVersion()>=i}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:s,primitiveEvaporateRate:n,setInterpreter:o,primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:a,getModuleName:r}):self.setTimeout(e,100)}()}(),!function(){var t=1,o=11;function i(e){return"number"==typeof e?F.classSmallInteger():e.sqClass}function y(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function S(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function u(e,t){return e-(0|Math.floor(e/t))*t|0}function n(e,t){return 31<t?0:e<<t}var l=32768,h=32768,c=30,R=286,f=258,I=3,p=32767,W=32768,z=1,F=null,e="ZipPlugin 3 November 2014 (e)",r=0,a=0,U=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],K=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],d=0,m=0,v=0,g=null,O=0,H=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],k=null,G=0,w=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],X=null,b=null,Z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=null,A=null,s=0,Y=null,Q=0,P=0,_=null,x=0,V=null,j=0,$=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],q=0,M=0,ee=null,B=0,N=0,T=0;function te(e,t,i){var r,s,n,a,o,u,l,c,h,f;if(!(e<v)){if(x<=P)return!0;for(s=!1,n=v;n<=e;){if(s||(l=re(n,I-1,n,t,i),E(n),o=65535&l,a=l>>>16),h=65535&(l=re(n+1,a,o,t,i)),(c=l>>>16)<=a&&I<=a){for(r=function(e,t){V[P]=e-I,b[P]=t,e=$[e-I],_[e]++,e=t<257?w[t-1]:w[256+(t-1>>>7)];return X[e]++,++j,++P===x||0==(4095&P)&&fe()}(a,n-o),u=1;u<=a-1;u++)E(++n);s=!1,++n}else f=g[n],V[P]=f,b[P]=0,_[f]++,r=++P===x||0==(4095&P)&&fe(),++n<=e&&!r&&(E(n),s=!0,o=h,a=c);if(r)return v=n,!0}v=n}return!1}function ie(e){for(var t=i(e);!t.isNil&&7<=t.classInstSize();)t=t.superclass();return!t.isNil&&(a=t.classInstSize(),1)}function re(e,t,i,r,s){var n,a,o,u,l,c=t<<16|i;if(f<=t)return c;if(!(0<(i=e-(l=C[pe(e+I-1)]))&&i<h))return c;for(a=r,u=h<e?e-h:0,n=t;;){if(o=function(e,t,i){var r;if(g[e+i]!==g[t+i])return 0;if(g[e+i-1]!==g[t+i-1])return 0;if(g[e]!==g[t])return 0;if(g[e+1]!==g[t+1])return 1;for(r=2;r<f&&g[e+r]===g[t+r];)++r;return r}(e,l,n),n<(o=(o=q<e+o?q-e:o)===I&&h>>2<e-l?I-1:o)){if(c=o<<16|l,f<=(n=o))return c;if(s<n)return c}if(!(0<--a))return c;if((l=A[l&p])<=u)return c}}function se(){return e}function E(e){var t;s=pe(e+I-1),t=C[s],C[s]=e,A[e&p]=t}function L(e,t){if(!(0<=t&&n(1,e)>t))return F.primitiveFail();for(d|=n(t,m),m+=e;8<=m&&q<O;)g[q]=255&d,++q,d>>>=8,m-=8}function ne(){var e,t,i,r;return 3!==F.methodArgumentCount()?F.primitiveFail():(t=F.stackIntegerValue(0),e=F.stackIntegerValue(1),r=F.stackIntegerValue(2),i=F.stackObjectValue(3),F.failed()?null:function(e){var t;if(F.isPointers(e)&&15<=y(e)&&(t=F.fetchPointerofObject(0,e),F.isBytes(t))){if(0===a){if(!ie(e))return;if(y(e)<a+5)return a=0,0}return g=t.bytes,O=S(t),q=F.fetchIntegerofObject(1,e),M=F.fetchIntegerofObject(2,e),t=F.fetchPointerofObject(a+0,e),F.isWords(t)&&y(t)===l?(C=t.words,t=F.fetchPointerofObject(a+1,e),!(!F.isWords(t)||y(t)!==W||(A=t.words,s=F.fetchIntegerofObject(a+2,e),v=F.fetchIntegerofObject(a+3,e),t=F.fetchPointerofObject(a+5,e),!F.isBytes(t))||(x=y(t),V=t.bytes,t=F.fetchPointerofObject(a+6,e),!(F.isWords(t)&&y(t)>=x))||(b=t.words,t=F.fetchPointerofObject(a+7,e),!F.isWords(t))||y(t)!==R||(_=t.words,t=F.fetchPointerofObject(a+8,e),!F.isWords(t))||y(t)!==c||(X=t.words,P=F.fetchIntegerofObject(a+9,e),j=F.fetchIntegerofObject(a+10,e),F.failed()))):void 0}}(i)?(r=te(r,e,t),F.failed()||(F.storeIntegerofObjectwithValue(a+2,i,s),F.storeIntegerofObjectwithValue(a+3,i,v),F.storeIntegerofObjectwithValue(a+9,i,P),F.storeIntegerofObjectwithValue(a+10,i,j)),void(F.failed()||(F.pop(4),F.pushBool(r)))):F.primitiveFail())}function ae(){var e,t,i,r,s,n;if(2!==F.methodArgumentCount())return F.primitiveFail();if(e=F.stackIntegerValue(0),r=F.stackObjectValue(1),F.failed())return null;if(!F.isWords(r))return F.primitiveFail();for(n=y(r),s=r.wordsAsInt32Array(),i=0;i<=n-1;i++)t=s[i],s[i]=e<=t?t-e:0;F.pop(2)}function oe(){var e,t;if(2!==F.methodArgumentCount())return F.primitiveFail();if(e=F.stackValue(0),!F.isWords(e))return F.primitiveFail();if(k=e.words,G=y(e),e=F.stackValue(1),!F.isWords(e))return F.primitiveFail();if(Y=e.words,Q=y(e),t=F.stackValue(2),!F.isPointers(t))return F.primitiveFail();if(0===r){if(!function(e){for(var t=i(e);!t.isNil&&13<=t.classInstSize();)t=t.superclass();return!t.isNil&&(r=t.classInstSize(),1)}(t))return F.primitiveFail();if(y(t)<r+8)return r=0,F.primitiveFail()}return y(t)<r+8?F.primitiveFail():(M=F.fetchIntegerofObject(2,t),T=F.fetchIntegerofObject(r+0,t),d=F.fetchIntegerofObject(r+1,t),m=F.fetchIntegerofObject(r+2,t),N=F.fetchIntegerofObject(r+4,t),B=F.fetchIntegerofObject(r+5,t),F.failed()?null:(--M,--N,--B,e=F.fetchPointerofObject(0,t),F.isBytes(e)&&(g=e.bytes,O=S(e),e=F.fetchPointerofObject(r+3,t),F.isBytes(e))?(ee=e.bytes,function(){var e,t,i,r,s,n,a,o,u,l,c;n=O-1;for(;M<n&&N<=B;)if(o=d,a=m,u=N,(c=de(Y,Q))<256)g[++M]=c;else{if(256===c)return T&=z;if(s=65535&c,0<(i=(c>>>16)-1)&&(s+=D(i)),c=de(k,G),e=65535&c,0<(i=c>>>16)&&(e+=D(i)),n<=M+s)return d=o,m=a,N=u;for(l=(t=M)-e,r=1;r<=s;r++)g[t+r]=g[l+r];M+=s}}(),void(F.failed()||(F.storeIntegerofObjectwithValue(2,t,M+1),F.storeIntegerofObjectwithValue(r+0,t,T),F.storeIntegerofObjectwithValue(r+1,t,d),F.storeIntegerofObjectwithValue(r+2,t,m),F.storeIntegerofObjectwithValue(r+4,t,N+1),F.pop(2)))):F.primitiveFail()))}function ue(){var e,t,i,r,s,n,a,o;if(4!==F.methodArgumentCount())return F.primitiveFail();if(i=F.stackObjectValue(0),o=F.stackIntegerValue(1),a=F.stackIntegerValue(2),e=F.positive32BitValueOf(F.stackValue(3)),F.failed())return 0;if(!(F.isBytes(i)&&a<=o&&0<a))return F.primitiveFail();if(!(o<=S(i)))return F.primitiveFail();for(t=i.bytes,--o,s=65535&e,n=e>>>16&65535,r=--a;r<=o;r++)s=u(s+t[r],65521),n=u(n+s,65521);F.popthenPush(5,F.positive32BitIntegerFor((n<<16)+s))}function le(){var e,t,i,r,s,n;if(4!==F.methodArgumentCount())return F.primitiveFail();if(t=F.stackObjectValue(0),n=F.stackIntegerValue(1),s=F.stackIntegerValue(2),i=F.positive32BitValueOf(F.stackValue(3)),F.failed())return 0;if(!(F.isBytes(t)&&s<=n&&0<s))return F.primitiveFail();if(!(n<=S(t)))return F.primitiveFail();for(e=t.bytes,--n,r=--s;r<=n;r++)i=H[255&(i^e[r])]^i>>>8;F.popthenPush(5,F.positive32BitIntegerFor(i))}function ce(){var e,t,i,r,s;return 4!==F.methodArgumentCount()?F.primitiveFail():(t=F.stackObjectValue(0),i=F.stackObjectValue(1),e=F.stackObjectValue(2),s=F.stackObjectValue(3),r=F.stackObjectValue(4),F.failed()?null:function(e){var t;if(0===a){if(!ie(e))return;if(y(e)<a+3)return a=0,0}return F.isPointers(e)&&y(e)>=a+3&&(t=F.fetchPointerofObject(0,e),F.isBytes(t)?(g=t.bytes,O=S(t),q=F.fetchIntegerofObject(1,e),M=F.fetchIntegerofObject(2,e),d=F.fetchIntegerofObject(a+0,e),m=F.fetchIntegerofObject(a+1,e),!F.failed()):F.primitiveFail())}(r)&&F.isPointers(t)&&2<=y(t)&&F.isPointers(i)&&2<=y(i)&&F.isPointers(s)&&3<=y(s)&&F.isPointers(e)&&3<=y(e)?(s=function(e,t,i,r){var s,n,a,o,u,l,c,h,f,p,d,m,v,g,k,b;if(k=F.fetchPointerofObject(0,e),m=F.fetchIntegerofObject(1,e),d=F.fetchIntegerofObject(2,e),!(m<=d&&F.isBytes(k)&&d<=S(k)))return F.primitiveFail();if(f=k.bytes,k=F.fetchPointerofObject(0,t),!(F.isWords(k)&&d<=y(k)&&F.fetchIntegerofObject(1,t)===m&&F.fetchIntegerofObject(2,t)===d))return F.primitiveFail();if(a=k.words,k=F.fetchPointerofObject(0,i),!F.isWords(k))return F.primitiveFail();if(p=y(k),v=k.words,k=F.fetchPointerofObject(1,i),!F.isWords(k)||p!==y(k))return F.primitiveFail();if(g=k.words,k=F.fetchPointerofObject(0,r),!F.isWords(k))return F.primitiveFail();if(u=y(k),o=k.words,k=F.fetchPointerofObject(1,r),!F.isWords(k)||u!==y(k))return F.primitiveFail();l=k.words,L(0,0),b=0;for(;m<d&&q+4<O;)if(h=f[m],n=a[m],++m,0===n){if(++b,!(h<p))return F.primitiveFail();L(v[h],g[h])}else{if(b=b+h+I,!(h<256))return F.primitiveFail();if(!((s=$[h])<p))return F.primitiveFail();if(L(v[s],g[s]),0!==(c=J[s-257])&&(h-=K[s-257],L(c,h)),!(--n<32768))return F.primitiveFail();if(!((s=n<256?w[n]:w[256+(n>>>7)])<u))return F.primitiveFail();L(o[s],l[s]),0!==(c=Z[s])&&(n-=U[s],L(c,n))}if(F.failed())return null;return F.storeIntegerofObjectwithValue(1,e,m),F.storeIntegerofObjectwithValue(1,t,m),b}(s,e,i,t),F.failed()||(F.storeIntegerofObjectwithValue(1,r,q),F.storeIntegerofObjectwithValue(a+0,r,d),F.storeIntegerofObjectwithValue(a+1,r,m)),void(F.failed()||(F.pop(5),F.pushInteger(s)))):F.primitiveFail())}function he(e){return!1!=((F=e).majorVersion()==t)&&F.minorVersion()>=o}function fe(){var e;return P===x||0==(4095&P)&&!(10*j<=P||(e=P-j)<=j)&&4*e<=j}function pe(e){return e=g[e],32767&(s<<5^e)}function de(e,t){var i,r,s=e[0]>>>24;if(16<s)F.primitiveFail();else for(i=2;;){if(t<=(r=i+D(s)-1))return F.primitiveFail(),0;if(0==(1056964608&(r=e[r])))return r;if(i=65535&r,16<(s=r>>>24&255))return F.primitiveFail(),0}return 0}function D(e){for(var t,i,r,s;m<e;)i=ee[++N],d+=n(i,m),m+=8;return t=d&n(1,e)-1,r=d,d=31<(s=e)?0:r>>>s,m-=e,t}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:ce,primitiveUpdateAdler32:ue,primitiveUpdateGZipCrc32:le,primitiveDeflateUpdateHashTable:ae,setInterpreter:he,getModuleName:se,primitiveDeflateBlock:ne,primitiveInflateDecompressBlock:oe}):self.setTimeout(e,100)}()}(),registerLibC();var LZString$1={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var t,i,r,s,n,a,o,u="",l=0;for(e=LZString$1.compress(e);l<2*e.length;)l%2==0?(t=e.charCodeAt(l/2)>>8,i=255&e.charCodeAt(l/2),r=l/2+1<e.length?e.charCodeAt(l/2+1)>>8:NaN):(t=255&e.charCodeAt((l-1)/2),(l+1)/2<e.length?(i=e.charCodeAt((l+1)/2)>>8,r=255&e.charCodeAt((l+1)/2)):i=r=NaN),l+=3,s=t>>2,n=(3&t)<<4|i>>4,a=(15&i)<<2|r>>6,o=63&r,isNaN(i)?a=o=64:isNaN(r)&&(o=64),u=u+LZString$1._keyStr.charAt(s)+LZString$1._keyStr.charAt(n)+LZString$1._keyStr.charAt(a)+LZString$1._keyStr.charAt(o);return u},decompressFromBase64:function(e){if(null==e)return"";var t,i,r,s,n,a,o="",u=0,l=0,c=LZString$1._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)i=LZString$1._keyStr.indexOf(e.charAt(l++))<<2|(n=LZString$1._keyStr.indexOf(e.charAt(l++)))>>4,r=(15&n)<<4|(n=LZString$1._keyStr.indexOf(e.charAt(l++)))>>2,s=(3&n)<<6|(a=LZString$1._keyStr.indexOf(e.charAt(l++))),u%2==0?(t=i<<8,64!=n&&(o+=c(t|r)),64!=a&&(t=s<<8)):(o+=c(t|i),64!=n&&(t=r<<8),64!=a&&(o+=c(t|s))),u+=3;return LZString$1.decompress(o)},compressToUTF16:function(e){if(null==e)return"";var t,i,r,s="",n=0,a=LZString$1._f;for(e=LZString$1.compress(e),t=0;t<e.length;t++)switch(i=e.charCodeAt(t),n++){case 0:s+=a(32+(i>>1)),r=(1&i)<<14;break;case 1:s+=a(r+(i>>2)+32),r=(3&i)<<13;break;case 2:s+=a(r+(i>>3)+32),r=(7&i)<<12;break;case 3:s+=a(r+(i>>4)+32),r=(15&i)<<11;break;case 4:s+=a(r+(i>>5)+32),r=(31&i)<<10;break;case 5:s+=a(r+(i>>6)+32),r=(63&i)<<9;break;case 6:s+=a(r+(i>>7)+32),r=(127&i)<<8;break;case 7:s+=a(r+(i>>8)+32),r=(255&i)<<7;break;case 8:s+=a(r+(i>>9)+32),r=(511&i)<<6;break;case 9:s+=a(r+(i>>10)+32),r=(1023&i)<<5;break;case 10:s+=a(r+(i>>11)+32),r=(2047&i)<<4;break;case 11:s+=a(r+(i>>12)+32),r=(4095&i)<<3;break;case 12:s+=a(r+(i>>13)+32),r=(8191&i)<<2;break;case 13:s+=a(r+(i>>14)+32),r=(16383&i)<<1;break;case 14:s+=a(r+(i>>15)+32,32+(32767&i)),n=0}return s+a(r+32)},decompressFromUTF16:function(e){if(null==e)return"";for(var t,i,r="",s=0,n=0,a=LZString$1._f;n<e.length;){switch(i=e.charCodeAt(n)-32,s++){case 0:t=i<<1;break;case 1:r+=a(t|i>>14),t=(16383&i)<<2;break;case 2:r+=a(t|i>>13),t=(8191&i)<<3;break;case 3:r+=a(t|i>>12),t=(4095&i)<<4;break;case 4:r+=a(t|i>>11),t=(2047&i)<<5;break;case 5:r+=a(t|i>>10),t=(1023&i)<<6;break;case 6:r+=a(t|i>>9),t=(511&i)<<7;break;case 7:r+=a(t|i>>8),t=(255&i)<<8;break;case 8:r+=a(t|i>>7),t=(127&i)<<9;break;case 9:r+=a(t|i>>6),t=(63&i)<<10;break;case 10:r+=a(t|i>>5),t=(31&i)<<11;break;case 11:r+=a(t|i>>4),t=(15&i)<<12;break;case 12:r+=a(t|i>>3),t=(7&i)<<13;break;case 13:r+=a(t|i>>2),t=(3&i)<<14;break;case 14:r+=a(t|i>>1),t=(1&i)<<15;break;case 15:r+=a(t|i),s=0}n++}return LZString$1.decompress(r)},compress:function(e){if(null==e)return"";for(var t,i,r,s,n={},a={},o="",u=2,l=3,c=2,h="",f=0,p=0,d=LZString$1._f,m=0;m<e.length;m+=1)if(r=e.charAt(m),Object.prototype.hasOwnProperty.call(n,r)||(n[r]=l++,a[r]=!0),s=o+r,Object.prototype.hasOwnProperty.call(n,s))o=s;else{if(Object.prototype.hasOwnProperty.call(a,o)){if(o.charCodeAt(0)<256){for(t=0;t<c;t++)f<<=1,15==p?(p=0,h+=d(f),f=0):p++;for(i=o.charCodeAt(0),t=0;t<8;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1}else{for(i=1,t=0;t<c;t++)f=f<<1|i,15==p?(p=0,h+=d(f),f=0):p++,i=0;for(i=o.charCodeAt(0),t=0;t<16;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1}0==--u&&(u=Math.pow(2,c),c++),delete a[o]}else for(i=n[o],t=0;t<c;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1;0==--u&&(u=Math.pow(2,c),c++),n[s]=l++,o=String(r)}if(""!==o){if(Object.prototype.hasOwnProperty.call(a,o)){if(o.charCodeAt(0)<256){for(t=0;t<c;t++)f<<=1,15==p?(p=0,h+=d(f),f=0):p++;for(i=o.charCodeAt(0),t=0;t<8;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1}else{for(i=1,t=0;t<c;t++)f=f<<1|i,15==p?(p=0,h+=d(f),f=0):p++,i=0;for(i=o.charCodeAt(0),t=0;t<16;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1}0==--u&&(u=Math.pow(2,c),c++),delete a[o]}else for(i=n[o],t=0;t<c;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1;0==--u&&(u=Math.pow(2,c),c++)}for(i=2,t=0;t<c;t++)f=f<<1|1&i,15==p?(p=0,h+=d(f),f=0):p++,i>>=1;for(;;){if(f<<=1,15==p){h+=d(f);break}p++}return h},decompress:function(e){if(null==e)return"";if(""==e)return null;for(var t,i,r,s,n,a,o=[],u=4,l=4,c=3,h="",f="",p=LZString$1._f,d={string:e,val:e.charCodeAt(0),position:32768,index:1},m=0;m<3;m+=1)o[m]=m;for(i=0,s=Math.pow(2,2),n=1;n!=s;)r=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),i|=(0<r?1:0)*n,n<<=1;switch(i){case 0:for(i=0,s=Math.pow(2,8),n=1;n!=s;)r=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),i|=(0<r?1:0)*n,n<<=1;a=p(i);break;case 1:for(i=0,s=Math.pow(2,16),n=1;n!=s;)r=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),i|=(0<r?1:0)*n,n<<=1;a=p(i);break;case 2:return""}for(t=f=o[3]=a;;){if(d.index>d.string.length)return"";for(i=0,s=Math.pow(2,c),n=1;n!=s;)r=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),i|=(0<r?1:0)*n,n<<=1;switch(a=i){case 0:for(i=0,s=Math.pow(2,8),n=1;n!=s;)r=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),i|=(0<r?1:0)*n,n<<=1;o[l++]=p(i),a=l-1,u--;break;case 1:for(i=0,s=Math.pow(2,16),n=1;n!=s;)r=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),i|=(0<r?1:0)*n,n<<=1;o[l++]=p(i),a=l-1,u--;break;case 2:return f}if(0==u&&(u=Math.pow(2,c),c++),o[a])h=o[a];else{if(a!==l)return null;h=t+t.charAt(0)}f+=h,o[l++]=t+h.charAt(0),t=h,0==--u&&(u=Math.pow(2,c),c++)}}};function setupFullscreen(t,e,i){var r,s=e.parentElement,n="fullscreenchange",a="fullscreenElement",o="fullscreenEnabled";function u(e){e=(t.fullscreen=e)||i.fullscreen;s.style.background=e?"black":"",setTimeout(onresize,0)}return s.requestFullscreen||[{req:s.webkitRequestFullscreen,exit:document.webkitExitFullscreen,evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:s.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:s.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(e){e.req&&(s.requestFullscreen=e.req,document.exitFullscreen=e.exit,n=e.evt,a=e.elem,o=e.enable)}),s.requestFullscreen?(document.addEventListener(n,function(){u(s==document[a])}),function(){document[o]&&s==document[a]!=t.fullscreen&&(t.fullscreen?s.requestFullscreen():document.exitFullscreen())}):(r=!1,function(){r!=t.fullscreen&&u(r=t.fullscreen)})}function recordModifiers(e,t){var i=e.shiftKey,r=e.ctrlKey&&!e.altKey,e=(t.isMac?e.metaKey:e.altKey&&!e.ctrlKey)||t.cmdButtonTouched,i=(i?Squeak.Keyboard_Shift:0)+(r?Squeak.Keyboard_Ctrl:0)+(e?Squeak.Keyboard_Cmd:0);return t.buttons=t.buttons&~Squeak.Keyboard_All|i,i}"undefined"!=typeof module&&null!=module&&(module.exports=LZString$1),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(s,n,a){function o(i,e){if(!n[i]){if(!s[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(u)return u(i,!0);e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}t=n[i]={exports:{}};s[i][0].call(t.exports,function(e){var t=s[i][1][e];return o(t||e)},t,t.exports,r,s,n,a)}return n[i].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,t,i){var h=e("./utils"),f=e("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,r,s,n,a,o=[],u=0,l=e.length,c="string"!==h.getTypeOf(e);u<e.length;)a=l-u,r=c?(t=e[u++],i=u<l?e[u++]:0,u<l?e[u++]:0):(t=e.charCodeAt(u++),i=u<l?e.charCodeAt(u++):0,u<l?e.charCodeAt(u++):0),s=(3&t)<<4|i>>4,n=1<a?(15&i)<<2|r>>6:64,a=2<a?63&r:64,o.push(p.charAt(t>>2)+p.charAt(s)+p.charAt(n)+p.charAt(a));return o.join("")},i.decode=function(e){var t,i,r,s,n,a,o,u=0,l=0,c=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;for(e.charAt(e.length-1)===p.charAt(64)&&c--,e.charAt(e.length-2)===p.charAt(64)&&c--,o=new(f.uint8array?Uint8Array:Array)(c);u<e.length;)r=p.indexOf(e.charAt(u++)),t=(15&(s=p.indexOf(e.charAt(u++))))<<4|(n=p.indexOf(e.charAt(u++)))>>2,i=(3&n)<<6|(a=p.indexOf(e.charAt(u++))),o[l++]=r<<2|s>>4,64!==n&&(o[l++]=t),64!==a&&(o[l++]=i);return o}},{"./support":27,"./utils":29}],2:[function(e,t,i){var r=e("./external"),s=e("./stream/DataWorker"),n=e("./stream/DataLengthProbe"),a=e("./stream/Crc32Probe"),n=e("./stream/DataLengthProbe");function o(e,t,i,r,s){this.compressedSize=e,this.uncompressedSize=t,this.crc32=i,this.compression=r,this.compressedContent=s}o.prototype={getContentWorker:function(){var e=new s(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new n("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new s(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,i){return e.pipe(new a).pipe(new n("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new n("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(e,t,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(e,t,i){var d=e("./utils");var m=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t){if(void 0===e||!e.length)return 0;if("string"!==d.getTypeOf(e)){var i=0|t,r=e,s=e.length,n=0,a=m,o=n+s;i^=-1;for(var u=n;u<o;u++)i=i>>>8^a[255&(i^r[u])];return-1^i}var l=0|t,c=e,s=e.length,n=0,h=m,f=n+s;l^=-1;for(var p=n;p<f;p++)l=l>>>8^h[255&(l^c.charCodeAt(p))];return-1^l}},{"./utils":29}],5:[function(e,t,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,t,i){e=e("es6-promise").Promise;t.exports={Promise:e}},{"es6-promise":37}],7:[function(e,t,i){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=e("pako"),n=e("./utils"),a=e("./stream/GenericWorker"),o=r?"uint8array":"array";function u(e,t){a.call(this,"FlateWorker/"+e),this._pako=new s[e]({raw:!0,level:t.level||-1}),this.meta={};var i=this;this._pako.onData=function(e){i.push({data:e,meta:i.meta})}}i.magic="\b\0",n.inherits(u,a),u.prototype.processChunk=function(e){this.meta=e.meta,this._pako.push(n.transformTo(o,e.data),!1)},u.prototype.flush=function(){a.prototype.flush.call(this),this._pako.push([],!0)},u.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},i.compressWorker=function(e){return new u("Deflate",e)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(e,t,i){function k(e,t){for(var i="",r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i}function r(e,t,i,r,s,n){var a=e.file,o=e.compression,u=n!==y.utf8encode,l=b.transformTo("string",n(a.name)),c=b.transformTo("string",y.utf8encode(a.name)),h=a.comment,n=b.transformTo("string",n(h)),f=b.transformTo("string",y.utf8encode(h)),p=c.length!==a.name.length,h=f.length!==h.length,d="",m=a.dir,v=a.date,g={crc32:0,compressedSize:0,uncompressedSize:0},i=(t&&!i||(g.crc32=e.crc32,g.compressedSize=e.compressedSize,g.uncompressedSize=e.uncompressedSize),0),e=(t&&(i|=8),u||!p&&!h||(i|=2048),0),t=0,v=(m&&(e|=16),"UNIX"===s?(t=798,e|=(u=a.unixPermissions,s=m,(65535&(u?u:s?16893:33204))<<16)):(t=20,e|=63&(a.dosPermissions||0)),m=v.getUTCHours(),m<<=6,m=(m=(m|v.getUTCMinutes())<<5)|v.getUTCSeconds()/2,u=v.getUTCFullYear()-1980,u=(u=((u<<=4)|v.getUTCMonth()+1)<<5)|v.getUTCDate(),p&&(s=k(1,1)+k(S(l),4)+c,d+="up"+k(s.length,2)+s),h&&(a=k(1,1)+k(S(n),4)+f,d+="uc"+k(a.length,2)+a),""),v=(v=(v=(v=(v=(v=(v=(v=(v=(v+="\n\0")+k(i,2))+o.magic)+k(m,2))+k(u,2))+k(g.crc32,4))+k(g.compressedSize,4))+k(g.uncompressedSize,4))+k(l.length,2))+k(d.length,2);return{fileRecord:I.LOCAL_FILE_HEADER+v+l+d,dirRecord:I.CENTRAL_FILE_HEADER+k(t,2)+v+k(n.length,2)+"\0\0\0\0"+k(e,4)+k(r,4)+l+d+n}}var b=e("../utils"),s=e("../stream/GenericWorker"),y=e("../utf8"),S=e("../crc32"),I=e("../signature");function n(e,t,i,r){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}b.inherits(n,s),n.prototype.push=function(e){var t=e.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,s.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-r-1))/i:100}}))},n.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name,this.streamFiles&&!e.file.dir?(e=r(e,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:e.fileRecord,meta:{percent:0}})):this.accumulate=!0},n.prototype.closedSource=function(e){this.accumulate=!1;var t=r(e,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(t.dirRecord),this.streamFiles&&!e.file.dir)this.push({data:(e=e,I.DATA_DESCRIPTOR+k(e.crc32,4)+k(e.compressedSize,4)+k(e.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:t.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var i=this.bytesWritten-e,i=function(e,t,i,r,s){s=b.transformTo("string",s(r));return I.CENTRAL_DIRECTORY_END+"\0\0\0\0"+k(e,2)+k(e,2)+k(t,4)+k(i,4)+k(s.length,2)+s}(this.dirRecords.length,i,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},n.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},n.prototype.error=function(e){var t=this._sources;if(!s.prototype.error.call(this,e))return!1;for(var i=0;i<t.length;i++)try{t[i].error(e)}catch(e){}return!0},n.prototype.lock=function(){s.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=n},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(e,t,i){var l=e("../compressions"),r=e("./ZipFileWorker");i.generateWorker=function(e,a,t){var o=new r(a.streamFiles,t,a.platform,a.encodeFileName),u=0;try{e.forEach(function(e,t){u++;var i=function(e,t){e=e||t,t=l[e];if(t)return t;throw new Error(e+" is not a valid compression method !")}(t.options.compression,a.compression),r=t.options.compressionOptions||a.compressionOptions||{},s=t.dir,n=t.date;t._compressWorker(i,r).withStreamInfo("file",{name:e,dir:s,date:n,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)}),o.entriesCount=u}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e,t=new r;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(e,t,i){var r=e("./utils"),a=e("./external"),o=e("./utf8"),r=e("./utils"),u=e("./zipEntries"),l=e("./stream/Crc32Probe"),c=e("./nodejsUtils");t.exports=function(e,s){var n=this;return s=r.extend(s||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(e)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,s.optimizedBinaryString,s.base64).then(function(e){var t=new u(s);return t.load(e),t}).then(function(e){var t=[a.Promise.resolve(e)],i=e.files;if(s.checkCRC32)for(var r=0;r<i.length;r++)t.push(function(r){return new a.Promise(function(e,t){var i=r.decompressed.getContentWorker().pipe(new l);i.on("error",function(e){t(e)}).on("end",function(){i.streamInfo.crc32!==r.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}(i[r]));return a.Promise.all(t)}).then(function(e){for(var e=e.shift(),t=e.files,i=0;i<t.length;i++){var r=t[i];n.file(r.fileNameStr,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:s.createFolders})}return e.zipComment.length&&(n.comment=e.zipComment),n})}},{"./external":6,"./nodejsUtils":12,"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(e,t,i){!function(i){t.exports={isNode:void 0!==i,newBuffer:function(e,t){return new i(e,t)},isBuffer:function(e){return i.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}}.call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(e,t,i){function n(e,t){return t=void 0!==t?t:l.createFolders,e=v(e),this.files[e]||m.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]}var s=e("./utf8"),a=e("./utils"),o=e("./stream/GenericWorker"),u=e("./stream/StreamHelper"),l=e("./defaults"),c=e("./compressedObject"),h=e("./zipObject"),f=e("./generate"),p=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),m=function(e,t,i){var r=a.getTypeOf(t),s=((i=a.extend(i||{},l)).date=i.date||new Date,null!==i.compression&&(i.compression=i.compression.toUpperCase()),"string"==typeof i.unixPermissions&&(i.unixPermissions=parseInt(i.unixPermissions,8)),i.unixPermissions&&16384&i.unixPermissions&&(i.dir=!0),i.dosPermissions&&16&i.dosPermissions&&(i.dir=!0),i.dir&&(e=v(e)),i.createFolders&&(s=function(e){if(e.slice(-1)==="/")e=e.substring(0,e.length-1);var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""}(e))&&n.call(this,s,!0),"string"===r&&!1===i.binary&&!1===i.base64);i.binary=!s;(t instanceof c&&0===t.uncompressedSize||i.dir||!t||0===t.length)&&(i.base64=!1,i.binary=!0,t="",i.compression="STORE");r=null,r=t instanceof c||t instanceof o?t:p.isNode&&p.isStream(t)?new d(e,t):a.prepareContent(e,t,i.binary,i.optimizedBinaryString,i.base64),s=new h(e,r,i);this.files[e]=s},v=function(e){return"/"!==e.slice(-1)&&(e+="/"),e};function g(e){return"[object RegExp]"===Object.prototype.toString.call(e)}t.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],i=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(i,r)},filter:function(i){var r=[];return this.forEach(function(e,t){i(e,t)&&r.push(t)}),r},file:function(e,t,i){var r,s;return 1===arguments.length?g(e)?(r=e,this.filter(function(e,t){return!t.dir&&r.test(e)})):(s=this.files[this.root+e])&&!s.dir?s:null:(e=this.root+e,m.call(this,e,t,i),this)},folder:function(i){var e,t;return i?g(i)?this.filter(function(e,t){return t.dir&&i.test(e)}):(e=this.root+i,e=n.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(i){i=this.root+i;var e=this.files[i];if(e||("/"!==i.slice(-1)&&(i+="/"),e=this.files[i]),e&&!e.dir)delete this.files[i];else for(var t=this.filter(function(e,t){return t.name.slice(0,i.length)===i}),r=0;r<t.length;r++)delete this.files[t[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t={};try{if((t=a.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=t.type.toLowerCase(),t.compression=t.compression.toUpperCase(),"binarystring"===t.type&&(t.type="string"),!t.type)throw new Error("No output type specified.");a.checkSupport(t.type),"darwin"!==e.platform&&"freebsd"!==e.platform&&"linux"!==e.platform&&"sunos"!==e.platform||(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var i=t.comment||this.comment||"",r=f.generateWorker(this,t,i)}catch(e){(r=new o("error")).error(e)}return new u(r,t.type||"string",t.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,"./utils":29,"./zipObject":32}],14:[function(e,t,i){var r=e("./DataReader");function s(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(s,r),s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),s=e.charCodeAt(3),n=this.length-4;0<=n;--n)if(this.data[n]===t&&this.data[n+1]===i&&this.data[n+2]===r&&this.data[n+3]===s)return n-this.zero;return-1},s.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),e=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&i===s[1]&&r===s[2]&&e===s[3]},s.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?[]:(t=this.data.slice(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=s},{"../utils":29,"./DataReader":15}],15:[function(e,t,i){var r=e("../utils");function s(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=s},{"../utils":29}],16:[function(e,t,i){var r=e("./Uint8ArrayReader");function s(e){r.call(this,e)}e("../utils").inherits(s,r),s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(e,t,i){var r=e("./DataReader");function s(e){r.call(this,e)}e("../utils").inherits(s,r),s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":29,"./DataReader":15}],18:[function(e,t,i){var r=e("./ArrayReader");function s(e){r.call(this,e)}e("../utils").inherits(s,r),s.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?new Uint8Array(0):(t=this.data.subarray(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=s},{"../utils":29,"./ArrayReader":14}],19:[function(e,t,i){var r=e("../utils"),s=e("../support"),n=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||s.uint8array?"nodebuffer"===t?new o(e):s.uint8array?new u(r.transformTo("uint8array",e)):new n(r.transformTo("array",e)):new a(e)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(e,t,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],21:[function(e,t,i){var r=e("./GenericWorker"),s=e("../utils");function n(e){r.call(this,"ConvertWorker to "+e),this.destType=e}s.inherits(n,r),n.prototype.processChunk=function(e){this.push({data:s.transformTo(this.destType,e.data),meta:e.meta})},t.exports=n},{"../utils":29,"./GenericWorker":25}],22:[function(e,t,i){var r=e("./GenericWorker"),s=e("../crc32");function n(){r.call(this,"Crc32Probe")}e("../utils").inherits(n,r),n.prototype.processChunk=function(e){this.streamInfo.crc32=s(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=n},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(e,t,i){var r=e("../utils"),s=e("./GenericWorker");function n(e){s.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(n,s),n.prototype.processChunk=function(e){var t;e&&(t=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=t+e.data.length),s.prototype.processChunk.call(this,e)},t.exports=n},{"../utils":29,"./GenericWorker":25}],24:[function(e,t,i){var r=e("../utils"),s=e("./GenericWorker");function n(e){s.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}r.inherits(n,s),n.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished)||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":29,"./GenericWorker":25}],25:[function(e,t,i){function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)this._listeners[e][i].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){var e;return!(!this.isPaused||this.isFinished||(e=this.isPaused=!1,this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),e))},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=r},{}],26:[function(a,o,e){!function(u){var l=a("../utils"),s=a("./ConvertWorker"),n=a("./GenericWorker"),c=a("../base64"),t=a("../nodejs/NodejsStreamOutputAdapter"),i=a("../external");function r(e,o){return new i.Promise(function(t,i){var r=[],s=e._internalType,n=e._outputType,a=e._mimeType;e.on("data",function(e,t){r.push(e),o&&o(t)}).on("error",function(e){r=[],i(e)}).on("end",function(){try{var e=function(e,t,i){switch(e){case"blob":return l.newBlob(l.transformTo("arraybuffer",t),i);case"base64":return c.encode(t);default:return l.transformTo(e,t)}}(n,function(e,t){for(var i=0,r=null,s=0,n=0;n<t.length;n++)s+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(s),n=0;n<t.length;n++)r.set(t[n],i),i+=t[n].length;return r;case"nodebuffer":return u.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(s,r),a);t(e)}catch(e){i(e)}r=[]}).resume()})}function e(e,t,i){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=i,l.checkSupport(r),this._worker=e.pipe(new s(r)),e.lock()}catch(e){this._worker=new n("error"),this._worker.error(e)}}e.prototype={accumulate:function(e){return r(this,e)},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,function(e){t.call(i,e.data,e.meta)}):this._worker.on(e,function(){l.delay(t,arguments,i)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(l.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new t(this,{objectMode:"nodebuffer"!==this._outputType},e)}},o.exports=e}.call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],27:[function(e,t,r){!function(t){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==t,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{t=new ArrayBuffer(0);try{r.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(t),r.blob=0===i.getBlob("application/zip").size}catch(e){r.blob=!1}}}r.nodestream=!!e("./nodejs/NodejsStreamOutputAdapter").prototype}.call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(e,t,s){for(var u=e("./utils"),l=e("./support"),c=e("./nodejsUtils"),i=e("./stream/GenericWorker"),h=new Array(256),r=0;r<256;r++)h[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;h[254]=h[254]=1;function n(){i.call(this,"utf-8 decode"),this.leftOver=null}function a(){i.call(this,"utf-8 encode")}s.utf8encode=function(e){if(l.nodebuffer)return c.newBuffer(e,"utf-8");for(var t,i,r,s,n=e,a=n.length,o=0,u=0;u<a;u++)55296==(64512&(i=n.charCodeAt(u)))&&u+1<a&&56320==(64512&(r=n.charCodeAt(u+1)))&&(i=65536+(i-55296<<10)+(r-56320),u++),o+=i<128?1:i<2048?2:i<65536?3:4;for(t=new(l.uint8array?Uint8Array:Array)(o),u=s=0;s<o;u++)55296==(64512&(i=n.charCodeAt(u)))&&u+1<a&&56320==(64512&(r=n.charCodeAt(u+1)))&&(i=65536+(i-55296<<10)+(r-56320),u++),i<128?t[s++]=i:(i<2048?t[s++]=192|i>>>6:(i<65536?t[s++]=224|i>>>12:(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63),t[s++]=128|i>>>6&63),t[s++]=128|63&i);return t},s.utf8decode=function(e){if(l.nodebuffer)return u.transformTo("nodebuffer",e).toString("utf-8");for(var t,i,r=e=u.transformTo(l.uint8array?"uint8array":"array",e),s=r.length,n=new Array(2*s),a=0,o=0;o<s;)if((t=r[o++])<128)n[a++]=t;else if(4<(i=h[t]))n[a++]=65533,o+=i-1;else{for(t&=2===i?31:3===i?15:7;1<i&&o<s;)t=t<<6|63&r[o++],i--;1<i?n[a++]=65533:t<65536?n[a++]=t:(t-=65536,n[a++]=55296|t>>10&1023,n[a++]=56320|1023&t)}return n.length!==a&&(n.subarray?n=n.subarray(0,a):n.length=a),u.applyFromCharCode(n)},u.inherits(n,i),n.prototype.processChunk=function(e){var t=u.transformTo(l.uint8array?"uint8array":"array",e.data),i=(this.leftOver&&this.leftOver.length&&(l.uint8array?(i=t,(t=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),t.set(i,this.leftOver.length)):t=this.leftOver.concat(t),this.leftOver=null),function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+h[e[i]]>t?i:t}(t)),r=t;i!==t.length&&(l.uint8array?(r=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(r=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:s.utf8decode(r),meta:e.meta})},n.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=n,u.inherits(a,i),a.prototype.processChunk=function(e){this.push({data:s.utf8encode(e.data),meta:e.meta})},s.Utf8EncodeWorker=a},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(e,t,o){var u=e("./support"),l=e("./base64"),i=e("./nodejsUtils"),r=e("asap"),c=e("./external");function s(e){return e}function h(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}o.newBlob=function(t,i){o.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return r.append(t),r.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(e,t,i){var r=[],s=0,n=e.length;if(n<=i)return String.fromCharCode.apply(null,e);for(;s<n;)r.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(s,Math.min(s+i,n))):String.fromCharCode.apply(null,e.subarray(s,Math.min(s+i,n)))),s+=i;return r.join("")},stringifyByChar:function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},applyCanBeUsed:{uint8array:function(){try{return u.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return u.nodebuffer&&1===String.fromCharCode.apply(null,i.newBuffer(1)).length}catch(e){return!1}}()}};function a(e){var t=65536,i=o.getTypeOf(e),r=!0;if("uint8array"===i?r=n.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=n.applyCanBeUsed.nodebuffer),r)for(;1<t;)try{return n.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return n.stringifyByChar(e)}function f(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}o.applyFromCharCode=a;var p={};p.string={string:s,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:function(e){return h(e,i.newBuffer(e.length))}},p.array={string:a,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBuffer(e)}},p.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBuffer(new Uint8Array(e))}},p.uint8array={string:a,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return i.newBuffer(e)}},p.nodebuffer={string:a,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:s},o.transformTo=function(e,t){if(t=t||"",!e)return t;o.checkSupport(e);var i=o.getTypeOf(t);return p[i][e](t)},o.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":u.nodebuffer&&i.isBuffer(e)?"nodebuffer":u.uint8array&&e instanceof Uint8Array?"uint8array":u.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(e){if(!u[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(e){for(var t,i="",r=0;r<(e||"").length;r++)i+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return i},o.delay=function(e,t,i){r(function(){e.apply(i||null,t||[])})},o.inherits=function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i},o.extend=function(){for(var e,t={},i=0;i<arguments.length;i++)for(e in arguments[i])arguments[i].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[i][e]);return t},o.prepareContent=function(i,r,s,n,a){return(u.blob&&r instanceof Blob&&"undefined"!=typeof FileReader?new c.Promise(function(t,i){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){i(e.target.error)},e.readAsArrayBuffer(r)}):c.Promise.resolve(r)).then(function(e){var t=o.getTypeOf(e);return t?("arraybuffer"===t?e=o.transformTo("uint8array",e):"string"===t&&(a?e=l.decode(e):s&&!0!==n&&(e=h(t=e,new(u.uint8array?Uint8Array:Array)(t.length)))),e):c.Promise.reject(new Error("The data of '"+i+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(e,t,i){var r=e("./reader/readerFor"),s=e("./utils"),n=e("./signature"),a=e("./zipEntry"),o=(e("./utf8"),e("./support"));function u(e){this.files=[],this.loadOptions=e}u.prototype={checkSignature:function(e){var t;if(!this.reader.readAndCheckSignature(e))throw this.reader.index-=4,t=this.reader.readString(4),new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);e=this.reader.readString(4)===t;return this.reader.setIndex(i),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",t=s.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(t)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}e=this.centralDirOffset+this.centralDirSize,e=t-(e=this.zip64?e+20+(12+this.zip64EndOfCentralSize):e);if(0<e)this.isSignature(t,n.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=u},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(e,t,i){var r=e("./reader/readerFor"),s=e("./utils"),n=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),u=e("./compressions"),l=e("./support");function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(t),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){var t;this.extraFields[1]&&(t=r(this.extraFields[1].value),this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS)&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t,i,r,s=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<s;)t=e.readInt(2),i=e.readInt(2),r=e.readData(i),this.extraFields[t]={id:t,length:i,value:r}},handleUTF8:function(){var e,t=l.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(e=s.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(e)),null!==(e=this.findExtraFieldUnicodeComment())?this.fileCommentStr=e:(e=s.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(e)))},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=r(t.value)).readInt(1)||a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))},findExtraFieldUnicodeComment:function(){var e,t=this.extraFields[25461];return!t||1!==(e=r(t.value)).readInt(1)||a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}},t.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(e,t,i){for(var s=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),n=e("./utf8"),a=e("./compressedObject"),o=e("./stream/GenericWorker"),u=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}},l=(u.prototype={internalStream:function(e){var e=e.toLowerCase(),t="string"===e||"text"===e,i=("binarystring"!==e&&"text"!==e||(e="string"),this._decompressWorker()),r=!this._dataBinary;return r&&!t&&(i=i.pipe(new n.Utf8EncodeWorker)),!r&&t&&(i=i.pipe(new n.Utf8DecodeWorker)),new s(i,e,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){var i;return this._data instanceof a&&this._data.compression.magic===e.magic?this._data.getCompressedWorker():(i=this._decompressWorker(),this._dataBinary||(i=i.pipe(new n.Utf8EncodeWorker)),a.createWorkerFrom(i,e,t))},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof o?this._data:new r(this._data)}},["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"]),c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<l.length;h++)u.prototype[l[h]]=c;t.exports=u},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],33:[function(e,t,i){var r=e("./raw"),s=[],n=[],a=r.makeRequestCallFromTimer(function(){if(n.length)throw n.shift()});function o(e){var t=s.length?s.pop():new u;t.task=e,r(t)}function u(){this.task=null}t.exports=o,u.prototype.call=function(){try{this.task.call()}catch(e){o.onerror?o.onerror(e):(n.push(e),a())}finally{this.task=null,s[s.length]=this}}},{"./raw":34}],34:[function(e,l,t){!function(e){function t(e){r.length||i(),r[r.length]=e}l.exports=t;var i,r=[],s=0;function n(){for(;s<r.length;){var e=s;if(s+=1,r[e].call(),1024<s){for(var t=0,i=r.length-s;t<i;t++)r[t]=r[t+s];r.length-=s,s=0}}r.length=0,s=0}var a,o,e=e.MutationObserver||e.WebKitMutationObserver;function u(r){return function(){var e=setTimeout(i,0),t=setInterval(i,50);function i(){clearTimeout(e),clearInterval(t),r()}}}i="function"==typeof e?(a=1,e=new e(e=n),o=document.createTextNode(""),e.observe(o,{characterData:!0}),function(){a=-a,o.data=a}):u(n),t.requestFlush=i,t.makeRequestCallFromTimer=u}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,t,i){},{}],36:[function(e,t,i){var r,t=t.exports={},s=[],n=!1,a=-1;function o(){n=!1,r.length?s=r.concat(s):a=-1,s.length&&u()}function u(){if(!n){for(var e=setTimeout(o),t=(n=!0,s.length);t;){for(r=s,s=[];++a<t;)r&&r[a].run();a=-1,t=s.length}r=null,n=!1,clearTimeout(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];s.push(new l(e,t)),1!==s.length||n||setTimeout(u,0)},l.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=c,t.addListener=c,t.once=c,t.off=c,t.removeListener=c,t.removeAllListeners=c,t.emit=c,t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],37:[function(U,K,e){!function(W,z){!function(){function l(e){return"function"==typeof e}var t,i,e=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=e,r=0,o=function(e,t){d[r]=e,d[r+1]=t,2===(r+=2)&&(i?i(m):k())};var e="undefined"!=typeof window?window:void 0,s=e||{},s=s.MutationObserver||s.WebKitMutationObserver,n=void 0!==W&&"[object process]"==={}.toString.call(W),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){return function(){setTimeout(m,1)}}var h,f,p,d=new Array(1e3);function m(){for(var e=0;e<r;e+=2)(0,d[e])(d[e+1]),d[e]=void 0,d[e+1]=void 0;r=0}function v(){try{var e=U("vertx");return t=e.runOnLoop||e.runOnContext,function(){t(m)}}catch(e){return c()}}function g(){}var k=n?function(){W.nextTick(m)}:s?(f=0,n=new s(m),p=document.createTextNode(""),n.observe(p,{characterData:!0}),function(){p.data=f=++f%2}):u?((h=new MessageChannel).port1.onmessage=m,function(){h.port2.postMessage(0)}):(void 0===e&&"function"==typeof U?v:c)(),b=void 0,y=1,S=2,I=new x;function F(e,r,s){o(function(t){var i=!1,e=function(e,t,i,r){try{e.call(t,i,r)}catch(e){return e}}(s,r,function(e){i||(i=!0,(r!==e?w:C)(t,e))},function(e){i||(i=!0,A(t,e))},t._label);!i&&e&&(i=!0,A(t,e))},e)}function O(e,t){var i,r;t.constructor===e.constructor?(i=e,(r=t)._state===y?C(i,r._result):r._state===S?A(i,r._result):P(r,void 0,function(e){w(i,e)},function(e){A(i,e)})):(r=function(e){try{return e.then}catch(e){return I.error=e,I}}(t))===I?A(e,I.error):void 0!==r&&l(r)?F(e,t,r):C(e,t)}function w(e,t){var i;e===t?A(e,new TypeError("You cannot resolve a promise with itself")):("function"==typeof(i=t)||"object"==typeof i&&null!==i?O:C)(e,t)}function N(e){e._onerror&&e._onerror(e._result),_(e)}function C(e,t){e._state===b&&(e._result=t,e._state=y,0!==e._subscribers.length)&&o(_,e)}function A(e,t){e._state===b&&(e._state=S,e._result=t,o(N,e))}function P(e,t,i,r){var s=e._subscribers,n=s.length;e._onerror=null,s[n]=t,s[n+y]=i,s[n+S]=r,0===n&&e._state&&o(_,e)}function _(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r,s,n=e._result,a=0;a<t.length;a+=3)r=t[a],s=t[a+i],r?j(i,r,s,n):s(n);e._subscribers.length=0}}function x(){this.error=null}var V=new x;function j(e,t,i,r){var s,n,a,o,u=l(i);if(u){if((s=function(e,t){try{return e(t)}catch(e){return V.error=e,V}}(i,r))===V?(o=!0,n=s.error,s=null):a=!0,t===s)return void A(t,new TypeError("A promises callback cannot return that same promise."))}else s=r,a=!0;t._state===b&&(u&&a?w(t,s):o?A(t,n):e===y?C(t,s):e===S&&A(t,s))}function q(e,t){var i=this;i._instanceConstructor=e,i.promise=new e(g),i._validateInput(t)?(i._input=t,i.length=t.length,i._remaining=t.length,i._init(),0!==i.length&&(i.length=i.length||0,i._enumerate(),0!==i._remaining)||C(i.promise,i._result)):A(i.promise,i._validationError())}q.prototype._validateInput=function(e){return a(e)},q.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},q.prototype._init=function(){this._result=new Array(this.length)};var T=q;q.prototype._enumerate=function(){for(var e=this.length,t=this.promise,i=this._input,r=0;t._state===b&&r<e;r++)this._eachEntry(i[r],r)},q.prototype._eachEntry=function(e,t){var i,r=this._instanceConstructor;"object"==typeof(i=e)&&null!==i?e.constructor===r&&e._state!==b?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(r.resolve(e),t):(this._remaining--,this._result[t]=e)},q.prototype._settledAt=function(e,t,i){var r=this.promise;r._state===b&&(this._remaining--,e===S?A(r,i):this._result[t]=i),0===this._remaining&&C(r,this._result)},q.prototype._willSettleAt=function(e,t){var i=this;P(e,void 0,function(e){i._settledAt(y,t,e)},function(e){i._settledAt(S,t,e)})};function E(e){var t=new this(g);if(a(e))for(var i=e.length,r=0;t._state===b&&r<i;r++)P(this.resolve(e[r]),void 0,s,n);else A(t,new TypeError("You must pass an array to race."));return t;function s(e){w(t,e)}function n(e){A(t,e)}}function L(e){var t;return e&&"object"==typeof e&&e.constructor===this?e:(w(t=new this(g),e),t)}function D(e){var t=new this(g);return A(t,e),t}var R=0;var M=B;function B(e){if(this._id=R++,this._state=void 0,this._result=void 0,this._subscribers=[],g!==e){if(!l(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof B))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var t=this;try{e(function(e){w(t,e)},function(e){A(t,e)})}catch(e){A(t,e)}}}B.all=function(e){return new T(this,e).promise},B.race=E,B.resolve=L,B.reject=D,B._setScheduler=function(e){i=e},B._setAsap=function(e){o=e},B._asap=o,B.prototype={constructor:B,then:function(e,t){var i,r,s,n=this._state;return n===y&&!e||n===S&&!t?this:(i=new this.constructor(g),r=this._result,n?(s=arguments[n-1],o(function(){j(n,i,s,r)})):P(this,i,e,t),i)},catch:function(e){return this.then(null,e)}};s=function(){var e;if(void 0!==z)e=z;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;t&&"[object Promise]"===Object.prototype.toString.call(t.resolve())&&!t.cast||(e.Promise=M)},n={Promise:M,polyfill:s};void 0!==K&&K.exports?K.exports=n:void 0!==this&&(this.ES6Promise=n),s()}.call(this)}.call(this,U("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:36}],38:[function(e,t,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,i){var a=e("./zlib/deflate"),o=e("./utils/common"),u=e("./utils/strings"),r=e("./zlib/messages"),s=e("./zlib/zstream"),l=Object.prototype.toString;function n(e){if(!(this instanceof n))return new n(e);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});e=this.options;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,(this.strm.avail_out=0)!==(t=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy)))throw new Error(r[t]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var t,e="string"==typeof e.dictionary?u.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if(0!==(t=a.deflateSetDictionary(this.strm,e)))throw new Error(r[t]);this._dict_set=!0}}function c(e,t){t=new n(t);if(t.push(e,!0),t.err)throw t.msg;return t.result}n.prototype.push=function(e,t){var i,r,s=this.strm,n=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=u.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(n),s.next_out=0,s.avail_out=n),1!==(i=a.deflate(s,r))&&0!==i)return this.onEnd(i),!(this.ended=!0)}while(0!==s.avail_out&&(0!==s.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(u.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out))),(0<s.avail_in||0===s.avail_out)&&1!==i);return 4===r?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==r||(this.onEnd(0),!(s.avail_out=0))},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=n,i.deflate=c,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,i){var h=e("./zlib/inflate"),f=e("./utils/common"),p=e("./utils/strings"),d=e("./zlib/constants"),r=e("./zlib/messages"),s=e("./zlib/zstream"),n=e("./zlib/gzheader"),m=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0,h.inflateInit2(this.strm,t.windowBits));if(e!==d.Z_OK)throw new Error(r[e]);this.header=new n,h.inflateGetHeader(this.strm,this.header)}function o(e,t){t=new a(t);if(t.push(e,!0),t.err)throw t.msg;return t.result}a.prototype.push=function(e,t){var i,r,s,n,a,o=this.strm,u=this.options.chunkSize,l=this.options.dictionary,c=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?d.Z_FINISH:d.Z_NO_FLUSH,"string"==typeof e?o.input=p.binstring2buf(e):"[object ArrayBuffer]"===m.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new f.Buf8(u),o.next_out=0,o.avail_out=u),(i=h.inflate(o,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&l&&(a="string"==typeof l?p.string2buf(l):"[object ArrayBuffer]"===m.call(l)?new Uint8Array(l):l,i=h.inflateSetDictionary(this.strm,a)),i===d.Z_BUF_ERROR&&!0===c&&(i=d.Z_OK,c=!1),i!==d.Z_STREAM_END&&i!==d.Z_OK)return this.onEnd(i),!(this.ended=!0)}while(!o.next_out||0!==o.avail_out&&i!==d.Z_STREAM_END&&(0!==o.avail_in||r!==d.Z_FINISH&&r!==d.Z_SYNC_FLUSH)||("string"===this.options.to?(a=p.utf8border(o.output,o.next_out),s=o.next_out-a,n=p.buf2string(o.output,a),o.next_out=s,o.avail_out=u-s,s&&f.arraySet(o.output,o.output,a,s,0),this.onData(n)):this.onData(f.shrinkBuf(o.output,o.next_out))),0===o.avail_in&&0===o.avail_out&&(c=!0),(0<o.avail_in||0===o.avail_out)&&i!==d.Z_STREAM_END);return(r=i===d.Z_STREAM_END?d.Z_FINISH:r)===d.Z_FINISH?(i=h.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===d.Z_OK):r!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(o.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===d.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=a,i.inflate=o,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},i.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,i){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,s=(i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},i.shrinkBuf=function(e,t){if(e.length!==t){if(e.subarray)return e.subarray(0,t);e.length=t}return e},{arraySet:function(e,t,i,r,s){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),s);else for(var n=0;n<r;n++)e[s+n]=t[i+n]},flattenChunks:function(e){for(var t,i,r,s=0,n=0,a=e.length;n<a;n++)s+=e[n].length;for(r=new Uint8Array(s),n=t=0,a=e.length;n<a;n++)i=e[n],r.set(i,t),t+=i.length;return r}}),n={arraySet:function(e,t,i,r,s){for(var n=0;n<r;n++)e[s+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(r)},{}],42:[function(e,t,i){var u=e("./common"),s=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){n=!1}for(var l=new u.Buf8(256),r=0;r<256;r++)l[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function c(e,t){if(t<65537&&(e.subarray&&n||!e.subarray&&s))return String.fromCharCode.apply(null,u.shrinkBuf(e,t));for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i}l[254]=l[254]=1,i.string2buf=function(e){for(var t,i,r,s,n=e.length,a=0,o=0;o<n;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new u.Buf8(a),o=s=0;s<a;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),i<128?t[s++]=i:(i<2048?t[s++]=192|i>>>6:(i<65536?t[s++]=224|i>>>12:(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63),t[s++]=128|i>>>6&63),t[s++]=128|63&i);return t},i.buf2binstring=function(e){return c(e,e.length)},i.binstring2buf=function(e){for(var t=new u.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){for(var i,r,s=t||e.length,n=new Array(2*s),a=0,o=0;o<s;)if((i=e[o++])<128)n[a++]=i;else if(4<(r=l[i]))n[a++]=65533,o+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&o<s;)i=i<<6|63&e[o++],r--;1<r?n[a++]=65533:i<65536?n[a++]=i:(i-=65536,n[a++]=55296|i>>10&1023,n[a++]=56320|1023&i)}return c(n,a)},i.utf8border=function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+l[e[i]]>t?i:t}},{"./common":41}],43:[function(e,t,i){t.exports=function(e,t,i,r){for(var s=65535&e|0,n=e>>>16&65535|0,a=0;0!==i;){for(i-=a=2e3<i?2e3:i;n=n+(s=s+t[r++]|0)|0,--a;);s%=65521,n%=65521}return s|n<<16|0}},{}],44:[function(e,t,i){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,i){var o=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t,i,r){var s=o,n=r+i;e^=-1;for(var a=r;a<n;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},{}],46:[function(e,N,t){var o,h=e("../utils/common"),u=e("./trees"),f=e("./adler32"),p=e("./crc32"),T=e("./messages"),l=0,c=4,d=0,m=-2,E=-1,L=4,D=2,v=8,R=9,i=286,W=30,z=19,U=2*i+1,K=15,g=3,k=258,b=k+g+1,y=42,S=113,I=1,F=2,O=3,w=4;function C(e,t){return e.msg=T[t],t}function A(e){return(e<<1)-(4<e?9:0)}function P(e){for(var t=e.length;0<=--t;)e[t]=0}function _(e){var t=e.state,i=t.pending;0!==(i=i>e.avail_out?e.avail_out:i)&&(h.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending)&&(t.pending_out=0)}function x(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_(e.strm)}function V(e,t){e.pending_buf[e.pending++]=t}function j(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function n(e,t){var i,r,s=e.max_chain_length,n=e.strstart,a=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-b?e.strstart-(e.w_size-b):0,l=e.window,c=e.w_mask,h=e.prev,f=e.strstart+k,p=l[n+a-1],d=l[n+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(l[(i=t)+a]===d&&l[i+a-1]===p&&l[i]===l[n]&&l[++i]===l[n+1]){for(n+=2,i++;l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&n<f;);if(r=k-(f-n),n=f-k,a<r){if(e.match_start=t,o<=(a=r))break;p=l[n+a-1],d=l[n+a]}}}while((t=h[t&c])>u&&0!=--s);return a<=e.lookahead?a:e.lookahead}function q(e){var t,i,r,s,n,a,o,u,l,c=e.w_size;do{if(u=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-b)){for(h.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=i=e.hash_size;r=e.head[--t],e.head[t]=c<=r?r-c:0,--i;);for(t=i=c;r=e.prev[--t],e.prev[t]=c<=r?r-c:0,--i;);u+=c}if(0===e.strm.avail_in)break;if(n=e.strm,a=e.window,o=e.strstart+e.lookahead,u=u,l=void 0,l=n.avail_in,i=0===(l=u<l?u:l)?0:(n.avail_in-=l,h.arraySet(a,n.input,n.next_in,l,o),1===n.state.wrap?n.adler=f(n.adler,a,l,o):2===n.state.wrap&&(n.adler=p(n.adler,a,l,o)),n.next_in+=l,n.total_in+=l,l),e.lookahead+=i,e.lookahead+e.insert>=g)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+g-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<g)););}while(e.lookahead<b&&0!==e.strm.avail_in)}function r(e,t){for(var i,r;;){if(e.lookahead<b){if(q(e),e.lookahead<b&&t===l)return I;if(0===e.lookahead)break}if(i=0,e.lookahead>=g&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-b&&(e.match_length=n(e,i)),e.match_length>=g)if(r=u._tr_tally(e,e.strstart-e.match_start,e.match_length-g),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=g){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=e.strstart<g-1?e.strstart:g-1,t===c?(x(e,!0),0===e.strm.avail_out?O:w):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:F}function s(e,t){for(var i,r,s;;){if(e.lookahead<b){if(q(e),e.lookahead<b&&t===l)return I;if(0===e.lookahead)break}if(i=0,e.lookahead>=g&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=g-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-b&&(e.match_length=n(e,i),e.match_length<=5)&&(1===e.strategy||e.match_length===g&&4096<e.strstart-e.match_start)&&(e.match_length=g-1),e.prev_length>=g&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-g,r=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-g),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=g-1,e.strstart++,r&&(x(e,!1),0===e.strm.avail_out))return I}else if(e.match_available){if((r=u._tr_tally(e,0,e.window[e.strstart-1]))&&x(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return I}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<g-1?e.strstart:g-1,t===c?(x(e,!0),0===e.strm.avail_out?O:w):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:F}function a(e,t,i,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=s}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*U),this.dyn_dtree=new h.Buf16(2*(2*W+1)),this.bl_tree=new h.Buf16(2*(2*z+1)),P(this.dyn_ltree),P(this.dyn_dtree),P(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(K+1),this.heap=new h.Buf16(2*i+1),P(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*i+1),P(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=D,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?y:S,e.adler=2===t.wrap?0:1,t.last_flush=l,u._tr_init(t),d):C(e,m)}function B(e){var t=M(e);return t===d&&((e=e.state).window_size=2*e.w_size,P(e.head),e.max_lazy_match=o[e.level].max_lazy,e.good_match=o[e.level].good_length,e.nice_match=o[e.level].nice_length,e.max_chain_length=o[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=g-1,e.match_available=0,e.ins_h=0),t}function G(e,t,i,r,s,n){if(!e)return m;var a=1;if(t===E&&(t=6),r<0?(a=0,r=-r):15<r&&(a=2,r-=16),s<1||R<s||i!==v||r<8||15<r||t<0||9<t||n<0||L<n)return C(e,m);8===r&&(r=9);var o=new H;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+g-1)/g),o.window=new h.Buf8(2*o.w_size),o.head=new h.Buf16(o.hash_size),o.prev=new h.Buf16(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new h.Buf8(o.pending_buf_size),o.d_buf=o.lit_bufsize>>1,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=n,o.method=i,B(e)}o=[new a(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(q(e),0===e.lookahead&&t===l)return I;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,x(e,!1),0===e.strm.avail_out))return I;if(e.strstart-e.block_start>=e.w_size-b&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=0,t===c?(x(e,!0),0===e.strm.avail_out?O:w):(e.strstart>e.block_start&&(x(e,!1),e.strm.avail_out),I)}),new a(4,4,8,4,r),new a(4,5,16,8,r),new a(4,6,32,32,r),new a(4,4,16,16,s),new a(8,16,32,32,s),new a(8,16,128,128,s),new a(8,32,128,256,s),new a(32,128,258,1024,s),new a(32,258,258,4096,s)],t.deflateInit=function(e,t){return G(e,t,v,15,8,0)},t.deflateInit2=G,t.deflateReset=B,t.deflateResetKeep=M,t.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?m:(e.state.gzhead=t,d)},t.deflate=function(e,t){var i,r,s,n;if(!e||!e.state||5<t||t<0)return e?C(e,m):m;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&t!==c)return C(e,0===e.avail_out?-5:m);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===y&&(2===r.wrap?(e.adler=0,V(r,31),V(r,139),V(r,8),r.gzhead?(V(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),V(r,255&r.gzhead.time),V(r,r.gzhead.time>>8&255),V(r,r.gzhead.time>>16&255),V(r,r.gzhead.time>>24&255),V(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),V(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(V(r,255&r.gzhead.extra.length),V(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=p(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(V(r,0),V(r,0),V(r,0),V(r,0),V(r,0),V(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),V(r,3),r.status=S)):(a=v+(r.w_bits-8<<4)<<8,a|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(a|=32),a+=31-a%31,r.status=S,j(r,a),0!==r.strstart&&(j(r,e.adler>>>16),j(r,65535&e.adler)),e.adler=1)),69===r.status)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(e.adler=p(e.adler,r.pending_buf,r.pending-s,s)),_(e),s=r.pending,r.pending!==r.pending_buf_size));)V(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(e.adler=p(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=p(e.adler,r.pending_buf,r.pending-s,s)),_(e),s=r.pending,r.pending===r.pending_buf_size)){n=1;break}}while(n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,V(r,n),0!==n);r.gzhead.hcrc&&r.pending>s&&(e.adler=p(e.adler,r.pending_buf,r.pending-s,s)),0===n&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=p(e.adler,r.pending_buf,r.pending-s,s)),_(e),s=r.pending,r.pending===r.pending_buf_size)){n=1;break}}while(n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,V(r,n),0!==n);r.gzhead.hcrc&&r.pending>s&&(e.adler=p(e.adler,r.pending_buf,r.pending-s,s)),0===n&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&_(e),r.pending+2<=r.pending_buf_size&&(V(r,255&e.adler),V(r,e.adler>>8&255),e.adler=0,r.status=S)):r.status=S),0!==r.pending){if(_(e),0===e.avail_out)return r.last_flush=-1,d}else if(0===e.avail_in&&A(t)<=A(i)&&t!==c)return C(e,-5);if(666===r.status&&0!==e.avail_in)return C(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==l&&666!==r.status){var a=2===r.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(q(e),0===e.lookahead)){if(t===l)return I;break}if(e.match_length=0,i=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=0,t===c?(x(e,!0),0===e.strm.avail_out?O:w):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:F}(r,t):3===r.strategy?function(e,t){for(var i,r,s,n,a=e.window;;){if(e.lookahead<=k){if(q(e),e.lookahead<=k&&t===l)return I;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=g&&0<e.strstart&&(r=a[s=e.strstart-1])===a[++s]&&r===a[++s]&&r===a[++s]){for(n=e.strstart+k;r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&r===a[++s]&&s<n;);e.match_length=k-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=g?(i=u._tr_tally(e,1,e.match_length-g),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=0,t===c?(x(e,!0),0===e.strm.avail_out?O:w):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:F}(r,t):o[r.level].func(r,t);if(a!==O&&a!==w||(r.status=666),a===I||a===O)return 0===e.avail_out&&(r.last_flush=-1),d;if(a===F&&(1===t?u._tr_align(r):5!==t&&(u._tr_stored_block(r,0,0,!1),3===t)&&(P(r.head),0===r.lookahead)&&(r.strstart=0,r.block_start=0,r.insert=0),_(e),0===e.avail_out))return r.last_flush=-1,d}return t!==c||!(r.wrap<=0)&&(2===r.wrap?(V(r,255&e.adler),V(r,e.adler>>8&255),V(r,e.adler>>16&255),V(r,e.adler>>24&255),V(r,255&e.total_in),V(r,e.total_in>>8&255),V(r,e.total_in>>16&255),V(r,e.total_in>>24&255)):(j(r,e.adler>>>16),j(r,65535&e.adler)),_(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending)?d:1},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==y&&69!==t&&73!==t&&91!==t&&103!==t&&t!==S&&666!==t?C(e,m):(e.state=null,t===S?C(e,-3):d):m},t.deflateSetDictionary=function(e,t){var i,r,s,n,a,o,u,l=t.length;if(!e||!e.state)return m;if(2===(n=(i=e.state).wrap)||1===n&&i.status!==y||i.lookahead)return m;for(1===n&&(e.adler=f(e.adler,t,l,0)),i.wrap=0,l>=i.w_size&&(0===n&&(P(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new h.Buf8(i.w_size),h.arraySet(u,t,l-i.w_size,i.w_size,0),t=u,l=i.w_size),u=e.avail_in,a=e.next_in,o=e.input,e.avail_in=l,e.next_in=0,e.input=t,q(i);i.lookahead>=g;){for(r=i.strstart,s=i.lookahead-(g-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+g-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,--s;);i.strstart=r,i.lookahead=g-1,q(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=g-1,i.match_available=0,e.next_in=a,e.input=o,e.avail_in=u,i.wrap=n,d},t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,i){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,i){t.exports=function(e,t){var i,r,s,n,a,o,u=e.state,l=e.next_in,c=e.input,h=l+(e.avail_in-5),f=e.next_out,p=e.output,d=f-(t-e.avail_out),m=f+(e.avail_out-257),v=u.dmax,g=u.wsize,k=u.whave,b=u.wnext,y=u.window,S=u.hold,I=u.bits,F=u.lencode,O=u.distcode,w=(1<<u.lenbits)-1,C=(1<<u.distbits)-1;e:do{for(I<15&&(S+=c[l++]<<I,I+=8,S+=c[l++]<<I,I+=8),i=F[S&w];;){if(S>>>=r=i>>>24,I-=r,0===(r=i>>>16&255))p[f++]=65535&i;else{if(!(16&r)){if(0==(64&r)){i=F[(65535&i)+(S&(1<<r)-1)];continue}if(32&r){u.mode=12;break e}e.msg="invalid literal/length code",u.mode=30;break e}for(s=65535&i,(r&=15)&&(I<r&&(S+=c[l++]<<I,I+=8),s+=S&(1<<r)-1,S>>>=r,I-=r),I<15&&(S+=c[l++]<<I,I+=8,S+=c[l++]<<I,I+=8),i=O[S&C];;){if(S>>>=r=i>>>24,I-=r,!(16&(r=i>>>16&255))){if(0==(64&r)){i=O[(65535&i)+(S&(1<<r)-1)];continue}e.msg="invalid distance code",u.mode=30;break e}if(n=65535&i,I<(r&=15)&&(S+=c[l++]<<I,(I+=8)<r)&&(S+=c[l++]<<I,I+=8),v<(n+=S&(1<<r)-1)){e.msg="invalid distance too far back",u.mode=30;break e}if(S>>>=r,I-=r,(r=f-d)<n){if(k<(r=n-r)&&u.sane){e.msg="invalid distance too far back",u.mode=30;break e}if(o=y,(a=0)===b){if(a+=g-r,r<s){for(s-=r;p[f++]=y[a++],--r;);a=f-n,o=p}}else if(b<r){if(a+=g+b-r,(r-=b)<s){for(s-=r;p[f++]=y[a++],--r;);if(a=0,b<s){for(s-=r=b;p[f++]=y[a++],--r;);a=f-n,o=p}}}else if(a+=b-r,r<s){for(s-=r;p[f++]=y[a++],--r;);a=f-n,o=p}for(;2<s;)p[f++]=o[a++],p[f++]=o[a++],p[f++]=o[a++],s-=3;s&&(p[f++]=o[a++],1<s)&&(p[f++]=o[a++])}else{for(a=f-n;p[f++]=p[a++],p[f++]=p[a++],p[f++]=p[a++],2<(s-=3););s&&(p[f++]=p[a++],1<s)&&(p[f++]=p[a++])}break}}break}}while(l<h&&f<m);S&=(1<<(I-=(s=I>>3)<<3))-1,e.next_in=l-=s,e.next_out=f,e.avail_in=l<h?h-l+5:5-(l-h),e.avail_out=f<m?m-f+257:257-(f-m),u.hold=S,u.bits=I}},{}],49:[function(e,t,i){var V=e("../utils/common"),j=e("./adler32"),q=e("./crc32"),M=e("./inffast"),B=e("./inftrees"),N=1,T=2,E=0,L=-2,D=1,r=852,s=592;function R(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new V.Buf16(320),this.work=new V.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new V.Buf32(r),t.distcode=t.distdyn=new V.Buf32(s),t.sane=1,t.back=-1,E):L}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):L}function u(e,t){var i,r;return!e||!e.state||(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?L:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,o(e))}function l(e,t){var i;return e?(i=new n,(e.state=i).window=null,(i=u(e,t))!==E&&(e.state=null),i):L}var W,z,U=!0;function K(e,t,i,r){var s,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new V.Buf8(e.wsize)),r>=e.wsize?(V.arraySet(e.window,t,i-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(r<(s=e.wsize-e.wnext)&&(s=r),V.arraySet(e.window,t,i-r,s,e.wnext),(r-=s)?(V.arraySet(e.window,t,i-r,r,0),e.wnext=r,e.whave=e.wsize):(e.wnext+=s,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=s))),0}i.inflateReset=o,i.inflateReset2=u,i.inflateResetKeep=a,i.inflateInit=function(e){return l(e,15)},i.inflateInit2=l,i.inflate=function(e,t){var i,r,s,n,a,o,u,l,c,h,f,p,d,m,v,g,k,b,y,S,I,F,O,w,C=0,A=new V.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return L;12===(i=e.state).mode&&(i.mode=13),a=e.next_out,s=e.output,u=e.avail_out,n=e.next_in,r=e.input,o=e.avail_in,l=i.hold,c=i.bits,h=o,f=u,F=E;e:for(;;)switch(i.mode){case D:if(0===i.wrap)i.mode=13;else{for(;c<16;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(2&i.wrap&&35615===l)A[i.check=0]=255&l,A[1]=l>>>8&255,i.check=q(i.check,A,2,0),c=l=0,i.mode=2;else if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31)e.msg="incorrect header check",i.mode=30;else if(8!=(15&l))e.msg="unknown compression method",i.mode=30;else{if(c-=4,I=8+(15&(l>>>=4)),0===i.wbits)i.wbits=I;else if(I>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<I,e.adler=i.check=1,i.mode=512&l?10:12,c=l=0}}break;case 2:for(;c<16;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(i.flags=l,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(A[0]=255&l,A[1]=l>>>8&255,i.check=q(i.check,A,2,0)),c=l=0,i.mode=3;case 3:for(;c<32;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}i.head&&(i.head.time=l),512&i.flags&&(A[0]=255&l,A[1]=l>>>8&255,A[2]=l>>>16&255,A[3]=l>>>24&255,i.check=q(i.check,A,4,0)),c=l=0,i.mode=4;case 4:for(;c<16;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(A[0]=255&l,A[1]=l>>>8&255,i.check=q(i.check,A,2,0)),c=l=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(A[0]=255&l,A[1]=l>>>8&255,i.check=q(i.check,A,2,0)),c=l=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((p=o<(p=i.length)?o:p)&&(i.head&&(I=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),V.arraySet(i.head.extra,r,n,p,I)),512&i.flags&&(i.check=q(i.check,r,p,n)),o-=p,n+=p,i.length-=p),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===o)break e;for(p=0;I=r[n+p++],i.head&&I&&i.length<65536&&(i.head.name+=String.fromCharCode(I)),I&&p<o;);if(512&i.flags&&(i.check=q(i.check,r,p,n)),o-=p,n+=p,I)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===o)break e;for(p=0;I=r[n+p++],i.head&&I&&i.length<65536&&(i.head.comment+=String.fromCharCode(I)),I&&p<o;);if(512&i.flags&&(i.check=q(i.check,r,p,n)),o-=p,n+=p,I)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}c=l=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=12;break;case 10:for(;c<32;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}e.adler=i.check=R(l),c=l=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=a,e.avail_out=u,e.next_in=n,e.avail_in=o,i.hold=l,i.bits=c,2;e.adler=i.check=1,i.mode=12;case 12:if(5===t||6===t)break e;case 13:if(i.last)l>>>=7&c,c-=7&c,i.mode=27;else{for(;c<3;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}switch(i.last=1&l,--c,3&(l>>>=1)){case 0:i.mode=14;break;case 1:_=x=void 0;var _,x=i;if(U){for(W=new V.Buf32(512),z=new V.Buf32(32),_=0;_<144;)x.lens[_++]=8;for(;_<256;)x.lens[_++]=9;for(;_<280;)x.lens[_++]=7;for(;_<288;)x.lens[_++]=8;for(B(N,x.lens,0,288,W,0,x.work,{bits:9}),_=0;_<32;)x.lens[_++]=5;B(T,x.lens,0,32,z,0,x.work,{bits:5}),U=!1}if(x.lencode=W,x.lenbits=9,x.distcode=z,x.distbits=5,i.mode=20,6!==t)break;l>>>=2,c-=2;break e;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}l>>>=2,c-=2}break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&l,c=l=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(p=i.length){if(0===(p=u<(p=o<p?o:p)?u:p))break e;V.arraySet(s,r,n,p,a),o-=p,n+=p,u-=p,a+=p,i.length-=p}else i.mode=12;break;case 17:for(;c<14;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(i.nlen=257+(31&l),l>>>=5,c-=5,i.ndist=1+(31&l),l>>>=5,c-=5,i.ncode=4+(15&l),l>>>=4,c-=4,286<i.nlen||30<i.ndist){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}i.lens[P[i.have++]]=7&l,l>>>=3,c-=3}for(;i.have<19;)i.lens[P[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,O={bits:i.lenbits},F=B(0,i.lens,0,19,i.lencode,0,i.work,O),i.lenbits=O.bits,F){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;g=(C=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,k=65535&C,!((v=C>>>24)<=c);){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(k<16)l>>>=v,c-=v,i.lens[i.have++]=k;else{if(16===k){for(w=v+2;c<w;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(l>>>=v,c-=v,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}I=i.lens[i.have-1],p=3+(3&l),l>>>=2,c-=2}else if(17===k){for(w=v+3;c<w;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}I=0,p=3+(7&(l>>>=v)),l>>>=3,c=c-v-3}else{for(w=v+7;c<w;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}I=0,p=11+(127&(l>>>=v)),l>>>=7,c=c-v-7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;p--;)i.lens[i.have++]=I}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,O={bits:i.lenbits},F=B(N,i.lens,0,i.nlen,i.lencode,0,i.work,O),i.lenbits=O.bits,F){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,O={bits:i.distbits},F=B(T,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,O),i.distbits=O.bits,F){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(6<=o&&258<=u){e.next_out=a,e.avail_out=u,e.next_in=n,e.avail_in=o,i.hold=l,i.bits=c,M(e,f),a=e.next_out,s=e.output,u=e.avail_out,n=e.next_in,r=e.input,o=e.avail_in,l=i.hold,c=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;g=(C=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,k=65535&C,!((v=C>>>24)<=c);){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(g&&0==(240&g)){for(b=v,y=g,S=k;g=(C=i.lencode[S+((l&(1<<b+y)-1)>>b)])>>>16&255,k=65535&C,!(b+(v=C>>>24)<=c);){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=v,c-=v,i.back+=v,i.length=k,0===g){i.mode=26;break}if(32&g){i.back=-1,i.mode=12;break}if(64&g){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&g,i.mode=22;case 22:if(i.extra){for(w=i.extra;c<w;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;g=(C=i.distcode[l&(1<<i.distbits)-1])>>>16&255,k=65535&C,!((v=C>>>24)<=c);){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(0==(240&g)){for(b=v,y=g,S=k;g=(C=i.distcode[S+((l&(1<<b+y)-1)>>b)])>>>16&255,k=65535&C,!(b+(v=C>>>24)<=c);){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}l>>>=b,c-=b,i.back+=b}if(l>>>=v,c-=v,i.back+=v,64&g){e.msg="invalid distance code",i.mode=30;break}i.offset=k,i.extra=15&g,i.mode=24;case 24:if(i.extra){for(w=i.extra;c<w;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===u)break e;if(i.offset>(p=f-u)){if((p=i.offset-p)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}d=p>i.wnext?(p-=i.wnext,i.wsize-p):i.wnext-p,p>i.length&&(p=i.length),m=i.window}else m=s,d=a-i.offset,p=i.length;for(u-=p=u<p?u:p,i.length-=p;s[a++]=m[d++],--p;);0===i.length&&(i.mode=21);break;case 26:if(0===u)break e;s[a++]=i.length,u--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===o)break e;o--,l|=r[n++]<<c,c+=8}if(f-=u,e.total_out+=f,i.total+=f,f&&(e.adler=i.check=(i.flags?q:j)(i.check,s,f,a-f)),f=u,(i.flags?l:R(l))!==i.check){e.msg="incorrect data check",i.mode=30;break}c=l=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===o)break e;o--,l+=r[n++]<<c,c+=8}if(l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}c=l=0}i.mode=29;case 29:F=1;break e;case 30:F=-3;break e;case 31:return-4;default:return L}return e.next_out=a,e.avail_out=u,e.next_in=n,e.avail_in=o,i.hold=l,i.bits=c,(i.wsize||f!==e.avail_out&&i.mode<30&&(i.mode<27||4!==t))&&K(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,i.total+=f,i.wrap&&f&&(e.adler=i.check=(i.flags?q:j)(i.check,s,f,e.next_out-f)),e.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),F=(0==h&&0===f||4===t)&&F===E?-5:F},i.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,E):L},i.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?L:((e.head=t).done=!1,E)},i.inflateSetDictionary=function(e,t){var i,r=t.length;return!e||!e.state||0!==(i=e.state).wrap&&11!==i.mode?L:11===i.mode&&j(1,t,r,0)!==i.check?-3:K(e,t,r,r)?(i.mode=31,-4):(i.havedict=1,E)},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,i){var M=e("../utils/common"),B=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],T=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],E=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,r,s,n,a,o){for(var u,l,c,h,f,p,d,m,v,g=o.bits,k=0,b=0,y=0,S=0,I=0,F=0,O=0,w=0,C=0,A=0,P=null,_=0,x=new M.Buf16(16),V=new M.Buf16(16),j=null,q=0,k=0;k<=15;k++)x[k]=0;for(b=0;b<r;b++)x[t[i+b]]++;for(I=g,S=15;1<=S&&0===x[S];S--);if(S<I&&(I=S),0===S)s[n++]=20971520,s[n++]=20971520,o.bits=1;else{for(y=1;y<S&&0===x[y];y++);for(I<y&&(I=y),k=w=1;k<=15;k++)if((w=(w<<=1)-x[k])<0)return-1;if(0<w&&(0===e||1!==S))return-1;for(V[1]=0,k=1;k<15;k++)V[k+1]=V[k]+x[k];for(b=0;b<r;b++)0!==t[i+b]&&(a[V[t[i+b]]++]=b);if(p=0===e?(P=j=a,19):1===e?(P=B,_-=257,j=N,q-=257,256):(P=T,j=E,-1),k=y,f=n,O=b=A=0,c=-1,h=(C=1<<(F=I))-1,1===e&&852<C||2===e&&592<C)return 1;for(;;){for(v=a[b]<p?(m=0,a[b]):a[b]>p?(m=j[q+a[b]],P[_+a[b]]):(m=96,0),u=1<<(d=k-O),y=l=1<<F;s[f+(A>>O)+(l-=u)]=d<<24|m<<16|v|0,0!==l;);for(u=1<<k-1;A&u;)u>>=1;if(A=0!==u?(A&u-1)+u:0,b++,0==--x[k]){if(k===S)break;k=t[i+a[b]]}if(I<k&&(A&h)!==c){for(f+=y,w=1<<(F=k-(O=0===O?I:O));F+O<S&&!((w-=x[F+O])<=0);)F++,w<<=1;if(C+=1<<F,1===e&&852<C||2===e&&592<C)return 1;s[c=A&h]=I<<24|F<<16|f-n|0}}0!==A&&(s[f+A]=k-O<<24|64<<16|0),o.bits=I}return 0}},{"../utils/common":41}],51:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,e){var a=i("../utils/common"),c=0,h=1;function t(e){for(var t=e.length;0<=--t;)e[t]=0}var o,u,l,f=29,p=256,d=p+1+f,m=30,v=19,w=2*d+1,C=15,r=16,L=7,g=256,k=16,b=17,y=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(d+2)),A=(t(O),new Array(2*m)),P=(t(A),new Array(512)),_=(t(P),new Array(256)),x=(t(_),new Array(f)),V=(t(x),new Array(m));function j(e,t,i,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}function q(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function M(e){return e<256?P[e]:P[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function B(e,t,i){e.bi_valid>r-i?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>r-e.bi_valid,e.bi_valid+=i-r):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function N(e,t,i){B(e,i[2*t],i[2*t+1])}function R(e,t){for(var i=0;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1}function W(e,t,i){for(var r,s=new Array(C+1),n=0,a=1;a<=C;a++)s[a]=n=n+i[a-1]<<1;for(r=0;r<=t;r++){var o=e[2*r+1];0!==o&&(e[2*r]=R(s[o]++,o))}}function z(e){for(var t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*g]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function U(e){8<e.bi_valid?s(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function K(e,t,i,r){var s=2*t,n=2*i;return e[s]<e[n]||e[s]===e[n]&&r[t]<=r[i]}function T(e,t,i){for(var r=e.heap[i],s=i<<1;s<=e.heap_len&&(s<e.heap_len&&K(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!K(t,r,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=r}function H(e,t,i){var r,s,n,a,o=0;if(0!==e.last_lit)for(;r=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0==r?N(e,s,t):(N(e,(n=_[s])+p+1,t),0!==(a=S[n])&&B(e,s-=x[n],a),N(e,n=M(--r),i),0!==(a=I[n])&&B(e,r-=V[n],a)),o<e.last_lit;);N(e,g,t)}function E(e,t){var i,r,s,n=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=w,i=0;i<u;i++)0!==n[2*i]?(e.heap[++e.heap_len]=l=i,e.depth[i]=0):n[2*i+1]=0;for(;e.heap_len<2;)n[2*(s=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=a[2*s+1]);for(t.max_code=l,i=e.heap_len>>1;1<=i;i--)T(e,n,i);for(s=u;i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],T(e,n,1),r=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=r,n[2*s]=n[2*i]+n[2*r],e.depth[s]=(e.depth[i]>=e.depth[r]?e.depth[i]:e.depth[r])+1,n[2*i+1]=n[2*r+1]=s,e.heap[1]=s++,T(e,n,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var c,h,f,p,d,m=e,v=t.dyn_tree,g=t.max_code,k=t.stat_desc.static_tree,b=t.stat_desc.has_stree,y=t.stat_desc.extra_bits,S=t.stat_desc.extra_base,I=t.stat_desc.max_length,F=0,O=0;O<=C;O++)m.bl_count[O]=0;for(v[2*m.heap[m.heap_max]+1]=0,c=m.heap_max+1;c<w;c++)I<(O=v[2*v[2*(h=m.heap[c])+1]+1]+1)&&(O=I,F++),v[2*h+1]=O,g<h||(m.bl_count[O]++,p=0,S<=h&&(p=y[h-S]),d=v[2*h],m.opt_len+=d*(O+p),b&&(m.static_len+=d*(k[2*h+1]+p)));if(0!==F){do{for(O=I-1;0===m.bl_count[O];)O--}while(m.bl_count[O]--,m.bl_count[O+1]+=2,m.bl_count[I]--,0<(F-=2));for(O=I;0!==O;O--)for(h=m.bl_count[O];0!==h;)g<(f=m.heap[--c])||(v[2*f+1]!==O&&(m.opt_len+=(O-v[2*f+1])*v[2*f],v[2*f+1]=O),h--)}W(n,l,e.bl_count)}function G(e,t,i){var r,s,n=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)s=a,a=t[2*(r+1)+1],++o<u&&s===a||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==n&&e.bl_tree[2*s]++,e.bl_tree[2*k]++):o<=10?e.bl_tree[2*b]++:e.bl_tree[2*y]++,n=s,l=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4))}function X(e,t,i){var r,s,n=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),r=0;r<=i;r++)if(s=a,a=t[2*(r+1)+1],!(++o<u&&s===a)){if(o<l)for(;N(e,s,e.bl_tree),0!=--o;);else 0!==s?(s!==n&&(N(e,s,e.bl_tree),o--),N(e,k,e.bl_tree),B(e,o-3,2)):o<=10?(N(e,b,e.bl_tree),B(e,o-3,3)):(N(e,y,e.bl_tree),B(e,o-11,7));n=s,l=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4)}}t(V);var Z=!1;function J(e,t,i,r){B(e,0+(r?1:0),3),r=t,t=i,i=!0,U(e=e),i&&(s(e,t),s(e,~t)),a.arraySet(e.pending_buf,e.window,r,t,e.pending),e.pending+=t}e._tr_init=function(e){if(!Z){for(var t,i,r,s=new Array(C+1),n=0,a=0;a<f-1;a++)for(x[a]=n,t=0;t<1<<S[a];t++)_[n++]=a;for(_[n-1]=a,a=r=0;a<16;a++)for(V[a]=r,t=0;t<1<<I[a];t++)P[r++]=a;for(r>>=7;a<m;a++)for(V[a]=r<<7,t=0;t<1<<I[a]-7;t++)P[256+r++]=a;for(i=0;i<=C;i++)s[i]=0;for(t=0;t<=143;)O[2*t+1]=8,t++,s[8]++;for(;t<=255;)O[2*t+1]=9,t++,s[9]++;for(;t<=279;)O[2*t+1]=7,t++,s[7]++;for(;t<=287;)O[2*t+1]=8,t++,s[8]++;for(W(O,d+1,s),t=0;t<m;t++)A[2*t+1]=5,A[2*t]=R(t,5);o=new j(O,S,p+1,d,C),u=new j(A,I,0,m,C),l=new j(new Array(0),D,0,v,L),Z=!0}e.l_desc=new q(e.dyn_ltree,o),e.d_desc=new q(e.dyn_dtree,u),e.bl_desc=new q(e.bl_tree,l),e.bi_buf=0,e.bi_valid=0,z(e)},e._tr_stored_block=J,e._tr_flush_block=function(e,t,i,r){var s,n,a=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,i=0;i<=31;i++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*i])return c;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return h;for(i=32;i<p;i++)if(0!==e.dyn_ltree[2*i])return h;return c}(e)),E(e,e.l_desc),E(e,e.d_desc),a=function(e){var t;for(G(e,e.dyn_ltree,e.l_desc.max_code),G(e,e.dyn_dtree,e.d_desc.max_code),E(e,e.bl_desc),t=v-1;3<=t&&0===e.bl_tree[2*F[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=s&&(s=n)):s=n=i+5,i+4<=s&&-1!==t)J(e,t,i,r);else if(4===e.strategy||n===s)B(e,2+(r?1:0),3),H(e,O,A);else{B(e,4+(r?1:0),3);var o,u=e,t=e.l_desc.max_code+1,i=e.d_desc.max_code+1,l=a+1;for(B(u,t-257,5),B(u,i-1,5),B(u,l-4,4),o=0;o<l;o++)B(u,u.bl_tree[2*F[o]+1],3);X(u,u.dyn_ltree,t-1),X(u,u.dyn_dtree,i-1),H(e,e.dyn_ltree,e.dyn_dtree)}z(e),r&&U(e)},e._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(_[i]+p+1)]++,e.dyn_dtree[2*M(t)]++),e.last_lit===e.lit_bufsize-1},e._tr_align=function(e){B(e,2,3),N(e,g,O),16===(e=e).bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,i){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)}),!function(o){var u,l,c,h,f,p,d,t,m,v,r,e;void 0===o||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent)||(e=o.document,u=function(){return o.URL||o.webkitURL||o},l=e.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in l,h=/constructor/i.test(o.HTMLElement)||o.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent),p=o.setImmediate||o.setTimeout,d=function(e){p(function(){throw e},0)},t=4e4,m=function(e){setTimeout(function(){"string"==typeof e?u().revokeObjectURL(e):e.remove()},t)},v=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},e=(r=function(e,i,t){t||(e=v(e));var r,s,n=this,t="application/octet-stream"===e.type,a=function(){for(var e=n,t="writestart progress write writeend".split(" "),i=void 0,r=(t=[].concat(t)).length;r--;){var s=e["on"+t[r]];if("function"==typeof s)try{s.call(e,i||e)}catch(e){d(e)}}};n.readyState=n.INIT,c?(r=u().createObjectURL(e),p(function(){var e,t;l.href=r,l.download=i,e=l,t=new MouseEvent("click"),e.dispatchEvent(t),a(),m(r),n.readyState=n.DONE},0)):(f||t&&h)&&o.FileReader?((s=new FileReader).onloadend=function(){var e=f?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");o.open(e,"_blank")||(o.location.href=e),n.readyState=n.DONE,a()},s.readAsDataURL(e),n.readyState=n.INIT):(r=r||u().createObjectURL(e),!t&&o.open(r,"_blank")||(o.location.href=r),n.readyState=n.DONE,a(),m(r))}).prototype,"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)||(e.abort=function(){},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,o.FileSaver_saveAs=function(e,t,i){return new r(e,t||e.name||"download",i)})}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0),!function(){var root="object"==typeof window?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node,COMMON_JS=(NODE_JS&&(root=global),!root.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports),AMD="function"==typeof define&&define.amd,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(t){return function(e){return new Sha1(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");(t=NODE_JS?nodeWrap(t):t).create=function(){return new Sha1},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var i=OUTPUT_TYPES[e];t[i]=createOutputMethod(i)}return t},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("sha1").update(e,"utf8").digest("hex");if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(void 0===e.length)return method(e);return crypto.createHash("sha1").update(new Buffer(e)).digest("hex")};return nodeMethod};function Sha1(e){e?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(e){if(!this.finalized){for(var t,i,r="string"!=typeof e,s=0,n=(e=r&&e.constructor===root.ArrayBuffer?new Uint8Array(e):e).length||0,a=this.blocks;s<n;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),r)for(i=this.start;s<n&&i<64;++s)a[i>>2]|=e[s]<<SHIFT[3&i++];else for(i=this.start;s<n&&i<64;++s)(t=e.charCodeAt(s))<128?a[i>>2]|=t<<SHIFT[3&i++]:(t<2048?a[i>>2]|=(192|t>>6)<<SHIFT[3&i++]:(t<55296||57344<=t?a[i>>2]|=(224|t>>12)<<SHIFT[3&i++]:(t=65536+((1023&t)<<10|1023&e.charCodeAt(++s)),a[i>>2]|=(240|t>>18)<<SHIFT[3&i++],a[i>>2]|=(128|t>>12&63)<<SHIFT[3&i++]),a[i>>2]|=(128|t>>6&63)<<SHIFT[3&i++]),a[i>>2]|=(128|63&t)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,64<=i?(this.block=a[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){var e,t;this.finalized||(this.finalized=!0,e=this.blocks,t=this.lastByteIndex,e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],56<=t&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash())},Sha1.prototype.hash=function(){for(var e,t=this.h0,i=this.h1,r=this.h2,s=this.h3,n=this.h4,a=this.blocks,o=16;o<80;++o)e=a[o-3]^a[o-8]^a[o-14]^a[o-16],a[o]=e<<1|e>>>31;for(o=0;o<20;o+=5)t=(e=(i=(e=(r=(e=(s=(e=(n=(e=t<<5|t>>>27)+(i&r|~i&s)+n+1518500249+a[o]<<0)<<5|n>>>27)+(t&(i=i<<30|i>>>2)|~t&r)+s+1518500249+a[o+1]<<0)<<5|s>>>27)+(n&(t=t<<30|t>>>2)|~n&i)+r+1518500249+a[o+2]<<0)<<5|r>>>27)+(s&(n=n<<30|n>>>2)|~s&t)+i+1518500249+a[o+3]<<0)<<5|i>>>27)+(r&(s=s<<30|s>>>2)|~r&n)+t+1518500249+a[o+4]<<0,r=r<<30|r>>>2;for(;o<40;o+=5)t=(e=(i=(e=(r=(e=(s=(e=(n=(e=t<<5|t>>>27)+(i^r^s)+n+1859775393+a[o]<<0)<<5|n>>>27)+(t^(i=i<<30|i>>>2)^r)+s+1859775393+a[o+1]<<0)<<5|s>>>27)+(n^(t=t<<30|t>>>2)^i)+r+1859775393+a[o+2]<<0)<<5|r>>>27)+(s^(n=n<<30|n>>>2)^t)+i+1859775393+a[o+3]<<0)<<5|i>>>27)+(r^(s=s<<30|s>>>2)^n)+t+1859775393+a[o+4]<<0,r=r<<30|r>>>2;for(;o<60;o+=5)t=(e=(i=(e=(r=(e=(s=(e=(n=(e=t<<5|t>>>27)+(i&r|i&s|r&s)+n-1894007588+a[o]<<0)<<5|n>>>27)+(t&(i=i<<30|i>>>2)|t&r|i&r)+s-1894007588+a[o+1]<<0)<<5|s>>>27)+(n&(t=t<<30|t>>>2)|n&i|t&i)+r-1894007588+a[o+2]<<0)<<5|r>>>27)+(s&(n=n<<30|n>>>2)|s&t|n&t)+i-1894007588+a[o+3]<<0)<<5|i>>>27)+(r&(s=s<<30|s>>>2)|r&n|s&n)+t-1894007588+a[o+4]<<0,r=r<<30|r>>>2;for(;o<80;o+=5)t=(e=(i=(e=(r=(e=(s=(e=(n=(e=t<<5|t>>>27)+(i^r^s)+n-899497514+a[o]<<0)<<5|n>>>27)+(t^(i=i<<30|i>>>2)^r)+s-899497514+a[o+1]<<0)<<5|s>>>27)+(n^(t=t<<30|t>>>2)^i)+r-899497514+a[o+2]<<0)<<5|r>>>27)+(s^(n=n<<30|n>>>2)^t)+i-899497514+a[o+3]<<0)<<5|i>>>27)+(r^(s=s<<30|s>>>2)^n)+t-899497514+a[o+4]<<0,r=r<<30|r>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+i<<0,this.h2=this.h2+r<<0,this.h3=this.h3+s<<0,this.h4=this.h4+n<<0},Sha1.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,r=this.h3,s=this.h4;return HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,r=this.h3,s=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,s>>24&255,s>>16&255,s>>8&255,255&s]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var exports=createMethod();COMMON_JS?module.exports=exports:(root.sha1=exports,AMD&&define(function(){return exports}))}(),Object.extend(Squeak,{vmPath:"/",platformSubtype:"Browser",osVersion:navigator.userAgent,windowSystem:"HTML"}),window.SqueakJS={};var canUseMouseOffset=null;function updateMousePos(e,t,i){var r=(canUseMouseOffset=null===canUseMouseOffset?"offsetX"in e:canUseMouseOffset)?e.offsetX:e.layerX,e=canUseMouseOffset?e.offsetY:e.layerY,r=(i.cursorCanvas&&(i.cursorCanvas.style.left=r+t.offsetLeft+i.cursorOffsetX+"px",i.cursorCanvas.style.top=e+t.offsetTop+i.cursorOffsetY+"px"),r*t.width/t.offsetWidth|0),e=e*t.height/t.offsetHeight|0;i.mouseX=Math.max(0,Math.min(i.width,r)),i.mouseY=Math.max(0,Math.min(i.height,e))}function recordMouseEvent(e,t,i,r,s){if(updateMousePos(t,i,r),r.vm){var n=r.buttons&Squeak.Mouse_All;switch(e){case"mousedown":switch(t.button||0){case 0:n=Squeak.Mouse_Red;break;case 1:n=Squeak.Mouse_Yellow;break;case 2:n=Squeak.Mouse_Blue}n===Squeak.Mouse_Red&&(t.altKey||t.metaKey)&&(n=Squeak.Mouse_Yellow),s.swapButtons&&(n==Squeak.Mouse_Yellow?n=Squeak.Mouse_Blue:n==Squeak.Mouse_Blue&&(n=Squeak.Mouse_Yellow));break;case"mousemove":break;case"mouseup":n=0}r.buttons=n|recordModifiers(t,r),r.eventQueue&&(r.eventQueue.push([Squeak.EventTypeMouse,t.timeStamp,r.mouseX,r.mouseY,r.buttons&Squeak.Mouse_All,r.buttons>>3]),r.signalInputEvent)&&r.signalInputEvent(),r.idle=0,"mouseup"===e?r.runFor(100,e):r.runNow(e)}}function recordWheelEvent(e,t){var i;t.vm&&(t.eventQueue&&t.vm.image.isSpur?(i=[Squeak.EventTypeMouseWheel,e.timeStamp,e.deltaX,-e.deltaY,t.buttons&Squeak.Mouse_All,t.buttons>>3],t.eventQueue.push(i),t.signalInputEvent&&t.signalInputEvent(),t.idle=0,t.runNow&&t.runNow("wheel")):fakeCmdOrCtrlKey(0<e.deltaY?31:30,e.timeStamp,t))}for(var MacRomanToUnicode=[196,197,199,201,209,214,220,225,224,226,228,227,229,231,233,232,234,235,237,236,238,239,241,243,242,244,246,245,250,249,251,252,8224,176,162,163,167,8226,182,223,174,169,8482,180,168,8800,198,216,8734,177,8804,8805,165,181,8706,8721,8719,960,8747,170,186,937,230,248,191,161,172,8730,402,8776,8710,171,187,8230,160,192,195,213,338,339,8211,8212,8220,8221,8216,8217,247,9674,255,376,8260,8364,8249,8250,64257,64258,8225,183,8218,8222,8240,194,202,193,203,200,205,206,207,204,211,212,63743,210,218,219,217,305,710,732,175,728,729,730,184,733,731,711],UnicodeToMacRoman={},i=0;i<MacRomanToUnicode.length;i++)UnicodeToMacRoman[MacRomanToUnicode[i]]=i+128;function recordKeyboardEvent(e,t,i){var r,s;i.vm&&(r=UnicodeToMacRoman[e]||(e<128?e:0),s=i.buttons>>3<<8|r,i.eventQueue?(i.eventQueue.push([Squeak.EventTypeKeyboard,t,r,Squeak.EventKeyChar,i.buttons>>3,e]),i.signalInputEvent&&i.signalInputEvent(),i.keys[0]=s):s===i.vm.interruptKeycode?i.vm.interruptPending=!0:i.keys.push(s),i.idle=0,i.runNow)&&i.runNow("keyboard")}function recordDragDropEvent(e,t,i,r){r.vm&&r.eventQueue&&(updateMousePos(t,i,r),r.eventQueue.push([Squeak.EventTypeDragDropFiles,t.timeStamp,e,r.mouseX,r.mouseY,r.buttons>>3,r.droppedFiles.length]),r.signalInputEvent&&r.signalInputEvent(),r.idle=0,r.runNow)&&r.runNow("drag-drop")}function fakeCmdOrCtrlKey(e,t,i){i.buttons&=~Squeak.Keyboard_All,i.buttons|=Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl,i.keys=[],recordKeyboardEvent(e,t,i)}function makeSqueakEvent(e,t,i){t[0]=e[0],t[1]=e[1]-i&Squeak.MillisecondClockMask;for(var r=2;r<e.length;r++)t[r]=e[r]}function createSqueakDisplay(u,l){(l=l||{}).fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor="black",document.ontouchmove=function(e){e.preventDefault()});var c={context:u.getContext("2d"),fullscreen:!1,width:0,height:0,scale:1,highdpi:l.highdpi,mouseX:0,mouseY:0,buttons:0,keys:[],cmdButtonTouched:null,eventQueue:null,clipboardString:"",clipboardStringChanged:!1,handlingEvent:"",cursorCanvas:!1!==l.cursor&&document.getElementById("sqCursor")||document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null,changedCallback:null},h=(l.pixelated&&(u.classList.add("pixelated"),c.cursorCanvas)&&c.cursorCanvas.classList.add("pixelated"),c.reset=function(){c.eventQueue=null,c.signalInputEvent=null,c.lastTick=0,c.getNextEvent=function(e,t){c.eventQueue=[],c.eventQueue.push=function(e){c.eventQueue.offset=Date.now()-e[1],delete c.eventQueue.push,c.eventQueue.push(e)},c.getNextEvent=function(e,t){var i=c.eventQueue.shift();i?makeSqueakEvent(i,e,t-c.eventQueue.offset):e[0]=Squeak.EventTypeNone},c.getNextEvent(e,t)}},c.reset(),setupFullscreen(c,u,l)),f=(c.fullscreenRequest=function(e,t){(c.fullscreen!=e?(c.fullscreen=e,c.resizeTodo=t,c.resizeTodoTimeout=setTimeout(c.resizeDone,1e3),h):t)()},c.resizeDone=function(){clearTimeout(c.resizeTodoTimeout);var e=c.resizeTodo;e&&(c.resizeTodo=null,e())},c.clear=function(){u.width=u.width},c.setTitle=function(e){document.title=e},c.showBanner=function(e,t){t=t||c.context.canvas.style||{};var i=c.context;i.clearRect(0,0,u.width,u.height),i.fillStyle=t.color||"#F90",i.font=t.font||"bold 48px sans-serif",!t.font&&i.measureText(e).width>u.width&&(i.font="bold 24px sans-serif"),i.textAlign="center",i.textBaseline="middle",i.fillText(e,u.width/2,u.height/2)},c.showProgress=function(e,t){t=t||c.context.canvas.style||{};var i=c.context,r=u.width/3|0,s=.5*u.width-r/2,n=.5*u.height+48;i.fillStyle=t.background||"#000",i.fillRect(s,n,r,24),i.lineWidth=2,i.strokeStyle=t.stroke||"#F90",i.strokeRect(s,n,r,24),i.fillStyle=t.fill||"#F90",i.fillRect(s,n,r*e,24)},c.executeClipboardPasteKey=function(e,t){if(!c.vm)return!0;try{c.clipboardString=e,fakeCmdOrCtrlKey("v".charCodeAt(0),t,c)}catch(e){console.error("paste error "+e)}},c.executeClipboardCopyKey=function(e,t){if(!c.vm)return!0;c.clipboardStringChanged=!1,fakeCmdOrCtrlKey((e||"c").charCodeAt(0),t,c);for(var i=Date.now();!c.clipboardStringChanged&&Date.now()-i<500;)c.vm.interpret(20);if(c.clipboardStringChanged)try{return c.clipboardString}catch(e){console.error("copy error "+e)}},u.onmousedown=function(e){return h(),recordMouseEvent("mousedown",e,u,c,l),e.preventDefault(),!1},u.onmouseup=function(e){recordMouseEvent("mouseup",e,u,c,l),h(),e.preventDefault()},u.onmousemove=function(e){recordMouseEvent("mousemove",e,u,c,l),e.preventDefault()},u.onwheel=function(e){recordWheelEvent(e,c),e.preventDefault()},u.oncontextmenu=function(){return!1},{state:"idle",button:0,x:0,y:0,dist:0,down:{}});function p(e){if(e.touches.length){for(var t=0,i=0,r=0,s=0;s<e.touches.length;s++)e.touches[s].identifier!==c.cmdButtonTouched&&(t+=e.touches[s].pageX,i+=e.touches[s].pageY,r++);0<r&&(f.x=t/r,f.y=i/r)}return{timeStamp:e.timeStamp,button:f.button,offsetX:f.x-u.offsetLeft,offsetY:f.y-u.offsetTop}}function r(e,t,i,r){e-=i,i=t-r;return Math.sqrt(e*e+i*i)}function a(e,t){return r(e.pageX,e.pageY,t.pageX,t.pageY)}function d(e,t,i,r){var s=c.cursorCanvas,n=i/u.width,a=c.highdpi?window.devicePixelRatio:1,o=n*a;return u.style.left=(0|e)+"px",u.style.top=(0|t)+"px",u.style.width=(0|i)+"px",u.style.height=(0|r)+"px",s&&(s.style.left=(e+c.cursorOffsetX+c.mouseX*n|0)+"px",s.style.top=(t+c.cursorOffsetY+c.mouseY*n|0)+"px",s.style.width=(s.width*o|0)+"px",s.style.height=(s.height*o|0)+"px"),l.pixelated||(o%1==0||5<o?(u.classList.add("pixelated"),s&&s.classList.add("pixelated")):(u.classList.remove("pixelated"),s&&c.cursorCanvas.classList.remove("pixelated"))),c.css={left:e,top:t,width:i,height:r,scale:n,pixelScale:o,ratio:a},c.changedCallback&&c.changedCallback(),n}u.ontouchstart=function(e){e.preventDefault();for(var t=p(e),i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier!==c.cmdButtonTouched)switch(f.state){case"idle":f.state="got1stFinger",f.first=t,setTimeout(function(){"got1stFinger"===f.state&&(f.state="mousing",f.button=t.button=0,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l))},100);break;case"got1stFinger":f.state="got2ndFinger",f.dist=a(e.touches[0],e.touches[1]),f.down.x=f.x,f.down.y=f.y,f.down.dist=f.dist,f.down.left=u.offsetLeft,f.down.top=u.offsetTop,f.down.width=u.offsetWidth,f.down.height=u.offsetHeight,f.orig||(f.orig={left:f.down.left,top:f.down.top,right:f.down.left+f.down.width,bottom:f.down.top+f.down.height,width:f.down.width,height:f.down.height}),setTimeout(function(){"got2ndFinger"===f.state&&(10<Math.abs(f.down.dist-f.dist)||10<r(f.down.x,f.down.y,f.x,f.y)?f.state="zooming":(f.state="mousing",f.button=t.button=2,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l)))},200)}},u.ontouchmove=function(e){e.preventDefault();var t,i,r,s,n=p(e);switch(f.state){case"got1stFinger":f.state="mousing",f.button=n.button=0,recordMouseEvent("mousemove",n,u,c,l),recordMouseEvent("mousedown",n,u,c,l);break;case"mousing":recordMouseEvent("mousemove",n,u,c,l);break;case"got2ndFinger":1<e.touches.length&&(f.dist=a(e.touches[0],e.touches[1]));break;case"zooming":(t=e).touches.length<2||(f.dist=a(t.touches[0],t.touches[1]),t=f.orig.width/f.down.width,s=f.dist/f.down.dist,s=Math.min(Math.max(s,.95*t),5*t),t=f.down.width*s,i=f.orig.height*t/f.orig.width,r=f.down.left-(f.down.x-f.down.left)*(s-1)+(f.x-f.down.x),s=f.down.top-(f.down.y-f.down.top)*(s-1)+(f.y-f.down.y),d(r=Math.max(Math.min(r,f.orig.left+20),f.orig.right-t-20),s=Math.max(Math.min(s,f.orig.top+20),f.orig.bottom-i-20),t,i))}},u.ontouchend=function(e){e.preventDefault(),h();var t=p(e),i=e.touches.length;0<=Array.from(e.touches).findIndex(e=>e.identifier===c.cmdButtonTouched)&&i--;for(var r,s,n,a,o=0;o<e.changedTouches.length;o++)if(e.changedTouches[o].identifier!==c.cmdButtonTouched)switch(f.state){case"mousing":0<i||(f.state="idle",recordMouseEvent("mouseup",t,u,c,l));break;case"got1stFinger":f.state="idle",f.button=t.button=0,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l),recordMouseEvent("mouseup",t,u,c,l);break;case"got2ndFinger":f.state="mousing",f.button=t.button=2,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l);break;case"zooming":0<i||(f.state="idle",a=n=s=r=void 0,r=u.offsetLeft,s=u.offsetTop,n=u.offsetWidth,u.offsetHeight,n=Math.min(Math.max(n,f.orig.width),5*f.orig.width),a=f.orig.height*n/f.orig.width,d(Math.max(Math.min(r,f.orig.left),f.orig.right-n),Math.max(Math.min(s,f.orig.top),f.orig.bottom-a),n,a)-c.scale<1e-4&&(f.orig=null,g()))}},u.ontouchcancel=function(e){u.ontouchend(e)},c.cursorCanvas&&(e="absolute"===window.getComputedStyle(u).position,c.cursorCanvas.style.display="block",c.cursorCanvas.style.position=e?"absolute":"fixed",c.cursorCanvas.style.cursor="none",c.cursorCanvas.style.background="transparent",c.cursorCanvas.style.pointerEvents="none",u.parentElement.appendChild(c.cursorCanvas),u.style.cursor="none");var i=document.createElement("input");if(i.setAttribute("autocomplete","off"),i.setAttribute("autocorrect","off"),i.setAttribute("autocapitalize","off"),i.setAttribute("spellcheck","false"),i.style.position="absolute",i.style.left="-1000px",u.parentElement.appendChild(i),"ontouchstart"in document){var e=document.createElement("div"),t=(e.innerHTML='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="50px" height="50px" viewBox="0 0 150 150" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="Page-1" stroke="none" fill="#000000"><rect x="33" y="105" width="10" height="10" rx="1"></rect><rect x="26" y="60" width="10" height="10" rx="1"></rect><rect x="41" y="60" width="10" height="10" rx="1"></rect><rect x="56" y="60" width="10" height="10" rx="1"></rect><rect x="71" y="60" width="10" height="10" rx="1"></rect><rect x="86" y="60" width="10" height="10" rx="1"></rect><rect x="101" y="60" width="10" height="10" rx="1"></rect><rect x="116" y="60" width="10" height="10" rx="1"></rect><rect x="108" y="105" width="10" height="10" rx="1"></rect><rect x="33" y="75" width="10" height="10" rx="1"></rect><rect x="48" y="75" width="10" height="10" rx="1"></rect><rect x="63" y="75" width="10" height="10" rx="1"></rect><rect x="78" y="75" width="10" height="10" rx="1"></rect><rect x="93" y="75" width="10" height="10" rx="1"></rect><rect x="108" y="75" width="10" height="10" rx="1"></rect><rect x="41" y="90" width="10" height="10" rx="1"></rect><rect x="26" y="90" width="10" height="10" rx="1"></rect><rect x="56" y="90" width="10" height="10" rx="1"></rect><rect x="71" y="90" width="10" height="10" rx="1"></rect><rect x="86" y="90" width="10" height="10" rx="1"></rect><rect x="101" y="90" width="10" height="10" rx="1"></rect><rect x="116" y="90" width="10" height="10" rx="1"></rect><rect x="48" y="105" width="55" height="10" rx="1"></rect><path d="M20.0056004,51 C18.3456532,51 17.0000001,52.3496496 17.0000001,54.0038284 L17.0000001,85.6824519 L17,120.003453 C17.0000001,121.6584 18.3455253,123 20.0056004,123 L131.9944,123 C133.654347,123 135,121.657592 135,119.997916 L135,54.0020839 C135,52.3440787 133.654475,51 131.9944,51 L20.0056004,51 Z" fill="none" stroke="#000000" stroke-width="2"></path><path d="M52.0410156,36.6054687 L75.5449219,21.6503905 L102.666016,36.6054687" id="Line" stroke="#000000" stroke-width="3" stroke-linecap="round" fill="none"></path></g></svg>',e.setAttribute("style","position:fixed;right:0;bottom:0;background-color:rgba(128,128,128,0.5);border-radius:5px"),u.parentElement.appendChild(e),e.onmousedown=function(e){i.focus({preventScroll:!0}),e.preventDefault()},e.ontouchstart=e.onmousedown,document.createElement("div"));if(t.innerHTML="âŒ˜",t.setAttribute("style","position:fixed;left:0;background-color:rgba(128,128,128,0.5);width:50px;height:50px;font-size:30px;text-align:center;vertical-align:middle;line-height:50px;border-radius:5px"),window.visualViewport){const s=window.visualViewport;e=()=>t.style.top=s.height+"px";s.addEventListener("resize",e),t.style.transform="translateY(-100%)",e()}else t.style.bottom="0";u.parentElement.appendChild(t),t.ontouchstart=function(e){c.cmdButtonTouched=e.changedTouches[0].identifier,t.style.backgroundColor="rgba(255,255,255,0.5)",e.preventDefault(),e.stopPropagation()},t.ontouchend=function(e){c.cmdButtonTouched=null,t.style.backgroundColor="rgba(128,128,128,0.5)",e.preventDefault(),e.stopPropagation()},t.ontouchcancel=t.ontouchend}else i.onblur=function(){i.focus({preventScroll:!0})},i.focus({preventScroll:!0});c.isMac=navigator.userAgent.includes("Mac");var m,n=[];function o(){i.value="**",i.selectionStart=1,i.selectionEnd=1}if(i.oninput=function(e){if(!c.vm)return!0;if("insertText"===e.inputType||"insertCompositionText"===e.inputType||"insertFromComposition"===e.inputType){var t=0<n.length;if(t){var i=c.buttons;c.buttons&=~Squeak.Keyboard_All;for(var r=0;r<n.length;r++)recordKeyboardEvent(8,e.timeStamp,c);c.buttons=i,n=[]}for(var s=Array.from(e.data),r=0;r<s.length;r++)recordKeyboardEvent(s[r].codePointAt(0),e.timeStamp,c);!t&&e.isComposing&&"insertCompositionText"===e.inputType&&(n=n.concat(s))}n.length||o()},i.onkeydown=function(t){if(h(),!c.vm)return!0;if(!("Dead"===t.key)){recordModifiers(t,c);var e,i={8:8,9:9,13:13,27:27,32:32,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[t.keyCode];if(i)return recordKeyboardEvent(i,t.timeStamp,c),t.preventDefault();if(c.isMac?t.metaKey:t.ctrlKey)switch(t.key){case"c":case"x":return navigator.clipboard?("string"==typeof(e=c.executeClipboardCopyKey(t.key,t.timeStamp))&&navigator.clipboard.writeText(e).catch(function(e){console.error("display: copy error "+e.message)}),t.preventDefault()):void 0;case"v":return navigator.clipboard?(navigator.clipboard.readText().then(function(e){c.executeClipboardPasteKey(e,t.timeStamp)}).catch(function(e){console.error("display: paste error "+e.message)}),t.preventDefault()):void 0}return 1===t.key.length&&c.buttons&(Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl)?(i=t.key.toLowerCase().charCodeAt(0),c.buttons&Squeak.Keyboard_Ctrl&&96<=i&&i<127&&(i&=31),recordKeyboardEvent(i,t.timeStamp,c),t.preventDefault()):void 0}},i.onkeyup=function(e){if(!c.vm)return!0;recordModifiers(e,c)},o(),"ontouchstart"in document){let t=0;setInterval(()=>{var e=i.selectionStart-1;0==e?t=0:((0===t||2<t)&&recordKeyboardEvent(e<1?28:29,Date.now(),c),i.selectionStart=1,i.selectionEnd=1,t++)},250)}function v(e){for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return 1}function g(){var e,t,i,r,s,n,a,o;f.orig||(e=window.innerWidth,t=window.innerHeight,clearTimeout(m),m=setTimeout(function(){e==window.innerWidth&&t==window.innerHeight?c.resizeDone():g()},300),i=window.innerWidth,r=window.innerHeight,n=s=0,l.fixedWidth?(c.width=l.fixedWidth,c.height=l.fixedHeight,(o=c.width/c.height)<i/r?s=i-Math.floor(r*o):n=r-Math.floor(i/o),c.scale=(i-s)/c.width):(l.minWidth||(l.minWidth=700),l.minHeight||(l.minHeight=700),o=c.highdpi?window.devicePixelRatio:1,a=i<l.minWidth?l.minWidth/i:o,o=r<l.minHeight?l.minHeight/r:o,a=Math.max(a,o),c.width=Math.floor(i*a),c.height=Math.floor(r*a),c.scale=i/c.width),u.width==c.width&&u.height==c.height||(o=(l.fixedWidth||!c.resizeTodo)&&c.context.getImageData(0,0,u.width,u.height),u.width=c.width,u.height=c.height,o&&c.context.putImageData(o,0,0)),d(0+Math.floor(s/2),0+Math.floor(n/2),i-s,r-n))}return navigator.clipboard?(c.readFromSystemClipboard=()=>c.handlingEvent&&navigator.clipboard.readText().then(e=>c.clipboardString=e).catch(e=>console.error("readFromSystemClipboard "+e.message)),c.writeToSystemClipboard=()=>c.handlingEvent&&navigator.clipboard.writeText(c.clipboardString).then(()=>c.clipboardStringChanged=!1).catch(e=>console.error("writeToSystemClipboard "+e.message))):(document.oncopy=function(e,t){t=c.executeClipboardCopyKey(t,e.timeStamp);"string"==typeof t&&e.clipboardData.setData("Text",t),e.preventDefault()},document.oncut=function(e){if(!c.vm)return!0;document.oncopy(e,"x")},document.onpaste=function(e){var t=e.clipboardData.getData("Text");c.executeClipboardPasteKey(t,e.timeStamp),e.preventDefault()}),document.ondragover=function(e){e.preventDefault(),v(e)?(e.dataTransfer.dropEffect="copy",recordDragDropEvent(Squeak.EventDragMove,e,u,c)):e.dataTransfer.dropEffect="none"},document.ondragenter=function(e){v(e)&&recordDragDropEvent(Squeak.EventDragEnter,e,u,c)},document.ondragleave=function(e){v(e)&&recordDragDropEvent(Squeak.EventDragLeave,e,u,c)},document.ondrop=function(r){var s,n,a,o;return r.preventDefault(),v(r)&&(s=[].slice.call(r.dataTransfer.files),n=[],o=null,c.droppedFiles=[],s.forEach(function(t){var i=l.root+t.name,e=(c.droppedFiles.push(i),new FileReader);e.onload=function(){var e=this.result;Squeak.filePut(i,e),n.push(i),a||!/.*image$/.test(i)||c.vm&&!confirm("Run "+t.name+" now?\n(cancel to use as file)")||(a=e,o=i),n.length==s.length&&(a?c.vm?(c.quitFlag=!0,l.onQuit=function(e,t,i){i.onQuit=null,SqueakJS.appName=o.replace(/.*\//,"").replace(/\.image$/,""),SqueakJS.runImage(a,o,t,i)}):(SqueakJS.appName=o.replace(/.*\//,"").replace(/\.image$/,""),SqueakJS.runImage(a,o,c,l)):recordDragDropEvent(Squeak.EventDragDrop,r,u,c))},e.readAsArrayBuffer(t)})),!1},g(),window.onresize=g,c}function setupSpinner(t,e){e=e.spinner;return e?(e.onmousedown=function(e){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(t.interruptPending=!0)},e.style):null}var spinnerAngle=0,becameBusy=0,loop;function updateSpinner(e,t,i,r){r=i.lastTick-r.lastTick<500;!(0===t)||r?(e.display="none",becameBusy=0):0===becameBusy?becameBusy=i.lastTick:1e3<i.lastTick-becameBusy&&(e.display="block",spinnerAngle=(spinnerAngle+30)%360,e.webkitTransform=e.transform="rotate("+spinnerAngle+"deg)")}function processOptions(e){var t=(location.hash||location.search).slice(1),i=t&&t.split("&");if(i)for(var r=0;r<i.length;r++){var s=i[r].split("="),n=s[0],a=!0;if(1<s.length&&(a=decodeURIComponent(s.slice(1).join("="))).match(/^(true|false|null|[0-9"[{].*)$/))try{a=JSON.parse(a)}catch(e){"["===a[0]&&(a=a.slice(1,-1).split(","))}e[n]=a}t=Squeak.splitFilePath(e.root||"/").fullname;Squeak.dirCreate(t,!0),/\/$/.test(t)||(t+="/"),e.root=t,SqueakJS.options=e}function fetchTemplates(e){var t,i;if(e.templates)for(i in e.templates.constructor===Array&&(t={},e.templates.forEach(function(e){t[e]=e}),e.templates=t),e.templates){var r="/"==i[0]?i:e.root+i,s=new URL(e.url,document.baseURI).href.split(/[?#]/)[0],s=Squeak.splitUrl(e.templates[i],s).full;(s=s.endsWith("/")?s.slice(0,-1):s).endsWith("/.")&&(s=s.slice(0,-2)),Squeak.fetchTemplateDir(r,s)}}function processFile(e,t,i,r){Squeak.filePut(i.root+e.name,e.data,function(){console.log("Stored "+i.root+e.name),e.zip?processZip(e,t,i,r):r()})}function processZip(n,a,o,u){JSZip().loadAsync(n.data).then(function(e){var r=[];if(e.forEach(function(e){var t;!o.image.name&&e.match(/\.image$/)&&(o.image.name=e),o.forceDownload||!Squeak.fileExists(o.root+e)?r.push(e):o.image.name===e&&(t=u,u=function(){Squeak.fileGet(o.root+e,function(e){return o.image.data=e,t()},function(){return Squeak.fileDelete(o.root+n.name),processZip(n,a,o,t)})})}),0===r.length)return u();var s=0;a.showBanner("Unzipping "+n.name),a.showProgress(0),r.forEach(function(i){console.log("Inflating "+n.name+": "+i),e.file(i).async("arraybuffer",function(e){a.showProgress((e.percent/100+s)/r.length)}).then(function(e){console.log("Expanded size of "+i+": "+e.byteLength+" bytes");var t={};(t=o.image.name===i?o.image:t).name=i,t.data=e,processFile(t,a,o,function(){++s===r.length&&u()})})})})}function checkExisting(t,i,r,s,e){if(!Squeak.fileExists(r.root+t.name))return e();t.image||t.zip?Squeak.fileGet(r.root+t.name,function(e){t.data=e,t.zip?processZip(t,i,r,s):s()},function(){return Squeak.fileDelete(r.root+t.name),e()}):s()}function downloadFile(r,t,s,i){t.showBanner("Downloading "+r.name);var n=new XMLHttpRequest,e=s.proxy||"";n.open("GET",e+r.url),s.ajax&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.responseType="arraybuffer",n.onprogress=function(e){e.lengthComputable&&t.showProgress(e.loaded/e.total)},n.onload=function(e){200==this.status?(r.data=this.response,processFile(r,t,s,i)):this.onerror(this.statusText)},n.onerror=function(e){if(s.proxy)return console.error(Squeak.bytesAsString(new Uint8Array(this.response))),alert("Failed to download:\n"+r.url);var t="https://corsproxy.io/?",i=new XMLHttpRequest;console.warn("Retrying with CORS proxy: "+t+r.url),i.open("GET",t+r.url),s.ajax&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.responseType=n.responseType,i.onprogress=n.onprogress,i.onload=n.onload,i.onerror=function(){console.error(Squeak.bytesAsString(new Uint8Array(this.response))),alert("Failed to download:\n"+r.url)},i.send()},n.send()}function fetchFiles(i,r,s,n){!function e(){if(0===i.length)return n();var t=i.shift();s.forceDownload||t.forceDownload?downloadFile(t,r,s,e):checkExisting(t,r,s,function(){e()},function(){downloadFile(t,r,s,e)})}()}SqueakJS.runImage=function(t,s,n,a){window.onbeforeunload=function(e){var t=SqueakJS.appName+" is still running";return e.returnValue=t},window.clearTimeout(loop),n.reset(),n.clear(),n.showBanner("Loading "+SqueakJS.appName),n.showProgress(0),window.setTimeout(function(){var e=new Squeak.Image(s);e.readFromBuffer(t,function(){n.quitFlag=!1;var t=new Squeak.Interpreter(e,n,a),i=(SqueakJS.vm=t,Squeak.Settings.squeakImageName=s,n.clear(),n.showBanner("Starting "+SqueakJS.appName),setupSpinner(t,a));function r(){try{n.quitFlag?SqueakJS.onQuit(t,n,a):t.interpret(50,function(e){"sleep"==e&&(e=200),i&&updateSpinner(i,e,t,n),loop=window.setTimeout(r,e)})}catch(e){console.error(e),alert(e)}}n.runNow=function(e){window.clearTimeout(loop),n.handlingEvent=e,r(),n.handlingEvent=""},n.runFor=function(e,t){var i=Date.now()+e;do{if(n.quitFlag)return}while(n.runNow(t),Date.now()<i)},a.onStart&&a.onStart(t,n,a),r()},function(e){n.showProgress(e)})},0)},SqueakJS.runSqueak=function(e,t,i){processOptions(i),!e&&i.image&&(e=i.image);var r,s=i.url||"",n=(!s&&e&&e.replace(/[^\/]*$/,"")&&(s=e.replace(/[^\/]*$/,""),e=e.replace(/^.*\//,"")),"/"===(i.url=s)[0]&&"/"!==s[1]&&1<s.length&&"/"===i.root&&(i.root=s),fetchTemplates(i),createSqueakDisplay(t,i)),a={url:null,name:null,image:!0,data:null},o=[];return n.argv=i.argv,e&&(r=Squeak.splitUrl(e,s),a.url=r.full,a.name=r.filename),i.files&&i.files.forEach(function(e){var t=Squeak.splitUrl(e,s);a.name!==t.filename&&(!a.url&&e.match(/\.image$/)?(a.name=t.filename,a.url=t.full):o.push({url:t.full,name:t.filename}))}),i.zip&&("string"==typeof i.zip?[i.zip]:i.zip).forEach(function(e){var e=Squeak.splitUrl(e,s),t="";!e.filename.match(/[0-9]/)&&e.uptoslash.match(/[0-9]/)&&(t=e.uptoslash.replace(/^[^:]+:\/\//,"").replace(/[^a-zA-Z0-9]/g,"_")),o.push({url:e.full,name:t+e.filename,zip:!0})}),a.url&&o.push(a),i.document&&(r=Squeak.splitUrl(i.document,s),o.push({url:r.full,name:r.filename,forceDownload:!1!==i.forceDownload}),n.documentName=i.root+r.filename),i.image=a,fetchFiles(o,n,i,function(){Squeak.fsck();var e=i.image;return e.name?e.data?(SqueakJS.appName=i.appName||e.name.replace(/\.image$/,""),void SqueakJS.runImage(e.data,i.root+e.name,n,i)):alert("could not find image "+e.name):alert("could not find an image")}),n},SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0},SqueakJS.onQuit=function(e,t,i){window.onbeforeunload=null,t.vm=null,i.spinner&&(i.spinner.style.display="none"),i.onQuit?i.onQuit(e,t,i):t.showBanner(SqueakJS.appName+" stopped.")},window.applicationCache&&applicationCache.addEventListener("updateready",function(){var e=window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS";confirm(e+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())})}();