!function(){if(self.Squeak||(self.Squeak={}),!Squeak.Settings){var settings;try{if(settings=self.localStorage,settings["squeak-foo:"]="bar","bar"!==settings["squeak-foo:"])throw Error();delete settings["squeak-foo:"]}catch(e){settings={}}Squeak.Settings=settings}function B3DAcceleratorPlugin(){var u=[],l=0,c=null,h=null,f=null;return{getModuleName:function(){return"B3DAcceleratorPlugin (SqueakJS)"},interpreterProxy:null,primHandler:null,setInterpreter:function(e){return this.interpreterProxy=e,this.vm=this.interpreterProxy.vm,this.primHandler=this.vm.primHandler,this.prevDCCallback=this.primHandler.display.changedCallback,this.primHandler.display.changedCallback=()=>{this.prevDCCallback&&this.prevDCCallback();for(var e of u)this.adjustCanvas(e)},!0},setOpenGL:function(e){f=(h=e).GL,c&&h.makeCurrent(c)},makeCurrent(e){var t;c!==e&&(c=e,h)&&h.makeCurrent(e),e.webgl.isContextLost()&&!e.warning&&(console.warn("B3DAccel: WebGL context lost"),(t=document.createElement("div")).style.position="absolute",t.style.left=e.canvas.offsetLeft+"px",t.style.top=e.canvas.offsetTop+"px",t.style.width=e.canvas.width+"px",t.style.height=e.canvas.height+"px",t.style.backgroundColor="rgba(0,0,0,0.8)",t.style.color="white",t.style.fontFamily="sans-serif",t.style.fontSize="24px",t.style.textAlign="center",t.style.lineHeight=e.canvas.height+"px",t.style.pointerEvents="none",t.style.cursor="normal",t.innerHTML="WebGL context lost",document.body.appendChild(t),e.warning=t)},currentFromStack:function(e){e=this.interpreterProxy.stackObjectValue(e);return e.webgl?(this.makeCurrent(e),e):null},primitiveAllocateTexture:function(e){var t,r,i;return 4===e&&(t=this.interpreterProxy.stackIntegerValue(0),r=this.interpreterProxy.stackIntegerValue(1),this.interpreterProxy.stackIntegerValue(2),!!this.currentFromStack(3))&&!(r&r-1||t&t-1)&&(h.glGenTextures(1,i=[0]),h.glBindTexture(f.TEXTURE_2D,i=i[0]),h.glTexParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),h.glTexParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),h.glTexParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),h.glTexParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),h.glTexEnvi(f.TEXTURE_ENV,f.TEXTURE_ENV_MODE,f.MODULATE),h.glTexImage2D(f.TEXTURE_2D,0,f.RGBA,r,t,0,f.BGRA,f.UNSIGNED_BYTE,null),this.primHandler.popNandPushIfOK(e+1,i))},primitiveSetVerboseLevel:function(e){return 1===e&&(this.interpreterProxy.stackIntegerValue(0),this.interpreterProxy.pop(e),!0)},primitiveCompositeTexture:function(e){var t,r,i,s,n,a;return 7===e&&!(!this.currentFromStack(6)||(t=this.interpreterProxy.stackIntegerValue(5),r=this.interpreterProxy.stackIntegerValue(4),i=this.interpreterProxy.stackIntegerValue(3),s=this.interpreterProxy.stackIntegerValue(2),n=this.interpreterProxy.stackIntegerValue(1),a=this.interpreterProxy.booleanValueOf(this.interpreterProxy.stackValue(0)),this.interpreterProxy.failed())||!this.b3dxCompositeTexture(t,r,i,s,n,a)||(this.interpreterProxy.pop(e),0))},primitiveCreateRendererFlags:function(e){if(5!==e)return!1;var t=this.interpreterProxy.stackIntegerValue(4),r=this.interpreterProxy.stackIntegerValue(3),i=this.interpreterProxy.stackIntegerValue(2),s=this.interpreterProxy.stackIntegerValue(1),n=this.interpreterProxy.stackIntegerValue(0);if(-8&t)return!1;var a=document.createElement("canvas"),o=(a.classList.add("b3daccel"),a.width=s,a.height=n,a.style.position="absolute",a.style.backgroundColor="transparent",a.style.pointerEvents="none",{depth:!0,alpha:!(a.style.cursor="normal"),antialias:!0}),t=(4&t&&(o.stencil=!0),a.getContext("webgl",o));if(!t)return!1;l++;o=this.primHandler.makeStString("WebGL#"+l);return u.push(o),o.rendererId=l,o.canvas=a,o.webgl=t,this.b3dxSetViewport(o,r,i,s,n),document.body.appendChild(a),this.makeCurrent(o),this.primHandler.popNandPushIfOK(e+1,o)},primitiveDestroyRenderer:function(e){return 1===e&&!!this.currentFromStack(0)&&(u=u.filter(e=>e!==c),h&&h.destroyGL(c),c.warning&&(c.warning.remove(),c.warning=null),c.canvas.remove(),c.canvas=null,c.webgl=null,c=null,this.interpreterProxy.pop(e),!0)},primitiveDestroyTexture:function(e){var t;return 2===e&&(t=this.interpreterProxy.stackIntegerValue(0),!!this.currentFromStack(1))&&(h.glDeleteTextures(1,[t]),this.interpreterProxy.pop(e),!0)},primitiveFinishRenderer:function(e){return 1===e&&!!this.currentFromStack(0)&&(h.glFinish(),this.interpreterProxy.pop(e),!0)},primitiveFlushRenderer:function(e){return 1===e&&!!this.currentFromStack(0)&&(h.glFlush(),this.interpreterProxy.pop(e),!0)},primitiveGetRendererSurfaceHandle:function(e){return 1===e&&this.currentFromStack(0),!1},primitiveGetIntProperty:function(e){var t;return 2===e&&(t=this.interpreterProxy.stackIntegerValue(0),!!this.currentFromStack(1))&&(t=this.b3dxGetIntProperty(c,t),this.primHandler.popNandPushIfOK(e+1,t))},primitiveGetRendererSurfaceWidth:function(e){var t;return 1===e&&!!this.currentFromStack(0)&&(t=c.canvas.width,this.primHandler.popNandPushIfOK(e+1,t))},primitiveGetRendererSurfaceHeight:function(e){var t;return 1===e&&!!this.currentFromStack(0)&&(t=c.canvas.height,this.primHandler.popNandPushIfOK(e+1,t))},primitiveGetRendererSurfaceDepth:function(e){return 1===e&&!!this.currentFromStack(0)&&this.primHandler.popNandPushIfOK(e+1,32)},primitiveGetRendererColorMasks:function(e){if(2!==e)return!1;var t=this.interpreterProxy.stackObjectValue(0);if(this.currentFromStack(1))return!1;if(4!==t.pointersSize())return!1;for(var r=[16711680,65280,255,4278190080],i=0;i<4;i++)t.pointers[i]=this.interpreterProxy.positive32BitIntegerFor(r[i]);return this.interpreterProxy.pop(e),!0},primitiveSetBufferRect:function(e){var t,r,i,s;return 5===e&&!!this.currentFromStack(4)&&(t=this.interpreterProxy.stackIntegerValue(3),r=this.interpreterProxy.stackIntegerValue(2),i=this.interpreterProxy.stackIntegerValue(1),s=this.interpreterProxy.stackIntegerValue(0),this.b3dxSetViewport(c,t,r,i,s),this.interpreterProxy.pop(e),!0)},primitiveSetViewport:function(e){var t,r,i,s;return 5===e&&!!this.currentFromStack(4)&&(t=this.interpreterProxy.stackIntegerValue(3),r=this.interpreterProxy.stackIntegerValue(2),i=this.interpreterProxy.stackIntegerValue(1),s=this.interpreterProxy.stackIntegerValue(0),this.b3dxSetViewport(c,t,r,i,s),this.interpreterProxy.pop(e),!0)},primitiveSetTransform:function(e){var t,r;return 3===e&&!(!this.currentFromStack(2)||(t=this.stackMatrix(1),r=this.stackMatrix(0),!t)||!r||(h.glMatrixMode(f.PROJECTION),h.glLoadMatrixf(r),h.glMatrixMode(f.MODELVIEW),h.glLoadMatrixf(t),this.interpreterProxy.pop(e),0))},primitiveSetLights:function(e){if(2!==e)return!1;if(!this.currentFromStack(1))return!1;var t=this.interpreterProxy.stackObjectValue(0);if(this.interpreterProxy.failed())return!1;if(!this.b3dxDisableLights(c))return!1;if(!t)return!1;for(var r=t.pointersSize(),i=0;i<r;i++){var s=this.fetchLightSource(i,t);if(!this.b3dxLoadLight(c,i,s))return!1}return this.interpreterProxy.pop(e),!0},primitiveSetMaterial:function(e){return 2===e&&!!this.currentFromStack(1)&&(this.stackMaterialValue(0)?this.vm.warnOnce("B3DAccel: primitiveSetMaterial not fully implemented"):(h.glMaterialfv(f.FRONT,f.AMBIENT,[.2,.2,.2,1]),h.glMaterialfv(f.FRONT,f.DIFFUSE,[.8,.8,.8,1]),h.glMaterialfv(f.FRONT,f.SPECULAR,[0,0,0,1]),h.glMaterialfv(f.FRONT,f.EMISSION,[0,0,0,1]),h.glMaterialf(f.FRONT,f.SHININESS,0),h.glDisable(f.TEXTURE_2D)),this.interpreterProxy.pop(e),!0)},primitiveSwapRendererBuffers:function(e){return 1===e&&!!this.currentFromStack(0)&&(this.interpreterProxy.vm.breakNow(),this.primHandler.display.lastTick=this.vm.lastTick,this.interpreterProxy.pop(e),!0)},primitiveTextureDepth:function(e){return 2===e&&!!this.currentFromStack(1)&&this.primHandler.popNandPushIfOK(e+1,32)},primitiveTextureGetColorMasks:function(e){if(3!==e)return!1;if(!this.currentFromStack(2))return!1;this.interpreterProxy.stackIntegerValue(1);var t=this.interpreterProxy.stackObjectValue(0);if(4!==t.pointersSize())return!1;for(var r=[16711680,65280,255,4278190080],i=0;i<4;i++)t.pointers[i]=this.interpreterProxy.positive32BitIntegerFor(r[i]);return this.interpreterProxy.pop(e),!0},primitiveTextureByteSex:function(e){return 2===e&&!!this.currentFromStack(1)&&this.primHandler.popNandPushIfOK(e+1,0)},primitiveTextureSurfaceHandle:function(e){return!1},primitiveTextureUpload:function(e){var t,r,i,s,n,a;return 3===e&&!(!this.currentFromStack(2)||(t=this.interpreterProxy.stackIntegerValue(1),(n=this.interpreterProxy.stackObjectValue(0)).pointersSize()<4)||(r=n.pointers[Squeak.Form_bits].words,i=n.pointers[Squeak.Form_width],s=n.pointers[Squeak.Form_height],a=32/(n=n.pointers[Squeak.Form_depth]),!r)||r.length!==(i+a-1)/a*s||!this.b3dxUploadTexture(t,i,s,n,r)||(this.interpreterProxy.pop(e),0))},b3dxCompositeTexture:function(e,t,r,i,s,n){if(!h.glIsTexture(e))return!1;h.glMatrixMode(f.MODELVIEW),h.glPushMatrix(),h.glLoadIdentity(),h.glMatrixMode(f.PROJECTION),h.glPushMatrix(),h.glLoadIdentity();var a=c.viewport.w,o=c.viewport.h;return h.glViewport(0,0,a,o),h.glScaled(2/a,-2/o,1),h.glTranslated(-.5*a,-.5*o,0),h.glEnable(f.TEXTURE_2D),h.glDisable(f.LIGHTING),h.glDisable(f.DEPTH_TEST),h.glDisable(f.BLEND),h.glDisable(f.CULL_FACE),h.glDepthMask(f.FALSE),h.glColor4d(1,1,1,1),n&&(h.glEnable(f.BLEND),h.glBlendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA)),t-=c.viewport.x,r-=c.viewport.y,h.glBindTexture(f.TEXTURE_2D,e),h.glBegin(f.QUADS),h.glTexCoord2d(0,0),h.glVertex2i(t,r),h.glTexCoord2d(1,0),h.glVertex2i(t+i,r),h.glTexCoord2d(1,1),h.glVertex2i(t+i,r+s),h.glTexCoord2d(0,1),h.glVertex2i(t,r+s),h.glEnd(),h.glDepthMask(f.TRUE),h.glEnable(f.DEPTH_TEST),h.glEnable(f.CULL_FACE),h.glDisable(f.BLEND),h.glDisable(f.TEXTURE_2D),h.glPopMatrix(),h.glMatrixMode(f.MODELVIEW),h.glPopMatrix(),!0},adjustCanvas:function(e){var t=e.canvas,r=this.primHandler.display.css,i=e.viewport.x,s=e.viewport.y,n=e.viewport.w,a=e.viewport.h,t=(t.width=n,t.height=a,t.style.left=r.left+i*r.scale+"px",t.style.top=r.top+s*r.scale+"px",t.style.width=n*r.scale+"px",t.style.height=a*r.scale+"px",e.warning);t&&(t.style.left=r.left+i*r.scale+"px",t.style.top=r.top+s*r.scale+"px",t.style.width=n*r.scale+"px",t.style.height=a*r.scale+"px")},b3dxSetViewport:function(e,t,r,i,s){e.viewport={x:t,y:r,w:i,h:s},this.adjustCanvas(e)},b3dxDisableLights:function(e){h.glDisable(f.LIGHTING);for(var t=0;t<8;t++)h.glDisable(f.LIGHT0+t);return!0},b3dxLoadLight:function(e,t,r){return!0},b3dxGetIntProperty:function(e,t){return 0},b3dxUploadTexture:function(e,t,r,i,s){return!!h.glIsTexture(e)&&(h.glBindTexture(f.TEXTURE_2D,e),h.glTexSubImage2D(f.TEXTURE_2D,0,0,0,t,r,f.RGBA,f.UNSIGNED_BYTE,s.buffer),!0)},fetchLightSource:function(e,t){t=t.pointers[e];return t||null},stackMatrix:function(e){e=this.interpreterProxy.stackObjectValue(e);return e.words&&16===e.words.length?e.wordsAsFloat32Array():null},stackMaterialValue:function(e){e=this.interpreterProxy.stackObjectValue(e);return e.words?e.wordsAsFloat32Array():null}}}function registerB3DAcceleratorPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("B3DAcceleratorPlugin",B3DAcceleratorPlugin()):self.setTimeout(registerB3DAcceleratorPlugin,100)}function CroquetPlugin(){return{getModuleName:function(){return"CroquetPlugin"},interpreterProxy:null,setInterpreter:function(e){return this.interpreterProxy=e,!0},primitiveGatherEntropy:function(e){var t=this.interpreterProxy.stackObjectValue(0);return this.interpreterProxy.failed()?null:t.isBytes()?(window.crypto.getRandomValues(t.bytes),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.trueObject()),!0):this.interpreterProxy.primitiveFail()}}}function registerCroquetPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("CroquetPlugin",CroquetPlugin()):self.setTimeout(registerCroquetPlugin,100)}function MIDIPlugin(){let r=midiParameterConstants();return{debug:!1,vmProxy:null,vm:null,prims:null,timeOffset:0,midi:null,midiPromise:null,ports:new Map,getModuleName(){return"MIDIPlugin (SqueakJS)"},setInterpreter(e){return this.vmProxy=e,this.vm=e.vm,this.prims=e.vm.primHandler,!0},initialiseModule(){this.debug=this.vm.options.debugMIDI,navigator.requestMIDIAccess?(this.midiPromise||(this.midiPromise=navigator.requestMIDIAccess({software:!0,sysex:!1}).then(e=>{this.midi=e,this.initMIDI(e)}).catch(e=>{console.error("MIDIPlugin: "+e),this.midi=!1})),performance.timeOrigin&&(this.timeOffset=performance.timeOrigin-this.vm.startupTime)):(console.log("MIDIPlugin: WebMIDI not supported"),this.vmProxy.success(!1))},initMIDI(e){var t,r,i;for(t of[...e.inputs.values(),...e.outputs.values()])this.portChanged(t);e.onstatechange=e=>{e=e.port;let{name:t,manufacturer:r,state:i}=e;r&&!t.includes(r)&&(t+=` (${r})`);var s=this.portChanged(e),n=!e.sqPort;n&&(e.sqPort=s),(n||"disconnected"===i||this.debug)&&console.log(`MIDIPlugin: ${t} ${i} (port ${s.handle} ${e.type} ${e.connection})`)},console.log(`MIDIPlugin: WebMIDI initialized (ports: ${this.ports.size})`);for([r,i]of this.ports){var s=3===i.dir?"in+out":2===i.dir?"out":"in",n=[];i.input&&n.push(i.input.name),i.output&&n.push(i.output.name),console.log(`MIDIPlugin: port ${r} ${s} (${n.join(", ")})`)}},portChanged(e){let{name:t,manufacturer:r}=e;t=t.replace(/(\b(in|out)(put)?\b)/i,"").replace(/(\(\)|\[\])/,"").replace(/  /," ").trim(),r&&!t.includes(r)&&(t+=` (${r})`);let i;for(var s of this.ports.values())if(s.name===t){i=s;break}var n;return i||(n=this.ports.size,i={handle:n,name:t,dir:0,input:null,output:null,runningStatus:0,receivedMessages:[]},this.ports.set(n,i)),"connected"===e.state?(i[e.type]=e,i.dir|="input"===e.type?1:2):(i[e.type]=null,i.dir&="input"===e.type?-2:-3),i},primitiveMIDIGetPortCount(e){let t=()=>this.vm.popNandPush(e+1,this.ports.size);var r;return null===this.midi?(r=this.vm.freeze(),this.midiPromise.then(t).catch(e=>{console.error("MIDIPlugin: "+e),t()}).finally(r)):t(),!0},primitiveMIDIGetPortName(e){if(!this.midi)return!1;var t=this.prims.stackInteger(0),t=this.ports.get(t);if(!t)return!1;let r=t.name;return 0===t.dir&&(r+=" [disconnected]"),this.prims.popNandPushIfOK(e+1,this.prims.makeStString(r))},primitiveMIDIGetPortDirectionality(e){var t;return!!this.midi&&(t=this.prims.stackInteger(0),!!(t=this.ports.get(t)))&&this.prims.popNandPushIfOK(e+1,t.dir)},primitiveMIDIGetClock(e){var t;return!!this.midi&&(t=this.prims.millisecondClockValue(),this.prims.popNandPushIfOK(e+1,t))},primitiveMIDIParameterGetOrSet(e){if(!this.midi)return!1;let t;switch(this.prims.stackInteger(e-1)){case r.Installed:case r.Version:t=1;break;case r.HasBuffer:case r.HasDurs:case r.CanSetClock:case r.CanUseSemaphore:case r.EchoOn:case r.UseControllerCache:case r.EventsAvailable:case r.FlushDriver:t=0;break;case r.ClockTicksPerSec:t=1e3;break;case r.HasInputClock:t=1;break;default:return!1}return this.prims.popNandPushIfOK(e+1,t)},primitiveMIDIOpenPort(e){let r=this.prims.stackInteger(2),i,t=()=>{(i=this.ports.get(r))?i.dir||(console.error(`MIDIPlugin: port ${r} ${i.name} is disconnected`),i=null):console.error("MIDIPlugin: invalid port "+r)},s=e=>{var t=[];i.input&&("closed"===i.input.connection?t.push(i.input.open()):console.warn(`MIDIPlugin: input port ${r} is `+i.input.connection)),i.output&&("closed"===i.output.connection?t.push(i.output.open()):console.warn(`MIDIPlugin: output port ${r} is `+i.output.connection)),i.runningStatus=0,i.receivedMessages=[],Promise.all(t).then(()=>{i.input&&(i.input.onmidimessage=e=>{var t=Math.round(e.timeStamp+this.timeOffset),e=new Uint8Array(e.data);i.receivedMessages.push({time:t,bytes:e}),this.debug&&console.log("MIDIPlugin: received",t,[...e])})}).catch(e=>console.error("MIDIPlugin: "+e)).finally(e)};if(this.midi&&(t(),!i))return!1;let n=this.vm.freeze();return this.midiPromise.then(()=>{i||t(),i?s(n):n()}),this.prims.popNIfOK(e)},primitiveMIDIClosePort(e){if(this.midi){var t=this.prims.stackInteger(0),t=this.ports.get(t);if(!t)return!1;var r=[];t.input&&"open"===t.input.connection&&(r.push(t.input.close()),t.input.onmidimessage=null,t.receivedMessages.length=0),t.output&&"open"===t.output.connection&&r.push(t.output.close()),r.length&&(t=this.vm.freeze(),Promise.all(r).catch(e=>console.error("MIDIPlugin: "+e)).finally(t))}return this.prims.popNIfOK(e)},primitiveMIDIWrite(e){if(!this.midi)return!1;var t=this.prims.stackInteger(2);let r=this.prims.stackNonInteger(1).bytes;var i=this.prims.stackInteger(0),s=this.ports.get(t);if(!s||!s.output||!r)return!1;if("open"!==s.output.connection)return console.error("MIDIPlugin: primitiveMIDIWrite error (port not open)"),this.prims.popNandPushIfOK(e+1,0);if(r[0]<128){if(0===s.runningStatus)return console.error("MIDIPlugin: no running status byte"),!1;t=new Uint8Array(r.length+1);t[0]=s.runningStatus,t.set(r,1),r=t}try{this.debug&&console.log("MIDIPlugin: send",[...r],i),0===i?s.output.send(r):s.output.send(r,i);for(let e=r.length-1;0<=e;e--)if(128<=r[e]&&r[e]<=247){s.runningStatus=r[e]<240?r[e]:0;break}}catch(e){return console.error("MIDIPlugin: "+e),!1}return this.prims.popNandPushIfOK(e+1,r.length)},primitiveMIDIRead(e){if(!this.midi)return!1;var t=this.prims.stackInteger(1),r=this.prims.stackNonInteger(0).bytes,t=this.ports.get(t);if(!t||!t.input||"open"!==t.input.connection)return!1;let i=0;var s,t=t.receivedMessages.shift();return t&&({time:t,bytes:s}=t,r[0]=t>>24&255,r[1]=t>>16&255,r[2]=t>>8&255,r[3]=255&t,r.set(s,4),i=s.length+4,this.debug)&&console.log("MIDIPlugin: read",i,[...r.subarray(0,i)]),this.prims.popNandPushIfOK(e+1,i)}}}function midiParameterConstants(){return{Installed:1,Version:2,HasBuffer:3,HasDurs:4,CanSetClock:5,CanUseSemaphore:6,EchoOn:7,UseControllerCache:8,EventsAvailable:9,FlushDriver:10,ClockTicksPerSec:11,HasInputClock:12}}function registerMIDIPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("MIDIPlugin",MIDIPlugin()):self.setTimeout(registerMIDIPlugin,100)}function SocketPlugin(){return{getModuleName:function(){return"SocketPlugin (http-only)"},interpreterProxy:null,primHandler:null,handleCounter:0,needProxy:new Set,status:0,lookupCache:{localhost:{address:[127,0,0,1],validUntil:Number.MAX_SAFE_INTEGER}},lastLookup:null,lookupSemaIdx:0,TCP_Socket_Type:0,Resolver_Uninitialized:0,Resolver_Ready:1,Resolver_Busy:2,Resolver_Error:3,Socket_InvalidSocket:-1,Socket_Unconnected:0,Socket_WaitingForConnection:1,Socket_Connected:2,Socket_OtherEndClosed:3,Socket_ThisEndClosed:4,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},_signalSemaphore:function(e){e<=0||this.primHandler.signalSemaphoreWithIndex(e)},_signalLookupSemaphore:function(){this._signalSemaphore(this.lookupSemaIdx)},_getAddressFromLookupCache:function(e,t){if(e){if(e.match(/^\d+\.\d+\.\d+\.\d+$/)){var r=e.split(".").map(function(e){return+e});if(r.every(function(e){return e<=255}))return new Uint8Array(r)}r=this.lookupCache[e];if(r&&(t||r.validUntil>=Date.now()))return new Uint8Array(r.address)}return null},_addAddressFromResponseToLookupCache:function(e){var t,r,i,s,n;e&&0===e.Status&&e.Question&&e.Answer&&(r=e.Question[0],(t=function(e,t){e[t]&&e[t].replace&&(e[t]=e[t].replace(/\.$/,""))})(r,"name"),e.Answer.forEach(function(e){t(e,"name"),t(e,"data")}),i=r.name,s=null,n=86400,e.Answer.some(function(e){if(e.name===i){if(e.TTL&&(n=Math.min(n,e.TTL)),1===e.type)return s=e.data.split(".").map(function(e){return+e}),!0;5===e.type&&(i=e.data)}return!1}))&&(this.lookupCache[r.name]={address:s,validUntil:Date.now()+1e3*n})},_compareAddresses:function(e,r){return e.every(function(e,t){return r[t]===e})},_reverseLookupNameForAddress:function(t){var r=this,i=null;return Object.keys(this.lookupCache).some(function(e){return!!r._compareAddresses(t,r.lookupCache[e].address)&&(i=e,!0)}),i||t.join(".")},_newSocketHandle:function(e,t,r,i){var l=this;return{hostAddress:null,host:null,port:null,connSemaIndex:t,readSemaIndex:r,writeSemaIndex:i,webSocket:null,sendBuffer:null,sendTimeout:null,response:null,responseReadUntil:0,responseReceived:!1,status:l.Socket_Unconnected,_signalConnSemaphore:function(){l._signalSemaphore(this.connSemaIndex)},_signalReadSemaphore:function(){l._signalSemaphore(this.readSemaIndex)},_signalWriteSemaphore:function(){l._signalSemaphore(this.writeSemaIndex)},_otherEndClosed:function(){this.status=l.Socket_OtherEndClosed,this.webSocket=null,this._signalConnSemaphore()},_hostAndPort:function(){return this.host+":"+this.port},_requestNeedsProxy:function(){return l.needProxy.has(this._hostAndPort())},_getURL:function(e,t){var r="";return(t||this._requestNeedsProxy())&&(r="object"==typeof SqueakJS&&SqueakJS.options.proxy||Squeak.defaultCORSProxy),443!==this.port?r+="http://"+this._hostAndPort()+e:r+="https://"+this.host+e,r},_performRequest:function(){if(this.webSocket)this._performWebSocketSend();else{var e=new TextDecoder("utf-8").decode(this.sendBuffer),t=this.sendBuffer.findIndex(function(e,t,r){return"\r"===r[t]&&"\r"===r[t+2]&&"\n"===r[t+1]&&"\n"===r[t+3]}),r=(this.sendBuffer=0<=t?this.sendBuffer.subarray(t+4):null,e.split("\r\n\r\n")[0].split("\n")),t=r[0].split(" "),e=t[0];if("GET"!==e&&"PUT"!==e&&"POST"!==e)return this._otherEndClosed(),-1;for(var t=t[1],i=!1,s=!1,n=null,a=1;a<r.length;a++){var o,u,l,c=r[a];c.match(/Content-Length:/i)?(o=parseInt(c.substr(16)),u=this.sendBuffer.byteLength,n=this.sendBuffer.subarray(u-o,u)):c.match(/Host:/i)&&(u=(o=c.substr(6).trim()).split(":")[0],l=parseInt(o.split(":")[1])||this.port,this.host!==u&&(console.warn("Host for "+this.hostAddress+" was "+this.host+" but from HTTP request now "+u),this.host=u),this.port!==l)&&(console.warn("Port for "+this.hostAddress+" was "+this.port+" but from HTTP request now "+l),this.port=l),c.match(/Connection: Upgrade/i)?i=!0:c.match(/Upgrade: WebSocket/i)&&(s=!0)}"GET"===e&&i&&s?this._performWebSocketRequest(t,e,n,r):self.fetch?this._performFetchAPIRequest(t,e,n,r):this._performXMLHTTPRequest(t,e,n,r)}},_performFetchAPIRequest:function(r,i,s,n){for(var a=this,e={},t=1;t<n.length;t++){var o=n[t].split(":");2===o.length&&(e[o[0]]=o[1].trim())}"object"==typeof SqueakJS&&SqueakJS.options.ajax&&(e["X-Requested-With"]="XMLHttpRequest");var u={method:i,headers:e,body:s,mode:"cors"};fetch(this._getURL(r),u).then(a._handleFetchAPIResponse.bind(a)).catch(function(e){var t=a._getURL(r,!0);console.warn("Retrying with CORS proxy: "+t),fetch(t,u).then(function(e){console.log("Success: "+t),a._handleFetchAPIResponse(e),l.needProxy.add(a._hostAndPort())}).catch(function(e){console.warn("Fetch API failed, retrying with XMLHttpRequest"),a._performXMLHTTPRequest(r,i,s,n)})})},_handleFetchAPIResponse:function(e){var i;null===this.response&&(i=["HTTP/1.0 ",e.status," ",e.statusText,"\r\n"],e.headers.forEach(function(e,t,r){i=i.concat([t,": ",e,"\r\n"])}),i.push("\r\n"),this.response=[new TextEncoder("utf-8").encode(i.join(""))]),this._readIncremental(e.body.getReader())},_readIncremental:function(t){var r=this;return t.read().then(function(e){if(!e.done)return r.response.push(e.value),r._signalReadSemaphore(),r._readIncremental(t);r.responseReceived=!0})},_performXMLHTTPRequest:function(i,s,n,e){for(var t,a=this,r=1;r<e.length;r++){var o=e[r];if(o.match(/Content-Type:/i)){t=encodeURIComponent(o.substr(14));break}}var u=new XMLHttpRequest;u.open(s,this._getURL(i)),void 0!==t&&u.setRequestHeader("Content-type",t),"object"==typeof SqueakJS&&SqueakJS.options.ajax&&u.setRequestHeader("X-Requested-With","XMLHttpRequest"),u.responseType="arraybuffer",u.onload=function(e){a._handleXMLHTTPResponse(this)},u.onerror=function(e){var t=a._getURL(i,!0),r=(console.warn("Retrying with CORS proxy: "+t),new XMLHttpRequest);r.open(s,t),r.responseType=u.responseType,"object"==typeof SqueakJS&&SqueakJS.options.ajaxx&&r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onload=function(e){console.log("Success: "+t),a._handleXMLHTTPResponse(this),l.needProxy.add(a._hostAndPort())},r.onerror=function(){a._otherEndClosed(),console.error("Failed to download:\n"+t)},r.send(n)},u.send(n)},_handleXMLHTTPResponse:function(e){this.responseReceived=!0;var t,r=e.response;r?(e=new TextEncoder("utf-8").encode("HTTP/1.0 "+e.status+" "+e.statusText+"\r\n"+e.getAllResponseHeaders()+"\r\n"),(t=new Uint8Array(e.byteLength+r.byteLength)).set(e,0),t.set(new Uint8Array(r),e.byteLength),this.response=[t],this._signalReadSemaphore()):this._otherEndClosed()},_performWebSocketRequest:function(e,t,r,i){for(var s,n,e=this._getURL(e),a=1;a<i.length;a++){var o=i[a].split(":");if("Sec-WebSocket-Protocol"===o[0]){if(s=o[1].trim(),n)break}else if("Sec-WebSocket-Key"===o[0]&&(n=o[1].trim(),s))break}this.webSocket=new WebSocket(e.replace(/^http/,"ws"),s);var u=this;this.webSocket.onopen=function(){u.status!==l.Socket_Connected&&(u.status=l.Socket_Connected,u._signalConnSemaphore(),u._signalWriteSemaphore());var e=new Uint8Array(sha1.array(n+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11")),e=Squeak.bytesAsString(e);u._performWebSocketReceive("HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+btoa(e)+"\r\n\r\n",!0)},this.webSocket.onmessage=function(e){u._performWebSocketReceive(e.data)},this.webSocket.onerror=function(e){u._otherEndClosed(),console.error("Error in WebSocket:",e)},this.webSocket.onclose=function(){u._otherEndClosed()}},_performWebSocketReceive:function(e,t){var r,i=!e.substr;i||(e=new TextEncoder("utf-8").encode(e)),t||(t=2+e.length+4,r=e.byteLength<126?e.length:e.byteLength<65535?(t+=2,126):(t+=8,127),(t=new Uint8Array(t))[0]=i?130:129,t[1]=128|r,i=126===r?(t[2]=e.length>>>8,t[3]=255&e.length,4):127===r?(t[2]=e.length>>>56,t[3]=e.length>>>48&255,t[4]=e.length>>>40&255,t[5]=e.length>>>32&255,t[6]=e.length>>>24&255,t[7]=e.length>>>16&255,t[8]=e.length>>>8&255,t[9]=255&e.length,10):2,r=new Uint8Array(4),t.set(r,i),r=e,t.set(r,i+=4),e=t),this.response&&this.response.length?this.response.push(e):this.response=[e],this.responseReceived=!0,this._signalReadSemaphore()},_performWebSocketSend:function(){var e,t=15&this.sendBuffer[0];if(0==t)return console.error("No support for WebSocket frame continuation yet!"),!0;if(1==t)e=!1;else{if(2!=t)return 8==t?(this.webSocket.close(),void(this.webSocket=null)):9==t||10==t?void 0:void console.error("Unsupported WebSocket frame opcode "+t);e=!0}var r,t=this.sendBuffer[1],i=t>>>7,t=127&t,s=126===t?(t=this.sendBuffer[2]<<8|this.sendBuffer[3],4):127===t?(t=this.sendBuffer[2]<<56|this.sendBuffer[3]<<48|this.sendBuffer[4]<<40|this.sendBuffer[5]<<32|this.sendBuffer[6]<<24|this.sendBuffer[7]<<16|this.sendBuffer[8]<<8|this.sendBuffer[9],10):2,n=(i&&(r=this.sendBuffer.subarray(s,s+4),s+=4),this.sendBuffer.subarray(s,s+t));s+=t,i&&(n=n.map(function(e,t){return e^r[3&t]})),t=e?n:Squeak.bytesAsString(n),this.sendBuffer=this.sendBuffer.subarray(s),this.webSocket.send(t),0<this.sendBuffer.byteLength&&this._performWebSocketSend()},connect:function(e,t){this.hostAddress=e,this.host=l._reverseLookupNameForAddress(e),this.port=t,this.status=l.Socket_Connected,this._signalConnSemaphore(),this._signalWriteSemaphore()},close:function(){this.status!=l.Socket_Connected&&this.status!=l.Socket_OtherEndClosed&&this.status!=l.Socket_WaitingForConnection||(this.webSocket&&(this.webSocket.close(),this.webSocket=null),this.status=l.Socket_Unconnected,this._signalConnSemaphore())},destroy:function(){this.status=l.Socket_InvalidSocket},dataAvailable:function(){if(this.status!=l.Socket_InvalidSocket&&this.status==l.Socket_Connected){if(this.webSocket)return this.response&&0<this.response.length;if(this.response&&0<this.response.length)return this._signalReadSemaphore(),!0;this.responseSentCompletly&&(this.status=l.Socket_OtherEndClosed,this._signalConnSemaphore())}return!1},recv:function(e){var t,r;return null===this.response?[]:((t=this.response[0]||new Uint8Array(0)).length>e?((r=t.subarray(e))?this.response[0]=r:this.response.shift(),t=t.subarray(0,e)):this.response.shift(),this.responseReceived&&0===this.response.length&&!this.webSocket&&(this.responseSentCompletly=!0),t)},send:function(e,t,r){null!==this.sendTimeout&&self.clearTimeout(this.sendTimeout),this.lastSend=Date.now();e=e.bytes.subarray(t,r);return null===this.sendBuffer?this.sendBuffer=e.slice():(t=this.sendBuffer.byteLength+e.byteLength,(r=new Uint8Array(t)).set(this.sendBuffer,0),r.set(e,this.sendBuffer.byteLength),this.sendBuffer=r),this.sendTimeout=self.setTimeout(this._performRequest.bind(this),50),e.byteLength}}},primitiveHasSocketAccess:function(e){return this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.trueObject()),!0},primitiveInitializeNetwork:function(e){return 1===e&&(this.lookupSemaIdx=this.interpreterProxy.stackIntegerValue(0),this.status=this.Resolver_Ready,this.interpreterProxy.pop(e),!0)},primitiveResolverNameLookupResult:function(e){var t;return 0===e&&(this.lastLookup&&this.lastLookup.substr?(t=this._getAddressFromLookupCache(this.lastLookup,!0),this.interpreterProxy.popthenPush(e+1,t?this.primHandler.makeStByteArray(t):this.interpreterProxy.nilObject())):this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveResolverStartNameLookup:function(e){var t,r,i,s,n;return 1===e&&(t=this.lastLookup=this.interpreterProxy.stackValue(0).bytesAsString(),this._getAddressFromLookupCache(t,!1)?(this.status=this.Resolver_Ready,this._signalLookupSemaphore()):(r="https://9.9.9.9:5053/dns-query?name="+encodeURIComponent(this.lastLookup)+"&type=A",self.fetch?(i=this,self.fetch(r,{method:"GET",mode:"cors",credentials:"omit",cache:"no-store",referrer:"no-referrer",referrerPolicy:"no-referrer"}).then(function(e){return e.json()}).then(function(e){i._addAddressFromResponseToLookupCache(e)}).catch(function(e){console.error("Name lookup failed",e)}).then(function(){t===i.lastLookup&&(i.status=i.Resolver_Ready,i._signalLookupSemaphore())})):(i=this,s=function(){t===i.lastLookup&&(i.status=i.Resolver_Ready,i._signalLookupSemaphore())},(n=new XMLHttpRequest).open("GET",r,!0),n.timeout=2e3,n.responseType="json",n.onload=function(e){i._addAddressFromResponseToLookupCache(this.response),s()},n.onerror=function(){console.error("Name lookup failed",n.statusText),s()},n.send()),!0&&(this.status=this.Resolver_Busy,this._signalLookupSemaphore())),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveResolverAddressLookupResult:function(e){var t;return 0===e&&(this.lastLookup&&this.lastLookup.every?(t=this._reverseLookupNameForAddress(this.lastLookup),t=this.primHandler.makeStString(t),this.interpreterProxy.popthenPush(e+1,t)):this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveResolverStartAddressLookup:function(e){return 1===e&&(this.lastLookup=this.interpreterProxy.stackBytes(0),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),this.status=this.Resolver_Ready,this._signalLookupSemaphore(),!0)},primitiveResolverStatus:function(e){return 0===e&&(this.interpreterProxy.popthenPush(e+1,this.status),!0)},primitiveResolverAbortLookup:function(e){return 0===e&&(this.lastLookup=null,this.status=this.Resolver_Ready,this._signalLookupSemaphore(),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveSocketRemoteAddress:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(this.interpreterProxy.popthenPush(e+1,t.hostAddress?this.primHandler.makeStByteArray(t.hostAddress):this.interpreterProxy.nilObject()),!0)},primitiveSocketRemotePort:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(this.interpreterProxy.popthenPush(e+1,t.port),!0)},primitiveSocketConnectionStatus:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(void 0===(t=t.status)&&(t=this.Socket_InvalidSocket),this.interpreterProxy.popthenPush(e+1,t),!0)},primitiveSocketConnectToPort:function(e){var t,r,i;return 3===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(2).handle)&&(r=this.interpreterProxy.stackBytes(1),i=this.interpreterProxy.stackIntegerValue(0),t.connect(r,i),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveSocketCloseConnection:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(t.close(),this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),!0)},primitiveSocketCreate3Semaphores:function(e){var t,r,i,s,n;return 7===e&&(t=this.interpreterProxy.stackIntegerValue(0),r=this.interpreterProxy.stackIntegerValue(1),i=this.interpreterProxy.stackIntegerValue(2),s=this.interpreterProxy.stackIntegerValue(3),this.interpreterProxy.stackIntegerValue(5)===this.TCP_Socket_Type)&&(n="{SqueakJS Socket #"+ ++this.handleCounter+"}",(n=this.primHandler.makeStString(n)).handle=this._newSocketHandle(s,i,r,t),this.interpreterProxy.popthenPush(e+1,n),!0)},primitiveSocketDestroy:function(e){var t;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(t.destroy(),this.interpreterProxy.popthenPush(e+1,t.status),!0)},primitiveSocketReceiveDataAvailable:function(e){var t,r;return 1===e&&void 0!==(t=this.interpreterProxy.stackObjectValue(0).handle)&&(r=this.interpreterProxy.falseObject(),t.dataAvailable()&&(r=this.interpreterProxy.trueObject()),this.interpreterProxy.popthenPush(e+1,r),!0)},primitiveSocketReceiveDataBufCount:function(e){var t,r,i,s;return 4===e&&void 0!==(s=this.interpreterProxy.stackObjectValue(3).handle)&&(t=this.interpreterProxy.stackObjectValue(2),!((r=this.interpreterProxy.stackIntegerValue(1)-1)+(i=this.interpreterProxy.stackIntegerValue(0))>t.bytes.length||(s=s.recv(i),t.bytes.set(s,r),this.interpreterProxy.popthenPush(e+1,s.length),0)))},primitiveSocketSendDataBufCount:function(e){var t,r,i,s;return 4===e&&void 0!==(s=this.interpreterProxy.stackObjectValue(3).handle)&&(t=this.interpreterProxy.stackObjectValue(2),!((r=this.interpreterProxy.stackIntegerValue(1)-1)<0||(i=r+this.interpreterProxy.stackIntegerValue(0))>t.length||(s=s.send(t,r,i),this.interpreterProxy.popthenPush(e+1,s),0)))},primitiveSocketSendDone:function(e){return 1===e&&(this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.trueObject()),!0)},primitiveSocketListenWithOrWithoutBacklog:function(e){return!(e<2||(this.interpreterProxy.popthenPush(e+1,this.interpreterProxy.nilObject()),0))}}}function registerSocketPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SocketPlugin",SocketPlugin()):self.setTimeout(registerSocketPlugin,100)}function SpeechPlugin(){return{getModuleName:function(){return"SpeechPlugin"},interpreterProxy:null,primHandler:null,voiceInput:null,semaphoreIndex:null,shouldListen:!1,recognition:null,synth:self.speechSynthesis,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},primitiveSpeak:function(e){if(1===e)t=this.interpreterProxy.stackValue(0).bytesAsString();else{if(2!==e)return!1;var t=this.interpreterProxy.stackValue(1).bytesAsString(),r=this.interpreterProxy.stackValue(0).bytesAsString(),i=this.synth.getVoices().filter(function(e){return e.name===r})}t=new SpeechSynthesisUtterance(t);return i&&0<i.length&&(t.voice=i[0]),this.synth.speak(t),this.interpreterProxy.pop(e),!0},primitiveRegisterSemaphore:function(e){return 1===e&&(this.semaphoreIndex=this.interpreterProxy.stackIntegerValue(0),this.interpreterProxy.pop(e),!0)},primitiveUnregisterSemaphore:function(e){return 0===e&&!(this.semaphoreIndex=null)},primitiveGetLastRecognitionResult:function(e){return 0===e&&null!==this.semaphoreIndex&&null!==this.voiceInput&&(e=this.primHandler.makeStArray(this.voiceInput),this.voiceInput=[],this.interpreterProxy.popthenPush(1,e),!0)},primitiveStartListening:function(e){return 0===e&&(this.recognition=new webkitSpeechRecognition,this.recognition.lang="en-US",this.recognition.interimResults=!0,this.recognition.onresult=this._onRecognitionResult.bind(this),this.recognition.onerror=function(e){console.log(e)},this.recognition.onend=function(e){this.shouldListen&&this.recognition.start()}.bind(this),this.shouldListen=!0,this.recognition.start(),!0)},_onRecognitionResult:function(e){this.voiceInput=[];for(var t=e.resultIndex;t<e.results.length;t++){for(var r=e.results[t],i=[r.isFinal,[]],s=0;s<r.length;s++){var n=r[s].transcript;i[1].push([n,r[s].confidence])}0<i[1].length&&this.voiceInput.push(i)}null!==this.semaphoreIndex&&0<this.voiceInput.length&&this.primHandler.signalSemaphoreWithIndex(this.semaphoreIndex)},primitiveStopListening:function(e){return 0===e&&(this.voiceInput=[],this.recognition.stop(),!(this.shouldListen=!1))}}}function registerSpeechPlugin(){"object"==typeof Squeak&&Squeak.registerExternalModule?"webkitSpeechRecognition"in self?Squeak.registerExternalModule("SpeechPlugin",SpeechPlugin()):console.warn("SpeechPlugin: Web Speech API is not supported by this browser."):self.setTimeout(registerSpeechPlugin,100)}function SqueakSSL(){return{getModuleName:function(){return"SqueakSSL (fake)"},interpreterProxy:null,primHandler:null,handleCounter:0,SQSSL_OK:0,SQSSL_NEED_MORE_DATA:-1,SQSSL_INVALID_STATE:-2,SQSSL_BUFFER_TOO_SMALL:-3,SQSSL_INPUT_TOO_LARGE:-4,SQSSL_GENERIC_ERROR:-5,SQSSL_OUT_OF_MEMORY:-6,SQSSL_PROP_VERSION:0,SQSSL_PROP_LOGLEVEL:1,SQSSL_PROP_SSLSTATE:2,SQSSL_PROP_CERTSTATE:3,SQSSL_PROP_PEERNAME:0,SQSSL_PROP_CERTNAME:1,SQSSL_PROP_SERVERNAME:2,setInterpreter:function(e){return this.interpreterProxy=e,this.primHandler=this.interpreterProxy.vm.primHandler,!0},primitiveCreate:function(e){var t="{SqueakJS SSL #"+ ++this.handleCounter+"}",t=this.primHandler.makeStString(t);return t.handle=!0,this.interpreterProxy.popthenPush(e+1,t),!0},primitiveConnect:function(e){return 5===e&&(this.interpreterProxy.popthenPush(e+1,0),!0)},primitiveDestroy:function(e){return 1===e&&(this.interpreterProxy.popthenPush(e+1,1),!0)},primitiveGetIntProperty:function(e){var t;return 2===e&&void 0!==this.interpreterProxy.stackObjectValue(1).handle&&(t=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_CERTSTATE?this.SQSSL_OK:0,this.interpreterProxy.popthenPush(e+1,t),!0)},primitiveSetStringProperty:function(e){return 3===e&&void 0!==this.interpreterProxy.stackObjectValue(2).handle&&(this.interpreterProxy.pop(e),!0)},primitiveGetStringProperty:function(e){var t;return 2===e&&void 0!==this.interpreterProxy.stackObjectValue(1).handle&&(t=this.interpreterProxy.stackIntegerValue(0)===this.SQSSL_PROP_PEERNAME?this.primHandler.makeStString("*"):this.interpreterProxy.nilObject(),this.interpreterProxy.popthenPush(e+1,t),!0)},primitiveEncrypt:function(e){var t,r;return 5===e&&void 0!==this.interpreterProxy.stackObjectValue(4).handle&&(t=this.interpreterProxy.stackObjectValue(3),this.interpreterProxy.stackIntegerValue(2),r=this.interpreterProxy.stackIntegerValue(1),this.interpreterProxy.stackObjectValue(0).bytes=t.bytes,this.interpreterProxy.popthenPush(e+1,r),!0)},primitiveDecrypt:function(e){var t,r;return 5===e&&void 0!==this.interpreterProxy.stackObjectValue(4).handle&&(t=this.interpreterProxy.stackObjectValue(3),this.interpreterProxy.stackIntegerValue(2),r=this.interpreterProxy.stackIntegerValue(1),this.interpreterProxy.stackObjectValue(0).bytes=t.bytes,this.interpreterProxy.popthenPush(e+1,r),!0)}}}function registerSqueakSSL(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SqueakSSL",SqueakSSL()):self.setTimeout(registerSqueakSSL,100)}function libc(){return{getModuleName(){return"libc (SqueakJS)"},setInterpreter(e){return this.vm=e.vm,!0},bytesToString(e){var t=e.indexOf(0);return 0<=t&&(e=e.subarray(0,t)),String.fromCharCode.apply(null,e)},stringToBytes(t,r){for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r[t.length]=0,r},getenv(e){switch(e=this.bytesToString(e)){case"USER":return this.vm.options.user||"squeak";case"HOME":return this.vm.options.root||"/"}return this.vm.warnOnce("UNIMPLEMENTED getenv: "+e),null},getcwd(e,t){var r=this.vm.options.root||"/";return e=e||new Uint8Array(r.length+1),t<r.length+1?0:(this.stringToBytes(r,e),e)}}}function registerLibC(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("libc",libc()):self.setTimeout(registerLibC,100)}var GL,GL_Symbols;function OpenGL(){var i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e=0,o=(e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,e++,8192+(1<<+e)),u=Math.floor(Math.log2(448))-2,l=1+(448>>u),c=l-1<<u;if(448!=c)throw Error("OpenGL: bad NUM_LIGHTS_MASK");var h=Math.floor(Math.log2(3584))-2,f=1+(3584>>h),p=f-1<<h;if(3584!=p)throw Error("OpenGL: bad NUM_CLIP_PLANES_MASK");var d=Math.floor(Math.log2(o))-1,m=1+(o>>d)-1<<d;if(m!=o)throw Error("OpenGL: bad ANY_FOG");var g,b;return{getModuleName:function(){return"libGL.so (SqueakJS)"},setInterpreter:function(e){return this.vm=e.vm,this.ffi=this.vm.primHandler,!0},ffiFunctionNotFoundHandler:function(e,t){return this.vm.warnOnce("OpenGL: UNIMPLEMENTED (missing) "+e),null},initialiseModule:function(){GL||initGLConstants();var e=SqueakJS.vm.primHandler.loadedModules.B3DAcceleratorPlugin;if(!e)throw Error("OpenGL: B3DAcceleratorPlugin not loaded");this.GL=GL,e.setOpenGL(this)},makeCurrent:function(e){b===e.webgl||(b=e.webgl,g=e.opengl)||(e.opengl=this.initGL())},initGL:function(){var e=b.getExtension("GMAN_debug_helper");e&&e.setConfiguration({throwOnError:!1}),"undefined"!=typeof SPECTOR&&((e=new SPECTOR.Spector).captureContext(b),e.displayUI()),(g={alphaTest:!1,alphaFunc:null,alphaRef:0,extensions:"GL_ARB_texture_non_power_of_two GL_SGIS_generate_mipmap GL_ARB_transpose_matrix",color:new Float32Array(4),normal:new Float32Array([0,0,1]),texCoord:new Float32Array(2),primitive:null,primitiveAttrs:0,clipPlanes:[],clientState:{},fogMode:GL.EXP,fogEnabled:!1,fogDensity:1,fogStart:0,fogEnd:1,fogColor:new Float32Array([0,0,0,0]),fogHint:GL.DONT_CARE,shaders:{},matrixMode:0,matrices:{},matrix:null,lightingEnabled:!1,lights:[],lightModelAmbient:null,material:null,textureIdGen:0,textures:{},texture:null,textureEnabled:!1,textureEnvMode:GL.MODULATE,listIdGen:0,lists:{},list:null,listMode:0,listBase:0,pixelStoreUnpackRowLength:0,pixelStoreUnpackSkipRows:0,pixelStoreUnpackSkipPixels:0,rasterPos:new Float32Array(4),rasterColor:new Float32Array([1,1,1,1]),bitmapTexture:null,bitmapVertexBuffer:null,bitmapShader:{program:null,locations:{}},vendor:"Codefrau",renderer:"SqueakJS",version:"1.0",viewport:new Int32Array([0,0,0,0]),depthRange:new Float32Array([0,1])}).matrices[GL.MODELVIEW]=[new Float32Array(i)],g.matrices[GL.PROJECTION]=[new Float32Array(i)],g.matrices[GL.TEXTURE]=[new Float32Array(i)],g.matrixMode=GL.MODELVIEW,g.matrix=g.matrices[g.matrixMode][0],g.color.set([1,1,1,1]);for(var t=0;t<f;t++)g.clipPlanes[t]={enabled:!1,equation:new Float32Array([0,0,0,0])};for(t=0;t<l;t++)g.lights[t]={enabled:!1,ambient:new Float32Array([0,0,0,1]),diffuse:new Float32Array(0===t?[1,1,1,1]:[0,0,0,1]),specular:new Float32Array(0===t?[1,1,1,1]:[0,0,0,1]),position:new Float32Array([0,0,1,0])};g.lightModelAmbient=new Float32Array([.2,.2,.2,1]),g.material={ambient:new Float32Array([.2,.2,.2,1]),diffuse:new Float32Array([.8,.8,.8,1]),specular:new Float32Array([0,0,0,1]),emission:new Float32Array([0,0,0,1]),shininess:0};for(var r=["vertexArray","normalArray","colorArray","textureCoordArray"],t=0;t<r.length;t++)g.clientState[r[t]]={enabled:!1,size:0,type:GL.FLOAT,stride:0,pointer:null};return g},destroyGL:function(e){e.opengl=null,g=b=null},addToList:function(e,t){return!!g.list&&(g.list.commands.push({name:e,args:t}),g.listMode===GL.COMPILE)},glAlphaFunc:function(e,t){g.listMode&&this.addToList("glAlphaFunc",[e,t])||(g.alphaFunc=e,g.alphaRef=t)},glBegin:function(e){g.listMode&&this.addToList("glBegin",[e])||(g.primitive={mode:e,vertices:[],vertexSize:0,vertexAttrs:0},g.primitiveAttrs=0)},glBindTexture:function(e,t){if(!g.listMode||!this.addToList("glBindTexture",[e,t])){t=g.textures[t];if(!t)throw Error("OpenGL: texture not found");b.bindTexture(e,t),g.texture=t}},glBitmap:function(e,t,r,i,s,n,a){if(a.buffer||(a=new Uint8Array(a)),!g.listMode||!this.addToList("glBitmap",[e,t,r,i,s,n,a])){if(0<e&&0<t){for(var o=new Uint8Array(e*t),u=4*Math.ceil(e/32),l=0;l<t;l++)for(var c=l*u,h=7,f=0;f<e;f++)a[c]&1<<h&&(o[l*e+f]=255),--h<0&&(c++,h=7);var p=g.bitmapTexture,p=(p?b.bindTexture(b.TEXTURE_2D,p):(p=g.bitmapTexture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,p),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),b.pixelStorei(b.UNPACK_ALIGNMENT,1),b.texImage2D(b.TEXTURE_2D,0,b.ALPHA,e,t,0,b.ALPHA,b.UNSIGNED_BYTE,o),b.pixelStorei(b.UNPACK_ALIGNMENT,4),b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.disable(b.BLEND),b.colorMask(!0,!0,!0,!0),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),g.bitmapVertexBuffer),p=(p?b.bindBuffer(b.ARRAY_BUFFER,p):(d=new Float32Array([0,0,1,0,0,1,1,1]),p=g.bitmapVertexBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,p),b.bufferData(b.ARRAY_BUFFER,d,b.STATIC_DRAW)),g.bitmapShader);if(!p.program){p.program=b.createProgram();var d=b.createShader(b.VERTEX_SHADER);if(b.shaderSource(d,`
                        attribute vec2 a_position;
                        uniform vec3 u_raster;
                        uniform vec2 u_rasterOffset;
                        uniform vec2 u_rasterScale;
                        uniform vec2 u_translate;
                        uniform vec2 u_scale;
                        varying vec2 v_texcoord;
                        void main() {
                            vec2 raster = u_raster.xy * u_rasterScale + u_rasterOffset;
                            vec2 pos = raster + a_position * u_scale + u_translate;
                            gl_Position = vec4(pos, u_raster.z, 1);
                            v_texcoord = a_position;
                        }
                    `),b.compileShader(d),!b.getShaderParameter(d,b.COMPILE_STATUS))return void console.error("OpenGL: vertex shader compile error: "+b.getShaderInfoLog(d));var m=b.createShader(b.FRAGMENT_SHADER);if(b.shaderSource(m,`
                        precision mediump float;
                        uniform sampler2D u_texture;
                        uniform vec4 u_color;
                        varying vec2 v_texcoord;
                        void main() {
                            float alpha = texture2D(u_texture, v_texcoord).a;
                            if (alpha < 0.5) discard;
                            gl_FragColor = u_color;
                        }
                    `),b.compileShader(m),!b.getShaderParameter(m,b.COMPILE_STATUS))return void console.error("OpenGL: fragment shader compile error: "+b.getShaderInfoLog(m));if(b.attachShader(p.program,d),b.attachShader(p.program,m),b.linkProgram(p.program),!b.getProgramParameter(p.program,b.LINK_STATUS))return void console.error("OpenGL: shader link error: "+b.getProgramInfoLog(p.program));p.locations={a_position:b.getAttribLocation(p.program,"a_position"),u_texture:b.getUniformLocation(p.program,"u_texture"),u_color:b.getUniformLocation(p.program,"u_color"),u_raster:b.getUniformLocation(p.program,"u_raster"),u_rasterOffset:b.getUniformLocation(p.program,"u_rasterOffset"),u_rasterScale:b.getUniformLocation(p.program,"u_rasterScale"),u_translate:b.getUniformLocation(p.program,"u_translate"),u_scale:b.getUniformLocation(p.program,"u_scale")}}b.useProgram(p.program),b.enableVertexAttribArray(p.locations.a_position),b.vertexAttribPointer(p.locations.a_position,2,b.FLOAT,!1,0,0),b.uniform1i(p.locations.u_texture,0),b.uniform4fv(p.locations.u_color,g.rasterColor);d=b.drawingBufferWidth,m=b.drawingBufferHeight;this.bitmapRasterScale||(this.bitmapRasterScale=[2/d,2/m]),this.bitmapScale||(this.bitmapScale=[2*e/d,2*t/m]),this.bitmapTranslate||(this.bitmapTranslate=[0,0]),this.bitmapRasterOffset||(this.bitmapRasterOffset=[-1,-1]),b.uniform3f(p.locations.u_raster,g.rasterPos[0]-r,g.rasterPos[1]-i,g.rasterPos[2]),b.uniform2fv(p.locations.u_rasterOffset,this.bitmapRasterOffset),b.uniform2fv(p.locations.u_rasterScale,this.bitmapRasterScale),b.uniform2fv(p.locations.u_translate,this.bitmapTranslate),b.uniform2fv(p.locations.u_scale,this.bitmapScale),b.drawArrays(b.TRIANGLE_STRIP,0,4),b.disableVertexAttribArray(p.locations.a_position),b.bindBuffer(b.ARRAY_BUFFER,null),b.useProgram(null),b.bindTexture(b.TEXTURE_2D,null),b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST),b.enable(b.BLEND)}g.rasterPos[0]+=s,g.rasterPos[1]+=n}},glBlendFunc:function(e,t){g.listMode&&this.addToList("glBlendFunc",[e,t])||b.blendFunc(e,t)},glCallList:function(e){g.listMode&&this.addToList("glCallList",[e])||this.executeList(e)},glCallLists:function(e,t,r){if(!g.listMode||!this.addToList("glCallLists",[e,t,r])){var i;switch(t){case GL.BYTE:i=new Int8Array(r);break;case GL.UNSIGNED_BYTE:i=new Uint8Array(r);break;case GL.INT:i=new Int32Array(r);break;case GL.UNSIGNED_INT:i=new Uint32Array(r);break;default:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glCallLists type "+GL_Symbol(t))}for(var s=0;s<e;s++){var n=g.listBase+i[s];this.executeList(n)}}},glClear:function(e){g.listMode&&this.addToList("glClear",[e])||(b.COLOR_BUFFER_BIT,b.DEPTH_BUFFER_BIT,b.STENCIL_BUFFER_BIT,b.clear(e),this.vm.breakAfter(500))},glClearColor:function(e,t,r,i){g.listMode&&this.addToList("glClearColor",[e,t,r,i])||b.clearColor(e,t,r,i)},glColor3f:function(e,t,r){g.listMode&&this.addToList("glColor3f",[e,t,r])||(g.color[0]=e,g.color[1]=t,g.color[2]=r,g.color[3]=1,g.primitiveAttrs|=2)},glColor3fv:function(e){g.listMode&&this.addToList("glColor3fv",[e.slice()])||(g.color.set(e),g.color[3]=1,g.primitiveAttrs|=2)},glColor4d:function(e,t,r,i){g.listMode&&this.addToList("glColor4d",[e,t,r,i])||(g.color[0]=e,g.color[1]=t,g.color[2]=r,g.color[3]=i,g.primitiveAttrs|=2)},glColor4f:function(e,t,r,i){g.listMode&&this.addToList("glColor4f",[e,t,r,i])||(g.color[0]=e,g.color[1]=t,g.color[2]=r,g.color[3]=i,g.primitiveAttrs|=2)},glColor4fv:function(e){g.listMode&&this.addToList("glColor4fv",[e.slice()])||(g.color.set(e),g.primitiveAttrs|=2)},glColorPointer:function(e,t,r,i){g.listMode&&this.addToList("glColorPointer",[e,t,r,i])||(g.clientState.colorArray.size=e,g.clientState.colorArray.type=t,g.clientState.colorArray.stride=r,g.clientState.colorArray.pointer=i)},glColorMask:function(e,t,r,i){g.listMode&&this.addToList("glColorMask",[e,t,r,i])||b.colorMask(e,t,r,i)},glClipPlane:function(e,t){var r;g.listMode&&this.addToList("glClipPlane",[e,t])||(e=g.clipPlanes[e-GL.CLIP_PLANE0],r=new Float32Array(16),invertMatrix(g.matrices[GL.MODELVIEW][0],r),transposeMatrix(r),multVec4(r,t,e.equation))},glDeleteLists:function(e,t){for(var r=0;r<t;r++)delete g.lists[e+r]},glDeleteTextures:function(e,t){for(var r=0;r<e;r++){var i=t[r],s=g.textures[i];s&&(b.deleteTexture(s),g.texture===s)&&(g.texture=null),delete g.textures[i]}},glDepthFunc:function(e){g.listMode&&this.addToList("glDepthFunc",[e])||b.depthFunc(e)},glDepthMask:function(e){g.listMode&&this.addToList("glDepthMask",[e])||b.depthMask(e)},glDepthRange:function(e,t){g.listMode&&this.addToList("glDepthRange",[e,t])||b.depthRange(e,t)},glDisable:function(e){if(!g.listMode||!this.addToList("glDisable",[e]))switch(e){case GL.ALPHA_TEST:g.alphaTest=!1;break;case b.BLEND:b.disable(b.BLEND);break;case GL.CLIP_PLANE0:case GL.CLIP_PLANE1:case GL.CLIP_PLANE2:case GL.CLIP_PLANE3:case GL.CLIP_PLANE4:case GL.CLIP_PLANE5:case GL.CLIP_PLANE6:case GL.CLIP_PLANE7:g.clipPlanes[e-GL.CLIP_PLANE0].enabled=!1;break;case b.CULL_FACE:b.disable(b.CULL_FACE);break;case b.DEPTH_TEST:b.disable(b.DEPTH_TEST);break;case GL.FOG:g.fogEnabled=!1;break;case GL.NORMALIZE:break;case GL.LIGHT0:case GL.LIGHT1:case GL.LIGHT2:case GL.LIGHT3:case GL.LIGHT4:case GL.LIGHT5:case GL.LIGHT6:case GL.LIGHT7:g.lights[e-GL.LIGHT0].enabled=!1;break;case GL.LIGHTING:g.lightingEnabled=!1;break;case b.POLYGON_OFFSET_FILL:b.disable(b.POLYGON_OFFSET_FILL);break;case b.STENCIL_TEST:b.disable(b.STENCIL_TEST);break;case b.TEXTURE_2D:g.textureEnabled=!1;break;case GL.TEXTURE_GEN_S:case GL.TEXTURE_GEN_T:case GL.TEXTURE_GEN_R:case GL.TEXTURE_GEN_Q:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glDisable GL_TEXTURE_GEN_"+(e-GL.TEXTURE_GEN_S));break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glDisable "+GL_Symbol(e))}},glDisableClientState:function(e){if(!g.listMode||!this.addToList("glDisableClientState",[e]))switch(e){case GL.VERTEX_ARRAY:return void(g.clientState.vertexArray.enabled=!1);case GL.NORMAL_ARRAY:return void(g.clientState.normalArray.enabled=!1);case GL.COLOR_ARRAY:return void(g.clientState.colorArray.enabled=!1);case GL.TEXTURE_COORD_ARRAY:return void(g.clientState.textureCoordArray.enabled=!1);default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glDisableClientState "+GL_Symbol(e))}},glDrawArrays:function(e,t,r){var i,s,n,a,o,u,l;g.listMode&&this.addToList("glDrawArrays",[e,t,r])||(i=0,g.clientState.normalArray.enabled&&(i|=1),g.clientState.colorArray.enabled&&(i|=2),g.clientState.textureCoordArray.enabled&&(i|=4),e===GL.POINTS&&(i|=32),(i=this.getShader(i)).program?(u=g.clientState.vertexArray).enabled&&u.pointer&&(b.useProgram(i.program),this.setShaderUniforms(i),s=i.locations,n=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,n),b.bufferData(b.ARRAY_BUFFER,u.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(s.aPosition,u.size,u.type,!1,u.stride,0),b.enableVertexAttribArray(s.aPosition),0<=s.aNormal&&(u=g.clientState.normalArray,a=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,a),b.bufferData(b.ARRAY_BUFFER,u.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(s.aNormal,u.size,u.type,!1,u.stride,0),b.enableVertexAttribArray(s.aNormal)),0<=s.aColor&&(u=g.clientState.colorArray,o=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,o),b.bufferData(b.ARRAY_BUFFER,u.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(s.aColor,u.size,u.type,!1,u.stride,0),b.enableVertexAttribArray(s.aColor)),0<=s.aTexCoord&&(u=g.clientState.textureCoordArray,l=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,l),b.bufferData(b.ARRAY_BUFFER,u.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(s.aTexCoord,u.size,u.type,!1,u.stride,0),b.enableVertexAttribArray(s.aTexCoord)),b.drawArrays(e,t,r),b.useProgram(null),b.bindBuffer(b.ARRAY_BUFFER,null),b.disableVertexAttribArray(s.aPosition),b.deleteBuffer(n),a&&(b.disableVertexAttribArray(s.aNormal),b.deleteBuffer(a)),o&&(b.disableVertexAttribArray(s.aColor),b.deleteBuffer(o)),l)&&(b.disableVertexAttribArray(s.aTexCoord),b.deleteBuffer(l)):this.vm.warnOnce("OpenGL: UNIMPLEMENTED glDrawArrays shader: "+i.label))},glDrawElements:function(e,t,r,i){if(!g.listMode||!this.addToList("glDrawElements",[e,t,r,i])){var s;switch(r){case GL.UNSIGNED_BYTE:s=new Uint8Array(i);break;case GL.UNSIGNED_SHORT:s=new Uint16Array(i);break;case GL.UNSIGNED_INT:var n=new Uint32Array(i),a=Math.max.apply(null,n);65535<a&&console.warn("OpenGL: glDrawElements with indices > 65535 not supported, truncating",a),r=a<=255?(s=new Uint8Array(t),GL.UNSIGNED_BYTE):(s=new Uint16Array(t),GL.UNSIGNED_SHORT);for(var o=0;o<t;o++)s[o]=n[o];break;default:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glDrawElements type "+GL_Symbol(r))}if(e===GL.QUADS){for(var u=new s.constructor(6*t/4),l=0,o=0;o<t;o+=4)u[l++]=s[o],u[l++]=s[o+1],u[l++]=s[o+2],u[l++]=s[o],u[l++]=s[o+2],u[l++]=s[o+3];t=(s=u).length,e=GL.TRIANGLES}var c,h,f,p,d,m,v=0,v=(g.clientState.normalArray.enabled&&(v|=1),g.clientState.colorArray.enabled&&(v|=2),g.clientState.textureCoordArray.enabled&&(v|=4),e===GL.POINTS&&(v|=32),this.getShader(v));v.program?(m=g.clientState.vertexArray).enabled&&m.pointer&&(b.useProgram(v.program),this.setShaderUniforms(v),c=v.locations,h=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,h),b.bufferData(b.ARRAY_BUFFER,m.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(c.aPosition,m.size,m.type,!1,m.stride,0),b.enableVertexAttribArray(c.aPosition),0<=c.aNormal&&(m=g.clientState.normalArray,f=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,f),b.bufferData(b.ARRAY_BUFFER,m.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(c.aNormal,m.size,m.type,!1,m.stride,0),b.enableVertexAttribArray(c.aNormal)),0<=c.aColor&&(m=g.clientState.colorArray,p=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,p),b.bufferData(b.ARRAY_BUFFER,m.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(c.aColor,m.size,m.type,!1,m.stride,0),b.enableVertexAttribArray(c.aColor)),0<=c.aTexCoord&&(m=g.clientState.textureCoordArray,d=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,d),b.bufferData(b.ARRAY_BUFFER,m.pointer,b.DYNAMIC_DRAW),b.vertexAttribPointer(c.aTexCoord,m.size,m.type,!1,m.stride,0),b.enableVertexAttribArray(c.aTexCoord)),m=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m),b.bufferData(b.ELEMENT_ARRAY_BUFFER,s,b.DYNAMIC_DRAW),b.drawElements(e,s.length,r,0),b.useProgram(null),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null),b.bindBuffer(b.ARRAY_BUFFER,null),b.deleteBuffer(m),b.disableVertexAttribArray(c.aPosition),b.deleteBuffer(h),f&&(b.disableVertexAttribArray(c.aNormal),b.deleteBuffer(f)),p&&(b.disableVertexAttribArray(c.aColor),b.deleteBuffer(p)),d)&&(b.disableVertexAttribArray(c.aTexCoord),b.deleteBuffer(d)):this.vm.warnOnce("OpenGL: UNIMPLEMENTED glDrawElements shader: "+v.label)}},glEnable:function(e){if(!g.listMode||!this.addToList("glEnable",[e]))switch(e){case GL.ALPHA_TEST:g.alphaTest=!0;break;case b.BLEND:b.enable(b.BLEND);break;case GL.CLIP_PLANE0:case GL.CLIP_PLANE1:case GL.CLIP_PLANE2:case GL.CLIP_PLANE3:case GL.CLIP_PLANE4:case GL.CLIP_PLANE5:case GL.CLIP_PLANE6:case GL.CLIP_PLANE7:g.clipPlanes[e-GL.CLIP_PLANE0].enabled=!0;break;case b.CULL_FACE:b.enable(b.CULL_FACE);break;case b.DEPTH_TEST:b.enable(b.DEPTH_TEST);break;case GL.FOG:g.fogEnabled=!0;break;case GL.NORMALIZE:break;case GL.LIGHT0:case GL.LIGHT1:case GL.LIGHT2:case GL.LIGHT3:case GL.LIGHT4:case GL.LIGHT5:case GL.LIGHT6:case GL.LIGHT7:g.lights[e-GL.LIGHT0].enabled=!0;break;case GL.LIGHTING:g.lightingEnabled=!0;break;case b.POLYGON_OFFSET_FILL:b.enable(b.POLYGON_OFFSET_FILL);break;case b.STENCIL_TEST:b.enable(b.STENCIL_TEST);break;case b.TEXTURE_2D:g.textureEnabled=!0;break;case GL.TEXTURE_GEN_S:case GL.TEXTURE_GEN_T:case GL.TEXTURE_GEN_R:case GL.TEXTURE_GEN_Q:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glEnable GL_"+GL_Symbol(e,"TEXTURE_GEN_S"));break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glEnable "+GL_Symbol(e))}},glEnableClientState:function(e){if(!g.listMode||!this.addToList("glEnableClientState",[e]))switch(e){case GL.VERTEX_ARRAY:return void(g.clientState.vertexArray.enabled=!0);case GL.NORMAL_ARRAY:return void(g.clientState.normalArray.enabled=!0);case GL.COLOR_ARRAY:return void(g.clientState.colorArray.enabled=!0);case GL.TEXTURE_COORD_ARRAY:return void(g.clientState.textureCoordArray.enabled=!0);default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glEnableClientState "+GL_Symbol(e))}},glFog:function(e,t){if(!g.listMode||!this.addToList("glFog",[e,t]))switch(e){case GL.FOG_MODE:g.fogMode=t;break;case GL.FOG_DENSITY:g.fogDensity=t;break;case GL.FOG_START:g.fogStart=t;break;case GL.FOG_END:g.fogEnd=t;break;case GL.FOG_COLOR:g.fogColor.set(t);break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glFog "+GL_Symbol(e))}},glFogi:function(e,t){this.glFog(e,t)},glFogf:function(e,t){this.glFog(e,t)},glFogiv:function(e,t){this.glFog(e,e===GL.FOG_COLOR?t.map(function(e){return(e+.5)/2147483647.5}):t[0])},glFogfv:function(e,t){this.glFog(e,e===GL.FOG_COLOR?t:t[0])},getShader:function(e){var t=e;if(g.textureEnabled&&g.texture&&(t|=8),g.alphaTest&&(t|=16),g.fogEnabled)switch(g.fogMode){case GL.EXP:t|=2<<d;break;case GL.EXP2:t|=3<<d;break;case GL.LINEAR:t|=1<<d}var r=0;if(g.lightingEnabled){for(var i=0;i<l;i++)g.lights[i].enabled&&r++;t|=r<<u}for(var s=0,i=0;i<f;i++)g.clipPlanes[i].enabled&&s++;e=g.shaders[t|=s<<h];if(!e){var n="[POSITION";1&t&&(n+=", NORMAL"),2&t&&(n+=", COLOR"),4&t&&(n+=", TEXCOORD"),n+="]",8&t&&(n+=", TEXTURE"),t&c&&(n+=", "+r+" LIGHT",1!==r)&&(n+="S"),t&p&&(n+=", "+s+" CLIP_PLANE",1!==s)&&(n+="S"),16&t&&(n+=", ALPHA_TEST"),32&t&&(n+=", POINT_SIZE"),t&m&&(n+=", FOG"),e=g.shaders[t]={flags:t,label:n,program:null,locations:null,vsource:null,fsource:null};if(-16368&t)return e;var n=b.createProgram(),a=b.createShader(b.VERTEX_SHADER);if(e.vsource=this.vertexShaderSource(t),b.shaderSource(a,e.vsource),b.compileShader(a),!b.getShaderParameter(a,b.COMPILE_STATUS))return console.error("OpenGL: vertex shader compile error: "+b.getShaderInfoLog(a)),e;var o=b.createShader(b.FRAGMENT_SHADER);if(e.fsource=this.fragmentShaderSource(t),b.shaderSource(o,e.fsource),b.compileShader(o),!b.getShaderParameter(o,b.COMPILE_STATUS))return console.error("OpenGL: fragment shader compile error: "+b.getShaderInfoLog(o)),e;if(b.attachShader(n,a),b.attachShader(n,o),b.linkProgram(n),!b.getProgramParameter(n,b.LINK_STATUS))return console.error("OpenGL: shader link error: "+b.getProgramInfoLog(n)),e;e.program=n,e.locations=this.getLocations(n,t)}return e},setShaderUniforms:function(e){var t,r=e.locations;if(b.uniformMatrix4fv(r.uModelView,!1,g.matrices[GL.MODELVIEW][0]),b.uniformMatrix4fv(r.uProjection,!1,g.matrices[GL.PROJECTION][0]),r.uNormalMatrix&&(t=asNormalMatrix(g.matrices[GL.MODELVIEW][0]),b.uniformMatrix3fv(r.uNormalMatrix,!1,t)),r.uNormal&&b.uniform3fv(r.uNormal,g.normal),r.uColor&&(t=g.color,g.textureEnvMode===GL.REPLACE&&(t=[1,1,1,1]),b.uniform4fv(r.uColor,t)),r.uTextureMatrix&&b.uniformMatrix4fv(r.uTextureMatrix,!1,g.matrices[GL.TEXTURE][0]),r.uTexCoord&&b.uniform2fv(r.uTexCoord,g.texCoord),r.uSampler&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,g.texture),b.uniform1i(r.uSampler,0)),r.uPointSize&&b.uniform1f(r.uPointSize,g.pointSize),0<(448&e.flags)>>u){b.uniform4fv(r.uLightModelAmbient,g.lightModelAmbient),b.uniform4fv(r.uMaterialAmbient,g.material.ambient),b.uniform4fv(r.uMaterialDiffuse,g.material.diffuse),b.uniform4fv(r.uMaterialSpecular,g.material.specular),b.uniform4fv(r.uMaterialEmission,g.material.emission),b.uniform1f(r.uMaterialShininess,g.material.shininess);for(var i=0,s=0;s<l;s++){var n=g.lights[s];n.enabled&&(b.uniform4fv(r.uLights[i].ambient,n.ambient),b.uniform4fv(r.uLights[i].diffuse,n.diffuse),b.uniform4fv(r.uLights[i].specular,n.specular),b.uniform4fv(r.uLights[i].position,n.position),i++)}}if(0<(3584&e.flags)>>h)for(i=0,s=0;s<f;s++){var a=g.clipPlanes[s];a.enabled&&(b.uniform4fv(r.uClipPlanes[i],a.equation),i++)}r.uFogColor&&b.uniform4fv(r.uFogColor,g.fogColor),r.uFogEnd&&b.uniform1f(r.uFogEnd,g.fogEnd),r.uFogRange&&b.uniform1f(r.uFogRange,g.fogEnd-g.fogStart),r.uFogDensity&&b.uniform1f(r.uFogDensity,g.fogDensity)},glEnd:function(){if(!g.listMode||!this.addToList("glEnd",[])){var e=g.primitive,t=(g.primitive=null,e.vertexAttrs),r=(e.mode===GL.POINTS&&(t|=32),this.getShader(t));if(r.program){for(var i=e.vertices,s=e.vertexSize,n=new Float32Array(i.length*s),a=0,o=0;a<i.length;a++,o+=s)n.set(i[a],o);var u,l,c=b.createBuffer();switch(b.bindBuffer(b.ARRAY_BUFFER,c),b.bufferData(b.ARRAY_BUFFER,n,b.DYNAMIC_DRAW),e.mode){case b.POINTS:case b.LINES:case b.LINE_LOOP:case b.LINE_STRIP:case b.TRIANGLES:case b.TRIANGLE_STRIP:case b.TRIANGLE_FAN:u=e.mode;break;case GL.QUADS:for(var h=new(256<i.length?Uint16Array:Uint8Array)(3*i.length/2),o=0,a=0;a<i.length;a+=4)h[o++]=a,h[o++]=a+1,h[o++]=a+2,h[o++]=a,h[o++]=a+2,h[o++]=a+3;u=b.TRIANGLES;break;case GL.QUAD_STRIP:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glEnd GL_QUAD_STRIP");case GL.POLYGON:u=b.TRIANGLE_FAN;break;default:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glEnd "+e.mode)}h&&(l=b.createBuffer(),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,l),b.bufferData(b.ELEMENT_ARRAY_BUFFER,h,b.DYNAMIC_DRAW));var f=4*s,o=0,p=(b.useProgram(r.program),this.setShaderUniforms(r),r.locations);b.vertexAttribPointer(p.aPosition,3,b.FLOAT,!1,f,o),b.enableVertexAttribArray(p.aPosition),o+=12,0<=p.aNormal&&(b.vertexAttribPointer(p.aNormal,3,b.FLOAT,!1,f,o),b.enableVertexAttribArray(p.aNormal)),1&t&&(o+=12),0<=p.aColor&&(b.vertexAttribPointer(p.aColor,4,b.FLOAT,!1,f,o),b.enableVertexAttribArray(p.aColor)),2&t&&(o+=16),0<=p.aTexCoord&&(b.vertexAttribPointer(p.aTexCoord,2,b.FLOAT,!1,f,o),b.enableVertexAttribArray(p.aTexCoord)),4&t&&(o+=8),l?b.drawElements(u,h.length,256<i.length?b.UNSIGNED_SHORT:b.UNSIGNED_BYTE,0):b.drawArrays(u,0,i.length),b.useProgram(null),b.disableVertexAttribArray(p.aPosition),0<=p.aNormal&&b.disableVertexAttribArray(p.aNormal),0<=p.aColor&&b.disableVertexAttribArray(p.aColor),0<=p.aTexCoord&&b.disableVertexAttribArray(p.aTexCoord),b.bindBuffer(b.ARRAY_BUFFER,null),b.deleteBuffer(c),l&&(b.deleteBuffer(l),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null))}else this.vm.warnOnce("OpenGL: UNIMPLEMENTED glEnd shader: "+r.label)}},glEndList:function(){var e=g.list;g.list=null,g.lists[e.id]=e,g.listMode=0},glFinish:function(){b.finish()},glFlush:function(){b.flush()},glFrontFace:function(e){g.listMode&&this.addToList("glFrontFace",[e])||b.frontFace(e)},glFrustum:function(e,t,r,i,s,n){var a;g.listMode&&this.addToList("glFrustum",[e,t,r,i,s,n])||((a=g.matrix)[0]=2*s/(t-e),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*s/(i-r),a[6]=0,a[7]=0,a[8]=(t+e)/(t-e),a[9]=(i+r)/(i-r),a[10]=-(n+s)/(n-s),a[11]=-1,a[12]=0,a[13]=0,a[14]=-2*n*s/(n-s),a[15]=0)},glGenLists:function(e){var t=0;return 0<e&&(t=g.listIdGen+1,g.listIdGen+=e),t},glGenTextures:function(e,t){for(var r=0;r<e;r++){var i=++g.textureIdGen;g.textures[i]=b.createTexture(),t[r]=i}},glGetFloatv:function(e,t){switch(e){case GL.MODELVIEW_MATRIX:t.set(g.matrices[GL.MODELVIEW][0]);break;case GL.PROJECTION_MATRIX:t.set(g.matrices[GL.PROJECTION][0]);break;case GL.TEXTURE_MATRIX:t.set(g.matrices[GL.TEXTURE][0]);break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glGetFloatv "+GL_Symbol(e))}},glGetIntegerv(e,t){e===GL.LIST_INDEX?t[0]=g.list?g.list.id:0:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glGetIntegerv "+GL_Symbol(e))},glGetString:function(e){switch(e){case GL.VERSION:return g.version;case GL.VENDOR:return g.vendor;case GL.RENDERER:return g.renderer;case GL.EXTENSIONS:return g.extensions;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glGetString "+e)}return""},glGetTexLevelParameteriv:function(e,t,r,i){if(r===GL.TEXTURE_COMPRESSED)return!1;this.vm.warnOnce("OpenGL: UNIMPLEMENTED glGetTexLevelParameteriv "+GL_Symbol(e)+" "+GL_Symbol(r))},glHint:function(e,t){g.listMode&&this.addToList("glHint",[e,t])||e===b.GENERATE_MIPMAP_HINT&&b.hint(e,t)},glIsEnabled:function(e){return e===GL.LIGHTING?g.lightingEnabled:(this.vm.warnOnce("OpenGL: UNIMPLEMENTED glIsEnabled "+e),!1)},glIsTexture:function(e){return!!g.textures[e]},glLightf:function(e,t,r){g.listMode&&this.addToList("glLightf",[e,t,r])||(GL.LIGHT0,t===GL.SPOT_CUTOFF&&180===r)||this.vm.warnOnce("OpenGL: UNIMPLEMENTED glLightf "+GL_Symbol(t))},glLightfv:function(e,t,r){if(!g.listMode||!this.addToList("glLightfv",[e,t,r])){var i=e-GL.LIGHT0;switch(t){case GL.AMBIENT:g.lights[i].ambient=r;break;case GL.DIFFUSE:g.lights[i].diffuse=r;break;case GL.SPECULAR:g.lights[i].specular=r;break;case GL.POSITION:(0===r[3]?transformDirection:transformPoint)(g.matrices[GL.MODELVIEW][0],r,g.lights[i].position);break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glLightfv "+GL_Symbol(t))}}},glLightModelfv:function(e,t){g.listMode&&this.addToList("glLightModelfv",[e,t])||(e===GL.LIGHT_MODEL_AMBIENT?g.lightModelAmbient=t:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glLightModelfv "+GL_Symbol(e)))},glLineWidth:function(e){g.listMode&&this.addToList("glLineWidth",[e])||b.lineWidth(e)},glListBase:function(e){g.listBase=e},glLoadIdentity:function(){g.listMode&&this.addToList("glLoadIdentity",[])||g.matrix.set(i)},glLoadMatrixf:function(e){g.listMode&&this.addToList("glLoadMatrixf",[e])||g.matrix.set(e)},glLoadTransposeMatrixf:function(e){g.listMode&&this.addToList("glLoadTransposeMatrixf",[e])||(transposeMatrix(e=new Float32Array(e)),g.matrix.set(e))},glMaterialf:function(e,t,r){g.listMode&&this.addToList("glMaterialf",[e,t,r])||(t===GL.SHININESS?g.material.shininess=r:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glMaterialf "+GL_Symbol(t)))},glMaterialfv:function(e,t,r){if(!g.listMode||!this.addToList("glMaterialfv",[e,t,r]))switch(t){case GL.AMBIENT:g.material.ambient=r;break;case GL.DIFFUSE:g.material.diffuse=r;break;case GL.SPECULAR:g.material.specular=r;break;case GL.EMISSION:g.material.emission=r;break;case GL.SHININESS:g.material.shininess=r[0];break;case GL.AMBIENT_AND_DIFFUSE:g.material.ambient=r,g.material.diffuse=r;break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glMaterialfv "+GL_Symbol(t))}},glMatrixMode:function(e){g.listMode&&this.addToList("glMatrixMode",[e])||(e!==GL.MODELVIEW&&e!==GL.PROJECTION&&e!==GL.TEXTURE&&this.vm.warnOnce("OpenGL: UNIMPLEMENTED glMatrixMode "+GL_Symbol(e)),g.matrixMode=e,g.matrices[e]||(g.matrices[e]=[new Float32Array(i)]),g.matrix=g.matrices[e][0])},glMultMatrixf:function(e){g.listMode&&this.addToList("glMultMatrixf",[e])||multMatrix(g.matrix,e)},glMultTransposeMatrixf:function(e){g.listMode&&this.addToList("glMultTransposeMatrixf",[e])||(transposeMatrix(e=new Float32Array(e)),multMatrix(g.matrix,e))},glNewList:function(e,t){g.list={id:e,commands:[]},g.listMode=t},glNormal3f:function(e,t,r){g.listMode&&this.addToList("glNormal3f",[e,t,r])||(g.normal[0]=e,g.normal[1]=t,g.normal[2]=r,g.primitiveAttrs|=1)},glNormal3fv:function(e){g.listMode&&this.addToList("glNormal3fv",[e.slice()])||(g.normal.set(e),g.primitiveAttrs|=1)},glNormalPointer:function(e,t,r){g.listMode&&this.addToList("glNormalPointer",[e,t,r])||(g.clientState.normalArray.size=3,g.clientState.normalArray.type=e,g.clientState.normalArray.stride=t,g.clientState.normalArray.pointer=r)},glPixelStorei:function(e,t){switch(e){case b.UNPACK_ALIGNMENT:break;case GL.UNPACK_LSB_FIRST:0!==t&&console.log("UNIMPLEMENTED glPixelStorei GL_UNPACK_LSB_FIRST",t);break;case GL.UNPACK_ROW_LENGTH:g.pixelStoreUnpackRowLength=t;break;case GL.UNPACK_SKIP_ROWS:g.pixelStoreUnpackSkipRows=t;break;case GL.UNPACK_SKIP_PIXELS:g.pixelStoreUnpackSkipPixels=t;break;default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glPixelStorei "+e)}},glPolygonOffset:function(e,t){g.listMode&&this.addToList("glPolygonOffset",[e,t])||b.polygonOffset(e,t)},glPushAttrib:function(e){g.listMode&&this.addToList("glPushAttrib",[e])||this.vm.warnOnce("OpenGL: UNIMPLEMENTED glPushAttrib")},glPushMatrix:function(){g.listMode&&this.addToList("glPushMatrix",[])||(g.matrix=new Float32Array(g.matrix),g.matrices[g.matrixMode].unshift(g.matrix))},glPointSize:function(e){g.listMode&&this.addToList("glPointSize",[e])||(g.pointSize=e)},glPopAttrib:function(){g.listMode&&this.addToList("glPopAttrib",[])||this.vm.warnOnce("OpenGL: UNIMPLEMENTED glPopAttrib")},glPopMatrix:function(){if(!g.listMode||!this.addToList("glPopMatrix",[])){if(g.matrices[g.matrixMode].length<=1)return!1;g.matrices[g.matrixMode].shift(),g.matrix=g.matrices[g.matrixMode][0]}},glRasterPos3f:function(e,t,r){g.listMode&&this.addToList("glRasterPos3f",[e,t,r])||(g.rasterPos[0]=e,g.rasterPos[1]=t,g.rasterPos[2]=r,g.rasterPos[3]=1,transformPoint(g.matrices[GL.PROJECTION][0],g.rasterPos,g.rasterPos),transformPoint(g.matrices[GL.MODELVIEW][0],g.rasterPos,g.rasterPos),g.rasterPos[0]=(.5*g.rasterPos[0]+.5)*g.viewport[2]+g.viewport[0],g.rasterPos[1]=(.5*g.rasterPos[1]+.5)*g.viewport[3]+g.viewport[1],g.rasterPos[2]=(.5*g.rasterPos[2]+.5)*(g.depthRange[1]-g.depthRange[0])+g.depthRange[0],g.rasterColor.set(g.color))},glReadPixels:function(e,t,r,i,s,n,a){if(!g.listMode||!this.addToList("glReadPixels",[e,t,r,i,s,n,a])){var o=!1;switch(s){case b.RGBA:break;case GL.BGRA:s=b.RGBA,o=!0;break;default:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glReadPixels format "+GL_Symbol(s))}if(n!==b.UNSIGNED_BYTE)this.vm.warnOnce("OpenGL: UNIMPLEMENTED glReadPixels type "+GL_Symbol(n));else if(a=new Uint8Array(a),b.readPixels(e,t,r,i,s,n,a),o)for(var u=0;u<a.length;u+=4){var l=a[u],c=a[u+2];a[u]=c,a[u+2]=l}}},glTranslated:function(e,t,r){g.listMode&&this.addToList("glTranslated",[e,t,r])||translateMatrix(g.matrix,e,t,r)},glTranslatef:function(e,t,r){g.listMode&&this.addToList("glTranslatef",[e,t,r])||translateMatrix(g.matrix,e,t,r)},glRotatef:function(e,t,r,i){g.listMode&&this.addToList("glRotatef",[e,t,r,i])||rotateMatrix(g.matrix,e,t,r,i)},glScalef:function(e,t,r){g.listMode&&this.addToList("glScalef",[e,t,r])||scaleMatrix(g.matrix,e,t,r)},glScaled:function(e,t,r){g.listMode&&this.addToList("glScaled",[e,t,r])||scaleMatrix(g.matrix,e,t,r)},glShadeModel:function(e){g.listMode&&this.addToList("glShadeModel",[e])||this.vm.warnOnce("OpenGL: UNIMPLEMENTED glShadeModel "+GL_Symbol(e))},glStencilFunc:function(e,t,r){g.listMode&&this.addToList("glStencilFunc",[e,t,r])||b.stencilFunc(e,t,r)},glStencilOp:function(e,t,r){g.listMode&&this.addToList("glStencilOp",[e,t,r])||b.stencilOp(e,t,r)},glTexEnv:function(e,t,r){if(!g.listMode||!this.addToList("glTexEnv",[e,t,r]))if(t===GL.TEXTURE_ENV_MODE)switch(r){case GL.MODULATE:case GL.REPLACE:return void(g.textureEnvMode=r);default:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexEnv "+GL_Symbol(e)+" GL_TEXTURE_ENV_MODE "+GL_Symbol(r))}else this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexEnv "+GL_Symbol(e)+" "+GL_Symbol(t))},glTexEnvi:function(e,t,r){this.glTexEnv(e,t,r)},glTexEnvf:function(e,t,r){this.glTexEnv(e,t,r)},glTexGen:function(e,t,r){g.listMode&&this.addToList("glTexGen",[e,t,r])||this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexGen "+GL_Symbol(t))},glTexGeni:function(e,t,r){this.glTexGen(e,t,r)},glTexGenf:function(e,t,r){this.glTexGen(e,t,r)},glTexGend:function(e,t,r){this.glTexGen(e,t,param)},glTexGenfv:function(e,t,r){g.listMode&&this.addToList("glTexGenfv",[e,t,r])||this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexGenfv "+GL_Symbol(t))},glTexImage2D:function(e,t,r,i,s,n,a,o,u){if(!g.listMode||!this.addToList("glTexImage2D",[e,t,r,i,s,n,a,o,u])){switch(g.texture.width=i,g.texture.height=s,0!==g.pixelStoreUnpackRowLength&&g.pixelStoreUnpackRowLength!==g.texture.width&&this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexImage2D GL_UNPACK_ROW_LENGTH"),0!==g.pixelStoreUnpackSkipRows&&this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexImage2D GL_UNPACK_SKIP_ROWS"),0!==g.pixelStoreUnpackSkipPixels&&this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexImage2D GL_UNPACK_SKIP_PIXELS"),a){case b.RGBA:this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexImage2D format GL_RGBA");break;case GL.BGRA:a=b.RGBA;break;default:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexImage2D format "+GL_Symbol(a))}u=u||new ArrayBuffer(i*s*4),o!==b.UNSIGNED_BYTE?this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexImage2D type "+GL_Symbol(o)):(u=new Uint8Array(u),g.texture.pixels=u,b.texImage2D(e,t,r,i,s,n,a,o,u),g.texture.generateMipmapSGIS&&b.generateMipmap(e))}},debugTexture:function(e){var t,r,i;!1===e?(r=document.getElementById("texDebug"))&&r.remove():(t=(e=e||g.texture).pixels,i=e.width,e=e.height,t=new Uint8Array(t),(r=document.getElementById("texDebug"))||((r=document.createElement("canvas")).id="texDebug",r.style.position="absolute",r.style.zIndex=1e3,document.body.appendChild(r)),r.width=i,r.height=e,(i=(r=r.getContext("2d")).createImageData(i,e)).data.set(t),r.putImageData(i,0,0))},glTexCoord2d:function(e,t){g.listMode&&this.addToList("glTexCoord2d",[e,t])||(g.texCoord[0]=e,g.texCoord[1]=t,g.primitiveAttrs|=4)},glTexCoord2f:function(e,t){g.listMode&&this.addToList("glTexCoord2f",[e,t])||(g.texCoord[0]=e,g.texCoord[1]=t,g.primitiveAttrs|=4)},glTexCoord2fv:function(e){g.listMode&&this.addToList("glTexCoord2fv",[e.slice()])||(g.texCoord.set(e),g.primitiveAttrs|=4)},glTexCoordPointer:function(e,t,r,i){g.listMode&&this.addToList("glTexCoordPointer",[e,t,r,i])||(g.clientState.textureCoordArray.size=e,g.clientState.textureCoordArray.type=t,g.clientState.textureCoordArray.stride=r,g.clientState.textureCoordArray.pointer=i)},glTexParameteri:function(e,t,r){g.listMode&&this.addToList("glTexParameteri",[e,t,r])||(t===GL.GENERATE_MIPMAP_SGIS?(g.texture.generateMipmapSGIS=r)&&1<g.texture.width&&b.generateMipmap(e):b.texParameteri(e,t,r))},glTexSubImage2D:function(e,t,r,i,s,n,a,o,u){if(!g.listMode||!this.addToList("glTexSubImage2D",[e,t,r,i,s,n,a,o,u])){var l=g.pixelStoreUnpackSkipRows*g.texture.width;switch(0!==g.pixelStoreUnpackRowLength&&g.pixelStoreUnpackRowLength!==g.texture.width&&this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexSubImage2D GL_UNPACK_ROW_LENGTH"),s!==g.texture.width&&(s=g.texture.width,r=0),a){case b.RGBA:l*=4;break;case GL.BGRA:l*=4,a=b.RGBA;break;default:return void this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexSubImage2D format "+GL_Symbol(a))}o!==b.UNSIGNED_BYTE?this.vm.warnOnce("OpenGL: UNIMPLEMENTED glTexSubImage2D type "+GL_Symbol(o)):(u=new Uint8Array(u,l),b.texSubImage2D(e,t,r,i,s,n,a,o,u),g.texture.generateMipmapSGIS&&b.generateMipmap(e))}},glVertex2f:function(e,t){g.listMode&&this.addToList("glVertex2f",[e,t])||this.pushVertex([e,t])},glVertex3f:function(e,t,r){g.listMode&&this.addToList("glVertex3f",[e,t,r])||this.pushVertex([e,t,r])},glVertex3fv:function(e){g.listMode&&this.addToList("glVertex3fv",[e.slice()])||this.pushVertex(e)},glVertex2i:function(e,t){g.listMode&&this.addToList("glVertex2i",[e,t])||this.pushVertex([e,t])},glVertexPointer:function(e,t,r,i){g.listMode&&this.addToList("glVertexPointer",[e,t,r,i])||(g.clientState.vertexArray.size=e,g.clientState.vertexArray.type=t,g.clientState.vertexArray.stride=r,g.clientState.vertexArray.pointer=i)},glViewport:function(e,t,r,i){g.listMode&&this.addToList("glViewport",[e,t,r,i])||(b.viewport(e,t,r,i),g.viewport[0]=e,g.viewport[1]=t,g.viewport[2]=r,g.viewport[3]=i)},glXGetProcAddressARB:function(e){e=Squeak.bytesAsString(e);var t=this.ffi.ffiLookupFunc(this,e);return t||this.vm.warnOnce("OpenGL: UNIMPLEMENTED EXT FUNC"+e),t},pushVertex:function(e){var t=g.primitive;if(!t)throw Error("OpenGL: glBegin not called");t.vertexSize||(r=3,1&g.primitiveAttrs&&(r+=3),2&g.primitiveAttrs&&(r+=4),4&g.primitiveAttrs&&(r+=2),t.vertexSize=r,t.vertexAttrs=g.primitiveAttrs);var r=new Float32Array(t.vertexSize),i=0;r.set(e,i),i+=3,1&t.vertexAttrs&&(r.set(g.normal,i),i+=3),2&t.vertexAttrs&&(r.set(g.color,i),i+=4),4&t.vertexAttrs&&(r.set(g.texCoord,i),i+=2),t.vertices.push(r)},vertexShaderSource:function(e){var t=[],r=(t.push("uniform mat4 uModelView;"),t.push("uniform mat4 uProjection;"),t.push("attribute vec3 aPosition;"),2&e?t.push("attribute vec4 aColor;"):e&c&&t.push("uniform vec4 uColor;"),e&(2|c)&&t.push("varying vec4 vColor;"),4&e&&8&e&&(t.push("uniform mat4 uTextureMatrix;"),t.push("attribute vec2 aTexCoord;"),t.push("varying vec2 vTexCoord;")),32&e&&t.push("uniform float uPointSize;"),(448&e)>>u),i=(0<r&&(1&e?t.push("attribute vec3 aNormal;"):t.push("uniform vec3 uNormal;"),t.push("uniform mat3 uNormalMatrix;"),t.push("uniform vec4 uLightModelAmbient;"),t.push("uniform vec4 uMaterialAmbient;"),t.push("uniform vec4 uMaterialDiffuse;"),t.push("uniform vec4 uMaterialSpecular;"),t.push("uniform vec4 uMaterialEmission;"),t.push("uniform float uMaterialShininess;"),t.push("struct Light {"),t.push("  vec4 position;"),t.push("  vec4 ambient;"),t.push("  vec4 diffuse;"),t.push("  vec4 specular;"),t.push("};"),t.push("uniform Light uLights["+r+"];")),(3584&e)>>h),s=(0<i&&(t.push("uniform vec4 uClipPlanes["+i+"];"),t.push("varying float vClipDist["+i+"];")),(e&o)>>d);return 0!=s&&(1==s?(t.push("uniform float uFogEnd;"),t.push("uniform float uFogRange;")):t.push("uniform float uFogDensity;"),t.push("varying float vFogDist;")),t.push("void main(void) {"),2&e?t.push("  vColor = aColor;"):e&c&&t.push("  vColor = uColor;"),t.push("  vec4 position = uModelView * vec4(aPosition, 1.0);"),0<r&&(1&e?t.push("  vec3 normal = normalize(uNormalMatrix * aNormal);"):t.push("  vec3 normal = normalize(uNormalMatrix * uNormal);"),t.push("  vec4 lighting = uMaterialEmission;"),t.push("  lighting += uMaterialAmbient * uLightModelAmbient;"),t.push("  vec3 eyeDir = normalize(-position.xyz);"),t.push("  for (int i = 0; i < "+r+"; i++) {"),t.push("    Light light = uLights[i];"),t.push("    vec3 lightDir;"),t.push("    if (light.position.w == 0.0) {"),t.push("      lightDir = normalize(light.position.xyz);"),t.push("    } else {"),t.push("      lightDir = normalize(light.position.xyz - position.xyz);"),t.push("    }"),t.push("    float nDotL = max(dot(normal, lightDir), 0.0);"),t.push("    vec4 ambient = uMaterialAmbient * light.ambient;"),t.push("    vec4 diffuse = uMaterialDiffuse * light.diffuse * nDotL;"),t.push("    vec4 specular = vec4(0.0);"),t.push("    if (nDotL > 0.0) {"),t.push("      vec3 halfVector = normalize(lightDir + eyeDir);"),t.push("      float nDotHV = max(dot(normal, halfVector), 0.0);"),t.push("      specular = uMaterialSpecular * light.specular * pow(nDotHV, uMaterialShininess);"),t.push("    }"),t.push("    lighting += ambient + diffuse + specular;"),t.push("  }"),t.push("  vColor = clamp(lighting, 0.0, 1.0);"),t.push("  vColor.a = uMaterialDiffuse.a;")),0<i&&(t.push("  for (int i = 0; i < "+i+"; i++) {"),t.push("    vClipDist[i] = dot(position, uClipPlanes[i]);"),t.push("  }")),4&e&&8&e&&(t.push("  vec4 texCoord = uTextureMatrix * vec4(aTexCoord, 0.0, 1.0);"),t.push("  vTexCoord = texCoord.xy / texCoord.w;")),0!=s&&t.push("  vFogDist = -position.z;"),32&e&&t.push("  gl_PointSize = uPointSize;"),t.push("  gl_Position = uProjection * position;"),t.push("}"),t=t.join("\n")},fragmentShaderSource:function(e){var t=[],r=(t.push("precision mediump float;"),(3584&e)>>h),i=(0<r&&t.push("varying float vClipDist["+r+"];"),e&(2|c)?t.push("varying vec4 vColor;"):t.push("uniform vec4 uColor;"),8&e&&(4&e?t.push("varying vec2 vTexCoord;"):t.push("uniform vec2 uTexCoord;"),t.push("uniform sampler2D uSampler;")),(e&o)>>d);if(0!=i&&(1==i?(t.push("uniform float uFogEnd;"),t.push("uniform float uFogRange;")):t.push("uniform float uFogDensity;"),t.push("uniform vec4 uFogColor;"),t.push("varying float vFogDist;")),t.push("void main(void) {"),0<r&&(t.push("  bool clipped = false;"),t.push("  for (int i = 0; i < "+r+"; i++) {"),t.push("    if (vClipDist[i] < 0.0) clipped = true;"),t.push("  }"),t.push("  if (clipped) discard;")),e&(2|c)?t.push("  vec4 color = vColor;"):t.push("  vec4 color = uColor;"),8&e&&(4&e?t.push("  vec2 texCoord = vTexCoord;"):t.push("  vec2 texCoord = uTexCoord;"),t.push("  color *= texture2D(uSampler, texCoord).bgra;")),0!=i){switch(i){case 1:t.push("  float fogAmount = (uFogEnd - vFogDist) / uFogRange;");break;case 2:t.push("  float fogAmount = exp(-uFogDensity * vFogDist);");break;case 3:t.push("  float fogAmount = exp(-uFogDensity * uFogDensity * vFogDist * vFogDist);")}t.push("  color.rgb = mix(uFogColor.rgb, color.rgb, clamp(fogAmount, 0.0, 1.0));")}return t.push("  gl_FragColor = color;"),t.push("}"),t=t.join("\n")},getLocations:function(e,t){var r={},i=(r.uModelView=b.getUniformLocation(e,"uModelView"),r.uProjection=b.getUniformLocation(e,"uProjection"),r.aPosition=b.getAttribLocation(e,"aPosition"),8&t&&(4&t?(r.uTextureMatrix=b.getUniformLocation(e,"uTextureMatrix"),r.aTexCoord=b.getAttribLocation(e,"aTexCoord")):r.uTexCoord=b.getUniformLocation(e,"uTexCoord"),r.uSampler=b.getUniformLocation(e,"uSampler")),2&t?r.aColor=b.getAttribLocation(e,"aColor"):r.uColor=b.getUniformLocation(e,"uColor"),32&t&&(r.uPointSize=b.getUniformLocation(e,"uPointSize")),(448&t)>>u);if(0<i){1&t?r.aNormal=b.getAttribLocation(e,"aNormal"):r.uNormal=b.getUniformLocation(e,"uNormal"),r.uNormalMatrix=b.getUniformLocation(e,"uNormalMatrix"),r.uLightModelAmbient=b.getUniformLocation(e,"uLightModelAmbient"),r.uMaterialAmbient=b.getUniformLocation(e,"uMaterialAmbient"),r.uMaterialDiffuse=b.getUniformLocation(e,"uMaterialDiffuse"),r.uMaterialSpecular=b.getUniformLocation(e,"uMaterialSpecular"),r.uMaterialEmission=b.getUniformLocation(e,"uMaterialEmission"),r.uMaterialShininess=b.getUniformLocation(e,"uMaterialShininess"),r.uLights=[];for(var s=0;s<i;s++){var n={};n.position=b.getUniformLocation(e,"uLights["+s+"].position"),n.ambient=b.getUniformLocation(e,"uLights["+s+"].ambient"),n.diffuse=b.getUniformLocation(e,"uLights["+s+"].diffuse"),n.specular=b.getUniformLocation(e,"uLights["+s+"].specular"),r.uLights.push(n)}}var a=(3584&t)>>h;if(0<a){r.uClipPlanes=[];for(s=0;s<a;s++)r.uClipPlanes.push(b.getUniformLocation(e,"uClipPlanes["+s+"]"))}t=(t&o)>>d;return 0!=t&&(1==t?(r.uFogEnd=b.getUniformLocation(e,"uFogEnd"),r.uFogRange=b.getUniformLocation(e,"uFogRange")):r.uFogDensity=b.getUniformLocation(e,"uFogDensity"),r.uFogColor=b.getUniformLocation(e,"uFogColor")),r},executeList:function(e){var t=g.lists[e];if(t)for(var r=0;r<t.commands.length;r++){var i=t.commands[r];this[i.name].apply(this,i.args)}}}}function transformDirection(e,t,r){var i=t[0],s=t[1],n=t[2],a=e[0]*i+e[4]*s+e[8]*n,o=e[1]*i+e[5]*s+e[9]*n,i=e[2]*i+e[6]*s+e[10]*n;r[0]=a,r[1]=o,r[2]=i,r[3]=t[3]}function transformPoint(e,t,r){var i=t[0],s=t[1],n=t[2],a=e[0]*i+e[4]*s+e[8]*n+e[12],o=e[1]*i+e[5]*s+e[9]*n+e[13],u=e[2]*i+e[6]*s+e[10]*n+e[14],i=e[3]*i+e[7]*s+e[11]*n+e[15];1===i?(r[0]=a,r[1]=o,r[2]=u):(r[0]=a*(i=0!==i?1/i:i),r[1]=o*i,r[2]=u*i),r[3]=t[3]}function multVec4(e,t,r){var i=t[0],s=t[1],n=t[2],t=t[3];r[0]=e[0]*i+e[4]*s+e[8]*n+e[12]*t,r[1]=e[1]*i+e[5]*s+e[9]*n+e[13]*t,r[2]=e[2]*i+e[6]*s+e[10]*n+e[14]*t,r[3]=e[3]*i+e[7]*s+e[11]*n+e[15]*t}function multMatrix(e,t){var r=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],s=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],n=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],a=e[0]*t[4]+e[4]*t[5]+e[8]*t[6]+e[12]*t[7],o=e[1]*t[4]+e[5]*t[5]+e[9]*t[6]+e[13]*t[7],u=e[2]*t[4]+e[6]*t[5]+e[10]*t[6]+e[14]*t[7],l=e[3]*t[4]+e[7]*t[5]+e[11]*t[6]+e[15]*t[7],c=e[0]*t[8]+e[4]*t[9]+e[8]*t[10]+e[12]*t[11],h=e[1]*t[8]+e[5]*t[9]+e[9]*t[10]+e[13]*t[11],f=e[2]*t[8]+e[6]*t[9]+e[10]*t[10]+e[14]*t[11],p=e[3]*t[8]+e[7]*t[9]+e[11]*t[10]+e[15]*t[11],d=e[0]*t[12]+e[4]*t[13]+e[8]*t[14]+e[12]*t[15],m=e[1]*t[12]+e[5]*t[13]+e[9]*t[14]+e[13]*t[15],v=e[2]*t[12]+e[6]*t[13]+e[10]*t[14]+e[14]*t[15],t=e[3]*t[12]+e[7]*t[13]+e[11]*t[14]+e[15]*t[15];e[0]=r,e[1]=i,e[2]=s,e[3]=n,e[4]=a,e[5]=o,e[6]=u,e[7]=l,e[8]=c,e[9]=h,e[10]=f,e[11]=p,e[12]=d,e[13]=m,e[14]=v,e[15]=t}function translateMatrix(e,t,r,i){e[12]+=t*e[0]+r*e[4]+i*e[8],e[13]+=t*e[1]+r*e[5]+i*e[9],e[14]+=t*e[2]+r*e[6]+i*e[10],e[15]+=t*e[3]+r*e[7]+i*e[11]}function rotateMatrix(e,t,r,i,s){var n,a,o,u,l,c,h,f,p,d,m,v=Math.sqrt(r*r+i*i+s*s);0!==v&&(1!==v&&(r*=v=1/v,i*=v,s*=v),v=Math.PI/180,n=Math.cos(t*v),t=Math.sin(t*v),u=e[0]*(h=r*r*(v=1-n)+n)+e[4]*(m=r*i*v-s*t)+e[8]*(a=r*s*v+i*t),l=e[1]*h+e[5]*m+e[9]*a,c=e[2]*h+e[6]*m+e[10]*a,h=e[3]*h+e[7]*m+e[11]*a,f=e[0]*(m=i*r*v+s*t)+e[4]*(a=i*i*v+n)+e[8]*(o=i*s*v-r*t),p=e[1]*m+e[5]*a+e[9]*o,d=e[2]*m+e[6]*a+e[10]*o,m=e[3]*m+e[7]*a+e[11]*o,e[8]=e[0]*(a=s*r*v-i*t)+e[4]*(o=s*i*v+r*t)+e[8]*(i=s*s*v+n),e[9]=e[1]*a+e[5]*o+e[9]*i,e[10]=e[2]*a+e[6]*o+e[10]*i,e[11]=e[3]*a+e[7]*o+e[11]*i,e[0]=u,e[1]=l,e[2]=c,e[3]=h,e[4]=f,e[5]=p,e[6]=d,e[7]=m)}function scaleMatrix(e,t,r,i){e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=r,e[5]*=r,e[6]*=r,e[7]*=r,e[8]*=i,e[9]*=i,e[10]*=i,e[11]*=i}function transposeMatrix(e){var t=e[1],r=e[2],i=e[3],s=e[6],n=e[7],a=e[11];e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=t,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=n,e[14]=a}function invertMatrix(e,t){t=t||e;var r=e[0],i=e[1],s=e[2],n=e[3],a=e[4],o=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],m=e[13],v=e[14],e=e[15],g=r*o-i*a,b=r*u-s*a,k=r*l-n*a,S=i*u-s*o,y=i*l-n*o,I=s*l-n*u,O=c*m-h*d,F=c*v-f*d,A=c*e-p*d,_=h*v-f*m,P=h*e-p*m,w=f*e-p*v,C=g*w-b*P+k*_+S*A-y*F+I*O;0!=C&&(t[0]=(o*w-u*P+l*_)*(C=1/C),t[1]=(-i*w+s*P-n*_)*C,t[2]=(m*I-v*y+e*S)*C,t[3]=(-h*I+f*y-p*S)*C,t[4]=(-a*w+u*A-l*F)*C,t[5]=(r*w-s*A+n*F)*C,t[6]=(-d*I+v*k-e*b)*C,t[7]=(c*I-f*k+p*b)*C,t[8]=(a*P-o*A+l*O)*C,t[9]=(-r*P+i*A-n*O)*C,t[10]=(d*y-m*k+e*g)*C,t[11]=(-c*y+h*k-p*g)*C,t[12]=(-a*_+o*F-u*O)*C,t[13]=(r*_-i*F+s*O)*C,t[14]=(-d*S+m*b-v*g)*C,t[15]=(c*S-h*b+f*g)*C)}function asNormalMatrix(e){var t=new Float32Array(9),r=e[0],i=e[1],s=e[2],n=e[4],a=e[5],o=e[6],u=e[8],l=e[9],e=e[10],c=e*a-o*l,h=o*u-e*n,f=l*n-a*u,p=r*c+i*h+s*f;return 0!=p&&(t[0]=c*(c=1/p),t[3]=(s*l-e*i)*c,t[6]=(o*i-s*a)*c,t[1]=h*c,t[4]=(e*r-s*u)*c,t[7]=(s*n-o*r)*c,t[2]=f*c,t[5]=(i*u-l*r)*c,t[8]=(a*r-i*n)*c),t}function GL_Symbol(e,t){var r,i;if(void 0!==e)return void 0!==t?(i=(r=Object.keys(GL)).indexOf(t),r[i+e-GL[t]]):GL_Symbols[e]||e}function initGLConstants(){for(var e in GL_Symbols={},GL={DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT:16384,FALSE:0,TRUE:1,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,QUADS:7,QUAD_STRIP:8,POLYGON:9,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,NONE:0,FRONT_LEFT:1024,FRONT_RIGHT:1025,BACK_LEFT:1026,BACK_RIGHT:1027,FRONT:1028,BACK:1029,LEFT:1030,RIGHT:1031,FRONT_AND_BACK:1032,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,EXP:2048,EXP2:2049,CW:2304,CCW:2305,POINT_SIZE:2833,POINT_SIZE_RANGE:2834,POINT_SIZE_GRANULARITY:2835,LINE_SMOOTH:2848,LINE_WIDTH:2849,LINE_WIDTH_RANGE:2850,LINE_WIDTH_GRANULARITY:2851,LIST_INDEX:2867,LIGHTING:2896,ALPHA_TEST:3008,ALPHA_TEST:3008,POLYGON_MODE:2880,POLYGON_SMOOTH:2881,CULL_FACE:2884,CULL_FACE_MODE:2885,FRONT_FACE:2886,COLOR_MATERIAL:2903,FOG:2912,FOG_DENSITY:2914,FOG_START:2915,FOG_END:2916,FOG_MODE:2917,FOG_COLOR:2918,DEPTH_RANGE:2928,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_TEST:2960,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_VALUE_MASK:2963,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_WRITEMASK:2968,MATRIX_MODE:2976,NORMALIZE:2977,VIEWPORT:2978,MODELVIEW_STACK_DEPTH:2979,PROJECTION_STACK_DEPTH:2980,TEXTURE_STACK_DEPTH:2981,MODELVIEW_MATRIX:2982,PROJECTION_MATRIX:2983,TEXTURE_MATRIX:2984,ATTRIB_STACK_DEPTH:2992,CLIENT_ATTRIB_STACK_DEPTH:2993,ALPHA_TEST_FUNC:3009,ALPHA_TEST_REF:3010,DITHER:3024,BLEND_DST:3040,BLEND_SRC:3041,BLEND:3042,LOGIC_OP_MODE:3056,DRAW_BUFFER:3073,READ_BUFFER:3074,SCISSOR_BOX:3088,SCISSOR_TEST:3089,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,DOUBLEBUFFER:3122,STEREO:3123,PERSPECTIVE_CORRECTION_HINT:3152,LINE_SMOOTH_HINT:3154,POLYGON_SMOOTH_HINT:3155,FOG_HINT:3156,TEXTURE_GEN_S:3168,TEXTURE_GEN_T:3169,TEXTURE_GEN_R:3170,TEXTURE_GEN_Q:3171,PIXEL_MAP_I_TO_I:3184,PIXEL_MAP_S_TO_S:3185,PIXEL_MAP_I_TO_R:3186,PIXEL_MAP_I_TO_G:3187,PIXEL_MAP_I_TO_B:3188,PIXEL_MAP_I_TO_A:3189,PIXEL_MAP_R_TO_R:3190,PIXEL_MAP_G_TO_G:3191,PIXEL_MAP_B_TO_B:3192,PIXEL_MAP_A_TO_A:3193,PIXEL_MAP_I_TO_I_SIZE:3248,PIXEL_MAP_S_TO_S_SIZE:3249,PIXEL_MAP_I_TO_R_SIZE:3250,PIXEL_MAP_I_TO_G_SIZE:3251,PIXEL_MAP_I_TO_B_SIZE:3252,PIXEL_MAP_I_TO_A_SIZE:3253,PIXEL_MAP_R_TO_R_SIZE:3254,PIXEL_MAP_G_TO_G_SIZE:3255,PIXEL_MAP_B_TO_B_SIZE:3256,PIXEL_MAP_A_TO_A_SIZE:3257,UNPACK_SWAP_BYTES:3312,UNPACK_LSB_FIRST:3313,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,UNPACK_ALIGNMENT:3317,PACK_SWAP_BYTES:3328,PACK_LSB_FIRST:3329,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,TEXTURE_1D:3552,TEXTURE_2D:3553,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,TEXTURE_BORDER_COLOR:4100,DONT_CARE:4352,FASTEST:4353,NICEST:4354,AMBIENT:4608,DIFFUSE:4609,SPECULAR:4610,POSITION:4611,SPOT_CUTOFF:4614,COMPILE:4864,COMPILE_AND_EXECUTE:4865,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,CLEAR:5376,AND:5377,AND_REVERSE:5378,COPY:5379,AND_INVERTED:5380,NOOP:5381,XOR:5382,OR:5383,NOR:5384,EQUIV:5385,INVERT:5386,OR_REVERSE:5387,COPY_INVERTED:5388,OR_INVERTED:5389,NAND:5390,SET:5391,EMISSION:5632,SHININESS:5633,AMBIENT_AND_DIFFUSE:5634,COLOR_INDEXES:5635,MODELVIEW:5888,PROJECTION:5889,TEXTURE:5890,COLOR:6144,DEPTH:6145,STENCIL:6146,STENCIL_INDEX:6401,DEPTH_COMPONENT:6402,RED:6403,GREEN:6404,BLUE:6405,ALPHA:6406,RGB:6407,RGBA:6408,POINT:6912,LINE:6913,FILL:6914,FLAT:7424,SMOOTH:7425,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,VENDOR:7936,RENDERER:7937,VERSION:7938,EXTENSIONS:7939,S:8192,T:8193,R:8194,Q:8195,MODULATE:8448,DECAL:8449,TEXTURE_ENV_MODE:8704,TEXTURE_ENV:8960,EYE_LINEAR:9216,OBJECT_LINEAR:9217,SPHERE_MAP:9218,SPHERE_MAP:9218,TEXTURE_GEN_MODE:9472,OBJECT_PLANE:9473,EYE_PLANE:9474,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,CLIP_PLANE0:12288,CLIP_PLANE1:12289,CLIP_PLANE2:12290,CLIP_PLANE3:12291,CLIP_PLANE4:12292,CLIP_PLANE5:12293,CLIP_PLANE6:12294,CLIP_PLANE7:12295,LIGHT0:16384,LIGHT1:16385,LIGHT2:16386,LIGHT3:16387,LIGHT4:16388,LIGHT5:16389,LIGHT6:16390,LIGHT7:16391,BGRA:32993,CLAMP_TO_EDGE:33071,VERTEX_ARRAY:32884,NORMAL_ARRAY:32885,COLOR_ARRAY:32886,INDEX_ARRAY:32887,TEXTURE_COORD_ARRAY:32888,GENERATE_MIPMAP_SGIS:33169,GENERATE_MIPMAP_HINT_SGIS:33170,TEXTURE_COMPRESSED:34465,CURRENT_BIT:1,POINT_BIT:2,LINE_BIT:4,POLYGON_BIT:8,POLYGON_STIPPLE_BIT:16,PIXEL_MODE_BIT:32,LIGHTING_BIT:64,FOG_BIT:128,ACCUM_BUFFER_BIT:512,VIEWPORT_BIT:2048,TRANSFORM_BIT:4096,ENABLE_BIT:8192,HINT_BIT:32768,EVAL_BIT:65536,LIST_BIT:131072,TEXTURE_BIT:262144,SCISSOR_BIT:524288,ALL_ATTRIB_BITS:1048575,ZERO:0,ONE:1}){var t=GL[e];GL_Symbols[t]=e}}function registerOpenGL(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("libGL.so",OpenGL()):self.setTimeout(registerOpenGL,100)}Object.extend||(Object.extend=function(e){for(var t=1;t<arguments.length;t++)if("object"==typeof arguments[t])for(var r in arguments[t])e[r]=arguments[t][r]}),Function.prototype.subclass||(Function.prototype.subclass=function(e){function t(){if(this.initialize){var e=this.initialize.apply(this,arguments);if(void 0!==e)return e}return this}function r(){}r.prototype=this.prototype,t.prototype=new r;for(var i=1;i<arguments.length;i++)Object.extend(t.prototype,arguments[i]);var e=e.split("."),s=e.pop();return e.reduce(function(e,t){return e[t]||(e[t]={}),e[t]},self)[s]=t}),Object.extend(Squeak,"version",{vmVersion:"SqueakJS 1.3.3",vmDate:"2025-06-03",vmBuild:"unknown",vmPath:"unknown",vmFile:"vm.js",vmMakerVersion:"[VMMakerJS-bf.17 VMMaker-bf.353]",vmInterpreterVersion:"JSInterpreter VMMaker.js-codefrau.1",platformName:"JS",platformSubtype:"unknown",osVersion:"unknown",windowSystem:"unknown",defaultCORSProxy:"https://cors.codefrau.workers.dev/"},"object header",{HeaderTypeMask:3,HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_ProcessSignalingLowSpace:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_ClassFullBlockClosure:37,splOb_ExternalObjectsArray:38,splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},"known classes",{AdditionalMethodState_selector:1,Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,ClassBinding_value:1,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:16,Context_largeFrameSize:56,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,ClosureFull_method:1,ClosureFull_receiver:3,ClosureFull_firstCopiedValue:4,Stream_array:0,Stream_position:1,Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Mutex_owner:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"error codes",{PrimNoErr:0,PrimErrGenericFailure:1,PrimErrBadReceiver:2,PrimErrBadArgument:3,PrimErrBadIndex:4,PrimErrBadNumArgs:5,PrimErrInappropriate:6,PrimErrUnsupported:7,PrimErrNoModification:8,PrimErrNoMemory:9,PrimErrNoCMemory:10,PrimErrNotFound:11,PrimErrBadMethod:12,PrimErrNamedInternal:13,PrimErrObjectMayMove:14,PrimErrLimitExceeded:15,PrimErrObjectIsPinned:16,PrimErrWritePastObject:17},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(e,t){this.externalModules[e]=t}},"time",{Epoch:Date.UTC(1901,0,1)+6e4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1e3)}},"utils",{bytesAsString:function(e){for(var t=[],r=0;r<e.length;)t.push(String.fromCharCode.apply(null,e.subarray(r,r+=16348)));return t.join("")},word64FromUint32:function(e,t){return e<2097152?4294967296*e+t:4292870144<e?4294967296*(e>>0)+t:[e,t]}}),Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(e,t,r,i){this.sqClass=e,this.hash=r;var r=e.pointers[Squeak.Class_format],s=(r>>1&63)+(r>>10&192)-1;this._format=r>>7&15,this._format<8?6!=this._format?0<s+t&&(this.pointers=this.fillArray(s+t,i)):0<t&&(e.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(t)):0<t&&(this.bytes=new Uint8Array(t))},initAsClone:function(e,t){this.sqClass=e.sqClass,this.hash=t,this._format=e._format,e.isFloat?(this.isFloat=e.isFloat,this.float=e.float):(e.pointers&&(this.pointers=e.pointers.slice(0)),e.words&&(this.words=new Uint32Array(e.words)),e.bytes&&(this.bytes=new Uint8Array(e.bytes)))},initFromImage:function(e,t,r,i){this.oop=e,this.sqClass=t,this._format=r,this.hash=i},classNameFromImage:function(e,t){e=e.get(t.get(this.oop)[Squeak.Class_name]);return e&&8<=e._format&&e._format<12?(t=t.get(e.oop),t=e.decodeBytes(t.length,t,0,3&e._format),Squeak.bytesAsString(t)):"Class"},renameFromImage:function(e,t,r){var r=this.sqClass<32?e.get(r[this.sqClass-1]):e.get(this.sqClass);return(r=r&&(r.instProto||r.classInstProto(r.classNameFromImage(e,t))))?((e=new r).oop=this.oop,e.sqClass=this.sqClass,e._format=this._format,e.hash=this.hash,e):this},installFromImage:function(e,t,r,i,s,n){var a,o=this.sqClass,r=(this.sqClass=0<o&&o<32?e.get(r[o-1]):e.get(o),t.get(this.oop)),o=r.length;this._format<5?0<o&&(this.pointers=this.decodePointers(o,a=r,e)):12<=this._format?(t=this.decodeWords(1,r,s)[0]>>10&255,a=this.decodeWords(1+t,r,s),this.pointers=this.decodePointers(1+t,a,e),this.bytes=this.decodeBytes(o-(1+t),r,1+t,3&this._format)):8<=this._format?0<o&&(this.bytes=this.decodeBytes(o,r,0,3&this._format)):this.sqClass==i?(this.isFloat=!0,this.float=this.decodeFloat(r,s,n)):0<o&&(this.words=this.decodeWords(o,r,s)),this.mark=!1},decodePointers:function(e,t,r){for(var i=new Array(e),s=0;s<e;s++){var n=t[s];i[s]=1==(1&n)?n>>1:r.get(n)||42424242}return i},decodeWords:function(e,t,r){for(var i=new DataView(t.buffer,t.byteOffset),s=new Uint32Array(e),n=0;n<e;n++)s[n]=i.getUint32(4*n,r);return s},decodeBytes:function(e,t,r,i){e=4*e-i,i=new Uint8Array(t.buffer,t.byteOffset+4*r,e),t=new Uint8Array(e);return t.set(i),t},decodeFloat:function(e,t,r){e=new DataView(e.buffer,e.byteOffset);return t?(r?e:(t=new ArrayBuffer(8),(r=new DataView(t)).setUint32(0,e.getUint32(4)),r.setUint32(4,e.getUint32(0)),r)).getFloat64(0,!0):e.getFloat64(0,!1)},fillArray:function(e,t){for(var r=[],i=0;i<e;i++)r[i]=t;return r}},"testing",{isWords:function(){return 6===this._format},isBytes:function(){var e=this._format;return 8<=e&&e<=11},isWordsOrBytes:function(){var e=this._format;return 6==e||8<=e&&e<=11},isPointers:function(){return this._format<=4},isWeak:function(){return 4===this._format},isMethod:function(){return 12<=this._format},sameFormats:function(e,t){return e<8?e===t:(12&e)==(12&t)},sameFormatAs:function(e){return this.sameFormats(this._format,e._format)}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(e){if(!this.bytes)return"";for(var t="0123456789ABCDEF",r=[],i=0,s=this.bytes.length-1;0<=s;s--)r.push(t[this.bytes[s]>>4]),r.push(t[15&this.bytes[s]]),i=256*i+this.bytes[s];var e=e?"-":"",n=9007199254740991<i?"≈":"";return e+"16r"+r.join("")+" ("+n+e+i+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(e){var t=this.instSize();return e<=t?this.sqClass.allInstVarNames()[e-1]||"ivar"+(e-1):(e-t).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat)return e=this.float.toString(),/\./.test(e)||(e+=".0"),e;var e=this.sqClass.className();if(/ /.test(e))return"the "+e;switch(e){case"String":case"ByteString":return"'"+this.bytesAsString()+"'";case"Symbol":case"ByteSymbol":return"#"+this.bytesAsString();case"Point":return this.pointers.join("@");case"Rectangle":return this.pointers.join(" corner: ");case"Association":case"ReadOnlyVariableBinding":return this.pointers.join("->");case"LargePositiveInteger":return this.bytesAsNumberString(!1);case"LargeNegativeInteger":return this.bytesAsNumberString(!0);case"Character":var t=this.pointers?this.pointers[0]:this.hash;return"$"+String.fromCharCode(t)+" ("+t.toString()+")";case"CompiledMethod":return this.methodAsString();case"CompiledBlock":return"[] in "+this.blockOuterCode().sqInstName()}return/^[aeiou]/i.test(e)?"an"+e:"a"+e}},"accessing",{pointersSize:function(){return this.pointers?this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){var e=this._format;return 4<e||2===e?0:e<2?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(e){var t=this._format;return t<2?-1:3===t&&e.vm.isContext(this)&&!e.allowAccessBeyondSP?this.pointers[Squeak.Context_stackPointer]:t<6?this.pointersSize()-this.instSize():t<8?this.wordsSize():t<12?this.bytesSize():this.bytesSize()+4*this.pointersSize()},floatData:function(){var e=new ArrayBuffer(8),e=new DataView(e);return e.setFloat64(0,this.float,!1),e},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words||this.uint32Array||(this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>>2):null)},setAddr:function(e){var t=this.snapshotSize();return this.oop=e+4*t.header,e+4*(t.header+t.body)},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;return this.bytes&&(e+=this.bytes.length+3>>>2),{header:63<++e?2:this.sqClass.isCompact?0:1,body:e}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var e=this.snapshotSize();return 4*(e.header+e.body)},writeTo:function(e,t,r){this.bytes&&(this._format|=3&-this.bytes.length);var i=t,s=this.snapshotSize(),n=(15&this._format)<<8|(4095&this.hash)<<17;switch(s.header){case 2:e.setUint32(t,s.body<<2|Squeak.HeaderTypeSizeAndClass),e.setUint32(t+=4,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass),e.setUint32(t+=4,n|Squeak.HeaderTypeSizeAndClass),t+=4;break;case 1:e.setUint32(t,this.sqClass.oop|Squeak.HeaderTypeClass),e.setUint32(t+=4,n|s.body<<2|Squeak.HeaderTypeClass),t+=4;break;case 0:var a=r.compactClasses.indexOf(this.sqClass)+1;e.setUint32(t,n|a<<12|s.body<<2|Squeak.HeaderTypeShort),t+=4}if(this.isFloat)e.setFloat64(t,this.float),t+=8;else if(this.words)for(var o=0;o<this.words.length;o++)e.setUint32(t,this.words[o]),t+=4;else if(this.pointers)for(o=0;o<this.pointers.length;o++)e.setUint32(t,r.objectToOop(this.pointers[o])),t+=4;if(this.bytes){for(o=0;o<this.bytes.length;o++)e.setUint8(t++,this.bytes[o]);t+=3&-this.bytes.length}if(t!==i+this.totalBytes())throw Error("written size does not match");return t}},"as class",{classInstFormat:function(){return this.pointers[Squeak.Class_format]>>7&15},classInstSize:function(){var e=this.pointers[Squeak.Class_format];return(e>>10&192)+(e>>1&63)-1},classInstIsBytes:function(){var e=this.classInstFormat();return 8<=e&&e<=11},classInstIsPointers:function(){return this.classInstFormat()<=4},instVarNames:function(){for(var e=3;e<=4;e++){var t=this.pointers[e].pointers;if(t&&t.length&&t[0].bytes)return t.map(function(e){return e.bytesAsString()})}return[]},allInstVarNames:function(){var e=this.superclass();return e.isNil?this.instVarNames():e.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";for(var e=6;e<=7;e++)if((i=this.pointers[e])&&i.bytes)return i.bytesAsString();for(var t=5;t<=6;t++){var r=this.pointers[t];if(r&&r.pointers)for(var i,e=6;e<=7;e++)if((i=r.pointers[e])&&i.bytes)return i.bytesAsString()+" class"}return"_SOMECLASS_"},defaultInst:function(){return Squeak.Object},classInstProto:function(e){if(this.instProto)return this.instProto;var t=this.defaultInst();try{var r="UndefinedObject"===(r=(e=e||this.className()).replace(/[^A-Za-z0-9]/g,"_"))?"nil":"True"===r?"true_":"False"===r?"false_":(/^[AEIOU]/.test(r)?"an":"a")+r;(t=new Function("return function "+r+"() {};")()).prototype=this.defaultInst().prototype}catch(e){}return Object.defineProperty(this,"instProto",{value:t}),t}},"as method",{methodSignFlag:function(){return!1},methodNumLits:function(){return this.pointers[0]>>9&255},methodNumArgs:function(){return this.pointers[0]>>24&15},methodPrimitiveIndex:function(){var e=805306879&this.pointers[0];return 511<e?(511&e)+(e>>19):e},methodClassForSuper:function(){return this.pointers[this.methodNumLits()].pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return 0<(131072&this.pointers[0])},methodAddPointers:function(e){this.pointers=e},methodTempCount:function(){return this.pointers[0]>>18&63},methodGetLiteral:function(e){return this.pointers[1+e]},methodGetSelector:function(e){return this.pointers[1+e]},methodAsString:function(){return"aCompiledMethod"}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"==typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(e){return e&&e.activeContext===this?e.sp+1:(e=this.pointers[Squeak.Context_stackPointer],Squeak.Context_tempFrameStart+("number"==typeof e?e:0))}}),Squeak.Object.subclass("Squeak.ObjectSpur","initialization",{initInstanceOf:function(e,t,r,i){this.sqClass=e,this.hash=r;var r=e.pointers[Squeak.Class_format],s=65535&r,r=r>>16&31;(this._format=r)<12?r<10?0<s+t&&(this.pointers=this.fillArray(s+t,i)):0<t&&(e.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(t)):0<t&&(this.bytes=new Uint8Array(t))},installFromImage:function(e,t,r,i,s,n,a){var o=this.sqClass;if(o<32)throw Error("Invalid class ID: "+o);if(this.sqClass=r[o],!this.sqClass)throw Error("Class ID not in class table: "+o);var u=t.get(this.oop),l=u.length;switch(this._format){case 0:case 1:case 2:case 3:case 4:case 5:0<l&&(this.pointers=this.decodePointers(l,f=u,e,n,a));break;case 11:l--,this._format=10;case 10:this.sqClass===i?(this.isFloat=!0,this.float=this.decodeFloat(u,s,!0)):0<l&&(this.words=this.decodeWords(l,u,s));break;case 12:case 13:throw Error("16 bit arrays not supported yet");case 20:case 21:case 22:case 23:l--,this._format-=4;case 16:case 17:case 18:case 19:0<l&&(this.bytes=this.decodeBytes(l,u,0,3&this._format));break;case 28:case 29:case 30:case 31:l--,this._format-=4;case 24:case 25:case 26:case 27:var c=this.decodeWords(1,u,s)[0]>>(a?3:1),h=32767&c,f=a?this.decodeWords64(1+h,u,s):this.decodeWords(1+h,u,s),p=a?2*(1+h):1+h;this.pointers=this.decodePointers(1+h,f,e,n,a),this.bytes=this.decodeBytes(l-p,u,p,3&this._format),a&&(this.pointers[0]=2147483648&u[1]|c);break;default:throw Error("Unknown object format: "+this._format)}this.mark=!1},decodeWords64:function(e,t,r){for(var i=new Array(e),s=0;s<e;s++){var n=t[2*s];i[s]=Squeak.word64FromUint32(t[2*s+1],n)}return i},decodePointers:function(e,t,r,i,s){for(var n=new Array(e),a=0;a<e;a++){var o=t[a];if("number"!=typeof o)if(4==(7&o[1]))n[a]=this.decodeSmallFloat(o[0],o[1],s);else{if(1!=(7&o[1]))throw 2==(7&o[1])?Error("Large Immediate Characters not implemented yet"):Error("Large OOPs not implemented yet");n[a]=s.makeLargeFromSmall(o[0],o[1])}else if(1==(1&o))n[a]=s?(0<=o?o<=8589934591:-8589934592<=o)?o/4>>1:s.makeLargeFromSmall((o-(o>>>0))/4294967296>>>0,o>>>0):o>>1;else if(2==(3&o)){if(o<0||8589934591<o)throw Error("Large Immediate Characters not implemented yet");n[a]=i(o>>>(s?3:2))}else s&&4==(7&o)?n[a]=this.decodeSmallFloat((o-(o>>>0))/4294967296>>>0,o>>>0,s):(n[a]=r.get(o)||42424242,n[a])}return n},decodeSmallFloat:function(e,t,r){var i=0,s=0,n=(8&t)<<28;return 0==(e|4294967280&t)?i=n:(i=939524096+(e>>>4)|n,s=t>>>4|(15&e)<<28),r.makeFloat(new Uint32Array([s,i]))},overhead64:function(e){var t,r=0,i=0,s=0;return this._format<=5?r=-2&e.length:24<=this._format?(r=1+(e[0]>>3&32767),t=28<=this._format,1==(1&r)&&(r+=t?1:-1),s=e.length/2,i=e.length-r):s=(i=e.length)/2,{bytes:4*r,sizeHeader:255<=i&&s<255}},initInstanceOfChar:function(e,t){this.oop=t<<2|2,this.sqClass=e,this.hash=t,this._format=7,this.mark=!0},initInstanceOfFloat:function(e,t){this.sqClass=e,this.hash=0,this._format=10,this.isFloat=!0,this.float=this.decodeFloat(t,!0,!0)},initInstanceOfLargeInt:function(e,t){this.sqClass=e,this.hash=0,this._format=16,this.bytes=new Uint8Array(t)},classNameFromImage:function(e,t){e=e.get(t.get(this.oop)[Squeak.Class_name]);return e&&16<=e._format&&e._format<24?(t=t.get(e.oop),t=e.decodeBytes(t.length,t,0,7&e._format),Squeak.bytesAsString(t)):"Class"},renameFromImage:function(e,t,r){var r=r[this.sqClass];return(r=r&&(r.instProto||r.classInstProto(r.classNameFromImage(e,t))))?((e=new r).oop=this.oop,e.sqClass=this.sqClass,e._format=this._format,e.hash=this.hash,e):this}},"accessing",{instSize:function(){return this._format<2?this.pointersSize():this.sqClass.classInstSize()},indexableSize:function(e){var t=this._format;return t<2?-1:3===t&&e.vm.isContext(this)?this.pointers[Squeak.Context_stackPointer]:t<6?this.pointersSize()-this.instSize():t<12?this.wordsSize():t<16?this.shortsSize():t<24?this.bytesSize():4*this.pointersSize()+this.bytesSize()},snapshotSize:function(){var e=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;return this.bytes&&(e+=this.bytes.length+3>>>2),{header:255<=e?2:0,body:e=(e=e+(1&e)+2)<4?4:e}},writeTo:function(e,t,r,i){var s=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0,n=(this.bytes&&(s+=this.bytes.length+3>>>2,this._format|=3&-this.bytes.length),t),a=this._format<<24|4194303&this.sqClass.hash,o=s<<24|4194303&this.hash;if(255<=s&&(e.setUint32(t,s,r),o=255<<24|4194303&this.hash,e.setUint32(t+=4,o,r),t+=4),e.setUint32(t,a,r),e.setUint32(t+=4,o,r),t+=4,this.isFloat)e.setFloat64(t,this.float,r),t+=8;else if(this.words)for(var u=0;u<this.words.length;u++)e.setUint32(t,this.words[u],r),t+=4;else if(this.pointers){a=0;24<=this._format&&(o=this.methodSignFlag()?2147483648:0,o=this.pointers[0]<<1|1|o,e.setUint32(t,o,r),t+=4,a=1);for(u=a;u<this.pointers.length;u++)e.setUint32(t,i(this.pointers[u]),r),t+=4}if(this.bytes){for(u=0;u<this.bytes.length;u++)e.setUint8(t++,this.bytes[u]);t+=3&-this.bytes.length}if((t+=0===s?8:4*(1&s))!==n+this.totalBytes())throw Error("written size does not match");return t}},"testing",{isBytes:function(){var e=this._format;return 16<=e&&e<=23},isPointers:function(){return this._format<=6},isWords:function(){return 10===this._format},isWordsOrBytes:function(){var e=this._format;return 10===e||16<=e&&e<=23},isWeak:function(){return 4===this._format},isMethod:function(){return 24<=this._format},sameFormats:function(e,t){return e<16?e===t:(248&e)==(248&t)}},"as class",{defaultInst:function(){return Squeak.ObjectSpur},classInstFormat:function(){return this.pointers[Squeak.Class_format]>>16&31},classInstSize:function(){return 65535&this.pointers[Squeak.Class_format]},classInstIsBytes:function(){var e=this.classInstFormat();return 16<=e&&e<=23},classInstIsPointers:function(){return this.classInstFormat()<=6},classByteSizeOfInstance:function(e){var t=this.classInstFormat(),r=this.classInstSize();return 4*(r=(r=(r=(r+=t<9?e:16<=t?(e+3)/4|0:12<=t?(e+1)/2|0:10<=t?e:2*e)+(1&r))+(255<=r?4:2))<4?4:r)}},"as compiled block",{blockOuterCode:function(){return this.pointers[this.pointers.length-1]}},"as method",{methodSignFlag:function(){return this.pointers[0]<0},methodNumLits:function(){return 32767&this.pointers[0]},methodPrimitiveIndex:function(){return 0==(65536&this.pointers[0])?0:this.bytes[1]+256*this.bytes[2]},methodAsString:function(){var e=this.pointers[this.pointers.length-1].pointers[Squeak.ClassBinding_value],t=this.pointers[this.pointers.length-2];return t.pointers&&(t=t.pointers[Squeak.AdditionalMethodState_selector]),e.className()+">>"+t.bytesAsString()}}),Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(e){this.headRoom=1e8,this.totalMemory=0,this.headerFlags=0,this.name=e,this.gcCount=0,this.gcMilliseconds=0,this.pgcCount=0,this.pgcMilliseconds=0,this.gcTenured=0,this.allocationCount=0,this.oldSpaceCount=0,this.youngSpaceCount=0,this.newSpaceCount=0,this.hasNewInstances={}},readFromBuffer:function(i,t,r){console.log("squeak: reading "+this.name+" ("+i.byteLength+" bytes)"),this.startupTime=Date.now();for(var s=new DataView(i),n=!1,a=0,e=function(){var e=s.getUint32(a,n);return a+=4,e},o=e,u=4,N=function(e,t){if(t){for(var r=[];r.length<e;)r.push(o());return r}return t=new Uint32Array(i,a,e*u/4),a+=e*u,t},j=[6501,6502,6504,68e3,68002,68004],l=0,c=0;n=!n,a=c,l=o(),!(0<=j.indexOf(72174&l));)if(n||(c+=512),512<c)throw Error("bad image version");var B=0!=(1&(this.version=l)),h=(this.hasClosures=!(0<=[6501,6502,68e3].indexOf(l)),this.isSpur=0!=(16&l),68e3<=l);if(h&&!this.isSpur)throw Error("64 bit non-spur images not supported yet");h&&(o=function(){var e=s.getUint32(a,!0),t=s.getUint32(a+4,!0);return a+=8,Squeak.word64FromUint32(t,e)},u=8);var R=e(),q=o(),f=o(),D=o(),U=e(),G=(h&&e(),o());this.headerFlags=o(),this.savedHeaderWords=[U,G,this.headerFlags];for(var W=0;W<4;W++)this.savedHeaderWords.push(e());var p,U=o(),d=new Map,m=new Map,v=c+R,a=v;if(this.isSpur){this.oldSpaceBytes=U-16;for(var g=a+U,z=0,b=null,k=0,H={};a<g;){for(;a<g-16;){var K=a,S=e(),y=e(),I=y>>>24,O=(255===I&&(I=S,S=e(),y=e()),z+a-8-v),F=4194303&S,X=4194303&y,A=N(I,(x=S>>>24&31)<10&&0<F);a+=h?8*(I<1?1-I:0):4*(I<2?2-I:1&I),32<=F?((E=new Squeak.ObjectSpur).initFromImage(O,F,x,X),p&&(p.nextObject=E),this.oldSpaceCount++,p=E,d.set(f+O,E),m.set(O,A),H[O]=k,h&&(k+=(y=E.overhead64(A)).bytes,y.sizeHeader)&&(H[O]-=8,k-=8)):(k+=a-K,16==F&&(b=b||A),F&&d.set(f+O,A))}if(a!==g-16)throw Error("invalid segment");var Y=e(),_=e(),Z=e();e(),0!==Z&&(g+=Z,z+=_=4278190080&_?4*(16777215&Y):0,k+=16+_,this.oldSpaceBytes+=_+Z)}this.oldSpaceBytes-=k,this.firstOldObject=d.get(f),this.lastOldObject=E,this.lastOldObject.nextObject=null}else{for(;a<v+q;){var P=0,w=0,C=o();switch(C&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:P=C>>>2,w=o(),C=o();break;case Squeak.HeaderTypeClass:w=C-Squeak.HeaderTypeClass,P=(C=o())>>>2&63;break;case Squeak.HeaderTypeShort:P=C>>>2&63,w=C>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}var x,E,O=a-4-v,X=C>>>17&4095,A=N(--P,(x=C>>>8&15)<5);(E=new Squeak.Object).initFromImage(O,w,x,X),w<32&&(E.hash|=268435456),p&&(p.nextObject=E),this.oldSpaceCount++,p=E,d.set(f+O,E),m.set(O,A)}this.firstOldObject=d.get(f+4),this.lastOldObject=E,this.lastOldObject.nextObject=null,this.oldSpaceBytes=q}this.totalMemory=this.oldSpaceBytes+this.headRoom,this.totalMemory=1e6*Math.ceil(this.totalMemory/1e6);var G=d.get(D),J=this.isSpur?this.spurClassTable(d,m,b,G):m.get(d.get(m.get(G.oop)[Squeak.splOb_CompactClasses]).oop),T=null;for(E=this.firstOldObject,p=null;E;)p=T,T=E.renameFromImage(d,m,J),p?p.nextObject=T:this.firstOldObject=T,d.set(f+E.oop,T),E=E.nextObject;this.lastOldObject=T,this.lastOldObject.nextObject=null;var L=d.get(D),Q=m.get(d.get(m.get(L.oop)[Squeak.splOb_CompactClasses]).oop),$=d.get(m.get(L.oop)[Squeak.splOb_ClassFloat]),M=(this.isSpur&&(this.initImmediateClasses(d,m,L),Q=this.spurClassTable(d,m,b,L),B=this.getCharacter.bind(this),this.initSpurOverrides()),this.firstOldObject),V=0,ee=function(){if(M){for(var e=V+(this.oldSpaceCount/20|0);M&&V<e;)M.installFromImage(d,m,Q,$,n,B,h&&{makeFloat:function(e){return this.instantiateFloat(e)}.bind(this),makeLargeFromSmall:function(e,t){return this.instantiateLargeFromSmall(e,t)}.bind(this)}),M=M.nextObject,V++;return r&&r(V/this.oldSpaceCount),!0}return this.specialObjectsArray=L,this.decorateKnownObjects(),this.isSpur?(this.fixSkippedOops(H),h&&this.fixPCs(),this.ensureFullBlockClosureClass(this.specialObjectsArray,Q)):(this.fixCompiledMethods(),this.fixCompactOops()),!1}.bind(this);if(r)self.setTimeout(function e(){ee()?self.setTimeout(e,0):t&&t()},0);else{for(;ee(););t&&t()}},decorateKnownObjects:function(){var e=this.specialObjectsArray.pointers;if(e[Squeak.splOb_NilObject].isNil=!0,e[Squeak.splOb_TrueObject].isTrue=!0,e[Squeak.splOb_FalseObject].isFalse=!0,e[Squeak.splOb_ClassFloat].isFloatClass=!0,!this.isSpur){this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers;for(var t=0;t<this.compactClasses.length;t++)this.compactClasses[t].isNil||(this.compactClasses[t].isCompact=!0)}Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){if(!this.isSpur){for(var e=this.firstOldObject,t=0;e;){var r=268435455<e.hash;r!=!!e.sqClass.isCompact&&r!=(r=0===e.snapshotSize().header)&&(t+=r?-4:4),e.hash&=268435455,e.oop+=t,e=e.nextObject}this.oldSpaceBytes+=t}},fixCompiledMethods:function(){if(!(6502<=this.version))for(var e=this.firstOldObject,t=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];e;)e.isMethod()&&(e.sqClass=t),e=e.nextObject},fixSkippedOops:function(e){for(var t=this.firstOldObject;t;)t.oop-=e[t.oop],t=t.nextObject;if((t=this.lastOldObject).addr()+t.totalBytes()!==this.oldSpaceBytes)throw Error("image size doesn't match object sizes")},fixPCs:function(){for(var e=this.specialObjectsArray.pointers[Squeak.splOb_ClassMethodContext],t=Squeak.Context_instructionPointer,r=Squeak.Context_method,i=this.specialObjectsArray.pointers[Squeak.splOb_ClassBlockClosure],s=Squeak.Closure_startpc,n=Squeak.Closure_outerContext,a=this.firstOldObject;a;)a.sqClass===e?a.pointers[t]-=4*a.pointers[r].pointers.length:a.sqClass===i&&(a.pointers[s]-=4*a.pointers[n].pointers[r].pointers.length),a=a.nextObject},ensureFullBlockClosureClass:function(e,t){e.pointers[Squeak.splOb_ClassFullBlockClosure].isNil&&t[38]&&(e.pointers[Squeak.splOb_ClassFullBlockClosure]=t[38])}},"garbage collection - full",{fullGC:function(e){this.vm.addMessage("fullGC: "+e);var t=Date.now(),r=this.newSpaceCount,i=this.oldSpaceCount,s=this.markReachableObjects(),n=(this.removeUnmarkedOldObjects(),this.appendToOldObjects(s),this.finalizeWeakReferences(),this.allocationCount+=this.newSpaceCount,this.newSpaceCount=0,this.youngSpaceCount=0,this.hasNewInstances={},this.gcCount++,this.gcMilliseconds+=Date.now()-t,i-this.oldSpaceCount),a=s.length,o=this.oldSpaceCount-a,u=r-a,l=i-o;return console.log("Full GC ("+e+"): "+(Date.now()-t)+" ms; before: "+i.toLocaleString()+" old objects; allocated "+r.toLocaleString()+" new; surviving "+o.toLocaleString()+" old; tenuring "+a.toLocaleString()+" new; gc'ed "+l.toLocaleString()+" old and "+u.toLocaleString()+" new; total now: "+this.oldSpaceCount.toLocaleString()+" ("+(0<n?"+":"")+n.toLocaleString()+", "+this.oldSpaceBytes.toLocaleString()+" bytes)"),0<s.length?s[0]:null},gcRoots:function(){return this.vm.storeContextRegisters(),[this.specialObjectsArray,this.vm.activeContext]},markReachableObjects:function(){var e=this.gcRoots(),t=[];for(this.weakObjects=[];0<e.length;){var r=e.pop();if(!r.mark){r.oop<0&&t.push(r),r.mark=!0,r.sqClass.mark||e.push(r.sqClass);var i=r.pointers;if(i){var s=i.length;if(r.isWeak()&&(s=r.sqClass.classInstSize(),this.weakObjects.push(r)),this.vm.isContext(r))for(var n=s=r.contextSizeWithStack();n<i.length;n++)i[n]=this.vm.nilObj;for(n=0;n<s;n++)"object"!=typeof i[n]||i[n].mark||e.push(i[n])}}}return this.isSpur?t:t.sort(function(e,t){return t.oop-e.oop})},removeUnmarkedOldObjects:function(){var e=0,t=0,r=this.firstOldObject;for(r.mark=!1;;){var i=r.nextObject;if(!i)return this.lastOldObject=r,this.lastOldObject.nextObject=null,this.oldSpaceBytes-=t,void(this.oldSpaceCount-=e);i.dirty&&(i.dirty=!1),i.mark?((r=i).mark=!1,r.oop-=t):(r.nextObject=(i=i).nextObject,i.oop=-++this.newSpaceCount,t+=i.totalBytes(),e++)}},appendToOldObjects:function(e){for(var t=this.lastOldObject,r=0;r<e.length;r++){var i=e[r];i.mark=!1,this.oldSpaceBytes=i.setAddr(this.oldSpaceBytes),t.nextObject=i,t=i}t.nextObject=null,this.lastOldObject=t,this.lastOldObject.nextObject=null,this.oldSpaceCount+=e.length,this.gcTenured+=e.length,this.vm.signalLowSpaceIfNecessary(this.bytesLeft())},tenureIfYoung:function(e){e.oop<0&&this.appendToOldObjects([e])},finalizeWeakReferences:function(){var e=this.weakObjects;this.weakObjects=null;for(var t=0;t<e.length;t++){for(var r,i=e[t],s=i.pointers,n=i.sqClass.classInstSize(),a=!1,o=n;o<s.length;o++)s[o].oop<0&&(s[o]=this.vm.nilObj,a=!0);a&&(this.vm.pendingFinalizationSignals++,2<=n)&&(n=i.pointers[Squeak.WeakFinalizerItem_list]).sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]&&(r=n.pointers[Squeak.WeakFinalizationList_first],i.pointers[Squeak.WeakFinalizerItem_next]=r,n.pointers[Squeak.WeakFinalizationList_first]=i)}0<this.vm.pendingFinalizationSignals&&this.vm.forceInterruptCheck()}},"garbage collection - partial",{partialGC:function(e){this.vm.addMessage("partialGC: "+e);var t=Date.now(),r=this.newSpaceCount,i=this.findYoungObjects();return this.appendToYoungSpace(i),this.finalizeWeakReferences(),this.cleanupYoungSpace(i),this.allocationCount+=this.newSpaceCount-i.length,this.youngSpaceCount=i.length,this.newSpaceCount=this.youngSpaceCount,this.pgcCount++,this.pgcMilliseconds+=Date.now()-t,console.log("Partial GC ("+e+"): "+(Date.now()-t)+" ms, found "+this.youngRootsCount.toLocaleString()+" roots in "+this.oldSpaceCount.toLocaleString()+" old, kept "+this.youngSpaceCount.toLocaleString()+" young ("+(r-this.youngSpaceCount).toLocaleString()+" gc'ed)"),i[0]},youngRoots:function(){for(var e=this.gcRoots().filter(function(e){return e.oop<0}),t=this.firstOldObject;t;){if(t.dirty){for(var r=t.pointers,i=!1,s=0;s<r.length;s++){var n=r[s];"object"==typeof n&&n.oop<0&&(e.push(n),i=!0)}i||(t.dirty=!1)}t=t.nextObject}return e},findYoungObjects:function(){var e=this.youngRoots(),t=[];for(this.youngRootsCount=e.length,this.weakObjects=[];0<e.length;){var r=e.pop();if(!r.mark){t.push(r),r.mark=!0,r.sqClass.oop<0&&e.push(r.sqClass);var i=r.pointers;if(i){var s=i.length;if(r.isWeak()&&(s=r.sqClass.classInstSize(),this.weakObjects.push(r)),this.vm.isContext(r))for(var n=s=r.contextSizeWithStack();n<i.length;n++)i[n]=this.vm.nilObj;for(n=0;n<s;n++){var a=i[n];"object"==typeof a&&a.oop<0&&e.push(a)}}}}return this.isSpur?t:t.sort(function(e,t){return t.oop-e.oop})},appendToYoungSpace:function(e){for(var t=this.lastOldObject.oop+1,r=0;r<e.length;r++){var i=e[r];this.hasNewInstances[i.oop]&&(delete this.hasNewInstances[i.oop],this.hasNewInstances[t]=!0),i.oop=t,i.nextObject=e[r+1],t++}},cleanupYoungSpace:function(e){for(var t=e[0],r=-1;t;)this.hasNewInstances[t.oop]&&(delete this.hasNewInstances[t.oop],this.hasNewInstances[r]=!0),t.oop=r,t.mark=!1,t=t.nextObject,r--}},"creating",{registerObject:function(e){return e.oop=-++this.newSpaceCount,this.lastHash=13849+27181*this.lastHash&4294967295,4095&this.lastHash},registerObjectSpur:function(e){return e.oop=-++this.newSpaceCount,0},instantiateClass:function(e,t,r){var i=new(e.classInstProto()),s=this.registerObject(i);return i.initInstanceOf(e,t,s,r),this.hasNewInstances[e.oop]=!0,i},clone:function(e){var t=new(e.sqClass.classInstProto()),r=this.registerObject(t);return t.initAsClone(e,r),this.hasNewInstances[t.sqClass.oop]=!0,t}},"operations",{bulkBecome:function(e,t,r,i){if(!e)return!t;var s=e.length;if(s!==t.length)return!1;for(var n=null,a=(0<this.newSpaceCount?n=this.partialGC("become"):this.vm.storeContextRegisters(),{}),o=0;o<s;o++){if(!(l=e[o]).sqClass)return!1;if(a[l.oop])return!1;a[l.oop]=t[o]}if(r)for(o=0;o<s;o++){if(!(l=t[o]).sqClass)return!1;if(a[l.oop])return!1;a[l.oop]=e[o]}if(i)for(o=0;o<s;o++){if(!t[o].sqClass)return!1;var u=e[o].hash;e[o].hash=t[o].hash,t[o].hash=u,this.isSpur&&this.classTable[u]===e[o]&&(this.classTable[u]=t[o])}this.lastOldObject.nextObject=n;for(var l=this.firstOldObject;l;){var c=a[l.sqClass.oop],h=(c&&(l.sqClass=c).oop<0&&(l.dirty=!0),l.pointers);if(h)for(var f=0;f<h.length;f++)(c=a[h[f].oop])&&(h[f]=c).oop<0&&(l.dirty=!0);l=l.nextObject}return this.lastOldObject.nextObject=null,this.vm.flushMethodCacheAfterBecome(a),!0},objectAfter:function(e){return e.nextObject||this.nextObjectWithGC("nextObject",e)},someInstanceOf:function(e){for(var t=this.firstOldObject;t;){if(t.sqClass===e)return t;t=t.nextObject||this.nextObjectWithGCFor(t,e)}return null},nextInstanceAfter:function(e){for(var t=e.sqClass;;){if(!(e=e.nextObject||this.nextObjectWithGCFor(e,t)))return null;if(e.sqClass===t)return e}},nextObjectWithGC:function(e,t){var r=0<t.oop?0:this.youngSpaceCount;return this.newSpaceCount<=r?null:(t.oop<0&&this.fullGC(e),this.partialGC(e))},nextObjectWithGCFor:function(e,t){return this.hasNewInstances[t.oop]?this.nextObjectWithGC("instance of "+t.className(),e):null},allInstancesOf:function(e){for(var t=this.firstOldObject,r=[];t;)t.sqClass===e&&r.push(t),t=t.nextObject||this.nextObjectWithGCFor(t,e);return r},writeToBuffer:function(){function e(e){t.setUint32(r,e),r+=4}var t=new DataView(new ArrayBuffer(64+this.oldSpaceBytes)),r=0;for(e(this.formatVersion()),e(64),e(this.oldSpaceBytes),e(this.firstOldObject.addr()),e(this.objectToOop(this.specialObjectsArray)),e(this.lastHash),e(52429400);r<64;)e(0);for(var i=this.firstOldObject,s=0;i;)r=i.writeTo(t,r,this),i=i.nextObject,s++;if(r!==t.byteLength)throw Error("wrong image size");if(s!==this.oldSpaceCount)throw Error("wrong object count");return t.buffer},objectToOop:function(e){if("number"==typeof e)return e<<1|1;if(e.oop<0)throw Error("temporary oop");return e.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.isSpur?6521:this.hasClosures?6504:6502},segmentVersion:function(){var e=this.isSpur?"seod":"does";return this.formatVersion()|e.charCodeAt(0)<<24},storeImageSegment:function(e,t,r){var i=new DataView(e.words.buffer),s=0,n=t.pointers,a=0;i.setUint32(s,this.segmentVersion()),s+=4,this.fullGC("storeImageSegment"),r.mark=!0;for(var o=0;o<r.pointers.length;o++)"object"==typeof r.pointers[o]&&(r.pointers[o].mark=!0);this.markReachableObjects(),r.mark=!1;for(o=0;o<r.pointers.length;o++)"object"==typeof r.pointers[o]&&(r.pointers[o].mark=!1);var u={},l=[];function c(e){var t=u[e.oop];if(!t){if(e.mark){if(a>=n.length)return 0;t=2147483652+4*a,n[a++]=e}else{if(s+e.totalBytes()>i.byteLength)return 0;t=s+4*(e.snapshotSize().header+1),s=e.writeTo(i,s,this),l.push(e)}u[e.oop]=t}return t}function h(){for(var e=this.firstOldObject;e;)e.mark=!1,e=e.nextObject;return this.weakObjects=null,!1}for(c=c.bind(this),h=h.bind(this),c(r);0<l.length;){var f=l.shift(),p=u[f.oop],d=f.snapshotSize().header,m=f.pointers;if(0<d){var v=c(f.sqClass);if(!v)return h();d=1===d?Squeak.HeaderTypeClass:Squeak.HeaderTypeSizeAndClass;i.setUint32(p-8,v|d)}if(m)for(o=0;o<m.length;o++){var g=m[o];if("object"==typeof g){g=c(g);if(!g)return h();i.setUint32(p+4*o,g)}}}for(var f=e.oop<t.oop?e:t,b=0;f;)f.oop-=b,f===e?(b+=4*f.words.length-s,f.words=new Uint32Array(f.words.buffer.slice(0,s))):f===t&&(b+=4*(f.pointers.length-a),f.pointers.length=a),f=f.nextObject;return this.oldSpaceBytes-=b,h(),!0},loadImageSegment:function(e,t){if(1===e.words.length)return e.nextObject;var i=new DataView(e.words.buffer),r=!1,s=0,n=function(){var e=i.getUint32(s,r);return s+=4,e},a=n();if(!0&a&&(r=!0,!(s=0)&n()))return console.error("image segment format not supported"),null;this.tenureIfYoung(e);for(var o=e,u=o.nextObject,l=e.oop,c=new Map,h=new Map;s<i.byteLength;){var f=0,p=0,d=n();switch(d&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:f=d>>>2,p=n(),d=n();break;case Squeak.HeaderTypeClass:p=d-Squeak.HeaderTypeClass,f=(d=n())>>>2&63;break;case Squeak.HeaderTypeShort:f=d>>>2&63,p=d>>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}var m=s,v=d>>>8&15,g=d>>>17&4095,b=((e,t)=>{if(t<5){for(var r=[];r.length<e;)r.push(n());return r}return t=new Uint32Array(i.buffer,s,e),s+=4*e,t})(--f,v),k=new Squeak.Object;k.initFromImage(m+l,p,v,g),o.nextObject=k,this.oldSpaceCount++,c.set(m,o=k),h.set(m+l,b)}k.nextObject=u;for(var S=0;S<t.pointers.length;S++)c.set(2147483652+4*S,t.pointers[S]);for(var a=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,y=0,I=a.map(function(e){return c.set(--y,e),y}),a=(e.words=new Uint32Array([e.words[0]]),delete e.uint8Array,e.nextObject),O=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat],F=a;F.installFromImage(c,h,I,O,r,!1),(F=F.nextObject)!==u;);return a}},"spur support",{initSpurOverrides:function(){this.registerObject=this.registerObjectSpur,this.writeToBuffer=this.writeToBufferSpur,this.storeImageSegment=this.storeImageSegmentSpur,this.loadImageSegment=this.loadImageSegmentSpur},spurClassTable:function(e,t,r,i){for(var s,n,a={},o=this.firstOldObject,u=0;u<4096;u++){var l=e.get(r[u]);if(1024===(l=l.oop?t.get(l.oop):l).length)for(var c=0;c<1024;c++){var h,f=e.get(l[c]);if(!f)throw Error("Invalid class table entry (oop "+l[c]+")");f!==o&&(a[h=1024*u+c]=f)}}for(s in Squeak)/^splOb_Class/.test(s)&&(n=e.get(t.get(i.oop)[Squeak[s]]))!==o&&0<(h=n.hash)&&h<1024&&(a[h]=n);return a[3]=a[1],this.classTable=a,this.classTableIndex=1024,a},enterIntoClassTable:function(e){for(var t=this.classTableIndex,r=this.classTable;t<=4194303;){if(!r[t])return(r[t]=e).hash=t,this.classTableIndex=t;t++}return console.error("class table full?"),null},initImmediateClasses:function(e,t,r){t=t.get(r.oop);this.characterClass=e.get(t[Squeak.splOb_ClassCharacter]),this.floatClass=e.get(t[Squeak.splOb_ClassFloat]),this.largePosIntClass=e.get(t[Squeak.splOb_ClassLargePositiveInteger]),this.largeNegIntClass=e.get(t[Squeak.splOb_ClassLargeNegativeInteger]),this.characterClass.classInstProto("Character"),this.floatClass.classInstProto("BoxedFloat64"),this.largePosIntClass.classInstProto("LargePositiveInteger"),this.largeNegIntClass.classInstProto("LargeNegativeInteger"),this.characterTable={}},getCharacter:function(e){var t=this.characterTable[e];return t||((t=new this.characterClass.instProto).initInstanceOfChar(this.characterClass,e),this.characterTable[e]=t),t},instantiateFloat:function(e){var t=new this.floatClass.instProto;return this.registerObjectSpur(t),this.hasNewInstances[this.floatClass.oop]=!0,t.initInstanceOfFloat(this.floatClass,e),t},instantiateLargeFromSmall:function(e,t){t=e<<29|t>>>3;for(var r=(e>>=3)<0,i=(r&&(e=-e,0!==(t=-t))&&e--,0===e?4:e<=255?5:e<=65535?6:e<=16777215?7:8),r=r?this.largeNegIntClass:this.largePosIntClass,s=new r.instProto,n=(this.registerObjectSpur(s),this.hasNewInstances[r.oop]=!0,s.initInstanceOfLargeInt(r,i),s.bytes),a=0;a<4;a++)n[a]=255&t,t>>=8;for(a=4;a<i;a++)n[a]=255&e,e>>=8;return s},ensureClassesInTable:function(){for(var e=this.firstOldObject,t=1024;e;){var r=e.sqClass;if(0===r.hash&&this.enterIntoClassTable(r),t<r.hash&&(t=r.hash),this.classTable[r.hash]!==r)throw Error("Class not in class table");e=e.nextObject}return 1+(t>>10)},classTableBytes:function(e){return 4*(4108+1028*e)},writeFreeLists:function(e,t,r,i){return e.setUint32(t,167772178,r),e.setUint32(t+=4,536870912,r),t=t+4+128},writeClassTable:function(e,t,r,i,s){e.setUint32(t,4104,r),e.setUint32(t+=4,4278190080,r),e.setUint32(t+=4,33554448,r),e.setUint32(t+=4,4278190080,r),t+=4;for(var n=0;n<s;n++)e.setUint32(t,16624+4112*n,r),t+=4;t+=4*(4104-s);for(var a=0,n=0;n<s;n++){e.setUint32(t,1024,r),t+=4,e.setUint32(t,4278190080,r),t+=4,e.setUint32(t,33554448,r),t+=4,e.setUint32(t,4278190080,r),t+=4;for(var o=0;o<1024;o++){var u=this.classTable[a];if(u&&u.pointers){if(!u.hash)throw Error("class without id");(u.hash!==a&&32<=a||u.oop<0)&&(console.warn("freeing class index "+a+" "+u.className()),u=null,delete this.classTable[a])}u&&e.setUint32(t,i(u),r),t+=4,a++}}return t},writeToBufferSpur:function(){var e=this.ensureClassesInTable(),t=136+this.classTableBytes(e),r=new DataView(new ArrayBuffer(64+t+this.oldSpaceBytes+16)),i=!0,s=Date.now(),n=0;function a(e){r.setUint32(n,e,i),n+=4}function o(e){if("number"==typeof e)return e<<1|1;if(7===e._format){if(e.hash!==e.oop>>2||2!=(3&e.oop))throw Error("Bad immediate char");return e.oop}if(e.oop<0)throw Error("temporary oop");return e.oop<48?e.oop:e.oop+t}for(a(this.formatVersion()),a(64),a(t+this.oldSpaceBytes+16),a(this.firstOldObject.addr()),a(o(this.specialObjectsArray)),this.savedHeaderWords.forEach(a),a(t+this.oldSpaceBytes+16);n<64;)a(0);var u=0,n=(l=this.firstOldObject).writeTo(r,n,i,o),l=l.nextObject;for(u++,n=l.writeTo(r,n,i,o),l=l.nextObject,u++,n=l.writeTo(r,n,i,o),l=l.nextObject,u++,n=this.writeFreeLists(r,n,i,o),n=this.writeClassTable(r,n,i,o,e);l;)n=l.writeTo(r,n,i,o),l=l.nextObject,u++;if(a(1241513987),a(8388608),a(0),a(0),n!==r.byteLength)throw Error("wrong image size");if(u!==this.oldSpaceCount)throw Error("wrong object count");e=Date.now()-s;return console.log("Wrote "+u+" objects in "+e+" ms, image size "+n+" bytes"),r.buffer},storeImageSegmentSpur:function(e,t,r){return this.vm.warnOnce("not implemented for Spur yet: primitive 98 (primitiveStoreImageSegment)"),!1},loadImageSegmentSpur:function(e,t){return this.vm.warnOnce("not implemented for Spur yet: primitive 99 (primitiveLoadImageSegment)"),null}}),Object.subclass("Squeak.Interpreter","initialization",{initialize:function(e,t,r){console.log("squeak: initializing interpreter "+Squeak.vmVersion+" ("+Squeak.vmDate+")"),this.Squeak=Squeak,this.image=e,(this.image.vm=this).options=r||{},this.primHandler=new Squeak.Primitives(this,t),this.loadImageState(),this.initVMState(),this.loadInitialContext(),this.hackImage(),this.initCompiler(),console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers,this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers,this.nilObj=this.specialObjects[Squeak.splOb_NilObject],this.falseObj=this.specialObjects[Squeak.splOb_FalseObject],this.trueObj=this.specialObjects[Squeak.splOb_TrueObject],this.hasClosures=this.image.hasClosures,this.getGlobals=this.globalsGetter(),this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0),6501==this.image.version&&(this.primHandler.reverseDisplay=!0)},initVMState:function(){this.byteCodeCount=0,this.sendCount=0,this.interruptCheckCounter=0,this.interruptCheckCounterFeedBackReset=1e3,this.interruptChecksEveryNms=3,this.lowSpaceThreshold=1e6,this.signalLowSpace=!1,this.nextPollTick=0,this.nextWakeupTick=0,this.lastTick=0,this.interruptKeycode=2094,this.interruptPending=!1,this.pendingFinalizationSignals=0,this.freeContexts=this.nilObj,this.freeLargeContexts=this.nilObj,this.reclaimableContextCount=0,this.nRecycledContexts=0,this.nAllocatedContexts=0,this.methodCacheSize=1024,this.methodCacheMask=this.methodCacheSize-1,this.methodCacheRandomish=0,this.methodCache=[];for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1,this.breakOutTick=0,this.breakOnMethod=null,this.breakOnNewMethod=!1,this.breakOnMessageNotUnderstood=!1,this.breakOnContextChanged=!1,this.breakOnContextReturned=null,this.messages={},this.startupTime=Date.now()},loadInitialContext:function(){var e=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess];this.activeContext=e.pointers[Squeak.Proc_suspendedContext],this.activeContext.dirty=!0,this.fetchContextRegisters(this.activeContext),this.reclaimableContextCount=0},globalsGetter:function(){var e=this.specialObjects[Squeak.splOb_SmalltalkDictionary],t=e.sqClass.className();if("SystemDictionary"===(t="Association"===t?(e=e.pointers[1]).sqClass.className():t))return function(){return e.pointers[1].pointers};if("SmalltalkImage"===t){var r=e.pointers[0],t=r.sqClass.className();if("SystemDictionary"===t)return function(){return r.pointers[1].pointers};if("Environment"===t)return function(){return r.pointers[2].pointers[1].pointers}}return console.warn("cannot find global dict"),function(){return[]}},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==new Function("return 42")())return console.warn("function constructor not working, disabling JIT")}catch(e){return console.warn("disabling JIT: "+e)}var e=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(e<10)return console.warn("Slow machine detected (loaded "+(1e3*e|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler");var t=new Squeak.Compiler(this);t.compile&&(this.compiler=t)}catch(e){console.warn("Compiler: "+e)}this.compiler||console.warn("SqueakJS will be running in interpreter mode only (slow)")},hackImage:function(){var e=this.method.methodSignFlag();[{method:"SmalltalkImage>>wordSize",literal:{index:1,old:8,hack:4,skip:this.nilObj},enabled:!0},{method:"ReleaseBuilder class>>prepareEnvironment",bytecode:{pc:28,old:216,hack:135},enabled:!e&!1===this.options.wizard},{method:"ReleaseBuilder class>>prepareEnvironment",bytecode:{closure:9,pc:5,old:129,hack:216},enabled:e&!1===this.options.wizard},{method:"ReleaseBuilder class>>prepareEnvironment",bytecode:{closure:9,pc:2,old:144,hack:216},enabled:e&!1===this.options.welcome},{method:"Latin1Environment class>>systemConverterClass",bytecode:{pc:53,old:69,hack:73},enabled:!this.image.isSpur},{method:"Latin1Environment class>>systemConverterClass",bytecode:{pc:38,old:22,hack:19},enabled:this.image.isSpur&&e},{method:"Latin1Environment class>>systemConverterClass",bytecode:{pc:50,old:68,hack:72},enabled:this.image.isSpur&&!e},{method:"FFIPlatformDescription>>abi",literal:{index:21,old_str:"UNKNOWN_ABI",new_str:"IA32"},enabled:e}].forEach(function(t){try{var e,r,i,s,n=t.enabled&&this.findMethod(t.method);n&&(e=t.primitive,i=t.literal,s=!0,(r=t.bytecode)&&r.closure&&(n=n.pointers[r.closure]),e?n.pointers[0]|=e:r&&n.bytes[r.pc]===r.old?n.bytes[r.pc]=r.hack:r&&n.bytes[r.pc]===r.hack?s=!1:i&&i.old_str&&n.pointers[i.index].bytesAsString()===i.old_str?n.pointers[i.index]=this.primHandler.makeStString(i.new_str):i&&n.pointers[i.index].pointers?.[1]===i.skip?s=!1:i&&n.pointers[i.index].pointers?.[1]===i.old?n.pointers[i.index].pointers[1]=i.hack:i&&n.pointers[i.index].pointers?.[1]===i.hack?s=!1:(s=!1,console.warn("Not hacking "+t.method)),s)&&console.warn("Hacking "+t.method)}catch(e){console.error("Failed to hack "+t.method+" with error "+e)}},this)}},"interpreting",{interpretOne:function(e){if(!this.method.compiled){if(this.method.methodSignFlag())return this.interpretOneSistaWithExtensions(e,0,0);var t,r=this.Squeak;switch(this.byteCodeCount++,t=this.nextByte()){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&t]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.homeContext.pointers[r.Context_tempFrameStart+(15&t)]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&t));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:return void this.push(this.method.methodGetLiteral(31&t).pointers[r.Assn_value]);case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:return this.receiver.dirty=!0,void(this.receiver.pointers[7&t]=this.pop());case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:return void(this.homeContext.pointers[r.Context_tempFrameStart+(7&t)]=this.pop());case 112:return void this.push(this.receiver);case 113:return void this.push(this.trueObj);case 114:return void this.push(this.falseObj);case 115:return void this.push(this.nilObj);case 116:return void this.push(-1);case 117:return void this.push(0);case 118:return void this.push(1);case 119:return void this.push(2);case 120:return void this.doReturn(this.receiver);case 121:return void this.doReturn(this.trueObj);case 122:return void this.doReturn(this.falseObj);case 123:return void this.doReturn(this.nilObj);case 124:return void this.doReturn(this.pop());case 125:return void this.doReturn(this.pop(),this.activeContext.pointers[r.BlockContext_caller]);case 126:case 127:return void this.nono();case 128:return void this.extendedPush(this.nextByte());case 129:return void this.extendedStore(this.nextByte());case 130:return void this.extendedStorePop(this.nextByte());case 131:return s=this.nextByte(),void this.send(this.method.methodGetSelector(31&s),s>>5,!1);case 132:return void this.doubleExtendedDoAnything(this.nextByte());case 133:return s=this.nextByte(),void this.send(this.method.methodGetSelector(31&s),s>>5,!0);case 134:return s=this.nextByte(),void this.send(this.method.methodGetSelector(63&s),s>>6,!1);case 135:return void this.pop();case 136:return void this.push(this.top());case 137:return void this.push(this.exportThisContext());case 138:return void this.pushNewArray(this.nextByte());case 139:return void this.callPrimBytecode(129);case 140:return s=this.nextByte(),void this.push(this.homeContext.pointers[r.Context_tempFrameStart+this.nextByte()].pointers[s]);case 141:var i,s=this.nextByte();return(i=this.homeContext.pointers[r.Context_tempFrameStart+this.nextByte()]).pointers[s]=this.top(),void(i.dirty=!0);case 142:return s=this.nextByte(),(i=this.homeContext.pointers[r.Context_tempFrameStart+this.nextByte()]).pointers[s]=this.pop(),void(i.dirty=!0);case 143:return void this.pushClosureCopy();case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:return void(this.pc+=1+(7&t));case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.jumpIfFalse(1+(7&t));case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:return s=this.nextByte(),this.pc+=256*((7&t)-4)+s,void((7&t)<4&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 168:case 169:case 170:case 171:return void this.jumpIfTrue(256*(3&t)+this.nextByte());case 172:case 173:case 174:case 175:return void this.jumpIfFalse(256*(3&t)+this.nextByte());case 176:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 177:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 178:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 179:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 180:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 181:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 182:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 183:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 184:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&t));case 185:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 186:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 187:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&t));case 188:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 189:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&t));case 190:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&t));case 191:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&t));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return void(this.primHandler.quickSendOther(this.receiver,15&t)||this.sendSpecial(16+(15&t)));case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:return void this.send(this.method.methodGetSelector(15&t),0,!1);case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:return void this.send(this.method.methodGetSelector(15&t),1,!1);case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:return void this.send(this.method.methodGetSelector(15&t),2,!1)}throw Error("not a bytecode: "+t)}if(e){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(e);this.breakNow()}this.method.compiled(this)},interpretOneSistaWithExtensions:function(e,t,r){var i,s,n,a=this.Squeak;switch(this.byteCodeCount++,i=this.nextByte()){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&i]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.method.methodGetLiteral(15&i).pointers[a.Assn_value]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&i));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:return void this.push(this.homeContext.pointers[a.Context_tempFrameStart+(7&i)]);case 72:case 73:case 74:case 75:return void this.push(this.homeContext.pointers[a.Context_tempFrameStart+(3&i)+8]);case 76:return void this.push(this.receiver);case 77:return void this.push(this.trueObj);case 78:return void this.push(this.falseObj);case 79:return void this.push(this.nilObj);case 80:return void this.push(0);case 81:return void this.push(1);case 82:return 0==r?void this.push(this.exportThisContext()):void this.nono();case 83:return void this.push(this.top());case 84:case 85:case 86:case 87:return void this.nono();case 88:return void this.doReturn(this.receiver);case 89:return void this.doReturn(this.trueObj);case 90:return void this.doReturn(this.falseObj);case 91:return void this.doReturn(this.nilObj);case 92:return void this.doReturn(this.pop());case 93:return void this.doReturn(this.nilObj,this.activeContext.pointers[a.BlockContext_caller]);case 94:return 0==t?void this.doReturn(this.pop(),this.activeContext.pointers[a.BlockContext_caller]):void this.nono();case 95:return;case 96:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 97:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 98:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 99:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 100:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 101:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 102:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 103:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 104:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&i));case 105:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&i));case 106:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&i));case 107:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&i));case 108:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&i));case 109:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&i));case 110:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&i));case 111:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&i));case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:return void(this.primHandler.quickSendOther(this.receiver,15&i)||this.sendSpecial(16+(15&i)));case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:case 141:case 142:case 143:return void this.send(this.method.methodGetSelector(15&i),0,!1);case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.send(this.method.methodGetSelector(15&i),1,!1);case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:return void this.send(this.method.methodGetSelector(15&i),2,!1);case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:return void(this.pc+=1+(7&i));case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:return void this.jumpIfTrue(1+(7&i));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:return void this.jumpIfFalse(1+(7&i));case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return this.receiver.dirty=!0,void(this.receiver.pointers[7&i]=this.pop());case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:return void(this.homeContext.pointers[a.Context_tempFrameStart+(7&i)]=this.pop());case 216:return void this.pop();case 217:return void this.nono();case 218:case 219:case 220:case 221:case 222:case 223:return void this.nono();case 224:return o=this.nextByte(),void this.interpretOneSistaWithExtensions(e,(t<<8)+o,r);case 225:return o=this.nextByte(),void this.interpretOneSistaWithExtensions(e,t,(r<<8)+(o<128?o:o-256));case 226:return o=this.nextByte(),void this.push(this.receiver.pointers[o+(t<<8)]);case 227:return o=this.nextByte(),void this.push(this.method.methodGetLiteral(o+(t<<8)).pointers[a.Assn_value]);case 228:return o=this.nextByte(),void this.push(this.method.methodGetLiteral(o+(t<<8)));case 229:return o=this.nextByte(),void this.push(this.homeContext.pointers[a.Context_tempFrameStart+o]);case 230:return void this.nono();case 231:return void this.pushNewArray(this.nextByte());case 232:return o=this.nextByte(),void this.push(o+(r<<8));case 233:return o=this.nextByte(),void this.push(this.image.getCharacter(o+(r<<8)));case 234:return o=this.nextByte(),void this.send(this.method.methodGetSelector((o>>3)+(t<<5)),(7&o)+(r<<3),!1);case 235:var o=this.nextByte(),u=this.method.methodGetSelector((o>>3)+(t<<5));return 64<=r?void this.sendSuperDirected(u,(7&o)+((63&r)<<3)):void this.send(u,(7&o)+(r<<3),!0);case 236:return void this.nono();case 237:u=this.nextByte()+(r<<8);return this.pc+=u,void(u<0&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 238:return void this.jumpIfTrue(this.nextByte()+(r<<8));case 239:return void this.jumpIfFalse(this.nextByte()+(r<<8));case 240:return this.receiver.dirty=!0,void(this.receiver.pointers[this.nextByte()+(t<<8)]=this.pop());case 241:return(s=this.method.methodGetLiteral(this.nextByte()+(t<<8))).dirty=!0,void(s.pointers[a.Assn_value]=this.pop());case 242:return void(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]=this.pop());case 243:return this.receiver.dirty=!0,void(this.receiver.pointers[this.nextByte()+(t<<8)]=this.top());case 244:return(s=this.method.methodGetLiteral(this.nextByte()+(t<<8))).dirty=!0,void(s.pointers[a.Assn_value]=this.top());case 245:return void(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]=this.top());case 246:case 247:return void this.nono();case 248:return void this.callPrimBytecode(245);case 249:return void this.pushFullClosure(t);case 250:return void this.pushClosureCopyExtended(t,r);case 251:return o=this.nextByte(),void this.push(this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()].pointers[o]);case 252:return o=this.nextByte(),(n=this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]).pointers[o]=this.top(),void(n.dirty=!0);case 253:return o=this.nextByte(),(n=this.homeContext.pointers[a.Context_tempFrameStart+this.nextByte()]).pointers[o]=this.pop(),void(n.dirty=!0);case 254:case 255:return void this.nono()}throw Error("not a bytecode: "+i)},interpret:function(e,t){if(this.frozen)return"frozen";for(this.isIdle=!1,this.breakOutOfInterpreter=!1,this.breakAfter(e||500);!1===this.breakOutOfInterpreter;)this.method.compiled?this.method.compiled(this):this.interpretOne();return"function"==typeof this.breakOutOfInterpreter?this.breakOutOfInterpreter(t):(e="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0,t&&t(e),e)},goIdle:function(){var e=0!==this.nextWakeupTick,t=(this.forceInterruptCheck(),this.checkForInterrupts(),0!==this.nextWakeupTick);this.isIdle=t||!e,this.breakOut()},freeze:function(e){this.frozen=!0,this.breakOutOfInterpreter=function(e){if(e)return t=e,"frozen";throw Error("need function to restart interpreter")}.bind(this);var t,r=function(){if(this.frozen=!1,!t)throw Error("no continue function");t(0)}.bind(this);return e&&self.setTimeout(function(){e(r)},0),r},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.method.bytes[this.pc++]},nono:function(){throw Error("Oh No!")},forceInterruptCheck:function(){this.interruptCheckCounter=-1e3},checkForInterrupts:function(){var e,t=this.primHandler.millisecondClockValue();t<this.lastTick&&(this.nextPollTick=t+(this.nextPollTick-this.lastTick),this.breakOutTick=t+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick)&&(this.nextWakeupTick=t+(this.nextWakeupTick-this.lastTick)),-100<this.interruptCheckCounter&&(t-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+=10:this.interruptCheckCounterFeedBackReset<=1e3?this.interruptCheckCounterFeedBackReset=1e3:this.interruptCheckCounterFeedBackReset-=12),this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset,this.lastTick=t,this.signalLowSpace&&(this.signalLowSpace=!1,(e=this.specialObjects[Squeak.splOb_TheLowSpaceSemaphore]).isNil||this.primHandler.synchronousSignal(e)),this.interruptPending&&(this.interruptPending=!1,(e=this.specialObjects[Squeak.splOb_TheInterruptSemaphore]).isNil||this.primHandler.synchronousSignal(e)),0!==this.nextWakeupTick&&t>=this.nextWakeupTick&&(this.nextWakeupTick=0,(e=this.specialObjects[Squeak.splOb_TheTimerSemaphore]).isNil||this.primHandler.synchronousSignal(e)),0<this.pendingFinalizationSignals&&(e=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore],this.pendingFinalizationSignals=0,e.isNil||this.primHandler.synchronousSignal(e)),0<this.primHandler.semaphoresToSignal.length&&this.primHandler.signalExternalSemaphores(),this.method.compiled||this.compileIfPossible(this.method),t>=this.breakOutTick&&this.breakOut()},extendedPush:function(e){var t=63&e;switch(e>>6){case 0:this.push(this.receiver.pointers[t]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+t]);break;case 2:this.push(this.method.methodGetLiteral(t));break;case 3:this.push(this.method.methodGetLiteral(t).pointers[Squeak.Assn_value])}},extendedStore:function(e){var t=63&e;switch(e>>6){case 0:this.receiver.dirty=!0,this.receiver.pointers[t]=this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+t]=this.top();break;case 2:this.nono();break;case 3:var r=this.method.methodGetLiteral(t);r.dirty=!0,r.pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(e){var t=63&e;switch(e>>6){case 0:this.receiver.dirty=!0,this.receiver.pointers[t]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+t]=this.pop();break;case 2:this.nono();break;case 3:var r=this.method.methodGetLiteral(t);r.dirty=!0,r.pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(e){var t=this.nextByte();switch(e>>5){case 0:this.send(this.method.methodGetSelector(t),31&e,!1);break;case 1:this.send(this.method.methodGetSelector(t),31&e,!0);break;case 2:this.push(this.receiver.pointers[t]);break;case 3:this.push(this.method.methodGetLiteral(t));break;case 4:this.push(this.method.methodGetLiteral(t).pointers[Squeak.Assn_value]);break;case 5:this.receiver.dirty=!0,this.receiver.pointers[t]=this.top();break;case 6:this.receiver.dirty=!0,this.receiver.pointers[t]=this.pop();break;case 7:var r=this.method.methodGetLiteral(t);r.dirty=!0,r.pointers[Squeak.Assn_value]=this.top()}},jumpIfTrue:function(e){var t=this.pop();t.isTrue?this.pc+=e:t.isFalse||(this.push(t),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},jumpIfFalse:function(e){var t=this.pop();t.isFalse?this.pc+=e:t.isTrue||(this.push(t),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1))},sendSpecial:function(e){this.send(this.specialSelectors[2*e],this.specialSelectors[2*e+1],!1)},callPrimBytecode:function(e){this.pc+=2,this.primFailCode&&(this.method.bytes[this.pc]===e&&this.stackTopPut(this.getErrorObjectFromPrimFailCode()),this.primFailCode=0)},getErrorObjectFromPrimFailCode:function(){var e=this.specialObjects[Squeak.splOb_PrimErrTableIndex];if(e&&e.pointers){e=e.pointers[this.primFailCode-1];if(e)return e}return this.primFailCode}},"closures",{pushNewArray:function(e){var t=127<e,r=127&e,i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],r);if(t){for(var s=0;s<r;s++)i.pointers[s]=this.stackValue(r-s-1);this.popN(r)}this.push(i)},pushClosureCopy:function(){var e=this.nextByte(),t=15&e,r=e>>4,e=256*this.nextByte()+this.nextByte(),i=this.encodeSqueakPC(this.pc,this.method),s=this.newClosure(t,i,r);if(s.pointers[Squeak.Closure_outerContext]=this.activeContext,(this.reclaimableContextCount=0)<r){for(var n=0;n<r;n++)s.pointers[Squeak.Closure_firstCopiedValue+n]=this.stackValue(r-n-1);this.popN(r)}this.pc+=e,this.push(s)},pushClosureCopyExtended:function(e,t){var r=this.nextByte(),i=this.nextByte(),s=(7&r)+8*this.mod(e,16),n=(r>>3&7)+8*this.div(e,16),r=i+(t<<8),e=this.encodeSqueakPC(this.pc,this.method),a=this.newClosure(s,e,n);if(a.pointers[Squeak.Closure_outerContext]=this.activeContext,(this.reclaimableContextCount=0)<n){for(var o=0;o<n;o++)a.pointers[Squeak.Closure_firstCopiedValue+o]=this.stackValue(n-o-1);this.popN(n)}this.pc+=r,this.push(a)},pushFullClosure:function(e){var t=this.nextByte(),r=this.nextByte(),i=63&r,s=1==(r>>6&1)?this.vm.nilObj:this.activeContext,t=this.method.methodGetLiteral(t+(e<<8)),n=this.newFullClosure(s,i,t);if(1==(r>>7&1))throw Error("on-stack receiver not yet supported");if(n.pointers[Squeak.ClosureFull_receiver]=this.receiver,(this.reclaimableContextCount=0)<i){for(var a=0;a<i;a++)n.pointers[Squeak.ClosureFull_firstCopiedValue+a]=this.stackValue(i-a-1);this.popN(i)}this.push(n)},newClosure:function(e,t,r){r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],r);return r.pointers[Squeak.Closure_startpc]=t,r.pointers[Squeak.Closure_numArgs]=e,r},newFullClosure:function(e,t,r){t=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassFullBlockClosure],t);return t.pointers[Squeak.Closure_outerContext]=e,t.pointers[Squeak.ClosureFull_method]=r,t.pointers[Squeak.Closure_numArgs]=r.methodNumArgs(),t}},"sending",{send:function(e,t,r){var i=this.stackValue(t),s=r?(s=this.method.methodClassForSuper()).superclass():this.getClass(i),r=this.findSelectorInClass(e,t,s);r.primIndex&&(this.verifyAtSelector=e,this.verifyAtClass=s),this.executeNewMethod(i,r.method,r.argCount,r.primIndex,r.mClass,e)},sendSuperDirected:function(e,t){var r=this.pop().superclass(),i=this.stackValue(t),t=this.findSelectorInClass(e,t,r);t.primIndex&&(this.verifyAtSelector=e,this.verifyAtClass=r),this.executeNewMethod(i,t.method,t.argCount,t.primIndex,t.mClass,e)},sendAsPrimitiveFailure:function(e,t,r){this.executeNewMethod(e,t,r,0)},findSelectorInClass:function(e,t,r,i=t){this.currentSelector=e;var s=this.findMethodCacheEntry(e,r);if(s.method)return s;for(var n,a,o=r;!o.isNil;){if((a=o.pointers[Squeak.Class_mdict]).isNil)return n=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],u=this.createActualMessage(e,t,r),this.popNandPush(i+1,u),this.findSelectorInClass(n,1,o.superclass());var u=this.lookupSelectorInDict(a,e);if(!u.isNil)return(s.method=u).isMethod()?(s.primIndex=u.methodPrimitiveIndex(),s.argCount=u.methodNumArgs()):(s.primIndex=576,s.argCount=t),s.mClass=o,s;o=o.superclass()}var l=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(e===l)throw Error("Recursive not understood error encountered");var c,h=this.createActualMessage(e,t,r);return this.breakOnMessageNotUnderstood&&(c=this.stackValue(i),this.breakNow("Message not understood: "+c+" "+r.className()+">>"+e.bytesAsString())),this.popNandPush(i,h),this.findSelectorInClass(l,1,r)},lookupSelectorInDict:function(e,t){for(var r=e.pointersSize(),i=(r-Squeak.MethodDict_selectorStart-1&t.hash)+Squeak.MethodDict_selectorStart,s=!1;;){var n=e.pointers[i];if(n===t)return e.pointers[Squeak.MethodDict_array].pointers[i-Squeak.MethodDict_selectorStart];if(n.isNil)return this.nilObj;if(++i===r){if(s)return this.nilObj;i=Squeak.MethodDict_selectorStart,s=!0}}},executeNewMethod:function(e,t,r,i,s,n){if(this.sendCount++,t===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(t,s,n)),this.logSends){for(var a=" ",o=this.activeContext;!o.isNil;)a+="| ",o=o.pointers[Squeak.Context_sender];var u=this.activeContext.pointers.slice(this.sp+1-r,this.sp+1);console.log(this.sendCount+a+this.printMethod(t,s,n,u))}if(this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow()),!(0<i&&this.tryPrimitive(i,r,t))){var u=this.allocateOrRecycleContext(t.methodNeedsLargeFrame()),i=t.methodTempCount(),l=Squeak.Context_tempFrameStart+i-1;if(u.pointers[Squeak.Context_method]=t,u.pointers[Squeak.BlockContext_initialIP]=this.nilObj,u.pointers[Squeak.Context_sender]=this.activeContext,this.arrayCopy(this.activeContext.pointers,this.sp-r,u.pointers,Squeak.Context_tempFrameStart-1,r+1),this.arrayFill(u.pointers,Squeak.Context_tempFrameStart+r,Squeak.Context_tempFrameStart+i,this.nilObj),this.popN(r+1),this.reclaimableContextCount++,this.storeContextRegisters(),this.activeContext=u,this.activeContext.dirty=!0,this.homeContext=u,this.method=t,this.pc=0,this.sp=l,this.receiver=u.pointers[Squeak.Context_receiver],this.receiver!==e)throw Error("receivers don't match");t.compiled||this.compileIfPossible(t,s,n),this.interruptCheckCounter--<=0&&this.checkForInterrupts()}},compileIfPossible(e,t,r){!e.compiled&&this.compiler&&this.compiler.compile(e,t,r)},doReturn:function(e,t){if(!t){var r,i=this.homeContext;if(this.hasClosures)for(;!(r=i.pointers[Squeak.Context_closure]).isNil;)i=r.pointers[Squeak.Closure_outerContext];t=i.pointers[Squeak.Context_sender]}if(t.isNil||t.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(e);for(var s,n=this.activeContext.pointers[Squeak.Context_sender];n!==t;){if(n.isNil)return this.cannotReturn(e);if(this.isUnwindMarked(n))return this.aboutToReturnThrough(e,n);n=n.pointers[Squeak.Context_sender]}for(n=this.activeContext;n!==t;)this.breakOnContextReturned===n&&(this.breakOnContextReturned=null,this.breakNow()),s=n.pointers[Squeak.Context_sender],n.pointers[Squeak.Context_sender]=this.nilObj,n.pointers[Squeak.Context_instructionPointer]=this.nilObj,0<this.reclaimableContextCount&&(this.reclaimableContextCount--,this.recycleIfPossible(n)),n=s;this.activeContext=n,this.activeContext.dirty=!0,this.fetchContextRegisters(this.activeContext),this.push(e),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(e,t){this.push(this.exportThisContext()),this.push(e),this.push(t);e=this.specialObjects[Squeak.splOb_SelectorAboutToReturn];this.send(e,2)},cannotReturn:function(e){this.push(this.exportThisContext()),this.push(e);e=this.specialObjects[Squeak.splOb_SelectorCannotReturn];this.send(e,1)},tryPrimitive:function(e,t,r){if(255<e&&e<520){if(264<=e)this.popNandPush(1,this.top().pointers[e-264]);else{switch(e){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}this.popNandPush(1,e-261)}return!0}var i=this.sp,s=this.activeContext,r=this.primHandler.doPrimitive(e,t,r);return r&&this.sp!==i-t&&s===this.activeContext&&117!==e&&118!==e&&218!==e&&!this.frozen&&this.warnOnce("stack unbalanced after primitive "+e,"error"),r},createActualMessage:function(e,t,r){var i=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],0),s=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],t);return this.arrayCopy(this.activeContext.pointers,this.sp-t+1,s.pointers,0,t),i.pointers[Squeak.Message_selector]=e,i.pointers[Squeak.Message_arguments]=s,i.pointers.length>Squeak.Message_lookupClass&&(i.pointers[Squeak.Message_lookupClass]=r),i},primitivePerform:function(e){var t=this.stackValue(e-1),r=this.stackValue(e),i=e-1,e=this.findSelectorInClass(t,i,this.getClass(r),e);if(e.selector===t){if(e.argCount!==i)return!1;var s=this.activeContext.pointers,n=this.sp-i;this.arrayCopy(s,1+n,s,n,i),this.sp--}else r=this.stackValue(e.argCount);return this.executeNewMethod(r,e.method,e.argCount,e.primIndex,e.mClass,t),!0},primitivePerformWithArgs:function(e,t){var r=t?3:2,i=this.stackValue(r),s=this.stackValue(r-1),r=this.stackValue(r-2);if(r.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var n=t?this.top():this.getClass(i);if(t)for(var a=this.getClass(i);a!==n;)if((a=a.superclass()).isNil)return!1;var t=r.pointersSize(),o=this.findSelectorInClass(s,t,n,e);if(o.selector===s){if(o.argCount!==t)return!1;var u=this.activeContext.pointers,l=this.sp-(e-1);u[l-1]=i,this.arrayCopy(r.pointers,0,u,l,t),this.sp+=t-e}else i=this.stackValue(o.argCount);return this.executeNewMethod(i,o.method,o.argCount,o.primIndex,o.mClass,s),!0},primitiveInvokeObjectAsMethod:function(e,t){for(var r=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],e),i=0;i<e;i++)r.pointers[e-i-1]=this.pop();var s=this.pop(),n=this.currentSelector,a=this.specialObjects[Squeak.splOb_SelectorRunWithIn];return this.push(t),this.push(n),this.push(r),this.push(s),this.send(a,3,!1),!0},findMethodCacheEntry:function(e,t){this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var r,i=(e.hash^t.hash)&this.methodCacheMask,s=i,n=0;n<4;n++){if((r=this.methodCache[s]).selector===e&&r.lkupClass===t)return r;n===this.methodCacheRandomish&&(i=s),s=s+e.hash&this.methodCacheMask}return(r=this.methodCache[i]).lkupClass=t,r.selector=e,r.method=null,r},flushMethodCache:function(){for(var e=0;e<this.methodCacheSize;e++)this.methodCache[e].selector=null,this.methodCache[e].method=null;return!0},flushMethodCacheForSelector:function(e){for(var t=0;t<this.methodCacheSize;t++)this.methodCache[t].selector===e&&(this.methodCache[t].selector=null,this.methodCache[t].method=null);return!0},flushMethodCacheForMethod:function(e){for(var t=0;t<this.methodCacheSize;t++)this.methodCache[t].method===e&&(this.methodCache[t].selector=null,this.methodCache[t].method=null);return!0},flushMethodCacheAfterBecome:function(e){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(e){return!!this.isMethodContext(e)&&198==e.pointers[Squeak.Context_method].methodPrimitiveIndex()},newActiveContext:function(e){this.storeContextRegisters(),this.activeContext=e,this.activeContext.dirty=!0,this.fetchContextRegisters(e),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},exportThisContext:function(){return this.storeContextRegisters(),this.reclaimableContextCount=0,this.activeContext},fetchContextRegisters:function(e){var t=e.pointers[Squeak.Context_method];this.isSmallInt(t)?(this.homeContext=e.pointers[Squeak.BlockContext_home],t=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=e,this.receiver=this.homeContext.pointers[Squeak.Context_receiver],this.method=t,this.pc=this.decodeSqueakPC(e.pointers[Squeak.Context_instructionPointer],t),this.sp=this.decodeSqueakSP(e.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method),this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(e,t){return e+4*t.pointers.length+1},decodeSqueakPC:function(e,t){return e-4*t.pointers.length-1},encodeSqueakSP:function(e){return e-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(e){return e+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(e){this.isMethodContext(e)&&(e.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize?(e.pointers[0]=this.freeContexts,this.freeContexts=e):e.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize&&(e.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=e))},allocateOrRecycleContext:function(e){var t;return e?this.freeLargeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)):(t=this.freeLargeContexts,this.freeLargeContexts=t.pointers[0],this.nRecycledContexts++,t):this.freeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)):(t=this.freeContexts,this.freeContexts=t.pointers[0],this.nRecycledContexts++,t)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},popN:function(e){this.sp-=e},push:function(e){this.activeContext.pointers[++this.sp]=e},popNandPush:function(e,t){this.activeContext.pointers[this.sp-=e-1]=t},top:function(){return this.activeContext.pointers[this.sp]},stackTopPut:function(e){this.activeContext.pointers[this.sp]=e},stackValue:function(e){return this.activeContext.pointers[this.sp-e]},stackInteger:function(e){return this.checkSmallInt(this.stackValue(e))},stackIntOrFloat:function(e){e=this.stackValue(e);if("number"==typeof e)return e;if(void 0!==e){if(e.isFloat)return this.resultIsFloat=!0,e.float;var t=e.bytes;if(t&&4==t.length){for(var r=0,i=3;0<=i;i--)r=256*r+t[i];if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return r;if(e.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-r}}return this.success=!1,0},pop2AndPushIntResult:function(e){return!(!this.success||!this.canBeSmallInt(e)||(this.popNandPush(2,e),0))},pop2AndPushNumResult:function(e){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,this.primHandler.makeFloat(e)),!0;if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return this.popNandPush(2,e),!0;var t,r;if(-4294967295<=e&&e<=4294967295)return e=(t=e<0)?-e:e,t=t?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,(r=(t=this.instantiateClass(this.specialObjects[t],4)).bytes)[0]=255&e,r[1]=e>>8&255,r[2]=e>>16&255,r[3]=e>>24&255,this.popNandPush(2,t),!0}return!1},pop2AndPushBoolResult:function(e){return!!this.success&&(this.popNandPush(2,e?this.trueObj:this.falseObj),!0)}},"numbers",{getClass:function(e){return this.isSmallInt(e)?this.specialObjects[Squeak.splOb_ClassInteger]:e.sqClass},canBeSmallInt:function(e){return e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt},isSmallInt:function(e){return"number"==typeof e},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,1)},quickDivide:function(e,t){var r;return 0!==t&&(r=e/t|0)*t===e?r:Squeak.NonSmallInt},div:function(e,t){return 0===t?Squeak.NonSmallInt:Math.floor(e/t)},mod:function(e,t){return 0===t?Squeak.NonSmallInt:e-Math.floor(e/t)*t},safeShift:function(e,t){var r;return t<0?t<-31?e<0?-1:0:e>>-t:31<t?0===e?0:Squeak.NonSmallInt:(r=e<<t)>>t!==e?Squeak.NonSmallInt:r}},"utils",{isContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]||e.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]},isMethodContext:function(e){return e.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},instantiateClass:function(e,t){return this.image.instantiateClass(e,t,this.nilObj)},arrayFill:function(e,t,r,i){for(var s=t;s<r;s++)e[s]=i},arrayCopy:function(e,t,r,i,s){if(e===r&&t<i)for(var n=s-1;0<=n;n--)r[i+n]=e[t+n];else for(n=0;n<s;n++)r[i+n]=e[t+n]},signalLowSpaceIfNecessary:function(e){var t;e<this.lowSpaceThreshold&&0<this.lowSpaceThreshold&&((t=prompt&&prompt("Out of memory, "+Math.ceil(this.image.totalMemory/1e6)+" MB used.\nEnter additional MB, or 0 to signal low space in image","0"))?(t=1e6*parseInt(t,10),this.image.totalMemory+=t,this.signalLowSpaceIfNecessary(this.image.bytesLeft())):(console.warn("squeak: low memory ("+e+"/"+this.image.totalMemory+" bytes left), signaling low space"),this.signalLowSpace=!0,this.lowSpaceThreshold=0,this.specialObjects[Squeak.splOb_ProcessSignalingLowSpace].isNil&&(this.specialObjects[Squeak.splOb_ProcessSignalingLowSpace]=this.primHandler.activeProcess()),this.forceInterruptCheck()))}},"debugging",{addMessage:function(e){return this.messages[e]?++this.messages[e]:this.messages[e]=1},warnOnce:function(e,t){if(1==this.addMessage(e))return console[t||"warn"](e),!0},printMethod:function(i,e,t,r){if(i.sqClass!=this.specialObjects[Squeak.splOb_ClassCompiledMethod])return this.printMethod(i.blockOuterCode(),e,t,r);var s;if(t){var n=e.className()+">>",t=t.bytesAsString();if(r&&r.length)for(var a=t.split(/(?<=:)/),o=0;o<r.length;o++)0<o&&(n+=" "),n+=a[o]+" "+r[o];else n+=t;return n}return i=i||this.activeContext.contextMethod(),this.allMethodsDo(function(e,t,r){if(t===i)return s=e.className()+">>"+r.bytesAsString()}),s||(e?"("+e.pointers[Squeak.Context_receiver]+")>>?":"?>>?")},allInstancesOf:function(e,t){"string"==typeof e&&(e=this.globalNamed(e));for(var r=[],i=this.image.someInstanceOf(e);i;)t?t(i):r.push(i),i=this.image.nextInstanceAfter(i);return r},globalNamed:function(r){return this.allGlobalsDo(function(e,t){if(e.bytesAsString()===r)return t})},allGlobalsDo:function(e){for(var t=this.getGlobals(),r=0;r<t.length;r++){var i=t[r];if(!i.isNil){i=e(i.pointers[0],i.pointers[1]);if(i)return i}}},allMethodsDo:function(h){this.allGlobalsDo(function(e,t){if(t.pointers&&9<=t.pointers.length)for(var r=[t,t.sqClass],i=0;i<r.length;i++){var s=r[i],n=s.pointers[1];if(n.pointers&&n.pointers[1]){var a=n.pointers[1].pointers;if(a){var o=n.pointers;if(a.length+2===o.length)for(var u=0;u<a.length;u++){var l=a[u],c=o[2+u];if(l.isMethod&&l.isMethod())if(c.bytesSize&&c.bytesSize())if(h.call(null,s,l,c))return!0}}}}})},printStack:function(e,t,r){"number"==typeof e&&(t=e,e=null),e=e||this.activeContext,t=t||100;for(var i=[],s=Math.max(t,1e6);!e.isNil&&0<s--;)i.push(e),e=e.pointers[Squeak.Context_sender];i.length>t+200&&(e.isNil||i.push("..."),i=i.slice(0,t).concat(["..."]).concat(i.slice(-200)));var n,a,o=[],u=i.length,l="";for(r&&this.logSends&&(l=Array((""+this.sendCount).length+2).join(" "));0<u--;)(e=i[u]).pointers?(a="","number"==typeof(n=e.pointers[Squeak.Context_method])?(n=e.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],a="[] in "):e.pointers[Squeak.Context_closure].isNil||(a="[] in "),a=a+this.printMethod(n,e),o.push((a=r?l+a:a)+"\n"),r&&(l+=r)):o.push("...\n");return o.join("")},findMethod:function(e){var i,s=e.split(">>")[0],n=e.split(">>")[1];return this.allMethodsDo(function(e,t,r){if(n.length==r.bytesSize()&&n==r.bytesAsString()&&s==e.className())return i=t}),i},breakAfter:function(e){this.breakOutTick=this.primHandler.millisecondClockValue()+e},breakNow:function(e){e&&console.log("Break: "+e),this.breakOutOfInterpreter="break"},breakOn:function(e){return this.breakOnMethod=e&&this.findMethod(e)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1,this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=!0,this.breakOnContextReturned=null},printContext:function(e,t){if(!this.isContext(e))return"NOT A CONTEXT: "+r(e);function r(e){e="number"==typeof e||"object"==typeof e?e.sqInstName():"<"+e+">";return e=(e=JSON.stringify(e).slice(1,-1)).length>t-3?e.slice(0,t-3)+"...":e}t=t||72;for(var i="number"==typeof e.pointers[Squeak.BlockContext_argumentCount],s=e.pointers[Squeak.Context_closure],n=!i&&!s.isNil,a=i?e.pointers[Squeak.BlockContext_home]:e,n=n?s.pointers[Squeak.Closure_numArgs]:a.pointers[Squeak.Context_method].methodTempCount(),o=this.decodeSqueakSP(0),u=a.contextSizeWithStack(this)-1,l=o+1,c=l+n-1,h=l+a.pointers[Squeak.Context_method].methodNumArgs()-1,f="",p=o;p<=u;p++){var d="";p===o?d="=rcvr":(p<=c&&(d="=tmp"+(p-l)),p<=h&&(d+="/arg"+(p-l))),f+="\nctx["+p+"]"+d+": "+r(a.pointers[p])}if(i){f+="\n";var s=e.pointers[Squeak.BlockContext_argumentCount],m=this.decodeSqueakSP(1),h=m+s,v=e===this.activeContext?this.sp:e.pointers[Squeak.Context_stackPointer];v<m&&(f+="\nblk <stack empty>");for(p=m;p<=v;p++)f+="\nblk["+p+"]"+(d=p<h?"=arg"+(p-m):"")+": "+r(e.pointers[p])}return f},printActiveContext:function(e){return this.printContext(this.activeContext,e)},printAllProcesses:function(){for(var e=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value],t=e.pointers[Squeak.ProcSched_activeProcess],r="Active: "+this.printProcess(t,!0),i=e.pointers[Squeak.ProcSched_processLists].pointers,s=i.length-1;0<=s;s--)for(var n=i[s].pointers[Squeak.LinkedList_firstLink];!n.isNil;)r=(r+="\n------------------------------------------")+"\nRunnable: "+this.printProcess(n),n=n.pointers[Squeak.Link_nextLink];for(var t=this.specialObjects[Squeak.splOb_ClassSemaphore],a=this.image.someInstanceOf(t),o=[];a;){for(n=a.pointers[Squeak.LinkedList_firstLink];!n.isNil;)o.push(n),n=n.pointers[Squeak.Link_nextLink];a=this.image.nextInstanceAfter(a)}o.sort(function(e,t){return t.pointers[Squeak.Proc_priority]-e.pointers[Squeak.Proc_priority]});for(var u=0;u<o.length;u++)r=(r+="\n------------------------------------------")+"\nWaiting: "+this.printProcess(o[u]);return r},printProcess:function(e,t,r){e||(e=this.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value].pointers[Squeak.ProcSched_activeProcess],t=!0);var t=t?this.activeContext:e.pointers[Squeak.Proc_suspendedContext],i=e.pointers[Squeak.Proc_priority],s=this.printStack(t,20,r),r=r&&this.logSends?"":this.printContext(t)+"\n";return e.toString()+" at priority "+i+"\n"+s+r},printByteCodes:function(e,t,r,i){return e=e||this.method,new Squeak.InstructionPrinter(e,this).printInstructions(t,r,i)},logStack:function(){console.log(this.printStack()+this.printActiveContext()+"\n\n"+this.printByteCodes(this.method,"   ","=> ",this.pc),this.activeContext.pointers.slice(0,this.sp+1))},willSendOrReturn:function(){var e,t=this.method.bytes[this.pc];if(this.method.methodSignFlag()){if(96<=t&&t<=127)r=this.specialSelectors[2*(t-96)];else if(128<=t&&t<=175)r=this.method.methodGetSelector(15&t);else if(234==t||235==t)this.method.methodGetSelector(this.method.bytes[this.pc+1]>>3);else if(88<=t&&t<=94)return!0}else{if(120<=t&&t<=125)return!0;if(t<131||200==t)return!1;if(176<=t)return!0;if(t<=134){if(132===t){if(1<this.method.bytes[this.pc+1]>>5)return!1;e=this.method.bytes[this.pc+2]}else e=this.method.bytes[this.pc+1]&(134===t?63:31);var r=this.method.methodGetLiteral(e);if("blockCopy:"!==r.bytesAsString())return!0}}return!1},nextSendSelector:function(){var e,t,r=this.method.bytes[this.pc];if(this.method.methodSignFlag())if(96<=r&&r<=127)e=this.specialSelectors[2*(r-96)];else if(128<=r&&r<=175)e=this.method.methodGetSelector(15&r);else{if(234!=r&&235!=r)return null;this.method.methodGetSelector(this.method.bytes[this.pc+1]>>3)}else{if(r<131||200==r)return null;if(208<=r)e=this.method.methodGetLiteral(15&r);else if(176<=r)e=this.specialSelectors[2*(r-176)];else if(r<=134){if(132===r){if(1<this.method.bytes[this.pc+1]>>5)return null;t=this.method.bytes[this.pc+2]}else t=this.method.bytes[this.pc+1]&(134===r?63:31);e=this.method.methodGetLiteral(t)}}if(e){r=e.bytesAsString();if("blockCopy:"!==r)return r}}}),Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(t){this.vm=t,this.remappableOops=[],Object.defineProperty(this,"successFlag",{get:function(){return t.primHandler.success},set:function(e){t.primHandler.success=e}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(e){this.successFlag=!1},success:function(e){e||(this.successFlag=!1)}},"stack access",{pop:function(e){this.vm.popN(e)},popthenPush:function(e,t){this.vm.popNandPush(e,t)},push:function(e){this.vm.push(e)},pushBool:function(e){this.vm.push(e?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(e){this.vm.push(e)},pushFloat:function(e){this.vm.push(this.floatObjectOf(e))},stackValue:function(e){return this.vm.stackValue(e)},stackIntegerValue:function(e){e=this.vm.stackValue(e);return"number"==typeof e?e:(this.successFlag=!1,0)},stackFloatValue:function(e){this.vm.success=!0;e=this.vm.stackIntOrFloat(e);return this.vm.success?e:(this.successFlag=!1,0)},stackObjectValue:function(e){e=this.vm.stackValue(e);return"number"!=typeof e?e:(this.successFlag=!1,this.vm.nilObj)},stackBytes:function(e){e=this.vm.stackValue(e);return e.bytes||("number"!=typeof e&&e.isBytes()||(this.successFlag=!1),[])},stackWords:function(e){e=this.vm.stackValue(e);return e.words||("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt32Array:function(e){e=this.vm.stackValue(e);return e.words?e.wordsAsInt32Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackInt16Array:function(e){e=this.vm.stackValue(e);return e.words?e.wordsAsInt16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])},stackUint16Array:function(e){e=this.vm.stackValue(e);return e.words?e.wordsAsUint16Array():("number"!=typeof e&&e.isWords()||(this.successFlag=!1),[])}},"object access",{isBytes:function(e){return"number"!=typeof e&&e.isBytes()},isWords:function(e){return"number"!=typeof e&&e.isWords()},isWordsOrBytes:function(e){return"number"!=typeof e&&e.isWordsOrBytes()},isPointers:function(e){return"number"!=typeof e&&e.isPointers()},isIntegerValue:function(e){return"number"==typeof e&&-1073741824<=e&&e<=1073741823},isArray:function(e){return e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(e,t){var r=e.sqClass.pointers[Squeak.Class_name].bytes;if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(t.charCodeAt(i)!==r[i])return!1;return!0},booleanValueOf:function(e){return!!e.isTrue||(e.isFalse||(this.successFlag=!1),!1)},positive32BitValueOf:function(e){return this.vm.primHandler.positive32BitValueOf(e)},positive32BitIntegerFor:function(e){return this.vm.primHandler.pos32BitIntFor(e)},floatValueOf:function(e){return e.isFloat?e.float:(this.successFlag=!1,0)},floatObjectOf:function(e){return this.vm.primHandler.makeFloat(e)},fetchPointerofObject:function(e,t){return t.pointers[e]},fetchBytesofObject:function(e,t){t=t.pointers[e];return t.bytes||(t.words?t.wordsAsUint8Array():("number"!=typeof t&&t.isWordsOrBytes()||(this.successFlag=!1),[]))},fetchWordsofObject:function(e,t){t=t.pointers[e];return t.words||("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchInt32ArrayofObject:function(e,t){t=t.pointers[e];return t.words?t.wordsAsInt32Array():("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchInt16ArrayofObject:function(e,t){t=t.pointers[e];return t.words?t.wordsAsInt16Array():("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchUint16ArrayofObject:function(e,t){t=t.pointers[e];return t.words?t.wordsAsUint16Array():("number"!=typeof t&&t.isWords()||(this.successFlag=!1),[])},fetchIntegerofObject:function(e,t){t=t.pointers[e];return"number"==typeof t?t:(this.successFlag=!1,0)},fetchLong32ofObject:function(e,t){return t.words[e]},fetchFloatofObject:function(e,t){return this.floatValueOf(t.pointers[e])},storeIntegerofObjectwithValue:function(e,t,r){"number"==typeof r?t.pointers[e]=r:this.successFlag=!1},storePointerofObjectwithValue:function(e,t,r){t.pointers[e]=r},stObjectatput:function(e,t,r){if(e.sqClass!==this.classArray())throw Error("Array expected");if(t<1||t>e.pointers.length)return this.successFlag=!1;e.pointers[t-1]=r}},"constant access",{isKindOfInteger:function(e){return"number"==typeof e||e.sqClass==this.classLargeNegativeInteger()||e.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},classByteArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassByteArray]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{clone:function(e){return this.vm.image.clone(e)},instantiateClassindexableSize:function(e,t){return this.vm.instantiateClass(e,t)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(e,t){return this.vm.primHandler.makePointWithXandY(e,t)},pushRemappableOop:function(e){this.remappableOops.push(e)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(e,t,r,i,s){t<i&&r<s&&this.vm.primHandler.displayDirty(e,{left:t,top:r,right:i,bottom:s})},ioLoadFunctionFrom:function(e,t){return this.vm.primHandler.loadFunctionFrom(e,t)}}),Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(e,t){this.vm=t,this.method=e,this.pc=0,this.specialConstants=[t.trueObj,t.falseObj,t.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(e){var t=this.method,r=t.bytes[this.pc++],i=r/16|0,s=r%16;if(0==i)return e.pushReceiverVariable(s);if(1==i)return e.pushTemporaryVariable(s);if(2==i)return e.pushConstant(t.methodGetLiteral(s));if(3==i)return e.pushConstant(t.methodGetLiteral(16+s));if(4==i)return e.pushLiteralVariable(t.methodGetLiteral(s));if(5==i)return e.pushLiteralVariable(t.methodGetLiteral(16+s));if(6==i)return s<8?e.popIntoReceiverVariable(s):e.popIntoTemporaryVariable(s-8);if(7==i){if(0==s)return e.pushReceiver();if(s<8)return e.pushConstant(this.specialConstants[s-1]);if(8==s)return e.methodReturnReceiver();if(s<12)return e.methodReturnConstant(this.specialConstants[s-9]);if(12==s)return e.methodReturnTop();if(13==s)return e.blockReturnTop();if(13<s)throw Error("unusedBytecode")}return 8==i?this.interpretExtension(s,t,e):9==i?s<8?e.jump(1+s):e.jumpIf(!1,s-8+1):10==i?(r=this.method.bytes[this.pc++],s<8?e.jump(256*(s-4)+r):e.jumpIf(s<12,256*(3&s)+r)):11==i?e.send(this.vm.specialSelectors[2*s],this.vm.specialSelectors[2*s+1],!1):12==i?e.send(this.vm.specialSelectors[2*(16+s)],this.vm.specialSelectors[2*(16+s)+1],!1):12<i?e.send(t.methodGetLiteral(s),i-13,!1):void 0},interpretExtension:function(e,t,r){if(e<=6){var i=this.method.bytes[this.pc++];if(e<=2){var s=i/64|0,n=i%64;if(0===e){if(0===s)return r.pushReceiverVariable(n);if(1===s)return r.pushTemporaryVariable(n);if(2===s)return r.pushConstant(this.method.methodGetLiteral(n));if(3===s)return r.pushLiteralVariable(this.method.methodGetLiteral(n))}if(1===e){if(0===s)return r.storeIntoReceiverVariable(n);if(1===s)return r.storeIntoTemporaryVariable(n);if(2===s)throw Error("illegalStore");if(3===s)return r.storeIntoLiteralVariable(this.method.methodGetLiteral(n))}if(2===e){if(0===s)return r.popIntoReceiverVariable(n);if(1===s)return r.popIntoTemporaryVariable(n);if(2===s)throw Error("illegalStore");if(3===s)return r.popIntoLiteralVariable(this.method.methodGetLiteral(n))}}if(3===e)return r.send(this.method.methodGetLiteral(i%32),i/32|0,!1);if(4===e){var a=this.method.bytes[this.pc++];if(0===(s=i/32|0))return r.send(this.method.methodGetLiteral(a),i%32,!1);if(1===s)return r.send(this.method.methodGetLiteral(a),i%32,!0);if(2===s)return r.pushReceiverVariable(a);if(3===s)return r.pushConstant(this.method.methodGetLiteral(a));if(4===s)return r.pushLiteralVariable(this.method.methodGetLiteral(a));if(5===s)return r.storeIntoReceiverVariable(a);if(6===s)return r.popIntoReceiverVariable(a);if(7===s)return r.storeIntoLiteralVariable(this.method.methodGetLiteral(a))}if(5===e)return r.send(this.method.methodGetLiteral(31&i),i>>5,!0);if(6===e)return r.send(this.method.methodGetLiteral(63&i),i>>6,!1)}return 7===e?r.doPop():8===e?r.doDup():9===e?r.pushActiveContext():(i=this.method.bytes[this.pc++],10===e?i<128?r.pushNewArray(i):r.popIntoNewArray(i-128):(a=this.method.bytes[this.pc++],11===e?r.callPrimitive(i+256*a):12===e?r.pushRemoteTemp(i,a):13===e?r.storeIntoRemoteTemp(i,a):14===e?r.popIntoRemoteTemp(i,a):(n=this.method.bytes[this.pc++],r.pushClosureCopy(i>>4,15&i,256*a+n))))}}),Squeak.InstructionStream.subclass("Squeak.InstructionStreamSista","decoding",{interpretNextInstructionFor:function(e){return this.interpretNextInstructionExtFor(e,0,0)},interpretNextInstructionExtFor:function(e,t,r){this.Squeak;var i=this.method.bytes[this.pc++];switch(i){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return e.pushReceiverVariable(15&i);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return e.pushLiteralVariable(this.method.methodGetLiteral(15&i));case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return e.pushConstant(this.method.methodGetLiteral(31&i));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:return e.pushTemporaryVariable(15&i);case 72:case 73:case 74:case 75:return e.pushTemporaryVariable(8+(3&i));case 76:return e.pushReceiver();case 77:return e.pushConstant(this.vm.trueObj);case 78:return e.pushConstant(this.vm.falseObj);case 79:return e.pushConstant(this.vm.nilObj);case 80:return e.pushConstant(0);case 81:return e.pushConstant(1);case 82:return e.pushActiveContext();case 83:return e.doDup();case 88:return e.methodReturnReceiver();case 89:return e.methodReturnConstant(this.vm.trueObj);case 90:return e.methodReturnConstant(this.vm.falseObj);case 91:return e.methodReturnConstant(this.vm.nilObj);case 92:return e.methodReturnTop();case 93:return e.blockReturnConstant(this.vm.nilObj);case 94:if(0===t)return e.blockReturnTop();break;case 95:return e.nop();case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:return e.send(this.vm.specialSelectors[2*(i-96)],this.vm.specialSelectors[2*(i-96)+1],!1);case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:case 141:case 142:case 143:return e.send(this.method.methodGetLiteral(15&i),0,!1);case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return e.send(this.method.methodGetLiteral(15&i),1,!1);case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:return e.send(this.method.methodGetLiteral(15&i),2,!1);case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:return e.jump(1+(7&i));case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:return e.jumpIf(!0,1+(7&i));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:return e.jumpIf(!1,1+(7&i));case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return e.popIntoReceiverVariable(7&i);case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:return e.popIntoTemporaryVariable(i-208);case 216:return e.doPop()}var s=this.method.bytes[this.pc++];switch(i){case 224:return this.interpretNextInstructionExtFor(e,(t<<8)+s,r);case 225:return this.interpretNextInstructionExtFor(e,t,(r<<8)+(s<128?s:s-256));case 226:return e.pushReceiverVariable(s+(t<<8));case 227:return e.pushLiteralVariable(this.method.methodGetLiteral(s+(t<<8)));case 228:return e.pushConstant(this.method.methodGetLiteral(s+(t<<8)));case 229:return e.pushTemporaryVariable(s);case 231:return s<128?e.pushNewArray(s):e.popIntoNewArray(s-128);case 232:return e.pushConstant(s+(r<<8));case 233:var n=s+(r<<8);return e.pushConstant("$"+String.fromCodePoint(n)+" ("+n+")");case 234:return e.send(this.method.methodGetSelector((s>>3)+(t<<5)),(7&s)+(r<<3),!1);case 235:n=this.method.methodGetSelector((s>>3)+(t<<5));return 64<=r?e.sendSuperDirected(n):e.send(n,(7&s)+(r<<3),!0);case 237:return e.jump(s+(r<<8));case 238:return e.jumpIf(!0,s+(r<<8));case 239:return e.jumpIf(!1,s+(r<<8));case 240:return e.popIntoReceiverVariable(s+(t<<8));case 241:return e.popIntoLiteralVariable(this.method.methodGetLiteral(s+(t<<8)));case 242:return e.popIntoTemporaryVariable(s);case 243:return e.storeIntoReceiverVariable(s+(t<<8));case 244:return e.storeIntoLiteralVariable(this.method.methodGetLiteral(s+(t<<8)));case 245:return e.storeIntoTemporaryVariable(s)}var a=this.method.bytes[this.pc++];switch(i){case 248:return e.callPrimitive(s+(a<<8));case 249:var o=s+(t<<8),u=63&a,l=this.method.methodGetLiteral(o);return e.pushFullClosure(o,u,l.methodNumArgs());case 250:o=(7&s)+8*this.mod(t,16),u=(s>>3&7)+8*this.div(t,16);return e.pushClosureCopy(u,o,a+(r<<8));case 251:return e.pushRemoteTemp(s,a);case 252:return e.storeIntoRemoteTemp(s,a);case 253:return e.popIntoRemoteTemp(s,a)}throw Error("Unknown bytecode: "+i)}}),Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(e,t){this.method=e,this.vm=t}},"printing",{printInstructions:function(e,t,r){this.indent=e,this.highlight=t,this.highlightPC=r,this.innerIndents={},this.result="",this.scanner=new(this.method.methodSignFlag()?Squeak.InstructionStreamSista:Squeak.InstructionStream)(this.method,this.vm),this.oldPC=this.scanner.pc,this.endPC=0,this.done=!1;try{for(;!this.done;)this.scanner.interpretNextInstructionFor(this)}catch(e){this.print("!!! "+e.message)}return this.result},print:function(e){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent),this.result+=this.oldPC;for(var t=0;t<this.innerIndents[this.oldPC];t++)this.result+="   ";this.result+=" <";for(t=this.oldPC;t<this.scanner.pc;t++)t>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[t]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+e+"\n",this.oldPC=this.scanner.pc}},"decoding",{blockReturnConstant:function(e){this.print("blockReturn: "+e.toString()),this.done=this.scanner.pc>this.endPC},blockReturnTop:function(){this.print("blockReturn"),this.done=this.scanner.pc>this.endPC},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(e){this.print("jumpTo: "+(this.scanner.pc+e)),this.scanner.pc+e>this.endPC&&(this.endPC=this.scanner.pc+e)},jumpIf:function(e,t){this.print((e?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+t)),this.scanner.pc+t>this.endPC&&(this.endPC=this.scanner.pc+t)},methodReturnReceiver:function(){this.print("return: receiver"),this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack"),this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(e){this.print("returnConst: "+e.toString()),this.done=this.scanner.pc>this.endPC},nop:function(){this.print("nop")},popIntoLiteralVariable:function(e){this.print("popIntoBinding: "+e.assnKeyAsString())},popIntoReceiverVariable:function(e){this.print("popIntoInstVar: "+e)},popIntoTemporaryVariable:function(e){this.print("popIntoTemp: "+e)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(e){e=e.sqInstName?e.sqInstName():e.toString();this.print("pushConst: "+e)},pushLiteralVariable:function(e){this.print("pushBinding: "+e.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(e){this.print("pushInstVar: "+e)},pushTemporaryVariable:function(e){this.print("pushTemp: "+e)},send:function(e,t,r){this.print((r?"superSend: #":"send: #")+(e.bytesAsString?e.bytesAsString():e))},sendSuperDirected:function(e){this.print("directedSuperSend: #"+(e.bytesAsString?e.bytesAsString():e))},storeIntoLiteralVariable:function(e){this.print("storeIntoBinding: "+e.assnKeyAsString())},storeIntoReceiverVariable:function(e){this.print("storeIntoInstVar: "+e)},storeIntoTemporaryVariable:function(e){this.print("storeIntoTemp: "+e)},pushNewArray:function(e){this.print("push: (Array new: "+e+")")},popIntoNewArray:function(e){this.print("pop: "+e+" into: (Array new: "+e+")")},pushRemoteTemp:function(e,t){this.print("push: "+e+" ofTemp: "+t)},storeIntoRemoteTemp:function(e,t){this.print("storeInto: "+e+" ofTemp: "+t)},popIntoRemoteTemp:function(e,t){this.print("popInto: "+e+" ofTemp: "+t)},pushClosureCopy:function(e,t,r){var i=this.scanner.pc,s=i+r;this.print("closure("+i+"-"+(s-1)+"): "+e+" copied, "+t+" args");for(var n=i;n<s;n++)this.innerIndents[n]=(this.innerIndents[n]||0)+1;s>this.endPC&&(this.endPC=s)},pushFullClosure:function(e,t,r){this.print("pushFullClosure: (self literalAt: "+(e+1)+") numCopied: "+t+" numArgs: "+r)},callPrimitive:function(e){this.print("primitive: "+e)}}),Object.subclass("Squeak.Primitives","initialization",{initialize:function(e,t){this.vm=e,this.oldPrims=!this.vm.image.hasClosures,this.allowAccessBeyondSP=this.oldPrims,this.deferDisplayUpdates=!1,this.semaphoresToSignal=[],this.initDisplay(t),this.initAtCache(),this.initModules(),this.initPlugins(),e.image.isSpur&&(this.charFromInt=this.charFromIntSpur,this.charToInt=this.charToIntSpur,this.identityHash=this.identityHashSpur)},initDisplay:function(e){this.display=e},initModules:function(){this.loadedModules={},this.builtinModules={},this.patchModules={},this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},initPlugins:function(){}},"dispatch",{quickSendOther:function(e,t){switch(this.success=!0,t){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.popNandPushBoolIfOK(2,this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(e,t,r){switch(this.success=!0,e){case 1:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)-this.stackInteger(0));case 3:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)<this.stackInteger(0));case 4:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)>this.stackInteger(0));case 5:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)<=this.stackInteger(0));case 6:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)>=this.stackInteger(0));case 7:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)===this.stackInteger(0));case 8:return this.popNandPushBoolIfOK(t+1,this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(t+1,this.vm.quickDivide(this.stackInteger(1),this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(t+1,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(t+1,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(t+1,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(t+1,this.doBitAnd());case 15:return this.popNandPushIfOK(t+1,this.doBitOr());case 16:return this.popNandPushIfOK(t+1,this.doBitXor());case 17:return this.popNandPushIfOK(t+1,this.doBitShift());case 18:return this.primitiveMakePoint(t,!1);case 19:return!1;case 20:return this.vm.warnOnce("missing primitive: 20 (primitiveRemLargeIntegers)"),!1;case 21:return this.vm.warnOnce("missing primitive: 21 (primitiveAddLargeIntegers)"),!1;case 22:return this.vm.warnOnce("missing primitive: 22 (primitiveSubtractLargeIntegers)"),!1;case 23:return this.primitiveLessThanLargeIntegers(t);case 24:return this.primitiveGreaterThanLargeIntegers(t);case 25:return this.primitiveLessOrEqualLargeIntegers(t);case 26:return this.primitiveGreaterOrEqualLargeIntegers(t);case 27:return this.primitiveEqualLargeIntegers(t);case 28:return this.primitiveNotEqualLargeIntegers(t);case 29:return this.vm.warnOnce("missing primitive: 29 (primitiveMultiplyLargeIntegers)"),!1;case 30:return this.vm.warnOnce("missing primitive: 30 (primitiveDivideLargeIntegers)"),!1;case 31:return this.vm.warnOnce("missing primitive: 31 (primitiveModLargeIntegers)"),!1;case 32:return this.vm.warnOnce("missing primitive: 32 (primitiveDivLargeIntegers)"),!1;case 33:return this.vm.warnOnce("missing primitive: 33 (primitiveQuoLargeIntegers)"),!1;case 34:return this.vm.warnOnce("missing primitive: 34 (primitiveBitAndLargeIntegers)"),!1;case 35:return this.vm.warnOnce("missing primitive: 35 (primitiveBitOrLargeIntegers)"),!1;case 36:return this.vm.warnOnce("missing primitive: 36 (primitiveBitXorLargeIntegers)"),!1;case 37:return this.vm.warnOnce("missing primitive: 37 (primitiveBitShiftLargeIntegers)"),!1;case 38:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(t+1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(t+1,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(t+1,this.stackFloat(1)-this.stackFloat(0));case 43:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)<this.stackFloat(0));case 44:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)>this.stackFloat(0));case 45:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)<=this.stackFloat(0));case 46:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)>=this.stackFloat(0));case 47:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)===this.stackFloat(0));case 48:return this.popNandPushBoolIfOK(t+1,this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(t+1,this.stackFloat(1)*this.stackFloat(0));case 50:return this.popNandPushFloatIfOK(t+1,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(t+1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return this.popNandPushFloatIfOK(t+1,this.floatFractionPart(this.stackFloat(0)));case 53:return this.popNandPushIntIfOK(t+1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(t+1,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(t+1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(t+1,Math.sin(this.stackFloat(0)));case 57:return this.popNandPushFloatIfOK(t+1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(t+1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(t+1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(t+1,this.objectSize(!1));case 63:return this.popNandPushIfOK(t+1,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!0,!1));case 65:return this.vm.warnOnce("missing primitive: 65 (primitiveNext)"),!1;case 66:return this.vm.warnOnce("missing primitive: 66 (primitiveNextPut)"),!1;case 67:return this.vm.warnOnce("missing primitive: 67 (primitiveAtEnd)"),!1;case 68:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(t+1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(t+1,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(t,!1,!0);case 73:return this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(t+1,this.identityHash(this.stackNonInteger(0)));case 76:return this.primitiveStoreStackp(t);case 77:return this.popNandPushIfOK(t+1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(t+1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(t);case 80:return this.popNandPushIfOK(t+1,this.doBlockCopy());case 81:return this.primitiveBlockValue(t);case 82:return this.primitiveBlockValueWithArgs(t);case 83:return this.vm.primitivePerform(t);case 84:return this.vm.primitivePerformWithArgs(t,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(t);case 91:return this.primitiveTestDisplayDepth(t);case 92:return this.vm.warnOnce("missing primitive: 92 (primitiveSetDisplayMode)"),!1;case 93:return this.primitiveInputSemaphore(t);case 94:return this.primitiveGetNextEvent(t);case 95:return this.primitiveInputWord(t);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",t);case 97:return this.primitiveSnapshot(t);case 98:return this.primitiveStoreImageSegment(t);case 99:return this.primitiveLoadImageSegment(t);case 100:return this.vm.primitivePerformWithArgs(t,!0);case 101:return this.primitiveBeCursor(t);case 102:return this.primitiveBeDisplay(t);case 103:return this.primitiveScanCharacters(t);case 104:return this.vm.warnOnce("missing primitive: 104 (primitiveDrawLoop)"),!1;case 105:return this.popNandPushIfOK(t+1,this.doStringReplace());case 106:return this.primitiveScreenSize(t);case 107:return this.primitiveMouseButtons(t);case 108:return this.primitiveKeyboardNext(t);case 109:return this.primitiveKeyboardPeek(t);case 110:return this.popNandPushBoolIfOK(t+1,this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(t+1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(t+1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(t);case 114:return this.primitiveExitToDebugger(t);case 115:return this.primitiveChangeClass(t);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());case 117:return this.doNamedPrimitive(t,r);case 118:return this.primitiveDoPrimitiveWithArgs(t);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return this.primitiveCalloutToFFI(t,r);case 121:return this.primitiveImageName(t);case 122:return this.primitiveReverseDisplay(t);case 123:return this.vm.warnOnce("missing primitive: 123 (primitiveValueUninterruptably)"),!1;case 124:return this.popNandPushIfOK(t+1,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(t+1,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(t);case 127:return this.primitiveShowDisplayRect(t);case 128:return this.primitiveArrayBecome(t,!0,!0);case 129:return this.popNandPushIfOK(t+1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(t);case 131:return this.primitivePartialGC(t);case 132:return this.popNandPushBoolIfOK(t+1,this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return this.popNIfOK(t);case 134:return this.popNandPushIfOK(t+1,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(t+1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(t);case 137:return this.popNandPushIfOK(t+1,this.secondClock());case 138:return this.popNandPushIfOK(t+1,this.someObject());case 139:return this.popNandPushIfOK(t+1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(t);case 141:return this.primitiveClipboardText(t);case 142:return this.popNandPushIfOK(t+1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(t);case 145:return this.primitiveConstantFill(t);case 146:return this.namedPrimitive("JoystickTabletPlugin","primitiveReadJoystick",t);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",t);case 148:return this.popNandPushIfOK(t+1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(t);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(t);case 151:if(this.oldPrims)return this.primitiveFileClose(t);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(t);case 153:if(this.oldPrims)return this.primitiveFileOpen(t);case 154:if(this.oldPrims)return this.primitiveFileRead(t);case 155:if(this.oldPrims)return this.primitiveFileSetPosition(t);case 156:if(this.oldPrims)return this.primitiveFileDelete(t);case 157:if(this.oldPrims)return this.primitiveFileSize(t);break;case 158:return this.oldPrims?this.primitiveFileWrite(t):(this.vm.warnOnce("missing primitive: 158 (primitiveCompareWith)"),!1);case 159:return this.oldPrims?this.primitiveFileRename(t):this.popNandPushIntIfOK(t+1,1664525*this.stackSigned53BitInt(0)&268435455);case 160:return this.oldPrims?this.primitiveDirectoryCreate(t):this.primitiveAdoptInstance(t);case 161:return this.oldPrims?this.primitiveDirectoryDelimitor(t):(this.vm.warnOnce("missing primitive: 161 (primitiveSetIdentityHash)"),!1);case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(t);break;case 163:return this.oldPrims?this.primitiveDirectoryDelete(t):(this.vm.warnOnce("missing primitive: 163 (primitiveGetImmutability)"),!1);case 164:return this.popNandPushIfOK(t+1,this.vm.trueObj);case 165:case 166:return this.primitiveIntegerAtAndPut(t);case 167:return!1;case 168:return this.primitiveCopyObject(t);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(t):this.popNandPushBoolIfOK(t+1,this.vm.stackValue(1)!==this.vm.stackValue(0));case 170:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStart",t):this.primitiveAsCharacter(t);case 171:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStartWithSemaphore",t):this.popNandPushIfOK(t+1,this.stackNonInteger(0).hash);case 172:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundStop",t):(this.vm.warnOnce("missing primitive: 172 (primitiveFetchMourner)"),this.popNandPushIfOK(t+1,this.vm.nilObj));case 173:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",t):this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!0));case 174:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",t):this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!0));case 175:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",t):this.vm.image.isSpur?this.popNandPushIfOK(t+1,this.behaviorHash(this.stackNonInteger(0))):(this.vm.warnOnce("primitive 175 called in non-spur image"),this.popNandPushIfOK(t+1,this.identityHash(this.stackNonInteger(0))));case 176:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",t):this.popNandPushIfOK(t+1,this.vm.image.isSpur?4194303:4095);case 177:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",t):this.popNandPushIfOK(t+1,this.allInstancesOf(this.stackNonInteger(0)));case 178:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primPluckedSoundmixSampleCountintostartingAtpan",t):!1;case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",t);break;case 180:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",t):!1;case 181:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",t):this.primitiveSizeInBytesOfInstance(t);case 182:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",t):this.primitiveSizeInBytes(t);case 183:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",t):this.primitiveIsPinned(t);case 184:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",t):this.primitivePin(t);case 185:return this.oldPrims?this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",t):this.primitiveExitCriticalSection(t);case 186:if(this.oldPrims)break;return this.primitiveEnterCriticalSection(t);case 187:if(this.oldPrims)break;return this.primitiveTestAndSetOwnershipOfCriticalSection(t);case 188:if(this.oldPrims)break;return this.primitiveExecuteMethodArgsArray(t);case 189:return this.oldPrims?this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",t):!1;case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",t);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",t);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",t);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",t);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",t);break;case 195:case 196:case 197:case 198:case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",t):this.primitiveClosureCopyWithCopiedValues(t);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",t):this.primitiveClosureValue(t);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",t):this.primitiveClosureValue(t);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",t):this.primitiveClosureValue(t);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAddressLookupResult",t):this.primitiveClosureValue(t);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",t):this.primitiveClosureValue(t);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",t):this.primitiveClosureValueWithArgs(t);case 207:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStatus",t):this.primitiveFullClosureValue(t);case 208:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverError",t):this.primitiveFullClosureValueWithArgs(t);case 209:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketCreate",t):this.primitiveFullClosureValueNoContextSwitch(t);case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",t):this.popNandPushIfOK(t+1,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",t):this.popNandPushIfOK(t+1,this.objectAtPut(!1,!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",t):this.popNandPushIfOK(t+1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",t);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",t);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",t);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",t);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketConnectToPort",t);case 218:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketListenWithOrWithoutBacklog",t):this.primitiveDoNamedPrimitive(t);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",t);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",t);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",t):this.primitiveClosureValueNoContextSwitch(t);case 222:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",t):this.primitiveClosureValueNoContextSwitch(t);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",t);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",t);case 225:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAccept",t);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(t);case 231:return this.primitiveForceDisplayUpdate(t);case 232:return this.vm.warnOnce("missing primitive: 232 (primitiveFormPrint)"),!1;case 233:return this.primitiveSetFullScreen(t);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveDecompressFromByteArray",t);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",t);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",t);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",t);break;case 238:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",t):this.namedPrimitive("FloatArrayPlugin","primitiveAt",t);case 239:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortClose",t):this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",t);case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",t):this.popNandPushIfOK(t+1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",t):this.popNandPushIfOK(t+1,this.microsecondClockLocal());case 242:if(this.oldPrims)break;return this.primitiveSignalAtUTCMicroseconds(t);case 243:return this.oldPrims?this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",t):(this.vm.warnOnce("missing primitive: 243 (primitiveUpdateTimeZone)"),!1);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",t);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",t);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",t);break;case 248:return this.primitiveArrayBecome(t,!1,!1);case 249:return this.primitiveArrayBecome(t,!1,!0);case 254:return this.primitiveVMParameter(t);case 521:return this.namedPrimitive("MIDIPlugin","primitiveMIDIClosePort",t);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",t);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",t);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",t);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",t);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",t);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",t);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",t);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",t);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",t);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",t);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",t);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",t);case 571:return this.primitiveUnloadModule(t);case 572:return this.primitiveListBuiltinModule(t);case 573:return this.primitiveListLoadedModule(t);case 575:return this.vm.warnOnce("missing primitive: 575 (primitiveHighBit)"),!1;case 576:return this.vm.primitiveInvokeObjectAsMethod(t,r);case 578:return this.vm.warnOnce("missing primitive: 578 (primitiveSuspendAndBackupPC)"),!1}return console.error("primitive "+e+" not implemented yet"),!1},namedPrimitive:function(e,t,r){var i,s=""===e?this:this.loadedModules[e],n=!1,a=(void 0===s&&(s=this.loadModule(e),this.loadedModules[e]=s,n=!0),!1),o=this.vm.sp;return s?(this.interpreterProxy.argCount=r,"function"==typeof(i=s[this.interpreterProxy.primitiveName=t])?a=s[t](r):"string"==typeof i?a=this[i](r):this.vm.warnOnce("missing primitive: "+e+"."+t)):n&&(this.success?this.vm.warnOnce("missing module: "+e+" ("+t+")"):this.vm.warnOnce("failed to load module: "+e+" ("+t+")")),(!0===a||!1!==a&&this.success)&&this.vm.sp!==o-r&&!this.vm.frozen&&this.vm.warnOnce("stack unbalanced after primitive "+e+"."+t,"error"),!0===a||!1===a?a:this.success},doNamedPrimitive:function(e,t){if(t.pointersSize()<2)return!1;var r=t.pointers[1];if(4!==r.pointersSize())return!1;this.primMethod=t;t=r.pointers[0].bytesAsString(),r=r.pointers[1].bytesAsString();return this.namedPrimitive(t,r,e)},fakePrimitive:function(e,t,r){return this.vm.warnOnce("faking primitive: "+e),void 0===t?this.vm.popN(r):this.vm.popNandPush(r+1,this.makeStObject(t)),!0}},"modules",{loadModule:function(e){var t,r=Squeak.externalModules[e]||this.builtinModules[e]||this.loadModuleDynamically(e);return r?(this.patchModules[e]&&this.patchModule(r,e),r.setInterpreter&&!r.setInterpreter(this.interpreterProxy)?(console.log("Wrong interpreter proxy version: "+e),null):("function"==typeof(t=r.initialiseModule)?r.initialiseModule():"string"==typeof t&&this[t](),this.interpreterProxy.failed()?(console.log("Module initialization failed: "+e),null):(r.getModuleName&&(e=r.getModuleName()),console.log("Loaded module: "+e),r))):null},loadModuleDynamically:function(e){},patchModule:function(e,t){var r,i=this.patchModules[t];for(r in i)e[r]=i[r]},unloadModule:function(e){var t=this.loadedModules[e];if(!e||!t||t===this)return null;delete this.loadedModules[e];var r=t.unloadModule;return"function"==typeof r?t.unloadModule(this):"string"==typeof r&&this[r](this),console.log("Unloaded module: "+e),t},loadFunctionFrom:function(e,t){var r=""===t?this:this.loadedModules[t];if(void 0===r&&(r=this.loadModule(t),this.loadedModules[t]=r),r){var i=r[e];if("function"==typeof i)return i.bind(r);if("string"==typeof i)return this[i].bind(this);this.vm.warnOnce("missing primitive: "+t+"."+e)}return null},primitiveUnloadModule:function(e){var t=this.stackNonInteger(0).bytesAsString();return!!t&&(this.unloadModule(t),this.popNIfOK(e))},primitiveListBuiltinModule:function(e){var t,r=this.stackInteger(0)-1;return!!this.success&&(t=Object.keys(this.builtinModules),this.popNandPushIfOK(e+1,this.makeStObject(t[r])))},primitiveListLoadedModule:function(e){var t=this.stackInteger(0)-1;if(!this.success)return!1;var r,i=[];for(r in this.loadedModules){var s=this.loadedModules[r];s&&(s=s.getModuleName?s.getModuleName():r,i.push(s))}return this.popNandPushIfOK(e+1,this.makeStObject(i[t]))}},"stack access",{popNIfOK:function(e){return!!this.success&&(this.vm.popN(e),!0)},pop2andPushBoolIfOK:function(e){return this.vm.success=this.success,this.vm.pop2AndPushBoolResult(e)},popNandPushBoolIfOK:function(e,t){return!!this.success&&(this.vm.popNandPush(e,t?this.vm.trueObj:this.vm.falseObj),!0)},popNandPushIfOK:function(e,t){return!(!this.success||null==t||(this.vm.popNandPush(e,t),0))},popNandPushIntIfOK:function(e,t){return!(!this.success||!this.vm.canBeSmallInt(t)||(this.vm.popNandPush(e,t),0))},popNandPushFloatIfOK:function(e,t){return!!this.success&&(this.vm.popNandPush(e,this.makeFloat(t)),!0)},stackNonInteger:function(e){return this.checkNonInteger(this.vm.stackValue(e))},stackInteger:function(e){return this.checkSmallInt(this.vm.stackValue(e))},stackPos32BitInt:function(e){return this.positive32BitValueOf(this.vm.stackValue(e))},pos32BitIntFor:function(e){if(0<=e&&e<=Squeak.MaxSmallInt)return e;for(var t=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],t=this.vm.instantiateClass(t,4),r=t.bytes,i=0;i<4;i++)r[i]=e>>>8*i&255;return t},pos53BitIntFor:function(e){if(e<=4294967295)return this.pos32BitIntFor(e);if(9007199254740991<e)return console.warn("Out of range: pos53BitIntFor("+e+")"),this.success=!1,0;for(var t=e<=0xffffffffff?5:e<=0xffffffffffff?6:7,r=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],r=this.vm.instantiateClass(r,t),i=r.bytes,s=0;s<t;s++)i[s]=255&e,e/=256;return r},stackSigned32BitInt:function(e){e=this.vm.stackValue(e);if("number"==typeof e)return e;if(4===e.bytesSize()){for(var t=e.bytes,r=0,i=0,s=1;i<4;i++,s*=256)r+=t[i]*s;if(this.isA(e,Squeak.splOb_ClassLargePositiveInteger)&&r<=2147483647)return r;if(this.isA(e,Squeak.splOb_ClassLargeNegativeInteger)&&-2147483648<=-r)return-r}return this.success=!1,0},signed32BitIntegerFor:function(e){if(e>=Squeak.MinSmallInt&&e<=Squeak.MaxSmallInt)return e;for(var t=e<0,r=t?-e:e,e=t?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,t=this.vm.instantiateClass(this.vm.specialObjects[e],4),i=t.bytes,s=0;s<4;s++)i[s]=r>>>8*s&255;return t},stackFloat:function(e){return this.checkFloat(this.vm.stackValue(e))},stackBoolean:function(e){return this.checkBoolean(this.vm.stackValue(e))},stackSigned53BitInt:function(e){e=this.vm.stackValue(e);if("number"==typeof e)return e;var t=e.bytesSize();if(t<=7){for(var r=e.bytes,i=0,s=0,n=1;s<t;s++,n*=256)i+=r[s]*n;if(i<=9007199254740991){if(this.isA(e,Squeak.splOb_ClassLargePositiveInteger))return i;if(this.isA(e,Squeak.splOb_ClassLargeNegativeInteger))return-i}}return this.success=!1,0}},"numbers",{doBitAnd:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e&t):0},doBitOr:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e|t):0},doBitXor:function(){var e=this.stackPos32BitInt(1),t=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(e^t):0},doBitShift:function(){var e,t=this.stackPos32BitInt(1),r=this.stackInteger(0);if(!this.success)return 0;if(r<0){if(r<-31)return 0;e=t>>>-r}else{if(31<r)return this.success=!1,0;if((e=t<<r)>>>r!==t)return this.success=!1,0}return this.pos32BitIntFor(e)},safeFDiv:function(e,t){return 0===t?(this.success=!1,1):e/t},floatAsSmallInt:function(e){e=0<=e?Math.floor(e):Math.ceil(e);return this.ensureSmallInt(e)},floatFractionPart:function(e){return-9007199254740991<=e&&e<=9007199254740991?e-Math.floor(e):(this.success=!1,0)},frexp_exponent:function(e){var t,r;return 0==e?0:((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e),0===(r=t.getUint32(0)>>>20&2047)&&(t.setFloat64(0,e*Math.pow(2,64)),r=(t.getUint32(0)>>>20&2047)-64),r-1022)},ldexp:function(e,t){for(var r=Math.min(3,Math.ceil(Math.abs(t)/1023)),i=e,s=0;s<r;s++)i*=Math.pow(2,Math.floor((t+s)/r));return i},primitiveLessThanLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)>this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},primitiveGreaterOrEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)>=this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(e){return this.popNandPushBoolIfOK(e+1,this.stackSigned53BitInt(1)!==this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(e){return e.isFloat?e.float:"number"==typeof e?e:0},positive32BitValueOf:function(e){if("number"==typeof e)return 0<=e?e:(this.success=!1,0);if(!this.isA(e,Squeak.splOb_ClassLargePositiveInteger)||4!==e.bytesSize())return this.success=!1,0;for(var t=e.bytes,r=0,i=0,s=1;i<4;i++,s*=256)r+=t[i]*s;return r},checkFloat:function(e){return e.isFloat?e.float:"number"==typeof e?e:(this.success=!1,0)},checkSmallInt:function(e){return"number"==typeof e?e:(this.success=!1,0)},checkNonInteger:function(e){return"number"!=typeof e?e:(this.success=!1,this.vm.nilObj)},checkBoolean:function(e){return!!e.isTrue||!e.isFalse&&(this.success=!1)},indexableSize:function(e){return"number"==typeof e?-1:e.indexableSize(this)},isA:function(e,t){return e.sqClass===this.vm.specialObjects[t]},isKindOf:function(e,t){for(var r=e.sqClass,i="number"==typeof t?this.vm.specialObjects[t]:t;!r.isNil;){if(r===i)return!0;r=r.superclass()}return!1},isAssociation:function(e){if(this.associationClass&&e.sqClass===this.associationClass)return!0;if(!e.pointers||2!==e.pointers.length)return!1;for(var t=this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].sqClass;0<t.superclass().classInstSize();)t=t.superclass();var r=this.isKindOf(e,t);return r&&(this.associationClass=e.sqClass),r},ensureSmallInt:function(e){return e===(0|e)&&this.vm.canBeSmallInt(e)?e:(this.success=!1,0)},charFromInt:function(e){var t,r=this.vm.specialObjects[Squeak.splOb_CharacterTable].pointers[e];return r||(t=this.vm.specialObjects[Squeak.splOb_ClassCharacter],(r=this.vm.instantiateClass(t,0)).pointers[0]=e),r},charFromIntSpur:function(e){return this.vm.image.getCharacter(e)},charToInt:function(e){return e.pointers[0]},charToIntSpur:function(e){return e.hash},makeFloat:function(e){var t=this.vm.specialObjects[Squeak.splOb_ClassFloat],t=this.vm.instantiateClass(t,2);return t.float=e,t},makeLargeIfNeeded:function(e){return this.vm.canBeSmallInt(e)?e:this.makeLargeInt(e)},makeLargeInt:function(e){if(e<0)throw Error("negative large ints not implemented yet");if(4294967295<e)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(e)},makePointWithXandY:function(e,t){var r=this.vm.specialObjects[Squeak.splOb_ClassPoint],r=this.vm.instantiateClass(r,0);return r.pointers[Squeak.Point_x]=e,r.pointers[Squeak.Point_y]=t,r},makeStArray:function(e,t){for(var r=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],e.length),i=0;i<e.length;i++)r.pointers[i]=this.makeStObject(e[i],t);return r},makeStByteArray:function(e){for(var t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassByteArray],e.length),r=0;r<e.length;r++)t.bytes[r]=255&e[r];return t},makeStString:function(e){for(var t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],e.length),r=0;r<e.length;++r)t.bytes[r]=255&e.charCodeAt(r);return t},makeStStringFromBytes:function(e,t){for(var r=e.length,i=(t&&(r=e.indexOf(0))<0&&(r=e.length),this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],r)),s=0;s<r;++s)i.bytes[s]=e[s];return i},makeStObject:function(e,t){if(null==e)return this.vm.nilObj;if(!0===e)return this.vm.trueObj;if(!1===e)return this.vm.falseObj;if(e.sqClass)return e;if("number"==typeof e)return e===(0|e)?this.makeLargeIfNeeded(e):this.makeFloat(e);if(t)return(t=this.vm.instantiateClass(t,0)).jsObject=e,t;if("string"==typeof e||"Uint8Array"===e.constructor.name)return this.makeStString(e);if("Array"===e.constructor.name)return this.makeStArray(e);throw Error("cannot make smalltalk object")},pointsTo:function(e,t){return!!e.pointers&&0<=e.pointers.indexOf(t)},asUint8Array:function(e){if("Uint8Array"===e.constructor.name)return e;if("ArrayBuffer"===e.constructor.name)return new Uint8Array(e);if("string"!=typeof e)throw Error("unknown buffer type");for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},filenameToSqueak:function(e){e="/SqueakJS"+("/"!==e[0]?"/":"")+e;return e=this.emulateMac?("Macintosh HD"+e).replace(/\//g,"€").replace(/:/g,"/").replace(/€/g,":"):e},filenameFromSqueak:function(e){return(this.emulateMac?e.replace(/^[^:]*:/,":").replace(/\//g,"€").replace(/:/g,"/").replace(/€/g,":"):e).replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(e,t,r){var i,s=this.stackNonInteger(1),n=this.stackPos32BitInt(0);if(!this.success)return s;if(e){if((i=this.atCache[s.hash&this.atCacheMask]).array!==s)return this.success=!1,s}else{if(s.isFloat)return e=s.floatData(),1==n?this.pos32BitIntFor(e.getUint32(0,!1)):2==n?this.pos32BitIntFor(e.getUint32(4,!1)):(this.success=!1,s);i=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],s,t,r)}return n<1||n>i.size?(this.success=!1,s):r?s.pointers[n-1]:s.isPointers()?s.pointers[n-1+i.ivarOffset]:s.isWords()?i.convertChars?this.charFromInt(1073741823&s.words[n-1]):this.pos32BitIntFor(s.words[n-1]):s.isBytes()?i.convertChars?this.charFromInt(255&s.bytes[n-1]):255&s.bytes[n-1]:n-1-(e=4*s.pointersSize())<0?(this.success=!1,s):255&s.bytes[n-1-e]},objectAtPut:function(e,t,r){var i,s=this.stackNonInteger(2),n=this.stackPos32BitInt(1);if(!this.success)return s;if(e){if((i=this.atPutCache[s.hash&this.atCacheMask]).array!==s)return this.success=!1,s}else{if(s.isFloat)return e=this.stackPos32BitInt(0),!this.success||1!=n&&2!=n?this.success=!1:((o=s.floatData()).setUint32(1==n?0:4,e,!1),s.float=o.getFloat64(0)),this.vm.stackValue(0);i=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],s,t,r)}if(n<1||n>i.size)return this.success=!1,s;var a,e=this.vm.stackValue(0);if(r)return s.dirty=!0,s.pointers[n-1]=e;if(s.isPointers())return s.dirty=!0,s.pointers[n-1+i.ivarOffset]=e;if(s.isWords()){if(t){if(e.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,e;if("number"!=typeof(a=this.charToInt(e)))return this.success=!1,e}else a=this.stackPos32BitInt(0);this.success&&(s.words[n-1]=a)}else{if(t){if(e.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,e;if("number"!=typeof(a=this.charToInt(e)))return this.success=!1,e}else{if("number"!=typeof e)return this.success=!1,e;a=e}if(a<0||255<a)this.success=!1;else if(s.isBytes())s.bytes[n-1]=a;else{var o=4*s.pointersSize();if(n-1-o<0)return this.success=!1,s;s.bytes[n-1-o]=a}}return e},objectSize:function(e){var t=this.vm.stackValue(0),r=-1;return e?t.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?r=t.pointersSize():t.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(r=t.bytesSize()):r=this.indexableSize(t),-1===r?(this.success=!1,-1):this.pos32BitIntFor(r)},initAtCache:function(){this.atCacheSize=32,this.atCacheMask=this.atCacheSize-1,this.atCache=[],this.atPutCache=[],this.nonCachedInfo={};for(var e=0;e<this.atCacheSize;e++)this.atCache.push({}),this.atPutCache.push({})},makeAtCacheInfo:function(e,t,r,i,s){t=this.vm.verifyAtSelector===t&&this.vm.verifyAtClass===r.sqClass&&!this.vm.isContext(r)?e[r.hash&this.atCacheMask]:this.nonCachedInfo;return t.array=r,t.convertChars=i,s?(t.size=r.instSize()+Math.max(0,r.indexableSize(this)),t.ivarOffset=0):(t.size=r.indexableSize(this),t.ivarOffset=r.isPointers()?r.instSize():0),t}},"basic",{instantiateClass:function(e,t){return 4*t>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory, failing allocation"),this.success=!1,this.vm.primFailCode=Squeak.PrimErrNoMemory,null):this.vm.instantiateClass(e,t)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(e){return this.vm.image.objectAfter(e)||0},someInstanceOf:function(e){e=this.vm.image.someInstanceOf(e);return e||(this.success=!1,0)},nextInstanceAfter:function(e){e=this.vm.image.nextInstanceAfter(e);return e||(this.success=!1,0)},allInstancesOf:function(e){var e=this.vm.image.allInstancesOf(e),t=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],e.length);return t.pointers=e,t},identityHash:function(e){return e.hash},identityHashSpur:function(e){var t=e.hash;return 0<t?t:e.hash=this.newObjectHash()},behaviorHash:function(e){var t=e.hash;return 0<t?t:this.vm.image.enterIntoClassTable(e)},newObjectHash:function(e){return Math.floor(4194302*Math.random())+1},primitivePin:function(e){var t,r=this.stackNonInteger(1),i=this.stackBoolean(0);return!!this.success&&(t=r.pinned,r.pinned=i,this.popNandPushIfOK(e+1,this.makeStObject(!!t)))},primitiveIsPinned:function(e){var t=this.stackNonInteger(0);return!!this.success&&this.popNandPushIfOK(e+1,this.makeStObject(!!t.pinned))},primitiveSizeInBytesOfInstance:function(e){var t,r;return!(1<e)&&(r=this.stackNonInteger(e),t=e?this.stackInteger(0):0,r=r.classByteSizeOfInstance(t),this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(r)))},primitiveSizeInBytes:function(e){var t=this.stackNonInteger(0).totalBytes();return this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t))},primitiveAsCharacter:function(e){var t=this.stackInteger(0);return!(t<0||1073741823<t||!(t=this.charFromInt(t)))&&this.popNandPushIfOK(e+1,t)},primitiveFullGC:function(e){this.vm.image.fullGC("primitive");var t=this.vm.image.bytesLeft();return this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t))},primitivePartialGC:function(e){for(var t=this.vm.image.partialGC("primitive"),r=0;t;)r+=t.totalBytes(),t=t.nextObject;console.log("    old space: "+this.vm.image.oldSpaceBytes.toLocaleString()+" bytes, young space: "+r.toLocaleString()+" bytes, total: "+(this.vm.image.oldSpaceBytes+r).toLocaleString()+" bytes");var i=this.vm.image.bytesLeft()-r;return this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(i))},primitiveMakePoint:function(e,t){var r=this.vm.stackValue(1),i=this.vm.stackValue(0);return!(t&&(this.checkFloat(r),this.checkFloat(i),!this.success)||(this.vm.popNandPush(1+e,this.makePointWithXandY(r,i)),0))},primitiveStoreStackp:function(e){var t=this.stackNonInteger(1),r=this.stackInteger(0);if(!this.success||r<0||this.vm.decodeSqueakSP(r)>=t.pointers.length)return!1;for(var i=t.pointers[Squeak.Context_stackPointer];i<r;)t.pointers[this.vm.decodeSqueakSP(++i)]=this.vm.nilObj;return t.pointers[Squeak.Context_stackPointer]=r,this.vm.popN(e),!0},primitiveChangeClass:function(e){var t,r;return!(2<e||(t=this.stackNonInteger(1),r=this.stackNonInteger(0),!this.changeClassTo(t,r.sqClass)))&&this.popNIfOK(e)},primitiveAdoptInstance:function(e){var t,r;return!(2<e||(t=this.stackNonInteger(1),r=this.stackNonInteger(0),!this.changeClassTo(r,t)))&&this.popNIfOK(e)},changeClassTo:function(e,t){if(e.sqClass.isCompact!==t.isCompact)return!1;var r=t.classInstIsPointers();if(e.isPointers()){if(!r)return!1;if(e.sqClass.classInstSize()!==t.classInstSize())return!1}else{if(r)return!1;var r=e.isBytes(),i=t.classInstIsBytes();if(r&&!i){if(e.bytes){if(3&e.bytes.length)return!1;e.words=new Uint32Array(e.bytes.buffer),delete e.bytes}}else!r&&i&&e.words&&(e.bytes=new Uint8Array(e.words.buffer),delete e.words)}return e._format=t.classInstFormat(),e.sqClass=t,!0},primitiveDoPrimitiveWithArgs:function(e){var t=this.stackNonInteger(0),r=this.stackInteger(1);if(this.success){var i=t.pointersSize(),s=this.vm.activeContext.pointersSize();if(!(this.vm.sp+i>=s)){this.vm.popN(2);for(var n=0;n<i;n++)this.vm.push(t.pointers[n]);if(this.vm.tryPrimitive(r,i))return!0;this.vm.popN(i),this.vm.push(r),this.vm.push(t)}}return!1},primitiveDoNamedPrimitive:function(e){var t=this.stackNonInteger(0),r=this.stackNonInteger(1),i=this.stackNonInteger(2);if(this.success){var s=t.pointersSize(),n=this.vm.activeContext.pointersSize();if(!(this.vm.sp+s>=n)){this.vm.popN(3),this.vm.push(r);for(var a=0;a<s;a++)this.vm.push(t.pointers[a]);if(this.doNamedPrimitive(s,i))return!0;this.vm.popN(s+1),this.vm.push(i),this.vm.push(r),this.vm.push(t)}}return!1},primitiveShortAtAndPut:function(e){var t,r=this.stackNonInteger(e),i=this.stackInteger(e-1)-1,r=r.wordsAsInt16Array();if(!this.success||!r||i<0||i>=r.length)return!1;if(e<2)t=r[i];else{if((t=this.stackInteger(0))<-32768||32767<t)return!1;r[i]=t}return this.popNandPushIfOK(e+1,t),!0},primitiveIntegerAtAndPut:function(e){var t,r=this.stackNonInteger(e),i=this.stackInteger(e-1)-1,r=r.wordsAsInt32Array();if(!this.success||!r||i<0||i>=r.length)return!1;if(e<2)t=this.signed32BitIntegerFor(r[i]);else{if(t=this.stackSigned32BitInt(0),!this.success)return!1;r[i]=t}return this.popNandPushIfOK(e+1,t),!0},primitiveConstantFill:function(e){var t=this.stackNonInteger(1),r=this.stackPos32BitInt(0);if(!this.success||!t.isWordsOrBytes())return!1;var i=t.words||t.bytes;if(i){if(i===t.bytes&&255<r)return!1;for(var s=0;s<i.length;s++)i[s]=r}return this.vm.popN(e),!0},primitiveNewMethod:function(e){var t=this.stackInteger(0),r=this.stackInteger(1);if(!this.success)return 0;for(var i=this.vm.instantiateClass(this.vm.stackValue(2),r),s=(i.pointers=[t],i.methodNumLits()),n=0;n<s;n++)i.pointers.push(this.vm.nilObj);return this.vm.popNandPush(1+e,i),this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=i),!0},primitiveExecuteMethodArgsArray:function(e){var t=this.stackNonInteger(0),r=this.stackNonInteger(1),i=this.vm.stackValue(2);if(!this.success||!t.isMethod()||4<e)return!1;var s=t.methodNumArgs();if(s!==r.pointersSize())return!1;this.vm.popNandPush(e+1,i);for(var n=0;n<s;n++)this.vm.push(r.pointers[n]);return this.vm.executeNewMethod(i,t,s,t.methodPrimitiveIndex(),null,null),!0},primitiveArrayBecome:function(e,t,r){var i=this.stackNonInteger(e),s=this.stackNonInteger(e-1);return 1<e&&(r=this.stackBoolean(e-2)),!!this.success&&(this.success=this.vm.image.bulkBecome(i.pointers,s.pointers,t,r),this.popNIfOK(e))},doStringReplace:function(){var e=this.stackNonInteger(4),t=this.stackInteger(3)-1,r=this.stackInteger(2)-t,i=this.stackNonInteger(1),s=this.stackInteger(0)-1;if(this.success)if(i.sameFormatAs(e))if(i.isPointers()){var n=i.pointersSize(),a=i.instSize();if((s+=a)<0||n<s+r)this.success=!1;else if(n=e.pointersSize(),(t+=e.instSize())<0||n<t+r)this.success=!1;else for(var o=0;o<r;o++)e.pointers[t+o]=i.pointers[s+o]}else if(i.isWords()){n=i.wordsSize();if(s<0||n<s+r)this.success=!1;else if(n=e.wordsSize(),t<0||n<t+r)this.success=!1;else if(i.isFloat&&e.isFloat)e.float=i.float;else if(i.isFloat)e.wordsAsFloat64Array()[t]=i.float;else if(e.isFloat)e.float=i.wordsAsFloat64Array()[s];else for(o=0;o<r;o++)e.words[t+o]=i.words[s+o]}else{n=i.bytesSize();if(s<0||n<s+r)this.success=!1;else if(n=e.bytesSize(),t<0||n<t+r)this.success=!1;else for(o=0;o<r;o++)e.bytes[t+o]=i.bytes[s+o]}else this.success=!1;return e},primitiveCopyObject:function(e){var t=this.stackNonInteger(1),r=this.stackNonInteger(0),i=t.pointersSize();if(!this.success||t.isWordsOrBytes()||t.sqClass!==r.sqClass||i!==r.pointersSize())return!1;for(var s=0;s<i;s++)t.pointers[s]=r.pointers[s];return t.dirty=r.dirty,this.vm.popN(e),!0},primitiveStoreImageSegment:function(e){var t=this.stackNonInteger(2),r=this.stackNonInteger(1),i=this.stackNonInteger(0);return!!(t.pointers&&r.words&&i.pointers)&&!!this.vm.image.storeImageSegment(r,i,t)&&(this.vm.popN(e),!0)},primitiveLoadImageSegment:function(e){var t=this.stackNonInteger(1),r=this.stackNonInteger(0);return!(!t.words||!r.pointers||!(t=this.vm.image.loadImageSegment(t,r)))&&this.popNandPushIfOK(e+1,t)}},"blocks/closures",{doBlockCopy:function(){var e,t,r=this.vm.stackValue(1),i=this.stackInteger(0),s=r;return this.vm.isContext(s)||(this.success=!1),this.success?(e=(s="number"==typeof s.pointers[Squeak.Context_method]?s.pointers[Squeak.BlockContext_home]:s).pointersSize()-s.instSize(),e=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],e),t=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method),e.pointers[Squeak.BlockContext_initialIP]=t,e.pointers[Squeak.Context_instructionPointer]=t,e.pointers[Squeak.Context_stackPointer]=0,e.pointers[Squeak.BlockContext_argumentCount]=i,e.pointers[Squeak.BlockContext_home]=s,e.pointers[Squeak.Context_sender]=this.vm.nilObj,e):r},primitiveBlockValue:function(e){var t=this.vm.stackValue(e);if(!this.isA(t,Squeak.splOb_ClassBlockContext))return!1;var r=t.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof r)return!1;if(r!=e)return!1;if(!t.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-e+1,t.pointers,Squeak.Context_tempFrameStart,e);r=t.pointers[Squeak.BlockContext_initialIP];return t.pointers[Squeak.Context_instructionPointer]=r,t.pointers[Squeak.Context_stackPointer]=e,t.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(e+1),this.vm.newActiveContext(t),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveBlockValueWithArgs:function(e){var t=this.vm.stackValue(1),r=this.vm.stackValue(0);if(!this.isA(t,Squeak.splOb_ClassBlockContext))return!1;if(!this.isA(r,Squeak.splOb_ClassArray))return!1;var i=t.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof i)return!1;if(i!=r.pointersSize())return!1;if(!t.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(r.pointers,0,t.pointers,Squeak.Context_tempFrameStart,i);r=t.pointers[Squeak.BlockContext_initialIP];return t.pointers[Squeak.Context_instructionPointer]=r,t.pointers[Squeak.Context_stackPointer]=i,t.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(e+1),this.vm.newActiveContext(t),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveClosureCopyWithCopiedValues:function(e){return this.vm.breakNow("primitiveClosureCopyWithCopiedValues"),!1},primitiveClosureValue:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewClosureMethod(t,e),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0)},primitiveClosureValueWithArgs:function(e){var t=this.vm.top(),r=t.pointersSize(),e=this.vm.stackValue(e);if(r!==e.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var i=0;i<r;i++)this.vm.push(t.pointers[i]);return this.activateNewClosureMethod(e,r),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveClosureValueNoContextSwitch:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewClosureMethod(t,e),!0)},primitiveFullClosureValue:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewFullClosure(t,e),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0)},primitiveFullClosureValueWithArgs:function(e){var t=this.vm.top(),r=t.pointersSize(),e=this.vm.stackValue(e);if(r!==e.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var i=0;i<r;i++)this.vm.push(t.pointers[i]);return this.activateNewFullClosure(e,r),this.vm.interruptCheckCounter--<=0&&this.vm.checkForInterrupts(),!0},primitiveFullClosureValueNoContextSwitch:function(e){var t=this.vm.stackValue(e);return e===t.pointers[Squeak.Closure_numArgs]&&(this.activateNewFullClosure(t,e),!0)},activateNewClosureMethod:function(e,t){for(var r=e.pointers[Squeak.Closure_outerContext],i=r.pointers[Squeak.Context_method],s=this.vm.allocateOrRecycleContext(i.methodNeedsLargeFrame()),n=e.pointers.length-Squeak.Closure_firstCopiedValue,a=(s.pointers[Squeak.Context_sender]=this.vm.activeContext,s.pointers[Squeak.Context_instructionPointer]=e.pointers[Squeak.Closure_startpc],s.pointers[Squeak.Context_stackPointer]=t+n,s.pointers[Squeak.Context_method]=r.pointers[Squeak.Context_method],s.pointers[Squeak.Context_closure]=e,s.pointers[Squeak.Context_receiver]=r.pointers[Squeak.Context_receiver],Squeak.Context_tempFrameStart),o=0;o<t;o++)s.pointers[a++]=this.vm.stackValue(t-o-1);for(o=0;o<n;o++)s.pointers[a++]=e.pointers[Squeak.Closure_firstCopiedValue+o];this.vm.popN(t+1),this.vm.newActiveContext(s)},activateNewFullClosure:function(e,t){for(var r=e.pointers[Squeak.ClosureFull_method],i=this.vm.allocateOrRecycleContext(r.methodNeedsLargeFrame()),s=e.pointers.length-Squeak.ClosureFull_firstCopiedValue,n=(i.pointers[Squeak.Context_sender]=this.vm.activeContext,i.pointers[Squeak.Context_instructionPointer]=this.vm.encodeSqueakPC(0,r),i.pointers[Squeak.Context_stackPointer]=r.methodTempCount(),i.pointers[Squeak.Context_method]=r,i.pointers[Squeak.Context_closure]=e,i.pointers[Squeak.Context_receiver]=e.pointers[Squeak.ClosureFull_receiver],Squeak.Context_tempFrameStart),a=0;a<t;a++)i.pointers[n++]=this.vm.stackValue(t-a-1);for(a=0;a<s;a++)i.pointers[n++]=e.pointers[Squeak.ClosureFull_firstCopiedValue+a];this.vm.popN(t+1),this.vm.newActiveContext(i),r.compiled||this.vm.compileIfPossible(r)}},"scheduling",{primitiveResume:function(){return this.resume(this.vm.top()),!0},primitiveSuspend:function(){var e=this.vm.top();if(e===this.activeProcess())this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.wakeHighestPriority());else{var t=e.pointers[Squeak.Proc_myList];if(t.isNil)return!1;if(this.removeProcessFromList(e,t),!this.success)return!1;e.pointers[Squeak.Proc_myList]=this.vm.nilObj,this.vm.popNandPush(1,t)}return!0},getScheduler:function(){return this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value]},activeProcess:function(){return this.getScheduler().pointers[Squeak.ProcSched_activeProcess]},resume:function(e){var t=this.activeProcess();t.pointers[Squeak.Proc_priority]<e.pointers[Squeak.Proc_priority]?(this.putToSleep(t),this.transferTo(e)):this.putToSleep(e)},putToSleep:function(e){var t=e.pointers[Squeak.Proc_priority],t=this.getScheduler().pointers[Squeak.ProcSched_processLists].pointers[t-1];this.linkProcessToList(e,t)},transferTo:function(e){var t=this.getScheduler(),r=t.pointers[Squeak.ProcSched_activeProcess];t.pointers[Squeak.ProcSched_activeProcess]=e,t.dirty=!0,r.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,r.dirty=!0,this.vm.newActiveContext(e.pointers[Squeak.Proc_suspendedContext]),e.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj,this.oldPrims||(e.pointers[Squeak.Proc_myList]=this.vm.nilObj),this.vm.reclaimableContextCount=0,this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow()),this.vm.logProcess&&console.log("\n============= Process Switch ==================\n"+this.vm.printProcess(e,!0,this.vm.logSends?"| ":"")+"===============================================")},wakeHighestPriority:function(){var e,t=this.getScheduler().pointers[Squeak.ProcSched_processLists],r=t.pointersSize()-1;do{if(r<0)throw Error("scheduler could not find a runnable process")}while(e=t.pointers[r--],this.isEmptyList(e));return this.removeFirstLinkOfList(e)},linkProcessToList:function(e,t){var r;this.isEmptyList(t)?t.pointers[Squeak.LinkedList_firstLink]=e:((r=t.pointers[Squeak.LinkedList_lastLink]).pointers[Squeak.Link_nextLink]=e,r.dirty=!0),t.pointers[Squeak.LinkedList_lastLink]=e,t.dirty=!0,e.pointers[Squeak.Proc_myList]=t,e.dirty=!0},isEmptyList:function(e){return e.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(e){var t,r=e.pointers[Squeak.LinkedList_firstLink];return r===e.pointers[Squeak.LinkedList_lastLink]?(e.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,e.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj):(t=r.pointers[Squeak.Link_nextLink],e.pointers[Squeak.LinkedList_firstLink]=t,e.dirty=!0),r.pointers[Squeak.Link_nextLink]=this.vm.nilObj,r},removeProcessFromList:function(e,t){var r=t.pointers[Squeak.LinkedList_firstLink],i=t.pointers[Squeak.LinkedList_lastLink];if(e===r){var s=e.pointers[Squeak.Link_nextLink];t.pointers[Squeak.LinkedList_firstLink]=s,e===i&&(t.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj)}else{for(var n=r;;){if(n.isNil)return void(this.oldPrims&&(this.success=!1));if((s=n.pointers[Squeak.Link_nextLink])===e)break;n=s}s=e.pointers[Squeak.Link_nextLink],n.pointers[Squeak.Link_nextLink]=s,e===i&&(t.pointers[Squeak.LinkedList_lastLink]=n)}e.pointers[Squeak.Link_nextLink]=this.vm.nilObj},registerSemaphore:function(e){var t=this.vm.top();return this.isA(t,Squeak.splOb_ClassSemaphore)?this.vm.specialObjects[e]=t:this.vm.specialObjects[e]=this.vm.nilObj,this.vm.stackValue(1)},primitiveWait:function(){var e,t=this.vm.top();return!!this.isA(t,Squeak.splOb_ClassSemaphore)&&(0<(e=t.pointers[Squeak.Semaphore_excessSignals])?t.pointers[Squeak.Semaphore_excessSignals]=e-1:(this.linkProcessToList(this.activeProcess(),t),this.transferTo(this.wakeHighestPriority())),!0)},primitiveSignal:function(){var e=this.vm.top();return!!this.isA(e,Squeak.splOb_ClassSemaphore)&&(this.synchronousSignal(e),!0)},synchronousSignal:function(e){this.isEmptyList(e)?e.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(e))},signalAtMilliseconds:function(e,t){this.isA(e,Squeak.splOb_ClassSemaphore)?(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=e,this.vm.nextWakeupTick=t):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0)},primitiveSignalAtMilliseconds:function(e){var t=this.stackInteger(0),r=this.stackNonInteger(1);return!!this.success&&(this.signalAtMilliseconds(r,t),this.vm.popN(e),!0)},primitiveSignalAtUTCMicroseconds:function(e){var t=this.stackSigned53BitInt(0),r=this.stackNonInteger(1);return!!this.success&&(t=t/1e3+Squeak.EpochUTC-this.vm.startupTime&Squeak.MillisecondClockMask,this.signalAtMilliseconds(r,t),this.vm.popN(e),!0)},signalSemaphoreWithIndex:function(e){this.semaphoresToSignal.push(e)},signalExternalSemaphores:function(){for(var e=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,t=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var r=e[this.semaphoresToSignal.shift()-1];r.sqClass==t&&this.synchronousSignal(r)}},primitiveEnterCriticalSection:function(e){var t,r,i;return!(1<e||(t=this.vm.stackValue(e),r=e?this.vm.top():this.activeProcess(),(i=t.pointers[Squeak.Mutex_owner]).isNil?(t.pointers[Squeak.Mutex_owner]=r,t.dirty=!0,this.popNandPushIfOK(e+1,this.vm.falseObj)):i===r?this.popNandPushIfOK(e+1,this.vm.trueObj):(this.popNandPushIfOK(e+1,this.vm.falseObj),this.linkProcessToList(r,t),this.transferTo(this.wakeHighestPriority())),0))},primitiveExitCriticalSection:function(e){var t,r=this.vm.top();return this.isEmptyList(r)?r.pointers[Squeak.Mutex_owner]=this.vm.nilObj:(t=this.removeFirstLinkOfList(r),r.pointers[Squeak.Mutex_owner]=t,r.dirty=!0,this.resume(t)),!0},primitiveTestAndSetOwnershipOfCriticalSection:function(e){var t,r,i;return!(1<e||(t=this.vm.stackValue(e),r=e?this.vm.top():this.activeProcess(),(i=t.pointers[Squeak.Mutex_owner]).isNil?(t.pointers[Squeak.Mutex_owner]=r,t.dirty=!0,this.popNandPushIfOK(e+1,this.vm.falseObj)):i===r?this.popNandPushIfOK(e+1,this.vm.trueObj):this.popNandPushIfOK(e+1,this.vm.nilObj),0))}},"vm functions",{primitiveGetAttribute:function(e){var t=this.stackInteger(0);if(!this.success)return!1;var r=this.display.argv,i=this.display.vmOptions,s=null;switch(t){case 0:s=r&&r[0]||this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:s=r&&r[1]||this.display.documentName;break;case 2:s=r&&r[2]||this.display.documentName;break;case 1001:s=this.vm.options.unix?"unix":Squeak.platformName;break;case 1002:s=Squeak.osVersion;break;case 1003:s=Squeak.platformSubtype;break;case 1004:s=Squeak.vmVersion+" "+Squeak.vmMakerVersion;break;case 1005:s=Squeak.windowSystem;break;case 1006:s=Squeak.vmBuild;break;case 1007:s=Squeak.vmInterpreterVersion;break;case 1009:s=Squeak.vmVersion+" Date: "+Squeak.vmDate;break;default:if(0<=t&&r&&r.length>t)s=r[t];else{if(!(t<0&&i&&i.length>-t-1))return!1;s=i[-t-1]}}return this.vm.popNandPush(e+1,this.makeStObject(s)),!0},setLowSpaceThreshold:function(){var e=this.stackInteger(0);return this.success&&(this.vm.lowSpaceThreshold=e),this.vm.stackValue(1)},primitiveVMParameter:function(e){var t=this.vm.image.isSpur?71:44;switch(e){case 0:for(var r=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],t),i=0;i<t;i++)r.pointers[i]=this.makeStObject(this.vmParameterAt(i+1));return this.popNandPushIfOK(1,r);case 1:var s=this.stackInteger(0);return s<1||t<s?!1:this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(s)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(e){switch(e){case 1:case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return this.vm.image.pgcCount;case 10:return this.vm.image.pgcMilliseconds;case 11:return this.vm.image.gcTenured;case 15:case 16:case 17:case 18:case 19:case 20:case 22:return 0;case 23:return this.vm.image.extraVMMemory;case 40:return 4;case 41:return this.vm.image.formatVersion();case 44:case 46:case 48:return 0;case 54:return this.vm.image.bytesLeft();case 65:return 0;case 67:return this.vm.image.totalMemory}return null},primitiveImageName:function(e){return 0==e?this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name))):(this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString()),Squeak.Settings.squeakImageName=this.vm.image.name,this.vm.popN(e),!0)},primitiveSnapshot:function(e){this.vm.popNandPush(1,this.vm.trueObj),this.vm.storeContextRegisters(),this.activeProcess().pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.image.fullGC("snapshot");var t=this.vm.image.writeToBuffer();return Squeak.flushAllFiles&&(Squeak.flushAllFiles(),Squeak.filePut(this.vm.image.name,t)),this.vm.popNandPush(1,this.vm.falseObj),!0},primitiveQuit:function(e){return Squeak.flushAllFiles&&Squeak.flushAllFiles(),this.display.quitFlag=!0,this.vm.breakNow("quit"),!0},primitiveExitToDebugger:function(e){return this.vm.breakNow("debugger primitive"),!0},primitiveSetGCBiasToGrow:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,e)},primitiveSetGCBiasToGrowGCLimit:function(e){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,e)}},"time",{primitiveRelinquishProcessorForMicroseconds:function(e){return this.vm.popN(e),this.vm.goIdle(),!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(e){this.vm.startupTime=Date.now()-e},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClock:function(e){var t,r,i=Date.now()-e.epoch;return"object"!=typeof performance?this.pos53BitIntFor(1e3*i):(t=1e3*performance.now()%1e3|0,(i=i<(r=e.millis)?r:i)===r&&t<e.micros&&i++,e.millis=i,this.pos53BitIntFor(1e3*i+(e.micros=t)))},microsecondClockUTC:function(){return this.microsecondClockUTCState||(this.microsecondClockUTCState={epoch:Squeak.EpochUTC,millis:0,micros:0}),this.microsecondClock(this.microsecondClockUTCState)},microsecondClockLocal:function(){return this.microsecondClockLocalState||(this.microsecondClockLocalState={epoch:Squeak.Epoch,millis:0,micros:0}),this.microsecondClock(this.microsecondClockLocalState)},primitiveUtcWithOffset:function(e){var t,r=new Date,i=this.pos53BitIntFor(1e3*r.getTime()),r=-60*r.getTimezoneOffset();return 0<e?((t=this.vm.stackValue(0)).pointers[0]=i,t.pointers[1]=r,this.popNandPushIfOK(e+1,t)):this.popNandPushIfOK(e+1,this.makeStArray([i,r])),!0}}),Object.subclass("Squeak.Compiler","initialization",{initialize:function(e){this.vm=e,this.comments=!!Squeak.Compiler.comments,this.specialSelectors=["+","-","<",">","<=",">=","=","~=","*","/","\\\\","@","bitShift:","//","bitAnd:","bitOr:","at:","at:put:","size","next","nextPut:","atEnd","==","class","blockCopy:","value","value:","do:","new","new:","x","y"],this.doitCounter=0,this.blockCounter=0}},"accessing",{compile:function(i,s,n){var e,a,t,r;void 0===i.compiled?i.compiled=!1:(this.singleStep=!1,this.debug=this.comments,this.debug&&!s&&(a=i.sqClass===this.vm.specialObjects[Squeak.splOb_ClassCompiledMethod],this.vm.allMethodsDo(function(e,t,r){if(a?t===i:t.pointers.includes(i))return s=e,n=r,!0})),s&&(t=s.className(),r=n.bytesAsString(),this.debug)&&((a=i.sqClass===this.vm.specialObjects[Squeak.splOb_ClassCompiledMethod])||(t="[] in "+t),e=s.allInstVarNames()),i.compiled=this.generate(i,t,r,e))},enableSingleStepping:function(i,s,n){var e,t,r;return i.compiled&&i.compiled.canSingleStep||(this.singleStep=!0,this.debug=!0,s||this.vm.allMethodsDo(function(e,t,r){if(t===i)return s=e,n=r,!0}),e=s&&s.className(),t=n&&n.bytesAsString(),r=s&&s.allInstVarNames(),i.compiled=this.generate(i,e,t,r),i.compiled.canSingleStep=!0),!0},functionNameFor:function(e,t){return void 0===e||"?"===e?this.method.sqClass===this.vm.specialObjects[Squeak.splOb_ClassCompiledMethod]?"DOIT_"+ ++this.doitCounter:"BLOCK_"+ ++this.blockCounter:(e=e.replace(/ /g,"_").replace("[]","Block"),/[^a-zA-Z0-9:_]/.test(t)?e+"__"+t.replace(/./g,function(e){return{"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[e]||"OPERATOR"})+"__":e+"_"+t.replace(/:/g,"ː"))}},"generating",{generate:function(e,t,r,i){this.method=e,this.sista=e.methodSignFlag(),this.pc=0,this.endPC=0,this.prevPC=0,this.source=[],this.sourceLabels={},this.needsLabel={},this.sourcePos={},this.needsVar={},this.needsBreak=!1,t&&r&&this.source.push("// ",t,">>",r,"\n"),this.instVarNames=i,this.allVars=["context","stack","rcvr","inst[","temp[","lit["],this.sourcePos.context=this.source.length,this.source.push("var context = vm.activeContext;\n"),this.sourcePos.stack=this.source.length,this.source.push("var stack = context.pointers;\n"),this.sourcePos.rcvr=this.source.length,this.source.push("var rcvr = vm.receiver;\n"),this.sourcePos["inst["]=this.source.length,this.source.push("var inst = rcvr.pointers;\n"),this.sourcePos["temp["]=this.source.length,this.source.push("var temp = vm.homeContext.pointers;\n"),this.sourcePos["lit["]=this.source.length,this.source.push("var lit = vm.method.pointers;\n"),this.sourcePos["loop-start"]=this.source.length,this.source.push("while (true) switch (vm.pc) {\ncase 0:\n"),this.sista?this.generateSista(e):this.generateV3(e);i=this.functionNameFor(t,r),this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC');\n}")):(this.sourcePos["loop-end"]=this.source.length,this.source.push("default: vm.interpretOne(true); return;\n}"),this.deleteUnneededLabels()),this.deleteUnneededVariables(),e="'use strict';\nreturn function "+i+"(vm) {\n"+this.source.join("")+"}";return new Function(e)()},generateV3:function(e){for(this.done=!1;!this.done;){var t=e.bytes[this.pc++],r=0;switch(248&t){case 0:case 8:this.generatePush("inst[",15&t,"]");break;case 16:case 24:this.generatePush("temp[",6+(15&t),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(31&t),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(31&t),"].pointers[1]");break;case 96:this.generatePopInto("inst[",7&t,"]");break;case 104:this.generatePopInto("temp[",6+(7&t),"]");break;case 112:switch(t){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(t){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode "+t)}break;case 128:case 136:this.generateV3Extended(t);break;case 144:this.generateJump(1+(7&t));break;case 152:this.generateJumpIf(!1,1+(7&t));break;case 160:r=e.bytes[this.pc++],this.generateJump(256*((7&t)-4)+r);break;case 168:r=e.bytes[this.pc++],this.generateJumpIf(t<172,256*(3&t)+r);break;case 176:case 184:this.generateNumericOp(t);break;case 192:case 200:this.generateQuickPrim(t);break;case 208:case 216:this.generateSend("lit[",1+(15&t),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(15&t),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(15&t),"]",2,!1)}}},generateV3Extended:function(e){switch(e){case 128:switch((t=this.method.bytes[this.pc++])>>6){case 0:return void this.generatePush("inst[",63&t,"]");case 1:return void this.generatePush("temp[",6+(63&t),"]");case 2:return void this.generatePush("lit[",1+(63&t),"]");case 3:return void this.generatePush("lit[",1+(63&t),"].pointers[1]")}case 129:switch((t=this.method.bytes[this.pc++])>>6){case 0:return void this.generateStoreInto("inst[",63&t,"]");case 1:return void this.generateStoreInto("temp[",6+(63&t),"]");case 2:throw Error("illegal store into literal");case 3:return void this.generateStoreInto("lit[",1+(63&t),"].pointers[1]")}return;case 130:switch((t=this.method.bytes[this.pc++])>>6){case 0:return void this.generatePopInto("inst[",63&t,"]");case 1:return void this.generatePopInto("temp[",6+(63&t),"]");case 2:throw Error("illegal pop into literal");case 3:return void this.generatePopInto("lit[",1+(63&t),"].pointers[1]")}case 131:return t=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&t),"]",t>>5,!1);case 132:switch(t=this.method.bytes[this.pc++],r=this.method.bytes[this.pc++],t>>5){case 0:return void this.generateSend("lit[",1+r,"]",31&t,!1);case 1:return void this.generateSend("lit[",1+r,"]",31&t,!0);case 2:return void this.generatePush("inst[",r,"]");case 3:return void this.generatePush("lit[",1+r,"]");case 4:return void this.generatePush("lit[",1+r,"].pointers[1]");case 5:return void this.generateStoreInto("inst[",r,"]");case 6:return void this.generatePopInto("inst[",r,"]");case 7:return void this.generateStoreInto("lit[",1+r,"].pointers[1]")}case 133:return t=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&t),"]",t>>5,!0);case 134:return t=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(63&t),"]",t>>6,!1);case 135:return void this.generateInstruction("pop","vm.sp--");case 136:return this.needsVar.stack=!0,void this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");case 137:return this.needsVar.stack=!0,void this.generateInstruction("push thisContext","stack[++vm.sp] = vm.exportThisContext()");case 138:var t=this.method.bytes[this.pc++];return void this.generateClosureTemps(127&t,127<t);case 139:return t=this.method.bytes[this.pc++],r=this.method.bytes[this.pc++],void this.generateCallPrimitive(t+256*r,129);case 140:return t=this.method.bytes[this.pc++],r=this.method.bytes[this.pc++],void this.generatePush("temp[",6+r,"].pointers[",t,"]");case 141:return t=this.method.bytes[this.pc++],r=this.method.bytes[this.pc++],void this.generateStoreInto("temp[",6+r,"].pointers[",t,"]");case 142:return t=this.method.bytes[this.pc++],r=this.method.bytes[this.pc++],void this.generatePopInto("temp[",6+r,"].pointers[",t,"]");case 143:t=this.method.bytes[this.pc++];var r=this.method.bytes[this.pc++],i=this.method.bytes[this.pc++];return void this.generateClosureCopy(15&t,t>>4,r<<8|i)}},generateSista:function(){var e,t=this.method.bytes,r=0,i=0;for(this.done=!1;!this.done;){switch(e=t[this.pc++]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.generatePush("inst[",15&e,"]");break;case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:this.generatePush("lit[",1+(15&e),"].pointers[1]");break;case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:this.generatePush("lit[",1+(31&e),"]");break;case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:this.generatePush("temp[",6+(7&e),"]");break;case 72:case 73:case 74:case 75:this.generatePush("temp[",6+(3&e)+8,"]");break;case 76:this.generatePush("rcvr");break;case 77:this.generatePush("vm.trueObj");break;case 78:this.generatePush("vm.falseObj");break;case 79:this.generatePush("vm.nilObj");break;case 80:this.generatePush(0);break;case 81:this.generatePush(1);break;case 82:this.needsVar.stack=!0,this.generateInstruction("push thisContext","stack[++vm.sp] = vm.exportThisContext()");break;case 83:this.needsVar.stack=!0,this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");break;case 84:case 85:case 86:case 87:throw Error("unusedBytecode "+e);case 88:this.generateReturn("rcvr");break;case 89:this.generateReturn("vm.trueObj");break;case 90:this.generateReturn("vm.falseObj");break;case 91:this.generateReturn("vm.nilObj");break;case 92:this.generateReturn("stack[vm.sp]");break;case 93:this.generateBlockReturn("vm.nilObj");break;case 94:this.generateBlockReturn();break;case 95:break;case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:this.generateNumericOp(e);break;case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 124:case 125:case 126:case 127:this.generateQuickPrim(e);break;case 128:case 129:case 130:case 131:case 132:case 133:case 134:case 135:case 136:case 137:case 138:case 139:case 140:case 141:case 142:case 143:this.generateSend("lit[",1+(15&e),"]",0,!1);break;case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:this.generateSend("lit[",1+(15&e),"]",1,!1);break;case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:case 168:case 169:case 170:case 171:case 172:case 173:case 174:case 175:this.generateSend("lit[",1+(15&e),"]",2,!1);break;case 176:case 177:case 178:case 179:case 180:case 181:case 182:case 183:this.generateJump(1+(7&e));break;case 184:case 185:case 186:case 187:case 188:case 189:case 190:case 191:this.generateJumpIf(!0,1+(7&e));break;case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:this.generateJumpIf(!1,1+(7&e));break;case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:this.generatePopInto("inst[",7&e,"]");break;case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:this.generatePopInto("temp[",6+(7&e),"]");break;case 216:this.generateInstruction("pop","vm.sp--");break;case 217:throw Error("unumplementedBytecode: 0xD9 (unconditional trap)");case 218:case 219:case 220:case 221:case 222:case 223:throw Error("unusedBytecode "+e);case 224:r=256*r+(s=t[this.pc++]);continue;case 225:i=256*i+((s=t[this.pc++])<128?s:s-256);continue;case 226:s=t[this.pc++],this.generatePush("inst[",s+256*r,"]");break;case 227:s=t[this.pc++],this.generatePush("lit[",1+s+256*r,"].pointers[1]");break;case 228:s=t[this.pc++],this.generatePush("lit[",1+s+256*r,"]");break;case 229:s=t[this.pc++],this.generatePush("temp[",6+s,"]");break;case 230:throw Error("unusedBytecode 0xE6");case 231:var s=t[this.pc++];this.generateClosureTemps(127&s,127<s);break;case 232:s=t[this.pc++],this.generatePush(s+256*i);break;case 233:s=t[this.pc++],this.generatePush("vm.image.getCharacter(",s+256*i,")");break;case 234:s=t[this.pc++],this.generateSend("lit[",1+(s>>3)+(r<<5),"]",(7&s)+(i<<3),!1);break;case 235:var n=(7&(s=t[this.pc++]))+((63&i)<<3);this.generateSend("lit[",1+((s>>3)+(r<<5)),"]",n,!(64<=i)||"directed");break;case 236:throw Error("unimplemented bytecode: 0xEC (class trap)");case 237:s=t[this.pc++],this.generateJump(s+256*i);break;case 238:s=t[this.pc++],this.generateJumpIf(!0,s+256*i);break;case 239:s=t[this.pc++],this.generateJumpIf(!1,s+256*i);break;case 240:s=t[this.pc++],this.generatePopInto("inst[",s+256*r,"]");break;case 241:s=t[this.pc++],this.generatePopInto("lit[",1+s+256*r,"].pointers[1]");break;case 242:s=t[this.pc++],this.generatePopInto("temp[",6+s,"]");break;case 243:s=t[this.pc++],this.generateStoreInto("inst[",s+256*r,"]");break;case 244:s=t[this.pc++],this.generateStoreInto("lit[",1+s+256*r,"].pointers[1]");break;case 245:s=t[this.pc++],this.generateStoreInto("temp[",6+s,"]");break;case 246:case 247:throw Error("unusedBytecode "+e);case 248:s=t[this.pc++],a=t[this.pc++],this.generateCallPrimitive(s+256*a,245);break;case 249:s=t[this.pc++],a=t[this.pc++],this.generatePushFullClosure(s+255*r,a);break;case 250:s=t[this.pc++];var a=t[this.pc++],n=(7&s)+8*(15&r);this.generateClosureCopy(n,(s>>3&7)+8*(r>>4),a+(i<<8));break;case 251:s=t[this.pc++],a=t[this.pc++],this.generatePush("temp[",6+a,"].pointers[",s,"]");break;case 252:s=t[this.pc++],a=t[this.pc++],this.generateStoreInto("temp[",6+a,"].pointers[",s,"]");break;case 253:s=t[this.pc++],a=t[this.pc++],this.generatePopInto("temp[",6+a,"].pointers[",s,"]");break;case 254:case 255:throw Error("unusedBytecode "+e);default:throw Error("illegal bytecode: "+e)}i=r=0}},generatePush:function(e,t,r,i,s){this.debug&&this.generateDebugCode("push",e,t,r,i,s),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.stack=!0,this.source.push("stack[++vm.sp] = ",e),void 0!==t&&(this.source.push(t,r),void 0!==i)&&this.source.push(i,s),this.source.push(";\n")},generateStoreInto:function(e,t,r,i,s){this.debug&&this.generateDebugCode("store into",e,t,r,i,s),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.stack=!0,this.source.push(e),void 0!==t&&(this.source.push(t,r),void 0!==i)&&this.source.push(i,s),this.source.push(" = stack[vm.sp];\n"),this.generateDirty(e,t,r)},generatePopInto:function(e,t,r,i,s){this.debug&&this.generateDebugCode("pop into",e,t,r,i,s),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.stack=!0,this.source.push(e),void 0!==t&&(this.source.push(t,r),void 0!==i)&&this.source.push(i,s),this.source.push(" = stack[vm.sp--];\n"),this.generateDirty(e,t,r)},generateReturn:function(e){this.debug&&this.generateDebugCode("return",e),this.generateLabel(),this.needsVar[e]=!0,this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",e,"); return;\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateBlockReturn:function(e){this.debug&&this.generateDebugCode("block return"),this.generateLabel(),e||(this.needsVar.stack=!0,e="stack[vm.sp--]"),this.needsVar.context=!0,this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",e,", context.pointers[0]); return;\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateJump:function(e){var t=this.pc+e;this.debug&&this.generateDebugCode("jump to "+t),this.generateLabel(),this.needsVar.context=!0,this.source.push("vm.pc = ",t,"; "),e<0&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n","}\n"),this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return;\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[t]=!0,t>this.endPC&&(this.endPC=t)},generateJumpIf:function(e,t){t=this.pc+t;this.debug&&this.generateDebugCode("jump if "+e+" to "+t),this.generateLabel(),this.needsVar.stack=!0,this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",e,"Obj) {vm.pc = ",t,"; "),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return; else "),this.source.push("continue}\n","else if (cond !== vm.",!e,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return}\n"),this.needsLabel[this.pc]=!0,this.needsLabel[t]=!0,t>this.endPC&&(this.endPC=t)},generateQuickPrim:function(e){switch(this.debug&&this.generateDebugCode("quick send #"+this.specialSelectors[16+(15&e)]),this.generateLabel(),15&e){case 0:return this.needsVar.stack=!0,this.source.push("var a, b; if ((a=stack[vm.sp-1]).sqClass === vm.specialObjects[7] && a.pointers && typeof (b=stack[vm.sp]) === 'number' && b>0 && b<=a.pointers.length) {\n","  stack[--vm.sp] = a.pointers[b-1];","} else { var c = vm.primHandler.objectAt(true,true,false); if (vm.primHandler.success) stack[--vm.sp] = c; else {\n","  vm.pc = ",this.pc,"; vm.sendSpecial(16); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }}\n"),void(this.needsLabel[this.pc]=!0);case 1:return this.needsVar.stack=!0,this.source.push("var a, b; if ((a=stack[vm.sp-2]).sqClass === vm.specialObjects[7] && a.pointers && typeof (b=stack[vm.sp-1]) === 'number' && b>0 && b<=a.pointers.length) {\n","  var c = stack[vm.sp]; stack[vm.sp-=2] = a.pointers[b-1] = c; a.dirty = true;","} else { vm.primHandler.objectAtPut(true,true,false); if (vm.primHandler.success) stack[vm.sp-=2] = c; else {\n","  vm.pc = ",this.pc,"; vm.sendSpecial(17); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }}\n"),void(this.needsLabel[this.pc]=!0);case 2:return this.needsVar.stack=!0,this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return; }\n"),void(this.needsLabel[this.pc]=!0);case 6:return this.needsVar.stack=!0,void this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");case 7:return this.needsVar.stack=!0,void this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");case 8:return this.needsVar.rcvr=!0,this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) ","{vm.sendSpecial(",16+(15&e),"); return}\n"),this.needsLabel[this.pc]=!0,void(this.needsLabel[this.pc+2]=!0);case 9:case 10:case 11:return this.needsVar.rcvr=!0,this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,")) vm.sendSpecial(",16+(15&e),"); return;\n"),void(this.needsLabel[this.pc]=!0)}this.needsVar.rcvr=!0,this.needsVar.context=!0,this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&e,"))"," vm.sendSpecial(",16+(15&e),");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateNumericOp:function(e){switch(this.debug&&this.generateDebugCode("quick send #"+this.specialSelectors[15&e]),this.generateLabel(),this.needsLabel[this.pc]=!0,15&e){case 0:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 1:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 2:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 3:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 4:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 5:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 6:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 7:return this.needsVar.stack=!0,void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return}\n");case 8:return void this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(8); return}\n");case 9:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return}\n");case 10:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return}\n");case 11:return void this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",this.pc,"; vm.sendSpecial(11); return}\n");case 12:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return}\n");case 13:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return}\n");case 14:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(14); return}\n");case 15:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return}\n")}},generateSend:function(e,t,r,i,s){this.debug&&this.generateDebugCode(("directed"===s?"directed super send ":s?"super send ":"send ")+("lit["===e?this.method.pointers[t].bytesAsString():"...")),this.generateLabel(),this.needsVar[e]=!0,this.needsVar.context=!0,this.source.push("vm.pc = ",this.pc),"directed"===s?this.source.push("; vm.sendSuperDirected(",e,t,r,", ",i,"); "):this.source.push("; vm.send(",e,t,r,", ",i,", ",s,"); "),this.source.push("if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return;\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateClosureTemps:function(e,t){if(this.debug&&this.generateDebugCode("closure temps"),this.generateLabel(),this.needsVar.stack=!0,this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",e,");\n"),t){for(var r=0;r<e;r++)this.source.push("array.pointers[",r,"] = stack[vm.sp - ",e-r-1,"];\n");this.source.push("stack[vm.sp -= ",e-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(e,t,r){var i=this.pc,r=i+r;if(this.debug&&this.generateDebugCode("push closure("+i+"-"+(r-1)+"): "+t+" copied, "+e+" args"),this.generateLabel(),this.needsVar.stack=!0,this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",t,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",i+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",e,";\n"),0<t){for(var s=0;s<t;s++)this.source.push("closure.pointers[",s+3,"] = stack[vm.sp - ",t-s-1,"];\n");this.source.push("stack[vm.sp -= ",t-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",r,";\n"),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return;\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[i]=!0,this.needsLabel[r]=!0,r>this.endPC&&(this.endPC=r)},generatePushFullClosure:function(e,t){this.debug&&this.generateDebugCode("push full closure "+(e+1)),this.generateLabel(),this.needsVar["lit["]=!0,this.needsVar.rcvr=!0,this.needsVar.stack=!0;var r=63&t,i=1==(t>>6&1)?"vm.nilObj":"context";if(1==(t>>7&1))throw Error("on-stack receiver not yet supported");if(this.source.push("var closure = vm.newFullClosure(",i,", ",r,", lit[",1+e,"]);\n"),this.source.push("closure.pointers[",Squeak.ClosureFull_receiver,"] = rcvr;\n"),"context"===i&&this.source.push("vm.reclaimableContextCount = 0;\n"),0<r){for(var s=0;s<r;s++)this.source.push("closure.pointers[",s+Squeak.ClosureFull_firstCopiedValue,"] = stack[vm.sp - ",r-s-1,"];\n");this.source.push("stack[vm.sp -= ",r-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n")},generateCallPrimitive:function(e,t){this.debug&&this.generateDebugCode("call primitive "+e),this.generateLabel(),this.method.bytes[this.pc]===t&&(this.needsVar.stack=!0,this.source.push("if (vm.primFailCode) {stack[vm.sp] = vm.getErrorObjectFromPrimFailCode(); vm.primFailCode = 0;}\n"))},generateDirty:function(e,t,r){switch(e){case"inst[":this.source.push("rcvr.dirty = true;\n");break;case"lit[":this.source.push(e,t,"].dirty = true;\n");break;case"temp[":"]"!==r&&this.source.push(e,t,"].dirty = true;\n");break;default:throw Error("unexpected target "+e)}},generateLabel:function(){this.prevPC&&(this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n")),this.prevPC=this.pc},generateDebugCode:function(e,t,r,i,s,n){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) {vm.pc = ",this.prevPC,"; return}\n"),this.needsLabel[this.prevPC]=!0);for(var a=[],o=this.prevPC;o<this.pc;o++)a.push((this.method.bytes[o]+256).toString(16).slice(-2).toUpperCase());if(this.source.push("// ",this.prevPC," <",a.join(" "),"> ",e),void 0!==t)switch(this.source.push(" "),t){case"vm.nilObj":this.source.push("nil");break;case"vm.trueObj":this.source.push("true");break;case"vm.falseObj":this.source.push("false");break;case"rcvr":this.source.push("self");break;case"stack[vm.sp]":this.source.push("top of stack");break;case"inst[":this.instVarNames?this.source.push(this.instVarNames[r]):this.source.push("inst var ",r);break;case"temp[":this.source.push("tmp",r-6),"]"!==i&&this.source.push("[",s,"]");break;case"lit[":var u=this.method.pointers[r];"]"===i?this.source.push(u):this.source.push(u.pointers[0].bytesAsString());break;default:this.source.push(t)}this.source.push("\n"),this.needsBreak=this.singleStep},generateInstruction:function(e,t){this.debug&&this.generateDebugCode(e),this.generateLabel(),this.source.push(t,";\n")},deleteUnneededLabels:function(){var e,t=!1;for(e in this.sourceLabels)if(this.needsLabel[e])t=!0;else for(var r=0;r<3;r++)this.source[this.sourceLabels[e]+r]="";t||(this.source[this.sourcePos["loop-start"]]="",this.source[this.sourcePos["loop-end"]]="")},deleteUnneededVariables:function(){this.needsVar.stack&&(this.needsVar.context=!0),this.needsVar["inst["]&&(this.needsVar.rcvr=!0);for(var e=0;e<this.allVars.length;e++){var t=this.allVars[e];this.needsVar[t]||(this.source[this.sourcePos[t]]="")}}}),Object.extend(Squeak,"audio",{startAudioOut:function(){return this.audioOutContext||(this.audioOutContext=new AudioContext),this.audioOutContext},stopAudioOut:function(){this.audioOutContext&&(this.audioOutContext.close(),this.audioOutContext=null)},startAudioIn:function(t,r){return this.audioInContext?(this.audioInSource.disconnect(),t(this.audioInContext,this.audioInSource)):navigator.mediaDevices?void navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.audioInContext=new AudioContext,this.audioInSource=this.audioInContext.createMediaStreamSource(e),t(this.audioInContext,this.audioInSource)}).catch(e=>r("cannot access microphone. "+e.name+": "+e.message)):r("test: audio input not supported")},stopAudioIn:function(){this.audioInSource&&(this.audioInSource.disconnect(),this.audioInSource=null,this.audioInContext.close(),this.audioInContext=null)}}),Object.extend(Squeak,"known classes",{BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4}),Object.extend(Squeak.Primitives.prototype,"display",{displayDirty:function(){}}),Object.extend(Squeak.Primitives.prototype,"display",{initDisplay:function(e){this.display=e,this.display.vm=this.vm,this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]},primitiveBeCursor:function(e){if(this.display.cursorCanvas){var t=this.loadForm(this.stackNonInteger(e),!0),r=1===e?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!t)return!1;var i=this.display.cursorCanvas,s=i.getContext("2d"),n={left:0,top:0,right:t.width,bottom:t.height},r=(i.width=t.width,i.height=t.height,1===t.depth?r?(t=this.cursorMergeMask(t,r),this.showForm(s,t,n,[0,4278190335,4294967295,4278190080])):this.showForm(s,t,n,[0,4278190080]):this.showForm(s,t,n,!0),this.display.scale||1);t.width<=16&&t.height<=16&&(r=1),i.style.width=Math.round(i.width*r)+"px",i.style.height=Math.round(i.height*r)+"px",this.display.cursorOffsetX=t.offsetX*r|0,this.display.cursorOffsetY=t.offsetY*r|0}return this.vm.popN(e),!0},cursorMergeMask:function(e,t){for(var r=new Uint32Array(16),i=0;i<16;i++){for(var s=e.bits[i],n=t.bits[i],a=2147483648,o=0,u=0;u<16;u++)o=o|(n&a)>>u|(s&a)>>u+1,a>>>=1;r[i]=o}return{obj:e.obj,bits:r,depth:2,width:16,height:16,offsetX:e.offsetX,offsetY:e.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(e){var t=this.vm.stackValue(0);return this.vm.specialObjects[Squeak.splOb_TheDisplay]=t,this.vm.popN(e),!0},primitiveReverseDisplay:function(e){if(this.reverseDisplay=!this.reverseDisplay,this.redrawDisplay(),this.display.cursorCanvas){for(var t=this.display.cursorCanvas,r=t.getContext("2d"),t=r.getImageData(0,0,t.width,t.height),i=new Uint32Array(t.data.buffer),s=0;s<i.length;s++)i[s]=16777215^i[s];r.putImageData(t,0,0)}return!0},primitiveShowDisplayRect:function(e){var t={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};return!!this.success&&(this.redrawDisplay(t),this.vm.popN(e),!0)},redrawDisplay:function(e){var t=this.theDisplay(),r={left:0,top:0,right:t.width,bottom:t.height};e&&(e.left>r.left&&(r.left=e.left),e.right<r.right&&(r.right=e.right),r.top<e.top&&(r.top=e.top),e.bottom<r.bottom)&&(r.bottom=e.bottom),r.left<r.right&&r.top<r.bottom&&this.displayUpdate(t,r)},showForm:function(e,t,r,i){if(r){var s=r.left,n=r.top,a=r.right-s,o=r.bottom-n,u=e.createImageData(a,o),l=u.data,c=(l.buffer||(l=new Uint8Array(a*o*4)),new Uint32Array(l.buffer));switch(t.depth){case 1:case 2:case 4:case 8:if(!(h=i||this.swappedColors)){for(var h=[],f=0;f<256;f++){var p=(4278255360&(F=this.indexedColors[f]))+((16711680&F)>>16)+((255&F)<<16);h[f]=p}this.swappedColors=h}this.reverseDisplay&&(h=i?i.map(function(e){return 16777215^e}):(this.reversedColors||(this.reversedColors=h.map(function(e){return 16777215^e})),this.reversedColors));for(var d=(1<<t.depth)-1,m=32-(s%t.pixPerWord+1)*t.depth,v=0;v<o;v++){for(var g=t.pitch*n+(s/t.pixPerWord|0),b=m,k=t.bits[g],S=u.width*v,y=0;y<a;y++)c[S++]=h[k>>>b&d],(b-=t.depth)<0&&(b=32-t.depth,k=t.bits[++g]);n++}break;case 16:for(m=s%2?0:16,v=0;v<o;v++){for(g=t.pitch*n+(s/2|0),b=m,k=t.bits[g],S=u.width*v,y=0;y<a;y++){var I=k>>>b;c[S++]=((31744&I)>>7)+((992&I)<<6)+((31&I)<<19)+4278190080,(b-=16)<0&&(b=16,k=t.bits[++g])}n++}break;case 32:for(var O=i?0:4278190080,v=0;v<o;v++){for(g=t.pitch*n+s,S=u.width*v,y=0;y<a;y++){var F,p=4278255360&(F=t.bits[g++])|(16711680&F)>>16|(255&F)<<16|O;c[S++]=p}n++}break;default:throw Error("depth not implemented")}u.data!==l&&u.data.set(l),e.putImageData(u,r.left,r.top)}},primitiveDeferDisplayUpdates:function(e){var t=this.stackBoolean(0);return!!this.success&&(this.deferDisplayUpdates=t,this.vm.popN(e),!0)},primitiveForceDisplayUpdate:function(e){return this.vm.breakOut(),this.vm.popN(e),!0},primitiveScanCharacters:function(e){if(6!==e)return!1;var t=this.stackInteger(0),r=this.stackNonInteger(1),i=this.stackInteger(2),s=this.stackNonInteger(3),n=this.stackInteger(4),e=this.stackInteger(5);if(!this.success)return!1;if(r.pointersSize()<258||!s.isBytes())return!1;if(!(0<e&&0<n&&n<=s.bytesSize()))return!1;var a=this.stackNonInteger(6);if(!this.success||a.pointersSize()<4)return!1;var o=this.checkSmallInt(a.pointers[0]),u=this.checkSmallInt(a.pointers[1]),l=this.checkNonInteger(a.pointers[2]),c=this.checkNonInteger(a.pointers[3]);if(!this.success||256!==c.pointersSize())return!1;for(var h=l.pointersSize()-2,u=e;u<=n;){var f=s.bytes[u-1],p=r.pointers[f];if(!p.isNil)return this.ensureSmallInt(o),!!this.success&&(a.pointers[0]=o,a.pointers[1]=u,this.popNandPushIfOK(7,p));f=this.checkSmallInt(c.pointers[f]);if(!this.success||f<0||h<f)return!1;var d=this.checkSmallInt(l.pointers[f]),f=this.checkSmallInt(l.pointers[f+1]);if(!this.success)return!1;f=o+f-d;if(i<f)return this.ensureSmallInt(o),!!this.success&&(a.pointers[0]=o,a.pointers[1]=u,p=r.pointers[257],this.popNandPushIfOK(7,p));o=f+t,u+=1}return this.ensureSmallInt(o),!!this.success&&(a.pointers[0]=o,a.pointers[1]=n,p=r.pointers[256],this.popNandPushIfOK(7,p))},primitiveScreenSize:function(e){var t=this.display,r=t.width||t.context.canvas.width,t=t.height||t.context.canvas.height;return this.popNandPushIfOK(e+1,this.makePointWithXandY(r,t))},primitiveScreenScaleFactor:function(e){var t=(this.display.highdpi?window.devicePixelRatio:1)||1;return this.popNandPushIfOK(e+1,t)},primitiveSetFullScreen:function(e){var t,r=this.stackBoolean(0);return!!this.success&&(this.display.fullscreen!=r&&(this.display.fullscreenRequest?(t=this.vm.freeze(),this.display.fullscreenRequest(r,function(){t()})):(this.display.fullscreen=r,this.vm.breakOut())),this.vm.popN(e),!0)},primitiveTestDisplayDepth:function(e){return this.popNandPushBoolIfOK(e+1,0<=[1,2,4,8,16,32].indexOf(this.stackInteger(0)))},loadForm:function(e,t){if(e.isNil)return null;var r={obj:e,bits:e.pointers[Squeak.Form_bits].wordsOrBytes(),depth:e.pointers[Squeak.Form_depth],width:e.pointers[Squeak.Form_width],height:e.pointers[Squeak.Form_height]};if(t&&(t=e.pointers[Squeak.Form_offset],r.offsetX=t.pointers?t.pointers[Squeak.Point_x]:0,r.offsetY=t.pointers?t.pointers[Squeak.Point_y]:0),0!==r.width&&0!==r.height){if(!(0<r.width&&0<r.height))return null;if(r.msb=0<r.depth,r.msb||(r.depth=-r.depth),!(0<r.depth))return null;if(r.pixPerWord=32/r.depth,r.pitch=(r.width+(r.pixPerWord-1))/r.pixPerWord|0,r.bits.length!==r.pitch*r.height){if(!(r.bits.length>r.pitch*r.height))return null;this.vm.warnOnce("loadForm(): "+r.bits.length+" !== "+r.pitch+"*"+r.height+"="+r.pitch*r.height)}}return r},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(e,t){this.deferDisplayUpdates||e!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),t)},displayUpdate:function(e,t){this.showForm(this.display.context,e,t),this.display.lastTick=this.vm.lastTick,this.display.idle=0},primitiveBeep:function(e){var t,r=Squeak.startAudioOut();return r?((t=r.createOscillator()).connect(r.destination),t.type="square",t.frequency.value=880,t.start(),t.stop(r.currentTime+.05)):this.vm.warnOnce("could not initialize audio"),this.popNIfOK(e)},hostWindow_primitiveHostWindowTitle:function(e){var t;return this.display.setTitle&&(t=this.stackNonInteger(0).bytes,t=(new TextDecoder).decode(t),this.display.setTitle(t)),this.popNIfOK(e)}}),Object.extend(Squeak,"files",{fsck:function(t,r,i,s,n){if(r=r||"",s=s||{dirs:[],files:[]},n=n||{dirs:0,files:0,bytes:0,deleted:0},!i&&(i={},Object.keys(Squeak.Settings).forEach(function(e){e=e.match(/squeak-file(\.lz)?:(.*)$/);e&&(i[e[2]]=!0)}),window.SqueakDBFake&&Object.keys(SqueakDBFake.bigFiles).forEach(function(e){i[e]=!0}),"undefined"!=typeof indexedDB))return this.dbTransaction("readonly","fsck cursor",function(e){e=e.openCursor();e.onsuccess=function(e){e=e.target.result;e?(i[e.key]=e.value.byteLength,e.continue()):Squeak.fsck(t,r,i,s,n)},e.onerror=function(e){console.error("fsck failed")}});var e,a=Squeak.dirList(r);for(e in a){var o=r+"/"+e;a[e][3]?(n.dirs++,"squeak:"+o in Squeak.Settings?Squeak.fsck(null,o,i,s,n):s.dirs.push(o)):(n.files++,o in i?(i[o]=null,n.bytes+=a[e][4]):s.files.push(o))}if(""===r){console.log("squeak fsck: "+n.dirs+" directories, "+n.files+" files, "+(n.bytes/1e6).toFixed(1)+" MBytes");var u=[];for(o in i)null!==(c=i[o])&&u.push({path:o,size:c});for(var l=0;l<u.length;l++){var o=Squeak.splitFilePath(u[l].path),c=u[l].size,h=(console.log("squeak fsck: restoring "+o.fullname+" ("+c+" bytes)"),Squeak.dirCreate(o.dirname,!0,"force"),Squeak.dirList(o.dirname)),f=Squeak.totalSeconds(),f=[o.basename,f,0,!1,c];h[o.basename]=f,Squeak.Settings["squeak:"+o.dirname]=JSON.stringify(h)}for(l=0;l<s.dirs.length;l++){r=s.dirs[l];Squeak.Settings["squeak:"+r]||(console.log("squeak fsck: cleaning up directory "+r),Squeak.dirDelete(r),n.dirs--,n.deleted++)}for(l=0;l<s.files.length;l++)(o=s.files[l])in i||Squeak.Settings["squeak:"+o]||(console.log("squeak fsck: cleaning up file entry "+o),Squeak.fileDelete(o),n.files--,n.deleted++);t&&t(n)}},dbTransaction:function(r,i,s,n){function t(){s(Squeak.dbFake()),n&&n()}if("undefined"==typeof indexedDB)return t();function a(){var e=SqueakDB.transaction("files",r),t=e.objectStore("files");e.oncomplete=function(e){n&&n()},e.onerror=function(e){console.error("Transaction error during "+i,e)},e.onabort=function(e){console.error("Transaction error: aborting "+i,e),s(Squeak.dbFake()),n&&n()},s(t)}if(window.SqueakDB)return a();var e;try{e=indexedDB.open("squeak")}catch(e){}if(!e)return t();e.onsuccess=function(e){Squeak.debugFiles&&console.log("Opened files database."),window.SqueakDB=this.result,SqueakDB.onversionchange=function(e){delete window.SqueakDB,this.close()},SqueakDB.onerror=function(e){console.error("Error accessing database",e)},a()},e.onupgradeneeded=function(e){Squeak.debugFiles&&console.log("Creating files database"),e.target.result.createObjectStore("files")},e.onerror=function(e){console.error("Error opening files database",e),console.warn("Falling back to local storage"),t()},e.onblocked=function(e){console.log("Database upgrade needed, but was blocked."),console.warn("Falling back to local storage"),t()}},dbFake:function(){return"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1e5,get:function(e){var t=SqueakDBFake.bigFiles[e];if(!t){var r,i=Squeak.Settings["squeak-file:"+e];if(i||(r=Squeak.Settings["squeak-file.lz:"+e])&&("object"==typeof LZString?i=LZString.decompressFromUTF16(r):console.error("LZString not loaded: cannot decompress "+e)),i){for(var s=new Uint8Array(i.length),n=0;n<s.length;n++)s[n]=255&i.charCodeAt(n);t=s.buffer}}var a={result:t};return setTimeout(function(){a.onsuccess&&a.onsuccess({target:a})},0),a},put:function(e,t){e.byteLength>SqueakDBFake.bigFileThreshold?(SqueakDBFake.bigFiles[t]||console.log("File "+t+" ("+e.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[t]=e):(e=Squeak.bytesAsString(new Uint8Array(e)),"object"==typeof LZString?(r=LZString.compressToUTF16(e),Squeak.Settings["squeak-file.lz:"+t]=r,delete Squeak.Settings["squeak-file:"+t]):Squeak.Settings["squeak-file:"+t]=e);var r,i={};return setTimeout(function(){i.onsuccess&&i.onsuccess()},0),i},delete:function(e){delete Squeak.Settings["squeak-file:"+e],delete Squeak.Settings["squeak-file.lz:"+e],delete SqueakDBFake.bigFiles[e];var t={};return setTimeout(function(){t.onsuccess&&t.onsuccess()},0),t},openCursor:function(){var e={};return setTimeout(function(){e.onsuccess&&e.onsuccess({target:e})},0),e}}),SqueakDBFake},fileGet:function(e,t,r){r=r||function(e){console.log(e)};var i,s=this.splitFilePath(e);return s.basename?(Squeak.debugFiles&&(console.log("Reading "+s.fullname),i=t,t=function(e){console.log("Read "+e.byteLength+" bytes from "+s.fullname),i(e)}),window.SqueakDBFake&&SqueakDBFake.bigFiles[s.fullname]?t(SqueakDBFake.bigFiles[s.fullname]):void this.dbTransaction("readonly","get "+e,function(e){e=e.get(s.fullname);e.onerror=function(e){r(e)},e.onsuccess=function(e){if(void 0!==this.result)return t(this.result);Squeak.fetchTemplateFile(s.fullname,function(e){t(e)},function(){if("undefined"==typeof indexedDB)return r("file not found: "+s.fullname);var e=Squeak.dbFake().get(s.fullname);e.onerror=function(e){r("file not found: "+s.fullname)},e.onsuccess=function(e){t(this.result)}})}})):r("Invalid path: "+e)},filePut:function(e,t,r){var i=this.splitFilePath(e);if(!i.basename)return null;var s=this.dirList(i.dirname);if(!s)return null;var n=s[i.basename],a=this.totalSeconds();if(n){if(n[3])return null}else n=[i.basename,a,0,!1,0],s[i.basename]=n;return Squeak.debugFiles&&(console.log("Writing "+i.fullname+" ("+t.byteLength+" bytes)"),0<t.byteLength)&&e.endsWith(".log")&&console.log((new TextDecoder).decode(t).replace(/\r/g,"\n")),n[2]=a,n[4]=t.byteLength||t.length||0,Squeak.Settings["squeak:"+i.dirname]=JSON.stringify(s),this.dbTransaction("readwrite","put "+e,function(e){e.put(t,i.fullname)},function(){r&&r()}),n},fileDelete:function(e,t){var r,i,s=this.splitFilePath(e);return!!s.basename&&!!(r=this.dirList(s.dirname))&&!(!(i=r[s.basename])||i[3]||(delete r[s.basename],Squeak.Settings["squeak:"+s.dirname]=JSON.stringify(r),Squeak.debugFiles&&console.log("Deleting "+s.fullname),t||this.dbTransaction("readwrite","delete "+e,function(e){e.delete(s.fullname)}),0))},fileRename:function(e,t){var r,i,s,n=this.splitFilePath(e);return!(!n.basename||!(r=this.splitFilePath(t)).basename||!(e=this.dirList(n.dirname))||!(t=e[n.basename])||t[3]||!(s=(i=n.dirname==r.dirname)?e:this.dirList(r.dirname))||s[r.basename]||(Squeak.debugFiles&&console.log("Renaming "+n.fullname+" to "+r.fullname),delete e[n.basename],t[0]=r.basename,s[r.basename]=t,Squeak.Settings["squeak:"+r.dirname]=JSON.stringify(s),i||(Squeak.Settings["squeak:"+n.dirname]=JSON.stringify(e)),this.fileGet(n.fullname,function(t){this.dbTransaction("readwrite","rename "+n.fullname+" to "+r.fullname,function(e){e.delete(n.fullname),e.put(t,r.fullname)})}.bind(this),function(e){console.log("File rename failed: "+e)}.bind(this)),0))},fileExists:function(e){var t,e=this.splitFilePath(e);return!!e.basename&&!!(t=this.dirList(e.dirname))&&!(!(t=t[e.basename])||t[3])},dirCreate:function(e,t,r){e=this.splitFilePath(e);if(!e.basename)return!1;t&&!Squeak.Settings["squeak:"+e.dirname]&&Squeak.dirCreate(e.dirname,!0);t=this.dirList(e.dirname);if(!t)return!1;var i=t[e.basename];if(i){if(!i[3]){if(!r)return!1;i[3]=!0,Squeak.Settings["squeak:"+e.dirname]=JSON.stringify(t)}if(Squeak.Settings["squeak:"+e.fullname])return!0}Squeak.debugFiles&&console.log("Creating directory "+e.fullname);r=this.totalSeconds(),i=[e.basename,r,r,!0,0];return t[e.basename]=i,Squeak.Settings["squeak:"+e.fullname]=JSON.stringify({}),Squeak.Settings["squeak:"+e.dirname]=JSON.stringify(t),!0},dirDelete:function(e){e=this.splitFilePath(e);if(!e.basename)return!1;var t=this.dirList(e.dirname);if(!t)return!1;if(!t[e.basename])return!1;var r=this.dirList(e.fullname);if(r)for(var i in r)return!1;return Squeak.debugFiles&&console.log("Deleting directory "+e.fullname),delete t[e.basename],Squeak.Settings["squeak:"+e.dirname]=JSON.stringify(t),delete Squeak.Settings["squeak:"+e.fullname],!0},dirList:function(e,t){var r,e=this.splitFilePath(e),i=Squeak.Settings["squeak:"+e.fullname],t=t&&Squeak.Settings["squeak-template:"+e.fullname];function s(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[(r=t[r])[0]]=r)}return i||t?(r={},t&&s(r,JSON.parse(t).entries),i&&s(r,JSON.parse(i)),r):"/"==e.fullname?{}:null},splitFilePath:function(e){var t=(e=(e="/"!==e[0]?"/"+e:e).replace(/\/\//g,"/")).match(/(.*)\/(.*)/);return{fullname:e,dirname:t[1]||"/",basename:t[2]||null}},splitUrl:function(e,t){var r=e.match(/(.*\/)?(.*)/),i=r[1]||"",r=r[2]||"";return i.match(/^[a-z]+:\/\//)||(t&&!t.match(/\/$/)&&(t+="/"),e=(i=(t||"")+i)+r),{full:e,uptoslash:i,filename:r}},flushFile:function(e){var t;e.modified&&((t=e.contents.buffer).byteLength!==e.size&&(t=new ArrayBuffer(e.size),new Uint8Array(t).set(e.contents.subarray(0,e.size))),Squeak.filePut(e.name,t),e.modified=!1)},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var e in SqueakFiles)this.flushFile(SqueakFiles[e])},closeAllFiles:function(){Squeak.flushAllFiles(),delete window.SqueakFiles},fetchTemplateDir:function(n,a){function o(e,t){var r,i=JSON.parse(Squeak.Settings["squeak-template:"+e]);for(r in i.entries){var s=i.entries[r];s[3]&&Squeak.fetchTemplateDir(e+"/"+s[0],t+"/"+s[0])}}var t,u;n=Squeak.splitFilePath(n).fullname,Squeak.Settings["squeak-template:"+n]?o(n,a):(t=a+"/sqindex.json",(u=new XMLHttpRequest).open("GET",t,!0),u.onload=function(e){if(200==u.status){console.log("adding template dir "+n),!function e(t){var r,i=Squeak.splitFilePath(t);"/"!==i.dirname&&e(i.dirname),(t=JSON.parse(Squeak.Settings["squeak-template:"+i.dirname]||'{"entries": {}}')).entries[i.basename]||(r=Squeak.totalSeconds(),t.entries[i.basename]=[i.basename,r,r,!0,0],Squeak.Settings["squeak-template:"+i.dirname]=JSON.stringify(t))}(n);var t,r=JSON.parse(u.response),i={url:a,entries:{}};for(t in r){var s=r[t];i.entries[s[0]]=s}Squeak.Settings["squeak-template:"+n]=JSON.stringify(i),o(n,a)}else u.onerror(u.statusText)},u.onerror=function(e){console.log("cannot load template index "+t)},u.send())},fetchTemplateFile:function(t,r,i){t=Squeak.splitFilePath(t);var e=Squeak.Settings["squeak-template:"+t.dirname];if(!e)return i();var s=JSON.parse(e).url;if(!s)return i();s+="/"+t.basename;e=new XMLHttpRequest;e.open("get",s,!0),e.responseType="arraybuffer",e.timeout=3e4,e.onreadystatechange=function(){var e;this.readyState==this.DONE&&(200==this.status?(e=this.response,console.log("Got "+e.byteLength+" bytes from "+s),Squeak.dirCreate(t.dirname,!0),Squeak.filePut(t.fullname,e),r(e)):(console.error("Download failed ("+this.status+") "+s),i()))},console.log("Fetching "+s),e.send()}}),Object.extend(Squeak,"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4,EventTypeWindow:5,EventTypeComplex:6,EventTypeMouseWheel:7,WindowEventMetricChange:1,WindowEventClose:2,WindowEventIconise:3,WindowEventActivated:4,WindowEventPaint:5,WindowEventScreenChange:6,EventTouchDown:1,EventTouchUp:2,EventTouchMoved:3,EventTouchStationary:4,EventTouchCancelled:5}),Object.extend(Squeak.Primitives.prototype,"input",{primitiveClipboardText:function(e){if(0===e){var t=null;if(t=this.display.readFromSystemClipboard?this.display.readFromSystemClipboard():t){var r=this.vm.freeze();t.then(()=>this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))).catch(()=>this.vm.popNandPush(1,this.vm.nilObj)).finally(r)}else{if("string"!=typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}}else 1===e&&((t=this.vm.top()).bytes&&(this.display.clipboardString=t.bytesAsString(),this.display.clipboardStringChanged=!0,this.display.writeToSystemClipboard)&&this.display.writeToSystemClipboard(),this.vm.pop());return!0},primitiveKeyboardNext:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(e){var t=this.display.keys.length;return this.popNandPushIfOK(e+1,t?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(e){return this.popNandPushIfOK(e+1,this.ensureSmallInt(this.display.buttons)),this.vm.breakOut(),20<this.display.idle++&&this.vm.goIdle(),!0},primitiveMousePoint:function(e){var t=this.ensureSmallInt(this.display.mouseX),r=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(e+1,this.makePointWithXandY(t,r))},primitiveInputSemaphore:function(e){var t=this.stackInteger(0);return!!this.success&&(this.inputEventSemaIndex=t,this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this),this.popNIfOK(e))},primitiveInputWord:function(e){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(e){this.display.idle++;var t=this.stackNonInteger(0);return!!this.display.getNextEvent&&(this.display.getNextEvent(t.pointers,this.vm.startupTime),this.popNIfOK(e))}}),Object.extend(Squeak.Primitives.prototype,"initialization",{initPlugins:function(){Object.extend(this.builtinModules,{JavaScriptPlugin:this.findPluginFunctions("js_"),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SqueakFFIPrims:this.findPluginFunctions("ffi_","",!0),HostWindowPlugin:this.findPluginFunctions("hostWindow_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0),primitiveGetUntrustedUserDirectory:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveGetUntrustedUserDirectory","/SqueakJS")},LocalePlugin:{primitiveTimezoneOffset:this.fakePrimitive.bind(this,"LocalePlugin.primitiveTimezoneOffset",0)}}),Object.extend(this.patchModules,{ScratchPlugin:this.findPluginFunctions("scratch_")})},findPluginFunctions:function(e,t,r){t=t||"(initialise|shutdown|prim)";var i,s,n={},a=new RegExp("^"+e+t,"i");for(i in this)a.test(i)&&"function"==typeof this[i]&&(s=i,n[s=e?i[e.length].toLowerCase()+i.slice(e.length+1):s]=r?i:this[i].bind(this));return n}}),Object.extend(Squeak,"known classes",{ExtLibFunc_handle:0,ExtLibFunc_flags:1,ExtLibFunc_argTypes:2,ExtLibFunc_name:3,ExtLibFunc_module:4,ExtLibFunc_errorCodeName:5},"FFI error codes",{FFINoCalloutAvailable:-1,FFIErrorGenericError:0,FFIErrorNotFunction:1,FFIErrorBadArgs:2,FFIErrorBadArg:3,FFIErrorIntAsPointer:4,FFIErrorBadAtomicType:5,FFIErrorCoercionFailed:6,FFIErrorWrongType:7,FFIErrorStructSize:8,FFIErrorCallType:9,FFIErrorBadReturn:10,FFIErrorBadAddress:11,FFIErrorNoModule:12,FFIErrorAddressNotFound:13,FFIErrorAttemptToPassVoid:14,FFIErrorModuleNotFound:15,FFIErrorBadExternalLibrary:16,FFIErrorBadExternalFunction:17,FFIErrorInvalidPointer:18,FFIErrorCallFrameTooBig:19},"FFI types",{FFITypeVoid:0,FFITypeBool:1,FFITypeUnsignedInt8:2,FFITypeSignedInt8:3,FFITypeUnsignedInt16:4,FFITypeSignedInt16:5,FFITypeUnsignedInt32:6,FFITypeSignedInt32:7,FFITypeUnsignedInt64:8,FFITypeSignedInt64:9,FFITypeUnsignedChar8:10,FFITypeSignedChar8:11,FFITypeSingleFloat:12,FFITypeDoubleFloat:13,FFITypeUnsignedChar16:14,FFITypeUnsignedChar32:15,FFIFlagAtomic:262144,FFIFlagPointer:131072,FFIFlagStructure:65536,FFIFlagAtomicPointer:393216,FFIFlagMask:458752,FFIStructSizeMask:65535,FFIAtomicTypeMask:251658240,FFIAtomicTypeShift:24}),Object.extend(Squeak.Primitives.prototype,"FFI",{ffi_lastError:0,ffiModules:{},ffiFuncs:[],ffiLookupFunc:function(t,r){var e=this.ffiFuncs.findIndex(e=>e.funcName===r)+1;if(!e){if(!t[r])return 0;var i=Object.keys(this.loadedModules).find(e=>this.loadedModules[e]===t);if(void 0===i)throw Error("FFI: module not loaded?! "+t.getModuleName());var s=Object.keys(this.ffiModules).find(e=>this.ffiModules[e]===i);if(void 0===s)throw Error("FFI: library not found?! "+t.getModuleName());this.ffiFuncs.push({libName:s,modName:i,funcName:r}),e=this.ffiFuncs.length}return e},ffiDoCallout:function(e,t,r){this.ffi_lastError=Squeak.FFIErrorGenericError;var i=t.pointers[Squeak.ExtLibFunc_module].bytesAsString(),s=t.pointers[Squeak.ExtLibFunc_name].bytesAsString(),n=t.pointers[Squeak.ExtLibFunc_handle].wordsOrBytes()[0],a=this.ffiModules[i];if(n){var o=this.ffiFuncs[n-1];if(!o)throw Error("FFI: not a valid External Address: "+n);i=o.libName,a=o.modName,s=o.funcName}if(i=i||"libc",void 0===a){if(!Squeak.externalModules[i]){var u=["","lib"],l=["",".so",".so.9",".9",".so.8",".8",".so.7",".7",".so.6",".6",".so.5",".5",".so.4",".4",".so.3",".3",".so.2",".2",".so.1",".1"];e:for(var c=0;c<u.length;c++)for(var h=u[c],f=0;f<l.length;f++){var p=l[f];if(Squeak.externalModules[h+i+p]){a=h+i+p;break e}if(h&&i.startsWith(h)&&Squeak.externalModules[i.slice(h.length)+p]){a=i.slice(h.length)+p;break e}if(p&&i.endsWith(p)&&Squeak.externalModules[h+i.slice(0,-p.length)]){a=h+i.slice(0,-p.length);break e}}a&&console.log("FFI: found library "+i+" as module "+a)}this.ffiModules[i]=a=a||i}n=this.loadedModules[a];if(void 0!==n||(n=this.loadModule(a),this.loadedModules[a]=n)||this.vm.warnOnce("FFI: library not found: "+i),!n)return this.ffi_lastError=Squeak.FFIErrorModuleNotFound,!1;for(var d,m=t.pointers[Squeak.ExtLibFunc_argTypes].pointers,v=[],g=0;g<r.length;g++)v.push(this.ffiArgFromSt(r[g],m[g+1]));if(s in n)d=n[s].apply(n,v);else if(this.vm.warnOnce("FFI: function not found: "+i+"::"+s)&&console.warn(v),void 0===(d=n.ffiFunctionNotFoundHandler?n.ffiFunctionNotFoundHandler(s,v):d))return this.ffi_lastError=Squeak.FFIErrorAddressNotFound,!1;o=this.ffiResultToSt(d,m[0]);return this.popNandPushIfOK(e+1,o)},ffiArgFromSt:function(e,t){var r,i,s=t.pointers[0].words[0];switch(s&Squeak.FFIFlagMask){case Squeak.FFIFlagAtomic:switch(r=(s&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeVoid:return null;case Squeak.FFITypeBool:if(e.isTrue)return!0;if(e.isFalse)return!1;if("number"==typeof e)return!!e;if(e.isFloat)return!!e.float;throw Error("FFI: expected bool, got "+e);case Squeak.FFITypeUnsignedInt8:case Squeak.FFITypeSignedInt8:case Squeak.FFITypeUnsignedInt16:case Squeak.FFITypeSignedInt16:case Squeak.FFITypeUnsignedInt32:case Squeak.FFITypeSignedInt32:case Squeak.FFITypeUnsignedInt64:case Squeak.FFITypeSignedInt64:case Squeak.FFITypeUnsignedChar8:case Squeak.FFITypeSignedChar8:case Squeak.FFITypeUnsignedChar16:case Squeak.FFITypeUnsignedChar32:if("number"==typeof e)return e;if(e.isTrue)return 1;if(e.isFalse)return 0;throw Error("FFI: expected integer, got "+e);case Squeak.FFITypeSingleFloat:case Squeak.FFITypeDoubleFloat:if("number"==typeof e)return e;if(e.isFloat)return e.float;throw Error("FFI: expected float, got "+e);default:throw Error("FFI: unimplemented atomic arg type: "+r)}case Squeak.FFIFlagAtomicPointer:switch(r=(s&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeUnsignedChar8:case Squeak.FFITypeUnsignedInt8:if(e.bytes)return e.bytes;if(e.words)return e.wordsAsUint8Array();if(this.interpreterProxy.isWordsOrBytes(e))return new Uint8Array(0);if(e.pointers&&e.pointers[0].jsData){if((i=e.pointers[0].jsData)instanceof Uint8Array)return i;if(i instanceof ArrayBuffer)return new Uint8Array(i)}throw Error("FFI: expected bytes, got "+e);case Squeak.FFITypeUnsignedInt32:if(e.words)return e.words;if(this.interpreterProxy.isWords(e))return new Uint32Array(0);if(e.pointers&&e.pointers[0].jsData){if((i=e.pointers[0].jsData)instanceof Uint32Array)return i;if(i instanceof ArrayBuffer)return new Uint32Array(i)}throw Error("FFI: expected words, got "+e);case Squeak.FFITypeSignedInt32:if(e.words)return e.wordsAsInt32Array();if(this.interpreterProxy.isWords(e))return new Int32Array(0);if(e.pointers&&e.pointers[0].jsData){if((i=e.pointers[0].jsData)instanceof Int32Array)return i;if(i instanceof ArrayBuffer)return new Int32Array(i)}throw Error("FFI: expected words, got "+e);case Squeak.FFITypeSingleFloat:if(e.words)return e.wordsAsFloat32Array();if(e.isFloat)return new Float32Array([e.float]);if(this.interpreterProxy.isWords(e))return new Float32Array(0);if(e.pointers&&e.pointers[0].jsData){if((i=e.pointers[0].jsData)instanceof Float32Array)return i;if(i instanceof ArrayBuffer)return new Float32Array(i)}throw Error("FFI: expected floats, got "+e);case Squeak.FFITypeDoubleFloat:if(e.words)return e.wordsAsFloat64Array();if(e.isFloat)return new Float64Array([e.float]);if(this.interpreterProxy.isWords(e))return new Float64Array(0);if(e.pointers&&e.pointers[0].jsData){if((i=e.pointers[0].jsData)instanceof Float64Array)return i;if(i instanceof ArrayBuffer)return new Float64Array(i)}throw Error("FFI: expected floats, got "+e);case Squeak.FFITypeVoid:if(e.words)return e.words.buffer;if(e.bytes)return e.bytes.buffer;if(e.isNil||this.interpreterProxy.isWordsOrBytes(e))return new ArrayBuffer(0);if(e.pointers&&e.pointers[0].jsData)if((i=e.pointers[0].jsData)instanceof ArrayBuffer)return i;throw Error("FFI: expected words or bytes, got "+e);default:throw Error("FFI: unimplemented atomic array arg type: "+r)}default:throw Error("FFI: unimplemented arg type flags: "+s)}},ffiResultToSt:function(e,t){var r,i=t.pointers[0].words[0];switch(i&Squeak.FFIFlagMask){case Squeak.FFIFlagAtomic:switch(r=(i&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeVoid:return this.vm.nilObj;case Squeak.FFITypeBool:return e?this.vm.trueObj:this.vm.falseObj;case Squeak.FFITypeUnsignedInt8:case Squeak.FFITypeSignedInt8:case Squeak.FFITypeUnsignedInt16:case Squeak.FFITypeSignedInt16:case Squeak.FFITypeUnsignedInt32:case Squeak.FFITypeSignedInt32:case Squeak.FFITypeUnsignedInt64:case Squeak.FFITypeSignedInt64:case Squeak.FFITypeUnsignedChar8:case Squeak.FFITypeSignedChar8:case Squeak.FFITypeUnsignedChar16:case Squeak.FFITypeUnsignedChar32:case Squeak.FFITypeSingleFloat:case Squeak.FFITypeDoubleFloat:if("number"!=typeof e)throw Error("FFI: expected number, got "+e);return this.makeStObject(e);default:throw Error("FFI: unimplemented atomic return type: "+r)}case Squeak.FFIFlagAtomicPointer:if(!e)return this.vm.nilObj;switch(r=(i&Squeak.FFIAtomicTypeMask)>>Squeak.FFIAtomicTypeShift){case Squeak.FFITypeSignedChar8:case Squeak.FFITypeUnsignedChar8:return"string"==typeof e?this.makeStString(e):this.makeStStringFromBytes(e,!0);default:return this.ffiMakeStExternalData(e,t)}default:throw Error("FFI: unimplemented return type flags: "+i)}},ffiNextExtAddr:0,ffiMakeStExternalAddress:function(){var e=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassExternalAddress],4);return new Uint32Array(e.bytes.buffer)[0]=++this.ffiNextExtAddr,e},ffiMakeStExternalData:function(e,t){var r=this.ffiMakeStExternalAddress(),e=(r.jsData=e,this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassExternalData],0));return e.pointers[0]=r,e.pointers[1]=t,e},ffiDataFromStack:function(e){e=this.stackNonInteger(e);return void 0!==e.jsData?e.jsData:e.bytes||e.words||(this.vm.warnOnce("FFI: expected ExternalAddress with jsData, got "+e),void(this.success=!1))},ffi_primitiveFFIAllocate:function(e){var t,r=this.stackInteger(0);return!!this.success&&((t=this.ffiMakeStExternalAddress()).jsData=new ArrayBuffer(r),this.popNandPushIfOK(e+1,t))},ffi_primitiveFFIFree:function(e){var t=this.stackNonInteger(0);return!!this.success&&(void 0===t.jsData?(this.vm.warnOnce("primitiveFFIFree: expected ExternalAddress with jsData, got "+t),!1):(delete t.jsData,!0))},primitiveCalloutToFFI:function(e,t){t=t.pointers[1];if(!this.isKindOf(t,Squeak.splOb_ClassExternalFunction))return!1;for(var r=[],i=e-1;0<=i;i--)r.push(this.vm.stackValue(i));return this.ffiDoCallout(e,t,r)},ffi_primitiveCalloutWithArgs:function(e){var t=this.stackNonInteger(1),r=this.stackNonInteger(0);return!!this.isKindOf(t,Squeak.splOb_ClassExternalFunction)&&this.ffiDoCallout(e,t,r.pointers)},ffi_primitiveFFIGetLastError:function(e){return this.popNandPushIfOK(e+1,this.ffi_lastError)},ffi_primitiveFFIIntegerAt:function(e){var t,r=this.ffiDataFromStack(3),i=this.stackInteger(2),s=this.stackInteger(1),n=this.stackBoolean(0);if(!this.success)return!1;if(--i<0||s<1||8<s||0!=(s&s-1))return!1;if(1!==s||n){if(4!==s||n)return this.vm.warnOnce("FFI: unimplemented integer type size: "+s+" signed: "+n),!1;if(r instanceof Uint32Array)t=r[i]||0;else{if(!(r instanceof Uint8Array))return this.vm.warnOnce("FFI: expected Uint32Array, got "+typeof r),!1;t=new DataView(r.buffer).getUint32(r.byteOffset+i,!0)||0}}else if("string"==typeof r)t=r.charCodeAt(i)||0;else{if(!(r instanceof Uint8Array))return this.vm.warnOnce("FFI: expected string or Uint8Array, got "+typeof r),!1;t=r[i]||0}return this.popNandPushIfOK(e+1,t)},ffi_primitiveFFIIntegerAtPut:function(e){var t=this.ffiDataFromStack(4),r=this.stackInteger(3),i=this.stackSigned53BitInt(2),s=this.stackInteger(1),n=this.stackBoolean(0);if(!this.success)return!1;if(--r<0||s<1||8<s||0!=(s&s-1))return!1;if(4!==s)return this.vm.warnOnce("FFI: unimplemented integer type size: "+s+" signed: "+n),!1;if(n&&(i<-2147483648||2147483647<i)||!n&&(i<0||4294967295<i))return!1;if(t instanceof Uint32Array)t[r]=i>>>0;else{if(!(t instanceof Uint8Array))return this.vm.warnOnce("FFI: expected Uint32Array, got "+typeof t),!1;new DataView(t.buffer).setUint32(t.byteOffset+r,i>>>0,!0)}return this.popNandPushIfOK(e+1,i)},ffi_primitiveFFIDoubleAtPut:function(e){var t=this.ffiDataFromStack(2),r=this.stackInteger(1),i=this.vm.stackValue(0),s=i.isFloat?i.float:i;return!(!this.success||"number"!=typeof s)&&(7&--r?new DataView(t).setFloat64(r,s,!0):new Float64Array(t)[r/8]=s,this.popNandPushIfOK(e+1,i))}}),Object.extend(Squeak.Primitives.prototype,"JavaScriptPlugin",{js_primitiveDoUnderstand:function(e){var t=this.stackNonInteger(1),r=this.js_objectOrGlobal(t),i=this.stackNonInteger(0).pointers,s=i[0].bytesAsString(),i=i[1].pointers||[],n=!("jsObject"in t),a=null;try{var o,u=s.match(/([^:]*)/)[0];if(n||"new"!==u){if(!(u in r))return this.js_setError("Property not found: "+u);var l=r[u];if("function"==typeof l&&(!n||0<i.length))a=l.apply(r,this.js_fromStArray(i));else if(0==i.length)a=l;else{if(1!=i.length)return this.js_setError("Property "+u+" is not a function");r[u]=this.js_fromStObject(i[0])}}else a=new(0===i.length?r:(o=[null].concat(this.js_fromStArray(i)),Function.prototype.bind.apply(r,o)))}catch(e){return this.js_setError(e)}s=this.makeStObject(a,t.sqClass);return this.popNandPushIfOK(e+1,s)},js_primitiveAsString:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(String(t)))},js_primitiveTypeof:function(e){var t=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(e+1,this.makeStString(typeof t))},js_primitiveAt:function(e){var t=this.stackNonInteger(1),r=this.vm.stackValue(0);try{var i=this.js_objectOrGlobal(t)[this.js_fromStObject(r)],s=this.makeStObject(i,t.sqClass)}catch(e){return this.js_setError(e)}return this.popNandPushIfOK(e+1,s)},js_primitiveAtPut:function(e){var t=this.stackNonInteger(2),r=this.vm.stackValue(1),i=this.vm.stackValue(0);try{var s=this.js_objectOrGlobal(t),n=this.js_fromStObject(r),a=this.js_fromStObject(i);s[n]=a}catch(e){return this.js_setError(e)}return this.popNandPushIfOK(e+1,i)},js_primitiveSqueakAsJSObject:function(e){var t=this.stackNonInteger(1),r=this.vm.stackValue(0);return this.success&&(t.jsObject=r),this.popNIfOK(e)},js_primitiveInitCallbacks:function(e){return this.js_callbackSema=this.stackInteger(0),this.js_activeCallback=null,this.popNIfOK(e)},js_primitiveGetActiveCallbackBlock:function(e){var t=this.js_activeCallback;return t?this.popNandPushIfOK(e+1,t.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(e){var t=this.stackNonInteger(e),r=this.js_activeCallback;if(!r)return this.js_setError("No active callback");try{var i=this.makeStArray(r.args,t);return this.popNandPushIfOK(e+1,i)}catch(e){return this.js_setError(e)}},js_primitiveReturnFromCallback:function(e){return 1===e&&(this.js_activeCallback?(this.js_activeCallback.result=this.vm.pop(),this.vm.breakOut(),!0):this.js_setError("No active callback"))},js_primitiveGetError:function(e){var t;return null!=this.js_error&&((t=this.js_error)instanceof Error&&(t=t.message),t=this.makeStString(""+t),this.js_error=null,this.popNandPushIfOK(e+1,t))},js_primitiveGetErrorObject:function(e){var t;return null!=this.js_error&&(t=this.stackNonInteger(e),t=this.makeStObject(this.js_error,t.sqClass),this.js_error=null,this.popNandPushIfOK(e+1,t))},js_setError:function(e){return this.js_error=e,!1},js_fromStObject:function(e){if("number"==typeof e)return e;if(e.jsObject)return e.jsObject;if(e.isFloat)return e.float;if(e.isNil)return null;if(e.isTrue)return!0;if(e.isFalse)return!1;if(e.bytes||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return e.bytesAsString();if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(e.pointers||[],!0);if(e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||e.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(e);throw Error("asJSArgument needed for "+e)},js_fromStArray:function(e,t){if(0<e.length&&t&&e.every(e=>this.isAssociation(e)))return this.js_fromStDict(e);for(var r=[],i=0;i<e.length;i++)r.push(this.js_fromStObject(e[i]));return r},js_fromStDict:function(e){for(var t={},r=0;r<e.length;r++){var i=e[r].pointers;if(!i||2!==i.length)throw Error(i+" is not an Association");var s=this.js_fromStObject(i[0]),i=this.js_fromStObject(i[1]);t[s]=i}return t},js_fromStBlock:function(i){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var t=i.pointers[Squeak.BlockContext_argumentCount],s=("number"!=typeof t&&(t=i.pointers[Squeak.Closure_numArgs]),this);return function(){for(var r=[],e=0;e<t;e++)r.push(arguments[e]);return new Promise(function(e,t){self.setTimeout(function(){s.js_executeCallbackAsync(i,r,e,t)},0)})}},js_executeCallbackAsync:function(e,t,r,i){var s=this;this.js_activeCallback||this.vm.frozen?self.setTimeout(function(){s.js_executeCallbackAsync(e,t,r,i)},0):this.js_executeCallback(e,t,r,i)},js_executeCallback:function(t,e,r,i){if(this.js_activeCallback)return console.error("Callback: already active");this.js_activeCallback={block:t,args:e,result:null},this.signalSemaphoreWithIndex(this.js_callbackSema),this.vm.forceInterruptCheck();for(var s=Date.now()+500;Date.now()<s&&!this.js_activeCallback.result;)this.vm.interpret();t=this.js_activeCallback.result;if(this.js_activeCallback=null,t)try{r(this.js_fromStObject(t))}catch(e){r(t.toString())}else i(Error("SqueakJS timeout"))},js_objectOrGlobal:function(e){return"jsObject"in e?e.jsObject:self}}),Object.extend(Squeak.Primitives.prototype,"Obsolete",{primitiveFloatArrayAt:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",e)},primitiveFloatArrayMulFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",e)},primitiveFloatArrayAddScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",e)},primitiveFloatArrayDivFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",e)},primitiveFloatArrayDivScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",e)},primitiveFloatArrayHash:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",e)},primitiveFloatArrayAtPut:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",e)},primitiveFloatArrayMulScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",e)},primitiveFloatArrayAddFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",e)},primitiveFloatArraySubScalar:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",e)},primitiveFloatArraySubFloatArray:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",e)},primitiveFloatArrayEqual:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",e)},primitiveFloatArrayDotProduct:function(e){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",e)},m23PrimitiveInvertRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",e)},m23PrimitiveTransformPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",e)},m23PrimitiveIsPureTranslation:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",e)},m23PrimitiveComposeMatrix:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",e)},m23PrimitiveTransformRectInto:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",e)},m23PrimitiveIsIdentity:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",e)},m23PrimitiveInvertPoint:function(e){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",e)},primitiveDeflateBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",e)},primitiveDeflateUpdateHashTable:function(e){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",e)},primitiveUpdateGZipCrc32:function(e){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",e)},primitiveInflateDecompressBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",e)},primitiveZipSendBlock:function(e){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",e)},primitiveFFTTransformData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",e)},primitiveFFTScaleData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",e)},primitiveFFTPermuteData:function(e){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",e)},gePrimitiveMergeFillFrom:function(e){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",e)},gePrimitiveCopyBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",e)},gePrimitiveAddRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddRect",e)},gePrimitiveAddGradientFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",e)},gePrimitiveSetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",e)},gePrimitiveSetBitBltPlugin:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",e)},gePrimitiveRegisterExternalEdge:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",e)},gePrimitiveGetClipRect:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",e)},gePrimitiveAddBezier:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",e)},gePrimitiveInitializeProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",e)},gePrimitiveRenderImage:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",e)},gePrimitiveGetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",e)},gePrimitiveSetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",e)},gePrimitiveAddBezierShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",e)},gePrimitiveSetEdgeTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",e)},gePrimitiveGetTimes:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",e)},gePrimitiveNextActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",e)},gePrimitiveAddBitmapFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",e)},gePrimitiveGetDepth:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",e)},gePrimitiveAbortProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",e)},gePrimitiveNextGlobalEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",e)},gePrimitiveGetFailureReason:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",e)},gePrimitiveDisplaySpanBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",e)},gePrimitiveGetCounts:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",e)},gePrimitiveChangedActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",e)},gePrimitiveRenderScanline:function(e){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",e)},gePrimitiveGetBezierStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",e)},gePrimitiveFinishedProcessing:function(e){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",e)},gePrimitiveNeedsFlush:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",e)},gePrimitiveAddLine:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddLine",e)},gePrimitiveSetOffset:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",e)},gePrimitiveNextFillEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",e)},gePrimitiveInitializeBuffer:function(e){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",e)},gePrimitiveDoProfileStats:function(e){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",e)},gePrimitiveAddActiveEdgeEntry:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",e)},gePrimitiveSetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",e)},gePrimitiveNeedsFlushPut:function(e){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",e)},gePrimitiveAddCompressedShape:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",e)},gePrimitiveSetColorTransform:function(e){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",e)},gePrimitiveAddOval:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddOval",e)},gePrimitiveRegisterExternalFill:function(e){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",e)},gePrimitiveAddPolygon:function(e){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",e)},gePrimitiveGetAALevel:function(e){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",e)}}),Object.extend(Squeak.Primitives.prototype,"DropPlugin",{primitiveDropRequestFileHandle:function(e){var t=this.stackInteger(0),r=this.display.droppedFiles||[];return!(t<1||t>r.length||(r=r[t-1],!(t=this.fileOpen(r,!1)))||(r=this.makeFileHandle(r,t,!1),this.popNandPushIfOK(e+1,r),0))},primitiveDropRequestFileName:function(e){var t=this.stackInteger(0),r=this.display.droppedFiles||[];return!(t<1||t>r.length)&&(r=this.makeStString(this.filenameToSqueak(r[t-1])),this.popNandPushIfOK(e+1,r))}}),Object.extend(Squeak.Primitives.prototype,"FilePlugin",{primitiveDirectoryCreate:function(e){var t=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),this.success=Squeak.dirCreate(t),this.success||(t=Squeak.splitFilePath(t),Squeak.debugFiles&&console.warn("Directory not created: "+t.fullname)),this.popNIfOK(e))},primitiveDirectoryDelete:function(e){var t=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),this.success=Squeak.dirDelete(t),this.popNIfOK(e))},primitiveDirectoryDelimitor:function(e){var t=this.emulateMac?":":"/";return this.popNandPushIfOK(1,this.charFromInt(t.charCodeAt(0)))},primitiveDirectoryEntry:function(e){var t,r,i=this.stackNonInteger(1),s=this.stackNonInteger(0);return!!this.success&&(s=s.bytesAsString(),t=this.filenameFromSqueak(s),i=i.bytesAsString(),i=this.filenameFromSqueak(i),(r=Squeak.dirList(i,!0))?(s="."===t?[".",0,0,!0,0]:".."===t?["..",0,0,!0,0]:"/"===t&&"/"===i?[s,0,0,!0,0]:r[t],this.popNandPushIfOK(e+1,this.makeStObject(s)),!0):(r=Squeak.splitFilePath(i),Squeak.debugFiles&&console.log("Directory not found: "+r.fullname),!1))},primitiveDirectoryLookup:function(e){var t=this.stackInteger(0),r=this.stackNonInteger(1);if(!this.success)return!1;var r=r.bytesAsString(),i=this.filenameFromSqueak(r),s=Squeak.dirList(i,!0);if(!s)return n=Squeak.splitFilePath(i),Squeak.debugFiles&&console.log("Directory not found: "+n.fullname),!1;Squeak.debugFiles&&1===t&&console.log("Reading directory "+i+" with "+Object.keys(s).length+" entries");var n=s[Object.keys(s).sort()[t-1]];return"/"===r&&(1===t?((n=n||[0,0,0,0,0])[0]="SqueakJS",n[3]=!0):n=null),this.popNandPushIfOK(e+1,this.makeStObject(n)),!0},primitiveDirectorySetMacTypeAndCreator:function(e){return this.popNIfOK(e)},primitiveFileAtEnd:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file||(this.popNandPushIfOK(e+1,this.makeStObject(t.filePos>=t.file.size)),0))},primitiveFileClose:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file)&&("string"==typeof t.file?this.fileConsoleFlush(t.file):(this.fileClose(t.file),this.vm.breakOut(),t.file=null),this.popNIfOK(e))},primitiveFileDelete:function(e){var t=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),this.success=Squeak.fileDelete(t),this.popNIfOK(e))},primitiveFileFlush:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file)&&("string"==typeof t.file?this.fileConsoleFlush(t.file):(Squeak.flushFile(t.file),this.vm.breakOut()),this.popNIfOK(e))},primitiveFileGetPosition:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file||(this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t.filePos)),0))},makeFileHandle:function(e,t,r){e=this.makeStString("squeakjs:"+e);return e.file=t,e.fileWrite=r,e.filePos=0,e},primitiveFileOpen:function(e){var t=this.stackBoolean(0),r=this.stackNonInteger(1);return!!this.success&&(r=this.filenameFromSqueak(r.bytesAsString()),!!(r=this.fileOpen(r,t)))&&(r=this.makeFileHandle(r.name,r,t),this.popNandPushIfOK(e+1,r),!0)},primitiveFileRead:function(s){var n,a=this.stackInteger(0),o=this.stackInteger(1)-1,u=this.stackNonInteger(2),l=this.stackNonInteger(3);return!!(this.success&&u.isWordsOrBytes()&&l.file)&&(a?((n=u.bytes)||(n=u.wordsAsUint8Array(),o*=4,a*=4),!(o<0||o+a>n.length)&&("string"==typeof l.file?(this.popNandPushIfOK(s+1,0),!0):this.fileContentsDo(l.file,function(e){if(!e.contents)return this.popNandPushIfOK(s+1,0);var t=e.contents,r=n;a=Math.min(a,e.size-l.filePos);for(var i=0;i<a;i++)r[o+i]=t[l.filePos++];u.bytes||(a>>=2),this.popNandPushIfOK(s+1,Math.max(0,a))}.bind(this)))):this.popNandPushIfOK(s+1,0))},primitiveFileRename:function(e){var t=this.stackNonInteger(1),r=this.stackNonInteger(0);return!!this.success&&(t=this.filenameFromSqueak(t.bytesAsString()),r=this.filenameFromSqueak(r.bytesAsString()),this.success=Squeak.fileRename(t,r),this.vm.breakOut(),this.popNIfOK(e))},primitiveFileSetPosition:function(e){var t=this.stackPos32BitInt(0),r=this.stackNonInteger(1);return!(!this.success||!r.file)&&(r.filePos=t,this.popNIfOK(e))},primitiveFileSize:function(e){var t=this.stackNonInteger(0);return!(!this.success||!t.file||(this.popNandPushIfOK(e+1,this.makeLargeIfNeeded(t.file.size)),0))},primitiveFileStdioHandles:function(e){var t=[null,this.makeFileHandle("console.log","log",!0),this.makeFileHandle("console.error","error",!0)];return this.popNandPushIfOK(e+1,this.makeStArray(t)),!0},primitiveFileTruncate:function(e){var t=this.stackPos32BitInt(0),r=this.stackNonInteger(1);return!!(this.success&&r.file&&r.fileWrite)&&(r.file.size>t&&(r.file.size=t,r.file.modified=!0,r.filePos>r.file.size)&&(r.filePos=r.file.size),this.popNIfOK(e))},primitiveDisableFileAccess:function(e){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,e)},primitiveFileWrite:function(n){var a,o=this.stackInteger(0),u=this.stackInteger(1)-1,l=this.stackNonInteger(2),c=this.stackNonInteger(3);return!!(this.success&&c.file&&c.fileWrite)&&(o?((a=l.bytes)||(a=l.wordsAsUint8Array(),u*=4,o*=4),!!a&&!(u<0||u+o>a.length)&&("string"==typeof c.file?(this.fileConsoleWrite(c.file,a,u,o),this.popNandPushIfOK(n+1,o),!0):this.fileContentsDo(c.file,function(e){var t,r=a,i=e.contents||[];c.filePos+o>i.length&&(t=0===i.length?c.filePos+o:Math.max(c.filePos+o,i.length+1e4),e.contents=new Uint8Array(t),e.contents.set(i),i=e.contents);for(var s=0;s<o;s++)i[c.filePos++]=r[u+s];c.filePos>e.size&&(e.size=c.filePos),e.modified=!0,l.bytes||(o>>=2),this.popNandPushIfOK(n+1,o)}.bind(this)))):this.popNandPushIfOK(n+1,0))},fileOpen:function(e,t){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});e=Squeak.splitFilePath(e);if(!e.basename)return null;var r=Squeak.dirList(e.dirname,!0);if(!r)return null;var r=r[e.basename],i=null;if(r){if(s=SqueakFiles[e.fullname])return++s.refCount,s}else{if(!t)return Squeak.debugFiles&&console.log("File not found: "+e.fullname),null;if(i=new Uint8Array,!(r=Squeak.filePut(e.fullname,i.buffer)))return Squeak.debugFiles&&console.log("Cannot create file: "+e.fullname),null}var s={name:e.fullname,size:r[4],contents:i,modified:!1,refCount:1};return SqueakFiles[s.name]=s},fileClose:function(e){Squeak.flushFile(e),0==--e.refCount&&delete SqueakFiles[e.name]},fileContentsDo:function(i,s){if(i.contents)s(i);else{if(!1===i.contents)return!1;this.vm.freeze(function(t){var r=function(e){console.warn("File get failed: "+e),i.contents=!1,t(),s(i)}.bind(this),e=function(e){if(null==e)return r(i.name);i.contents=this.asUint8Array(e),t(),s(i)}.bind(this);Squeak.fileGet(i.name,e,r)}.bind(this))}return!0},fileConsoleBuffer:{log:"",error:""},fileConsoleWrite:function(e,t,r,i){t=t.subarray(r,r+i),r=this.fileConsoleBuffer[e]+Squeak.bytesAsString(t),i=r.match("([^]*)\n(.*)");i&&(console[e](i[1]),r=i[2]),this.fileConsoleBuffer[e]=r},fileConsoleFlush:function(e){var t=this.fileConsoleBuffer[e];t&&(console[e](t),this.fileConsoleBuffer[e]="")}}),Object.extend(Squeak.Primitives.prototype,"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(e){return this.popNandPushIfOK(e+1,this.vm.trueObj)},jpeg2_primImageHeight:function(e){var t=this.stackNonInteger(0).wordsOrBytes();return!!t&&(t=t[1],this.popNandPushIfOK(e+1,t))},jpeg2_primImageWidth:function(e){var t=this.stackNonInteger(0).wordsOrBytes();return!!t&&(t=t[0],this.popNandPushIfOK(e+1,t))},jpeg2_primJPEGCompressStructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGDecompressStructSize:function(e){return this.popNandPushIfOK(e+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(e){return this.popNandPushIfOK(e+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(e){var t,r=this.stackNonInteger(2).wordsOrBytes(),i=this.stackNonInteger(1).bytes;return!(!r||!i)&&(t=this.vm.freeze(),this.jpeg2_readImageFromBytes(i,function(e){this.jpeg2state={src:i,img:e},r[0]=e.width,r[1]=e.height,t()}.bind(this),function(){r[0]=0,r[1]=0,t()}.bind(this)),this.popNIfOK(e))},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(e){var t=this.stackNonInteger(3).bytes,r=this.stackNonInteger(2).pointers,i=this.stackBoolean(1);if(!this.success||!t||!r)return!1;var s=this.jpeg2state;if(!s||s.src!==t)return console.error("jpeg read did not match header info"),!1;t=r[Squeak.Form_depth],s=this.jpeg2_getPixelsFromImage(s.img),r=r[Squeak.Form_bits].words;if(32===t)this.jpeg2_copyPixelsToForm32(s,r);else{if(16!==t)return!1;i?this.jpeg2_ditherPixelsToForm16(s,r):this.jpeg2_copyPixelsToForm16(s,r)}return this.popNIfOK(e)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(e){var t,r,i,s,n,a;return!(e<6||(t=this.stackNonInteger(4).bytes,n=this.stackNonInteger(3).pointers,r=this.stackInteger(2),!(this.success&&t&&n)))&&(i=n[Squeak.Form_width],s=n[Squeak.Form_height],a=n[Squeak.Form_depth],n=n[Squeak.Form_bits].words,32!==a?(this.vm.warnOnce("JPEG2WriteImage: only 32 bit depth supported"),!1):(a=this.jpeg2_writeFormToBytes(n,i,s,r,t),this.popNandPushIfOK(e+1,a)))},jpeg2_writeFormToBytes:function(e,t,r,i,s){for(var n=document.createElement("canvas"),a=n.getContext("2d"),t=(n.width=t,n.height=r,a.createImageData(t,r)),o=t.data,u=0;u<e.length;u++){var l=e[u];o[4*u+0]=l>>16&255,o[4*u+1]=l>>8&255,o[4*u+2]=255&l,o[4*u+3]=255}a.putImageData(t,0,0);r=n.toDataURL("image/jpeg",i/100);return this.jpeg2_dataURLToBytes(r,s)},jpeg2_dataURLToBytes:function(e,t){e=e.split(",")[1];if(!e)return 0;if(3*e.length/4-3>t.length)return 0;var r=atob(e);if(r.length>t.length)return 0;for(var i=0;i<r.length;i++)t[i]=r.charCodeAt(i);return r.length},jpeg2_readImageFromBytes:function(e,t,r){var e=new Blob([e],{type:"image/jpeg"}),i=new Image;i.onload=function(){t(i),URL.revokeObjectURL(i.src)},i.onerror=function(){console.warn("could not render JPEG"),r(),URL.revokeObjectURL(i.src)},i.src=URL.createObjectURL(e)},jpeg2_getPixelsFromImage:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)},jpeg2_copyPixelsToForm32:function(e,t){for(var r=e.data,i=0;i<t.length;i++){var s=r[4*i+0],n=r[4*i+1],a=r[4*i+2];t[i]=4278190080|s<<16|n<<8|a}},jpeg2_copyPixelsToForm16:function(e,t){for(var r=e.width,i=e.height,s=e.data,n=0;n<i;n++)for(var a=0;a<r;a+=2){var o=n*i+a,u=s[4*o+0]>>3<<10|s[4*o+1]>>3<<5|s[4*o+2]>>3;0==(65535&(u=(u=0===u?1:u)<<16|s[4*o+4]>>3<<10|s[4*o+5]>>3<<5|s[4*o+6]>>3))&&(u|=1),t[o>>1]=u}},jpeg2_ditherPixelsToForm16:function(e,t){for(var r=e.width>>1,i=e.height,s=e.data,n=[2,0,14,12,1,3,13,15],a=[10,8,6,4,9,11,5,7],o=0;o<i;o++)for(var u=0;u<r;u++){var l=o*i+2*u<<2,c=s[l],h=s[1+l],f=s[2+l],p=s[4+l],d=s[5+l],m=s[6+l],v=(3&o)<<1|1&u,g=n[v],v=a[v],b=496*c>>8,k=15&b,S=b>>4,c=g<k?1+S:S;S=(b=496*h>>8)>>4,h=g<(15&b)?1+S:S,S=(b=496*f>>8)>>4,f=g<(15&b)?1+S:S,S=(b=496*p>>8)>>4,p=v<(15&b)?1+S:S,S=(b=496*d>>8)>>4,d=v<(15&b)?1+S:S,S=(b=496*m>>8)>>4;k=c<<10|h<<5|f;0==(65535&(k=(k=0===k?1:k)<<16|p<<10|d<<5|(m=v<(15&b)?1+S:S)))&&(k|=1),t[l>>3]=k}}}),Object.extend(Squeak.Primitives.prototype,"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(e){var t,r,i=this.stackNonInteger(0).bytesAsString();return""!=i&&(/^\/SqueakJS\//.test(i)&&(i=i.slice(10),t=Squeak.splitFilePath(i),r=Squeak.Settings["squeak-template:"+t.dirname])&&(i=JSON.parse(r).url+"/"+t.basename),window.open(i,"_blank"),this.popNIfOK(e))},scratch_primitiveGetFolderPath:function(e){var t,r=this.stackInteger(0);return!!this.success&&!!(t=1===r?"/":t)&&(this.vm.popNandPush(e+1,this.makeStString(this.filenameToSqueak(t))),!0)}}),Object.extend(Squeak.Primitives.prototype,"SoundPlugin",{snd_primitiveSoundStart:function(e){return this.snd_primitiveSoundStartWithSemaphore(e)},snd_primitiveSoundStartWithSemaphore:function(e){var t=this.stackInteger(e-1),r=this.stackInteger(e-2),i=this.stackBoolean(e-3),s=3<e?this.stackInteger(e-4):0;return!!this.success&&(this.audioContext=Squeak.startAudioOut(),this.audioContext?(this.audioSema=s,this.audioNextTimeSlot=0,this.audioBuffersReady=[],this.audioBuffersUnused=[this.audioContext.createBuffer(i?2:1,t,r),this.audioContext.createBuffer(i?2:1,t,r)],this.popNIfOK(e)):(this.vm.warnOnce("could not initialize audio"),!1))},snd_playNextBuffer:function(){var e;this.audioContext&&0!==this.audioBuffersReady.length&&((e=this.audioContext.createBufferSource()).buffer=this.audioBuffersReady.shift(),e.connect(this.audioContext.destination),this.audioNextTimeSlot<this.audioContext.currentTime&&(this.audioNextTimeSlot=this.audioContext.currentTime),e.start(this.audioNextTimeSlot),this.audioNextTimeSlot+=e.buffer.duration,window.setTimeout(function(){this.audioContext&&this.vm.forceInterruptCheck&&(this.audioBuffersUnused.push(e.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1e3*(this.audioNextTimeSlot-this.audioContext.currentTime)),this.snd_playNextBuffer())},snd_primitiveSoundAvailableSpace:function(e){var t,r;return this.audioContext?((r=0)<this.audioBuffersUnused.length&&(r=(t=this.audioBuffersUnused[0]).length*t.numberOfChannels*2),this.popNandPushIfOK(e+1,r)):(console.warn("sound: no audio context"),!1)},snd_primitiveSoundPlaySamples:function(e){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.warn("sound: play but no free buffers"),!1;var t=this.stackInteger(2),r=this.stackNonInteger(1).wordsAsInt16Array(),i=this.stackInteger(0)-1;if(!this.success||!r)return!1;for(var s=this.audioBuffersUnused.shift(),n=s.numberOfChannels,a=0;a<n;a++)for(var o=s.getChannelData(a),u=i+a,l=0;l<t;l++)o[l]=r[u]/32768,u+=n;return this.audioBuffersReady.push(s),this.snd_playNextBuffer(),this.popNIfOK(e)},snd_primitiveSoundPlaySilence:function(e){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.warn("sound: play but no free buffers"),!1;for(var t=this.audioBuffersUnused.shift(),r=t.numberOfChannels,i=t.length,s=0;s<r;s++)for(var n=t.getChannelData(s),a=0;a<i;a++)n[a]=0;return this.audioBuffersReady.push(t),this.snd_playNextBuffer(),this.popNandPushIfOK(e+1,i)},snd_primitiveSoundStop:function(e){return this.audioContext&&(this.audioContext=null,this.audioBuffersReady=null,this.audioBuffersUnused=null,this.audioNextTimeSlot=0,this.audioSema=0),this.popNIfOK(e)},snd_primitiveSoundStartRecording:function(i){var t,s,n,a,r,o,u;return 3===i&&(t=this.stackNonInteger(3),s=this.stackInteger(2),n=this.stackBoolean(1),a=this.stackInteger(0),!!this.success)&&(r=this.primMethod,o=this.vm.freeze(),u=this,Squeak.startAudioIn(function(e,t){for(u.audioInContext=e,u.audioInSource=t,u.audioInSema=a,u.audioInBuffers=[],u.audioInBufferIndex=0,u.audioInOverSample=1;s*u.audioInOverSample<u.audioInContext.sampleRate;)u.audioInOverSample*=2;for(var r=1024*u.audioInOverSample;r/u.audioInContext.sampleRate<.1;)r*=2;u.audioInProcessor=e.createScriptProcessor(r,n?2:1,n?2:1),u.audioInProcessor.onaudioprocess=function(e){u.snd_recordNextBuffer(e.inputBuffer)},u.audioInSource.connect(u.audioInProcessor),u.audioInProcessor.connect(e.destination),u.vm.popN(i),window.setTimeout(o,0)},function(e){console.warn(e),u.vm.sendAsPrimitiveFailure(t,r,i),window.setTimeout(o,0)}),!0)},snd_recordNextBuffer:function(e){this.audioInContext&&(5<this.audioInBuffers.length&&this.audioInBuffers.shift(),this.audioInBuffers.push(e),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(e){var t;return!!this.audioInContext&&(t=this.audioInContext.sampleRate/this.audioInOverSample|0,this.popNandPushIfOK(e+1,t))},snd_primitiveSoundRecordSamples:function(e){var t=this.stackNonInteger(1).wordsAsInt16Array(),r=this.stackInteger(0)-1;if(!this.success)return!1;for(var i=0;r<t.length&&0!==this.audioInBuffers.length;){for(var s=this.audioInBuffers[0],n=s.numberOfChannels,a=n,o=this.audioInOverSample,u=(t.length-r)/a,l=(s.length-this.audioInBufferIndex)/o,c=Math.min(l,u),h=0;h<n;h++)for(var f=s.getChannelData(h),p=this.audioInBufferIndex,d=r+h,m=0;m<c;m++)t[d]=32768*f[p]&65535,d+=a,p+=o;i+=c*n,r+=c*n,p<s.length?this.audioInBufferIndex=p:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(e+1,i)},snd_primitiveSoundStopRecording:function(e){return this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInBuffers=null,this.audioInSource=null,this.audioInProcessor=null,console.log("sound recording stopped")),Squeak.stopAudioIn(),this.popNIfOK(e)},snd_primitiveSoundSetRecordLevel:function(e){return this.vm.warnOnce("sound set record level not supported"),this.popNIfOK(e)}}),(()=>{var t=1,r=11;function a(e,t){return 31<t?0:e<<t}function o(e,t){return 31<t?0:e>>>t}var A=0,_=0,P=0,w=null,C=null,e="ADPCMCodecPlugin 3 November 2014 (e)",x=null;function i(){return e}function E(e){for(var t,r=0,i=e;;){if(!(0<(t=i-A)))return r+=o(P,0-t),P&=o(255,8-(A-=i)),r;r+=a(P,t),i-=A,P=w[++_-1],A=8}}function b(e,t){for(var r,i,s=t,n=e;;){if(!((i=(r=8-A)-n)<0))return P+=a(s,i),A+=n,self;P+=o(s,0-i),w[++_-1]=P,s&=a(1,(P=A=0)-i)-1,n-=r}}function s(){var e,t,r,i,s,n,a,o,u,l=C.stackValue(1),c=C.stackIntegerValue(0),h=C.fetchIntegerofObject(0,l),f=C.fetchIntegerofObject(1,l),p=C.fetchIntegerofObject(2,l),d=C.fetchIntegerofObject(3,l),m=C.fetchIntegerofObject(4,l),v=C.fetchIntegerofObject(5,l);if(P=C.fetchIntegerofObject(6,l),A=C.fetchIntegerofObject(7,l),_=C.fetchIntegerofObject(8,l),w=C.fetchBytesofObject(9,l),u=C.fetchInt16ArrayofObject(10,l),o=C.fetchIntegerofObject(12,l),n=C.fetchIntegerofObject(13,l),x=C.fetchInt16ArrayofObject(14,l),a=C.fetchInt16ArrayofObject(15,l),C.failed())return null;for(r=1;r<=c;r++){if(1==(r&v))32767<(h=E(16))&&(h-=65536),f=E(6);else{for(t=E(n),s=x[f],i=0,e=m;0<e;)0<(t&e)&&(i+=s),s>>>=1,e>>>=1;i+=s,0<(t&p)?h-=i:h+=i,32767<h?h=32767:h<-32768&&(h=-32768),(f+=a[t&d])<0?f=0:88<f&&(f=88)}u[++o-1]=h}if(C.failed())return null;C.storeIntegerofObjectwithValue(0,l,h),C.storeIntegerofObjectwithValue(1,l,f),C.storeIntegerofObjectwithValue(6,l,P),C.storeIntegerofObjectwithValue(7,l,A),C.storeIntegerofObjectwithValue(8,l,_),C.storeIntegerofObjectwithValue(12,l,o),C.pop(1)}function n(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g=C.stackValue(1),b=C.stackIntegerValue(0),k=C.fetchInt16ArrayofObject(0,g),S=C.fetchInt16ArrayofObject(1,g),y=C.fetchIntegerofObject(2,g),I=C.fetchIntegerofObject(3,g),O=C.fetchIntegerofObject(4,g),F=C.fetchIntegerofObject(5,g);if(P=C.fetchIntegerofObject(6,g),A=C.fetchIntegerofObject(7,g),_=C.fetchIntegerofObject(8,g),w=C.fetchBytesofObject(9,g),v=C.fetchInt16ArrayofObject(10,g),d=C.fetchInt16ArrayofObject(11,g),m=C.fetchIntegerofObject(12,g),f=C.fetchIntegerofObject(13,g),x=C.fetchInt16ArrayofObject(14,g),p=C.fetchInt16ArrayofObject(15,g),C.failed())return null;for(u=k[0],l=k[1],s=S[0],n=S[1],i=1;i<=b;i++){if(1==(i&F))u=E(16),s=E(6),l=E(16),n=E(6),32767<u&&(u-=65536),32767<l&&(l-=65536);else{for(t=E(f),r=E(f),c=x[s],h=x[n],a=o=0,e=O;0<e;)0<(t&e)&&(a+=c),0<(r&e)&&(o+=h),c>>>=1,h>>>=1,e>>>=1;a+=c,o+=h,0<(t&y)?u-=a:u+=a,0<(r&y)?l-=o:l+=o,32767<u?u=32767:u<-32768&&(u=-32768),32767<l?l=32767:l<-32768&&(l=-32768),(s+=p[t&I])<0?s=0:88<s&&(s=88),(n+=p[r&I])<0?n=0:88<n&&(n=88)}v[++m-1]=u,d[m-1]=l}if(k[0]=u,k[1]=l,S[0]=s,S[1]=n,C.failed())return null;C.storeIntegerofObjectwithValue(6,g,P),C.storeIntegerofObjectwithValue(7,g,A),C.storeIntegerofObjectwithValue(8,g,_),C.storeIntegerofObjectwithValue(12,g,m),C.pop(1)}function u(){var e,t,r,i,s,n,a,o,u,l,c,h=C.stackValue(1),f=C.stackIntegerValue(0),p=C.fetchIntegerofObject(0,h),d=C.fetchIntegerofObject(1,h),m=C.fetchIntegerofObject(2,h),v=C.fetchIntegerofObject(4,h),g=C.fetchIntegerofObject(5,h);if(P=C.fetchIntegerofObject(6,h),A=C.fetchIntegerofObject(7,h),_=C.fetchIntegerofObject(8,h),w=C.fetchBytesofObject(9,h),c=C.fetchInt16ArrayofObject(10,h),l=C.fetchIntegerofObject(12,h),o=C.fetchIntegerofObject(13,h),x=C.fetchInt16ArrayofObject(14,h),u=C.fetchInt16ArrayofObject(15,h),C.failed())return null;for(a=x[0],i=1;i<=f;i++)if(1==(i&g))(n=p=c[++l-1])<0&&(n+=65536),b(16,n),b(6,d=i<f?((e,t)=>{var r,i,s=t-e;for(s<0&&(s=0-s),r=63,i=1;i<=62;i++)63===r&&x[i-1]>=s&&(r=i);return r})(p,c[l]):d);else{for((r=c[++l-1]-p)<(n=0)&&(n=m,r=0-r),s=t=0,e=v;0<e;)a<=r&&(t+=e,s+=a,r-=a),a>>>=1,e>>>=1;s+=a,0<n?p-=s:p+=s,32767<p?p=32767:p<-32768&&(p=-32768),(d+=u[t])<0?d=0:88<d&&(d=88),a=x[d],b(o,n|t)}if(0<A&&(w[++_-1]=P),C.failed())return null;C.storeIntegerofObjectwithValue(0,h,p),C.storeIntegerofObjectwithValue(1,h,d),C.storeIntegerofObjectwithValue(6,h,P),C.storeIntegerofObjectwithValue(7,h,A),C.storeIntegerofObjectwithValue(8,h,_),C.storeIntegerofObjectwithValue(12,h,l),C.pop(1)}function l(){var e=C.stackValue(1);return C.stackIntegerValue(0),P=C.fetchIntegerofObject(6,e),A=C.fetchIntegerofObject(7,e),_=C.fetchIntegerofObject(8,e),w=C.fetchIntegerofObject(9,e),x=C.fetchIntegerofObject(14,e),C.failed()||(success(!1),C.failed())?null:(C.storeIntegerofObjectwithValue(6,e,P),C.storeIntegerofObjectwithValue(7,e,A),C.storeIntegerofObjectwithValue(8,e,_),void C.pop(1))}function c(e){return!1!=((C=e).majorVersion()==t)&&C.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("ADPCMCodecPlugin",{primitiveDecodeStereo:n,primitiveEncodeStereo:l,setInterpreter:c,primitiveEncodeMono:u,primitiveDecodeMono:s,getModuleName:i}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function V(e){return"number"==typeof e?b.classSmallInteger():e.sqClass}function f(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function N(e,t){return 0|Math.floor(e/t)}function q(e,t){return 31<t?0:e<<t}function D(e,t){return 31<t?0:e>>>t}function o(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}function e(e,t){return new Float32Array(e.buffer,e.byteOffset+4*t)}var i=12,n=2,a=3,j=1,B=0,R=6,K=0,X=4,Y=1,Z=2,J=3,Q=6,$=0,ee=2,te=1,re=3,ie=16,se=12,ne=11,ae=14,oe=13,ue=10,le=18,ce=15,he=14,fe=15,pe=21,de=18,me=16,ve=4,ge=5,be=2,ke=3,Se=10,ye=0,Ie=1,Oe=12,Fe=13,Ae=18,_e=19,Pe=20,we=16,Ce=28,xe=22,Ee=17,Te=10,Le=4,Me=65536,Ve=100,Ne=121,je=122,Be=114,Re=112,qe=101,De=102,u=104,Ue=103,Ge=120,We=119,ze=113,He=123,Ke=115,Xe=108,Ye=105,Ze=106,Je=110,Qe=107,$e=109,et=111,tt=118,rt=117,it=116,st=8,nt=9,at=7,ot=2,ut=1,lt=0,ct=6,ht=1024,ft=2,pt=255,dt=256,mt=65280,vt=4,gt=512,bt=768,kt=65535,St=1,yt=7,It=5,Ot=254,Ft=1,At=5,_t=8,Pt=3,l=0,wt=6,Ct=7,xt=2,Et=4,Tt=4,Lt=5,Mt=6,Vt=6,Nt=2,jt=5,Bt=4,Rt=3,qt=1,Dt=6,Ut=7,Gt=8,Wt=9,zt=4,Ht=5,Kt=10,Xt=12,Yt=12,Zt=16,Jt=14,Qt=15,$t=13,er=15,tr=14,rr=18,ir=19,sr=20,nr=16,ar=21,or=17,ur=10,lr=12,cr=11,hr=51,fr=50,pr=53,dr=48,mr=52,vr=49,gr=13,br=14,kr=109,Sr=111,yr=108,Ir=110,Or=10,Fr=69,Ar=43,_r=45,Pr=42,wr=44,Cr=24,xr=97,Er=107,Tr=103,Lr=93,Mr=91,Vr=101,Nr=105,jr=99,Br=95,Rr=88,qr=113,Dr=46,Ur=47,Gr=18,Wr=37,zr=39,Hr=36,Kr=38,Xr=11,Yr=12,Zr=17,Jr=16,Qr=128,$r=65,ei=66,ti=67,ri=68,ii=0,si=1097753705,ni=256,ai=63,oi=8,ui=9,li=80,ci=82,hi=84,fi=86,pi=1,di=34,mi=35,vi=33,gi=32,bi=2,ki=64,Si=96,yi=106,Ii=102,Oi=92,Fi=90,Ai=100,_i=104,Pi=98,wi=94,p=3,d=5,c=null,Ci="BitBltPlugin",xi=null,Ei=0,Ti=0,m=0,Li=0,y=0,Mi=0,v=0,g=null,b=null,Vi=null,Ni="B2DPlugin 14 November 2014 (e)",ji=null,k=0,U=null,h=null;function G(){return h[hr]}function Bi(e){h[hr]=e}function Ri(){return h[fr]}function qi(e,t){e=e+W()-1&~(W()-1);return t<e?t:e}function Di(e,t){return t-1&~(W()-1)}function W(){return h[dr]}function Ui(){return h[mr]}function Gi(e){h[mr]=e}function z(){return h[vr]}function Wi(e){h[vr]=e}function zi(e,t){return 0===e?t<0?0-t:t:0===t?e<0?0-e:e:(e=e*e+t*t)<32?[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6][e]:Math.sqrt(e)+.5|0}function Hi(e){$i(1)&&(g[zn()]=e,Hn(zn()+1))}function S(){return h[gr]}function Ki(e){h[gr]=e}function Xi(){return h[br]}function Yi(e){h[br]=e}function Zi(e){return Ta(e)}function Ji(){return Nu(6),s()}function Qi(e,t){var r,i,s,n=de+e;if(!ts(n))return 0;if(k=(i=k)+n,Ua(i,ht),Ra(i,0),qa(i,n),r=Xs(i),Yn())for(s=0;s<=e-1;s++)r[s]=M(t[s]);else for(s=0;s<=e-1;s++)r[s]=t[s];return _(i,ce,e),i}function $i(e){var t,r,i,s;if(Zi(e)){if(0!==Xi())for(i=Xi(),t=Xi()+e,r=1,s=Xi();r<=s;r++)c[--t]=c[--i];return c=o(c,e),1}}function es(e,t,r){var i,s,n,a=Yt+t;if(!ts(a))return 0;if(k=(i=k)+a,Ua(i,r?bt:gt),Ra(i,0),qa(i,a),n=Xn(i),Yn())for(s=0;s<=t-1;s++)n[s]=M(e[s]);else for(s=0;s<=t-1;s++)n[s]=e[s];return _(i,Kt,t),i}function ts(e){var t,r,i,s;if($i(e)){if(0!==zn())for(i=zn(),t=zn()+e,r=1,s=zn();r<=s;r++)g[--t]=g[--i];return g=o(g,e),1}}function rs(){return Nu(3)}function is(e){return 0==(A(e,lt)&Me)}function ss(e,t,r){if(r<t){if(t<e)return t;if(e<r)return r}else{if(e<t)return t;if(r<e)return r}return e}function ns(e){return A(e,he)}function as(e,t){_(e,he,t)}function os(e){return A(e,fe)}function us(e,t){_(e,fe,t)}function ls(e){return A(e,pe)}function cs(e,t){_(e,pe,t)}function hs(e){return o(ji,e+Se)}function fs(e,t){_(e,Oe,t)}function ps(e,t){_(e,Fe,t)}function ds(e){return A(e,ne)}function ms(e){return A(e,me)}function vs(e,t,r,i){var s,n=A(e,se),a=A(e,ae);return 32===n?0!==(s=0|t[a*i+r])&&0==(4278190080&s)&&(s|=4278190080):(s=t[a*i+D(r,t=[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1][n])],a=q(1,n)-1,s=D(s,32-n-(r&q(1,t)-1)*n)&a,16===n?0!==s&&(i=(31&s)<<3,r=(s>>>5&31)<<3,t=(s>>>10&31)<<3,s=(i+=i>>>5)+((r+=r>>>5)<<8)+((t+=t>>>5)<<16)+(255<<24)):s=0===A(e,ce)?0:Xs(e)[s]),Lu(s)}function gs(e){return A(e,ue)}function bs(e){return ju(s()-e+4)}function ks(e,t){Bu(s()-e+4,t)}function Ss(e){return ju(s()-e+5)}function ys(e,t){Bu(s()-e+5,t)}function Is(e){return ju(s()-e+0)}function Os(e,t){Bu(s()-e+0,t)}function Fs(e){return ju(s()-e+1)}function As(e,t){Bu(s()-e+1,t)}function _s(e){return ju(s()-e+2)}function Ps(e,t){Bu(s()-e+2,t)}function ws(e){return ju(s()-e+3)}function Cs(e,t){Bu(s()-e+3,t)}function xs(e,t,r){for(var i,s,n=f(e),a=e.wordsAsInt32Array(),o=0,u=0;u<=n-1;u++){if(i=Go(u,a),!(0<=(s=Wo(u,a))&&s<=t))return;o+=i}return o===r}function Es(e,t,r,i,s,n,a){if((e=e,o=t,b.isWords(e)&&((e=f(e))===3*o||e===6*o))&&((e=>{var t,r,i;if(b.isWords(e)){for(i=f(e),t=e.wordsAsInt32Array(),r=0;r<=i-1;r++)if(!na(t[r]))return;return 1}})(a)&&xs(r,e=f(a),t)&&xs(i,e,t)&&xs(n,e,t))){for(var o=s,r=t,u=f(o),l=o.wordsAsInt32Array(),c=0,h=0;h<=u-1;h++)c+=Go(h,l);return!!(c===r)}}function Ts(e){var t,r;return(Da(e)&Ot)===vt?(t=aa(r=e)?Zu(r):0,ha(r)+t<Pn()||I(r)-t>=Fn()&&ca(r)-t>=Fn()?0:void Hi(r)):(Da(e)&Ot)===ct?(r=aa(t=e)?Gu(t):0,os(t)+r<Pn()||I(t)-r>=Fn()&&ns(t)-r>=Fn()?0:void Hi(t)):void Hi(e)}function Ls(){return[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1]}function Ms(){return[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0]}function Vs(e,t){return e<0?0:t<=e?t-1:e}function Ns(){var e=D(Jo(),z()),t=D(Xo(),z())+1;for(e<0&&(e=0),t>Zo()&&(t=Zo());e<t;)U[e]=0,++e;Qo(Zo()),Yo(0)}function js(){return h[Fr]}function Bs(e){h[Fr]=e}function Rs(){return h[Ar]}function qs(e){h[Ar]=e}function Ds(){return h[_r]}function Us(e){h[_r]=e}function Gs(){return h[Pr]}function Ws(e){h[Pr]=e}function zs(){return h[wr]}function Hs(e){h[wr]=e}function Ks(){return e(h,Cr)}function Xs(e){return o(ji,e+le)}function Ys(e,t){var r,i,s,n=h=Is(e),a=r=Fs(e),o=i=_s(e),u=s=ws(e),l=bs(e),c=Ss(e),h=n+=(i-h)*t|0,f=a+=(s-r)*t|0;return h+=((o+=(l-i)*t|0)-n)*t|0,a=ss(a,r,f+=((u+=(c-s)*t|0)-a)*t|0),u=ss(u,f,c),i=Ji(),y?0:(Ps(e,n),Cs(e,a),ks(e,h),ys(e,f),Os(i,h),As(i,f),Ps(i,o),Cs(i,u),ks(i,l),ys(i,c),i)}function Zs(e){var t,r,i,s,n,a,o,u,l,c,h,f,p=Ji();return y?0:(i=l=Is(e),s=c=Fs(e),n=h=_s(e),a=f=ws(e),o=n+=(t=bs(e))-h>>1,u=a+=(r=Ss(e))-f>>1,o+=(i+=h-l>>1)-n>>1,u+=(s+=f-c>>1)-a>>1,Ps(e,i),Cs(e,s),ks(e,o),ys(e,u),Os(p,o),As(p,u),Ps(p,n),Cs(p,a),ks(p,t),ys(p,r),p)}function Js(e,t){var r,i=hs(e)[ye]>>8,s=Wu(e)[ye]>>8;s<i&&(r=i,i=s,s=r),pn(e,i),zu(e,t<s-i?s-i:t)}function Qs(){for(var e=0,t=k;e<t;)!(e=>!(Da(e)>pt)&&0!=(Da(e)&pt))(e)||dn(e)>=An()||Ts(e),e+=A(e,ut)}function H(){return h[Rr]}function $s(e){h[Rr]=e}function en(){return h[qr]}function tn(e){h[qr]=e}function rn(){return h[Dr]}function sn(){return h[Ur]}function nn(e){var t,r=D(Jo(),z());r<Gs()&&(r=Gs()),(t=D(Xo()+W()-1,z()))>Rs()&&(t=Rs()),(e=D(e,z()))<zs()||e>=Ds()||t<Gs()||r>=Rs()||(r=r,t=t,e=e,(xi||ea())&&xi(r,t,e))}function an(e){Ua(e,Da(e)|Me)}function on(e){Ua(e,-65537&Da(e))}function un(e,t){_(e,st,t)}function ln(e){return A(e,at)}function cn(e,t){return _(e,at,t)}function hn(e,t){_(e,nt,t)}function fn(){return e(h,Gr)}function I(e){return A(e,Tt)}function pn(e,t){_(e,Tt,t)}function dn(e){return A(e,Lt)}function mn(e,t){_(e,Lt,t)}function vn(e){return A(e,Mt)}function gn(e,t){_(e,Mt,t)}function bn(e,t){for(var r=Iu(),i=e,s=Cu();s<t;){if(0!==(r=Iu())&&Mn(r,i,s))return;jo(s),i=s,s=Cu()}if(0!==(r=Iu()))return Mn(r,i,t)}function kn(){var e,t,r,i,s,n,a,o,u,l,c,h,N,f,p,d,m,v,g,b,k,S,y,I,O,j,F,B,A,_,P,w,C=oa(),x=ua(),R=la(),E=H();if(1!==W()){var T=C,L=x,M=R,V=E;if(!(p=ba(T)))return;for(m=gs(T),d=ds(T),A=1===ms(T),b=L-xn(T),V=V-En(T),S=yn(T),I=wn(T),k=b*S+V*In(T),y=b*I+V*Cn(T),N=W(),j=qi(L,M),B=Di(0,M),f=z(),v=G(),g=Ri(),_=L;_<j;)A&&(k=Ro(k,m<<16),y=Ro(y,d<<16)),P=k>>16,w=y>>16,A||(P=Vs(P,m),w=Vs(w,d)),0<=P&&0<=w&&P<m&&w<d&&(O=D((O=vs(T,p,P,w))&v,g),F=D(_,f),U[F]=U[F]+O),k+=S,y+=I,++_;for(v=4042322160|D(G(),z()),g=z();_<B;)A&&(k=Ro(k,m<<16),y=Ro(y,d<<16)),P=k>>16,w=y>>16,A||(P=Vs(P,m),w=Vs(w,d)),0<=P&&0<=w&&P<m&&w<d&&(O=D((O=vs(T,p,P,w))&v,g),F=D(_,f),U[F]=U[F]+O),k+=q(S,g),y+=q(I,g),_+=N;for(v=G(),g=Ri();_<M;)A&&(k=Ro(k,m<<16),y=Ro(y,d<<16)),P=k>>16,w=y>>16,A||(P=Vs(P,m),w=Vs(w,d)),0<=P&&0<=w&&P<m&&w<d&&(O=D((O=vs(T,p,P,w))&v,g),F=D(_,f),U[F]=U[F]+O),k+=S,y+=I,++_}else if(e=ba(C))for(r=gs(C),t=ds(C),o=1===ms(C),b=x-xn(C),E=E-En(C),s=yn(C),a=wn(C),i=b*s+E*In(C),n=b*a+E*Cn(C),u=x,l=R;u<l;)o&&(i=Ro(i,r<<16),n=Ro(n,t<<16)),c=i>>16,h=n>>16,o||(c=Vs(c,r),h=Vs(h,t)),0<=c&&0<=h&&c<r&&h<t&&(c=vs(C,e,c,h),U[u]=c),i+=s,n+=a,++u}function Sn(e,t,r){var i,s;if(1!==W()){var n,a,o,u,l,c,h,f=e,p=t,d=r;if(o=qi(p,d),l=Di(0,d),n=W(),a=z(),(h=p)<o)for(c=D(f&G(),Ri());h<o;)u=D(h,a),U[u]=U[u]+c,++h;if(h<l)for(p=4042322160|D(G(),z()),c=D(f&p,z());h<l;)u=D(h,a),U[u]=U[u]+c,h+=n;if(h<d)for(c=D(f&G(),Ri());h<d;)u=D(h,a),U[u]=U[u]+c,++h}else{for(i=t,s=r;i+4<s;)U[i]=e,U[i+1]=e,U[i+2]=e,U[i+3]=e,i+=4;for(;i<s;)U[i]=e,++i}}function yn(e){return A(e,Dt)}function In(e){return A(e,Ut)}function On(){var e,t,r,i,s,n,a,o=oa(),u=ua(),l=la(),c=H();for(r=Xn(o),s=Kn(o),t=yn(o),e=(u-xn(o))*t+(c-En(o))*In(o),n=c=u,a=l;((i=e>>16)<0||s<=i)&&n<a;)++n,e+=t;if(c<n&&Sn(r[i=s<=(i=i<0?0:i)?s-1:i],c,n),1===W())for(;(i=e>>16)<s&&0<=i&&n<a;)U[n]=r[i],++n,e+=t;else n=((e,t,r,i,s,n)=>{var a,o,u,l,c,h,f,p,d,m,v,g;for(a=W(),o=z(),m=Kn(e),d=(c=r)>>16,h=qi(g=s,n),p=Di(0,n),u=G(),l=Ri();g<h&&d<m&&0<=d;){for(v=D((v=t[d])&u,l);g<h&&c>>16===d;)f=D(g,o),U[f]=U[f]+v,++g,c+=i;d=c>>16}for(u=4042322160|D(G(),z()),l=z();g<p&&d<m&&0<=d;){for(v=D((v=t[d])&u,l);g<p&&c>>16===d;)f=D(g,o),U[f]=U[f]+v,g+=a,c+=q(i,l);d=c>>16}for(u=G(),l=Ri();g<n&&d<m&&0<=d;){for(v=D((v=t[d])&u,l);g<n&&c>>16===d;)f=D(g,o),U[f]=U[f]+v,++g,c+=i;d=c>>16}return g})(o,r,e,t,n,l);n<a&&Sn(r[i=s<=(i=i<0?0:i)?s-1:i],n,a)}function Fn(){return h[Wr]}function An(){return h[zr]}function _n(){return h[Hr]}function Pn(){return h[Kr]}function wn(e){return A(e,Gt)}function Cn(e){return A(e,Wt)}function xn(e){return A(e,zt)}function En(e){return A(e,Ht)}function Tn(){var e,t,r,i,s,n,a,o,u,l,c=oa(),h=ua(),f=la(),p=H();for(a=Xn(c),o=Kn(c),e=h-xn(c),p=p-En(c),r=yn(c),s=wn(c),t=e*r+p*In(c),i=e*s+p*Cn(c),u=h,l=f,n=(o-1)*(o-1);E(t>>16,i>>16)>=n&&u<l;)++u,t+=r,i+=s;h<u&&Sn(a[o-1],h,u),(e=P())[0]=t,e[1]=i,(u=(u=u<xn(c)?(1===W()?(e,t,r,i,s,n,a)=>{var o,u=0|r[0],l=0|r[1],c=zi(u>>16,l>>16),h=t[c],f=(c-1)*(c-1),p=n,d=a;for(d>xn(e)&&(d=xn(e));p<d;){for(;p<d&&E(u>>16,l>>16)>=f;)U[p]=h,++p,u+=i,l+=s;for(o=E(u>>16,l>>16);o<f;)h=t[--c],f=(c-1)*(c-1)}return r[0]=u,r[1]=l,p}:(e,t,r,i,s,n,a)=>{var o,u,l,c,h,f=0|r[0],p=0|r[1],d=W(),m=z(),v=zi(f>>16,p>>16),g=(v-1)*(v-1),b=n,k=xn(e),S=qi(n,k=a<k?a:k),y=Di(0,k);if(b<S)for(o=G(),u=Ri(),h=D((h=t[v])&o,u);b<S;){for(;b<S&&E(f>>16,p>>16)>=g;)l=D(b,m),U[l]=U[l]+h,++b,f+=i,p+=s;for(c=E(f>>16,p>>16);c<g;)h=D((h=t[--v])&o,u),g=(v-1)*(v-1)}if(b<y)for(o=4042322160|D(G(),z()),u=z(),h=D((h=t[v])&o,u);b<y;){for(;b<y&&E(f>>16,p>>16)>=g;)l=D(b,m),U[l]=U[l]+h,b+=d,f+=q(i,u),p+=q(s,u);for(c=E(f>>16,p>>16);c<g;)h=D((h=t[--v])&o,u),g=(v-1)*(v-1)}if(b<k)for(o=G(),u=Ri(),h=D((h=t[v])&o,u);b<k;){for(;b<k&&E(f>>16,p>>16)>=g;)l=D(b,m),U[l]=U[l]+h,++b,f+=i,p+=s;for(c=E(f>>16,p>>16);c<g;)h=D((h=t[--v])&o,u),g=(v-1)*(v-1)}return r[0]=f,r[1]=p,b})(c,a,e,r,s,u,l):u)<l?(1===W()?(e,t,r,i,s,n,a)=>{var o,u,l,c,h,f,p,d,m;for(o=0|r[0],f=zi(o>>16,(u=0|r[1])>>16),p=t[f],e=Kn(e),c=(e-1)*(e-1),h=(f+1)*(f+1),l=E(o>>16,u>>16),d=n,m=a;d<m&&l<c;){for(;d<m&&E(o>>16,u>>16)<=h;)U[d]=p,++d,o+=i,u+=s;for(l=E(o>>16,u>>16);h<l;)p=t[++f],h=(f+1)*(f+1)}return r[0]=o,r[1]=u,d}:(e,t,r,i,s,n,a)=>{var o,u,l,c,h,f,p,d,m,v,g,b,k,S,y;if(h=0|r[0],f=0|r[1],o=W(),u=z(),k=zi(h>>16,f>>16),e=Kn(e),g=(e-1)*(e-1),b=(k+1)*(k+1),m=E(h>>16,f>>16),p=qi(y=n,a),v=Di(0,a),y<p&&m<g)for(l=G(),c=Ri(),S=D((S=t[k])&l,c);y<p&&m<g;){for(;y<p&&E(h>>16,f>>16)<=b;)d=D(y,u),U[d]=U[d]+S,++y,h+=i,f+=s;for(m=E(h>>16,f>>16);b<m;)S=D((S=t[++k])&l,c),b=(k+1)*(k+1)}if(y<v&&m<g)for(l=4042322160|D(G(),z()),c=z(),S=D((S=t[k])&l,c);y<v&&m<g;){for(;y<v&&E(h>>16,f>>16)<=b;)d=D(y,u),U[d]=U[d]+S,y+=o,h+=q(i,c),f+=q(s,c);for(m=E(h>>16,f>>16);b<m;)S=D((S=t[++k])&l,c),b=(k+1)*(k+1)}if(y<a&&m<g)for(l=G(),c=Ri(),S=D((S=t[k])&l,c);y<a&&m<g;){for(;y<a&&E(h>>16,f>>16)<=b;)d=D(y,u),U[d]=U[d]+S,++y,h+=i,f+=s;for(m=E(h>>16,f>>16);b<m;)S=D((S=t[++k])&l,c),b=(k+1)*(k+1)}return r[0]=h,r[1]=f,y})(c,a,e,r,s,u,l):u)<f&&Sn(a[o-1],u,f)}function Ln(e,t){var r=$o(e)-$o(t);return 0!=r?0<r:iu(e)>>>0<iu(t)>>>0}function Mn(e,t,r){if(0!==e){var t=t<Ho()?Ho():t,r=r>q(Zo(),z())?q(Zo(),z()):r;if(t<_n()&&(t=_n()),r>Fn()&&(r=Fn()),t<Jo()&&Qo(t),r>Xo()&&Yo(r),r>Ho()&&Ko(r),!(r<=t))if(sa(e))Sn(e,t,r);else{if(h[ei]=e,t=t,h[ti]=t,t=r,h[ri]=t,(r=(Da(e)&mt)>>>8)<=1)return!0;switch(r){case 0:case 1:break;case 2:On();break;case 3:Tn();break;case 4:case 5:kn()}}}return!1}function Vn(){for(var e,t,r=H();Gn()<zn();){if(dn(e=g[Gn()])>r)return!1;if(((t=Da(e))&Ot)===ft)return!0;if(!Ta(1))return!1;switch(t){case 0:case 1:case 2:case 3:break;case 4:ou(g[Gn()],H());break;case 5:a=f=h=l=u=c=i=n=s=void 0;var i,s=g[Gn()],n=H();if(u=Zu(s),c=u>>1,h=I(s),f=dn(s),ou(s,f),l=ln(s),a=pa(s),pn(s,h-c),cn(s,l+u),0<a?Qu(s,da(s)+u):(Qu(s,u-da(s)),pn(s,I(s)+da(s))),h=0-l-c,Ku(s,0),Yu(s,h),(c<=0&&h<0?on:an)(s),f!==n){for(i=f;i<=n-1;i++)fu(s);cn(s,ln(s)-(n-f))}break;case 6:au(g[Gn()],H());break;case 7:f=h=c=l=u=o=a=d=p=void 0;var a,o,u,l,c,h,f,p=g[Gn()],d=H();for(l=Gu(p),u=l>>1,a=ns(p),h=dn(p),au(p,h),c=ln(p),o=0;o<=5;o++)Wu(p)[o]=hs(p)[o];if(0===(f=hs(p)[be])&&hs(p)[ve],((f=0<=f?1:-1)<0?(e,t,r,i)=>{var s;hs(e)[ye]=hs(e)[ye]-256*r,s=Wu(e)[ye],Wu(e)[ye]=s+256*(t-r),s=Wu(e)[Ie],Wu(e)[Ie]=s+256*t,cs(e,i-r)}:(e,t,r,i)=>{var s;hs(e)[ye]=hs(e)[ye]+256*r,s=Wu(e)[ye],Wu(e)[ye]=s-256*(t-r),s=Wu(e)[Ie],Wu(e)[Ie]=s+256*t,cs(e,i-r+t)})(p,l,u,a),0===c&&(hs(p)[ye]=256*ls(p)),cn(p,c+l),f=0-c-u,Du(p,0),Uu(p,f),(u<=0&&f<0?on:an)(p),Js(p,l),h!==d){for(o=h;o<=d-1;o++)hu(p,o);cn(p,ln(p)-(d-h))}}ra(e),Wn(Gn()+1)}return!1}function Nn(){var e,t,r;for(t=Fn();S()<Xi();){if((r=t=I(e=c[S()]))>=Fn())return!1;if(jo(r),aa(e)){a=n=s=i=o=void 0;var i,s,n,a,o=e;switch(a=(e=>Da(e)>>>1)(o),Ti=o,a){case 0:case 1:break;case 2:Ei=Ju(Ti);break;case 3:Ei=(e=>A(e,Ee))(Ti)}switch(n=Ei,a){case 0:case 1:break;case 2:Ei=(e=>A(e,nr))(Ti);break;case 3:Ei=(e=>A(e,we))(Ti)}0!==(a=Ei)&&Ta(3)&&(i=1+(vn(o)<<1),n=I(o)+n,-1===(s=Bn(a,i))?zo(a,i,n):tu(s)<n&&ru(s,n),jo(I(o)))}if(is(e)&&((e=>{var t,r;if(!Ta(6))return;t=vn(e)<<1,0!==(r=(e=>A(e,st))(e))&&yu(r,t,999999999),0!==(r=(e=>A(e,nt))(e))&&yu(r,t,999999999),jo(I(e))})(e),y))return!1;Ki(S()+1),S()<Xi()&&(t=I(c[S()]))>=_n()&&bn(r,t)}return t<Fn()&&bn(t,Fn()),!1}function jn(){for(var e,t;S()<Xi();)if(0==(t=ln(e=c[S()])-1))Bo();else{if(cn(e,t),((t=Da(e))&Ot)===ft)return!0;switch(t){case 0:case 1:case 2:case 3:break;case 4:cu(c[S()],H());break;case 5:fu(c[S()],H());break;case 6:lu(c[S()],H());break;case 7:hu(c[S()],H())}qo(),Ki(S()+1)}return!1}function Bn(e,t){for(var r=0;r<s()&&(iu(r)!==e||$o(r)!==t);)r+=3;return r>=s()?-1:r}function Rn(){return nu()===_t}function qn(){qu(Ru()+3)}function Dn(){return Ni}function Un(e,t){var r;return e===t||(r=0==(r=dn(e)-dn(t))?I(e)-I(t):r)<0}function Gn(){return h[Xr]}function Wn(e){h[Xr]=e}function zn(){return h[Yr]}function Hn(e){h[Yr]=e}function Kn(e){return A(e,Kt)}function Xn(e){return o(ji,e+Xt)}function Yn(){return 0!==h[Zr]}function Zn(e){h[Zr]=e}function Jn(){return 0!==h[Jr]}function Qn(e){h[Jr]=e}function $n(e,t){var r,i=Bn(e,t);if(-1===i)return!1;if(0===i)qn();else if(su(i,ju(0)),eu(i,$o(0)),ru(i,tu(0)),qn(),!(s()<=3)){for(r=0,i=3;i<s();)Ln(i,r)&&(r=i),i+=3;r+3!==s()&&(e=iu(r),su(r,Pu()),wu(e),t=$o(r),eu(r,Ou()),Fu(t),e=tu(r),ru(r,Au()),_u(e))}return!0}function O(e,t){h[e]=h[e]+t}function ea(){return Vi=b.ioLoadFunctionFrom("loadBitBltFrom",Ci),xi=b.ioLoadFunctionFrom("copyBitsFromtoat",Ci),!!Vi&&!!xi}function ta(){var e;Do(W()),Gs()<0&&Ws(0),Rs()>Zo()&&qs(Zo()),e=q(Gs(),z()),h[Hr]=e,e=q(zs(),z()),h[Kr]=e,e=q(Rs(),z()),h[Wr]=e,e=q(Ds(),z()),h[zr]=e,Hn(0),Yi(0),g=o(ji,k),c=o(ji,k),Qs(),y||(0===zn()?$s(An()):(function e(t,r,i){var s;var n;var a;var o;var u;var l;var c;var h;var f;var p;if((h=i+1-r)<=1)return 0;a=t[r];u=t[i];n=Un(a,u);n||(f=t[r],t[r]=t[i],t[i]=f,p=a,a=u,u=p);if(h<=2)return 0;p=r+i>>1;o=t[p];n=Un(a,o);n?(n=Un(o,u))||(f=t[i],t[i]=t[p],t[p]=f,o=u):(f=t[r],t[r]=t[p],t[p]=f,o=a);if(h<=3)return 0;l=r;c=i;s=!0;for(;s;){for(n=!0;n;)n=l<=--c&&(f=t[c],Un(o,f));for(n=!0;n;)n=++l<=c&&Un(f=t[l],o);(s=l<=c)&&(f=t[l],t[l]=t[c],t[c]=f)}e(t,r,c);e(t,l,i)}(g,0,zn()-1),$s(dn(g[0])),H()<Pn()&&$s(Pn()),Qo(0),Yo(q(Zo(),z())-1),Ns()))}function ra(e){if(!(ln(e)<=0)){var t,r=(e=>{for(var t=I(e),r=0;r<Xi()&&I(c[r])<t;)++r;for(;r<Xi()&&I(c[r])===t&&Un(c[r],e);)++r;return r})(e),i=r;if(Ta(1)){for(t=Xi()-1;!(t<i);)c[t+1]=c[t],--t;c[i]=e,Yi(Xi()+1)}}}function ia(e){return sa(e)||0!=(Da(e)&mt)}function sa(e){return 0!=(4278190080&e)}function na(e){return 0===e||sa(e)||0<=(t=e)&&t<k&&ia(e);var t}function aa(e){return 0!=(Da(e)&St)}function oa(){return h[ei]}function ua(){return h[ti]}function la(){return h[ri]}function ca(e){return A(e,Jt)}function ha(e){return A(e,Qt)}function fa(e,t){_(e,$t,t)}function pa(e){return A(e,ur)}function da(e){return A(e,lr)}function ma(e,t,r,i){var s,n,a,o,u=Ji();if(y)return 0;for(Os(u,e[0]),As(u,e[1]),Ps(u,t[0]),Cs(u,t[1]),ks(u,r[0]),ys(u,r[1]),o=s=((e,t)=>{var r,i,s;return r=i=s=(e=>{var t,r,i;return r=Fs(e),i=ws(e),t=Ss(e),0<=(r=i-r)*(t=t-i)?e:(O(yr,1),(i=r)<0&&(i=0-i),(t=t-r)<0&&(t=0-t),Ys(e,i/t))})(e),t&&(i=Su(e)),s<i&&(s=i),e!==r&&t&&(i=Su(r)),s=s<i?i:s})(u,i),n=u;n<=s;n+=6)if(o<(a=function e(t){var r;var i;i=ku(t);if(i!==t)return r=e(t),y||(i=e(i),y)?0:i<=r?r:i;return t}(n))&&(o=a),y)return 0;return N(o,6)}function va(e){return(Vi||ea())&&Vi(e)}function ga(e,t,r,i,s,n,a){var o,u,l,c,h;if(t.isNil)c=0,l=null;else{if(V(t)!==b.classBitmap())return b.primitiveFail();c=f(t),l=t.wordsAsInt32Array()}return"number"==typeof e||!b.isPointers(e)||f(e)<5||V(t=b.fetchPointerofObject(0,e))!==b.classBitmap()?b.primitiveFail():(t=f(t),u=b.fetchIntegerofObject(1,e),o=b.fetchIntegerofObject(2,e),e=b.fetchIntegerofObject(3,e),b.failed()?null:!(0<=u&&0<=o)||32!==e&&8!==e&&16!==e&&1!==e&&2!==e&&4!==e||0!==c&&c!==q(1,e)||(h=N(32,e),h=N(u+(h-1),h),t!==h*o)?b.primitiveFail():(c=Qi(c,l),y?null:(_(c,ue,u),_(c,ne,o),_(c,se,e),_(c,ae,h),_(c,oe,t),_(c,me,r),Ra(c,a),ya(c,i,s,n,u,o),c)))}function ba(e){var t=Ba(e);return t>f(Mi)||(t=b.fetchPointerofObject(t,Mi),f(t=b.fetchPointerofObject(0,t))!==A(e,oe))?null:t.wordsAsInt32Array()}function ka(e,t,r,i,s,n,a){var o,u,l,c,h;if(i!==s||0!==n&&0!==a){if(e=6*e,r=r?(o=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[0+e],c=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[1+e],u=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[2+e],h=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[3+e],l=(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[4+e],(t.int16Array||(t.int16Array=new Int16Array(t.buffer,t.byteOffset)))[5+e]):(o=0|t[0+e],c=0|t[1+e],u=0|t[2+e],h=0|t[3+e],l=0|t[4+e],0|t[5+e]),o===u&&c===h||u===l&&h===r)return o===l&&c===r?void 0:(P()[0]=o,P()[1]=c,w()[0]=l,w()[1]=r,Eu(2),Ca(n,P(),w(),a,i,s));P()[0]=o,P()[1]=c,w()[0]=u,w()[1]=h,C()[0]=l,C()[1]=r,Eu(3),t=ma(P(),w(),C(),0!==n&&0!==a),y||wa(n,a,i,s,t)}}function Sa(e){var t=h[$r];return f(e)<R?null:(pn(t,b.fetchIntegerofObject(Y,e)),mn(t,b.fetchIntegerofObject(Z,e)),gn(t,b.fetchIntegerofObject(J,e)),cn(t,b.fetchIntegerofObject(X,e)),t)}function ya(e,t,r,i,s,n){var a,o,u,l;r[0]=r[0]+t[0],r[1]=r[1]+t[1],i[0]=i[0]+t[0],i[1]=i[1]+t[1],xu(t),xu(r),xu(i),o=0<(u=(o=r[0]-t[0])*o+(r=r[1]-t[1])*r)?(a=o*s*65536/u|0,r*s*65536/u|0):a=0,i=0<(u=(r=i[0]-t[0])*r+(s=i[1]-t[1])*s)?(l=r*n*65536/u|0,s*n*65536/u|0):l=0,_(e,zt,t[0]),_(e,Ht,t[1]),_(e,Dt,a),_(e,Ut,o),_(e,Gt,l),_(e,Wt,i)}function Ia(e){var t,r,i,s,n;if(b.isArray(e)){for(Mi=e,s=0;s<=f(Mi)-1;s++){if("number"==typeof(n=b.fetchPointerofObject(s,Mi)))return;if(!b.isPointers(n))return;if(f(n)<5)return;if(V(t=b.fetchPointerofObject(0,n))!==b.classBitmap())return;if(t=f(t),i=b.fetchIntegerofObject(1,n),r=b.fetchIntegerofObject(2,n),n=b.fetchIntegerofObject(3,n),b.failed())return;if(!(0<=i&&0<=r))return;if(n=N(32,n),t!==N(i+(n-1),n)*r)return}return 1}}function Oa(e,t,r,i,s,n){var a,o,r=t[1]<=r[1]?(o=t,a=r,1):(o=r,a=t,-1);pn(e,o[0]),mn(e,o[1]-i),gn(e,en()),un(e,s),hn(e,n),t=a[0],_(e,Jt,t),o=a[1]-i,_(e,Qt,o),_(e,cr,r)}function Fa(e,t,r,i){for(var s,n,a,o,u,l,c,h,f,p=w()[0]-P()[0]>>1,d=w()[1]-P()[1]>>1,m=w()[0]+P()[0]>>1,v=w()[1]+P()[1]>>1,g=0;g<=15;g++){if(n=p,a=d,o=m,u=v,f=h=c=l=void 0,l=Ls()[2*(s=g)+0]*n+o|0,h=Ms()[2*s+0]*a+u|0,P()[0]=l,P()[1]=h,c=Ls()[2*s+2]*n+o|0,f=Ms()[2*s+2]*a+u|0,C()[0]=c,C()[1]=f,n=Ls()[2*s+1]*n+o|0,o=Ms()[2*s+1]*a+u|0,n=2*n-(l+c>>1),o=2*o-(h+f>>1),w()[0]=n,w()[1]=o,Eu(3),s=ma(P(),w(),C(),0!==e&&0!==t),y)return;if(wa(e,t,r,i,s),y)return}}function F(e,t){var r;return V(t)===b.classPoint()&&("number"==typeof(r=b.fetchPointerofObject(0,t))||r.isFloat)&&(e[0]="number"==typeof r?r:0|b.floatValueOf(r),"number"==typeof(r=b.fetchPointerofObject(1,t))||r.isFloat)?void(e[1]="number"==typeof r?r:0|b.floatValueOf(r)):b.primitiveFail()}function Aa(){var e,t,r;return 2!==b.methodArgumentCount()?d:0!==(r=No(b.stackValue(2)))?r:(t=b.stackObjectValue(0),e=b.stackObjectValue(1),b.failed()?p:0!==(r=_a(b.fetchPointerofObject(j,Li)))?r:va(b.fetchPointerofObject(n,Li))?Ia(b.fetchPointerofObject(a,Li))?f(e)<R?Re:f(t)<Q?ze:(r=nu())===xt||r===Et||r===Ct?it:0:He:je)}function _a(e){return V(e)!==b.classBitmap()?Be:(U=e.words,e=f(e)-1,h[vi]=e,0)}function Pa(e,t,r){if(e.isNil)return!1;if("number"==typeof e)return b.primitiveFail();if(f(e)!==r)return b.primitiveFail();if(b.isWords(e)){var i,s,n=t,a=r;for(s=e.wordsAsFloat32Array(),i=0;i<=a-1;i++)n[i]=s[i]}else((e,t,r)=>{for(var i,s=0;s<=r-1;s++){if("number"!=typeof(i=b.fetchPointerofObject(s,e))&&!i.isFloat)return b.primitiveFail();t[s]="number"==typeof i?i:b.floatValueOf(i)}})(e,t,r);return!0}function wa(e,t,r,i,s){for(var n,a,o,u,l,c,h,f,p=0===e||0===t?(a=!1,0):(a=!0,e>>1),d=6*s;0<d;){if(n=a?(f=void 0,ts(Ce)?(k=(f=k)+Ce,Ua(f,yt),Ra(f,0),qa(f,Ce),f):0):(f=void 0,ts(ie)?(k=(f=k)+ie,Ua(f,ct),Ra(f,0),qa(f,ie),f):0),y)return;o=n,l=r,c=i,h=p,Ss(u=d)>=Fs(u)?(pn(o,Is(u)),mn(o,Fs(u)-h),fs(o,_s(u)),ps(o,ws(u)-h),as(o,bs(u)),us(o,Ss(u)-h)):(pn(o,bs(u)),mn(o,Ss(u)-h),fs(o,_s(u)),ps(o,ws(u)-h),as(o,Is(u)),us(o,Fs(u)-h)),gn(o,en()),un(o,l),hn(o,c),a&&(_(n,we,t),zu(n,e),_(n,Pe,e)),d-=6}Vu()}function Ca(e,t,r,i,s,n){var a,o=0===e||0===i?(a=ts(Zt)?(k=(a=k)+Zt,Ua(a,vt),Ra(a,0),qa(a,Zt),a):0,0):(a=ts(ar)?(k=(o=k)+ar,Ua(o,It),Ra(o,0),qa(o,ar),o):0,e>>1);if(y)return 0;Oa(a,t,r,o,s,n),aa(a)&&(_(a,nr,i),Qu(a,e),_(a,sr,e))}function xa(e){return"number"==typeof e?Ye:b.isWords(e)?f(e)<ni?Qe:($u(e),h[ii]!==si?Xe:Mu()!==f(e)?$e:Va()!==Qr?Je:(ji=o(h,Va()),g=o(ji,Na()),c=o(g,zn()),Qr+Na()+zn()+Xi()>Mu()?et:0)):Ze}function Ea(e){0===strcmp(e,Ci)&&(xi=Vi=0)}function Ta(e){return!(Qr+k+zn()+Xi()+e>Ru()&&(pu(qt),1))}function La(){return 0!==h[ai]}function Ma(e){h[ai]=e}function A(e,t){return ji[e+t]}function _(e,t,r){return ji[e+t]=r}function Va(){return h[oi]}function Na(){return h[ui]}function ja(e){h[ui]=e}function Ba(e){return A(e,ot)}function Ra(e,t){_(e,ot,t)}function qa(e,t){_(e,ut,t)}function Da(e){return A(e,lt)&kt}function Ua(e,t){return _(e,lt,t)}function P(){return o(h,li)}function w(){return o(h,ci)}function C(){return o(h,hi)}function Ga(){return o(h,fi)}function Wa(){Gn()>=zn()&&0===Xi()&&T(_t),H()>=An()&&T(_t)}function za(){var e;return 0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(0)))?b.primitiveFailFor(e):(T(_t),void L())}function Ha(){var e;return m&&(v=b.ioMicroMSecs()),1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),xt))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),b.failed()?b.primitiveFailFor(p):(e=Sa(e))?Ta(1)?(0<ln(e)&&ra(e),y?b.primitiveFailFor(u):(T(Ft),L(),b.pop(1),void(m&&(O(xr,1),O(Si,b.ioMicroMSecs()-v))))):b.primitiveFailFor(et):b.primitiveFailFor(Re))}function Ka(){var e,t,r,i,s,n;return 5!==b.methodArgumentCount()?b.primitiveFailFor(d):(i=b.positive32BitValueOf(b.stackValue(0)),t=b.positive32BitValueOf(b.stackValue(1)),n=b.stackObjectValue(2),e=b.stackObjectValue(3),s=b.stackObjectValue(4),b.failed()?b.primitiveFailFor(p):0!==(r=x(b.stackValue(5),l))?b.primitiveFailFor(r):na(t)&&na(i)?(F(P(),s),F(w(),n),F(C(),e),b.failed()?b.primitiveFailFor(p):(Eu(3),Ta((r=ma(P(),w(),C(),!1))*ie),y||(t=M(t),i=M(i)),y||wa(0,0,t,i,r),y?(Vu(),b.primitiveFailFor(u)):b.failed()?b.primitiveFailFor(We):(L(),void b.pop(5)))):b.primitiveFailFor(rt))}function Xa(){var e,t,r,i,s,n,a;if(5!==b.methodArgumentCount())return b.primitiveFailFor(d);if(r=b.positive32BitValueOf(b.stackValue(0)),i=b.stackIntegerValue(1),e=b.positive32BitValueOf(b.stackValue(2)),s=b.stackIntegerValue(3),n=b.stackObjectValue(4),b.failed())return b.primitiveFailFor(p);if(0!==(t=x(b.stackValue(5),l)))return b.primitiveFailFor(t);if(t=f(n),b.isWords(n)){if(a=!1,t!==3*s&&t!==6*s)return b.primitiveFailFor(p)}else{if(!b.isArray(n))return b.primitiveFailFor(p);if(t!==3*s)return b.primitiveFailFor(p);a=!0}return Ta((0===i||0===r?Zt:ar)*s)?na(r)&&na(e)?(r=M(r),e=M(e),y?b.primitiveFailFor(u):0!==r&&0!==i||0!==e?(0!==i&&(i=Tu(i))<1&&(i=1),a?((e,t,r,i,s)=>{for(var n,a,o,u,l,c,h=0;h<=t-1;h++){if(n=b.fetchPointerofObject(3*h,e),F(P(),n),n=b.fetchPointerofObject(3*h+1,e),F(w(),n),n=b.fetchPointerofObject(3*h+2,e),F(C(),n),b.failed())return;if(Eu(3),n=P()[0],u=P()[1],a=w()[0],l=w()[1],o=C()[0],c=C()[1],n===u&&a===l||a===o&&l===c)Ca(i,P(),C(),s,r,0);else{if(n=ma(P(),w(),C(),0!==i&&0!==s),y)return;wa(i,s,r,0,n)}if(y)return}})(n,s,e,i,r):((e,t,r,i,s,n)=>{for(var a=1;a<=t;a++)if(ka(a-1,e,n,r,0,i,s),y)return})(n.wordsAsInt32Array(),s,e,i,r,3*s===t),y?b.primitiveFailFor(u):b.failed()?b.primitiveFailFor(We):(Ma(1),L(),void b.pop(5))):b.pop(5)):b.primitiveFailFor(rt):b.primitiveFailFor(et)}function Ya(){var e,t,r,i,s,n,a,o;return 7!==b.methodArgumentCount()?b.primitiveFailFor(d):(o=b.stackIntegerValue(0))<=0||(s=b.stackObjectValue(1),t=b.stackObjectValue(2),n=b.stackObjectValue(3),a=b.booleanValueOf(b.stackValue(4)),e=b.stackObjectValue(5),i=b.stackObjectValue(6),b.failed())?b.primitiveFailFor(p):0!==(r=x(b.stackValue(7),l))?b.primitiveFailFor(r):(F(P(),n),F(w(),t),F(C(),s),b.failed()?b.primitiveFailFor(Ne):(r=ga(i,e,a?1:0,P(),w(),C(),o-1),y?b.primitiveFailFor(u):b.failed()?b.primitiveFailFor(We):(L(),void b.popthenPush(8,b.positive32BitIntegerFor(r)))))}function Za(){var e,t,r,i,s,n,a,o;return 7!==b.methodArgumentCount()?b.primitiveFailFor(d):(e=b.stackObjectValue(0),r=b.stackObjectValue(1),i=b.stackObjectValue(2),o=b.stackObjectValue(3),t=b.stackObjectValue(4),s=b.stackIntegerValue(5),n=b.stackObjectValue(6),b.failed()?b.primitiveFailFor(p):0!==(a=x(b.stackValue(7),l))?b.primitiveFailFor(a):Es(n,s,t,o,i,r,e)?Ta(Math.max(ie,Zt)*s)?(a=f(n)===3*s,((e,t,r,i,s,n,a,o)=>{var u,l,c,h,f,p,d,m,v,g,b,k,S;if(0!==t)for(c=v=k=p=-1,h=g=S=d=0,u=l=m=b=f=1;u<=t;u++){if(--l<=0&&(l=Go(++c,r),0!==(h=Wo(c,r)))&&(h=M(h=a[h-1]),y))return;if(ka(u-1,e,o,h,g=--m<=0&&(m=Go(++v,i),0!==(g=Wo(v,i)))?M(g=a[g-1]):g,S=--b<=0&&(b=Go(++k,s),0!==(S=Wo(k,s)))?Tu(S):S,d=--f<=0&&(f=Go(++p,n),0!==(d=Wo(p,n)))?a[d-1]:d),y)return}})(n.wordsAsInt32Array(),s,t.wordsAsInt32Array(),o.wordsAsInt32Array(),i.wordsAsInt32Array(),r.wordsAsInt32Array(),e.wordsAsInt32Array(),a),y?b.primitiveFailFor(u):b.failed()?b.primitiveFailFor(We):(Ma(1),L(),void b.pop(7))):b.primitiveFailFor(et):b.primitiveFailFor(Ge))}function Ja(){var e,t,r,i,s,n;return 5!==b.methodArgumentCount()?b.primitiveFailFor(d):(n=b.booleanValueOf(b.stackValue(0)),i=b.stackValue(1),r=b.stackValue(2),t=b.stackValue(3),s=b.stackValue(4),b.failed()?b.primitiveFailFor(p):0!==(e=x(b.stackValue(5),l))?b.primitiveFailFor(e):(F(P(),t),F(w(),r),F(C(),i),b.failed()?b.primitiveFailFor(Ne):(e=s,t=P(),r=w(),i=C(),s=n,s=V(e)!==b.classBitmap()?b.primitiveFail():(n=f(e),e=es(e.wordsAsInt32Array(),n,s),y?null:(ya(e,t,r,i,n,n),e)),y?b.primitiveFailFor(u):b.failed()?b.primitiveFailFor(We):(L(),void b.popthenPush(6,b.positive32BitIntegerFor(s))))))}function Qa(){var e,t,r,i,s;return 4!==b.methodArgumentCount()?b.primitiveFailFor(d):(i=b.positive32BitValueOf(b.stackValue(0)),r=b.positive32BitValueOf(b.stackValue(1)),e=b.stackObjectValue(2),s=b.stackObjectValue(3),b.failed()?b.primitiveFailFor(p):0!==(t=x(b.stackValue(4),l))?b.primitiveFailFor(t):na(r)&&na(i)?(F(P(),s),F(w(),e),b.failed()?b.primitiveFailFor(Ne):(Eu(2),r=M(r),i=M(i),y||(Ca(0,P(),w(),0,r,i),y)?b.primitiveFailFor(u):b.failed()?b.primitiveFailFor(We):(L(),void b.pop(4)))):b.primitiveFailFor(rt))}function $a(){var e,t,r,i,s,n;return 5!==b.methodArgumentCount()?b.primitiveFailFor(d):(e=b.positive32BitValueOf(b.stackValue(0)),t=b.stackIntegerValue(1),s=b.positive32BitValueOf(b.stackValue(2)),r=b.stackObjectValue(3),n=b.stackObjectValue(4),b.failed()?b.primitiveFailFor(p):0!==(i=x(b.stackValue(5),l))?b.primitiveFailFor(i):na(e)&&na(s)?(s=M(s),e=M(e),y?b.primitiveFailFor(u):0===s&&(0===e||t<=0)?b.pop(5):Ta(16*ie)?(t=0<t&&0!==e?Tu(t):0,F(P(),n),F(w(),r),b.failed()?b.primitiveFailFor(Ne):(Fa(t,e,0,s),y?(Vu(),b.primitiveFailFor(u)):b.failed()?b.primitiveFailFor(We):(Ma(1),L(),void b.pop(5)))):b.primitiveFailFor(et)):b.primitiveFailFor(rt))}function eo(){var e,t,r,i,s,n,a;if(5!==b.methodArgumentCount())return b.primitiveFailFor(d);if(r=b.positive32BitValueOf(b.stackValue(0)),i=b.stackIntegerValue(1),e=b.positive32BitValueOf(b.stackValue(2)),s=b.stackIntegerValue(3),n=b.stackObjectValue(4),b.failed())return b.primitiveFailFor(p);if(0!==(t=x(b.stackValue(5),l)))return b.primitiveFailFor(t);if(t=f(n),b.isWords(n)){if(a=!1,t!==s&&2*s!==t)return b.primitiveFailFor(p)}else{if(!b.isArray(n))return b.primitiveFailFor(p);if(t!==s)return b.primitiveFailFor(p);a=!0}return Ta((0===i||0===r?Zt:ar)*s)?na(r)&&na(e)?(r=M(r),e=M(e),y?b.primitiveFailFor(u):0!==r&&0!==i||0!==e?(0!==i&&(i=Tu(i)),a?((e,t,r,i,s)=>{var n,a,o,u,l;if(F(P(),b.fetchPointerofObject(0,e)),!b.failed())for(a=P()[0],u=P()[1],n=1;n<=t-1;n++){if(F(P(),b.fetchPointerofObject(n,e)),b.failed())return;if(o=P()[0],l=P()[1],P()[0]=a,P()[1]=u,w()[0]=o,w()[1]=l,Eu(2),Ca(i,P(),w(),s,r,0),y)return;a=o,u=l}})(n,s,e,i,r):((e,t,r,i,s,n)=>{for(var a,o,u,l=n?(a=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[0],(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[1]):(a=0|e[0],0|e[1]),c=1;c<=t-1;c++){if(u=n?(o=(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*c],(e.int16Array||(e.int16Array=new Int16Array(e.buffer,e.byteOffset)))[2*c+1]):(o=0|e[2*c],0|e[2*c+1]),P()[0]=a,P()[1]=l,w()[0]=o,w()[1]=u,Eu(2),Ca(i,P(),w(),s,r,0),y)return;a=o,l=u}})(n.wordsAsInt32Array(),s,e,i,r,s===t),y?b.primitiveFailFor(u):b.failed()?b.primitiveFailFor(We):(Ma(1),L(),void b.pop(5))):b.pop(5)):b.primitiveFailFor(rt):b.primitiveFail()}function to(){var e,t,r,i,s,n;return 5!==b.methodArgumentCount()?b.primitiveFailFor(d):(r=b.positive32BitValueOf(b.stackValue(0)),e=b.stackIntegerValue(1),t=b.positive32BitValueOf(b.stackValue(2)),n=b.stackObjectValue(3),s=b.stackObjectValue(4),b.failed()?b.primitiveFailFor(p):0!==(i=x(b.stackValue(5),l))?b.primitiveFailFor(i):na(r)&&na(t)?(r=M(r),t=M(t),y?b.primitiveFailFor(u):0!==t||0!==r&&0!==e?Ta(4*Zt)?(e=0<e&&0!==r?Tu(e):0,F(P(),s),F(C(),n),b.failed()?b.primitiveFailFor(Ne):(w()[0]=C()[0],w()[1]=P()[1],Ga()[0]=P()[0],Ga()[1]=C()[1],Eu(4),i=r,s=0,n=t,Ca(r=e,P(),w(),i,s,n),Ca(r,w(),C(),i,s,n),Ca(r,C(),Ga(),i,s,n),Ca(r,Ga(),P(),i,s,n),b.failed()?b.primitiveFailFor(We):(Ma(1),L(),void b.pop(5)))):b.primitiveFailFor(et):b.pop(5)):b.primitiveFailFor(rt))}function ro(){var e;return m&&(v=b.ioMicroMSecs()),1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),Ct))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),b.failed()?b.primitiveFailFor(p):(e=Sa(e))?(0===ln(e)?Bo():(qo(),Ki(S()+1)),T(wt),L(),b.pop(1),void(m&&(O(Er,1),O(yi,b.ioMicroMSecs()-v)))):b.primitiveFailFor(Re))}function io(){var e,t,r,i,s,n,a;if(2!==b.methodArgumentCount())return b.primitiveFailFor(d);if(e=b.stackValue(0),0!==(i=xa(t=b.stackValue(1))))return b.primitiveFailFor(i);if(V(t)!==V(e))return b.primitiveFailFor(Be);if((t=f(e)-f(t))<0)return b.primitiveFailFor(Ke);for(n=h,r=e.wordsAsInt32Array(),s=0,a=Ru()-1;s<=a;s++)r[s]=n[s];for(r[Or]=Ru()+t,r[pi]=Mu()+t,n=o(n,Ru()),r=o(r,Ru()+t),s=0,a=Mu()-Ru()-1;s<=a;s++)r[s]=n[s];if(0!==(i=xa(e)))return b.primitiveFailFor(i);b.pop(2)}function so(){var e;return m&&(v=b.ioMicroMSecs()),0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(0),At))||0!==(e=_a(b.fetchPointerofObject(j,Li)))?b.primitiveFailFor(e):va(b.fetchPointerofObject(n,Li))?((H()&Ui())===Ui()&&(nn(H()),Wa()),Rn()||(Ki(0),$s(H()+1),T(wt)),L(),void(m&&(O(Tr,1),O(Ii,b.ioMicroMSecs()-v)))):b.primitiveFailFor(je)}function no(){var e=m,t=b.stackObjectValue(0);t=b.booleanValueOf(t),b.failed()||(m=t,b.pop(2),b.pushBool(e))}function ao(){var e;return m&&(v=b.ioMicroMSecs()),0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(0)))?b.primitiveFailFor(e):(e=Rn(),L(),b.pop(1),b.pushBool(e),void(m&&(O(Lr,1),O(Oi,b.ioMicroMSecs()-v))))}function oo(){var e;return 0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(0)))?b.primitiveFailFor(e):(b.pop(1),void b.pushInteger(W()))}function uo(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(1)))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),!b.failed()&&b.isWords(e)&&4<=f(e)?((e=e.wordsAsInt32Array())[0]=e[0]+h[yr],e[1]=e[1]+h[kr],e[2]=e[2]+h[Ir],e[3]=e[3]+h[Sr],void b.pop(1)):b.primitiveFailFor(p))}function lo(){var e,t;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(t=No(b.stackValue(1)))?b.primitiveFailFor(t):(t=b.stackObjectValue(0),!b.failed()&&b.isPointers(t)&&2<=f(t)?(b.pushRemappableOop(t),e=b.makePointwithxValueyValue(Gs(),zs()),b.storePointerofObjectwithValue(0,b.topRemappableOop(),e),e=b.makePointwithxValueyValue(Rs(),Ds()),t=b.popRemappableOop(),b.storePointerofObjectwithValue(1,t,e),void b.popthenPush(2,t)):b.primitiveFailFor(p))}function co(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(1)))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),!b.failed()&&b.isWords(e)&&9<=f(e)?((e=e.wordsAsInt32Array())[0]=e[0]+h[Mr],e[1]=e[1]+h[Lr],e[2]=e[2]+h[Br],e[3]=e[3]+h[xr],e[4]=e[4]+h[jr],e[5]=e[5]+h[Vr],e[6]=e[6]+h[Tr],e[7]=e[7]+h[Nr],e[8]=e[8]+h[Er],void b.pop(1)):b.primitiveFailFor(p))}function ho(){var e;return 0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(0)))?b.primitiveFailFor(e):(b.pop(1),void b.pushInteger(en()))}function fo(){var e;return 0!==b.methodArgumentCount()?b.primitiveFailFor(d):"number"==typeof(Li=b.stackValue(0))?b.primitiveFailFor(qe):b.isPointers(Li)?f(Li)<i?b.primitiveFailFor(Ue):0!==(e=xa(b.fetchPointerofObject(B,Li)))?b.primitiveFailFor(e):(b.pop(1),void b.pushInteger(du())):b.primitiveFailFor(De)}function po(){var e;return 0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(0)))?b.primitiveFailFor(e):(e=b.makePointwithxValueyValue(rn(),sn()),void b.popthenPush(1,e))}function mo(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(1)))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),!b.failed()&&b.isWords(e)&&9<=f(e)?((e=e.wordsAsInt32Array())[0]=e[0]+h[Fi],e[1]=e[1]+h[Oi],e[2]=e[2]+h[wi],e[3]=e[3]+h[Si],e[4]=e[4]+h[Pi],e[5]=e[5]+h[Ai],e[6]=e[6]+h[Ii],e[7]=e[7]+h[_i],e[8]=e[8]+h[yi],void b.pop(1)):b.primitiveFailFor(p))}function vo(){var e,t;return 1!==b.methodArgumentCount()?b.primitiveFail():(e=b.stackObjectValue(0),b.failed()?null:!b.isWords(e)||(t=f(e))<ni?b.primitiveFail():($u(e),ji=o(h,Qr),h[ii]=si,h[pi]=t,qu(t),T(l),h[oi]=Qr,ja(4),Ua(0,dt),qa(0,4),Ra(0,0),Wn(0),Hn(0),Ki(0),Yi(0),mu(0),Ma(0),Ws(0),qs(0),Hs(0),Us(0),tn(0),h[Fi]=0,h[Oi]=0,h[wi]=0,h[Si]=0,h[Pi]=0,h[Ai]=0,h[Ii]=0,h[_i]=0,h[yi]=0,h[Mr]=0,h[Lr]=0,h[Br]=0,h[xr]=0,h[jr]=0,h[Vr]=0,h[Tr]=0,h[Nr]=0,h[Er]=0,h[yr]=0,h[kr]=0,h[Ir]=0,h[Sr]=0,(t=fn())[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,Qn(t[5]=0),(t=Ks())[0]=1,t[1]=0,t[2]=1,t[3]=0,t[4]=1,t[5]=0,t[6]=1,Zn(t[7]=0),b.pop(2),void b.push(e)))}function go(){var e;return m&&(v=b.ioMicroMSecs()),0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(0),l))||0!==(e=_a(b.fetchPointerofObject(j,Li)))?b.primitiveFailFor(e):(ta(),y?b.primitiveFailFor(u):(T(Ft),b.failed()||L(),void(m&&(O(Mr,1),O(Fi,b.ioMicroMSecs()-v)))))}function bo(){var e;if(m&&(v=b.ioMicroMSecs()),2!==b.methodArgumentCount())return b.primitiveFailFor(d);if(0!==(o=x(b.stackValue(2),Et)))return b.primitiveFailFor(o);if(0!==(o=_a(b.fetchPointerofObject(j,Li))))return b.primitiveFailFor(o);if(o=b.stackObjectValue(0),e=b.stackObjectValue(1),b.failed()||V(e)!==b.classBitmap())return b.primitiveFailFor(p);if(f(o)<Q)return b.primitiveFailFor(ze);if(u=b.fetchIntegerofObject($,o),Ba(oa())!==u)return b.primitiveFailFor(rt);if(u=b.fetchIntegerofObject(te,o),ua()!==u)return b.primitiveFailFor(rt);if(u=b.fetchIntegerofObject(ee,o),la()!==u)return b.primitiveFailFor(rt);if(f(e)<la()-ua())return b.primitiveFailFor(p);if(b.failed())return null;var t,r,i,s,n,a=e.wordsAsInt32Array(),o=ua(),u=la(),l=o,c=u,h=-1;if(1===W())for(;l<c;)s=0|a[++h],U[l]=s,++l;else for(r=G(),i=Ri(),t=z();l<c;)n=D(l,t),s=D((s=0|a[++h])&r,i),U[n]=U[n]+s,++l;c>Xo()&&Yo(c),c>Ho()&&Ko(c),T(Pt),L(),b.pop(2),m&&(O(Vr,1),O(Ai,b.ioMicroMSecs()-v))}function ko(){var e;return 0!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(0)))?b.primitiveFailFor(e):(e=La(),L(),b.pop(1),void b.pushBool(e))}function So(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=No(b.stackValue(1)))?b.primitiveFailFor(e):(e=b.booleanValueOf(b.stackValue(0)),b.failed()?b.primitiveFailFor(p):(Ma(!0===e?1:0),L(),void b.pop(1)))}function yo(){var e,t,r;return m&&(v=b.ioMicroMSecs()),1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=b.stackValue(1),t=wt,r=_t,t=0===(e=No(e))?nu()!==t&&nu()!==r?(mu(Nt),it):0:e)?b.primitiveFailFor(t):(r=b.stackObjectValue(0),b.failed()?b.primitiveFailFor(p):(e=!1,nu()!==_t&&((e=jn())?(vu(c[S()],r),T(Ct)):T(Ft)),b.failed()?null:(L(),b.pop(2),b.pushBool(!e),void(m&&(O(Nr,1),O(_i,b.ioMicroMSecs()-v))))))}function Io(){var e,t;return m&&(v=b.ioMicroMSecs()),1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),Pt))||0!==(e=_a(b.fetchPointerofObject(j,Li)))?b.primitiveFailFor(e):Ia(b.fetchPointerofObject(a,Li))?(0!==js()&&(0==(H()&Ui())&&Ns(),Bs(0)),e=b.stackObjectValue(0),t=Nn(),y?b.primitiveFailFor(u):(t&&gu(e),b.failed()?b.primitiveFailFor(rt):(t?T(Et):(Vu(),Ko(0),T(At)),L(),b.pop(2),b.pushBool(!t),void(m&&(O(jr,1),O(Pi,b.ioMicroMSecs()-v)))))):b.primitiveFailFor(He)}function Oo(){var e,t;return m&&(v=b.ioMicroMSecs()),1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),Ft))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),(t=Vn())&&(vu(g[Gn()],e),Wn(Gn()+1)),b.failed()?b.primitiveFailFor(tt):(t?T(xt):(T(Pt),Bs(1),Ki(0),Vu()),L(),b.pop(2),b.pushBool(!t),void(m&&(O(Br,1),O(wi,b.ioMicroMSecs()-v)))))}function Fo(){var e,t,r,i,s,n,a;return 6!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(a=x(b.stackValue(6),l))?b.primitiveFailFor(a):(a=b.positive32BitValueOf(b.stackValue(0)),n=b.positive32BitValueOf(b.stackValue(1)),s=b.stackIntegerValue(2),i=b.stackIntegerValue(3),r=b.stackIntegerValue(4),t=b.stackIntegerValue(5),b.failed()?b.primitiveFailFor(p):ts(Te)?na(n)&&na(a)?(k=(e=k)+Te,Ua(e,ft),qa(e,Te),Ra(e,t),pn(e,r),mn(e,i),gn(e,s),un(e,M(n)),hn(e,M(a)),y?b.primitiveFailFor(u):void(b.failed()||(L(),b.pop(6)))):b.primitiveFailFor(rt):b.primitiveFailFor(et))}function Ao(){var e,t,r;if(1!==b.methodArgumentCount())return b.primitiveFailFor(d);if(0!==(e=x(b.stackValue(1),l)))return b.primitiveFailFor(e);if(r=b.stackIntegerValue(0),b.failed())return b.primitiveFailFor(p);for(t=0;0===t;){if(!ts(Te))return b.primitiveFailFor(et);k=(t=k)+Le,Ua(t,dt),qa(t,Le),Ra(t,r)}b.failed()||(L(),b.pop(2),b.pushInteger(t))}function _o(){var e;return 0!==(e=Aa())?b.primitiveFailFor(e):(Vo(),y?bu():((()=>{for(var e;!Rn();){if(m&&(v=b.ioMicroMSecs()),e=Vn(),m&&(O(Br,1),O(wi,b.ioMicroMSecs()-v)),y)return T(Ft);if(e)return T(xt),pu(Bt);if(Ki(0),Vu(),Bs(1),m&&(v=b.ioMicroMSecs()),0!==js()&&0==(H()&Ui())&&Ns(),Bs(0),e=Nn(),m&&(O(jr,1),O(Pi,b.ioMicroMSecs()-v)),y)return T(Pt);if(e)return T(Et),pu(jt);if(Vu(),Ko(0),m&&(v=b.ioMicroMSecs()),(H()&Ui())===Ui()&&(nn(H()),Wa()),m&&(O(Tr,1),O(Ii,b.ioMicroMSecs()-v)),y)return T(At);if(Rn())return;if(Ki(0),$s(H()+1),m&&(v=b.ioMicroMSecs()),e=jn(),m&&(O(Nr,1),O(_i,b.ioMicroMSecs()-v)),y)return T(wt);if(e)return T(Ct),pu(Vt)}})(),void bu()))}function Po(){var e;if(0!==(e=Aa()))return b.primitiveFailFor(e);Vo(),bu()}function wo(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),l))?b.primitiveFailFor(e):(e=b.stackIntegerValue(0),b.failed()?b.primitiveFailFor(p):(Do(e),L(),void b.pop(1)))}function Co(){var e=b.stackValue(0);if(!b.isBytes(e))return b.primitiveFail();if(256<=((t=e).bytes?t.bytes.length:t.words?4*t.words.length:0))return b.primitiveFail();e.bytes;var t=!1,e=e.bytesAsString();if(e!==Ci&&(Ci=e,t=!0),t&&!ea())return b.primitiveFail();b.pop(1)}function xo(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),l))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),!(!b.failed()&&b.isPointers(e)&&2<=f(e))||(F(P(),b.fetchPointerofObject(0,e)),F(w(),b.fetchPointerofObject(1,e)),b.failed())?b.primitiveFailFor(p):(Ws(P()[0]),Hs(P()[1]),qs(w()[0]),Us(w()[1]),L(),void b.pop(1)))}function Eo(){var e,t;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),l))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),b.failed()?b.primitiveFailFor(p):(e=e,t=Ks(),Zn(0),Pa(e,t,8)&&(Zn(1),t[1]=256*t[1],t[3]=256*t[3],t[5]=256*t[5],t[7]=256*t[7]),b.failed()?b.primitiveFailFor(We):(L(),void b.pop(1))))}function To(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),l))?b.primitiveFailFor(e):(e=b.stackIntegerValue(0),b.failed()?b.primitiveFailFor(p):(tn(e),L(),void b.pop(1)))}function Lo(){var e,t;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),l))?b.primitiveFailFor(e):(e=b.stackObjectValue(0),b.failed()||(e=e,Qn(0),t=Pa(e,e=fn(),6),b.failed()||t&&(Qn(1),e[2]=e[2]+rn(),e[5]=e[5]+sn()),b.failed())?b.primitiveFailFor(p):(L(),void b.pop(1)))}function Mo(){var e;return 1!==b.methodArgumentCount()?b.primitiveFailFor(d):0!==(e=x(b.stackValue(1),l))?b.primitiveFailFor(e):V(e=b.stackValue(0))!==b.classPoint()||(F(P(),e),b.failed())?b.primitiveFailFor(p):(e=P()[0],h[Dr]=e,e=P()[1],h[Ur]=e,L(),void b.pop(1))}function Vo(){var e,t=nu();if(t===l){if(ta(),y)return;t=Ft}if(t===Ft){if(m&&(v=b.ioMicroMSecs()),e=Vn(),m&&(O(Br,1),O(wi,b.ioMicroMSecs()-v)),y)return T(Ft);if(e)return T(xt),pu(Bt);Ki(0),Vu(),Bs(1),t=Pt}if(t===Pt){if(m&&(v=b.ioMicroMSecs()),0!==js()&&0==(H()&Ui())&&Ns(),Bs(0),e=Nn(),m&&(O(jr,1),O(Pi,b.ioMicroMSecs()-v)),y)return T(Pt);if(e)return T(Et),pu(jt);t=At,Vu(),Ko(0)}if(t===At){if(m&&(v=b.ioMicroMSecs()),(H()&Ui())===Ui()&&(nn(H()),Wa()),m&&(O(Tr,1),O(Ii,b.ioMicroMSecs()-v)),y)return T(At);if(Rn())return;t=wt,Ki(0),$s(H()+1)}if(t===wt)return m&&(v=b.ioMicroMSecs()),e=jn(),m&&(O(Nr,1),O(_i,b.ioMicroMSecs()-v)),y?T(wt):e?(T(Ct),pu(Vt)):void T(Ft)}function No(e){return b.failed()?Ve:"number"==typeof e?qe:b.isPointers(e)?f(e)<i?Ue:(Li=e,0!==(e=xa(b.fetchPointerofObject(B,e)))?e:(mu(0),k=Na(),y=!1,0)):De}function x(e,t){return 0!==(e=No(e))?e:nu()===t?0:(mu(Nt),it)}function jo(e){if(0!==s())for(;Cu()<=e;)if($n(Iu(),0===s()?-1:Ou()),0===s())return}function Bo(){var e=S();for(Yi(Xi()-1);e<Xi();)c[e]=c[e+1],++e}function Ro(e,t){for(var r=e;r<0;)r+=t;for(;t<=r;)r-=t;return r}function qo(){var e;if(0!==S()&&(e=I(t=c[S()]),!(I(c[S()-1])<=e))){for(var t,r=S(),i=e,s=r;0<s&&I(c[s-1])>i;)c[s]=c[s-1],--s;c[s]=t}}function Do(e){var t;4<=e&&(t=4),2<=e&&e<4&&(t=2),e=t=e<2?1:t,h[dr]=e,1===t&&(Wi(0),Bi(4294967295),Gi(0)),2===t&&(Wi(1),Bi(4244438268),Gi(1)),4===t&&(Wi(2),Bi(4042322160),Gi(3)),e=2*z(),h[fr]=e,t=z(),h[pr]=t}function Uo(e){return!1!=((b=e).majorVersion()==t)&&b.minorVersion()>=r}function Go(e,t){return(0|t[e])>>>16}function Wo(e,t){return 65535&(0|t[e])}function zo(e,t,r){rs()&&(su(0,e),eu(0,t),ru(0,r),3!==s())&&Ln(0,s()-3)&&(su(0,Pu()),eu(0,Ou()),ru(0,Au()),wu(e),Fu(t),_u(r))}function Ho(){return h[mi]}function Ko(e){h[mi]=e}function Xo(){return h[di]}function Yo(e){h[di]=e}function Zo(){return h[vi]}function Jo(){return h[gi]}function Qo(e){h[gi]=e}function E(e,t){return e*e+t*t}function $o(e){return ju(e+1)}function eu(e,t){return Bu(e+1,t)}function tu(e){return ju(e+2)}function ru(e,t){return Bu(e+2,t)}function iu(e){return ju(e)}function su(e,t){return Bu(e,t)}function nu(){return h[bi]}function T(e){return h[bi]=e}function au(e,t){var r,i,s,n,a,o,u,l,c;if(!aa(e)&&t>=os(e))return cn(e,0);a=I(e),o=dn(e),c=A(e,Oe),u=A(e,Fe),l=2*(c-a),c=a+ns(e)-2*c,s=2*(u-o),u=o+(r=os(e))-2*u,n=N(16777216,n=(n=2*(r=r-o))<2?2:n),i=l*(l=n),i+=(l=c*(c=((c=65535&l)*c>>>16)+c*(l=l>>>16&255)*2+(l*l<<16)>>>8)*2)>>1,s=s*n,s+=(n=u*c*2)>>1,cn(e,r),(u=hs(e))[ye]=256*a,u[Ie]=256*o,u[be]=i,u[ke]=s,u[ve]=l,u[ge]=n,(o=dn(e))!==t&&(lu(e,t),cn(e,r-(t-o)))}function ou(e,t){var r,i,s,n,a,o,u;if(!aa(e)&&t>=ha(e))return cn(e,0);if(u=ca(e)-I(e),r=ha(e)-dn(e),s=0<=u?(a=1,n=u,0):(a=-1,n=0-u,1-r),u=0==r?(o=u,s=0):n<r?(o=0,n):(o=N(n,r)*a,n-N(n,u=r)*u|0),cn(e,r),_(e,ur,a),_(e,lr,o),fa(e,s),_(e,tr,u),_(e,er,r),(s=dn(e))!==t){for(i=s;i<=t-1;i++)cu(e);cn(e,r-(t-s))}}function uu(e,t){for(var r=e[ye],i=e[Ie],s=e[be],n=e[ke],a=256*t;i<a&&0<=n;)r+=s+32768>>16,i+=n+32768>>16,s+=e[ve],n+=e[ge];return e[ye]=r,e[Ie]=i,e[be]=s,e[ke]=n,r>>8}function lu(e,t){pn(e,uu(hs(e),t))}function cu(e){var t,r=I(e)+da(e);0<(t=A(e,$t)+A(e,tr))&&(r+=pa(e),t-=A(e,er)),fa(e,t),pn(e,r)}function hu(e,t){var r=Gu(e),i=r>>1,s=A(e,Ae)+1,n=A(e,_e)+1;Du(e,s),Uu(e,n),i<=s&&on(e),0<=n&&an(e),n+i<0?uu(hs(e),t):hs(e)[ye]=256*ls(e),uu(Wu(e),t),Js(e,r)}function fu(e){var t,r,i,s,n,a,o=Hu(e)+1,u=Xu(e)+1;Ku(e,o),Yu(e,u),(r=(t=Zu(e))>>1)<=o&&on(e),0<=u&&an(e),i=I(e),cu(e),s=I(e),(o<=t||0<=u+r)&&(o=i,t=s,r=Hu(u=e),i=Xu(u),s=Zu(u),e=s>>1,n=Ju(u),a=pa(u),t-=o,r<s&&(a<0?n-=t:(n+=t,pn(u,o))),i+e===0&&(0<a?n-=da(u):(n+=da(u),pn(u,o))),0<i+e&&(a<0?(n+=t,pn(u,o)):n-=t),Qu(u,n))}function pu(e){mu(e),y=!0}function du(){return h[ki]}function mu(e){h[ki]=e}function vu(e,t){if(f(t)<R)return b.primitiveFail();b.storeIntegerofObjectwithValue(K,t,Ba(e)),b.storeIntegerofObjectwithValue(Y,t,I(e)),b.storeIntegerofObjectwithValue(Z,t,H()),b.storeIntegerofObjectwithValue(J,t,vn(e)),b.storeIntegerofObjectwithValue(X,t,ln(e)),h[$r]=e}function L(){ja(k)}function gu(e){var t=oa(),r=ua(),i=la();if(f(e)<Q)return b.primitiveFail();b.storeIntegerofObjectwithValue($,e,Ba(t)),b.storeIntegerofObjectwithValue(te,e,r),b.storeIntegerofObjectwithValue(ee,e,i),b.storeIntegerofObjectwithValue(re,e,H())}function bu(){if(b.failed())return null;var e,t,r;y&&(e=b.stackObjectValue(1),t=b.stackObjectValue(0),(r=du())===Bt&&(vu(g[Gn()],e),Wn(Gn()+1)),r===jt&&gu(t),r===Vt)&&vu(c[S()],e),L(),b.pop(3),b.pushInteger(du())}function ku(e){var t=Fs(e),r=Ss(e);return r===t?e:255<(r=(r=r-t)<0?0-r:r)?(O(kr,1),Zs(e)):(t=Is(e),32*r<(r=(r=bs(e)-t)<0?0-r:r)?(O(Ir,1),Zs(e)):e)}function Su(e){var t=Is(e),r=_s(e),t=r-t,r=bs(e)-r;return 0<=t*r?e:(O(yr,1),Ys(e,(t<0?0-t:t)/(e=(e=r-t)<0?0-e:e)))}function yu(e,t,r){0===s()?rs()&&(wu(e),Fu(t),_u(r)):$n(e,t)||zo(e,t,r)}function Iu(){return 0===s()?0:Pu()}function Ou(){return $o(s()-3)}function Fu(e){eu(s()-3,e)}function Au(){return tu(s()-3)}function _u(e){ru(s()-3,e)}function Pu(){return iu(s()-3)}function wu(e){su(s()-3,e)}function Cu(){return 0===s()?999999999:Au()}function M(e){var t,r,i,s,n,a;return 0===e||sa(e)?(i=255&e,s=e>>>8&255,n=e>>>16&255,t=e>>>24&255,Yn()&&(r=(t*(a=Ks())[6]+a[7])/t,n=(n*a[0]+a[1])*r|0,s=(s*a[2]+a[3])*r|0,i=(i*a[4]+a[5])*r|0,t=t*r|0,n=Math.max(n,0),n=Math.min(n,255),s=Math.max(s,0),s=Math.min(s,255),i=Math.max(i,0),i=Math.min(i,255),t=Math.max(t,0),t=Math.min(t,255)),t<1?0:(t<255&&La()&&pu(Rt),i+(s<<8)+(n<<16)+(t<<24))):e}function xu(e){var t,r,i,s,n;Jn()?(t=0|e[0],r=0|e[1],i=e,s=fn(),n=(s[0]*t+s[1]*r+s[2])*W()|0,t=(s[3]*t+s[4]*r+s[5])*W()|0,i[0]=n,i[1]=t):(e[0]=(e[0]+rn())*W(),e[1]=(e[1]+sn())*W())}function Eu(e){0<e&&xu(P()),1<e&&xu(w()),2<e&&xu(C()),3<e&&xu(Ga())}function Tu(e){var t,r;return 0===e?0:(P()[0]=0,P()[1]=0,w()[0]=256*e,w()[1]=0,C()[0]=0,C()[1]=256*e,Eu(3),e=w()[0]-P()[0],t=w()[1]-P()[1],r=128+(0|Math.sqrt(e*e+t*t))>>8,e=C()[0]-P()[0],t=C()[1]-P()[1],0===(r=(e=128+(0|Math.sqrt(e*e+t*t))>>8)<r?e:r)?1:r)}function Lu(e){var t,r,i,s,n;return Yn()?(r=255&e,i=e>>>8&255,t=e>>>24&255,s=(e>>>16&255)*(n=Ks())[0]+n[1]|0,i=i*n[2]+n[3]|0,r=r*n[4]+n[5]|0,t=t*n[6]+n[7]|0,s=Math.max(s,0),s=Math.min(s,255),i=Math.max(i,0),i=Math.min(i,255),r=Math.max(r,0),r=Math.min(r,255),t=Math.max(t,0),(t=Math.min(t,255))<16?0:r+(i<<8)+(s<<16)+(t<<24)):e}function Mu(){return h[pi]}function Vu(){qu(Mu())}function Nu(e){return!!Ta(e)&&(qu(Ru()-e),!0)}function s(){return Mu()-Ru()}function ju(e){return h[Ru()+e]}function Bu(e,t){return h[Ru()+e]=t}function Ru(){return h[Or]}function qu(e){h[Or]=e}function Du(e,t){_(e,Ae,t)}function Uu(e,t){_(e,_e,t)}function Gu(e){return A(e,Pe)}function Wu(e){return o(ji,e+xe)}function zu(e,t){_(e,Ee,t)}function Hu(e){return A(e,rr)}function Ku(e,t){_(e,rr,t)}function Xu(e){return A(e,ir)}function Yu(e,t){_(e,ir,t)}function Zu(e){return A(e,sr)}function Ju(e){return A(e,or)}function Qu(e,t){_(e,or,t)}function $u(e){h=e.wordsAsInt32Array()}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:bo,primitiveCopyBuffer:io,primitiveAddRect:to,primitiveAddGradientFill:Ja,primitiveSetClipRect:xo,initialiseModule:ea,primitiveSetBitBltPlugin:Co,primitiveRegisterExternalEdge:Fo,primitiveGetClipRect:lo,primitiveAddBezier:Ka,primitiveInitializeProcessing:go,primitiveRenderImage:_o,primitiveGetOffset:po,primitiveSetDepth:To,primitiveAddBezierShape:Xa,primitiveSetEdgeTransform:Lo,getModuleName:Dn,primitiveGetTimes:mo,primitiveNextActiveEdgeEntry:yo,primitiveAddBitmapFill:Ya,primitiveGetDepth:ho,primitiveAbortProcessing:za,primitiveNextGlobalEdgeEntry:Oo,primitiveGetFailureReason:fo,primitiveDisplaySpanBuffer:so,moduleUnloaded:Ea,primitiveGetCounts:co,primitiveChangedActiveEdgeEntry:ro,primitiveRenderScanline:Po,primitiveGetBezierStats:uo,primitiveFinishedProcessing:ao,setInterpreter:Uo,primitiveNeedsFlush:ko,primitiveAddLine:Qa,primitiveSetOffset:Mo,primitiveNextFillEntry:Io,primitiveInitializeBuffer:vo,primitiveDoProfileStats:no,primitiveAddActiveEdgeEntry:Ha,primitiveSetAALevel:wo,primitiveNeedsFlushPut:So,primitiveAddCompressedShape:Za,primitiveSetColorTransform:Eo,primitiveAddOval:$a,primitiveRegisterExternalFill:Ao,primitiveAddPolygon:eo,primitiveGetAALevel:oo}):self.setTimeout(e,100)}()})(),registerB3DAcceleratorPlugin(),(()=>{var t=1,r=11;function p(e){return"number"==typeof e?V.classSmallInteger():e.sqClass}function B(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function m(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function te(e,t){return 0|Math.floor(e/t)}function re(e,t){return 31<t?0:e<<t}function ie(e,t){return 31<t?0:e>>>t}function v(e,t){return t<0?t<-31?0:e>>>0-t:31<t?0:e<<t}var se=4294967295,a=3,i=13,s=12,n=10,o=11,u=14,l=0,g=4,f=5,c=2,h=7,k=3,S=1,y=8,I=9,R=15,O=6,F=2,A=2,q=4,D=8,Ae=1,_=16384,P=0,U=3,G=2,W=1,z=1,H=43,K=0,ne=0,ae=0,oe=0,ue=0,le=0,ce=0,w=0,X=0,Y=0,Z=0,C=0,x=0,J=0,he=0,Q=null,$=0,ee=null,_e=null,fe=0,Pe=0,we=0,pe=0,Ce=0,de=0,xe=0,Ee=0,E=0,me=0,T=0,L=0,ve=0,Te=0,M=0,Le=0,Me=new Array(4096),Ve=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],Ne=[0,2,4,6,8,12,14,16],je=[0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],Be=0,ge=0,be=0,Re=null,qe=0,De=0,Ue=0,Ge=0,We=0,ze=0,V=null,He=0,Ke=null,ke=0,Xe=0,N=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],e="BitBltPlugin 3 November 2014 (e)",Ye=0,Ze=0,Je=0,j=new Array(43),Qe=0,$e=null,d=0,et=0,Se=0,tt=0,ye=0,rt=0,it=0,b=0,st=0,nt=0,Ie=0,at=0,ot=0,ut=0,lt=0,Oe=0,Fe=0,ct=null,ht=null,ft=0,pt=0,dt=0,mt=new Array(32),vt=0,gt=0,bt=0;function kt(e,t){var r,i;if(de<16)for(r=e^t,i=N[de];0!==r;)0!=(r&i)&&++X,r=ie(r,de);else X=16===de?(r=gr(e,t,5,3),X=X+(31&r)+(r>>>5&31)+(r>>>10&31),r=gr(e>>>16,t>>>16,5,3),X+(31&r)+(r>>>5&31)+(r>>>10&31)):(r=gr(e,t,8,3),X+(255&r)+(r>>>8&255)+(r>>>16&255));return t}function St(e,t){var r,i,s,n;if((he&(Ae|q))==(Ae|q))if(de<16)for(r=N[de]&$,n=t,s=1;s<=L;s++)Kr(i=n&r,Hr(i)+1),n=ie(n,de);else 16===de?(Kr(i=Lr(65535&t,5,J),Hr(i)+1),Kr(i=Lr(t>>>16,5,J),Hr(i)+1)):Kr(i=Lr(t,8,J),Hr(i)+1);return t}function yt(e,t){return e+t}function It(e,t){var r,i,s=e>>>24;return 0==s?t:255==s?e:(i=(16711935&e)*s+(16711935&t)*(r=255-s)+16711935)+(i-65537>>>8&16711935)>>>8&16711935|((i=(16711935&(e>>>8|16711680))*s+(t>>>8&16711935)*r+16711935)+(i-65537>>>8&16711935)>>>8&16711935)<<8}function Ot(e,t){return Ft(e,t,!1)}function Ft(e,t,r){var i,s,n,a,o,u,l,c,h,f,p,d,m;if(de<16)return t;if(h=255-et,o=t,1===L)r&&0===e||(o=(p=(16711935&e)*et+(16711935&t)*h+16711935)+(p-65537>>>8&16711935)>>>8&16711935|((p=(e>>>8&16711935)*et+(t>>>8&16711935)*h+16711935)+(p-65537>>>8&16711935)>>>8&16711935)<<8);else for(i=N[de],m=T,d=t,a=e,n=1;n<=L;n++){if(l=a&i,!(0==(m&i)||r&&0==l)){for(f=d&i,s=0,c=1;c<=3;c++)s|=re(31&te((31&ie(l,u=5*(c-1)))*et+(31&ie(f,u))*h+254,255),u);o=o&~re(i,16*(n-1))|re(s,16*(n-1))}m=ie(m,de),a=ie(a,de),d=ie(d,de)}return o}function At(e,t){var r=255-(e>>>24),i=((16711935&t)*r>>>8&16711935)+(16711935&e),t=((t>>>8&16711935)*r>>>8&16711935)+(e>>>8&16711935);return(16711935&t)<<8|255*(16777472&t)|(16711935&i|255*(16777472&i)>>>8)}function _t(e,t){return 0===e?t:Ft(e,t,!0)}function Pt(e,t){return e&t}function wt(e,t){return e&~t}function Ct(e,t){return~e&t}function xt(e,t){return~e&~t}function Et(e,t){return~t}function Tt(e,t){return~e|t}function Lt(e,t){return~e|~t}function Mt(e,t){return~e}function Vt(e,t){return~e^t}function Nt(e,t){return e|t}function jt(e,t){return e|~t}function Bt(e,t){return e^t}function Rt(e,t){return 0}function qt(){C<=M?(Oe=ot,ge=M,ce=bt):(Oe=ot+(C-M),ce=bt-(C-M),ge=C),C+Z<ge+ce&&(ce-=ge+ce-(C+Z)),x<=Le?(Fe=ut,be=Le,le=ze):(Fe=ut+x-Le,le=ze-(x-Le),be=x),x+Y<be+le&&(le-=be+le-(x+Y)),Je||(Oe<0&&(ge-=Oe,ce+=Oe,Oe=0),at<Oe+ce&&(ce-=Oe+ce-at),Fe<0&&(be-=Fe,le+=Fe,Fe=0),it<Fe+le&&(le-=Fe+le-it))}function Dt(){return qt(),ce<=0||le<=0?(ae=oe=ue=ne=0,null):lr()?((()=>{var e;if(41===fe)Pe=255,we=16777215,ct=Re=null,2<=V.methodArgumentCount()?(Pe=V.stackIntegerValue(V.methodArgumentCount()-2),V.failed()||(we=V.stackIntegerValue(V.methodArgumentCount()-1),V.failed())?V.primitiveFail():4===V.methodArgumentCount()&&(e=V.stackObjectValue(1),V.isBytes(e)&&(Re=e.bytes),e=V.stackObjectValue(0),V.isBytes(e))&&(ct=e.bytes)):(1!==V.methodArgumentCount()||(we=V.stackIntegerValue(0),V.failed()))&&V.primitiveFail();if(V.failed())return V.primitiveFail();if((()=>{if(Je)return!1;if(34!==fe&&41!==fe)return!1;if(32!==ye)return!1;if(rt===xe)return!1;if(41===fe)if(32===de){{var e,t,r,i,N,s,n,a;for(N=le+1,s=Fe,a=be;0!=--N;){for(t=s*Ie+4*Oe,i=a*ve+4*ge,r=ce+1;0!=--r;)if(e=Se[t>>>2],0==(16777215&e)){for(t+=4,i+=4;0!=--r&&0==(16777215&(e=Se[t>>>2]));)t+=4,i+=4;++r}else n=pe[i>>>2],n=Cr(e,n),pe[i>>>2]=n,t+=4,i+=4;++s,++a}}return oe=(ae=ge)+ce,ne=(ue=be)+le,!0}else if(16===de){{var j,B,o,u,l,R,c,h,q,f,p,d,m;for(q=le+1,f=Fe,d=be,o=16*(1&ge),ke=re(65535,16-(o=me?16-o:o));0!=--q;){for(l=f*Ie+4*Oe,c=d*ve+4*(ge>>1),j=4*(3&d),m=(3&Oe)-1,R=ce+1,o=65535===(h=ke)?16:0;0!=--R;)B=Ve[j+(m=m+1&3)],u=Se[l>>>2],0!=(16777215&u)&&(p=pe[c>>>2],p=ie(p&=~h,o),u=re(0===(u=Xt(u=Cr(u,p=(31744&p)<<9|(992&p)<<6|(31&p)<<3|4278190080),B))?1:u,o),Yt(c,u,h)),l+=4,me?0===o&&(c+=4):0!==o&&(c+=4),o^=16,h=~h;++f,++d}}return oe=(ae=ge)+ce,ne=(ue=be)+le,!0}else return 8===de&&((()=>{var e,t,r,i,s,n,a,o,u,l,c,h,f;for(s=Wt(),o=-9&he,l=le+1,c=Fe,ke=8*(3&ge),Xe=se^re(255,ke=me?24-ke:ke),a=0==(1&ge)?0:522133279,0==(1&(f=be))&&(a^=522133279);0!=--l;){for(a^=522133279,r=c*Ie+4*Oe,n=f*ve+4*(ge>>2),i=ce+1,e=ke,u=Xe;0!=--i;)t=(Se[r>>>2]&~a)+a,31<(h=te(((h=16777215&t)>>>16)+(h>>>8&255)+(255&h),3))&&(224<h&&(t=4294967295),h=pe[n>>>2],h=ie(h&=~u,e),h=s[h],t=re(t=cr(t=Cr(t,h),o),e),Yt(n,t,u)),r+=4,u=me?0===e?(n+=4,e=24,16777215):(e-=8,u>>>8|4278190080):32===e?(n+=4,e=0,4294967040):(e+=8,u<<8|255),a^=522133279;++c,++f}})(),oe=(ae=ge)+ce,ne=(ue=be)+le,!0);if(de<8)return!1;if(8===de&&0==(he&Ae))return!1;if(32===de)for(var v,g,b,k,S,D=le+1,U=Fe,G=be;0!=--D;){for(g=U*Ie+4*Oe,k=G*ve+4*ge,b=ce+1;0!=--b;)if(255==(S=(v=Se[g>>>2])>>>24)){for(pe[k>>>2]=v,g+=4,k+=4;0!=--b&&(v=Se[g>>>2])>>>24==255;)pe[k>>>2]=v,g+=4,k+=4;++b}else if(0==S){for(g+=4,k+=4;0!=--b&&(v=Se[g>>>2])>>>24==0;)g+=4,k+=4;++b}else S=At(v,pe[k>>>2]),pe[k>>>2]=S,g+=4,k+=4;++U,++G}if(16===de){var W,y,I,O,z,F,A,_,P,H=le+1,K=Fe,w=be,C=16*(1&ge);for(ke=re(65535,16-(C=me?16-C:C));0!=--H;){for(O=K*Ie+4*Oe,F=w*ve+4*(ge>>1),W=4*(3&w),P=(3&Oe)-1,z=ce+1,C=65535===(A=ke)?16:0;0!=--z;)y=Ve[W+(P=P+1&3)],255==(_=(I=Se[O>>>2])>>>24)?Yt(F,I=re(0===(I=Xt(I,y))?1:I,C),A):0!=_&&(_=pe[F>>>2],Yt(F,I=re(0===(I=Xt(I=At(I,_=(31744&(_=ie(_&=~A,C)))<<9|(992&_)<<6|(31&_)<<3|4278190080),y))?1:I,C),A)),O+=4,me?0===C&&(F+=4):0!==C&&(F+=4),C^=16,A=~A;++K,++w}}if(8===de){var x,E,X,Y,T,L,M,V,Z=Wt(),J=-9&he,Q=le+1,$=Fe,ee=be;for(ke=8*(3&ge),Xe=se^re(255,ke=me?24-ke:ke),L=0==(1&ge)?0:522133279,0==(1&be)&&(L^=522133279);0!=--Q;){for(L^=522133279,X=$*Ie+4*Oe,T=ee*ve+4*(ge>>2),Y=ce+1,x=ke,M=Xe;0!=--Y;)31<(V=(E=(Se[X>>>2]&~L)+L)>>>24)&&(V<224&&(V=pe[T>>>2],E=At(E,V=Z[V=ie(V&=~M,x)])),Yt(T,E=re(E=cr(E,J),x),M)),X+=4,M=me?0===x?(T+=4,x=24,16777215):(x-=8,M>>>8|4278190080):24===x?(T+=4,x=0,4294967040):(x+=8,M<<8|255),L^=522133279;++$,++ee}}return oe=(ae=ge)+ce,ne=(ue=be)+le,!0})())return;if(30===fe||31===fe){if(1!==V.methodArgumentCount())return V.primitiveFail();if(et=V.stackIntegerValue(0),!(!V.failed()&&0<=et&&et<=255))return V.primitiveFail()}X=0,Ht(),(Je?()=>{var e,t,r,i,s,n;for(r=j[fe+1],n=1;n<=le;n++){if(t=Ze?se:er(be+n-1),T=ke,i=pe[E>>>2],e=r(t,i),i=T&e|i&~T,pe[E>>>2]=i,E+=4,T=se,3===fe)for(i=t,s=2;s<=Ye-1;s++)pe[E>>>2]=i,E+=4;else for(s=2;s<=Ye-1;s++)i=pe[E>>>2],e=r(t,i),pe[E>>>2]=e,E+=4;1<Ye&&(T=Xe,i=pe[E>>>2],e=r(t,i),i=T&e|i&~T,pe[E>>>2]=i,E+=4),E+=Ce}}:((()=>{var e;rt===xe&&Fe<=be&&(Fe<be?(ft=-1,Fe=Fe+le-1,be=be+le-1):be===Fe&&Oe<ge&&(qe=-1,Oe=Oe+ce-1,ge=ge+ce-1,1<Ye)&&(e=ke,ke=Xe,Xe=e),E=be*ve+4*te(ge,L),Ce=ve*ft-Ye*qe*4)})(),ye!==de||0!==he||st!==me?Gt:((()=>{var e,t,r,i;t=Oe&(i=L-1),e=ge&i,Qe=0<qe?(r=Math.min(ce,L-e),i<t+r):(r=Math.min(ce,1+e),t-r+1<0),d=st?(t-e)*de:(e-t)*de,Qe&&(d<0?d+=32:d-=32),b=Fe*Ie+4*te(Oe,te(32,ye)),tt=Ie*ft-Ye*qe*4,Qe&&(tt-=4*qe)})(),()=>{var e,t,r,i,s,n,a,o,u,l,c,h,f,p;for(n=j[fe+1],a=4*qe,-32===d?d=s=r=0:r=d<0?(s=d+32,re(se,0-d)):0===d?(s=0,se):(s=d-32,ie(se,d)),p=~r,Ze?(i=se,Ge=0):i=er(0),c=be,h=1;h<=le;h++){if(1<Ge&&(i=er(c),c+=ft),Qe?(l=Se[b>>>2],b+=a):l=0,T=ke,f=Se[b>>>2],b+=a,t=v(l&p,s)|v(f&r,d),l=f,o=pe[E>>>2],e=n(t&i,o),o=T&e|o&~T,pe[E>>>2]=o,E+=a,T=se,3===fe)if(0===d&&i===se)if(-1===qe)for(u=2;u<=Ye-1;u++)f=Se[b>>>2],b+=a,pe[E>>>2]=f,E+=a;else for(u=2;u<=Ye-1;u++)pe[E>>>2]=l,E+=a,l=Se[b>>>2],b+=a;else for(u=2;u<=Ye-1;u++)f=Se[b>>>2],b+=a,t=v(l&p,s)|v(f&r,d),l=f,pe[E>>>2]=t&i,E+=a;else for(u=2;u<=Ye-1;u++)f=Se[b>>>2],b+=a,t=v(l&p,s)|v(f&r,d),l=f,e=n(t&i,pe[E>>>2]),pe[E>>>2]=e,E+=a;1<Ye&&(T=Xe,f=Se[b>>>2],b+=a,t=v(l&p,s)|v(f&r,d),o=pe[E>>>2],e=n(t&i,o),o=T&e|o&~T,pe[E>>>2]=o,E+=a),b+=tt,E+=Ce}})))(),22!==fe&&32!==fe||(ae=oe=ue=ne=0),oe=0<qe?(ae=ge)+ce:(ae=ge-ce+1,ge+1),ne=0<ft?(ue=be)+le:(ue=be-le+1,be+1)})(),void Xr()):V.primitiveFail()}function Ut(e,t,r){Le=r,bt=t-(ot=M=e),Dt(),Ur()}function Gt(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g=j[fe+1];for(nt=te(32,ye),i=N[ye],h=N[de],e=-9&he,b=Fe*Ie+4*te(Oe,nt),v=ce<(v=nt-(Oe&nt-1))?0:te(ce-v,nt)+1,tt=Ie-4*v,d=1+(ge+ce-1&L-1),ce<(a=L-(ge&L-1))&&(a=ce),p=(Oe&nt-1)*ye,o=(ge&L-1)*de,t=ye,f=de,r=0,st&&(p=32-ye-p,t=0-ye),me&&(o=32-de-o,f=0-de,r=32-de),u=1;u<=le;u++){for(l=Ze?se:er(be+u-1),lt=p,Be=o,T=ke,m=a,s=Ye;n=((e,t,r,i,s,n)=>{var a,o,u,l,c,h,f;if(u=Se[b>>>2],f=0,o=lt,l=Be,h=e,t===(Ae|q))for(;a=ie(u,o)&r,c=Q[a&$],f|=re(c&i,l),l+=n,0!=(4294967264&(o+=s))&&(st?o+=32:o-=32,u=Se[(b+=4)>>>2]),0!=--h;);else for(;a=ie(u,o)&r,c=cr(a,t),f|=re(c&i,l),l+=n,0!=(4294967264&(o+=s))&&(st?o+=32:o-=32,u=Se[(b+=4)>>>2]),0!=--h;);return lt=o,f})(m,e,i,h,t,f),Be=r,T===se?(c=g(n&l,pe[E>>>2]),pe[E>>>2]=T&c):(c=g(n&l,(n=pe[E>>>2])&T),n=T&c|n&~T,pe[E>>>2]=n),E+=4,m=2===s?(T=Xe,d):(T=se,L),0!=--s;);b+=tt,E+=Ce}}function Wt(){return[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}function zt(e,t,r){return e<t?te(t-e+_,r+1)+1:t===e?0:0-(te(e-t+_,r+1)+1)}function Ht(){var e=L-1,t=L-(ge&e);ke=(me?ie:re)(se,32-t*de),Xe=(me?re:ie)(se,32-(1+(ge+ce-1&e))*de),Ye=ce<t?(ke&=Xe,Xe=0,1):te(ce-t+e,L)+1,qe=ft=1,E=be*ve+4*te(ge,L),Ce=ve*ft-Ye*qe*4}function Kt(e,t){return t}function Xt(e,t){t<<=8;return(Me[t+(e>>>16&255)]<<10)+(Me[t+(e>>>8&255)]<<5)+Me[t+(255&e)]}function Yt(e,t,r){var i=pe[e>>>2];pe[e>>>2]=i=i&r|t}function Zt(e,t){e=V.fetchPointerofObject(e,t);return"number"==typeof e?e:-2147483648<=(t=V.floatValueOf(e))&&t<=2147483647?0|t:(V.primitiveFail(),0)}function Jt(e,t,r){e=V.fetchPointerofObject(e,t);return"number"==typeof e?e:e.isNil?r:-2147483648<=(t=V.floatValueOf(e))&&t<=2147483647?0|t:(V.primitiveFail(),0)}function Qt(e,t){return 32!==de?t:0===t?0:0!=(4278190080&t)?t:t|4278190080&e}function $t(){return e}function er(e){return De[e-te(e,e=Ge)*e|0]}function tr(e){return!!e.isNil||0===fe||5===fe||10===fe||15===fe}function rr(){for(var e,t,r,i,s,n,a,o=0;o<=255;o++)for(e=0;e<=15;e++)r=e,a=n=s=i=void 0,s=Ne[7&(i=255&(t=o))],n=je[i>>>3],a=r<s?n+1:n,s=Ne[7&(i=t>>>8&255)],n=je[i>>>3],a|=r<s?n+1<<5:n<<5,s=Ne[7&(i=t>>>16&255)],n=je[i>>>3],t=a|=r<s?n+1<<10:n<<10,Me[(e<<8)+o]=t}function ir(){return j[1]=Rt,j[2]=Pt,j[3]=wt,j[4]=Gr,j[5]=Ct,j[6]=Kt,j[7]=Bt,j[8]=Nt,j[9]=xt,j[10]=Vt,j[11]=Et,j[12]=jt,j[13]=Mt,j[14]=Tt,j[15]=Lt,j[16]=Kt,j[17]=Kt,j[18]=Kt,j[19]=yt,j[20]=Wr,j[21]=wr,j[22]=Br,j[23]=kt,j[24]=St,j[25]=It,j[26]=yr,j[27]=Sr,j[28]=Mr,j[29]=Vr,j[30]=Nr,j[31]=Ot,j[32]=_t,j[33]=Er,j[34]=zr,j[35]=At,j[36]=At,j[37]=At,j[38]=jr,j[39]=Ir,j[40]=kr,j[41]=Qt,j[42]=xr,rr(),!0}function sr(){var e;if(pe=V.fetchPointerofObject(P,xe),Te=V.fetchIntegerofObject(W,xe),Ee=V.fetchIntegerofObject(G,xe),!(0<=Te&&0<=Ee))return!1;if(de=V.fetchIntegerofObject(U,xe),me=0<de,de<0&&(de=0-de),"number"==typeof pe){if(!(e=>($e||ur())&&$e(e,function(e,t,r,i){Te=e,Ee=t,de=r,me=i}))(pe))return!1;L=te(32,de),pe=ve=0}else{if(L=te(32,de),ve=4*te(Te+(L-1),L),e=m(pe),!V.isWordsOrBytes(pe)||e!==ve*Ee){if(!(V.isWordsOrBytes(pe)&&ve*Ee<e))return!1;V.vm.warnOnce("BitBlt>>loadBitBltDestForm: destBitsSize != destPitch * destHeight, expected "+ve+"*"+Ee+"="+ve*Ee+", got "+e)}pe=pe.wordsOrBytes()}return!0}function nr(e){return ar(e,!1)}function ar(e,t){if(w=e,He=t,fe=V.fetchIntegerofObject(k,w),V.failed()||fe<0||H-2<fe)return!1;if(16<=fe&&fe<=17)return!1;if(rt=V.fetchPointerofObject(S,w),Je=tr(rt),Ue=V.fetchPointerofObject(c,w),Ze=tr(Ue),xe=V.fetchPointerofObject(l,e),!(V.isPointers(xe)&&4<=B(xe)))return!1;if(!sr())return!1;if(M=Jt(g,w,0),Le=Jt(f,w,0),bt=Jt(O,w,Te),ze=Jt(h,w,Ee),V.failed())return!1;if(Je)ot=ut=0;else{if(!(V.isPointers(rt)&&4<=B(rt)))return!1;if(!(()=>{var e;if(Se=V.fetchPointerofObject(P,rt),at=Zt(W,rt),it=Zt(G,rt),!(0<=at&&0<=it))return!1;if(ye=V.fetchIntegerofObject(U,rt),st=0<ye,ye<0&&(ye=0-ye),"number"==typeof Se){if(!(e=>($e||ur())&&$e(e,function(e,t,r,i){at=e,it=t,ye=r,st=i}))(Se))return!1;nt=te(32,ye),Se=Ie=0}else{if(nt=te(32,ye),Ie=4*te(at+(nt-1),nt),e=m(Se),!V.isWordsOrBytes(Se)||e!==Ie*it){if(!(V.isWordsOrBytes(Se)&&Ie*it<e))return!1;V.vm.warnOnce("BitBlt>>loadBitBltSourceForm: sourceBitsSize != sourcePitch * sourceHeight, expected "+Ie+"*"+it+"="+Ie*it+", got "+e)}Se=Se.wordsOrBytes()}return!0})())return!1;if(!(()=>{var e,t,r;if(he=$=J=0,Q=ee=_e=null,!(e=V.fetchPointerofObject(u,w)).isNil){if(he=Ae,r=!1,V.isWords(e))t=B(e),Q=e.words,r=!0;else{if(!(V.isPointers(e)&&3<=B(e)))return!1;if(_e=or(V.fetchPointerofObject(0,e)),ee=or(V.fetchPointerofObject(1,e)),(e=V.fetchPointerofObject(2,e)).isNil)t=0;else{if(!V.isWords(e))return!1;t=B(e),Q=e.words}he|=D}if(0!=(t&t-1))return!1;$=t-1,J=0,512===t&&(J=3),4096===t&&(J=4),32768===t&&(J=5),0===t?(Q=null,$=0):he|=q,r&&qr(),((e,t)=>!e||!t||0===e[K]&&0===e[z]&&0===e[F]&&0===e[a]&&16711680===t[K]&&65280===t[z]&&255===t[F]&&4278190080===t[a])(_e,ee)?_e=ee=null:he|=A}return!0})())return!1;0==(he&D)&&qr(),ot=Jt(y,w,0),ut=Jt(I,w,0)}return!!(()=>{var e;if(Ze)De=null;else{if(V.isPointers(Ue)&&4<=B(Ue))e=V.fetchPointerofObject(P,Ue),Ge=V.fetchIntegerofObject(G,Ue),V.isWords(e)||(Ze=!0);else{if(V.isPointers(Ue)||!V.isWords(Ue))return!1;Ge=B(e=Ue)}De=e.wordsOrBytes()}return!0})()&&(C=Jt(n,w,0),x=Jt(o,w,0),Z=Jt(s,w,Te),Y=Jt(i,w,Ee),!V.failed())&&(C<0&&(Z+=C,C=0),x<0&&(Y+=x,x=0),Te<C+Z&&(Z=Te-C),Ee<x+Y&&(Y=Ee-x),!0)}function or(e){return e.isNil?null:"number"!=typeof e&&V.isWords(e)&&4===B(e)?e.wordsAsInt32Array():(V.primitiveFail(),null)}function ur(){return $e=V.ioLoadFunctionFrom("ioGetSurfaceFormat","SurfacePlugin"),Ke=V.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin"),ht=V.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin"),$e&&Ke&&ht}function lr(){var e,t,r,i,s,n;if(We=!1,0===pe){if(!Ke&&!ur())return;if(i=Ke,e=V.fetchIntegerofObject(P,xe),0===Se&&!Je&&(t=V.fetchIntegerofObject(P,rt))===e)return Se=He?(n=Math.min(Oe,ge),s=Math.max(Oe,ge)+ce,i(t,function(e){Ie=e},n,r=Math.min(Fe,be),s-n,Math.max(Fe,be)+le-r)):i(t,function(e){Ie=e},0,0,at,it),ve=Ie,We=!0,0!==(pe=Se);pe=i(e,function(e){ve=e},ge,be,ce,le),We=!0}if(0===Se&&!Je){if(t=V.fetchIntegerofObject(P,rt),!Ke&&!ur())return;i=Ke,Se=He?i(t,function(e){Ie=e},0,0,at,it):i(t,function(e){Ie=e},Oe,Fe,ce,le),We=!0}return 0!==pe&&(0!==Se||Je)}function cr(e,t){var r,i=e;return i=0!=(t&Ae)&&(0!=(t&A)&&0===(i=v((r=e)&ee[0],_e[0])|v(r&ee[1],_e[1])|v(r&ee[2],_e[2])|v(r&ee[3],_e[3]))&&0!==e&&(i=1),0!=(t&q))?Q[i&$]:i}function hr(e){0===strcmp(e,"SurfacePlugin")&&($e=Ke=ht=0)}function fr(e,t,r,i){for(var s=N[r],n=0,a=1;a<=i;a++)(e&s)===s&&(n|=t&s),s=re(s,r);return n}function pr(e,t,r,i,s){var n=e&s,s=t&s,e=(e^n)+(t^s);return e^n^s|ie(n&s|(n|s)&e,r-1)*i}function dr(e,t,r,i){for(var s=N[r],n=0,a=1;a<=i;a++)n|=Math.max(t&s,e&s),s=re(s,r);return n}function mr(e,t,r,i){for(var s=N[r],n=0,a=1;a<=i;a++)n|=Math.min(t&s,e&s),s=re(s,r);return n}function vr(e,t,r,i){var s=N[r],n=re(s,r),a=ie((1+(e&s))*(1+(t&s))-1&n,r);return 1!==i&&(a|=(1+(ie(e,r)&s))*(1+(ie(t,r)&s))-1&n,2!==i&&(a|=re((1+(ie(e,2*r)&s))*(1+(ie(t,2*r)&s))-1&n,r),3!==i))&&(a|=re((1+(ie(e,3*r)&s))*(1+(ie(t,3*r)&s))-1&n,2*r)),a}function gr(e,t,r,i){for(var s,n,a=N[r],o=0,u=1;u<=i;u++)o|=(n=e&a)<(s=t&a)?s-n:n-s,a=re(a,r);return o}function br(e,t){return e<0||t<0||(e=e>>>14)>=at||(t=t>>>14)>=it?0:(t=t*Ie+4*ie(e,dt),ie(Se[t>>>2],lt=mt[e&pt])&vt)}function kr(e,t){var r,i,s,n,a;if(32===de)return e===t?0:t;for(a=N[i=de],s=0,n=1;n<=L;n++)s|=r=(e&a)===(r=t&a)?0:r,a=re(a,i);return s}function Sr(e,t){return fr(~e,t,de,L)}function yr(e,t){return 0===e?t:e|fr(~e,t,de,L)}function Ir(e,t){var r,i,s,n,a;if(1===L)return t;if(r=0,s=re(1,de)-1,n=re(s,(L-1)*de),r|=re(t&s,i=32-de)|ie(t&n,i),!(L<=2))for(a=2;a<=L>>1;a++)s=re(s,de),n=ie(n,de),r|=re(t&s,i-=2*de)|ie(t&n,i);return r}function Or(){return nr(V.stackValue(V.methodArgumentCount()))?(Dt(),V.failed()||(Ur(),V.failed())?null:(V.pop(V.methodArgumentCount()),22===fe||32===fe?(V.pop(1),V.pushInteger(X)):void 0)):V.primitiveFail()}function Fr(){var e,t,r,i,s,n,a,o,u,l,c,h,f;if(6!==V.methodArgumentCount())return V.primitiveFail();if(l=V.stackIntegerValue(0),s=V.stackObjectValue(1),o=V.stackObjectValue(2),p(s)!==V.classArray()||p(o)!==V.classArray())return V.primitiveFail();if(256!==B(o))return V.primitiveFail();if(V.failed())return null;if(n=B(s)-2,r=V.stackIntegerValue(3),c=V.stackIntegerValue(4),f=V.stackObjectValue(5),!V.isBytes(f))return V.primitiveFail();if(!(0<c&&0<r&&r<=m(f)))return V.primitiveFail();if(!nr(i=V.stackObjectValue(6)))return V.primitiveFail();if(30===fe||31===fe)return V.primitiveFail();for(a=0!==pe&&0!==Se&&!1===Je&&rt!==xe&&(0!==he||st!==me||ye!==de),u=M,t=f.bytes,e=c;e<=r;e++){if(h=t[e-1],(h=V.fetchIntegerofObject(h,o))<0||n<h)return V.primitiveFail();if(ot=V.fetchIntegerofObject(h,s),bt=V.fetchIntegerofObject(h+1,s)-ot,V.failed())return null;if(qt(),0<ce&&0<le&&(a?(Ht(),Gt(),oe=(ae=ge)+ce,ne=(ue=be)+le):Dt()),V.failed())return null;M=M+bt+l}ae=u,Ur(),V.storeIntegerofObjectwithValue(g,i,M),V.pop(6)}function Ar(){var e=V.stackValue(2),t=V.stackIntegerValue(1),r=V.stackIntegerValue(0);if(!nr(e))return V.primitiveFail();V.failed()||(((e,t)=>{var r,i,s,n,a=0<e?1:0===e?0:-1,o=0<t?1:0===t?0:-1,u=Math.abs(t),l=Math.abs(e),c=i=9999,h=n=-9999;if(u<l){for(r=l>>1,s=1;s<=l;s++)if(M+=a,(r-=u)<0&&(Le+=o,r+=l),s<l){if(Dt(),V.failed())return;ae<oe&&ue<ne&&(c=Math.min(c,ae),h=Math.max(h,oe),i=Math.min(i,ue),4e3<(h-c)*((n=Math.max(n,ne))-i))&&(ae=c,oe=h,ue=i,ne=n,Ur(),h=n=-(c=i=9999))}}else for(r=u>>1,s=1;s<=u;s++)if(Le+=o,(r-=l)<0&&(M+=a,r+=u),s<u){if(Dt(),V.failed())return;ae<oe&&ue<ne&&(c=Math.min(c,ae),h=Math.max(h,oe),i=Math.min(i,ue),4e3<(h-c)*((n=Math.max(n,ne))-i))&&(ae=c,oe=h,ue=i,ne=n,Ur(),h=n=-(c=i=9999))}ae=c,oe=h,ue=i,ne=n,V.storeIntegerofObjectwithValue(g,w,M),V.storeIntegerofObjectwithValue(f,w,Le)})(t,r),Ur()),V.failed()||V.pop(2)}function _r(){var e,t,r,i,s,n=V.stackIntegerValue(1),a=V.stackIntegerValue(0);V.stackValue(2);return V.failed()||(n<0||a<0?(i=0,V.failed()||V.popthenPush(3,i)):(s=V.stackValue(V.methodArgumentCount()),V.isPointers(s)&&4<=B(s)&&(e=V.fetchPointerofObject(P,s),V.isWordsOrBytes(e))?(bt=V.fetchIntegerofObject(W,s),ze=V.fetchIntegerofObject(G,s),s=V.fetchIntegerofObject(U,s),V.failed()||(bt<=n||ze<=a?(i=0,V.failed()||V.popthenPush(3,i)):s<0||(t=te(32,s),r=te(bt+(t-1),t),m(e)!==r*ze*4)?V.primitiveFail():(a=V.fetchLong32ofObject(a*r+te(n,t),e),r=ie(4294967295,32-s),e=ie(a,32-(1+(n&t-1))*s)&r,i=V.positive32BitIntegerFor(e),V.failed()||V.popthenPush(3,i)))):V.primitiveFail())),null}function Pr(){var e;return ar(V.stackValue(V.methodArgumentCount()),!0)?(e=Je,Je=!0,qt(),(Je=e)||ce<=0||le<=0?ae=oe=ue=ne=0:lr()?(Ht(),(()=>{var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k,S,y,I,O,F,A,_,P;if(u=j[fe+1],!(B(w)>=R+12))return V.primitiveFail();if((s=ze-1)<=0&&(s=1),S=Zt(R,w),r=Zt(R+3,w),(F=zt(S,r,s))<0&&(S=r-s*F),m=Zt(R+1,w),r=Zt(R+4,w),(y=zt(m,r,s))<0&&(m=r-s*y),g=Zt(R+9,w),r=Zt(R+6,w),(l=zt(g,r,s))<0&&(g=r-s*l),c=Zt(R+10,w),r=Zt(R+7,w),(n=zt(c,r,s))<0&&(c=r-s*n),V.failed())return;if(2===V.methodArgumentCount())if(A=V.stackIntegerValue(1),(b=V.stackValue(0)).isNil){if(ye<16)return V.primitiveFail()}else{if(B(b)<re(1,ye))return V.primitiveFail();b=b.wordsOrBytes()}else A=1,b=V.nilObject();for((s=bt-1)<=0&&(s=1),I=1+(ge+ce-1&L-1),ce<(o=L-(ge&L-1))&&(o=ce),Le<x&&(S+=(x-Le)*F,m+=(x-Le)*y,g+=(x-Le)*l,c+=(x-Le)*n),gt=0,P=ye;1!==P;)++gt,P>>>=1;for(vt=N[ye],pt=re(1,dt=5-gt)-1,_=0;_<=pt;_++)mt[_]=st?32-re(_+1,gt):re(_,gt);for(1<A&&0==(he&D)&&(Q?Dr(8,J):16===de&&Dr(8,5)),e=-9&he,t=me?(v=0-de,32-de):(v=de,0),h=1;h<=le;h++){for(k=zt(S,g,s),Oe=0<=k?S:g-s*k,f=zt(m,c,s),Fe=0<=f?m:c-s*f,Be=me?32-(1+(ge&L-1))*de:(ge&L-1)*de,M<C&&(Oe+=(C-M)*k,Fe+=(C-M)*f),p=Ze?se:er(be+h-1),T=ke,O=o,r=Ye;i=1===A?((e,t,r,i,s)=>{var n,a,o,u,l;if(u=N[de],l=0,a=e,s===(Ae|q))for(;n=br(Oe,Fe),o=Q[n&$],l|=re(o&u,Be),Be+=i,Oe+=t,Fe+=r,0!=--a;);else for(;n=br(Oe,Fe),o=cr(n,s),l|=re(o&u,Be),Be+=i,Oe+=t,Fe+=r,0!=--a;);return l})(O,k,f,v,e):((e,t,r,i,s,n,a,o)=>{var u,l,c,h,f,p,d,m,v,g,b,k,S,y,I,O,F,A,_;m=N[de],l=0,v=2===a?(c=t>>1,f=r>>1,d=i>>1,s>>1):(c=te(t,a),f=te(r,a),d=te(i,a),te(s,a)),p=e;do{I=Oe,b=Fe,O=F=y=k=0,A=0,h=a;do{for(_=I,S=b,u=a;g=br(_,S),25===fe&&0===g||(++A,ye<16?g=n[g]:16===ye&&(g=Tr(g)),k+=255&g,y+=g>>>8&255,F+=g>>>16&255,O+=g>>>24),_+=c,S+=f,0!=--u;);}while(I+=d,b+=v,0!=--h)}while(g=0===A||25===fe&&A<a*a>>1?0:(4===A?(F>>>=2,y>>>=2,k>>>=2,O>>>=2):(F=te(F,A),y=te(y,A),k=te(k,A),O=te(O,A)),cr(g=0===(g=(O<<24)+(F<<16)+(y<<8)+k)&&0<F+y+k+O?1:g,he)),l|=re(g&m,Be),Be+=o,Oe+=t,Fe+=r,0!=--p);return l})(O,k,f,F,y,b,A,v),Be=t,T===se?(d=u(i&p,pe[E>>>2]),pe[E>>>2]=T&d):(a=pe[E>>>2],d=u(i&p,a&T),a=T&d|a&~T,pe[E>>>2]=a),E+=4,O=2===r?(T=Xe,I):(T=se,L),0!=--r;);S+=F,m+=y,g+=l,c+=n,E+=Ce}})(),oe=0<qe?(ae=ge)+ce:(ae=ge-ce+1,ge+1),ne=0<ft?(ue=be)+le:(ue=be-le+1,be+1),Xr()):V.primitiveFail(),V.failed()||(Ur(),V.failed())?null:void V.pop(V.methodArgumentCount())):V.primitiveFail()}function wr(e,t){var r,i;return de<16?(i=re(1,de)-1,r=re(te(4294967295,i),de-1),pr(e,t,de,i,r)):16===de?pr(2147450879&e,2147450879&t,5,i=31,r=1108361744):pr(e,t,8,i=255,r=2155905152)}function Cr(e,t){var r,i,s,n,a,o;return 0===e?t:(a=255&e,i=255&(e>>>=8),s=255&(e>>>=8),e=255&(e>>>=8),255!=(n=255&Pe)&&(e=e*n>>>8,s=s*n>>>8,i=i*n>>>8,a=a*n>>>8),t=255&(n=t),o=255&(r=we),ct&&(t=ct[t],o=ct[o]),255<(a=(t*(255-a)>>>8)+(o*a>>>8))&&(a=255),Re&&(a=Re[a]),t=255&(n>>>=8),o=255&(r>>>=8),ct&&(t=ct[t],o=ct[o]),255<(i=(t*(255-i)>>>8)+(o*i>>>8))&&(i=255),Re&&(i=Re[i]),t=255&(n>>>=8),o=255&(r>>>=8),ct&&(t=ct[t],o=ct[o]),255<(t=(t*(255-s)>>>8)+(o*s>>>8))&&(t=255),r>>>=8,((((o=255<(o=((255&(n>>>=8))*(255-e)>>>8)+e)?255:o)<<8)+(t=Re?Re[t]:t)<<8)+i<<8)+a)}function xr(e,t){if(0===e)return t;for(var r,i,s=e,n=t,a=de,o=L,u=N[a],l=0,c=1;c<=o;c++)i=ie(s&u,(c-1)*a),r=ie(n&u,(c-1)*a),32!==a&&(r=16===a?(i=4278190080|Tr(i),4278190080|Tr(r)):(i=4278190080|Lr(i,a,32),4278190080|Lr(r,a,32))),i=Cr(i,r),l|=re(i=32!==a?Lr(i,32,a):i,(c-1)*a),u=re(u,a);return l}function Er(e,t){for(var r,i,s,n,a=N[de],o=16===de?(i=5,31):(i=8,255),u=T,l=t,c=e,h=1;h<=L;h++)0<(u&a)&&(n=l&a,r=c&a,s=de<16?r==n?0:1:((s=gr(r,n,i,3))&o)+(ie(s,i)&o)+(ie(ie(s,i),i)&o),X+=s),u=ie(u,de),c=ie(c,de),l=ie(l,de);return t}function Tr(e){return(31&e)<<3|(992&e)<<6|(31744&e)<<9}function Lr(e,t,r){var i,s,n,a;return 0<(i=r-t)?(a=re(1,t)-1,s=(n=re(e,i))&(a=re(a,i)),a=re(a,r),s+((n=re(n,i))&a)+(re(n,i)&re(a,r))):0==i?5===t?32767&e:8===t?16777215&e:e:0===e?e:(a=re(1,r)-1,s=(n=ie(e,i=t-r))&a,a=re(a,r),0===(s=s+((n=ie(n,i))&a)+(ie(n,i)&re(a,r)))?1:s)}function Mr(e,t){return de<16?dr(e,t,de,L):16===de?dr(e,t,5,3)+(dr(e>>>16,t>>>16,5,3)<<16):dr(e,t,8,4)}function Vr(e,t){return de<16?mr(e,t,de,L):16===de?mr(e,t,5,3)+(mr(e>>>16,t>>>16,5,3)<<16):mr(e,t,8,4)}function Nr(e,t){e=~e;return de<16?mr(e,t,de,L):16===de?mr(e,t,5,3)+(mr(e>>>16,t>>>16,5,3)<<16):mr(e,t,8,4)}function jr(e,t){return de<16?vr(e,t,de,L):16===de?vr(e,t,5,3)+(vr(e>>>16,t>>>16,5,3)<<16):vr(e,t,8,4)}function Br(e,t){return de<16?gr(e,t,de,L):16===de?gr(e,t,5,3)+(gr(e>>>16,t>>>16,5,3)<<16):gr(e,t,8,4)}function Rr(e){return!1!=((V=e).majorVersion()==t)&&V.minorVersion()>=r}function qr(){var e,t=e=0;if(!(ye<=8)){if(16===ye&&(t=5),0===J){if(de<=8)return;16===de&&(e=5),32===de&&(e=8)}else e=J;Dr(t=32===ye?8:t,e)}}function Dr(e,t){var r,i=[0,0,0,0],s=[0,0,0,0],n=t-e;0!=n&&(n<=0?(r=re(1,t)-1,s[K]=re(r,2*e-n),s[z]=re(r,e-n),s[F]=re(r,0-n),s[a]=0):(r=re(1,e)-1,s[K]=re(r,2*e),s[z]=re(r,e),s[F]=r),i[K]=3*n,i[z]=2*n,i[F]=n,i[a]=0,_e=i,ee=s,he=he|Ae|A)}function Ur(){V.showDisplayBitsLeftTopRightBottom(xe,ae,ue,oe,ne)}function Gr(e,t){return e}function Wr(e,t){return e-t}function zr(e,t){var r,i,s,n,a;if((he&(Ae|q))==(Ae|q))for(r=N[de],i=t,n=T,s=1;s<=L;s++)0!=(n&r)&&(a=i&r,Kr(a=de<16?a:Lr(a,16===de?5:8,J),Hr(a)+1)),n=ie(n,de),i=ie(i,de);return t}function Hr(e){return Q[e&$]}function Kr(e,t){Q[e&$]=t}function Xr(){var e,t,r,i;We&&(ht||ur())&&(r=ht,i=!1,"number"==typeof(e=V.fetchPointerofObject(P,xe))&&(r(e,ae,ue,oe-ae,ne-ue),i=!(pe=ve=0)),Je||"number"==typeof(t=V.fetchPointerofObject(P,rt))&&(i&&t===e||r(t,0,0,0,0),Se=Ie=0),We=!1)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:Or,copyBits:Dt,moduleUnloaded:hr,primitiveDrawLoop:Ar,primitiveDisplayString:Fr,initialiseModule:ir,loadBitBltFrom:nr,setInterpreter:Rr,primitiveWarpBits:Pr,getModuleName:$t,primitivePixelValueAt:_r,copyBitsFromtoat:Ut}):self.setTimeout(e,100)}()})(),registerCroquetPlugin(),(()=>{var t=1,r=11;function i(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function g(e,t){return 31<t?0:e<<t}var b=0,k=null,s=0,S=null,e="FFTPlugin 3 November 2014 (e)",y=0,n=null,a=0,I=null,o=0,O=null,F=0;function u(e){return S.success(S.isWords(e)),S.failed()?0:e.wordsAsFloat32Array()}function l(){return e}function c(e){var t,r;return S.success(6<=i(e)),!S.failed()&&(y=S.fetchIntegerofObject(0,e),b=S.fetchIntegerofObject(1,e),t=S.fetchPointerofObject(2,e),F=i(t),O=u(t),t=S.fetchPointerofObject(3,e),a=i(t),r=t,S.success(S.isWords(r)),n=r.words,t=S.fetchPointerofObject(4,e),o=i(t),I=u(t),t=S.fetchPointerofObject(5,e),s=i(t),k=u(t),S.success(g(1,y)===b&&1+(b>>2)===F&&b===o&&b===s&&o===s),!1===S.failed())}function A(){for(var e,t,r,i=0,s=a;i<s;){if(e=n[i]-1,t=n[i+1]-1,!(e<o&&t<o))return S.success(!1);r=I[e],I[e]=I[t],I[t]=r,r=k[e],k[e]=k[t],k[t]=r,i+=2}}function h(){if(!c(S.stackObjectValue(0)))return null;A(),S.failed()&&A()}function f(){if(!c(S.stackObjectValue(0)))return null;_()}function p(){var e=S.booleanValueOf(S.stackValue(0));if(!c(S.stackObjectValue(1)))return null;(e=>{if(A(),S.failed())return A();var t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v=e;for(r=b>>1,i=b>>2,f=1;f<=y;f++)for(c=g(1,f),h=c>>1,t=((e,t)=>0|Math.floor(e/t))(b,c),l=1;l<=h;l++)for(o=(m=(l-1)*t)<i?(d=O[F-m-1],O[m]):(d=0-O[m-i],O[r-m]),v||(o=0-o),s=l;s<=b;)n=s-1,p=I[u=s+h-1]*d-k[u]*o,a=I[u]*o+k[u]*d,I[u]=I[n]-p,k[u]=k[n]-a,I[n]=I[n]+p,k[n]=k[n]+a,s+=c;e||_()})(e),S.failed()||S.pop(1)}function _(){var e,t;if(!(b<=1))for(t=1/b,e=0;e<=b-1;e++)I[e]=I[e]*t,k[e]=k[e]*t}function d(e){return!1!=((S=e).majorVersion()==t)&&S.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("FFTPlugin",{primitiveFFTTransformData:p,setInterpreter:d,primitiveFFTPermuteData:h,primitiveFFTScaleData:f,getModuleName:l}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function o(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}var u=null,e="FloatArrayPlugin 3 November 2014 (e)";function i(){return e}function s(){var e,t,r,i,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(r=o(s),u.success(r===o(n)),u.failed())return null;for(i=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=r-1;t++)i[t]=i[t]+e[t];u.pop(1)}function n(){var e,t,r,i=u.stackFloatValue(0),s=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),r=s.wordsAsFloat32Array(),e=0;e<=t-1;e++)r[e]=r[e]+i;u.pop(1)}function a(){var e=u.stackIntegerValue(0),t=u.stackObjectValue(1);return u.failed()||(u.success(u.isWords(t)),u.success(0<e&&e<=o(t)),u.failed())?null:(t=t.wordsAsFloat32Array()[e-1],u.pop(2),void u.pushFloat(t))}function l(){var e=u.stackValue(0),t="number"==typeof e?e:u.floatValueOf(e),r=u.stackIntegerValue(1),i=u.stackObjectValue(2);return u.failed()||(u.success(u.isWords(i)),u.success(0<r&&r<=o(i)),u.failed())?null:(i.wordsAsFloat32Array()[r-1]=t,void(u.failed()||u.popthenPush(3,e)))}function c(){var e,t,r,i,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(r=o(s),u.success(r===o(n)),u.failed())return null;for(i=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=r-1;t++)if(0===e[t])return u.primitiveFail();for(t=0;t<=r-1;t++)i[t]=i[t]/e[t];u.pop(1)}function h(){var e,t,r,i,s=u.stackFloatValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(0===s)return u.primitiveFail();if(u.success(u.isWords(n)),u.failed())return null;for(r=o(n),i=n.wordsAsFloat32Array(),t=1/s,e=0;e<=r-1;e++)i[e]=i[e]*t;u.pop(1)}function f(){var e,t,r,i,s,n=u.stackObjectValue(0),a=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(n)),u.success(u.isWords(a)),u.failed())return null;if(r=o(n),u.success(r===o(a)),u.failed())return null;for(i=a.wordsAsFloat32Array(),e=n.wordsAsFloat32Array(),t=s=0;t<=r-1;t++)s+=i[t]*e[t];u.pop(2),u.pushFloat(s)}function p(){var e,t,r,i,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(u.pop(2),(r=o(s))!==o(n))return u.pushBool(!1);for(i=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=r-1;t++)if(i[t]!==e[t])return u.pushBool(!1);return u.pushBool(!0)}function d(){var e,t,r,i,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),r=s.wordsAsInt32Array(),e=i=0;e<=t-1;e++)i+=r[e];return u.pop(1),u.pushInteger(536870911&i)}function m(){var e,t,r,i,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),u.success(!0),r=s.wordsAsFloat32Array(),e=i=0;e<=t-1;e++)i+=r[e]*r[e];i=Math.sqrt(i),u.popthenPush(1,u.floatObjectOf(i))}function v(){var e,t,r,i,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(r=o(s),u.success(r===o(n)),u.failed())return null;for(i=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=r-1;t++)i[t]=i[t]*e[t];u.pop(1)}function g(){var e,t,r,i=u.stackFloatValue(0),s=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),r=s.wordsAsFloat32Array(),e=0;e<=t-1;e++)r[e]=r[e]*i;u.pop(1)}function b(){var e,t,r,i,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(r=o(s),u.success(!0),i=s.wordsAsFloat32Array(),e=t=0;e<=r-1;e++)t+=i[e]*i[e];if(u.success(0<t),u.failed())return null;for(t=Math.sqrt(t),e=0;e<=r-1;e++)i[e]=i[e]/t}function k(){var e,t,r,i,s=u.stackObjectValue(0),n=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.success(u.isWords(n)),u.failed())return null;if(r=o(s),u.success(r===o(n)),u.failed())return null;for(i=n.wordsAsFloat32Array(),e=s.wordsAsFloat32Array(),t=0;t<=r-1;t++)i[t]=i[t]-e[t];u.pop(1)}function S(){var e,t,r,i=u.stackFloatValue(0),s=u.stackObjectValue(1);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),r=s.wordsAsFloat32Array(),e=0;e<=t-1;e++)r[e]=r[e]-i;u.pop(1)}function y(){var e,t,r,i,s=u.stackObjectValue(0);if(u.failed())return null;if(u.success(u.isWords(s)),u.failed())return null;for(t=o(s),r=s.wordsAsFloat32Array(),e=i=0;e<=t-1;e++)i+=r[e];u.popthenPush(1,u.floatObjectOf(i))}function I(e){return!1!=((u=e).majorVersion()==t)&&u.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:v,primitiveEqual:p,primitiveAtPut:l,primitiveAt:a,primitiveNormalize:b,primitiveSubFloatArray:k,primitiveDivFloatArray:c,primitiveAddScalar:n,primitiveDotProduct:f,primitiveSubScalar:S,setInterpreter:I,primitiveSum:y,getModuleName:i,primitiveHashArray:d,primitiveMulScalar:g,primitiveLength:m,primitiveAddFloatArray:s,primitiveDivScalar:h}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function U(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function G(e,t){return new Int32Array(e.buffer,e.byteOffset+4*t)}var W=null,i="GeniePlugin v2.0 14 November 2014 (e)";function z(e,t){var r=e[0],r=t[0]-r,t=t[1]-e[1];return r*r+t*t}function s(){return i}function H(e){console.log(i+": "+e)}function n(){var N,j,e,t,r,i,B,s,n,a,o,u,l,c,h,R,f,p,d,m,v,g,b,k,S,q,y,I,O=W.stackValue(11),F=W.stackValue(10),A=W.stackValue(9),_=W.stackValue(8),P=W.stackValue(7),w=W.stackValue(6),C=W.stackValue(5),x=W.stackValue(4),D=W.stackIntegerValue(3),E=W.stackValue(2),T=W.stackValue(1),L=W.stackValue(0);if(!W.failed())if(W.failed())H("failed 1");else if(W.success(W.isWords(O)&&W.isWords(F)&&W.isWords(A)&&W.isWords(_)&&W.isWords(P)&&W.isWords(w)&&W.isWords(C)&&W.isWords(x)&&W.isWords(E)&&W.isWords(T)&&W.isWords(L)),W.failed())H("failed 2");else if(W.success(W.isMemberOf(O,"PointArray")&&W.isMemberOf(F,"PointArray")),W.failed())H("failed 3");else if(a=O.wordsAsInt32Array(),h=F.wordsAsInt32Array(),R=A.wordsAsInt32Array(),B=_.wordsAsInt32Array(),u=P.wordsAsInt32Array(),n=w.wordsAsInt32Array(),q=C.wordsAsInt32Array(),N=x.wordsAsInt32Array(),p=E.wordsAsInt32Array(),y=T.wordsAsInt32Array(),f=L.wordsAsInt32Array(),F=U(F)>>>1,b=U(A)>>>1,s=U(_)>>>1,A=U(w),_=U(E),W.success(_===U(T)&&_===U(L)&&s<_),W.failed())H("failed 4");else if(W.success(U(P)>=b-1&&U(O)>>>1>=b&&s-1<=A&&s<=F&&U(C)>=b-1&&U(x)>=s-1),W.failed())H("failed 5");else if(w=D>>>1,l=(j=1&D)?0:w*w>>>10,f[y[p[0]=0]=0]=2,v=0-l,(o=s)-1<=F&&o-1<=A){for(m=1;m<=o;m++)v=v+(n[e=m-1]+z(G(h,e<<1),a)>>>7)+l,y[m]=v,p[m]=v*m,f[m]=m+1;for(v=y[0]-l,g=1;g<=b;g++){for(S=p[0],v=v+(u[t=g-1]+z(G(a,d=t<<1),h)>>>7)+l,y[0]=v,p[0]=v*g,f[0]=g+1,o=s,m=1;m<=o;m++)M=(e=m-1)<<1,k=p[m],I=p[e],c=u[t]+z(G(a,d),G(h,m<<1))>>>7,0===(v=y[m])?k+=c:(k=k+v+c*f[m],c+=v),i=n[e]+z(G(h,M),G(a,g<<1))>>>7,0===(v=y[e])?I+=i:(I=I+v+i*f[e],i+=v),j?S=1<<29:S+=(z(G(B,M),G(R,d))+z(G(h,M),G(a,d)))*(16+(M=N[e],V=q[t],(V=180<(V=Math.abs(V-M))?360-V:V)*V>>>6))>>>11,M=S<=k&&S<=I?(r=S,v=0,1):k<=I?(r=k,v=c+l,f[m]+1):(r=I,v=i+l,f[e]+1),S=p[m],p[m]=Math.min(r,1<<29),y[m]=Math.min(v,1<<29),f[m]=M;v=y[0]}var M,V,E=r;W.failed()||W.popthenPush(13,E)}else W.primitiveFail();return null}function a(){return W.failed()||W.popthenPush(1,2e3),null}function o(e){return!1!=((W=e).majorVersion()==t)&&W.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("GeniePlugin",{primVersionNO:a,setInterpreter:o,primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:n,getModuleName:s}):self.setTimeout(e,100)}()})(),(()=>{var t=1,B=11;function F(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function n(e,t){return 0|Math.floor(e/t)}function r(e,t){return 31<t?0:e<<t}var a=5,o=2,u=0,l=1,A=8,_=64,P=2446,R=22554,w=3196,C=4433,q=46802,x=6270,D=7373,U=9633,G=91881,W=12299,z=116130,H=15137,K=16069,X=16819,Y=20995,Z=25172,c=1,h=2,J=4,f=8,Q=16,$=128,E=255,ee=11,p=10,te=0,T=127,d=3,re=null,ie=0,se=new Array(128),m=new Array(11),ne=new Array(128),v=new Array(11),ae=null,oe=0,g=0,L=null,b=null,k=0,ue=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],i=0,s=0,S=null,y=0,I=0,e="JPEGReaderPlugin 3 November 2014 (e)",O=null,le=new Array(128),M=new Array(11);function V(e,t){return"number"!=typeof t&&!!L.isPointers(t)&&!(F(t)<ee||(e[u]=L.fetchIntegerofObject(u,t),e[l]=L.fetchIntegerofObject(l,t),e[h]=L.fetchIntegerofObject(h,t),e[d]=L.fetchIntegerofObject(d,t),e[a]=L.fetchIntegerofObject(a,t),e[f]=L.fetchIntegerofObject(f,t),e[p]=L.fetchIntegerofObject(p,t),L.failed()))}function N(e,t){var r,i,s,n;if("number"==typeof t)return!1;if(!L.isPointers(t))return!1;if(F(t)<ee)return!1;if("number"==typeof(r=L.fetchPointerofObject(J,t)))return!1;if(!L.isPointers(r))return!1;if(n=F(r),$<n)return!1;for(s=0;s<=n-1;s++){if("number"==typeof(i=L.fetchPointerofObject(s,r)))return!1;if(!L.isWords(i))return!1;if(F(i)!==_)return!1;e[s]=i.wordsAsInt32Array()}return!L.failed()}function ce(){var e,t,r,i,s;for(M[u]=0,M[l]=0,m[u]=0,m[l]=0,v[u]=0,r=v[l]=0;r<=k-1;r++)s=pe(),e=(()=>{var e,t,r,i,s;return t=e=m[u],r=m[l],i=m[h],s=m[d],0!==i&&0!==s&&(t=n(t,i),r=n(r,s)),i=(r>>>3)*m[a]+(t>>>3),s=((7&r)<<3)+(7&t),r=se[i][s],++e<8*m[f]?m[u]=e:(m[u]=0,m[l]++),r})(),e-=T,t=(()=>{var e,t,r,i,s;return t=e=v[u],r=v[l],i=v[h],s=v[d],0!==i&&0!==s&&(t=n(t,i),r=n(r,s)),i=(r>>>3)*v[a]+(t>>>3),s=((7&r)<<3)+(7&t),r=ne[i][s],++e<8*v[f]?v[u]=e:(v[u]=0,v[l]++),r})(),i=s+(G*(t-=T)>>16)+O[te],i=Math.min(i,E),i=Math.max(i,0),O[te]=i&g,i&=E-g,i=Math.max(i,1),t=s-(R*e>>16)-(q*t>>16)+O[c],t=Math.min(t,E),t=Math.max(t,0),O[c]=t&g,t&=E-g,t=Math.max(t,1),s=s+(z*e>>16)+O[o],s=Math.min(s,E),s=Math.max(s,0),O[o]=s&g,s&=E-g,s=Math.max(s,1),b[r]=4278190080+(i<<16)+(t<<8)+s}function j(e){var t;return s<e&&((()=>{for(var e;s<=16;){if(!(y<I))return;if(e=S[y],++y,255===e){if(!(y<I&&0===S[y]))return--y;++y}i=i<<8|e,s+=8}})(),s<e)?-1:(t=i,i&=r(1,e=s-=e)-1,31<e?0:t>>>e)}function he(){return e}function fe(e,t){var r,i,s=e[0]>>>24;if(!(Q<s))for(r=2;;){if((i=j(s))<0)return-1;if(t<=(i=r+i-1))return-1;if(0==(1056964608&(i=e[i])))return i;if(r=65535&i,Q<(s=i>>>24&255))return-1}return-1}function pe(){var e,t=e=M[u],r=M[l],i=M[h],s=M[d];return 0!==i&&0!==s&&(t=n(t,i),r=n(r,s)),i=(r>>>3)*M[a]+(t>>>3),s=le[i][((7&r)<<3)+(7&t)],++e<8*M[f]?M[u]=e:(M[u]=0,M[l]++),s}function de(){var e,t,r;if(4!==L.methodArgumentCount())return L.primitiveFail();if(g=L.stackIntegerValue(0),e=L.stackObjectValue(1),L.failed())return null;if(!L.isWords(e)||3!==F(e))return L.primitiveFail();if(O=e.wordsAsInt32Array(),e=L.stackObjectValue(2),L.failed())return null;if(!L.isWords(e))return L.primitiveFail();if(k=F(e),b=e.wordsAsInt32Array(),e=L.stackObjectValue(3),L.failed())return null;if(!Se(e))return L.primitiveFail();for(M[u]=0,t=M[l]=0;t<=k-1;t++)r=pe(),r+=O[c],r=Math.min(r,E),O[c]=r&g,r&=E-g,r=Math.max(r,1),b[t]=4278190080+(r<<16)+(r<<8)+r;L.pop(4)}function me(){var e,t;return 4!==L.methodArgumentCount()?L.primitiveFail():(g=L.stackIntegerValue(0),e=L.stackObjectValue(1),L.failed()?null:L.isWords(e)&&3===F(e)?(O=e.wordsAsInt32Array(),e=L.stackObjectValue(2),L.failed()?null:L.isWords(e)?(k=F(e),b=e.wordsAsInt32Array(),e=L.stackObjectValue(3),L.failed()?null:L.isPointers(e)&&3===F(e)&&Se(L.fetchPointerofObject(0,e))&&(t=L.fetchPointerofObject(1,e),V(m,t))&&N(se,t)&&(t=L.fetchPointerofObject(2,e),V(v,t))&&N(ne,t)?(ce(),void L.pop(4)):L.primitiveFail()):L.primitiveFail()):L.primitiveFail())}function ve(){var e,t,r;return 5!==L.methodArgumentCount()?L.primitiveFail():(r=L.stackObjectValue(0),L.failed()?null:F(e=r)<5||!L.isPointers(e)||"number"==typeof(t=L.fetchPointerofObject(0,e))||!L.isBytes(t)||(S=t.bytes,t=(t=t).bytes?t.bytes.length:t.words?4*t.words.length:0,y=L.fetchIntegerofObject(1,e),I=L.fetchIntegerofObject(2,e),i=L.fetchIntegerofObject(3,e),s=L.fetchIntegerofObject(4,e),L.failed())||(t<I||y<0||I<=y)?L.primitiveFail():(e=L.stackObjectValue(1),L.failed()?null:L.isWords(e)?(ie=F(e),re=e.wordsAsInt32Array(),e=L.stackObjectValue(2),L.failed()?null:L.isWords(e)?(oe=F(e),ae=e.wordsAsInt32Array(),r=L.stackObjectValue(3),L.failed()?null:V(M,r)?(e=L.stackObjectValue(4),L.failed()?null:!L.isWords(e)||F(e)!==_?L.primitiveFail():(t=e.wordsAsInt32Array(),L.failed()||(((e,t)=>{var r,i,s,n=fe(ae,oe);if(n<0)return L.primitiveFail();for(0!==n&&(n=be(j(n),n)),n=t[p]=t[p]+n,e[0]=n,r=1;r<=_-1;r++)e[r]=0;for(i=1;i<_;){if((n=fe(re,ie))<0)return L.primitiveFail();if(s=n>>>4,0!==(n&=15)){if(i+=s,n=be(j(n),n),i<0||_<=i)return L.primitiveFail();e[ue[i]]=n}else{if(15!=s)return;i+=s}++i}})(t,M),L.failed())?null:(r=L.stackValue(0),L.storeIntegerofObjectwithValue(1,r,y),L.storeIntegerofObjectwithValue(3,r,i),L.storeIntegerofObjectwithValue(4,r,s),L.storeIntegerofObjectwithValue(p,L.stackValue(3),M[p]),void L.pop(5)))):L.primitiveFail()):L.primitiveFail()):L.primitiveFail()))}function ge(){var e,t;if(2!==L.methodArgumentCount())return L.primitiveFail();if(e=L.stackObjectValue(0),L.failed())return null;if(!L.isWords(e)||F(e)!==_)return L.primitiveFail();if(t=e.wordsAsInt32Array(),e=L.stackObjectValue(1),L.failed())return null;if(!L.isWords(e)||F(e)!==_)return L.primitiveFail();for(var r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k,S=e.wordsAsInt32Array(),y=t,I=new Array(64),O=0;O<=A-1;O++){for(r=-1,n=1;n<=A-1;n++)-1===r&&0!==S[n*A+O]&&(r=n);if(-1===r)for(i=S[O]*y[0]<<2,s=0;s<=A-1;s++)I[s*A+O]=i;else f=(m=((v=S[2*A+O]*y[2*A+O])+(g=S[6*A+O]*y[6*A+O]))*C)+g*(0-H),p=m+v*x,u=(a=(v=S[O]*y[O])+(g=S[4*A+O]*y[4*A+O])<<13)+p,h=a-p,l=(o=v-g<<13)+f,c=o-f,m=(a=S[7*A+O]*y[7*A+O])+(p=S[A+O]*y[A+O]),v=(o=S[5*A+O]*y[5*A+O])+(f=S[3*A+O]*y[3*A+O]),g=a+f,b=o+p,p*=W,a=(a*=P)+(m*=0-D)+(g=g*(0-K)+(k=(g+b)*U)),o=(o*=X)+(v*=0-Y)+(b=b*(0-w)+k),f=(f*=Z)+v+g,I[O]=u+(p=p+m+b)>>11,I[7*A+O]=u-p>>11,I[+A+O]=l+f>>11,I[6*A+O]=l-f>>11,I[2*A+O]=c+o>>11,I[5*A+O]=c-o>>11,I[3*A+O]=h+a>>11,I[4*A+O]=h-a>>11}for(O=0;O<=_-A;O+=A)v=I[O+2],g=I[O+6],u=(a=I[O]+I[O+4]<<13)+(p=(m=(v+g)*C)+v*x),h=a-p,l=(o=I[O]-I[O+4]<<13)+(f=m+g*(0-H)),c=o-f,a=I[O+7],o=I[O+5],f=I[O+3],m=a+(p=I[O+1]),v=o+f,g=a+f,a=(a*=P)+(m*=0-D)+(g=g*(0-K)+(k=(g+(b=o+p))*U)),o=(o*=X)+(v*=0-Y)+(b=b*(0-w)+k),f=(f*=Z)+v+g,p=(p*=W)+m+b,d=Math.min((u+p>>18)+T,E),d=Math.max(d,0),S[O]=d,d=Math.min((u-p>>18)+T,E),d=Math.max(d,0),S[O+7]=d,d=Math.min((l+f>>18)+T,E),d=Math.max(d,0),S[O+1]=d,d=Math.min((l-f>>18)+T,E),d=Math.max(d,0),S[O+6]=d,d=Math.min((c+o>>18)+T,E),d=Math.max(d,0),S[O+2]=d,d=Math.min((c-o>>18)+T,E),d=Math.max(d,0),S[O+5]=d,d=Math.min((h+a>>18)+T,E),d=Math.max(d,0),S[O+3]=d,d=Math.min((h-a>>18)+T,E),d=Math.max(d,0),S[O+4]=d;L.pop(2)}function be(e,t){return e<r(1,t-1)?e-r(1,t)+1:e}function ke(e){return!1!=((L=e).majorVersion()==t)&&L.minorVersion()>=B}function Se(e){return V(M,e)&&N(le,e)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:ke,primitiveIdctInt:ge,primitiveColorConvertMCU:me,primitiveColorConvertGrayscaleMCU:de,primitiveDecodeMCU:ve,getModuleName:he}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function S(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function p(e,t){return 0|Math.floor(e/t)}function s(e,t){return e-p(e,t)*t|0}var y=null,n=0,e="KedamaPlugin 3 November 2014 (e)",a=0,i=0,o=0,u=0;function b(e,t){var r;return 0===e?0<=t?90:270:(r=Math.atan(t/e),0<=e?0<=t?r/.0174532925199433:360+r/.0174532925199433:180+r/.0174532925199433)}function l(e){var e=90-e,t=e/360|0;return e<0&&--t,.0174532925199433*(e-360*t)}function c(){var e,t,r,i,s,n,a,o,u,l=y.stackValue(0),c=y.stackValue(1),h=y.stackValue(2),f=y.stackValue(3),p=y.stackIntegerValue(4),d=y.stackIntegerValue(5),m=y.stackValue(6);if(y.failed())return null;if(!y.isWords(m))return y.primitiveFail(),null;if(!y.isWords(f))return y.primitiveFail(),null;if(!y.isWords(h))return y.primitiveFail(),null;if(!y.isWords(c))return y.primitiveFail(),null;if(!y.isBytes(l))return y.primitiveFail(),null;if(p*d!==S(m))return y.primitiveFail(),null;if(i=S(f),S(h)!==i)return y.primitiveFail(),null;if(S(c)!==i)return y.primitiveFail(),null;if(S(l)!==i)return y.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),u=h.wordsAsFloat32Array(),e=c.words,s=l.bytes,t=m.words,r=0;r<=i-1;r++)n=0|a[r],o=0|u[r],0!==s[r]&&0<=n&&0<=o&&n<d&&o<p&&(t[o*d+n]=e[r]);if(y.failed())return null;y.pop(7)}function h(){var e,t,r,i,s,n=y.stackValue(0),a=y.stackValue(1);if(y.failed())return null;if(!y.isWords(a))return y.primitiveFail(),null;if(!y.isWords(n))return y.primitiveFail(),null;if(s=S(a),S(n)!==s)return y.primitiveFail(),null;for(t=a.wordsAsFloat32Array(),i=n.wordsAsFloat32Array(),r=0;r<=s-1;r++)e=t[r],0<(e=90-(e/=.0174532925199433))||(e+=360),i[r]=e;if(y.failed())return null;y.pop(2)}function f(){return e}function d(){var e=y.stackValue(0),t=y.stackIntegerValue(1);return y.failed()?null:!y.isWords(e)||S(e)<t?(y.primitiveFail(),null):(e=L(e.wordsAsFloat32Array()[t-1]),y.failed()?null:(y.pop(3),void y.pushFloat(e)))}function m(){n=17,o=p(i=2147483647,a=16807),u=s(i,a)}function v(e){var t=e<0?0-e:e,r=p(n,o),i=s(n,o),i=(65535&(n=a*i-u*r))*(t+1)>>>16;return e<0?0-i:i}function g(){var e=y.stackIntegerValue(0);if(y.failed())return null;n=65536&e,y.pop(1)}function k(){var e,t,r,i,s,n,a=y.stackIntegerValue(0),o=y.stackIntegerValue(1),u=y.stackValue(2),l=y.stackValue(3);if(y.failed())return null;if((t=S(l))!==S(u))return y.primitiveFail(),null;if(a<-32)return y.primitiveFail(),null;if(8<a)return y.primitiveFail(),null;for(e=l.words,i=u.words,r=0;r<=t-1;r++)s=e[r],s=s,(s=255<(s=(n=a)<0?n<-31?0:s>>>0-n:31<n?0:s<<n)?255:s)<0&&(s=0),i[r]=s<<24&4278190080|o;y.pop(4)}function I(){var e,t,r,i,s,n,a=y.stackValue(0),o=y.stackIntegerValue(1),u=y.stackValue(2),l=y.stackValue(3);if(y.failed())return null;if(a=a.words[0],y.failed())return null;if(n=Math.log(a),(r=S(l))!==S(u))return y.primitiveFail(),null;for(e=l.words,s=u.words,i=0;i<=r-1;i++)255<(t=0===(t=e[i])?0:255/n*Math.log(t)|0)&&(t=255),s[i]=t<<24&4278190080|o;y.pop(4)}function O(){var e,t,r,i,s,n,a,o=y.stackIntegerValue(0),u=y.stackIntegerValue(1),l=y.stackValue(2),c=y.stackValue(3),h=y.stackValue(4),f=y.stackValue(5);if(!y.isWords(l))return y.primitiveFail(),null;if(!y.isWords(c))return y.primitiveFail(),null;if(!y.isWords(h))return y.primitiveFail(),null;if(!y.isWords(f))return y.primitiveFail(),null;if(r=S(h),S(c)!==r)return y.primitiveFail(),null;if(S(l)!==r)return y.primitiveFail(),null;if(S(f)!==o*u)return y.primitiveFail(),null;for(n=c.wordsAsFloat32Array(),a=l.wordsAsFloat32Array(),i=h.words,t=f.words,e=0;e<=o*u-1;e++)t[e]=0;for(e=0;e<=r-1;e++)s=n[e],0<=(s=u*a[e]+s)&&s<o*u&&(t[s]=i[e]);if(y.failed())return null;y.pop(6)}function F(){var e=y.stackIntegerValue(0),t=y.stackIntegerValue(1),r=y.stackFloatValue(2),i=y.stackFloatValue(3),s=y.stackValue(4);return y.failed()?null:!y.isWords(s)||S(s)!==e*t?(y.primitiveFail(),null):(r=0|r,s=s.words,e=0<=(i=0|i)&&i<t&&0<=r&&r<e?s[r*t+i]:0,y.failed()?null:(y.pop(6),void y.pushInteger(e)))}function A(){var e,t=y.stackIntegerValue(0),r=y.stackIntegerValue(1),i=y.stackIntegerValue(2),s=y.stackFloatValue(3),n=y.stackFloatValue(4),a=y.stackValue(5);return y.failed()?null:!y.isWords(a)||S(a)!==t*r?(y.primitiveFail(),null):(s=0|s,(e=1073741823<(e=i)?1073741823:i)<0&&(e=0),i=a.words,0<=(a=0|n)&&a<r&&0<=s&&s<t&&(i[s*r+a]=e),y.failed()?null:void y.pop(6))}function _(){var e,t,r,i,s,n,a,o,u=y.stackValue(0),l=y.stackIntegerValue(1),c=y.stackIntegerValue(2),h=y.stackValue(3),f=y.stackValue(4),p=y.stackValue(5);if(y.failed())return null;if(!y.isWords(u))return y.primitiveFail(),null;if(!y.isWords(p))return y.primitiveFail(),null;if(!y.isWords(f))return y.primitiveFail(),null;if(!y.isWords(h))return y.primitiveFail(),null;if(l*c!==S(h))return y.primitiveFail(),null;if(i=S(p),S(f)!==i)return y.primitiveFail(),null;if(S(u)!==i)return y.primitiveFail(),null;for(n=p.wordsAsFloat32Array(),o=f.wordsAsFloat32Array(),t=u.words,e=h.words,r=0;r<=i-1;r++)s=0|n[r],a=0|o[r],0<=s&&0<=a&&s<c&&a<l&&(t[r]=e[a*c+s]);if(y.failed())return null;y.pop(6)}function P(){var e,t=y.stackIntegerValue(0),r=y.stackIntegerValue(1),i=y.stackIntegerValue(2),s=y.stackIntegerValue(3),n=y.stackFloatValue(4),a=y.stackFloatValue(5),o=y.stackFloatValue(6),u=y.stackValue(7),l=y.stackValue(8),c=y.stackValue(9),h=y.stackIntegerValue(10);return y.failed()?null:!y.isWords(c)||!y.isWords(l)||!y.isWords(u)||(e=S(c),S(l)!==e)||S(u)!==e?(y.primitiveFail(),null):(e=c.wordsAsFloat32Array(),c=l.wordsAsFloat32Array(),l=u.wordsAsFloat32Array(),o=e[u=h-1]+(h=o)*Math.cos(l[u]),h=c[u]-h*Math.sin(l[u]),M(u,e,l,o,a,s,i),V(u,c,l,h,n,r,t),y.failed()?null:void y.pop(11))}function w(){var e,t,r,i,s,n,a,o,u,l,c,h=y.stackValue(0),f=y.stackIntegerValue(1),p=y.stackIntegerValue(2),d=y.stackValue(3),m=y.stackValue(4),v=y.stackValue(5);if(y.failed())return null;if(!y.isWords(v))return y.primitiveFail(),null;if(!y.isWords(m))return y.primitiveFail(),null;if(!y.isWords(d))return y.primitiveFail(),null;if(f*p!==S(d))return y.primitiveFail(),null;if(s=S(v),S(m)!==s)return y.primitiveFail(),null;if((i="number"==typeof h)&&(r=h),!i){if(!y.isMemberOf(h,"WordArray"))return y.primitiveFail(),null;if(S(h)!==s)return y.primitiveFail(),null}for(u=v.wordsAsFloat32Array(),c=m.wordsAsFloat32Array(),i||(a=h.words),e=d.words,i&&(n=r),t=0;t<=s-1;t++)o=0|u[t],l=0|c[t],0<=o&&0<=l&&o<p&&l<f&&(i||(n=a[t]),e[l*p+o]=n);if(y.failed())return null;y.pop(6)}function C(){var e,t,r,i,s,n,a,o,u,l,c=y.stackIntegerValue(0),h=y.stackIntegerValue(1),f=y.stackIntegerValue(2),p=y.stackIntegerValue(3),d=y.stackFloatValue(4),m=y.stackFloatValue(5),v=y.stackValue(6),g=y.stackValue(7),b=y.stackValue(8),k=y.stackValue(9);if(y.failed())return null;if(!y.isWords(k))return y.primitiveFail(),null;if(!y.isWords(b))return y.primitiveFail(),null;if(!y.isWords(g))return y.primitiveFail(),null;if(v.isFloat)r=!1;else{if(!y.isWords(v))return y.primitiveFail(),null;r=!0}if(n=S(k),S(b)!==n)return y.primitiveFail(),null;if(S(g)!==n)return y.primitiveFail(),null;if(r&&S(v)!==n)return y.primitiveFail(),null;for(u=k.wordsAsFloat32Array(),l=b.wordsAsFloat32Array(),e=g.wordsAsFloat32Array(),r?o=v.wordsAsFloat32Array():a=y.floatValueOf(v),t=0;t<=n-1;t++)s=r?o[t]:a,i=u[t]+s*Math.cos(e[t]),s=l[t]-s*Math.sin(e[t]),M(t,u,e,i,m,p,f),V(t,l,e,s,d,h,c);if(y.failed())return null;y.pop(10)}function x(){var e,t,r,i,s,n,a,o,u,l,c,h=y.stackIntegerValue(0),f=y.stackIntegerValue(1),p=y.stackIntegerValue(2),d=y.stackValue(3),m=y.stackFloatValue(4),v=y.stackFloatValue(5),g=y.stackFloatValue(6);if(y.failed())return null;if(!y.isWords(d))return y.primitiveFail(),null;if(S(d)!==f*p)return y.primitiveFail(),null;for(e=d.words,d=v,v=Math.max(g,0),d=Math.max(d,0),v=Math.min(v,p-1),d=Math.min(d,f-1),o=Math.max(v-h,0),t=Math.min(v+h,p-1),g=Math.max(d-h,0),r=Math.min(d+h,f-1),i=e[d*p+v],s=-1,c=g;c<=r;c++)for(a=c*p,l=o;l<=t;l++)i<(u=e[a+l])&&(s=l,n=c,i=u);if(h=-1===s?L(m):b(s-v,n-d)+90|0,y.failed())return null;y.pop(8),y.pushFloat(h)}function E(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackObjectValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(h)),y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(a=S(h),y.success(a===S(f)),y.success(a===S(c)),y.failed())return null;if(s=y.isMemberOf(h,"WordArray"),n=y.isMemberOf(f,"WordArray"),s&&n){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]+o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]+e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]+o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]+e[i];y.pop(4),y.push(c)}function T(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(o=S(f),y.success(o===S(c)),y.failed())return null;if(n="number"==typeof h,a=y.isMemberOf(f,"WordArray"),n&&a){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=u[i]+s;else for(u=f.words,e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]+e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]+s;else for(t=f.wordsAsFloat32Array(),e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]+e;y.pop(4),y.push(c)}function N(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackObjectValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(h)),y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(a=S(h),y.success(a===S(f)),y.success(a===S(c)),y.failed())return null;if(s=y.isMemberOf(h,"WordArray"),n=y.isMemberOf(f,"WordArray"),s&&n){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]/o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]/e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]/o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]/e[i];y.pop(4),y.push(c)}function j(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(o=S(f),y.success(o===S(c)),y.failed())return null;if(n="number"==typeof h,a=y.isMemberOf(f,"WordArray"),n&&a){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=p(u[i],s);else for(u=f.words,e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]/e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]/s;else for(t=f.wordsAsFloat32Array(),e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]/e;y.pop(4),y.push(c)}function B(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackObjectValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(h)),y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(a=S(h),y.success(a===S(f)),y.success(a===S(c)),y.failed())return null;if(s=y.isMemberOf(h,"WordArray"),n=y.isMemberOf(f,"WordArray"),s&&n){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]*o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]*e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]*o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]*e[i];y.pop(4),y.push(c)}function R(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(o=S(f),y.success(o===S(c)),y.failed())return null;if(n="number"==typeof h,a=y.isMemberOf(f,"WordArray"),n&&a){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=u[i]*s;else for(u=f.words,e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]*e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]*s;else for(t=f.wordsAsFloat32Array(),e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]*e;y.pop(4),y.push(c)}function q(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackObjectValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(h)),y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(a=S(h),y.success(a===S(f)),y.success(a===S(c)),y.failed())return null;if(s=y.isMemberOf(h,"WordArray"),n=y.isMemberOf(f,"WordArray"),s&&n){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]-o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]-e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]-o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]-e[i];y.pop(4),y.push(c)}function D(){var e,t,r,i,s,n,a,o,u,l,c=y.stackObjectValue(0),h=y.stackValue(1),f=y.stackObjectValue(2);if(y.failed())return null;if(y.success(y.isWords(f)),y.success(y.isWords(c)),y.failed())return null;if(o=S(f),y.success(o===S(c)),y.failed())return null;if(n="number"==typeof h,a=y.isMemberOf(f,"WordArray"),n&&a){if(!y.isMemberOf(c,"WordArray"))return y.primitiveFail(),null}else if(!y.isMemberOf(c,"KedamaFloatArray"))return y.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=u[i]-s;else for(u=f.words,e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]-e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]-s;else for(t=f.wordsAsFloat32Array(),e=y.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]-e;y.pop(4),y.push(c)}function L(e){e=90-e/.0174532925199433;return 0<e||(e+=360),e}function U(){var e,t,r=y.stackFloatValue(0),i=y.stackValue(1),s=y.stackIntegerValue(2),n=y.stackIntegerValue(3),a=y.stackIntegerValue(4);if(y.failed())return null;if(!y.isWords(i))return y.primitiveFail(),null;if(!(s<=S(i)&&1<=n&&n<=s))return y.primitiveFail(),null;if(e=i.wordsAsFloat32Array(),y.failed())return null;for(t=n;t<=s;t++)e[t-1]=v(a)*r;y.pop(5)}function G(){var e,t,r=y.stackFloatValue(0),i=y.stackValue(1),s=y.stackIntegerValue(2),n=y.stackIntegerValue(3),a=y.stackIntegerValue(4);if(y.failed())return null;if(!y.isWords(i))return y.primitiveFail(),null;if(!(s<=S(i)&&1<=n&&n<=s))return y.primitiveFail(),null;if(t=i.words,y.failed())return null;for(e=n;e<=s;e++)t[e-1]=v(a)*r|0;y.pop(5)}function W(){var e=y.stackIntegerValue(0);return y.failed()||(e=v(e),y.failed())?null:(y.pop(2),void y.pushInteger(e))}function z(){var e=y.stackFloatValue(0),t=y.stackFloatValue(1),r=y.stackFloatValue(2),i=y.stackFloatValue(3);return y.failed()||(i=b(i-t,r-e),360<(i+=90)&&(i-=360),y.failed())?null:(y.pop(5),void y.pushFloat(i))}function H(){var e=y.stackFloatValue(0),t=y.stackFloatValue(1),r=y.stackFloatValue(2),i=y.stackFloatValue(3);return y.failed()||(t=t-i,i=e-r,e=Math.sqrt(t*t+i*i),y.failed())?null:(y.pop(5),void y.pushFloat(e))}function M(e,t,r,i,s,n,a){var o;i<0&&(1===n&&(i+=s),2===n&&(i=0),3===n)&&(i=0-i,o=r[e],r[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),s<=i&&(1===a&&(i-=s),2===a&&(i=s-1e-6),3===a)&&(i=s-1e-6-(i-s),o=r[e],r[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),t[e]=i}function V(e,t,r,i,s,n,a){i<0&&(1===n&&(i+=s),2===n&&(i=0),3===n)&&(i=0-i,r[e]=6.283185307179586-r[e]),s<=i&&(1===a&&(i-=s),2===a&&(i=s-1e-6),3===a)&&(i=s-1e-6-(i-s),r[e]=6.283185307179586-r[e]),t[e]=i}function K(){var e,t,r,i,s,n,a=y.stackValue(0),o=y.stackValue(1);if(y.failed())return null;if(!y.isWords(o))return y.primitiveFail(),null;if(n=S(o),a.isFloat)i=!1;else{if(!y.isWords(a))return y.primitiveFail(),null;if(S(a)!==n)return y.primitiveFail(),null;i=!0}for(t=o.wordsAsFloat32Array(),i?s=a.wordsAsFloat32Array():e=l(e=y.floatValueOf(a)),r=0;r<=n-1;r++)i&&(e=l(e=s[r])),t[r]=e;if(y.failed())return null;y.pop(2)}function X(e){return!1!=((y=e).majorVersion()==t)&&y.minorVersion()>=r}function Y(){var e=y.stackFloatValue(0),t=y.stackValue(1),r=y.stackIntegerValue(2);return y.failed()?null:!y.isWords(t)||S(t)<r?(y.primitiveFail(),null):(t.wordsAsFloat32Array()[r-1]=l(e),y.failed()?null:void y.pop(3))}function Z(){return!0}function J(){var e,t=y.stackIntegerValue(0),r=y.stackIntegerValue(1),i=y.stackFloatValue(2),s=y.stackFloatValue(3),n=y.stackValue(4),a=y.stackIntegerValue(5),o=y.stackValue(6);return y.failed()?null:!y.isWords(o)||!y.isWords(n)||(e=S(o),S(n)!==e)?(y.primitiveFail(),null):(M(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,i,r,t),y.failed()?null:void y.pop(7))}function Q(){var e,t=y.stackIntegerValue(0),r=y.stackIntegerValue(1),i=y.stackFloatValue(2),s=y.stackFloatValue(3),n=y.stackValue(4),a=y.stackIntegerValue(5),o=y.stackValue(6);return y.failed()?null:!y.isWords(o)||!y.isWords(n)||(e=S(o),S(n)!==e)?(y.primitiveFail(),null):(V(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,i,r,t),y.failed()?null:void y.pop(7))}function $(){var e,t,r,i,s,n,a,o=y.stackIntegerValue(0),u=y.stackIntegerValue(1),l=y.stackFloatValue(2),c=y.stackValue(3),h=y.stackValue(4),f=y.stackValue(5);if(y.failed())return null;if(!y.isWords(f))return y.primitiveFail(),null;if(!y.isWords(h))return y.primitiveFail(),null;if(c.isFloat)r=!1;else{if(!y.isWords(c))return y.primitiveFail(),null;r=!0}if(i=S(f),S(h)!==i)return y.primitiveFail(),null;if(r&&S(c)!==i)return y.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r?n=c.wordsAsFloat32Array():s=y.floatValueOf(c),t=0;t<=i-1;t++)M(t,a,e,r?n[t]:s,l,u,o);if(y.failed())return null;y.pop(6)}function ee(){var e,t,r,i,s,n,a,o=y.stackIntegerValue(0),u=y.stackIntegerValue(1),l=y.stackFloatValue(2),c=y.stackValue(3),h=y.stackValue(4),f=y.stackValue(5);if(y.failed())return null;if(!y.isWords(f))return y.primitiveFail(),null;if(!y.isWords(h))return y.primitiveFail(),null;if(c.isFloat)r=!1;else{if(!y.isWords(c))return y.primitiveFail(),null;r=!0}if(i=S(f),S(h)!==i)return y.primitiveFail(),null;if(r&&S(c)!==i)return y.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r?n=c.wordsAsFloat32Array():s=y.floatValueOf(c),t=0;t<=i-1;t++)V(t,a,e,r?n[t]:s,l,u,o);if(y.failed())return null;y.pop(6)}function te(){var e,t,r,i,s,n,a,o,u,l,c,h=y.stackValue(0),f=y.stackValue(1),p=y.stackValue(2),d=y.stackValue(3),m=y.stackValue(4);if(y.failed())return null;if(!y.isWords(h))return y.primitiveFail(),null;if(!y.isWords(p))return y.primitiveFail(),null;if(!y.isWords(f))return y.primitiveFail(),null;if((u=S(h))<0)return y.primitiveFail(),null;if(S(p)!==u)return y.primitiveFail(),null;if(S(f)!==u)return y.primitiveFail(),null;if(m.isFloat){if(!d.isFloat)return y.primitiveFail(),null;t=!1}else{if(d.isFloat)return y.primitiveFail(),null;t=!0}if(t){if(S(m)!==u)return y.primitiveFail(),null;if(S(d)!==u)return y.primitiveFail(),null}for(o=h.wordsAsFloat32Array(),l=p.wordsAsFloat32Array(),c=f.wordsAsFloat32Array(),t&&(r=m.wordsAsFloat32Array(),i=d.wordsAsFloat32Array()),t||(s=y.floatValueOf(m),n=y.floatValueOf(d)),e=0;e<=u-1;e++)t&&(s=r[e],n=i[e]),a=b(s-l[e],n-c[e]),360<(a+=90)&&(a-=360),o[e]=a;if(y.failed())return null;y.pop(6),y.push(h)}function re(){var e,t,r,i,s,n,a,o,u,l,c,h,f=y.stackValue(0),p=y.stackValue(1),d=y.stackValue(2),m=y.stackValue(3),v=y.stackValue(4);if(y.failed())return null;if(!y.isWords(f))return y.primitiveFail(),null;if(!y.isWords(d))return y.primitiveFail(),null;if(!y.isWords(p))return y.primitiveFail(),null;if((o=S(f))<0)return y.primitiveFail(),null;if(S(d)!==o)return y.primitiveFail(),null;if(S(p)!==o)return y.primitiveFail(),null;if(v.isFloat){if(!m.isFloat)return y.primitiveFail(),null;t=!1}else{if(m.isFloat)return y.primitiveFail(),null;t=!0}if(t){if(S(v)!==o)return y.primitiveFail(),null;if(S(m)!==o)return y.primitiveFail(),null}for(a=f.wordsAsFloat32Array(),l=d.wordsAsFloat32Array(),h=p.wordsAsFloat32Array(),t&&(r=v.wordsAsFloat32Array(),i=m.wordsAsFloat32Array()),t||(s=y.floatValueOf(v),n=y.floatValueOf(m)),e=0;e<=o-1;e++)t&&(s=r[e],n=i[e]),u=s-l[e],c=n-h[e],a[e]=Math.sqrt(u*u+c*c);if(y.failed())return null;y.pop(6),y.push(f)}function ie(){var e,t,r,i,s,n,a,o,u,l,c,h,f=y.stackIntegerValue(0),p=y.stackIntegerValue(1),d=y.stackIntegerValue(2),m=y.stackIntegerValue(3),v=y.stackValue(4),g=y.stackValue(5);if(y.failed())return null;if(u=S(g),i=S(v),m*d!==u)return y.primitiveFail(),null;if(u*p*f!==i)return y.primitiveFail(),null;for(n=g.words,t=v.words,c=r=o=a=0;c<=d-1;c++){for(h=0;h<=f-1;h++){for(l=0;l<=m-1;l++)for(e=n[a],++a,s=0;s<=p-1;s++)t[r]=e,++r;a=o}a=o+=m}y.pop(6)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:I,vectorGetDistanceTo:re,getScalarHeading:d,shutdownModule:Z,primitiveAddScalar:T,primSetPixelsAtXY:w,turtleScalarSetX:J,primPixelAtXY:F,primUpHill:x,primScalarForward:P,primitiveDivArrays:N,getModuleName:f,primitiveSubArrays:q,scalarGetAngleTo:z,randomRange:W,setInterpreter:X,kedamaSetRandomSeed:g,drawTurtlesInArray:c,turtleScalarSetY:Q,randomIntoIntegerArray:G,getHeadingArrayInto:h,makeTurtlesMap:O,setHeadingArrayFrom:K,turtlesSetX:$,setScalarHeading:Y,makeMask:k,primitiveDivScalar:j,primitiveSubScalar:D,primPixelsAtXY:_,vectorGetAngleTo:te,primitiveMulArrays:B,primPixelAtXYPut:A,zoomBitmap:ie,initialiseModule:m,primitiveAddArrays:E,scalarGetDistanceTo:H,turtlesSetY:ee,randomIntoFloatArray:U,primTurtlesForward:C,primitiveMulScalar:R}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function I(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function p(e,t){return 0|Math.floor(e/t)}function k(e,t){return e-p(e,t)*t|0}var O=null,s=0,e="KedamaPlugin2 13 November 2014 (e)",n=0,i=0,a=0,o=0;function b(e,t){var r;return 0===e?0<=t?90:270:(r=Math.atan(t/e),0<=e?0<=t?r/.0174532925199433:360+r/.0174532925199433:180+r/.0174532925199433)}function c(e){var e=90-e,t=e/360|0;return e<0&&--t,.0174532925199433*(e-360*t)}function u(){var e,t,r,i,s,n,a,o,u,l=O.stackValue(0),c=O.stackValue(1),h=O.stackValue(2),f=O.stackValue(3),p=O.stackIntegerValue(4),d=O.stackIntegerValue(5),m=O.stackValue(6);if(O.failed())return null;if(!O.isWords(m))return O.primitiveFail(),null;if(!O.isWords(f))return O.primitiveFail(),null;if(!O.isWords(h))return O.primitiveFail(),null;if(!O.isWords(c))return O.primitiveFail(),null;if(!O.isBytes(l))return O.primitiveFail(),null;if(p*d!==I(m))return O.primitiveFail(),null;if(i=I(f),I(h)!==i)return O.primitiveFail(),null;if(I(c)!==i)return O.primitiveFail(),null;if(I(l)!==i)return O.primitiveFail(),null;for(a=f.wordsAsFloat32Array(),u=h.wordsAsFloat32Array(),e=c.words,s=l.bytes,t=m.words,r=0;r<=i-1;r++)n=0|a[r],o=0|u[r],0!==s[r]&&0<=n&&0<=o&&n<d&&o<p&&(t[o*d+n]=e[r]);if(O.failed())return null;O.pop(7)}function l(){var e,t,r,i,s,n=O.stackValue(0),a=O.stackValue(1);if(O.failed())return null;if(!O.isWords(a))return O.primitiveFail(),null;if(!O.isWords(n))return O.primitiveFail(),null;if(s=I(a),I(n)!==s)return O.primitiveFail(),null;for(t=a.wordsAsFloat32Array(),i=n.wordsAsFloat32Array(),r=0;r<=s-1;r++)e=t[r],0<(e=90-(e/=.0174532925199433))||(e+=360),i[r]=e;if(O.failed())return null;O.pop(2)}function h(){return e}function f(){var e=O.stackValue(0),t=O.stackIntegerValue(1);return O.failed()?null:!O.isWords(e)||I(e)<t?(O.primitiveFail(),null):(e=L(e.wordsAsFloat32Array()[t-1]),O.failed()?null:(O.pop(3),void O.pushFloat(e)))}function d(){s=17,a=p(i=2147483647,n=16807),o=k(i,n)}function m(e){var t=e<0?0-e:e,r=p(s,a),i=k(s,a),i=(65535&(s=n*i-o*r))*(t+1)>>>16;return e<0?0-i:i}function v(){var e=O.stackIntegerValue(0);if(O.failed())return null;s=65536&e,O.pop(1)}function g(){var e,t,r,i,s,n,a=O.stackIntegerValue(0),o=O.stackIntegerValue(1),u=O.stackValue(2),l=O.stackValue(3);if(O.failed())return null;if((t=I(l))!==I(u))return O.primitiveFail(),null;if(a<-32)return O.primitiveFail(),null;if(8<a)return O.primitiveFail(),null;for(e=l.words,i=u.words,r=0;r<=t-1;r++)s=e[r],s=s,(s=255<(s=(n=a)<0?n<-31?0:s>>>0-n:31<n?0:s<<n)?255:s)<0&&(s=0),i[r]=s<<24&4278190080|o;O.pop(4)}function S(){var e,t,r,i,s,n,a=O.stackValue(0),o=O.stackIntegerValue(1),u=O.stackValue(2),l=O.stackValue(3);if(O.failed())return null;if(a=a.words[0],O.failed())return null;if(n=Math.log(a),(r=I(l))!==I(u))return O.primitiveFail(),null;for(e=l.words,s=u.words,i=0;i<=r-1;i++)255<(t=0===(t=e[i])?0:255/n*Math.log(t)|0)&&(t=255),s[i]=t<<24&4278190080|o;O.pop(4)}function y(){var e,t,r,i,s,n,a,o=O.stackIntegerValue(0),u=O.stackIntegerValue(1),l=O.stackValue(2),c=O.stackValue(3),h=O.stackValue(4),f=O.stackValue(5);if(!O.isWords(l))return O.primitiveFail(),null;if(!O.isWords(c))return O.primitiveFail(),null;if(!O.isWords(h))return O.primitiveFail(),null;if(!O.isWords(f))return O.primitiveFail(),null;if(r=I(h),I(c)!==r)return O.primitiveFail(),null;if(I(l)!==r)return O.primitiveFail(),null;if(I(f)!==o*u)return O.primitiveFail(),null;for(n=c.wordsAsFloat32Array(),a=l.wordsAsFloat32Array(),i=h.words,t=f.words,e=0;e<=o*u-1;e++)t[e]=0;for(e=0;e<=r-1;e++)s=n[e],0<=(s=u*a[e]+s)&&s<o*u&&(t[s]=i[e]);if(O.failed())return null;O.pop(6)}function F(){var e=O.stackIntegerValue(0),t=O.stackIntegerValue(1),r=O.stackFloatValue(2),i=O.stackFloatValue(3),s=O.stackValue(4);return O.failed()?null:!O.isWords(s)||I(s)!==e*t?(O.primitiveFail(),null):(r=0|r,s=s.words,e=0<=(i=0|i)&&i<t&&0<=r&&r<e?s[r*t+i]:0,O.failed()?null:(O.pop(6),void O.pushInteger(e)))}function A(){var e,t=O.stackIntegerValue(0),r=O.stackIntegerValue(1),i=O.stackIntegerValue(2),s=O.stackFloatValue(3),n=O.stackFloatValue(4),a=O.stackValue(5);return O.failed()?null:!O.isWords(a)||I(a)!==t*r?(O.primitiveFail(),null):(s=0|s,(e=1073741823<(e=i)?1073741823:i)<0&&(e=0),i=a.words,0<=(a=0|n)&&a<r&&0<=s&&s<t&&(i[s*r+a]=e),O.failed()?null:void O.pop(6))}function _(){var e,t,r,i,s,n,a,o,u=O.stackValue(0),l=O.stackIntegerValue(1),c=O.stackIntegerValue(2),h=O.stackValue(3),f=O.stackValue(4),p=O.stackValue(5);if(O.failed())return null;if(!O.isWords(u))return O.primitiveFail(),null;if(!O.isWords(p))return O.primitiveFail(),null;if(!O.isWords(f))return O.primitiveFail(),null;if(!O.isWords(h))return O.primitiveFail(),null;if(l*c!==I(h))return O.primitiveFail(),null;if(i=I(p),I(f)!==i)return O.primitiveFail(),null;if(I(u)!==i)return O.primitiveFail(),null;for(n=p.wordsAsFloat32Array(),o=f.wordsAsFloat32Array(),t=u.words,e=h.words,r=0;r<=i-1;r++)s=0|n[r],a=0|o[r],0<=s&&0<=a&&s<c&&a<l&&(t[r]=e[a*c+s]);if(O.failed())return null;O.pop(6)}function P(){var e,t=O.stackIntegerValue(0),r=O.stackIntegerValue(1),i=O.stackIntegerValue(2),s=O.stackIntegerValue(3),n=O.stackFloatValue(4),a=O.stackFloatValue(5),o=O.stackFloatValue(6),u=O.stackValue(7),l=O.stackValue(8),c=O.stackValue(9),h=O.stackIntegerValue(10);return O.failed()?null:!O.isWords(c)||!O.isWords(l)||!O.isWords(u)||(e=I(c),I(l)!==e)||I(u)!==e?(O.primitiveFail(),null):(e=c.wordsAsFloat32Array(),c=l.wordsAsFloat32Array(),l=u.wordsAsFloat32Array(),o=e[u=h-1]+(h=o)*Math.cos(l[u]),h=c[u]-h*Math.sin(l[u]),M(u,e,l,o,a,s,i),V(u,c,l,h,n,r,t),O.failed()?null:void O.pop(11))}function w(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p=O.stackValue(0),d=O.stackIntegerValue(1),m=O.stackIntegerValue(2),v=O.stackValue(3),g=O.stackValue(4),b=O.stackValue(5),k=O.stackValue(6);if(O.failed())return null;if(!O.isBytes(k))return O.primitiveFail(),null;if(!O.isWords(b))return O.primitiveFail(),null;if(!O.isWords(g))return O.primitiveFail(),null;if(!O.isWords(v))return O.primitiveFail(),null;if(d*m!==I(v))return O.primitiveFail(),null;if(a=I(b),I(k)!==a)return O.primitiveFail(),null;if(I(g)!==a)return O.primitiveFail(),null;if(n=k.bytes,c=b.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),i="number"==typeof p)o=p;else{if(I(p)!==a)return O.primitiveFail(),null;(s=O.isMemberOf(p,"WordArray"))?u=p.words:t=p.wordsAsFloat32Array()}for(e=v.words,r=0;r<=a-1;r++)1===n[r]&&(l=0|c[r],h=0|f[r],0<=l)&&0<=h&&l<m&&h<d&&(h=h*m+l,i?e[h]=o:s?e[h]=u[r]:(l=t[r],e[h]=l));if(O.failed())return null;O.pop(7)}function C(){var e,t,r,i,s,n,a,o,u,l,c,h=O.stackIntegerValue(0),f=O.stackIntegerValue(1),p=O.stackIntegerValue(2),d=O.stackIntegerValue(3),m=O.stackFloatValue(4),v=O.stackFloatValue(5),g=O.stackValue(6),b=O.stackValue(7),k=O.stackValue(8),S=O.stackValue(9),y=O.stackValue(10);if(O.failed())return null;if(!O.isBytes(y))return O.primitiveFail(),null;if(!O.isWords(S))return O.primitiveFail(),null;if(!O.isWords(k))return O.primitiveFail(),null;if(!O.isWords(b))return O.primitiveFail(),null;if(g.isFloat)r=!1;else{if(!O.isWords(g))return O.primitiveFail(),null;r=!0}if(a=I(S),I(k)!==a)return O.primitiveFail(),null;if(I(b)!==a)return O.primitiveFail(),null;if(I(y)!==a)return O.primitiveFail(),null;if(r&&I(g)!==a)return O.primitiveFail(),null;for(n=y.bytes,l=S.wordsAsFloat32Array(),c=k.wordsAsFloat32Array(),e=b.wordsAsFloat32Array(),r?u=g.wordsAsFloat32Array():o=O.floatValueOf(g),t=0;t<=a-1;t++)1===n[t]&&(s=r?u[t]:o,i=l[t]+s*Math.cos(e[t]),s=c[t]-s*Math.sin(e[t]),M(t,l,e,i,v,d,p),V(t,c,e,s,m,f,h));if(O.failed())return null;O.pop(11)}function x(){var e,t,r,i,s,n,a,o,u,l,c,h=O.stackIntegerValue(0),f=O.stackIntegerValue(1),p=O.stackIntegerValue(2),d=O.stackValue(3),m=O.stackFloatValue(4),v=O.stackFloatValue(5),g=O.stackFloatValue(6);if(O.failed())return null;if(!O.isWords(d))return O.primitiveFail(),null;if(I(d)!==f*p)return O.primitiveFail(),null;for(e=d.words,d=v,v=Math.max(g,0),d=Math.max(d,0),v=Math.min(v,p-1),d=Math.min(d,f-1),o=Math.max(v-h,0),t=Math.min(v+h,p-1),g=Math.max(d-h,0),r=Math.min(d+h,f-1),i=e[d*p+v],s=-1,c=g;c<=r;c++)for(a=c*p,l=o;l<=t;l++)i<(u=e[a+l])&&(s=l,n=c,i=u);if(h=-1===s?L(m):b(s-v,n-d)+90|0,O.failed())return null;O.pop(8),O.pushFloat(h)}function E(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackObjectValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(h)),O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(a=I(h),O.success(a===I(f)),O.success(a===I(c)),O.failed())return null;if(s=O.isMemberOf(h,"WordArray"),n=O.isMemberOf(f,"WordArray"),s&&n){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]+o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]+e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]+o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]+e[i];O.pop(4),O.push(c)}function T(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(o=I(f),O.success(o===I(c)),O.failed())return null;if(n="number"==typeof h,a=O.isMemberOf(f,"WordArray"),n&&a){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=u[i]+s;else for(u=f.words,e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]+e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]+s;else for(t=f.wordsAsFloat32Array(),e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]+e;O.pop(4),O.push(c)}function N(){var e,t,r,i,s,n,a=O.stackObjectValue(0),o=O.stackValue(1);if(O.failed())return null;if(O.success(O.isBytes(o)),O.success(O.isBytes(a)),O.failed())return null;if(r=I(o),i=I(a),O.failed())return null;for(i<(t=r)&&(t=i),s=a.bytes,n=o.bytes,e=0;e<=t-1;e++)n[e]=n[e]+s[e]===2;O.pop(1)}function j(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackObjectValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(h)),O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(a=I(h),O.success(a===I(f)),O.success(a===I(c)),O.failed())return null;if(s=O.isMemberOf(h,"WordArray"),n=O.isMemberOf(f,"WordArray"),s&&n){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]/o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]/e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]/o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]/e[i];O.pop(4),O.push(c)}function B(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(o=I(f),O.success(o===I(c)),O.failed())return null;if(n="number"==typeof h,a=O.isMemberOf(f,"WordArray"),n&&a){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=p(u[i],s);else for(u=f.words,e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]/e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]/s;else for(t=f.wordsAsFloat32Array(),e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]/e;O.pop(4),O.push(c)}function R(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackObjectValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(l)),O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(n=I(l),O.success(n===I(c)),O.success(n===I(u)),O.failed())return null;if(s=O.isMemberOf(l,"WordArray"),O.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]===a[i];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]===t[i];else if(s)for(r=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]===a[i];else for(r=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]===t[i];O.pop(4),O.push(u)}function q(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(a=I(c),O.success(a===I(u)),O.failed())return null;if(n="number"==typeof l,O.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]===s;else for(o=c.words,t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]===t;else if(n)for(r=c.wordsAsFloat32Array(),s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]===s;else for(r=c.wordsAsFloat32Array(),t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]===t;O.pop(4),O.push(u)}function D(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackObjectValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(l)),O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(n=I(l),O.success(n===I(c)),O.success(n===I(u)),O.failed())return null;if(s=O.isMemberOf(l,"WordArray"),O.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]>=a[i];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]>=t[i];else if(s)for(r=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]>=a[i];else for(r=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]>=t[i];O.pop(4),O.push(u)}function U(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(a=I(c),O.success(a===I(u)),O.failed())return null;if(n="number"==typeof l,O.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]>=s;else for(o=c.words,t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]>=t;else if(n)for(r=c.wordsAsFloat32Array(),s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]>=s;else for(r=c.wordsAsFloat32Array(),t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]>=t;O.pop(4),O.push(u)}function G(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackObjectValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(l)),O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(n=I(l),O.success(n===I(c)),O.success(n===I(u)),O.failed())return null;if(s=O.isMemberOf(l,"WordArray"),O.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]>a[i];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]>t[i];else if(s)for(r=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]>a[i];else for(r=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]>t[i];O.pop(4),O.push(u)}function W(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(a=I(c),O.success(a===I(u)),O.failed())return null;if(n="number"==typeof l,O.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]>s;else for(o=c.words,t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]>t;else if(n)for(r=c.wordsAsFloat32Array(),s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]>s;else for(r=c.wordsAsFloat32Array(),t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]>t;O.pop(4),O.push(u)}function z(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackObjectValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(l)),O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(n=I(l),O.success(n===I(c)),O.success(n===I(u)),O.failed())return null;if(s=O.isMemberOf(l,"WordArray"),O.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]<=a[i];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]<=t[i];else if(s)for(r=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]<=a[i];else for(r=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]<=t[i];O.pop(4),O.push(u)}function H(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(a=I(c),O.success(a===I(u)),O.failed())return null;if(n="number"==typeof l,O.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]<=s;else for(o=c.words,t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]<=t;else if(n)for(r=c.wordsAsFloat32Array(),s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]<=s;else for(r=c.wordsAsFloat32Array(),t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]<=t;O.pop(4),O.push(u)}function K(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackObjectValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(l)),O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(n=I(l),O.success(n===I(c)),O.success(n===I(u)),O.failed())return null;if(s=O.isMemberOf(l,"WordArray"),O.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]<a[i];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]<t[i];else if(s)for(r=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]<a[i];else for(r=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]<t[i];O.pop(4),O.push(u)}function X(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(a=I(c),O.success(a===I(u)),O.failed())return null;if(n="number"==typeof l,O.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]<s;else for(o=c.words,t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]<t;else if(n)for(r=c.wordsAsFloat32Array(),s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]<s;else for(r=c.wordsAsFloat32Array(),t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]<t;O.pop(4),O.push(u)}function Y(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackObjectValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(h)),O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(a=I(h),O.success(a===I(f)),O.success(a===I(c)),O.failed())return null;if(s=O.isMemberOf(h,"WordArray"),n=O.isMemberOf(f,"WordArray"),s&&n){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]*o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]*e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]*o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]*e[i];O.pop(4),O.push(c)}function Z(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(o=I(f),O.success(o===I(c)),O.failed())return null;if(n="number"==typeof h,a=O.isMemberOf(f,"WordArray"),n&&a){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=u[i]*s;else for(u=f.words,e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]*e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]*s;else for(t=f.wordsAsFloat32Array(),e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]*e;O.pop(4),O.push(c)}function J(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackObjectValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(l)),O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(n=I(l),O.success(n===I(c)),O.success(n===I(u)),O.failed())return null;if(s=O.isMemberOf(l,"WordArray"),O.isMemberOf(c,"WordArray"))if(s)for(o=c.words,a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]!==a[i];else for(o=c.words,t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=o[i]!==t[i];else if(s)for(r=c.wordsAsFloat32Array(),a=l.words,e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]!==a[i];else for(r=c.wordsAsFloat32Array(),t=l.wordsAsFloat32Array(),e=u.bytes,i=0;i<=n-1;i++)e[i]=r[i]!==t[i];O.pop(4),O.push(u)}function Q(){var e,t,r,i,s,n,a,o,u=O.stackObjectValue(0),l=O.stackValue(1),c=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(c)),O.success(O.isBytes(u)),O.failed())return null;if(a=I(c),O.success(a===I(u)),O.failed())return null;if(n="number"==typeof l,O.isMemberOf(c,"WordArray"))if(n)for(o=c.words,s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]!==s;else for(o=c.words,t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=o[i]!==t;else if(n)for(r=c.wordsAsFloat32Array(),s=l,e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]!==s;else for(r=c.wordsAsFloat32Array(),t=O.floatValueOf(l),e=u.bytes,i=0;i<=a-1;i++)e[i]=r[i]!==t;O.pop(4),O.push(u)}function $(){var e,t,r,i=O.stackValue(0);if(O.failed())return null;if(O.success(O.isBytes(i)),O.failed())return null;if(t=I(i),O.failed())return null;for(r=i.bytes,e=0;e<=t-1;e++)0===r[e]?r[e]=1:r[e]=0}function ee(){var e,t,r,i,s,n,a=O.stackObjectValue(0),o=O.stackValue(1);if(O.failed())return null;if(O.success(O.isBytes(o)),O.success(O.isBytes(a)),O.failed())return null;if(r=I(o),i=I(a),O.failed())return null;for(i<(t=r)&&(t=i),s=a.bytes,n=o.bytes,e=0;e<=t-1;e++)n[e]=0<n[e]+s[e];O.pop(1)}function te(){var e,t,r,i,s,n=O.stackValue(0),a=O.stackObjectValue(1);if(O.failed())return null;if(r=O.isIntegerValue(n)?n:O.booleanValueOf(n),s=O.fetchPointerofObject(1,a),n=O.fetchPointerofObject(0,a),O.failed())return null;if(!O.isBytes(n))return O.primitiveFail(),null;if(!O.isBytes(s))return O.primitiveFail(),null;for(i=s.bytes,t=n.bytes,e=0;e<=I(s)-1;e++)1===t[e]&&(i[e]=r);O.pop(1)}function re(){var e,t,r,i,s=O.stackIntegerValue(0),n=O.stackObjectValue(1);if(O.failed())return null;if(s|=4278190080,i=O.fetchPointerofObject(1,n),n=O.fetchPointerofObject(0,n),O.failed())return null;if(!O.isBytes(n))return O.primitiveFail(),null;if(!O.isWords(i))return O.primitiveFail(),null;for(r=i.words,t=n.bytes,e=0;e<=I(i)-1;e++)1===t[e]&&(r[e]=s);O.pop(1)}function ie(){var e,t,r,i,s=O.stackFloatValue(0),n=O.stackObjectValue(1);if(O.failed())return null;if(i=O.fetchPointerofObject(1,n),n=O.fetchPointerofObject(0,n),O.failed())return null;if(!O.isBytes(n))return O.primitiveFail(),null;if(!O.isWords(i))return O.primitiveFail(),null;for(r=i.wordsAsFloat32Array(),t=n.bytes,e=0;e<=I(i)-1;e++)1===t[e]&&(r[e]=s);O.pop(1)}function se(){var e,t,r,i,s=O.stackValue(0),n=O.stackObjectValue(1);if(O.failed())return null;if(i=O.fetchPointerofObject(1,n),n=O.fetchPointerofObject(0,n),O.failed())return null;if(!O.isBytes(n))return O.primitiveFail(),null;if(!O.isPointers(i))return O.primitiveFail(),null;for(r=i.wordsAsInt32Array(),t=n.bytes,e=0;e<=I(i)-1;e++)1===t[e]&&(r[e]=s);O.pop(1)}function ne(){var e,t,r,i,s,n=O.stackIntegerValue(0),a=O.stackObjectValue(1),o=O.stackIntegerValue(2),u=O.stackIntegerValue(3),l=O.stackObjectValue(4);if(O.failed())return null;if(s=O.fetchPointerofObject(1,l),l=O.fetchPointerofObject(0,l),O.failed())return null;if(!O.isBytes(l))return O.primitiveFail(),null;if(!O.isBytes(s)||!O.isBytes(a))return O.primitiveFail(),null;if(i=s.bytes,t=l.bytes,r=a.bytes,s=I(s),l=I(l),a=I(a),o<u)return O.primitiveFail(),null;if(u<1)return O.primitiveFail(),null;if(s<u)return O.primitiveFail(),null;if(l<u)return O.primitiveFail(),null;if(s<o)return O.primitiveFail(),null;if(l<o)return O.primitiveFail(),null;if(n<1)return O.primitiveFail(),null;if(a<n)return O.primitiveFail(),null;if(a-n+1<o-u+1)return O.primitiveFail(),null;for(e=u-1;e<=o-1;e++)1===t[e]&&(i[e]=r[n+e-u]);O.pop(4)}function ae(){var e,t,r,i,s,n,a,o,u,l,c=O.stackIntegerValue(0),h=O.stackObjectValue(1),f=O.stackIntegerValue(2),p=O.stackIntegerValue(3),d=O.stackObjectValue(4);if(O.failed())return null;if(u=O.fetchPointerofObject(1,d),d=O.fetchPointerofObject(0,d),O.failed())return null;if(!O.isBytes(d))return O.primitiveFail(),null;if(!(O.isWords(u)&&O.isWords(h)||O.isPointers(u)&&O.isPointers(h)))return O.primitiveFail(),null;if(s=d.bytes,l=I(u),d=I(d),a=I(h),f<p)return O.primitiveFail(),null;if(p<1)return O.primitiveFail(),null;if(l<p)return O.primitiveFail(),null;if(d<p)return O.primitiveFail(),null;if(l<f)return O.primitiveFail(),null;if(d<f)return O.primitiveFail(),null;if(c<1)return O.primitiveFail(),null;if(a<c)return O.primitiveFail(),null;if(a-c+1<f-p+1)return O.primitiveFail(),null;if(l=O.isMemberOf(u,"KedamaFloatArray"),d=O.isMemberOf(h,"KedamaFloatArray"),l&&d)for(t=u.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),i=p-1;i<=f-1;i++)1===s[i]&&(t[i]=e[c+i-p]);if(l&&!d)for(t=u.wordsAsFloat32Array(),n=h.words,i=p-1;i<=f-1;i++)1===s[i]&&(t[i]=n[c+i-p]);if(!l&&d)for(o=u.words,e=h.wordsAsFloat32Array(),i=p-1;i<=f-1;i++)1===s[i]&&(r=e[c+i-p]>>>0,o[i]=r);if(!l&&!d)for(o=u.words,n=h.words,i=p-1;i<=f-1;i++)1===s[i]&&(o[i]=n[c+i-p]);O.pop(4)}function oe(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v=O.stackObjectValue(0),g=O.stackObjectValue(1),b=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(g)),O.success(O.isWords(b)),O.success(O.isWords(v)),O.failed())return null;if(l=I(g),O.success(l===I(b)),O.success(l===I(v)),O.failed())return null;if(o=O.isMemberOf(g,"WordArray"),u=O.isMemberOf(b,"WordArray"),o&&u){if(!O.isMemberOf(v,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(v,"KedamaFloatArray"))return O.primitiveFail(),null;if(u)if(o)for(d=b.words,p=g.words,m=v.words,a=0;a<=l-1;a++)f=k(h=d[a],c=p[a]),m[a]=f;else for(d=b.words,i=g.wordsAsFloat32Array(),n=v.wordsAsFloat32Array(),a=0;a<=l-1;a++)r=(h=d[a])/(e=i[a]),r=Math.floor(r),n[a]=h-r*e;else if(o)for(s=b.wordsAsFloat32Array(),p=g.words,n=v.wordsAsFloat32Array(),a=0;a<=l-1;a++)r=(t=s[a])/(c=p[a]),r=Math.floor(r),n[a]=t-r*c;else for(s=b.wordsAsFloat32Array(),i=g.wordsAsFloat32Array(),n=v.wordsAsFloat32Array(),a=0;a<=l-1;a++)r=(t=s[a])/(e=i[a]),r=Math.floor(r),n[a]=t-r*e;O.pop(4),O.push(v)}function ue(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p=O.stackObjectValue(0),d=O.stackValue(1),m=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(m)),O.success(O.isWords(p)),O.failed())return null;if(l=I(m),O.success(l===I(p)),O.failed())return null;if(o="number"==typeof d,u=O.isMemberOf(m,"WordArray"),o&&u){if(!O.isMemberOf(p,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(p,"KedamaFloatArray"))return O.primitiveFail(),null;if(u)if(o)for(h=m.words,a=d,f=p.words,n=0;n<=l-1;n++)f[n]=k(h[n],a);else for(h=m.words,e=O.floatValueOf(d),s=p.wordsAsFloat32Array(),n=0;n<=l-1;n++)r=(c=h[n])/e,r=Math.floor(r),s[n]=c-r*e;else if(o)for(i=m.wordsAsFloat32Array(),a=d,s=p.wordsAsFloat32Array(),n=0;n<=l-1;n++)r=(t=i[n])/a,r=Math.floor(r),s[n]=t-r*a;else for(i=m.wordsAsFloat32Array(),e=O.floatValueOf(d),s=p.wordsAsFloat32Array(),n=0;n<=l-1;n++)r=(t=i[n])/e,r=Math.floor(r),s[n]=t-r*e;O.pop(4),O.push(p)}function le(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackObjectValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(h)),O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(a=I(h),O.success(a===I(f)),O.success(a===I(c)),O.failed())return null;if(s=O.isMemberOf(h,"WordArray"),n=O.isMemberOf(f,"WordArray"),s&&n){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(n)if(s)for(u=f.words,o=h.words,l=c.words,i=0;i<=a-1;i++)l[i]=u[i]-o[i];else for(u=f.words,e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=u[i]-e[i];else if(s)for(t=f.wordsAsFloat32Array(),o=h.words,r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]-o[i];else for(t=f.wordsAsFloat32Array(),e=h.wordsAsFloat32Array(),r=c.wordsAsFloat32Array(),i=0;i<=a-1;i++)r[i]=t[i]-e[i];O.pop(4),O.push(c)}function ce(){var e,t,r,i,s,n,a,o,u,l,c=O.stackObjectValue(0),h=O.stackValue(1),f=O.stackObjectValue(2);if(O.failed())return null;if(O.success(O.isWords(f)),O.success(O.isWords(c)),O.failed())return null;if(o=I(f),O.success(o===I(c)),O.failed())return null;if(n="number"==typeof h,a=O.isMemberOf(f,"WordArray"),n&&a){if(!O.isMemberOf(c,"WordArray"))return O.primitiveFail(),null}else if(!O.isMemberOf(c,"KedamaFloatArray"))return O.primitiveFail(),null;if(a)if(n)for(u=f.words,s=h,l=c.words,i=0;i<=o-1;i++)l[i]=u[i]-s;else for(u=f.words,e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=u[i]-e;else if(n)for(t=f.wordsAsFloat32Array(),s=h,r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]-s;else for(t=f.wordsAsFloat32Array(),e=O.floatValueOf(h),r=c.wordsAsFloat32Array(),i=0;i<=o-1;i++)r[i]=t[i]-e;O.pop(4),O.push(c)}function L(e){e=90-e/.0174532925199433;return 0<e||(e+=360),e}function he(){var e,t,r=O.stackFloatValue(0),i=O.stackValue(1),s=O.stackIntegerValue(2),n=O.stackIntegerValue(3),a=O.stackIntegerValue(4);if(O.failed())return null;if(!O.isWords(i))return O.primitiveFail(),null;if(!(s<=I(i)&&1<=n&&n<=s))return O.primitiveFail(),null;if(e=i.wordsAsFloat32Array(),O.failed())return null;for(t=n;t<=s;t++)e[t-1]=m(a)*r;O.pop(5)}function fe(){var e,t,r=O.stackFloatValue(0),i=O.stackValue(1),s=O.stackIntegerValue(2),n=O.stackIntegerValue(3),a=O.stackIntegerValue(4);if(O.failed())return null;if(!O.isWords(i))return O.primitiveFail(),null;if(!(s<=I(i)&&1<=n&&n<=s))return O.primitiveFail(),null;if(t=i.words,O.failed())return null;for(e=n;e<=s;e++)t[e-1]=m(a)*r|0;O.pop(5)}function pe(){var e=O.stackIntegerValue(0);return O.failed()||(e=m(e),O.failed())?null:(O.pop(2),void O.pushInteger(e))}function de(){var e=O.stackFloatValue(0),t=O.stackFloatValue(1),r=O.stackFloatValue(2),i=O.stackFloatValue(3);return O.failed()||(i=b(i-t,r-e),360<(i+=90)&&(i-=360),O.failed())?null:(O.pop(5),void O.pushFloat(i))}function me(){var e=O.stackFloatValue(0),t=O.stackFloatValue(1),r=O.stackFloatValue(2),i=O.stackFloatValue(3);return O.failed()||(t=t-i,i=e-r,e=Math.sqrt(t*t+i*i),O.failed())?null:(O.pop(5),void O.pushFloat(e))}function M(e,t,r,i,s,n,a){var o;i<0&&(1===n&&(i+=s),2===n&&(i=0),3===n)&&(i=0-i,o=r[e],r[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),s<=i&&(1===a&&(i-=s),2===a&&(i=s-1e-6),3===a)&&(i=s-1e-6-(i-s),o=r[e],r[e]=o<3.141592653589793?3.141592653589793-o:9.42477796076938-o),t[e]=i}function V(e,t,r,i,s,n,a){i<0&&(1===n&&(i+=s),2===n&&(i=0),3===n)&&(i=0-i,r[e]=6.283185307179586-r[e]),s<=i&&(1===a&&(i-=s),2===a&&(i=s-1e-6),3===a)&&(i=s-1e-6-(i-s),r[e]=6.283185307179586-r[e]),t[e]=i}function ve(){var e,t,r,i,s,n,a,o=O.stackValue(0),u=O.stackValue(1),l=O.stackValue(2);if(O.failed())return null;if(!O.isBytes(l))return O.primitiveFail(),null;if(!O.isWords(u))return O.primitiveFail(),null;if(a=I(u),o.isFloat)i=!1;else{if(!O.isWords(o))return O.primitiveFail(),null;if(I(o)!==a)return O.primitiveFail(),null;i=!0}for(s=l.bytes,t=u.wordsAsFloat32Array(),i?n=o.wordsAsFloat32Array():e=c(e=O.floatValueOf(o)),r=0;r<=a-1;r++)1===s[r]&&(i&&(e=c(e=n[r])),t[r]=e);if(O.failed())return null;O.pop(3)}function ge(e){return!1!=((O=e).majorVersion()==t)&&O.minorVersion()>=r}function be(){var e=O.stackFloatValue(0),t=O.stackValue(1),r=O.stackIntegerValue(2);return O.failed()?null:!O.isWords(t)||I(t)<r?(O.primitiveFail(),null):(t.wordsAsFloat32Array()[r-1]=c(e),O.failed()?null:void O.pop(3))}function ke(){return!0}function Se(){var e,t=O.stackIntegerValue(0),r=O.stackIntegerValue(1),i=O.stackFloatValue(2),s=O.stackFloatValue(3),n=O.stackValue(4),a=O.stackIntegerValue(5),o=O.stackValue(6);return O.failed()?null:!O.isWords(o)||!O.isWords(n)||(e=I(o),I(n)!==e)?(O.primitiveFail(),null):(M(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,i,r,t),O.failed()?null:void O.pop(7))}function ye(){var e,t=O.stackIntegerValue(0),r=O.stackIntegerValue(1),i=O.stackFloatValue(2),s=O.stackFloatValue(3),n=O.stackValue(4),a=O.stackIntegerValue(5),o=O.stackValue(6);return O.failed()?null:!O.isWords(o)||!O.isWords(n)||(e=I(o),I(n)!==e)?(O.primitiveFail(),null):(V(a-1,o.wordsAsFloat32Array(),n.wordsAsFloat32Array(),s,i,r,t),O.failed()?null:void O.pop(7))}function Ie(){var e,t,r,i,s,n,a,o,u,l,c=O.stackIntegerValue(0),h=O.stackIntegerValue(1),f=O.stackFloatValue(2),p=O.stackValue(3),d=O.stackValue(4),m=O.stackValue(5),v=O.stackValue(6);if(O.failed())return null;if(!O.isBytes(v))return O.primitiveFail(),null;if(!O.isWords(m))return O.primitiveFail(),null;if(!O.isWords(d))return O.primitiveFail(),null;if(p.isFloat)r=!1;else{if(!O.isWords(p))return O.primitiveFail(),null;r=!0,i=O.isMemberOf(p,"WordArray")}if(n=I(m),I(v)!==n)return O.primitiveFail(),null;if(I(d)!==n)return O.primitiveFail(),null;if(r&&I(p)!==n)return O.primitiveFail(),null;for(s=v.bytes,l=m.wordsAsFloat32Array(),e=d.wordsAsFloat32Array(),r?i?u=p.words:o=p.wordsAsFloat32Array():a=O.floatValueOf(p),t=0;t<=n-1;t++)1===s[t]&&M(t,l,e,r?(i?u:o)[t]:a,f,h,c);if(O.failed())return null;O.pop(7)}function Oe(){var e,t,r,i,s,n,a,o,u,l,c=O.stackIntegerValue(0),h=O.stackIntegerValue(1),f=O.stackFloatValue(2),p=O.stackValue(3),d=O.stackValue(4),m=O.stackValue(5),v=O.stackValue(6);if(O.failed())return null;if(!O.isBytes(v))return O.primitiveFail(),null;if(!O.isWords(m))return O.primitiveFail(),null;if(!O.isWords(d))return O.primitiveFail(),null;if(p.isFloat)r=!1;else{if(!O.isWords(p))return O.primitiveFail(),null;r=!0,i=O.isMemberOf(p,"WordArray")}if(n=I(m),I(v)!==n)return O.primitiveFail(),null;if(I(d)!==n)return O.primitiveFail(),null;if(r&&I(p)!==n)return O.primitiveFail(),null;for(s=v.bytes,l=m.wordsAsFloat32Array(),e=d.wordsAsFloat32Array(),r?i?u=p.words:o=p.wordsAsFloat32Array():a=O.floatValueOf(p),t=0;t<=n-1;t++)1===s[t]&&V(t,l,e,r?(i?u:o)[t]:a,f,h,c);if(O.failed())return null;O.pop(7)}function Fe(){var e,t,r,i,s,n,a,o,u,l,c,h=O.stackValue(0),f=O.stackValue(1),p=O.stackValue(2),d=O.stackValue(3),m=O.stackValue(4);if(O.failed())return null;if(!O.isWords(h))return O.primitiveFail(),null;if(!O.isWords(p))return O.primitiveFail(),null;if(!O.isWords(f))return O.primitiveFail(),null;if((u=I(h))<0)return O.primitiveFail(),null;if(I(p)!==u)return O.primitiveFail(),null;if(I(f)!==u)return O.primitiveFail(),null;if(m.isFloat){if(!d.isFloat)return O.primitiveFail(),null;t=!1}else{if(d.isFloat)return O.primitiveFail(),null;t=!0}if(t){if(I(m)!==u)return O.primitiveFail(),null;if(I(d)!==u)return O.primitiveFail(),null}for(o=h.wordsAsFloat32Array(),l=p.wordsAsFloat32Array(),c=f.wordsAsFloat32Array(),t&&(r=m.wordsAsFloat32Array(),i=d.wordsAsFloat32Array()),t||(s=O.floatValueOf(m),n=O.floatValueOf(d)),e=0;e<=u-1;e++)t&&(s=r[e],n=i[e]),a=b(s-l[e],n-c[e]),360<(a+=90)&&(a-=360),o[e]=a;if(O.failed())return null;O.pop(6),O.push(h)}function Ae(){var e,t,r,i,s,n,a,o,u,l,c,h,f=O.stackValue(0),p=O.stackValue(1),d=O.stackValue(2),m=O.stackValue(3),v=O.stackValue(4);if(O.failed())return null;if(!O.isWords(f))return O.primitiveFail(),null;if(!O.isWords(d))return O.primitiveFail(),null;if(!O.isWords(p))return O.primitiveFail(),null;if((o=I(f))<0)return O.primitiveFail(),null;if(I(d)!==o)return O.primitiveFail(),null;if(I(p)!==o)return O.primitiveFail(),null;if(v.isFloat){if(!m.isFloat)return O.primitiveFail(),null;t=!1}else{if(m.isFloat)return O.primitiveFail(),null;t=!0}if(t){if(I(v)!==o)return O.primitiveFail(),null;if(I(m)!==o)return O.primitiveFail(),null}for(a=f.wordsAsFloat32Array(),l=d.wordsAsFloat32Array(),h=p.wordsAsFloat32Array(),t&&(r=v.wordsAsFloat32Array(),i=m.wordsAsFloat32Array()),t||(s=O.floatValueOf(v),n=O.floatValueOf(m)),e=0;e<=o-1;e++)t&&(s=r[e],n=i[e]),u=s-l[e],c=n-h[e],a[e]=Math.sqrt(u*u+c*c);if(O.failed())return null;O.pop(6),O.push(f)}function _e(){var e,t,r,i,s,n,a,o,u,l,c,h,f=O.stackIntegerValue(0),p=O.stackIntegerValue(1),d=O.stackIntegerValue(2),m=O.stackIntegerValue(3),v=O.stackValue(4),g=O.stackValue(5);if(O.failed())return null;if(u=I(g),i=I(v),m*d!==u)return O.primitiveFail(),null;if(u*p*f!==i)return O.primitiveFail(),null;for(n=g.words,t=v.words,c=r=o=a=0;c<=d-1;c++){for(h=0;h<=f-1;h++){for(l=0;l<=m-1;l++)for(e=n[a],++a,s=0;s<=p-1;s++)t[r]=e,++r;a=o}a=o+=m}O.pop(6)}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:E,getModuleName:h,primitiveMulArrays:Y,drawTurtlesInArray:u,primitiveGTScalar:W,setScalarHeading:be,primitiveSubScalar:ce,turtleScalarSetY:ye,vectorGetAngleTo:Fe,primitiveRemArrays:oe,primitiveLTArrays:K,primitiveAddScalar:T,primPixelsAtXY:_,primitiveMulScalar:Z,primSetPixelsAtXY:w,setHeadingArrayFrom:ve,primPixelAtXYPut:A,makeMaskLog:S,primitiveLTScalar:X,scalarGetAngleTo:de,primitiveOrByteArray:ee,primitiveLEArrays:z,primitiveRemScalar:ue,getHeadingArrayInto:l,turtlesSetX:Ie,primitivePredicateReplaceBytes:ne,primitiveDivArrays:j,makeMask:g,primitiveLEScalar:H,kedamaSetRandomSeed:v,randomIntoIntegerArray:fe,setInterpreter:ge,primitivePredicateAtAllPutColor:re,makeTurtlesMap:y,randomIntoFloatArray:he,primUpHill:x,shutdownModule:ke,primitiveDivScalar:B,primitiveGEArrays:D,primitiveNotByteArray:$,randomRange:pe,initialiseModule:d,getScalarHeading:f,primPixelAtXY:F,primitivePredicateAtAllPutNumber:ie,primitiveEQArrays:R,primitiveNEArrays:J,primScalarForward:P,vectorGetDistanceTo:Ae,turtlesSetY:Oe,turtleScalarSetX:Se,primTurtlesForward:C,primitiveGEScalar:U,primitiveAndByteArray:N,primitivePredicateReplaceWords:ae,primitiveGTArrays:G,primitivePredicateAtAllPutObject:se,primitiveEQScalar:q,primitivePredicateAtAllPutBoolean:te,zoomBitmap:_e,primitiveNEScalar:Q,scalarGetDistanceTo:me,primitiveSubArrays:le}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function ne(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function f(e,t){return e-(0|Math.floor(e/t))*t|0}var ae=46,oe=34,ue=47,le=35,ce=48,he=36,fe=49,pe=37,de=38,me=45,ve=9,ge=50,be=13,ke=17,Se=40,ye=19,Ie=41,Oe=21,Fe=42,Ae=23,_e=43,Pe=25,we=44,Ce=27,xe=29,Ee=31,Te=33,Le=39,p=4,b=1e-4,d=0,Me=12,C=16,x=18,E=20,Ve=22,Ne=24,k=1,je=26,Be=28,Re=10,qe=30,De=32,Ue=51,S=2,m=3.141592653589793,Ge=12,We=3,ze=13,He=7,Ke=4,Xe=14,Ye=8,Ze=5,Je=15,Qe=9,$e=6,et=16,tt=10,rt=17,it=11,st=18,nt=19,y=7,I=8,at=20,ot=1,ut=21,v=6,lt=24,ct=22,ht=2,ft=23,O=3,pt=11,T=5,L=0,M=0,V=0,N=0,j=0,B=null,R=0,q=null,e="Klatt 3 November 2014 (e)",D=0,U=0,G=0,W=0,z=0,H=0,K=null,X=0,dt=0,Y=0,Z=0,J=0,mt=0,Q=0,$=0;function vt(e,t,r){var r=(0-m)/Y*r,i=Math.exp(r),s=0-i*i;r=2*m/Y*t,t=(0-(t=i*Math.cos(r)*2))*(i=1/(1-t-s)),s=(0-s)*i,a(e,i),u(e,t),c(e,s)}function gt(e,t){var r,i=n(e)*t+o(e)*(r=h(e))+l(e)*A(e);return _(e,r),F(e,t),i}function bt(e){return q.success(q.isWords(e)),q.failed()?0:e.wordsAsFloat32Array()}function i(){return e}function kt(){var e;if(0===J)return 0;if(Q=W<G?(e=L*Q+M*$,$=Q,e):e=V*Q-N,J<=W)if((W=0)<B[d]){H=B[d];var t,r,i,s,n,a,o,u,l=X/Y,c=Math.sin(2*m*12.7*l),h=Math.sin(2*m*7.1*l),l=Math.sin(2*m*4.7*l),c=2*B[k]*B[d]/100*(c+h+l),h=(H=(H+=c)+(te()-32767)*B[S]/32768*B[d],0===f(z,2)?H+=B[p]*B[d]*(1-B[v]):H-=B[p]*B[d]*(1-B[v]),U=J=Y/(H=H<0?0:H)|0,0<B[T]&&(U>>=1),G=J*B[v]|0,B[v]),l=B[y],c=B[I];for(r=(h=J*h|0)/J,c=c,t=(l=l)<=0?1:1-(t=(1-r)/l)/(Math.exp(t)-1),c=m*(c+1),s=Math.cos(c),i=Math.sin(c),s=((e,t,r,i)=>{var s,n,a,o,u,l,c;if(0<(o=g(0,e,t,r,i)))for(u=0,s=o,n=g(l=1,e,t,r,i);0<n;)u=l,s=n,n=g(l*=2,e,t,r,i);else for(l=0,s=g(u=-1,e,t,r,i),n=o;s<0;)l=u,n=s,s=g(u*=2,e,t,r,i);for(;b<l-u;)0<(a=g(c=(l+u)/2,e,t,r,i))?(u=c,s=a):(l=c,n=a);return(l+u)/2})(c,s,i,l/r*c*t),i=c/h,r=Math.exp(s*i),L=2*Math.cos(i)*r,M=0-r*r,$=0,Q=r*Math.sin(i),t=Math.exp(-1/(l*J)),c=Math.pow(t,J-h),N=(1-(V=t))*c/(1-c),a=0,o=Q,u=$,n=1;n<=G;n++)a=L*o+M*u,u=o,o=a;0!==a&&(Q=Q/a*1e4),0<(Q+=(te()-32767)*B[O]/32768*Q)&&(Q=0),0!==f(z,2)&&0<(Q*=1-B[p])&&(Q=0),z=f(z+1,65535)}else U=J=1;return++W,e}function ee(e){return 32.767*Math.pow(2,(e-87)/6)}function te(){return Z=1309*Z+13849&65535}function s(){var e,t=bt(q.stackValue(2));if(v=w=q.stackValue(1),q.success(q.isWords(v)),v=q.failed()?0:v.wordsAsInt16Array(),b=q.stackIntegerValue(0),q.failed())return null;if(e=q.stackObjectValue(3),P=e,q.success(22===ne(P)),q.failed()||(A=q.fetchPointerofObject(0,P),K=bt(A),H=q.fetchFloatofObject(2,P),J=q.fetchIntegerofObject(3,P),W=q.fetchIntegerofObject(4,P),G=q.fetchIntegerofObject(5,P),U=q.fetchIntegerofObject(6,P),L=q.fetchFloatofObject(7,P),M=q.fetchFloatofObject(8,P),Q=q.fetchFloatofObject(9,P),$=q.fetchFloatofObject(10,P),V=q.fetchFloatofObject(11,P),N=q.fetchFloatofObject(12,P),R=q.fetchFloatofObject(13,P),mt=q.fetchFloatofObject(14,P),D=q.fetchFloatofObject(15,P),z=q.fetchIntegerofObject(16,P),X=q.fetchIntegerofObject(17,P),Z=q.fetchIntegerofObject(18,P),j=q.fetchIntegerofObject(19,P),dt=q.fetchIntegerofObject(20,P),Y=q.fetchIntegerofObject(21,P),!1!==q.failed()))return null;if(q.success(2*ne(w)>=dt),q.failed())return null;var r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k,S,y,I,O,F,A=t,_=v,P=b,w=A;for(w=.6*ee((B=A)[me]),t=.6*ee(B[ge]),v=.4*ee(B[ae]),b=.15*ee(B[ue]),S=.06*ee(B[ce]),I=.04*ee(B[fe]),g=.15*ee(B[oe]),k=.06*ee(B[le]),y=.04*ee(B[he]),O=.022*ee(B[pe]),F=.03*ee(B[de]),8<=j&&(16e3<=Y?re(nt,7500,600):j=6),7<=j&&(16e3<=Y?re(st,6500,500):j=6),6<=j&&re(rt,B[Ne],B[Pe]),5<=j&&re(et,B[Ve],B[Ae]),re(Je,B[E],B[Oe]),re(Xe,B[x],B[ye]),re(ze,B[C],B[ke]),re(Ge,B[Me],B[be]),re(at,B[je],B[Ce]),re(ct,B[qe],B[Ee]),vt(ut,B[Be],B[xe]),vt(ft,B[De],B[Te]),ie(ot,B[je],B[Ce],w),ie(ht,B[qe],B[Ee],t),ie(We,B[Me],B[be],v),ie(Ke,B[C],B[ke],b),ie(Ze,B[x],B[ye],S),ie($e,B[E],B[Oe],I),ie(He,B[C],B[Se],g),ie(Ye,B[x],B[Ie],k),ie(Qe,B[E],B[Fe],y),ie(tt,B[Ve],B[_e],O),ie(it,B[Ne],B[we],F),0<H?(m=ee(B[T]-7),l=ee(B[T]),p=.1*ee(B[pt])):m=l=p=0,n=.25*ee(B[Re]),i=.05*ee(B[ve]),s=.05*ee(B[Le]),(A=B[Ue]-3)<=0&&(A=57),r=ee(A),ie(lt,0,Y,r),o=D,f=dt+(a=P)-1;a<=f;)o=(te()-32768)/4,D=o+=.75*D,U<W&&(o*=.5),h=n*o,d=kt(),mt=d,W<G&&(d+=p*(te()-32768)/4),c=m*d,d=l*d,d+=u=i*o,u=(e=>0<j?(e=gt(ut,e),e=se(at,e),e=gt(ft,e),e=se(ct,e),8<=j&&(e=se(nt,e)),7<=j&&(e=se(st,e)),6<=j&&(e=se(rt,e)),5<=j&&(e=se(et,e)),4<=j&&(e=se(Je,e)),3<=j&&(e=se(Xe,e)),2<=j&&(e=se(ze,e)),1<=j?se(Ge,e):e):0)(c+=u),u+=(e=>se(We,e)+se(Ke,e)+se(Ze,e)+se($e,e)+se(ot,e)+se(ht,e))(c=d),c=h+d-R,R=d,u=(e=>se(He,e)-se(Ye,e)+se(Qe,e)-se(tt,e)+se(it,e))(c)-u,u=se(lt,u=s*c-u),32767<(h=(h=u*r|0)<-32768?-32768:h)&&(h=32767),_[a-1]=h,++a,++X;if(!(e=>{var t,r,i,s,n,a,o,u,l,c;return q.pushRemappableOop(e),q.pushRemappableOop(q.floatObjectOf(H)),q.pushRemappableOop(q.floatObjectOf(L)),q.pushRemappableOop(q.floatObjectOf(M)),q.pushRemappableOop(q.floatObjectOf(Q)),q.pushRemappableOop(q.floatObjectOf($)),q.pushRemappableOop(q.floatObjectOf(V)),q.pushRemappableOop(q.floatObjectOf(N)),q.pushRemappableOop(q.floatObjectOf(R)),q.pushRemappableOop(q.floatObjectOf(mt)),e=q.floatObjectOf(D),u=q.popRemappableOop(),n=q.popRemappableOop(),s=q.popRemappableOop(),i=q.popRemappableOop(),c=q.popRemappableOop(),l=q.popRemappableOop(),r=q.popRemappableOop(),t=q.popRemappableOop(),o=q.popRemappableOop(),a=q.popRemappableOop(),!q.failed()&&(q.storePointerofObjectwithValue(2,a,o),q.storeIntegerofObjectwithValue(3,a,J),q.storeIntegerofObjectwithValue(4,a,W),q.storeIntegerofObjectwithValue(5,a,G),q.storeIntegerofObjectwithValue(6,a,U),q.storePointerofObjectwithValue(7,a,t),q.storePointerofObjectwithValue(8,a,r),q.storePointerofObjectwithValue(9,a,l),q.storePointerofObjectwithValue(10,a,c),q.storePointerofObjectwithValue(11,a,i),q.storePointerofObjectwithValue(12,a,s),q.storePointerofObjectwithValue(13,a,n),q.storePointerofObjectwithValue(14,a,u),q.storePointerofObjectwithValue(15,a,e),q.storeIntegerofObjectwithValue(16,a,z),q.storeIntegerofObjectwithValue(17,a,X),q.storeIntegerofObjectwithValue(18,a,Z),!1===q.failed())})(e))return null;q.pop(3)}function g(e,t,r,i,s){return Math.exp(e*t)*((s*(e*e+1)+e)*i-r)+1}function re(e,t,r){var r=(0-m)/Y*r,i=Math.exp(r),s=0-i*i;r=2*m/Y*t,a(e,1-(t=i*Math.cos(r)*2)-s),u(e,t),c(e,s)}function ie(e,t,r,i){re(e,t,r),a(e,n(e)*i)}function se(e,t){var r=n(e)*t+o(e)*(t=h(e))+l(e)*A(e);return _(e,t),F(e,r),r}function n(e){return K[5*e-5]}function a(e,t){K[5*e-5]=t}function o(e){return K[5*e-4]}function u(e,t){K[5*e-4]=t}function l(e){return K[5*e-3]}function c(e,t){K[5*e-3]=t}function h(e){return K[5*e-2]}function F(e,t){K[5*e-2]=t}function A(e){return K[5*e-1]}function _(e,t){K[5*e-1]=t}function P(e){return!1!=((q=e).majorVersion()==t)&&q.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("Klatt",{setInterpreter:P,primitiveSynthesizeFrameIntoStartingAt:s,getModuleName:i}):self.setTimeout(e,100)}()})(),(()=>{var t=1,w=11;function v(e){return"number"==typeof e?T.classSmallInteger():e.sqClass}function C(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function x(e,t){return 0|Math.floor(e/t)}function E(e,t){return e-x(e,t)*t|0}function p(e,t){return 31<t?0:e<<t}function d(e,t){return 31<t?0:e>>>t}var m=0,T=null,s="LargeIntegers v1.5 (e)",g=1,b=2;function R(e,t,r){var i,s,n,a;if(t<1||r<1)return T.primitiveFail();if(s=e,!((e=Math.min(r,o(s.bytes,C(s))))<t)){if(r=1+(t-1>>3),i=1+(e-1>>3),t=E(t-1,8),e=7-E(e-1,8),r==i)return n=p(255,t)&d(255,e),0!=(y(s,r)&n);if(0!==d(y(s,r),t))return 1;for(a=1+r;a<=i-1;a++)if(0!==y(s,a))return 1;return 0!=(255&p(y(s,i),e))}}function u(e,t){var r=T.instantiateClassindexableSize(v(e),t),i=C(e),i=i<t?i:t;return l(e.bytes,r.bytes,i),r}function L(e,t){var r;if("number"==typeof e){var i,s,n,a=(r=e)<0?T.classLargeNegativeInteger():T.classLargePositiveInteger(),a=T.instantiateClassindexableSize(a,t),o=r;for(i=a.bytes,s=1,n=c(o);s<=n;s++)i[s-1]=h(o,s)}else a=u(e,t);return a}function I(e,t,r){for(var i,s,n=r-1;0<=n;){if((s=t[n])!==(i=e[n]))return s<i?1:-1;--n}return 0}function l(e,t,r){for(var i=r-1,s=0;s<=i;s++)t[s]=e[s]}function o(e,t){for(var r,i=t;0===(r=e[i-1]);)if(0==--i)return 0;return M(r)+8*(i-1)}function c(e){return e<256&&-256<e?1:e<65536&&-65536<e?2:e<16777216&&-16777216<e?3:4}function h(e,t){return t<1&&T.primitiveFail(),4<t?0:e<0?255&d(0-e,8*(t-1)):255&d(e,8*(t-1))}function k(e,t,r,i,s){for(var n=r-t+1,a=0;a<n;a++)e[a+t]=i[a+s];return 0}function M(e){var t=0;return e<65536||(e>>>=16,t+=16),e<256||(e>>>=8,t+=8),e<16||(e>>>=4,t+=4),e<4||(e>>>=2,t+=2),e<2||(e>>>=1,++t),t+e}function S(e){for(var t=e,e=t<0?T.classLargeNegativeInteger():T.classLargePositiveInteger(),r=c(t),e=T.instantiateClassindexableSize(e,r),i=e.bytes,s=1;s<=r;s++)i[s-1]=h(t,s);return e}function V(e,t){var r,i,s=C(e);return 0===(i=o(e.bytes,s))?0:(i=i+t+7>>3,r=T.instantiateClassindexableSize(v(e),i),((e,t,r,i,s)=>{for(var n,a,o,u=e>>3,l=E(e,8),c=u-1,h=0;h<=c;h++)i[h]=0;if(0===l)return k(i,u,s-1,t,0);for(o=8-l,c=r-1,h=n=0;h<=c;h++)a=t[h],i[h+u]=255&(n|p(a,l)),n=d(a,o);0!==n&&(i[s-1]=n)})(t,e.bytes,s,r.bytes,i),r)}function N(e,t,r){var i,r=o(e.bytes,r),s=r+7>>3,r=r-t;return r<=0?T.instantiateClassindexableSize(v(e),0):(r=7+r>>3,i=T.instantiateClassindexableSize(v(e),r),((e,t,r,i,s)=>{var n,a,o,u,l,c,h=e>>3,f=E(e,8);if(0===f)return k(i,0,s-1,t,h);for(u=8-f,a=d(t[h],f),l=r-1,n=c=1+h;n<=l;n++)o=t[n],i[n-c]=255&(a|p(o,u)),a=d(o,f);0!==a&&(i[s-1]=a)})(t,e.bytes,s,i.bytes,r),i)}function r(e,t){var r,i,s,n=C(e),a=C(t),o=v(e),t=n<=a?(i=e,r=n,s=t,a):(i=t,r=a,s=e,n),a=T.instantiateClassindexableSize(o,t),e=((e,t,r,i,s)=>{for(var n=0,a=t-1,o=0;o<=a;o++)n=(n>>>8)+e[o]+r[o],s[o]=255&n;for(a=i-1,o=t;o<=a;o++)n=(n>>>8)+r[o],s[o]=255&n;return n>>>8})(i.bytes,r,s.bytes,t,a.bytes);return 0<e&&(n=T.instantiateClassindexableSize(o,t+1),l(a.bytes,n.bytes,t),(a=n).bytes[t]=e),a}function i(e,t,r){var i,s,n;if("number"==typeof e){if(e<0)return T.primitiveFail();l=S(e)}else{if(v(e)===T.classLargeNegativeInteger())return T.primitiveFail();l=e}if("number"==typeof t){if(t<0)return T.primitiveFail();o=S(t)}else{if(v(t)===T.classLargeNegativeInteger())return T.primitiveFail();o=t}var a,t=(e=C(l))<(t=C(o))?(i=e,s=l,n=t,o):(i=t,s=o,n=e,l),o=T.instantiateClassindexableSize(T.classLargePositiveInteger(),n),e=r,u=s.bytes,l=i,c=t.bytes,r=n,h=o.bytes,f=l-1;if(e===m){for(a=0;a<=f;a++)h[a]=u[a]&c[a];for(f=r-1,a=l;a<=f;a++)h[a]=0}else if(e===g){for(a=0;a<=f;a++)h[a]=u[a]|c[a];for(f=r-1,a=l;a<=f;a++)h[a]=c[a]}else if(e===b){for(a=0;a<=f;a++)h[a]=u[a]^c[a];for(f=r-1,a=l;a<=f;a++)h[a]=c[a]}else T.primitiveFail();return T.failed()?0:P(o)}function n(e,t){var r=C(e),i=C(t);return i!==r?r<i?-1:1:I(e.bytes,t.bytes,r)}function a(e,t,r){var i,s=C(e),n=C(t),r=r?T.classLargeNegativeInteger():T.classLargePositiveInteger(),a=s-n+1;if(a<=0)i=T.instantiateClassindexableSize(T.classArray(),2),T.stObjectatput(i,1,0),T.stObjectatput(i,2,e);else{n=L(n=V(t,t=8-M(B(t,n))),j(n)+1),j(e=V(e,t))===s&&(e=L(e,s+1));for(var o,u,l,c,h,f,p,d,m,v,g,s=T.instantiateClassindexableSize(r,a),b=n.bytes,k=j(n),S=e.bytes,y=j(e),I=s.bytes,O=j(s),F=k-1,A=O,_=b[F-1],P=1==F?0:b[F-2],w=1;w<=A;w++){if(S[(d=y+1-w)-1]===_)u=255;else for(g=E(v=(S[d-1]<<8)+S[d-2],_),h=(v=(u=x(v,_))*P)>>>8,c=255&v,f=d<3?0:S[d-3];;){if(!((g<h||g===h&&f<c)&&(--u,c<P?(--h,c=c+256-P):c-=P,_<=h)))break;h-=_}for(p=d-F,l=0,m=1;m<=k;m++)h=b[m-1]*(u>>>8),o=S[p-1]-l-(255&(c=b[m-1]*(255&u))),S[p-1]=255&o,l=h+(c>>>8)-(o>>=8),++p;if(0<l)for(--u,p=d-F,l=0,m=1;m<=k;m++)l=(l>>>8)+S[p-1]+b[m-1],S[p-1]=255&l,++p;I[O-w]=u}e=N(e,t,j(n)-1),i=T.instantiateClassindexableSize(T.classArray(),2),T.stObjectatput(i,1,s),T.stObjectatput(i,2,e)}return i}function j(e){return("number"==typeof e?c:C)(e)}function q(e,t,r,i){var s=C(e),n=C(t),a=C(r);if(!(s<=a))return T.primitiveFail();if(!(n<=a))return T.primitiveFail();if(!(0<=i&&i<=255))return T.primitiveFail();for(var o,u,l,c=T.instantiateClassindexableSize(T.classLargePositiveInteger(),a),h=e.bytes,e=s,f=t.bytes,p=n,d=r.bytes,s=a,m=i,v=c.bytes,g=e-1,b=p-1,k=s-1,S=0,y=0;y<=g;y++){for(l=v[0]+h[y]*f[0],l+=(u=l*m&255)*d[0],o=1;o<=b;o++)l=(l>>>8)+v[o]+h[y]*f[o]+u*d[o],v[o-1]=255&l;for(o=p;o<=k;o++)l=(l>>>8)+v[o]+u*d[o],v[o-1]=255&l;v[k]=255&(l=(l>>>8)+S),S=l>>>8}for(y=e;y<=k;y++){for(l=v[0],l+=(u=l*m&255)*d[0],o=1;o<=k;o++)l=(l>>>8)+v[o]+u*d[o],v[o-1]=255&l;v[k]=255&(l=(l>>>8)+S),S=l>>>8}if(0!==S||1!==I(d,v,s))for(y=l=0;y<=k;y++)l=l+v[y]-d[y],v[y]=255&l,l>>=8;return P(c)}function f(e,t,r){var i,s,n,a,o,u,l,c,h,f,p,d=C(e),m=C(t),t=d<=m?(n=e,s=d,i=t,m):(n=t,s=m,i=e,d),m=r?T.classLargeNegativeInteger():T.classLargePositiveInteger(),e=T.instantiateClassindexableSize(m,t+s),v=n.bytes,d=s,g=i.bytes,r=t,b=e.bytes;if(!(1===d&&0===v[0]||1===r&&0===g[0]))for(p=d-1,h=r-1,c=0;c<=p;c++)if(0!==(u=v[c])){for(f=c,o=l=0;o<=h;o++)l=(a=g[o]*u+l+b[f])>>>8,b[f]=255&a,++f;b[f]=l}return A(e)}function y(e,t){return t>C(e)?0:B(e,t)}function O(e,t){var r,i,s,n,a=v(e)===T.classLargeNegativeInteger(),o=C(e),u=C(t);if(o===u){for(;1<o&&y(e,o)===y(t,o);)--o;u=o}for(var u=o<u||o===u&&y(e,o)<y(t,o)?(i=t,n=u,s=e,r=o,!1==a):(i=e,n=o,s=t,r=u,a),a=n,a=T.instantiateClassindexableSize(u?T.classLargeNegativeInteger():T.classLargePositiveInteger(),a),l=s.bytes,c=r,h=i.bytes,f=n,p=a.bytes,d=0,m=0;m<=c-1;m++)d=d+h[m]-l[m],p[m]=255&d,d>>=8;for(m=c;m<=f-1;m++)d+=h[m],p[m]=255&d,d>>=8;return(u?_:P)(a)}function D(){return s}function F(e){var t,r;if("number"==typeof e)return 1;if(0!==(r=j(e))&&0!==B(e,r)){if(4<r)return 1;if(!(r<4)){if(v(e)===T.classLargePositiveInteger())return B(e,4)>h(1073741823,4);if(!(B(e,4)<h(-1073741824,4)))for(t=1;t<=4;t++)if(B(e,t)!==h(-1073741824,t))return 1}}}function A(e){return(v(e)===T.classLargePositiveInteger()?P:_)(e)}function _(e){for(var t,r,i,s,n=i=j(e);0!==n&&0===B(e,n);)--n;if(0===n)return 0;if(n<=4){if(r=-1073741824,n<4||y(e,4)<h(r,4)){for(s=0,t=n;1<=t;t+=-1)s=256*s-B(e,t);return s}for(t=1;t<=4;t++)if(y(e,t)!==h(r,t))return n<i?u(e,n):e;return r}return n<i?u(e,n):e}function P(e){for(var t,r,i,s=i=j(e);0!==s&&0===B(e,s);)--s;if(0===s)return 0;if(s<=4&&y(e,4)<=h(1073741823,4)){for(r=0,t=s;1<=t;t+=-1)r=256*r+B(e,t);return r}return s<i?u(e,s):e}function U(){var e,t=T.stackIntegerValue(1),r=T.stackIntegerValue(0);return T.success(T.isKindOfInteger(T.stackValue(2))),e=T.stackValue(2),T.failed()||(e=R("number"==typeof e?S(e):e,t,r)?T.trueObject():T.falseObject(),T.failed())||T.popthenPush(3,e),null}function G(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.failed()||("number"==typeof e?(t=S(e),T.failed()||T.popthenPush(2,t)):T.failed()||T.popthenPush(2,e)),null}function W(){var e=T.trueObject();return T.failed()||T.popthenPush(1,e),null}function z(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(1))),e=T.stackValue(1),t=T.stackIntegerValue(0),T.failed()||(e="number"==typeof e?S(e):e,t=0<=t?V(e,t):A(N(e,0-t,C(e))),T.failed())||T.popthenPush(3,t),null}function H(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.failed()||(t=r("number"==typeof t?S(t):t,"number"==typeof e?S(e):e),T.failed())||T.popthenPush(2,t),null}function K(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.failed()||(t=r("number"==typeof t?S(t):t,"number"==typeof e?S(e):e),T.failed())||T.popthenPush(3,t),null}function X(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.failed()||(t=i(t,e,m),T.failed())||T.popthenPush(2,t),null}function Y(){var e,t,r;return T.success(T.isKindOfInteger(T.stackValue(2))),r=T.stackValue(2),T.success(T.isKindOfInteger(T.stackValue(1))),e=T.stackValue(1),t=T.stackIntegerValue(0),T.failed()||(r=i(r,e,t),T.failed())||T.popthenPush(4,r),null}function Z(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.failed()||(t=i(t,e,g),T.failed())||T.popthenPush(2,t),null}function J(){var e,t=T.stackIntegerValue(0);return T.success(T.isKindOfInteger(T.stackValue(1))),e=T.stackValue(1),T.failed()||(e="number"==typeof e?S(e):e,t=0<=t?V(e,t):A(N(e,0-t,C(e))),T.failed())||T.popthenPush(2,t),null}function Q(){var e,t=T.stackIntegerValue(0);return T.success(T.isKindOfInteger(T.stackValue(1))),e=T.stackValue(1),T.failed()||(e="number"==typeof e?S(e):e,t=0<=t?V(e,t):A(N(e,0-t,C(e))),T.failed())||T.popthenPush(2,t),null}function $(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.failed()||(t=i(t,e,b),T.failed())||T.popthenPush(2,t),null}function ee(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.failed()||(t="number"==typeof t?"number"==typeof e?t>e?1:t<e?-1:0:-1:"number"==typeof e?1:n(t,e),T.failed())||T.popthenPush(2,t),null}function te(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.failed()||(t="number"==typeof t?"number"==typeof e?t>e?1:t<e?-1:0:-1:"number"==typeof e?1:n(t,e),T.failed())||T.popthenPush(3,t),null}function re(){var e,t,r,i;if(T.success(T.isKindOfInteger(T.stackValue(1))),i=T.stackValue(1),r=T.booleanValueOf(T.stackValue(0)),T.success(T.isKindOfInteger(T.stackValue(2))),e=T.stackValue(2),!T.failed())if(F(e))if(F(i)){if(e="number"==typeof e?S(e):e,"number"==typeof i){if(0===i)return T.primitiveFail(),null;t=S(i)}else t=i;i=a(e,t,r),T.failed()||T.popthenPush(3,i)}else T.primitiveFail();else T.primitiveFail();return null}function ie(){var e,t,r,i;if(T.success(T.isKindOfInteger(T.stackValue(2))),t=T.stackValue(2),T.success(T.isKindOfInteger(T.stackValue(1))),i=T.stackValue(1),r=T.booleanValueOf(T.stackValue(0)),!T.failed()){if(t="number"==typeof t?S(t):t,"number"==typeof i){if(0===i)return T.primitiveFail(),null;e=S(i)}else e=i;i=a(t,e,r),T.failed()||T.popthenPush(4,i)}return null}function se(){var e,t,r;return T.success(T.isKindOfInteger(T.stackValue(1))),e=T.stackValue(1),t=T.booleanValueOf(T.stackValue(0)),T.success(T.isKindOfInteger(T.stackValue(2))),r=T.stackValue(2),T.failed()||(r=f("number"==typeof r?S(r):r,"number"==typeof e?S(e):e,t),T.failed())||T.popthenPush(3,r),null}function ne(){var e,t,r;return T.success(T.isKindOfInteger(T.stackValue(2))),r=T.stackValue(2),T.success(T.isKindOfInteger(T.stackValue(1))),e=T.stackValue(1),t=T.booleanValueOf(T.stackValue(0)),T.failed()||(r=f("number"==typeof r?S(r):r,"number"==typeof e?S(e):e,t),T.failed())||T.popthenPush(4,r),null}function ae(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.failed()||(t=O("number"==typeof t?S(t):t,"number"==typeof e?S(e):e),T.failed())||T.popthenPush(2,t),null}function oe(){var e,t;return T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.failed()||(t=O("number"==typeof t?S(t):t,"number"==typeof e?S(e):e),T.failed())||T.popthenPush(3,t),null}function ue(){for(var e=s.length,t=T.instantiateClassindexableSize(T.classString(),e),r=t.bytes,i=0;i<=e-1;i++)r[i]=s[i];return T.failed()||T.popthenPush(1,t),null}function le(){var e,t,r,i;return T.success(T.isKindOfInteger(T.stackValue(2))),e=T.stackValue(2),T.success(T.isKindOfInteger(T.stackValue(1))),t=T.stackValue(1),r=T.stackIntegerValue(0),T.success(T.isKindOfInteger(T.stackValue(3))),i=T.stackValue(3),T.failed()||(i=q("number"==typeof i?S(i):i,"number"==typeof e?S(e):e,"number"==typeof t?S(t):t,r),T.failed())||T.popthenPush(4,i),null}function ce(){var e;return T.success(T.isKindOfInteger(T.stackValue(0))),e=T.stackValue(0),T.failed()||("number"==typeof e?T.failed()||T.popthenPush(2,e):(e=A(e),T.failed()||T.popthenPush(2,e))),null}function he(){var e;return T.success(T.stackValue(0).sqClass===T.classLargeNegativeInteger()),e=T.stackValue(0),T.failed()||(e=_(e),T.failed())||T.popthenPush(1,e),null}function fe(){var e;return T.success(T.stackValue(0).sqClass===T.classLargePositiveInteger()),e=T.stackValue(0),T.failed()||(e=P(e),T.failed())||T.popthenPush(1,e),null}function pe(e){return!1!=((T=e).majorVersion()==t)&&T.minorVersion()>=w}function B(e,t){return e.bytes[t-1]}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:K,primDigitBitShiftMagnitude:Q,primGetModuleName:ue,primDigitBitLogicWithOp:Y,primCheckIfCModuleExists:W,primDigitCompare:ee,primDigitMultiplyNegative:se,primDigitBitShift:J,primNormalizePositive:fe,primDigitSubtractWith:oe,_primDigitBitShift:z,primDigitMultiplyWithNegative:ne,primDigitSubtract:ae,primDigitDivNegative:re,primNormalizeNegative:he,primDigitBitOr:Z,primMontgomeryTimesModulo:le,primDigitBitAnd:X,primDigitDivWithNegative:ie,setInterpreter:pe,primNormalize:ce,primDigitBitXor:$,primDigitCompareWith:te,primDigitAdd:H,getModuleName:D,primAsLargeInteger:G,primAnyBitFromTo:U}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function h(e){return"number"==typeof e?p.classSmallInteger():e.sqClass}function f(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}var p=null,d=0,m=0,v=0,g=0,e="Matrix2x3Plugin 3 November 2014 (e)";function i(){return e}function b(e){return p.failed()?null:p.isWords(e)&&6===f(e)?e.wordsAsFloat32Array():(p.primitiveFail(),null)}function k(e){var t,r;if(!p.failed())return h(e)===p.classPoint()&&((t="number"==typeof(r=p.fetchPointerofObject(0,e)))||r.isFloat)&&(d=t?r:p.floatValueOf(r),(t="number"==typeof(r=p.fetchPointerofObject(1,e)))||r.isFloat)?void(m=t?r:p.floatValueOf(r)):p.primitiveFail()}function S(e){var t=d-e[2],r=m-e[5],i=e[0]*e[4]-e[1]*e[3];if(0==i)return p.primitiveFail();v=(t*e[4]-e[1]*r)*(i=1/i),g=(e[0]*r-t*e[3])*i}function y(e){v=d*e[0]+m*e[1]+e[2],g=d*e[3]+m*e[4]+e[5]}function n(e){return-1073741824<=e&&v<=1073741823}function s(e){var t,r,i,s,n,a,o,u=b(t=p.stackObjectValue(0)),l=b(p.stackObjectValue(1)),c=b(p.stackObjectValue(2));if(p.failed())return null;r=l,u=u,i=c[0]*l[0]+c[1]*l[3],s=c[0]*l[1]+c[1]*l[4],n=c[0]*l[2]+c[1]*l[5]+c[2],a=c[3]*l[0]+c[4]*l[3],o=c[3]*l[1]+c[4]*l[4],r=c[3]*l[2]+c[4]*l[5]+c[5],u[0]=i,u[1]=s,u[2]=n,u[3]=a,u[4]=o,u[5]=r,p.popthenPush(e+1,t)}function a(e){var t;if(k(p.stackObjectValue(0)),t=b(p.stackObjectValue(1)),p.failed())return null;S(t),p.failed()||O(e)}function o(e){var t,r,i,s,n,a,o,u=p.stackObjectValue(0),l=p.stackObjectValue(1),c=b(p.stackObjectValue(2));return p.failed()?null:h(l)!==h(u)||!p.isPointers(l)||2!==f(l)?p.primitiveFail():(k(p.fetchPointerofObject(0,l)),p.failed()||(a=d,o=m,S(c),s=r=v,n=i=g,k(p.fetchPointerofObject(1,l)),p.failed())?null:(l=d,t=m,S(c),s=Math.min(s,v),r=Math.max(r,v),n=Math.min(n,g),i=Math.max(i,g),d=l,m=o,S(c),s=Math.min(s,v),r=Math.max(r,v),n=Math.min(n,g),i=Math.max(i,g),d=a,m=t,S(c),s=Math.min(s,v),r=Math.max(r,v),n=Math.min(n,g),i=Math.max(i,g),p.failed()||(u=F(u,s,n,r,i)),void(p.failed()||p.popthenPush(e+1,u))))}function u(e){var t=b(p.stackObjectValue(0));if(p.failed())return null;p.pop(1),p.pushBool(1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5])}function l(e){var t=b(p.stackObjectValue(0));if(p.failed())return null;p.pop(1),p.pushBool(1===t[0]&&0===t[1]&&0===t[3]&&1===t[4])}function c(e){var t;if(k(p.stackObjectValue(0)),t=b(p.stackObjectValue(1)),p.failed())return null;y(t),O(e)}function I(e){var t,r,i,s,n,a,o,u=p.stackObjectValue(0),l=p.stackObjectValue(1),c=b(p.stackObjectValue(2));return p.failed()?null:h(l)!==h(u)||!p.isPointers(l)||2!==f(l)?p.primitiveFail():(k(p.fetchPointerofObject(0,l)),p.failed()||(a=d,o=m,y(c),s=r=v,n=i=g,k(p.fetchPointerofObject(1,l)),p.failed())?null:(l=d,t=m,y(c),s=Math.min(s,v),r=Math.max(r,v),n=Math.min(n,g),i=Math.max(i,g),d=l,m=o,y(c),s=Math.min(s,v),r=Math.max(r,v),n=Math.min(n,g),i=Math.max(i,g),d=a,m=t,y(c),s=Math.min(s,v),r=Math.max(r,v),u=F(u,s,Math.min(n,g),r,Math.max(i,g)),void(p.failed()||p.popthenPush(e+1,u))))}function O(e){return g+=.5,n(v+=.5)&&n(g)?void p.popthenPush(e+1,p.makePointwithxValueyValue(0|v,0|g)):p.primitiveFail()}function F(e,t,r,i,s){var t=t+.5;return n(t)&&n(i=i+.5)&&n(r=r+.5)&&n(s=s+.5)?(p.pushRemappableOop(e),e=p.makePointwithxValueyValue(0|t,0|r),p.pushRemappableOop(e),t=p.makePointwithxValueyValue(0|i,0|s),e=p.popRemappableOop(),r=p.popRemappableOop(),p.storePointerofObjectwithValue(0,r,e),p.storePointerofObjectwithValue(1,r,t),r):p.primitiveFail()}function A(e){return!1!=((p=e).majorVersion()==t)&&p.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:a,primitiveInvertRectInto:o,primitiveIsIdentity:u,primitiveComposeMatrix:s,setInterpreter:A,primitiveTransformRectInto:I,primitiveIsPureTranslation:l,getModuleName:i,primitiveTransformPoint:c}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function i(e,t){return e-(0|Math.floor(e/t))*t|0}var d=null,e="MiscPrimitivePlugin 3 November 2014 (e)";function h(e,t,r){for(var i,s,n=0;n<=3;n++)t[r+n-1]=255&(i=e,31<(s=8*(3-n))?0:i>>>s);return r+4}function f(e,t,r){return e<=223?(t[r-1]=e,r+1):e<=7935?(t[r-1]=224+(e>>8),t[r]=i(e,256),r+2):(t[r-1]=255,h(e,t,r+1))}function s(){return e}function n(e){var t,r,i,s,n,a,o,u;if(d.stackValue(3),t=d.stackBytes(2),r=d.stackBytes(1),i=d.stackBytes(0),!d.failed()){for(o=t.length,u=r.length,a=1;a<=Math.min(o,u);a++)if((s=i[t[a-1]])!==(n=i[r[a-1]]))return s<n?d.failed()||d.popthenPush(e+1,1):d.failed()||d.popthenPush(e+1,3),null;o===u?d.failed()||d.popthenPush(e+1,2):o<u?d.failed()||d.popthenPush(e+1,1):d.failed()||d.popthenPush(e+1,3)}return null}function a(e){var t,r,i,s,n,a,o,u,l,c;if(d.stackValue(2),t=d.stackInt32Array(1),r=d.stackBytes(0),!d.failed()){for(s=f(l=t.length,r,1),a=1;a<=l;){for(i=((c=t[a-1])>>>8&255)==(o=255&c)&&(c>>>16&255)==o&&(c>>>24&255)==o,n=a;n<l&&c===t[n];)++n;if(a<n)i?(r[(s=f(4*(n-a+1)+1,r,s))-1]=o,++s):s=h(c,r,s=f(4*(n-a+1)+2,r,s)),a=n+1;else if(i)r[(s=f(5,r,s))-1]=o,++s,++a;else{for(;n<l&&t[n-1]!==t[n];)++n;for(n===l&&++n,s=f(4*(n-a)+3,r,s),u=a;u<=n-1;u++)s=h(t[u-1],r,s);a=n}}d.failed()||d.popthenPush(e+1,s-1)}return null}function o(e){var t,r,i,s,n;if(d.stackValue(2),t=d.stackBytes(1),r=d.stackUint16Array(0),d.failed())return null;for(s=t.length,i=1;i<=s;i++)n=t[i-1],r[i-1]=127<n?n-256<<8:n<<8;if(d.failed())return null;d.pop(e)}function u(e){var t,r,i,s,n,a,o,u,l,c,h,f,p;if(d.stackValue(3),t=d.stackInt32Array(2),r=d.stackBytes(1),i=d.stackIntegerValue(0),d.failed())return null;for(u=i,o=r.length,p=t.length+(c=1);u<=o;){if(s=r[u-1],++u,!(s<=223))if(s<=254)s=256*(s-224)+r[u-1],++u;else for(s=0,l=1;l<=4;l++)s=(s<<8)+r[u-1],++u;if(p<c+(f=s>>>2))return d.primitiveFail(),null;if(1==(n=3&s))for(a=r[u-1],++u,a=(a|=a<<8)|a<<16,l=1;l<=f;l++)t[c-1]=a,++c;if(2==n){for(a=0,l=1;l<=4;l++)a=a<<8|r[u-1],++u;for(l=1;l<=f;l++)t[c-1]=a,++c}if(3==n)for(h=1;h<=f;h++){for(a=0,l=1;l<=4;l++)a=a<<8|r[u-1],++u;t[c-1]=a,++c}}if(d.failed())return null;d.pop(e)}function l(e){var t,r,i,s,n;if(d.stackValue(3),t=d.stackBytes(2),r=d.stackBytes(1),i=d.stackIntegerValue(0),!d.failed())if(256!==r.length)d.failed()||d.popthenPush(e+1,0);else{for(s=i,n=t.length;s<=n&&0===r[t[s-1]];)++s;n<s?d.failed()||d.popthenPush(e+1,0):d.failed()||d.popthenPush(e+1,s)}return null}function c(e){var t,r,i,s,n,a;if(d.stackValue(4),t=d.stackBytes(3),r=d.stackBytes(2),i=d.stackIntegerValue(1),s=d.stackBytes(0),!d.failed()){if(0!==t.length)for(a=i;a<=r.length-t.length+1;a++)for(n=1;s[r[a+n-1-1]]===s[t[n-1]];){if(n===t.length)return d.failed()||d.popthenPush(e+1,a),null;++n}d.failed()||d.popthenPush(e+1,0)}return null}function p(e){var t,r,i,s,n;if(d.stackValue(3),t=d.stackIntegerValue(2),r=d.stackBytes(1),i=d.stackIntegerValue(0),!d.failed()){for(n=r.length,s=i;s<=n;s++)if(r[s-1]===t)return d.failed()||d.popthenPush(e+1,s),null;d.failed()||d.popthenPush(e+1,0)}return null}function m(e){var t,r,i,s,n,a;if(d.stackValue(2),t=d.stackBytes(1),r=d.stackIntegerValue(0),!d.failed()){for(i=t.length,s=268435455&r,a=1;a<=i;a++)s=9741*(n=16383&(s+=t[a-1]))+16384*(9741*(s>>>14)+101*n&16383)&268435455;d.failed()||d.popthenPush(e+1,s)}return null}function v(e){var t,r,i,s,n;if(d.stackValue(4),t=d.stackBytes(3),r=d.stackIntegerValue(2),i=d.stackIntegerValue(1),s=d.stackBytes(0),d.failed())return null;for(n=r;n<=i;n++)t[n-1]=s[t[n-1]];if(d.failed())return null;d.pop(e)}function g(e){return!1!=((d=e).majorVersion()==t)&&d.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:o,primitiveCompareString:n,primitiveTranslateStringWithTable:v,primitiveStringHash:m,primitiveCompressToByteArray:a,primitiveFindSubstring:c,primitiveIndexOfAsciiInString:p,setInterpreter:g,primitiveDecompressFromByteArray:u,getModuleName:s,primitiveFindFirstInString:l}):self.setTimeout(e,100)}()})(),registerMIDIPlugin(),(()=>{var t=1,r=11;function x(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function E(e,t){return 0|Math.floor(e/t)}function T(e,t){return e-E(e,t)*t|0}var L=null,e="ScratchPlugin 3 November 2014 (e)";function d(e,t,r,i,s){var n,a=E(r,60),r=T(r,60),o=(1e3-i)*s,u=(1e3-E(i*r,60))*s,i=(1e3-E(i*(60-r),60))*s,r=E(1e3*s,3922);o=E(o,3922),u=E(u,3922),i=E(i,3922),0===a&&(n=(r<<16)+(i<<8)+o),1===a&&(n=(u<<16)+(r<<8)+o),2===a&&(n=(o<<16)+(r<<8)+i),3===a&&(n=(o<<16)+(u<<8)+r),4===a&&(n=(i<<16)+(o<<8)+r),e[t]=n=0===(n=5===a?(r<<16)+(o<<8)+u:n)?1:n}function M(e){return L.success(L.isWordsOrBytes(e)),L.failed()?0:e.wordsAsFloat64Array()}function V(e){return L.success(L.isWords(e)),L.failed()?0:e.words}function i(){return e}function m(e,t,r,i,s){i=s-i;return 0==i?0:(s=e===s?E(60*(t-r),i):t===s?120+E(60*(r-e),i):240+E(60*(e-t),i))<0?s+360:s}function l(e,t,r){var i;return 0===e?t:0===t?e:0===(i=((i=1024-r)*(e>>>16&255)+r*(t>>>16&255)>>10<<16)+(i*(e>>>8&255)+r*(t>>>8&255)>>10<<8)+(i*(255&e)+r*(255&t)>>10))?1:i}function S(e,t,r,i,s){var n,a,o,u=t>>>10;return u<-1||i<=u||(o=r>>>10)<-1||s<=o?0:(t=1023&t,-1===u&&(t=u=0),r=1023&r,-1===o&&(r=o=0),a=16777215&e[n=o*i+u],0<(t=u===i-1?0:t)&&(a=l(a,16777215&e[n+1],t)),0===(r=o===s-1?0:r)?a:(s=16777215&e[n=(o+1)*i+u],0<t&&(s=l(s,16777215&e[n+1],t)),l(a,s,r)))}function s(){var e,t,r,i,s,n,a,o,u,l,c,h=L.stackValue(2),f=L.stackValue(1),p=L.stackIntegerValue(0),d=V(h),m=V(f),h=x(h);if(L.success(x(f)===h),L.failed())return null;for(s=E(h,p),c=1;c<=s-2;c++)for(l=1;l<=p-2;l++){for(n=u=i=e=0,r=-1;r<=1;r++)for(t=-1;t<=1;t++)0!=(o=16777215&d[(c+r)*p+(l+t)])&&(u+=o>>>16&255,i+=o>>>8&255,e+=255&o,++n);a=0===n?0:(E(u,n)<<16)+(E(i,n)<<8)+E(e,n),m[c*p+l]=a}return L.pop(3),0}function n(){var e,t,r,i,s,n=L.stackValue(2),a=L.stackValue(1),o=L.stackIntegerValue(0),u=V(n),l=x(n),c=V(a);if(L.success(x(a)===l),L.failed())return null;for(t=0;t<=l-1;t++)0!=(s=16777215&u[t])&&(e=m(r=i=s>>>16&255,e=s>>>8&255,s=255&s,i=s<(i=e<i?e:i)?s:i,r=(r=r<e?e:r)<s?s:r),s=0===r?0:E(1e3*(r-i),r),i=E(1e3*r,255),d(c,t,e,s,i=(i=1e3<(i+=10*o)?1e3:i)<0?0:i));return L.pop(3),0}function a(){var e,t,r,i,s,n,a,o,u=0,l=0,c=L.stackValue(2),h=L.stackValue(1),f=L.stackIntegerValue(0);if(L.success(L.isWords(c)),L.success(L.isWords(h)),e=E(2*x(c),f),a=2*x(h),L.success(e<=a),L.failed())return null;for(n=c.wordsAsInt16Array(),t=h.wordsAsInt16Array(),r=1;r<=e;r++){for(s=0,i=1;i<=f;i++)s<(o=(o=n[u++])<0?0-o:o)&&(s=o);t[l++]=s}return L.pop(3),0}function o(){var e,t,r,i,s,n=L.stackValue(7),a=L.stackIntegerValue(6),o=L.stackIntegerValue(5),u=L.stackValue(4),l=L.stackIntegerValue(3),c=L.stackIntegerValue(2),h=L.stackIntegerValue(1),f=L.stackIntegerValue(0),p=V(n),d=V(u);if(L.success(h+2*a<l),L.success(f+2*o<c),L.failed())return null;for(s=0;s<=o-1;s++)for(e=(f+2*s)*l+h,i=0;i<=a-1;i++)r=p[i+s*a],d[t=e+2*i]=r,d[t+1]=r,d[t+l]=r,d[t+l+1]=r;return L.pop(8),0}function u(){var e,t,r,i,s=0,n=0,a=L.stackValue(2),o=L.stackValue(1),u=L.booleanValueOf(L.stackValue(0));if(L.success(L.isWords(a)),L.success(L.isWords(o)),i=x(a),L.success(x(o)>=i>>1),L.failed())return null;for(r=a.wordsAsInt16Array(),e=o.wordsAsInt16Array(),u&&s++,t=1;t<=i;t++)e[n++]=r[s],s+=2;return L.pop(3),0}function c(){var e,t,r,i,s,n,a,o,u,l,c=L.stackValue(3),h=L.stackValue(2),f=L.stackIntegerValue(1),p=L.stackIntegerValue(0),d=V(c),m=V(h),c=x(c);if(L.success(x(h)===c),L.failed())return null;for(E(c,f),e=f>>1,t=(i=E(c,f))>>1,n=p/100,u=0;u<=f-1;u++)for(l=0;l<=i-1;l++)o=(u-e)/e,r=(l-t)/t,o=(s=Math.pow(Math.sqrt(o*o+r*r),n))<=1?(r=Math.atan2(r,o),a=1024*(e+s*Math.cos(r)*e)|0,1024*(t+s*Math.sin(r)*t)|0):(a=1024*u,1024*l),s=S(d,a,o,f,i),m[l*f+u]=s;return L.pop(4),0}function h(){var e,t,r,i,s,n,a,o,u=V(L.stackValue(11)),l=L.stackIntegerValue(10),c=L.stackIntegerValue(9),h=V(L.stackValue(8)),f=L.stackIntegerValue(7),p=L.stackIntegerValue(6),d=L.stackIntegerValue(5),m=L.stackIntegerValue(4),v=L.stackIntegerValue(3),g=L.stackIntegerValue(2),b=L.stackIntegerValue(1),k=L.stackIntegerValue(0);if(L.success(0<=d&&0<=m),L.success(d+2*b<=l),L.success(m+2*k<=c),L.success(0<=v&&0<=g),L.success(v+b<=f),L.success(g+k<=p),L.failed())return null;for(o=0;o<=k-1;o++)for(n=l*(m+2*o)+d,t=f*(g+o)+v,a=0;a<=b-1;a++)s=16711680&(i=u[n]),r=65280&i,e=255&i,s+=16711680&(i=u[n+1]),e+=255&i,r=(r+=65280&i)+(65280&(i=u[n+l])),e+=255&i,s=(s+=16711680&i)+(16711680&(i=u[n+l+1])),h[t]=s>>>2&16711680|(r+=65280&i)>>>2&65280|(e+=255&i)>>>2,n+=2,++t;return L.pop(12),0}function f(){var e,t,r,i,s,n,a=V(L.stackValue(11)),o=L.stackIntegerValue(10),u=L.stackIntegerValue(9),l=V(L.stackValue(8)),c=L.stackIntegerValue(7),h=L.stackIntegerValue(6),f=L.stackIntegerValue(5),p=L.stackIntegerValue(4),d=L.stackIntegerValue(3),m=L.stackIntegerValue(2),v=L.stackIntegerValue(1),g=L.stackIntegerValue(0);if(L.success(0<=f&&0<=p),L.success(f+2*v<=o),L.success(p+2*g<=u),L.success(0<=d&&0<=m),L.success(d+v<=c),L.success(m+g<=h),L.failed())return null;for(n=0;n<=g-1;n++)for(i=o*(p+2*n)+f,e=c*(m+n)+d,s=0;s<=v-1;s++)t=a[i],r=a[i+o+1],l[e]=(65280&t)+(65280&r)>>>1&65280|(255&t)+(255&r)>>>1|(16711680&t)+(16711680&r)>>>1&16711680,i+=2,++e;return L.pop(12),0}function p(){var e,t,r,i,s,n,a,o,u=L.stackValue(2),l=L.stackValue(1),c=L.stackIntegerValue(0),h=V(u),f=x(u),p=V(l);if(L.success(x(l)===f),L.failed())return null;for(r=0;r<=f-1;r++)0!=(n=16777215&h[r])&&(i=s=a=n>>>16&255,(e=255&n)<(s=(n=n>>>8&255)<s?n:s)&&(s=e),t=E(1e3*(i=(i=i<n?n:i)<e?e:i),255),o=0===i?0:E(1e3*(i-s),i),t<110&&(t=110,o=1e3),o<90&&(o=90),d(p,r,T((110===t||90===o?0:m(a,n,e,s,i))+c+36e7,360),o,t));return L.pop(3),0}function v(){var e=L.stackValue(3),t=L.stackIntegerValue(2),r=L.stackIntegerValue(1),i=L.stackIntegerValue(0),s=V(e),e=x(e);return L.failed()?null:(s=S(s,r,i,t,E(e,t)),L.pop(5),L.pushInteger(s),0)}function g(){var e,t,r,i,s,n,a,o,u=L.stackValue(2),l=L.stackValue(1),c=L.stackIntegerValue(0),h=V(u),f=x(u),p=V(l);if(L.success(x(l)===f),L.failed())return null;for(r=0;r<=f-1;r++)(n=16777215&h[r])<2||(i=s=a=n>>>16&255,(e=255&n)<(s=(n=n>>>8&255)<s?n:s)&&(s=e),t=E(1e3*(i=(i=i<n?n:i)<e?e:i),255),0<(o=0===i?0:E(1e3*(i-s),i))&&d(p,r,m(a,n,e,s,i),o=(o=1e3<(o+=10*c)?1e3:o)<0?0:o,t));return L.pop(3),0}function b(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k=L.stackValue(5),S=L.stackIntegerValue(4),y=L.stackIntegerValue(3),I=L.stackValue(2),O=L.stackIntegerValue(1),F=L.stackIntegerValue(0);if(L.success(x(k)===S*y),L.success(x(I)===O*F),e=V(k),i=V(I),L.failed())return null;for(t=r=0,g=E(1024*S,O),b=E(1024*y,F),a=0;a<=F-1;a++){for(n=t=0;n<=O-1;n++)p=(1024-(1023&t))*(1024-(1023&r)),d=(1023&t)*(1024-(1023&r)),m=(1024-(1023&t))*(1023&r),v=(1023&t)*(1023&r),o=e[h=(r>>>10)*S+(t>>>10)],u=t>>>10<S-1?e[h+1]:o,r>>>10<y-1&&(h+=S),l=e[h],c=t>>>10<S-1?e[h+1]:l,(f=0)===o&&(o=u,f+=p),0===u&&(u=o,f+=d),0===l&&(l=c,f+=m),0===c&&(c=l,f+=v),0===o&&(o=l,u=c),0===l&&(l=o,c=u),s=0,f<5e5&&0===(s=(s=((h=p*(o>>>16&255)+d*(u>>>16&255)+m*(l>>>16&255)+v*(c>>>16&255))>>>20&255)<<16)|((h=p*(o>>>8&255)+d*(u>>>8&255)+m*(l>>>8&255)+v*(c>>>8&255))>>>20&255)<<8|(h=p*(255&o)+d*(255&u)+m*(255&l)+v*(255&c))>>>20&255)&&(s=1),i[a*O+n]=s,t+=g;r+=b}return L.pop(6),0}function k(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k,S=L.stackValue(5),y=L.stackValue(4),I=L.stackIntegerValue(3),O=V(S),F=V(y),S=x(S),A=L.stackIntegerValue(2),_=L.stackValue(1),P=L.stackValue(0),w=M(_),C=M(P);if(L.success(x(y)===S),L.failed())return null;for(u=E(S,I),e=T(Math.random(),A)-1,d=0;d<=e/2-1;d++)for(b=T(Math.random(),I),k=T(Math.random(),u),f=T(Math.random(),8),a=-4;a<=4;a++)for(o=-4;o<=4;o++)(r=a*a+o*o)<25&&0<r&&(s=k+o|0,0<(i=b+a|0))&&0<s&&s<u&&i<I&&(w[s*I+i]=f*(1-r/25));for(n=1;n<=I-2;n++)for(t=1;t<=u-2;t++)w[v=t*I+n]=(C[v+1]+C[v-1]+C[v+I]+C[v-I]+C[v-1-I]/2+C[v-1+I]/2+C[v+1-I]/2+C[v+1+I]/2)/4-w[v],w[v]=.9*w[v];for(p=0;p<=I*u;p++)m=C[p],C[p]=w[p],w[p]=m;for(c=0;c<=u-1;c++)for(l=0;l<=I-1;l++)h=1<l&&l<I-1&&1<c&&c<u-1&&(h=64*(w[g=c*I+l]-w[g-1]+(w[g+1]-w[g])),(g=(c+(g=2<(g=(g=(w[g]-w[g-I]+(w[g+I]-w[g]))/64)<2?-2:g)?2:g))*I+(l+(h=2<(h=h<2?-2:h)?2:h))|0)<I*u)&&0<=g?O[g]:O[l+c*I],F[l+c*I]=h;return L.pop(6),0}function y(){var e,t,r,i,s,n,a,o,u,l,c,h,f,p,d=L.stackValue(3),m=L.stackValue(2),v=L.stackIntegerValue(1),g=L.stackIntegerValue(0),b=V(d),k=V(m),d=x(d);if(L.success(x(m)===d),L.failed())return null;for(l=(e=v>>1)<(t=(n=E(d,v))>>1)?(u=t/(a=e),1):(u=1,(a=t)<e?e/t:1),h=-3.141592653589793*g/180,o=a*a,f=0;f<=v-1;f++)for(p=0;p<=n-1;p++)(s=(r=u*(f-e))*r+(i=l*(p-t))*i)<o&&(s=(s=1-Math.sqrt(s)/a)*s*h,c=Math.sin(s),c=S(b,1024*(((s=Math.cos(s))*r-c*i)/u+e)|0,1024*((c*r+s*i)/l+t)|0,v,n),k[v*p+f]=c);return L.pop(4),0}function I(e){return!1!=((L=e).majorVersion()==t)&&L.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:a,getModuleName:i,primitiveFisheye:c,primitiveWaterRipples1:k,primitiveHalfSizeDiagonal:f,primitiveScale:b,primitiveDoubleSize:o,setInterpreter:I,primitiveWhirl:y,primitiveBlur:s,primitiveBrightnessShift:n,primitiveHalfSizeAverage:h,primitiveSaturationShift:g,primitiveHueShift:p,primitiveInterpolate:v,primitiveExtractChannel:u}):self.setTimeout(e,100)}()})(),registerSocketPlugin(),registerSpeechPlugin(),registerSqueakSSL(),(()=>{var t=1,r=11;function F(e,t){return e-(0|Math.floor(e/t))*t|0}var x=511,E=512,y=32768,I=536870912,T=null,e="SoundGenerationPlugin 3 November 2014 (e)";function i(){return e}function s(){var e,t,r,i,s,n,a,o,u=T.stackValue(3),l=T.stackInt16Array(2),c=T.stackIntegerValue(1),h=T.stackIntegerValue(0),f=T.fetchInt32ArrayofObject(7,u),p=T.fetchInt32ArrayofObject(8,u),d=T.fetchIntegerofObject(9,u),m=T.fetchIntegerofObject(10,u),v=T.fetchIntegerofObject(11,u),g=T.fetchInt16ArrayofObject(12,u),b=T.fetchInt16ArrayofObject(13,u);if(T.failed())return null;for(n=c;n<=c+h-1;n++){for(e=t=0,o=1;o<=d;o++)(r=v-f[o-1])<1&&(r+=m),e+=(a=p[o-1])*g[r-1],t+=a*b[r-1];(s=32767<(s=l[(i=2*n-1)-1]+(e>>15))?32767:s)<-32767&&(s=-32767),l[i-1]=s,g[v-1]=s,(s=32767<(s=l[++i-1]+(t>>15))?32767:s)<-32767&&(s=-32767),l[i-1]=s,b[v-1]=s,v=F(v,m)+1}if(T.failed())return null;T.storeIntegerofObjectwithValue(11,u,v),T.pop(3)}function n(){var e,t,r,i,s,n,a,o=T.stackValue(5),u=T.stackIntegerValue(4),l=T.stackInt16Array(3),c=T.stackIntegerValue(2),h=T.stackIntegerValue(1),f=T.stackIntegerValue(0),p=T.fetchIntegerofObject(3,o),d=T.fetchIntegerofObject(4,o),m=T.fetchIntegerofObject(5,o),v=T.fetchIntegerofObject(7,o),g=T.fetchInt16ArrayofObject(8,o),b=T.fetchIntegerofObject(9,o),k=T.fetchIntegerofObject(10,o),S=T.fetchIntegerofObject(11,o),y=T.fetchIntegerofObject(14,o),I=T.fetchIntegerofObject(15,o),O=T.fetchIntegerofObject(16,o);if(T.failed())return null;for(e=0!==y&&0!==O,r=c+u-1,a=c;a<=r;a++)n=p*g[k>>15]>>15,e?(i=y*g[I>>15],(I=F(I+O,b))<0&&(I+=b),(k=F(k+S+i,b))<0&&(k+=b)):k=F(k+S,b),0<h&&((s=32767<(s=l[(t=2*a-1)-1]+(n*h>>15))?32767:s)<-32767&&(s=-32767),l[t-1]=s),0<f&&((s=32767<(s=l[(t=2*a)-1]+(n*f>>15))?32767:s)<-32767&&(s=-32767),l[t-1]=s),0!==d&&(p+=d,0<d&&m<=p||d<0&&p<=m)&&(p=m,d=0);if(v-=u,T.failed())return null;T.storeIntegerofObjectwithValue(3,o,p),T.storeIntegerofObjectwithValue(4,o,d),T.storeIntegerofObjectwithValue(7,o,v),T.storeIntegerofObjectwithValue(10,o,k),T.storeIntegerofObjectwithValue(15,o,I),T.pop(5)}function a(){var e,t,r,i,s,n,a,o,u,l,c,h,f=T.stackValue(5),p=T.stackIntegerValue(4),d=T.stackInt16Array(3),m=T.stackIntegerValue(2),v=T.stackIntegerValue(1),g=T.stackIntegerValue(0),b=T.fetchIntegerofObject(3,f),k=T.fetchIntegerofObject(4,f),S=T.fetchIntegerofObject(5,f),y=T.fetchIntegerofObject(7,f),I=T.fetchIntegerofObject(8,f),O=T.fetchInt16ArrayofObject(10,f),F=T.fetchInt16ArrayofObject(11,f),A=T.fetchIntegerofObject(16,f),_=T.fetchIntegerofObject(17,f),P=T.fetchIntegerofObject(18,f),w=T.fetchIntegerofObject(19,f),C=T.fetchIntegerofObject(20,f);if(T.failed())return null;for(i=O!==F,e=v*b>>15,t=g*b>>15,r=2*m-1,s=m+p-1,h=m;h<=s;h++){if((o=(c=_<(c=(w+=C)>>9)&&I<y?(w-=P)>>9:c)+1)>A){if(A<c)return y=0,T.failed()||(T.storeIntegerofObjectwithValue(3,f,b),T.storeIntegerofObjectwithValue(4,f,k),T.storeIntegerofObjectwithValue(7,f,y),T.storeIntegerofObjectwithValue(19,f,w),T.popthenPush(6,null)),null;o=0===P?c:1+(w-P>>9)}u=n=O[c-1]*(E-(a=w&x))+O[o-1]*a>>9,i&&(u=F[c-1]*(E-a)+F[o-1]*a>>9),0<v&&((l=32767<(l=d[r-1]+(e*n>>15))?32767:l)<-32767&&(l=-32767),d[r-1]=l),++r,0<g&&((l=32767<(l=d[r-1]+(t*u>>15))?32767:l)<-32767&&(l=-32767),d[r-1]=l),++r,0!==k&&(b+=k,(0<k&&S<=b||k<0&&b<=S)&&(b=S,k=0),e=v*b>>15,t=g*b>>15)}if(y-=p,T.failed())return null;T.storeIntegerofObjectwithValue(3,f,b),T.storeIntegerofObjectwithValue(4,f,k),T.storeIntegerofObjectwithValue(7,f,y),T.storeIntegerofObjectwithValue(19,f,w),T.pop(5)}function o(){var e,t,r,i,s,n,a,o=T.stackValue(5),u=T.stackIntegerValue(4),l=T.stackInt16Array(3),c=T.stackIntegerValue(2),h=T.stackIntegerValue(1),f=T.stackIntegerValue(0),p=T.fetchIntegerofObject(3,o),d=T.fetchIntegerofObject(4,o),m=T.fetchIntegerofObject(5,o),v=T.fetchIntegerofObject(7,o),g=T.fetchInt16ArrayofObject(8,o),b=T.fetchIntegerofObject(9,o),k=T.fetchIntegerofObject(10,o),S=T.fetchIntegerofObject(11,o);if(T.failed())return null;for(t=c+u-1,n=s=b,a=c;a<=t;a++)S<=(s=n+k)&&(s=y+(s-S)),i=g[(n>>15)-1]+g[(s>>15)-1]>>1,i=(g[(n>>15)-1]=i)*p>>15,n=s,0<h&&((r=32767<(r=l[(e=2*a-1)-1]+(i*h>>15))?32767:r)<-32767&&(r=-32767),l[e-1]=r),0<f&&((r=32767<(r=l[(e=2*a)-1]+(i*f>>15))?32767:r)<-32767&&(r=-32767),l[e-1]=r),0!==d&&(p+=d,0<d&&m<=p||d<0&&p<=m)&&(p=m,d=0);if(b=s,v-=u,T.failed())return null;T.storeIntegerofObjectwithValue(3,o,p),T.storeIntegerofObjectwithValue(4,o,d),T.storeIntegerofObjectwithValue(7,o,v),T.storeIntegerofObjectwithValue(9,o,b),T.pop(5)}function u(){var e,t,r,i,s,n,a=T.stackValue(5),o=T.stackIntegerValue(4),u=T.stackInt16Array(3),l=T.stackIntegerValue(2),c=T.stackIntegerValue(1),h=T.stackIntegerValue(0),f=T.fetchIntegerofObject(3,a),p=T.fetchIntegerofObject(4,a),d=T.fetchIntegerofObject(5,a),m=T.fetchIntegerofObject(7,a),v=T.fetchInt16ArrayofObject(8,a),g=T.fetchIntegerofObject(10,a),b=T.fetchIntegerofObject(11,a),k=T.fetchIntegerofObject(12,a),S=T.fetchIntegerofObject(13,a);if(T.failed())return null;for(t=l+o-1,r=l,n=k+(b>>>16);n<=g&&r<=t;)s=v[n-1]*f>>15,0<c&&((i=32767<(i=u[(e=2*r-1)-1]+(s*c>>15))?32767:i)<-32767&&(i=-32767),u[e-1]=i),0<h&&((i=32767<(i=u[(e=2*r)-1]+(s*h>>15))?32767:i)<-32767&&(i=-32767),u[e-1]=i),0!==p&&(f+=p,0<p&&d<=f||p<0&&f<=d)&&(f=d,p=0),I<=(b+=S)&&(k+=s=b>>>16,b-=s<<16),n=k+(b>>>16),++r;if(m-=o,T.failed())return null;T.storeIntegerofObjectwithValue(3,a,f),T.storeIntegerofObjectwithValue(4,a,p),T.storeIntegerofObjectwithValue(7,a,m),T.storeIntegerofObjectwithValue(11,a,b),T.storeIntegerofObjectwithValue(12,a,k),T.pop(5)}function l(e){return!1!=((T=e).majorVersion()==t)&&T.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:n,primitiveMixSampledSound:u,setInterpreter:l,getModuleName:i,primitiveApplyReverb:s,primitiveMixPluckedSound:o,primitiveMixLoopedSampledSound:a}):self.setTimeout(e,100)}()})(),(()=>{var t=1,r=11;function k(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function S(e,t){return 0|Math.floor(e/t)}var y=null,e="StarSqueakPlugin 3 November 2014 (e)";function I(e){return y.success(y.isWords(e)),y.failed()?0:e.words}function i(){return e}function s(){var e,t,r,i,s,n,a,o,u,l,c,h=y.stackValue(4),f=y.stackValue(3),p=y.stackIntegerValue(2),d=y.stackIntegerValue(1),m=y.stackIntegerValue(0),v=I(h),g=I(f);if(y.success(k(h)===k(f)),y.success(k(h)===p*d),y.failed())return null;for(e=(2*m+1)*(2*m+1),l=0;l<=d-1;l++)for((n=l-m)<0&&(n=0),d<=(r=l+m)&&(r=d-1),o=0;o<=p-1;o++){for((s=o-m)<0&&(s=0),p<=(t=o+m)&&(t=p-1),a=0,c=n;c<=r;c++)for(i=c*p,u=s;u<=t;u++)a+=v[i+u];g[l*p+o]=S(a,e)}y.pop(5)}function n(){var e,t=y.stackValue(1),r=y.stackIntegerValue(0),i=I(t),s=k(t);if(y.failed())return null;for(e=0;e<=s-1;e++)i[e]=i[e]*r>>>10;y.pop(2)}function a(){var e,t,r,i,s,n,a,o,u,l,c=y.stackValue(6),h=y.stackValue(5),f=y.stackIntegerValue(4),p=y.stackIntegerValue(3),d=y.stackIntegerValue(2),m=y.stackIntegerValue(1),v=y.stackIntegerValue(0),g=I(c),b=I(h);if(y.success(k(h)===f*p),y.success(k(h)===k(c)*d*d),y.failed())return null;for((i=0)<(4&m)&&(i+=65536),0<(2&m)&&(i+=256),0<(1&m)&&++i,n=-1,o=0;o<=S(p,d)-1;o++)for(a=0;a<=S(f,d)-1;a++)for(u=g[++n],r=(u=255<(u=(l=v)<0?l<-31?0:u>>>0-l:31<l?0:u<<l)?255:u)<=0?1:u*i,s=t=(o*f+a)*d;s<=t+(d-1)*f;s+=f)for(e=s;e<=s+d-1;e++)b[e]=r;y.pop(7)}function o(e){return!1!=((y=e).majorVersion()==t)&&y.minorVersion()>=r}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:s,primitiveEvaporateRate:n,setInterpreter:o,primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:a,getModuleName:i}):self.setTimeout(e,100)}()})(),(()=>{var t=1,l=11;function r(e){return"number"==typeof e?O.classSmallInteger():e.sqClass}function S(e){return e.pointers?e.pointers.length:e.words?e.words.length:e.bytes?e.bytes.length:0}function y(e){return e.bytes?e.bytes.length:e.words?4*e.words.length:0}function u(e,t){return e-(0|Math.floor(e/t))*t|0}function n(e,t){return 31<t?0:e<<t}var c=32767,q=32768,h=32768,D=30,U=286,f=258,I=3,p=32767,G=32768,a=16,W=1,O=null,e="ZipPlugin 3 November 2014 (e)",i=0,o=0,z=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],H=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],d=0,m=0,v=0,g=null,F=0,K=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],X=null,Y=0,A=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],Z=null,b=null,J=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=null,_=null,s=0,$=null,ee=0,P=0,w=null,C=0,x=null,E=0,te=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],T=0,L=0,re=null,M=0,V=0,N=0;function ie(e,t,r){var i,s,n,a,o,u,l,c,h,f;if(!(e<v)){if(C<=P)return!0;for(s=!1,n=v;n<=e;){if(s||(l=ne(n,I-1,n,t,r),j(n),o=65535&l,a=l>>>16),h=65535&(l=ne(n+1,a,o,t,r)),(c=l>>>16)<=a&&I<=a){for(i=((e,t)=>(x[P]=e-I,b[P]=t,e=te[e-I],w[e]++,e=t<257?A[t-1]:A[256+(t-1>>>7)],Z[e]++,++E,++P===C||0==(4095&P)&&de()))(a,n-o),u=1;u<=a-1;u++)j(++n);s=!1,++n}else f=g[n],x[P]=f,b[P]=0,w[f]++,i=++P===C||0==(4095&P)&&de(),++n<=e&&!i&&(j(n),s=!0,o=h,a=c);if(i)return v=n,!0}v=n}return!1}function se(e){for(var t=r(e);!t.isNil&&7<=t.classInstSize();)t=t.superclass();return!t.isNil&&(o=t.classInstSize(),1)}function ne(e,t,r,i,s){var n,a,o,u,l,c=t<<16|r;if(f<=t)return c;if(!(0<(r=e-(l=k[me(e+I-1)]))&&r<h))return c;for(a=i,u=h<e?e-h:0,n=t;;){if(o=((e,t,r)=>{var i;if(g[e+r]!==g[t+r])return 0;if(g[e+r-1]!==g[t+r-1])return 0;if(g[e]!==g[t])return 0;if(g[e+1]!==g[t+1])return 1;for(i=2;i<f&&g[e+i]===g[t+i];)++i;return i})(e,l,n),n<(o=(o=T<e+o?T-e:o)===I&&h>>2<e-l?I-1:o)){if(c=o<<16|l,f<=(n=o))return c;if(s<n)return c}if(!(0<--a))return c;if((l=_[l&p])<=u)return c}}function ae(){return e}function j(e){var t;s=me(e+I-1),t=k[s],k[s]=e,_[e&p]=t}function B(e,t){if(!(0<=t&&n(1,e)>t))return O.primitiveFail();for(d|=n(t,m),m+=e;8<=m&&T<F;)g[T]=255&d,++T,d>>>=8,m-=8}function oe(){var e,t,r,i;return 3!==O.methodArgumentCount()?O.primitiveFail():(t=O.stackIntegerValue(0),e=O.stackIntegerValue(1),i=O.stackIntegerValue(2),r=O.stackObjectValue(3),O.failed()?null:(e=>{var t;if(O.isPointers(e)&&15<=S(e)&&(t=O.fetchPointerofObject(0,e),O.isBytes(t))){if(0===o){if(!se(e))return;if(S(e)<o+5)return o=0,0}return g=t.bytes,F=y(t),T=O.fetchIntegerofObject(1,e),L=O.fetchIntegerofObject(2,e),t=O.fetchPointerofObject(o+0,e),O.isWords(t)&&S(t)===q?(k=t.words,t=O.fetchPointerofObject(o+1,e),!(!O.isWords(t)||S(t)!==G||(_=t.words,s=O.fetchIntegerofObject(o+2,e),v=O.fetchIntegerofObject(o+3,e),t=O.fetchPointerofObject(o+5,e),!O.isBytes(t))||(C=S(t),x=t.bytes,t=O.fetchPointerofObject(o+6,e),!(O.isWords(t)&&S(t)>=C))||(b=t.words,t=O.fetchPointerofObject(o+7,e),!O.isWords(t))||S(t)!==U||(w=t.words,t=O.fetchPointerofObject(o+8,e),!O.isWords(t))||S(t)!==D||(Z=t.words,P=O.fetchIntegerofObject(o+9,e),E=O.fetchIntegerofObject(o+10,e),O.failed()))):void 0}})(r)?(i=ie(i,e,t),O.failed()||(O.storeIntegerofObjectwithValue(o+2,r,s),O.storeIntegerofObjectwithValue(o+3,r,v),O.storeIntegerofObjectwithValue(o+9,r,P),O.storeIntegerofObjectwithValue(o+10,r,E)),void(O.failed()||(O.pop(4),O.pushBool(i)))):O.primitiveFail())}function ue(){var e,t,r,i,s,n;if(2!==O.methodArgumentCount())return O.primitiveFail();if(e=O.stackIntegerValue(0),i=O.stackObjectValue(1),O.failed())return null;if(!O.isWords(i))return O.primitiveFail();for(n=S(i),s=i.wordsAsInt32Array(),r=0;r<=n-1;r++)t=s[r],s[r]=e<=t?t-e:0;O.pop(2)}function le(){var e,t;if(2!==O.methodArgumentCount())return O.primitiveFail();if(e=O.stackValue(0),!O.isWords(e))return O.primitiveFail();if(X=e.words,Y=S(e),e=O.stackValue(1),!O.isWords(e))return O.primitiveFail();if($=e.words,ee=S(e),t=O.stackValue(2),!O.isPointers(t))return O.primitiveFail();if(0===i){if(!(e=>{for(var t=r(e);!t.isNil&&13<=t.classInstSize();)t=t.superclass();return!t.isNil&&(i=t.classInstSize(),1)})(t))return O.primitiveFail();if(S(t)<i+8)return i=0,O.primitiveFail()}return S(t)<i+8?O.primitiveFail():(L=O.fetchIntegerofObject(2,t),N=O.fetchIntegerofObject(i+0,t),d=O.fetchIntegerofObject(i+1,t),m=O.fetchIntegerofObject(i+2,t),V=O.fetchIntegerofObject(i+4,t),M=O.fetchIntegerofObject(i+5,t),O.failed()?null:(--L,--V,--M,e=O.fetchPointerofObject(0,t),O.isBytes(e)&&(g=e.bytes,F=y(e),e=O.fetchPointerofObject(i+3,t),O.isBytes(e))?(re=e.bytes,(()=>{var e,t,r,i,s,n,a,o,u,l,c;for(n=F-1;L<n&&V<=M;)if(o=d,a=m,u=V,(c=ve($,ee))<256)g[++L]=c;else{if(256===c)return N&=W;if(s=65535&c,0<(r=(c>>>16)-1)&&(s+=R(r)),c=ve(X,Y),e=65535&c,0<(r=c>>>16)&&(e+=R(r)),n<=L+s)return d=o,m=a,V=u;for(l=(t=L)-e,i=1;i<=s;i++)g[t+i]=g[l+i];L+=s}})(),void(O.failed()||(O.storeIntegerofObjectwithValue(2,t,L+1),O.storeIntegerofObjectwithValue(i+0,t,N),O.storeIntegerofObjectwithValue(i+1,t,d),O.storeIntegerofObjectwithValue(i+2,t,m),O.storeIntegerofObjectwithValue(i+4,t,V+1),O.pop(2)))):O.primitiveFail()))}function ce(){var e,t,r,i,s,n,a,o;if(4!==O.methodArgumentCount())return O.primitiveFail();if(r=O.stackObjectValue(0),o=O.stackIntegerValue(1),a=O.stackIntegerValue(2),e=O.positive32BitValueOf(O.stackValue(3)),O.failed())return 0;if(!(O.isBytes(r)&&a<=o&&0<a))return O.primitiveFail();if(!(o<=y(r)))return O.primitiveFail();for(t=r.bytes,--o,s=65535&e,n=e>>>16&65535,i=--a;i<=o;i++)s=u(s+t[i],65521),n=u(n+s,65521);O.popthenPush(5,O.positive32BitIntegerFor((n<<16)+s))}function he(){var e,t,r,i,s,n;if(4!==O.methodArgumentCount())return O.primitiveFail();if(t=O.stackObjectValue(0),n=O.stackIntegerValue(1),s=O.stackIntegerValue(2),r=O.positive32BitValueOf(O.stackValue(3)),O.failed())return 0;if(!(O.isBytes(t)&&s<=n&&0<s))return O.primitiveFail();if(!(n<=y(t)))return O.primitiveFail();for(e=t.bytes,--n,i=--s;i<=n;i++)r=K[255&(r^e[i])]^r>>>8;O.popthenPush(5,O.positive32BitIntegerFor(r))}function fe(){var e,t,r,i,s;return 4!==O.methodArgumentCount()?O.primitiveFail():(t=O.stackObjectValue(0),r=O.stackObjectValue(1),e=O.stackObjectValue(2),s=O.stackObjectValue(3),i=O.stackObjectValue(4),O.failed()?null:(e=>{var t;if(0===o){if(!se(e))return;if(S(e)<o+3)return o=0,0}return O.isPointers(e)&&S(e)>=o+3&&(t=O.fetchPointerofObject(0,e),O.isBytes(t)?(g=t.bytes,F=y(t),T=O.fetchIntegerofObject(1,e),L=O.fetchIntegerofObject(2,e),d=O.fetchIntegerofObject(o+0,e),m=O.fetchIntegerofObject(o+1,e),!O.failed()):O.primitiveFail())})(i)&&O.isPointers(t)&&2<=S(t)&&O.isPointers(r)&&2<=S(r)&&O.isPointers(s)&&3<=S(s)&&O.isPointers(e)&&3<=S(e)?(s=((e,t,r,i)=>{var s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k;if(b=O.fetchPointerofObject(0,e),m=O.fetchIntegerofObject(1,e),d=O.fetchIntegerofObject(2,e),!(m<=d&&O.isBytes(b)&&d<=y(b)))return O.primitiveFail();if(f=b.bytes,b=O.fetchPointerofObject(0,t),!(O.isWords(b)&&d<=S(b)&&O.fetchIntegerofObject(1,t)===m&&O.fetchIntegerofObject(2,t)===d))return O.primitiveFail();if(a=b.words,b=O.fetchPointerofObject(0,r),!O.isWords(b))return O.primitiveFail();if(p=S(b),v=b.words,b=O.fetchPointerofObject(1,r),!O.isWords(b)||p!==S(b))return O.primitiveFail();if(g=b.words,b=O.fetchPointerofObject(0,i),!O.isWords(b))return O.primitiveFail();if(u=S(b),o=b.words,b=O.fetchPointerofObject(1,i),!O.isWords(b)||u!==S(b))return O.primitiveFail();for(l=b.words,B(0,0),k=0;m<d&&T+4<F;)if(h=f[m],n=a[m],++m,0===n){if(++k,!(h<p))return O.primitiveFail();B(v[h],g[h])}else{if(k=k+h+I,!(h<256))return O.primitiveFail();if(!((s=te[h])<p))return O.primitiveFail();if(B(v[s],g[s]),0!==(c=Q[s-257])&&(h-=H[s-257],B(c,h)),!(--n<32768))return O.primitiveFail();if(!((s=n<256?A[n]:A[256+(n>>>7)])<u))return O.primitiveFail();B(o[s],l[s]),0!==(c=J[s])&&(n-=z[s],B(c,n))}return O.failed()?null:(O.storeIntegerofObjectwithValue(1,e,m),O.storeIntegerofObjectwithValue(1,t,m),k)})(s,e,r,t),O.failed()||(O.storeIntegerofObjectwithValue(1,i,T),O.storeIntegerofObjectwithValue(o+0,i,d),O.storeIntegerofObjectwithValue(o+1,i,m)),void(O.failed()||(O.pop(5),O.pushInteger(s)))):O.primitiveFail())}function pe(e){return!1!=((O=e).majorVersion()==t)&&O.minorVersion()>=l}function de(){var e;return P===C||0==(4095&P)&&!(10*E<=P||(e=P-E)<=E)&&4*e<=E}function me(e){return e=g[e],(s<<5^e)&c}function ve(e,t){var r,i,s=e[0]>>>24;if(a<s)O.primitiveFail();else for(r=2;;){if(t<=(i=r+R(s)-1))return O.primitiveFail(),0;if(0==(1056964608&(i=e[i])))return i;if(r=65535&i,a<(s=i>>>24&255))return O.primitiveFail(),0}return 0}function R(e){for(var t,r,i,s;m<e;)r=re[++V],d+=n(r,m),m+=8;return t=d&n(1,e)-1,i=d,d=31<(s=e)?0:i>>>s,m-=e,t}!function e(){"object"==typeof Squeak&&Squeak.registerExternalModule?Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:fe,primitiveUpdateAdler32:ce,primitiveUpdateGZipCrc32:he,primitiveDeflateUpdateHashTable:ue,setInterpreter:pe,getModuleName:ae,primitiveDeflateBlock:oe,primitiveInflateDecompressBlock:le}):self.setTimeout(e,100)}()})(),registerLibC(),registerOpenGL();var LZString$1={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var t,r,i,s,n,a,o,u="",l=0;for(e=LZString$1.compress(e);l<2*e.length;)l%2==0?(t=e.charCodeAt(l/2)>>8,r=255&e.charCodeAt(l/2),i=l/2+1<e.length?e.charCodeAt(l/2+1)>>8:NaN):(t=255&e.charCodeAt((l-1)/2),(l+1)/2<e.length?(r=e.charCodeAt((l+1)/2)>>8,i=255&e.charCodeAt((l+1)/2)):r=i=NaN),l+=3,s=t>>2,n=(3&t)<<4|r>>4,a=(15&r)<<2|i>>6,o=63&i,isNaN(r)?a=o=64:isNaN(i)&&(o=64),u=u+LZString$1._keyStr.charAt(s)+LZString$1._keyStr.charAt(n)+LZString$1._keyStr.charAt(a)+LZString$1._keyStr.charAt(o);return u},decompressFromBase64:function(e){if(null==e)return"";var t,r,i,s,n,a,o="",u=0,l=0,c=LZString$1._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)r=LZString$1._keyStr.indexOf(e.charAt(l++))<<2|(n=LZString$1._keyStr.indexOf(e.charAt(l++)))>>4,i=(15&n)<<4|(n=LZString$1._keyStr.indexOf(e.charAt(l++)))>>2,s=(3&n)<<6|(a=LZString$1._keyStr.indexOf(e.charAt(l++))),u%2==0?(t=r<<8,64!=n&&(o+=c(t|i)),64!=a&&(t=s<<8)):(o+=c(t|r),64!=n&&(t=i<<8),64!=a&&(o+=c(t|s))),u+=3;return LZString$1.decompress(o)},compressToUTF16:function(e){if(null==e)return"";var t,r,i,s="",n=0,a=LZString$1._f;for(e=LZString$1.compress(e),t=0;t<e.length;t++)switch(r=e.charCodeAt(t),n++){case 0:s+=a(32+(r>>1)),i=(1&r)<<14;break;case 1:s+=a(i+(r>>2)+32),i=(3&r)<<13;break;case 2:s+=a(i+(r>>3)+32),i=(7&r)<<12;break;case 3:s+=a(i+(r>>4)+32),i=(15&r)<<11;break;case 4:s+=a(i+(r>>5)+32),i=(31&r)<<10;break;case 5:s+=a(i+(r>>6)+32),i=(63&r)<<9;break;case 6:s+=a(i+(r>>7)+32),i=(127&r)<<8;break;case 7:s+=a(i+(r>>8)+32),i=(255&r)<<7;break;case 8:s+=a(i+(r>>9)+32),i=(511&r)<<6;break;case 9:s+=a(i+(r>>10)+32),i=(1023&r)<<5;break;case 10:s+=a(i+(r>>11)+32),i=(2047&r)<<4;break;case 11:s+=a(i+(r>>12)+32),i=(4095&r)<<3;break;case 12:s+=a(i+(r>>13)+32),i=(8191&r)<<2;break;case 13:s+=a(i+(r>>14)+32),i=(16383&r)<<1;break;case 14:s+=a(i+(r>>15)+32,32+(32767&r)),n=0}return s+a(i+32)},decompressFromUTF16:function(e){if(null==e)return"";for(var t,r,i="",s=0,n=0,a=LZString$1._f;n<e.length;){switch(r=e.charCodeAt(n)-32,s++){case 0:t=r<<1;break;case 1:i+=a(t|r>>14),t=(16383&r)<<2;break;case 2:i+=a(t|r>>13),t=(8191&r)<<3;break;case 3:i+=a(t|r>>12),t=(4095&r)<<4;break;case 4:i+=a(t|r>>11),t=(2047&r)<<5;break;case 5:i+=a(t|r>>10),t=(1023&r)<<6;break;case 6:i+=a(t|r>>9),t=(511&r)<<7;break;case 7:i+=a(t|r>>8),t=(255&r)<<8;break;case 8:i+=a(t|r>>7),t=(127&r)<<9;break;case 9:i+=a(t|r>>6),t=(63&r)<<10;break;case 10:i+=a(t|r>>5),t=(31&r)<<11;break;case 11:i+=a(t|r>>4),t=(15&r)<<12;break;case 12:i+=a(t|r>>3),t=(7&r)<<13;break;case 13:i+=a(t|r>>2),t=(3&r)<<14;break;case 14:i+=a(t|r>>1),t=(1&r)<<15;break;case 15:i+=a(t|r),s=0}n++}return LZString$1.decompress(i)},compress:function(e){if(null==e)return"";for(var t,r,i,s,n={},a={},o="",u=2,l=3,c=2,h="",f=0,p=0,d=LZString$1._f,m=0;m<e.length;m+=1)if(i=e.charAt(m),Object.prototype.hasOwnProperty.call(n,i)||(n[i]=l++,a[i]=!0),s=o+i,Object.prototype.hasOwnProperty.call(n,s))o=s;else{if(Object.prototype.hasOwnProperty.call(a,o)){if(o.charCodeAt(0)<256){for(t=0;t<c;t++)f<<=1,15==p?(p=0,h+=d(f),f=0):p++;for(r=o.charCodeAt(0),t=0;t<8;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1}else{for(r=1,t=0;t<c;t++)f=f<<1|r,15==p?(p=0,h+=d(f),f=0):p++,r=0;for(r=o.charCodeAt(0),t=0;t<16;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1}0==--u&&(u=Math.pow(2,c),c++),delete a[o]}else for(r=n[o],t=0;t<c;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1;0==--u&&(u=Math.pow(2,c),c++),n[s]=l++,o=String(i)}if(""!==o){if(Object.prototype.hasOwnProperty.call(a,o)){if(o.charCodeAt(0)<256){for(t=0;t<c;t++)f<<=1,15==p?(p=0,h+=d(f),f=0):p++;for(r=o.charCodeAt(0),t=0;t<8;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1}else{for(r=1,t=0;t<c;t++)f=f<<1|r,15==p?(p=0,h+=d(f),f=0):p++,r=0;for(r=o.charCodeAt(0),t=0;t<16;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1}0==--u&&(u=Math.pow(2,c),c++),delete a[o]}else for(r=n[o],t=0;t<c;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1;0==--u&&(u=Math.pow(2,c),c++)}for(r=2,t=0;t<c;t++)f=f<<1|1&r,15==p?(p=0,h+=d(f),f=0):p++,r>>=1;for(;;){if(f<<=1,15==p){h+=d(f);break}p++}return h},decompress:function(e){if(null==e)return"";if(""==e)return null;for(var t,r,i,s,n,a,o=[],u=4,l=4,c=3,h="",f="",p=LZString$1._f,d={string:e,val:e.charCodeAt(0),position:32768,index:1},m=0;m<3;m+=1)o[m]=m;for(r=0,s=Math.pow(2,2),n=1;n!=s;)i=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),r|=(0<i?1:0)*n,n<<=1;switch(r){case 0:for(r=0,s=Math.pow(2,8),n=1;n!=s;)i=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),r|=(0<i?1:0)*n,n<<=1;a=p(r);break;case 1:for(r=0,s=Math.pow(2,16),n=1;n!=s;)i=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),r|=(0<i?1:0)*n,n<<=1;a=p(r);break;case 2:return""}for(t=f=o[3]=a;;){if(d.index>d.string.length)return"";for(r=0,s=Math.pow(2,c),n=1;n!=s;)i=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),r|=(0<i?1:0)*n,n<<=1;switch(a=r){case 0:for(r=0,s=Math.pow(2,8),n=1;n!=s;)i=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),r|=(0<i?1:0)*n,n<<=1;o[l++]=p(r),a=l-1,u--;break;case 1:for(r=0,s=Math.pow(2,16),n=1;n!=s;)i=d.val&d.position,d.position>>=1,0==d.position&&(d.position=32768,d.val=d.string.charCodeAt(d.index++)),r|=(0<i?1:0)*n,n<<=1;o[l++]=p(r),a=l-1,u--;break;case 2:return f}if(0==u&&(u=Math.pow(2,c),c++),o[a])h=o[a];else{if(a!==l)return null;h=t+t.charAt(0)}f+=h,o[l++]=t+h.charAt(0),t=h,0==--u&&(u=Math.pow(2,c),c++)}}};function setupFullscreen(t,e,r){var i,s=e.parentElement,n="fullscreenchange",a="fullscreenElement",o="fullscreenEnabled";function u(e){e=(t.fullscreen=e)||r.fullscreen;s.style.background=e?"black":"",s.style.border=e?"none":"",s.style.borderRadius=e?"0px":"",setTimeout(onresize,0)}return s.requestFullscreen||[{req:s.webkitRequestFullscreen,exit:document.webkitExitFullscreen,evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:s.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:s.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(e){e.req&&(s.requestFullscreen=e.req,document.exitFullscreen=e.exit,n=e.evt,a=e.elem,o=e.enable)}),s.requestFullscreen?(document.addEventListener(n,function(){u(s==document[a])}),function(){document[o]&&s==document[a]!=t.fullscreen&&(t.fullscreen?s.requestFullscreen():document.exitFullscreen())}):(i=!1,function(){i!=t.fullscreen&&u(i=t.fullscreen)})}function recordModifiers(e,t){var r=e.shiftKey,i=e.ctrlKey&&!e.altKey,e=(t.isMac?e.metaKey:e.altKey&&!e.ctrlKey)||t.cmdButtonTouched,r=(r?Squeak.Keyboard_Shift:0)+(i?Squeak.Keyboard_Ctrl:0)+(e?Squeak.Keyboard_Cmd:0);return t.buttons=t.buttons&~Squeak.Keyboard_All|r,r}"undefined"!=typeof module&&null!=module&&(module.exports=LZString$1),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function i(s,n,a){function o(r,e){if(!n[r]){if(!s[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(u)return u(r,!0);e=new Error("Cannot find module '"+r+"'");throw e.code="MODULE_NOT_FOUND",e}t=n[r]={exports:{}};s[r][0].call(t.exports,function(e){var t=s[r][1][e];return o(t||e)},t,t.exports,i,s,n,a)}return n[r].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,t,r){var h=e("./utils"),f=e("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,s,n,a,o=[],u=0,l=e.length,c="string"!==h.getTypeOf(e);u<e.length;)a=l-u,i=c?(t=e[u++],r=u<l?e[u++]:0,u<l?e[u++]:0):(t=e.charCodeAt(u++),r=u<l?e.charCodeAt(u++):0,u<l?e.charCodeAt(u++):0),s=(3&t)<<4|r>>4,n=1<a?(15&r)<<2|i>>6:64,a=2<a?63&i:64,o.push(p.charAt(t>>2)+p.charAt(s)+p.charAt(n)+p.charAt(a));return o.join("")},r.decode=function(e){var t,r,i,s,n,a,o,u=0,l=0,c=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;for(e.charAt(e.length-1)===p.charAt(64)&&c--,e.charAt(e.length-2)===p.charAt(64)&&c--,o=new(f.uint8array?Uint8Array:Array)(c);u<e.length;)i=p.indexOf(e.charAt(u++)),t=(15&(s=p.indexOf(e.charAt(u++))))<<4|(n=p.indexOf(e.charAt(u++)))>>2,r=(3&n)<<6|(a=p.indexOf(e.charAt(u++))),o[l++]=i<<2|s>>4,64!==n&&(o[l++]=t),64!==a&&(o[l++]=r);return o}},{"./support":27,"./utils":29}],2:[function(e,t,r){var i=e("./external"),s=e("./stream/DataWorker"),n=e("./stream/DataLengthProbe"),a=e("./stream/Crc32Probe"),n=e("./stream/DataLengthProbe");function o(e,t,r,i,s){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=i,this.compressedContent=s}o.prototype={getContentWorker:function(){var e=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new n("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,r){return e.pipe(new a).pipe(new n("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new n("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(e,t,r){var i=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(e,t,r){var d=e("./utils");var m=(()=>{for(var e=[],t=0;t<256;t++){for(var r=t,i=0;i<8;i++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e})();t.exports=function(e,t){if(void 0===e||!e.length)return 0;if("string"!==d.getTypeOf(e)){var r=0|t,i=e,s=e.length,n=0,a=m,o=n+s;r^=-1;for(var u=n;u<o;u++)r=r>>>8^a[255&(r^i[u])];return-1^r}var l=0|t,c=e,s=e.length,n=0,h=m,f=n+s;l^=-1;for(var p=n;p<f;p++)l=l>>>8^h[255&(l^c.charCodeAt(p))];return-1^l}},{"./utils":29}],5:[function(e,t,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){e=e("es6-promise").Promise;t.exports={Promise:e}},{"es6-promise":37}],7:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=e("pako"),n=e("./utils"),a=e("./stream/GenericWorker"),o=i?"uint8array":"array";function u(e,t){a.call(this,"FlateWorker/"+e),this._pako=new s[e]({raw:!0,level:t.level||-1}),this.meta={};var r=this;this._pako.onData=function(e){r.push({data:e,meta:r.meta})}}r.magic="\b\0",n.inherits(u,a),u.prototype.processChunk=function(e){this.meta=e.meta,this._pako.push(n.transformTo(o,e.data),!1)},u.prototype.flush=function(){a.prototype.flush.call(this),this._pako.push([],!0)},u.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},r.compressWorker=function(e){return new u("Deflate",e)},r.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(e,t,r){function b(e,t){for(var r="",i=0;i<t;i++)r+=String.fromCharCode(255&e),e>>>=8;return r}function i(e,t,r,i,s,n){var a=e.file,o=e.compression,u=n!==S.utf8encode,l=k.transformTo("string",n(a.name)),c=k.transformTo("string",S.utf8encode(a.name)),h=a.comment,n=k.transformTo("string",n(h)),f=k.transformTo("string",S.utf8encode(h)),p=c.length!==a.name.length,h=f.length!==h.length,d="",m=a.dir,v=a.date,g={crc32:0,compressedSize:0,uncompressedSize:0},r=(t&&!r||(g.crc32=e.crc32,g.compressedSize=e.compressedSize,g.uncompressedSize=e.uncompressedSize),0),e=(t&&(r|=8),u||!p&&!h||(r|=2048),0),t=0,v=(m&&(e|=16),"UNIX"===s?(t=798,e|=(u=a.unixPermissions,s=m,(65535&(u?u:s?16893:33204))<<16)):(t=20,e|=63&(a.dosPermissions||0)),m=v.getUTCHours(),m<<=6,m=(m=(m|v.getUTCMinutes())<<5)|v.getUTCSeconds()/2,u=v.getUTCFullYear()-1980,u=(u=((u<<=4)|v.getUTCMonth()+1)<<5)|v.getUTCDate(),p&&(s=b(1,1)+b(y(l),4)+c,d+="up"+b(s.length,2)+s),h&&(a=b(1,1)+b(y(n),4)+f,d+="uc"+b(a.length,2)+a),""),v=(v=(v=(v=(v=(v=(v=(v=(v=(v+="\n\0")+b(r,2))+o.magic)+b(m,2))+b(u,2))+b(g.crc32,4))+b(g.compressedSize,4))+b(g.uncompressedSize,4))+b(l.length,2))+b(d.length,2);return{fileRecord:I.LOCAL_FILE_HEADER+v+l+d,dirRecord:I.CENTRAL_FILE_HEADER+b(t,2)+v+b(n.length,2)+"\0\0\0\0"+b(e,4)+b(i,4)+l+d+n}}var k=e("../utils"),s=e("../stream/GenericWorker"),S=e("../utf8"),y=e("../crc32"),I=e("../signature");function n(e,t,r,i){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}k.inherits(n,s),n.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,s.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-i-1))/r:100}}))},n.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name,this.streamFiles&&!e.file.dir?(e=i(e,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:e.fileRecord,meta:{percent:0}})):this.accumulate=!0},n.prototype.closedSource=function(e){this.accumulate=!1;var t=i(e,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(t.dirRecord),this.streamFiles&&!e.file.dir)this.push({data:(e=e,I.DATA_DESCRIPTOR+b(e.crc32,4)+b(e.compressedSize,4)+b(e.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:t.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},n.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,r=((e,t,r,i,s)=>(s=k.transformTo("string",s(i)),I.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(e,2)+b(e,2)+b(t,4)+b(r,4)+b(s.length,2)+s))(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},n.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},n.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},n.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},n.prototype.error=function(e){var t=this._sources;if(!s.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},n.prototype.lock=function(){s.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=n},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(e,t,r){var l=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(e,a,t){var o=new i(a.streamFiles,t,a.platform,a.encodeFileName),u=0;try{e.forEach(function(e,t){u++;var r=((e,t)=>{if(t=l[e=e||t])return t;throw new Error(e+" is not a valid compression method !")})(t.options.compression,a.compression),i=t.options.compressionOptions||a.compressionOptions||{},s=t.dir,n=t.date;t._compressWorker(r,i).withStreamInfo("file",{name:e,dir:s,date:n,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)}),o.entriesCount=u}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e,t=new i;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(e,t,r){var i=e("./utils"),a=e("./external"),o=e("./utf8"),i=e("./utils"),u=e("./zipEntries"),l=e("./stream/Crc32Probe"),c=e("./nodejsUtils");t.exports=function(e,s){var n=this;return s=i.extend(s||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(e)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,s.optimizedBinaryString,s.base64).then(function(e){var t=new u(s);return t.load(e),t}).then(function(e){var t=[a.Promise.resolve(e)],r=e.files;if(s.checkCRC32)for(var i=0;i<r.length;i++)t.push((i=>new a.Promise(function(e,t){var r=i.decompressed.getContentWorker().pipe(new l);r.on("error",function(e){t(e)}).on("end",function(){r.streamInfo.crc32!==i.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()}))(r[i]));return a.Promise.all(t)}).then(function(e){for(var e=e.shift(),t=e.files,r=0;r<t.length;r++){var i=t[r];n.file(i.fileNameStr,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileCommentStr.length?i.fileCommentStr:null,unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions,createFolders:s.createFolders})}return e.zipComment.length&&(n.comment=e.zipComment),n})}},{"./external":6,"./nodejsUtils":12,"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(e,t,r){!function(r){t.exports={isNode:void 0!==r,newBuffer:function(e,t){return new r(e,t)},isBuffer:function(e){return r.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}}.call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(e,t,r){function n(e){var t=(e="/"===e.slice(-1)?e.substring(0,e.length-1):e).lastIndexOf("/");return 0<t?e.substring(0,t):""}function a(e,t){return t=void 0!==t?t:c.createFolders,e=g(e),this.files[e]||v.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]}var s=e("./utf8"),o=e("./utils"),u=e("./stream/GenericWorker"),l=e("./stream/StreamHelper"),c=e("./defaults"),h=e("./compressedObject"),f=e("./zipObject"),p=e("./generate"),d=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),v=function(e,t,r){var i=o.getTypeOf(t),s=((r=o.extend(r||{},c)).date=r.date||new Date,null!==r.compression&&(r.compression=r.compression.toUpperCase()),"string"==typeof r.unixPermissions&&(r.unixPermissions=parseInt(r.unixPermissions,8)),r.unixPermissions&&16384&r.unixPermissions&&(r.dir=!0),r.dosPermissions&&16&r.dosPermissions&&(r.dir=!0),r.dir&&(e=g(e)),r.createFolders&&(s=n(e))&&a.call(this,s,!0),"string"===i&&!1===r.binary&&!1===r.base64);r.binary=!s;(t instanceof h&&0===t.uncompressedSize||r.dir||!t||0===t.length)&&(r.base64=!1,r.binary=!0,t="",r.compression="STORE");i=null,i=t instanceof h||t instanceof u?t:d.isNode&&d.isStream(t)?new m(e,t):o.prepareContent(e,t,r.binary,r.optimizedBinaryString,r.base64),s=new f(e,i,r);this.files[e]=s},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e};function b(e){return"[object RegExp]"===Object.prototype.toString.call(e)}t.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,i;for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,i)},filter:function(r){var i=[];return this.forEach(function(e,t){r(e,t)&&i.push(t)}),i},file:function(e,t,r){var i,s;return 1===arguments.length?b(e)?(i=e,this.filter(function(e,t){return!t.dir&&i.test(e)})):(s=this.files[this.root+e])&&!s.dir?s:null:(e=this.root+e,v.call(this,e,t,r),this)},folder:function(r){var e,t;return r?b(r)?this.filter(function(e,t){return t.dir&&r.test(e)}):(e=this.root+r,e=a.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(r){r=this.root+r;var e=this.files[r];if(e||("/"!==r.slice(-1)&&(r+="/"),e=this.files[r]),e&&!e.dir)delete this.files[r];else for(var t=this.filter(function(e,t){return t.name.slice(0,r.length)===r}),i=0;i<t.length;i++)delete this.files[t[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t={};try{if((t=o.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=t.type.toLowerCase(),t.compression=t.compression.toUpperCase(),"binarystring"===t.type&&(t.type="string"),!t.type)throw new Error("No output type specified.");o.checkSupport(t.type),"darwin"!==e.platform&&"freebsd"!==e.platform&&"linux"!==e.platform&&"sunos"!==e.platform||(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var r=t.comment||this.comment||"",i=p.generateWorker(this,t,r)}catch(e){(i=new u("error")).error(e)}return new l(i,t.type||"string",t.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,"./utils":29,"./zipObject":32}],14:[function(e,t,r){var i=e("./DataReader");function s(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(s,i),s.prototype.byteAt=function(e){return this.data[this.zero+e]},s.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),s=e.charCodeAt(3),n=this.length-4;0<=n;--n)if(this.data[n]===t&&this.data[n+1]===r&&this.data[n+2]===i&&this.data[n+3]===s)return n-this.zero;return-1},s.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),e=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&i===s[2]&&e===s[3]},s.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?[]:(t=this.data.slice(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=s},{"../utils":29,"./DataReader":15}],15:[function(e,t,r){var i=e("../utils");function s(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=s},{"../utils":29}],16:[function(e,t,r){var i=e("./Uint8ArrayReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(e,t,r){var i=e("./DataReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},s.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=s},{"../utils":29,"./DataReader":15}],18:[function(e,t,r){var i=e("./ArrayReader");function s(e){i.call(this,e)}e("../utils").inherits(s,i),s.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?new Uint8Array(0):(t=this.data.subarray(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=s},{"../utils":29,"./ArrayReader":14}],19:[function(e,t,r){var i=e("../utils"),s=e("../support"),n=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||s.uint8array?"nodebuffer"===t?new o(e):s.uint8array?new u(i.transformTo("uint8array",e)):new n(i.transformTo("array",e)):new a(e)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(e,t,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],21:[function(e,t,r){var i=e("./GenericWorker"),s=e("../utils");function n(e){i.call(this,"ConvertWorker to "+e),this.destType=e}s.inherits(n,i),n.prototype.processChunk=function(e){this.push({data:s.transformTo(this.destType,e.data),meta:e.meta})},t.exports=n},{"../utils":29,"./GenericWorker":25}],22:[function(e,t,r){var i=e("./GenericWorker"),s=e("../crc32");function n(){i.call(this,"Crc32Probe")}e("../utils").inherits(n,i),n.prototype.processChunk=function(e){this.streamInfo.crc32=s(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=n},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(e,t,r){var i=e("../utils"),s=e("./GenericWorker");function n(e){s.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(n,s),n.prototype.processChunk=function(e){var t;e&&(t=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=t+e.data.length),s.prototype.processChunk.call(this,e)},t.exports=n},{"../utils":29,"./GenericWorker":25}],24:[function(e,t,r){var i=e("../utils"),s=e("./GenericWorker");function n(e){s.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}i.inherits(n,s),n.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished)||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":29,"./GenericWorker":25}],25:[function(e,t,r){function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){var e;return!(!this.isPaused||this.isFinished||(e=this.isPaused=!1,this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),e))},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],26:[function(a,o,e){!function(u){var l=a("../utils"),s=a("./ConvertWorker"),n=a("./GenericWorker"),c=a("../base64"),t=a("../nodejs/NodejsStreamOutputAdapter"),r=a("../external");function i(e,o){return new r.Promise(function(t,r){var i=[],s=e._internalType,n=e._outputType,a=e._mimeType;e.on("data",function(e,t){i.push(e),o&&o(t)}).on("error",function(e){i=[],r(e)}).on("end",function(){try{var e=((e,t,r)=>{switch(e){case"blob":return l.newBlob(l.transformTo("arraybuffer",t),r);case"base64":return c.encode(t);default:return l.transformTo(e,t)}})(n,((e,t)=>{for(var r=0,i=null,s=0,n=0;n<t.length;n++)s+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),n=0;n<t.length;n++)i.set(t[n],r),r+=t[n].length;return i;case"nodebuffer":return u.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}})(s,i),a);t(e)}catch(e){r(e)}i=[]}).resume()})}function e(e,t,r){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=t,this._mimeType=r,l.checkSupport(i),this._worker=e.pipe(new s(i)),e.lock()}catch(e){this._worker=new n("error"),this._worker.error(e)}}e.prototype={accumulate:function(e){return i(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,function(e){t.call(r,e.data,e.meta)}):this._worker.on(e,function(){l.delay(t,arguments,r)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(l.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new t(this,{objectMode:"nodebuffer"!==this._outputType},e)}},o.exports=e}.call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],27:[function(e,t,i){!function(t){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==t,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{t=new ArrayBuffer(0);try{i.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(t),i.blob=0===r.getBlob("application/zip").size}catch(e){i.blob=!1}}}i.nodestream=!!e("./nodejs/NodejsStreamOutputAdapter").prototype}.call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(e,t,s){for(var u=e("./utils"),l=e("./support"),c=e("./nodejsUtils"),r=e("./stream/GenericWorker"),h=new Array(256),i=0;i<256;i++)h[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;h[254]=h[254]=1;function n(){r.call(this,"utf-8 decode"),this.leftOver=null}function a(){r.call(this,"utf-8 encode")}s.utf8encode=function(e){if(l.nodebuffer)return c.newBuffer(e,"utf-8");for(var t,r,i,s,n=e,a=n.length,o=0,u=0;u<a;u++)55296==(64512&(r=n.charCodeAt(u)))&&u+1<a&&56320==(64512&(i=n.charCodeAt(u+1)))&&(r=65536+(r-55296<<10)+(i-56320),u++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new(l.uint8array?Uint8Array:Array)(o),u=s=0;s<o;u++)55296==(64512&(r=n.charCodeAt(u)))&&u+1<a&&56320==(64512&(i=n.charCodeAt(u+1)))&&(r=65536+(r-55296<<10)+(i-56320),u++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},s.utf8decode=function(e){if(l.nodebuffer)return u.transformTo("nodebuffer",e).toString("utf-8");for(var t,r,i=e=u.transformTo(l.uint8array?"uint8array":"array",e),s=i.length,n=new Array(2*s),a=0,o=0;o<s;)if((t=i[o++])<128)n[a++]=t;else if(4<(r=h[t]))n[a++]=65533,o+=r-1;else{for(t&=2===r?31:3===r?15:7;1<r&&o<s;)t=t<<6|63&i[o++],r--;1<r?n[a++]=65533:t<65536?n[a++]=t:(t-=65536,n[a++]=55296|t>>10&1023,n[a++]=56320|1023&t)}return n.length!==a&&(n.subarray?n=n.subarray(0,a):n.length=a),u.applyFromCharCode(n)},u.inherits(n,r),n.prototype.processChunk=function(e){var t=u.transformTo(l.uint8array?"uint8array":"array",e.data),r=(this.leftOver&&this.leftOver.length&&(l.uint8array?(r=t,(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)):t=this.leftOver.concat(t),this.leftOver=null),((e,t)=>{for(var r=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+h[e[r]]>t?r:t})(t)),i=t;r!==t.length&&(l.uint8array?(i=t.subarray(0,r),this.leftOver=t.subarray(r,t.length)):(i=t.slice(0,r),this.leftOver=t.slice(r,t.length))),this.push({data:s.utf8decode(i),meta:e.meta})},n.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=n,u.inherits(a,r),a.prototype.processChunk=function(e){this.push({data:s.utf8encode(e.data),meta:e.meta})},s.Utf8EncodeWorker=a},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(e,t,o){var u=e("./support"),l=e("./base64"),r=e("./nodejsUtils"),i=e("asap"),c=e("./external");function s(e){return e}function h(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}o.newBlob=function(t,r){o.checkSupport("blob");try{return new Blob([t],{type:r})}catch(e){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return i.append(t),i.getBlob(r)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(e,t,r){var i=[],s=0,n=e.length;if(n<=r)return String.fromCharCode.apply(null,e);for(;s<n;)i.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(s,Math.min(s+r,n))):String.fromCharCode.apply(null,e.subarray(s,Math.min(s+r,n)))),s+=r;return i.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:(()=>{try{return u.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}})(),nodebuffer:(()=>{try{return u.nodebuffer&&1===String.fromCharCode.apply(null,r.newBuffer(1)).length}catch(e){return!1}})()}};function a(e){var t=65536,r=o.getTypeOf(e),i=!0;if("uint8array"===r?i=n.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=n.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return n.stringifyByChunk(e,r,t)}catch(e){t=Math.floor(t/2)}return n.stringifyByChar(e)}function f(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}o.applyFromCharCode=a;var p={};p.string={string:s,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:function(e){return h(e,r.newBuffer(e.length))}},p.array={string:a,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBuffer(e)}},p.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBuffer(new Uint8Array(e))}},p.uint8array={string:a,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return r.newBuffer(e)}},p.nodebuffer={string:a,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:s},o.transformTo=function(e,t){if(t=t||"",!e)return t;o.checkSupport(e);var r=o.getTypeOf(t);return p[r][e](t)},o.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":u.nodebuffer&&r.isBuffer(e)?"nodebuffer":u.uint8array&&e instanceof Uint8Array?"uint8array":u.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(e){if(!u[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(e){for(var t,r="",i=0;i<(e||"").length;i++)r+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return r},o.delay=function(e,t,r){i(function(){e.apply(r||null,t||[])})},o.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},o.extend=function(){for(var e,t={},r=0;r<arguments.length;r++)for(e in arguments[r])arguments[r].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[r][e]);return t},o.prepareContent=function(r,i,s,n,a){return(u.blob&&i instanceof Blob&&"undefined"!=typeof FileReader?new c.Promise(function(t,r){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){r(e.target.error)},e.readAsArrayBuffer(i)}):c.Promise.resolve(i)).then(function(e){var t=o.getTypeOf(e);return t?("arraybuffer"===t?e=o.transformTo("uint8array",e):"string"===t&&(a?e=l.decode(e):s&&!0!==n&&(e=h(t=e,new(u.uint8array?Uint8Array:Array)(t.length)))),e):c.Promise.reject(new Error("The data of '"+r+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(e,t,r){var i=e("./reader/readerFor"),s=e("./utils"),n=e("./signature"),a=e("./zipEntry"),o=(e("./utf8"),e("./support"));function u(e){this.files=[],this.loadOptions=e}u.prototype={checkSignature:function(e){var t;if(!this.reader.readAndCheckSignature(e))throw this.reader.index-=4,t=this.reader.readString(4),new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);e=this.reader.readString(4)===t;return this.reader.setIndex(r),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",t=s.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(t)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}e=this.centralDirOffset+this.centralDirSize,e=t-(e=this.zip64?e+20+(12+this.zip64EndOfCentralSize):e);if(0<e)this.isSignature(t,n.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=u},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(e,t,r){var i=e("./reader/readerFor"),s=e("./utils"),n=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),u=e("./compressions"),l=e("./support");function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(t),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=(e=>{for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null})(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){var t;this.extraFields[1]&&(t=i(this.extraFields[1].value),this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS)&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t,r,i,s=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<s;)t=e.readInt(2),r=e.readInt(2),i=e.readData(r),this.extraFields[t]={id:t,length:r,value:i}},handleUTF8:function(){var e,t=l.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(e=s.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(e)),null!==(e=this.findExtraFieldUnicodeComment())?this.fileCommentStr=e:(e=s.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(e)))},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=i(t.value)).readInt(1)||a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))},findExtraFieldUnicodeComment:function(){var e,t=this.extraFields[25461];return!t||1!==(e=i(t.value)).readInt(1)||a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}},t.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(e,t,r){for(var s=e("./stream/StreamHelper"),i=e("./stream/DataWorker"),n=e("./utf8"),a=e("./compressedObject"),o=e("./stream/GenericWorker"),u=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}},l=(u.prototype={internalStream:function(e){var e=e.toLowerCase(),t="string"===e||"text"===e,r=("binarystring"!==e&&"text"!==e||(e="string"),this._decompressWorker()),i=!this._dataBinary;return i&&!t&&(r=r.pipe(new n.Utf8EncodeWorker)),!i&&t&&(r=r.pipe(new n.Utf8DecodeWorker)),new s(r,e,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){var r;return this._data instanceof a&&this._data.compression.magic===e.magic?this._data.getCompressedWorker():(r=this._decompressWorker(),this._dataBinary||(r=r.pipe(new n.Utf8EncodeWorker)),a.createWorkerFrom(r,e,t))},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof o?this._data:new i(this._data)}},["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"]),c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<l.length;h++)u.prototype[l[h]]=c;t.exports=u},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],33:[function(e,t,r){var i=e("./raw"),s=[],n=[],a=i.makeRequestCallFromTimer(function(){if(n.length)throw n.shift()});function o(e){var t=s.length?s.pop():new u;t.task=e,i(t)}function u(){this.task=null}t.exports=o,u.prototype.call=function(){try{this.task.call()}catch(e){o.onerror?o.onerror(e):(n.push(e),a())}finally{this.task=null,s[s.length]=this}}},{"./raw":34}],34:[function(e,l,t){!function(e){function t(e){i.length||r(),i[i.length]=e}l.exports=t;var r,i=[],s=0;function n(){for(;s<i.length;){var e=s;if(s+=1,i[e].call(),1024<s){for(var t=0,r=i.length-s;t<r;t++)i[t]=i[t+s];i.length-=s,s=0}}i.length=0,s=0}var a,o,e=e.MutationObserver||e.WebKitMutationObserver;function u(i){return function(){var e=setTimeout(r,0),t=setInterval(r,50);function r(){clearTimeout(e),clearInterval(t),i()}}}r="function"==typeof e?(a=1,e=new e(e=n),o=document.createTextNode(""),e.observe(o,{characterData:!0}),function(){a=-a,o.data=a}):u(n),t.requestFlush=r,t.makeRequestCallFromTimer=u}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,t,r){},{}],36:[function(e,t,r){var i,t=t.exports={},s=[],n=!1,a=-1;function o(){n=!1,i.length?s=i.concat(s):a=-1,s.length&&u()}function u(){if(!n){for(var e=setTimeout(o),t=(n=!0,s.length);t;){for(i=s,s=[];++a<t;)i&&i[a].run();a=-1,t=s.length}i=null,n=!1,clearTimeout(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];s.push(new l(e,t)),1!==s.length||n||setTimeout(u,0)},l.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=c,t.addListener=c,t.once=c,t.off=c,t.removeListener=c,t.removeAllListeners=c,t.emit=c,t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],37:[function(W,z,e){!function(U,G){!function(){function l(e){return"function"==typeof e}var t,r,e=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=e,i=0,o=function(e,t){d[i]=e,d[i+1]=t,2===(i+=2)&&(r?r(m):b())};var e="undefined"!=typeof window?window:void 0,s=e||{},s=s.MutationObserver||s.WebKitMutationObserver,n=void 0!==U&&"[object process]"==={}.toString.call(U),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){return function(){setTimeout(m,1)}}var h,f,p,d=new Array(1e3);function m(){for(var e=0;e<i;e+=2)(0,d[e])(d[e+1]),d[e]=void 0,d[e+1]=void 0;i=0}function v(){try{var e=W("vertx");return t=e.runOnLoop||e.runOnContext,function(){t(m)}}catch(e){return c()}}function g(){}var b=n?function(){U.nextTick(m)}:s?(f=0,n=new s(m),p=document.createTextNode(""),n.observe(p,{characterData:!0}),function(){p.data=f=++f%2}):u?((h=new MessageChannel).port1.onmessage=m,function(){h.port2.postMessage(0)}):(void 0===e&&"function"==typeof W?v:c)(),k=void 0,S=1,y=2,I=new x;function O(e,i,s){o(function(t){var r=!1,e=((e,t,r,i)=>{try{e.call(t,r,i)}catch(e){return e}})(s,i,function(e){r||(r=!0,(i!==e?A:_)(t,e))},function(e){r||(r=!0,P(t,e))},t._label);!r&&e&&(r=!0,P(t,e))},e)}function F(e,t){var r,i;t.constructor===e.constructor?(r=e,(i=t)._state===S?_(r,i._result):i._state===y?P(r,i._result):w(i,void 0,function(e){A(r,e)},function(e){P(r,e)})):(i=(e=>{try{return e.then}catch(e){return I.error=e,I}})(t))===I?P(e,I.error):void 0!==i&&l(i)?O(e,t,i):_(e,t)}function A(e,t){var r;e===t?P(e,new TypeError("You cannot resolve a promise with itself")):("function"==typeof(r=t)||"object"==typeof r&&null!==r?F:_)(e,t)}function N(e){e._onerror&&e._onerror(e._result),C(e)}function _(e,t){e._state===k&&(e._result=t,e._state=S,0!==e._subscribers.length)&&o(C,e)}function P(e,t){e._state===k&&(e._state=y,e._result=t,o(N,e))}function w(e,t,r,i){var s=e._subscribers,n=s.length;e._onerror=null,s[n]=t,s[n+S]=r,s[n+y]=i,0===n&&e._state&&o(C,e)}function C(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i,s,n=e._result,a=0;a<t.length;a+=3)i=t[a],s=t[a+r],i?T(r,i,s,n):s(n);e._subscribers.length=0}}function x(){this.error=null}var E=new x;function T(e,t,r,i){var s,n,a,o,u=l(r);if(u){if((s=((e,t)=>{try{return e(t)}catch(e){return E.error=e,E}})(r,i))===E?(o=!0,n=s.error,s=null):a=!0,t===s)return void P(t,new TypeError("A promises callback cannot return that same promise."))}else s=i,a=!0;t._state===k&&(u&&a?A(t,s):o?P(t,n):e===S?_(t,s):e===y&&P(t,s))}function L(e,t){var r=this;r._instanceConstructor=e,r.promise=new e(g),r._validateInput(t)?(r._input=t,r.length=t.length,r._remaining=t.length,r._init(),0!==r.length&&(r.length=r.length||0,r._enumerate(),0!==r._remaining)||_(r.promise,r._result)):P(r.promise,r._validationError())}L.prototype._validateInput=function(e){return a(e)},L.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},L.prototype._init=function(){this._result=new Array(this.length)};var j=L;L.prototype._enumerate=function(){for(var e=this.length,t=this.promise,r=this._input,i=0;t._state===k&&i<e;i++)this._eachEntry(r[i],i)},L.prototype._eachEntry=function(e,t){var r,i=this._instanceConstructor;"object"==typeof(r=e)&&null!==r?e.constructor===i&&e._state!==k?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(i.resolve(e),t):(this._remaining--,this._result[t]=e)},L.prototype._settledAt=function(e,t,r){var i=this.promise;i._state===k&&(this._remaining--,e===y?P(i,r):this._result[t]=r),0===this._remaining&&_(i,this._result)},L.prototype._willSettleAt=function(e,t){var r=this;w(e,void 0,function(e){r._settledAt(S,t,e)},function(e){r._settledAt(y,t,e)})};function B(e){var t=new this(g);if(a(e))for(var r=e.length,i=0;t._state===k&&i<r;i++)w(this.resolve(e[i]),void 0,s,n);else P(t,new TypeError("You must pass an array to race."));return t;function s(e){A(t,e)}function n(e){P(t,e)}}function R(e){var t;return e&&"object"==typeof e&&e.constructor===this?e:(A(t=new this(g),e),t)}function q(e){var t=new this(g);return P(t,e),t}var D=0;var M=V;function V(e){if(this._id=D++,this._state=void 0,this._result=void 0,this._subscribers=[],g!==e){if(!l(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof V))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var t=this;try{e(function(e){A(t,e)},function(e){P(t,e)})}catch(e){P(t,e)}}}V.all=function(e){return new j(this,e).promise},V.race=B,V.resolve=R,V.reject=q,V._setScheduler=function(e){r=e},V._setAsap=function(e){o=e},V._asap=o,V.prototype={constructor:V,then:function(e,t){var r,i,s,n=this._state;return n===S&&!e||n===y&&!t?this:(r=new this.constructor(g),i=this._result,n?(s=arguments[n-1],o(function(){T(n,r,s,i)})):w(this,r,e,t),r)},catch:function(e){return this.then(null,e)}};s=function(){var e;if(void 0!==G)e=G;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;t&&"[object Promise]"===Object.prototype.toString.call(t.resolve())&&!t.cast||(e.Promise=M)},n={Promise:M,polyfill:s};void 0!==z&&z.exports?z.exports=n:void 0!==this&&(this.ES6Promise=n),s()}.call(this)}.call(this,W("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:36}],38:[function(e,t,r){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){var a=e("./zlib/deflate"),o=e("./utils/common"),u=e("./utils/strings"),i=e("./zlib/messages"),s=e("./zlib/zstream"),l=Object.prototype.toString;function n(e){if(!(this instanceof n))return new n(e);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});e=this.options;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,(this.strm.avail_out=0)!==(t=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy)))throw new Error(i[t]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var t,e="string"==typeof e.dictionary?u.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if(0!==(t=a.deflateSetDictionary(this.strm,e)))throw new Error(i[t]);this._dict_set=!0}}function c(e,t){t=new n(t);if(t.push(e,!0),t.err)throw t.msg;return t.result}n.prototype.push=function(e,t){var r,i,s=this.strm,n=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=u.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(n),s.next_out=0,s.avail_out=n),1!==(r=a.deflate(s,i))&&0!==r)return this.onEnd(r),!(this.ended=!0)}while(0!==s.avail_out&&(0!==s.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(u.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out))),(0<s.avail_in||0===s.avail_out)&&1!==r);return 4===i?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==i||(this.onEnd(0),!(s.avail_out=0))},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=n,r.deflate=c,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){var h=e("./zlib/inflate"),f=e("./utils/common"),p=e("./utils/strings"),d=e("./zlib/constants"),i=e("./zlib/messages"),s=e("./zlib/zstream"),n=e("./zlib/gzheader"),m=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0,h.inflateInit2(this.strm,t.windowBits));if(e!==d.Z_OK)throw new Error(i[e]);this.header=new n,h.inflateGetHeader(this.strm,this.header)}function o(e,t){t=new a(t);if(t.push(e,!0),t.err)throw t.msg;return t.result}a.prototype.push=function(e,t){var r,i,s,n,a,o=this.strm,u=this.options.chunkSize,l=this.options.dictionary,c=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?d.Z_FINISH:d.Z_NO_FLUSH,"string"==typeof e?o.input=p.binstring2buf(e):"[object ArrayBuffer]"===m.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new f.Buf8(u),o.next_out=0,o.avail_out=u),(r=h.inflate(o,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&l&&(a="string"==typeof l?p.string2buf(l):"[object ArrayBuffer]"===m.call(l)?new Uint8Array(l):l,r=h.inflateSetDictionary(this.strm,a)),r===d.Z_BUF_ERROR&&!0===c&&(r=d.Z_OK,c=!1),r!==d.Z_STREAM_END&&r!==d.Z_OK)return this.onEnd(r),!(this.ended=!0)}while(!o.next_out||0!==o.avail_out&&r!==d.Z_STREAM_END&&(0!==o.avail_in||i!==d.Z_FINISH&&i!==d.Z_SYNC_FLUSH)||("string"===this.options.to?(a=p.utf8border(o.output,o.next_out),s=o.next_out-a,n=p.buf2string(o.output,a),o.next_out=s,o.avail_out=u-s,s&&f.arraySet(o.output,o.output,a,s,0),this.onData(n)):this.onData(f.shrinkBuf(o.output,o.next_out))),0===o.avail_in&&0===o.avail_out&&(c=!0),(0<o.avail_in||0===o.avail_out)&&r!==d.Z_STREAM_END);return(i=r===d.Z_STREAM_END?d.Z_FINISH:i)===d.Z_FINISH?(r=h.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===d.Z_OK):i!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(o.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===d.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},r.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,s=(r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}}return e},r.shrinkBuf=function(e,t){if(e.length!==t){if(e.subarray)return e.subarray(0,t);e.length=t}return e},{arraySet:function(e,t,r,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),s);else for(var n=0;n<i;n++)e[s+n]=t[r+n]},flattenChunks:function(e){for(var t,r,i,s=0,n=0,a=e.length;n<a;n++)s+=e[n].length;for(i=new Uint8Array(s),n=t=0,a=e.length;n<a;n++)r=e[n],i.set(r,t),t+=r.length;return i}}),n={arraySet:function(e,t,r,i,s){for(var n=0;n<i;n++)e[s+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,n))},r.setTyped(i)},{}],42:[function(e,t,r){var u=e("./common"),s=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){n=!1}for(var l=new u.Buf8(256),i=0;i<256;i++)l[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function c(e,t){if(t<65537&&(e.subarray&&n||!e.subarray&&s))return String.fromCharCode.apply(null,u.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}l[254]=l[254]=1,r.string2buf=function(e){for(var t,r,i,s,n=e.length,a=0,o=0;o<n;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new u.Buf8(a),o=s=0;s<a;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},r.buf2binstring=function(e){return c(e,e.length)},r.binstring2buf=function(e){for(var t=new u.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){for(var r,i,s=t||e.length,n=new Array(2*s),a=0,o=0;o<s;)if((r=e[o++])<128)n[a++]=r;else if(4<(i=l[r]))n[a++]=65533,o+=i-1;else{for(r&=2===i?31:3===i?15:7;1<i&&o<s;)r=r<<6|63&e[o++],i--;1<i?n[a++]=65533:r<65536?n[a++]=r:(r-=65536,n[a++]=55296|r>>10&1023,n[a++]=56320|1023&r)}return c(n,a)},r.utf8border=function(e,t){for(var r=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+l[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){t.exports=function(e,t,r,i){for(var s=65535&e|0,n=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;n=n+(s=s+t[i++]|0)|0,--a;);s%=65521,n%=65521}return s|n<<16|0}},{}],44:[function(e,t,r){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){var o=(()=>{for(var e=[],t=0;t<256;t++){for(var r=t,i=0;i<8;i++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e})();t.exports=function(e,t,r,i){var s=o,n=i+r;e^=-1;for(var a=i;a<n;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},{}],46:[function(e,N,t){var o,h=e("../utils/common"),u=e("./trees"),f=e("./adler32"),p=e("./crc32"),j=e("./messages"),l=0,c=4,d=0,m=-2,B=-1,R=4,q=2,v=8,D=9,r=286,U=30,G=19,W=2*r+1,z=15,g=3,b=258,k=b+g+1,S=42,y=113,I=1,O=2,F=3,A=4;function _(e,t){return e.msg=j[t],t}function P(e){return(e<<1)-(4<e?9:0)}function w(e){for(var t=e.length;0<=--t;)e[t]=0}function C(e){var t=e.state,r=t.pending;0!==(r=e.avail_out<r?e.avail_out:r)&&(h.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending)&&(t.pending_out=0)}function x(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,C(e.strm)}function E(e,t){e.pending_buf[e.pending++]=t}function T(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function n(e,t){var r,i,s=e.max_chain_length,n=e.strstart,a=e.prev_length,o=e.nice_match,u=e.w_size-k<e.strstart?e.strstart-(e.w_size-k):0,l=e.window,c=e.w_mask,h=e.prev,f=e.strstart+b,p=l[n+a-1],d=l[n+a];e.good_match<=e.prev_length&&(s>>=2),e.lookahead<o&&(o=e.lookahead);do{if(l[(r=t)+a]===d&&l[r+a-1]===p&&l[r]===l[n]&&l[++r]===l[n+1]){for(n+=2,r++;l[++n]===l[++r]&&l[++n]===l[++r]&&l[++n]===l[++r]&&l[++n]===l[++r]&&l[++n]===l[++r]&&l[++n]===l[++r]&&l[++n]===l[++r]&&l[++n]===l[++r]&&n<f;);if(i=b-(f-n),n=f-b,a<i){if(e.match_start=t,o<=(a=i))break;p=l[n+a-1],d=l[n+a]}}}while((t=h[t&c])>u&&0!=--s);return a<=e.lookahead?a:e.lookahead}function L(e){var t,r,i,s,n,a,o,u,l,c=e.w_size;do{if(u=e.window_size-e.lookahead-e.strstart,c+(c-k)<=e.strstart){for(h.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=r=e.hash_size;i=e.head[--t],e.head[t]=c<=i?i-c:0,--r;);for(t=r=c;i=e.prev[--t],e.prev[t]=c<=i?i-c:0,--r;);u+=c}if(0===e.strm.avail_in)break;if(a=e.window,o=e.strstart+e.lookahead,u=u,l=void 0,l=(n=e.strm).avail_in,r=0===(l=u<l?u:l)?0:(n.avail_in-=l,h.arraySet(a,n.input,n.next_in,l,o),1===n.state.wrap?n.adler=f(n.adler,a,l,o):2===n.state.wrap&&(n.adler=p(n.adler,a,l,o)),n.next_in+=l,n.total_in+=l,l),e.lookahead+=r,g<=e.lookahead+e.insert)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+g-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<g)););}while(e.lookahead<k&&0!==e.strm.avail_in)}function i(e,t){for(var r,i;;){if(e.lookahead<k){if(L(e),e.lookahead<k&&t===l)return I;if(0===e.lookahead)break}if(r=0,g<=e.lookahead&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-k&&(e.match_length=n(e,r)),g<=e.match_length)if(i=u._tr_tally(e,e.strstart-e.match_start,e.match_length-g),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=g){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=e.strstart<g-1?e.strstart:g-1,t===c?(x(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:O}function s(e,t){for(var r,i,s;;){if(e.lookahead<k){if(L(e),e.lookahead<k&&t===l)return I;if(0===e.lookahead)break}if(r=0,g<=e.lookahead&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=g-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-k&&(e.match_length=n(e,r),e.match_length<=5)&&(1===e.strategy||e.match_length===g&&4096<e.strstart-e.match_start)&&(e.match_length=g-1),g<=e.prev_length&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-g,i=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-g),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=g-1,e.strstart++,i&&(x(e,!1),0===e.strm.avail_out))return I}else if(e.match_available){if((i=u._tr_tally(e,0,e.window[e.strstart-1]))&&x(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return I}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<g-1?e.strstart:g-1,t===c?(x(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:O}function a(e,t,r,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=s}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*W),this.dyn_dtree=new h.Buf16(2*(2*U+1)),this.bl_tree=new h.Buf16(2*(2*G+1)),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(z+1),this.heap=new h.Buf16(2*r+1),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*r+1),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function M(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=q,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?S:y,e.adler=2===t.wrap?0:1,t.last_flush=l,u._tr_init(t),d):_(e,m)}function V(e){var t=M(e);return t===d&&((e=e.state).window_size=2*e.w_size,w(e.head),e.max_lazy_match=o[e.level].max_lazy,e.good_match=o[e.level].good_length,e.nice_match=o[e.level].nice_length,e.max_chain_length=o[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=g-1,e.match_available=0,e.ins_h=0),t}function K(e,t,r,i,s,n){if(!e)return m;var a=1;if(t===B&&(t=6),i<0?(a=0,i=-i):15<i&&(a=2,i-=16),s<1||D<s||r!==v||i<8||15<i||t<0||9<t||n<0||R<n)return _(e,m);8===i&&(i=9);var o=new H;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+g-1)/g),o.window=new h.Buf8(2*o.w_size),o.head=new h.Buf16(o.hash_size),o.prev=new h.Buf16(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new h.Buf8(o.pending_buf_size),o.d_buf=o.lit_bufsize>>1,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=n,o.method=r,V(e)}o=[new a(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(L(e),0===e.lookahead&&t===l)return I;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,x(e,!1),0===e.strm.avail_out))return I;if(e.w_size-k<=e.strstart-e.block_start&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=0,t===c?(x(e,!0),0===e.strm.avail_out?F:A):(e.block_start<e.strstart&&(x(e,!1),e.strm.avail_out),I)}),new a(4,4,8,4,i),new a(4,5,16,8,i),new a(4,6,32,32,i),new a(4,4,16,16,s),new a(8,16,32,32,s),new a(8,16,128,128,s),new a(8,32,128,256,s),new a(32,128,258,1024,s),new a(32,258,258,4096,s)],t.deflateInit=function(e,t){return K(e,t,v,15,8,0)},t.deflateInit2=K,t.deflateReset=V,t.deflateResetKeep=M,t.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?m:(e.state.gzhead=t,d)},t.deflate=function(e,t){var r,i,s,n;if(!e||!e.state||5<t||t<0)return e?_(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==c)return _(e,0===e.avail_out?-5:m);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===S&&(2===i.wrap?(e.adler=0,E(i,31),E(i,139),E(i,8),i.gzhead?(E(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),E(i,255&i.gzhead.time),E(i,i.gzhead.time>>8&255),E(i,i.gzhead.time>>16&255),E(i,i.gzhead.time>>24&255),E(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),E(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(E(i,255&i.gzhead.extra.length),E(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=p(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(E(i,0),E(i,0),E(i,0),E(i,0),E(i,0),E(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),E(i,3),i.status=y)):(a=v+(i.w_bits-8<<4)<<8,a|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=y,T(i,a),0!==i.strstart&&(T(i,e.adler>>>16),T(i,65535&e.adler)),e.adler=1)),69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),C(e),s=i.pending,i.pending!==i.pending_buf_size));)E(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),C(e),s=i.pending,i.pending===i.pending_buf_size)){n=1;break}}while(n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,E(i,n),0!==n);i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),0===n&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),C(e),s=i.pending,i.pending===i.pending_buf_size)){n=1;break}}while(n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,E(i,n),0!==n);i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),0===n&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&C(e),i.pending+2<=i.pending_buf_size&&(E(i,255&e.adler),E(i,e.adler>>8&255),e.adler=0,i.status=y)):i.status=y),0!==i.pending){if(C(e),0===e.avail_out)return i.last_flush=-1,d}else if(0===e.avail_in&&P(t)<=P(r)&&t!==c)return _(e,-5);if(666===i.status&&0!==e.avail_in)return _(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==l&&666!==i.status){var a=2===i.strategy?((e,t)=>{for(var r;;){if(0===e.lookahead&&(L(e),0===e.lookahead)){if(t===l)return I;break}if(e.match_length=0,r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=0,t===c?(x(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:O})(i,t):3===i.strategy?((e,t)=>{for(var r,i,s,n,a=e.window;;){if(e.lookahead<=b){if(L(e),e.lookahead<=b&&t===l)return I;if(0===e.lookahead)break}if(e.match_length=0,g<=e.lookahead&&0<e.strstart&&(i=a[s=e.strstart-1])===a[++s]&&i===a[++s]&&i===a[++s]){for(n=e.strstart+b;i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<n;);e.match_length=b-(n-s),e.lookahead<e.match_length&&(e.match_length=e.lookahead)}if(g<=e.match_length?(r=u._tr_tally(e,1,e.match_length-g),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(x(e,!1),0===e.strm.avail_out))return I}return e.insert=0,t===c?(x(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(x(e,!1),0===e.strm.avail_out)?I:O})(i,t):o[i.level].func(i,t);if(a!==F&&a!==A||(i.status=666),a===I||a===F)return 0===e.avail_out&&(i.last_flush=-1),d;if(a===O&&(1===t?u._tr_align(i):5!==t&&(u._tr_stored_block(i,0,0,!1),3===t)&&(w(i.head),0===i.lookahead)&&(i.strstart=0,i.block_start=0,i.insert=0),C(e),0===e.avail_out))return i.last_flush=-1,d}return t!==c||!(i.wrap<=0)&&(2===i.wrap?(E(i,255&e.adler),E(i,e.adler>>8&255),E(i,e.adler>>16&255),E(i,e.adler>>24&255),E(i,255&e.total_in),E(i,e.total_in>>8&255),E(i,e.total_in>>16&255),E(i,e.total_in>>24&255)):(T(i,e.adler>>>16),T(i,65535&e.adler)),C(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending)?d:1},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==S&&69!==t&&73!==t&&91!==t&&103!==t&&t!==y&&666!==t?_(e,m):(e.state=null,t===y?_(e,-3):d):m},t.deflateSetDictionary=function(e,t){var r,i,s,n,a,o,u,l=t.length;if(!e||!e.state)return m;if(2===(n=(r=e.state).wrap)||1===n&&r.status!==S||r.lookahead)return m;for(1===n&&(e.adler=f(e.adler,t,l,0)),r.wrap=0,r.w_size<=l&&(0===n&&(w(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new h.Buf8(r.w_size),h.arraySet(u,t,l-r.w_size,r.w_size,0),t=u,l=r.w_size),u=e.avail_in,a=e.next_in,o=e.input,e.avail_in=l,e.next_in=0,e.input=t,L(r);r.lookahead>=g;){for(i=r.strstart,s=r.lookahead-(g-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+g-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--s;);r.strstart=i,r.lookahead=g-1,L(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=g-1,r.match_available=0,e.next_in=a,e.input=o,e.avail_in=u,r.wrap=n,d},t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){t.exports=function(e,t){var r,i,s,n,a,o,u=e.state,l=e.next_in,c=e.input,h=l+(e.avail_in-5),f=e.next_out,p=e.output,d=f-(t-e.avail_out),m=f+(e.avail_out-257),v=u.dmax,g=u.wsize,b=u.whave,k=u.wnext,S=u.window,y=u.hold,I=u.bits,O=u.lencode,F=u.distcode,A=(1<<u.lenbits)-1,_=(1<<u.distbits)-1;e:do{for(I<15&&(y+=c[l++]<<I,I+=8,y+=c[l++]<<I,I+=8),r=O[y&A];;){if(y>>>=i=r>>>24,I-=i,0===(i=r>>>16&255))p[f++]=65535&r;else{if(!(16&i)){if(0==(64&i)){r=O[(65535&r)+(y&(1<<i)-1)];continue}if(32&i){u.mode=12;break e}e.msg="invalid literal/length code",u.mode=30;break e}for(s=65535&r,(i&=15)&&(I<i&&(y+=c[l++]<<I,I+=8),s+=y&(1<<i)-1,y>>>=i,I-=i),I<15&&(y+=c[l++]<<I,I+=8,y+=c[l++]<<I,I+=8),r=F[y&_];;){if(y>>>=i=r>>>24,I-=i,!(16&(i=r>>>16&255))){if(0==(64&i)){r=F[(65535&r)+(y&(1<<i)-1)];continue}e.msg="invalid distance code",u.mode=30;break e}if(n=65535&r,I<(i&=15)&&(y+=c[l++]<<I,(I+=8)<i)&&(y+=c[l++]<<I,I+=8),v<(n+=y&(1<<i)-1)){e.msg="invalid distance too far back",u.mode=30;break e}if(y>>>=i,I-=i,(i=f-d)<n){if(b<(i=n-i)&&u.sane){e.msg="invalid distance too far back",u.mode=30;break e}if(o=S,(a=0)===k){if(a+=g-i,i<s){for(s-=i;p[f++]=S[a++],--i;);a=f-n,o=p}}else if(k<i){if(a+=g+k-i,(i-=k)<s){for(s-=i;p[f++]=S[a++],--i;);if(a=0,k<s){for(s-=i=k;p[f++]=S[a++],--i;);a=f-n,o=p}}}else if(a+=k-i,i<s){for(s-=i;p[f++]=S[a++],--i;);a=f-n,o=p}for(;2<s;)p[f++]=o[a++],p[f++]=o[a++],p[f++]=o[a++],s-=3;s&&(p[f++]=o[a++],1<s)&&(p[f++]=o[a++])}else{for(a=f-n;p[f++]=p[a++],p[f++]=p[a++],p[f++]=p[a++],2<(s-=3););s&&(p[f++]=p[a++],1<s)&&(p[f++]=p[a++])}break}}break}}while(l<h&&f<m);y&=(1<<(I-=(s=I>>3)<<3))-1,e.next_in=l-=s,e.next_out=f,e.avail_in=l<h?h-l+5:5-(l-h),e.avail_out=f<m?m-f+257:257-(f-m),u.hold=y,u.bits=I}},{}],49:[function(e,t,r){var E=e("../utils/common"),T=e("./adler32"),L=e("./crc32"),M=e("./inffast"),V=e("./inftrees"),N=1,j=2,B=0,R=-2,q=1,i=852,s=592;function D(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new E.Buf16(320),this.work=new E.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=q,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new E.Buf32(i),t.distcode=t.distdyn=new E.Buf32(s),t.sane=1,t.back=-1,B):R}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):R}function u(e,t){var r,i;return!e||!e.state||(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?R:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,o(e))}function l(e,t){var r;return e?(r=new n,(e.state=r).window=null,(r=u(e,t))!==B&&(e.state=null),r):R}var U,G,W=!0;function z(e,t,r,i){var s,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new E.Buf8(e.wsize)),e.wsize<=i?(E.arraySet(e.window,t,r-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(i<(s=e.wsize-e.wnext)&&(s=i),E.arraySet(e.window,t,r-i,s,e.wnext),(i-=s)?(E.arraySet(e.window,t,r-i,i,0),e.wnext=i,e.whave=e.wsize):(e.wnext+=s,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=s))),0}r.inflateReset=o,r.inflateReset2=u,r.inflateResetKeep=a,r.inflateInit=function(e){return l(e,15)},r.inflateInit2=l,r.inflate=function(e,t){var r,i,s,n,a,o,u,l,c,h,f,p,d,m,v,g,b,k,S,y,I,O,F,A,_=0,P=new E.Buf8(4),w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return R;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,s=e.output,n=e.next_in,i=e.input,l=r.hold,c=r.bits,h=o=e.avail_in,f=u=e.avail_out,O=B;e:for(;;)switch(r.mode){case q:if(0===r.wrap)r.mode=13;else{for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(2&r.wrap&&35615===l)P[r.check=0]=255&l,P[1]=l>>>8&255,r.check=L(r.check,P,2,0),c=l=0,r.mode=2;else if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&l)<<8)+(l>>8))%31)e.msg="incorrect header check",r.mode=30;else if(8!=(15&l))e.msg="unknown compression method",r.mode=30;else{if(c-=4,I=8+(15&(l>>>=4)),0===r.wbits)r.wbits=I;else if(I>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<I,e.adler=r.check=1,r.mode=512&l?10:12,c=l=0}}break;case 2:for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(r.flags=l,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=l>>8&1),512&r.flags&&(P[0]=255&l,P[1]=l>>>8&255,r.check=L(r.check,P,2,0)),c=l=0,r.mode=3;case 3:for(;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}r.head&&(r.head.time=l),512&r.flags&&(P[0]=255&l,P[1]=l>>>8&255,P[2]=l>>>16&255,P[3]=l>>>24&255,r.check=L(r.check,P,4,0)),c=l=0,r.mode=4;case 4:for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}r.head&&(r.head.xflags=255&l,r.head.os=l>>8),512&r.flags&&(P[0]=255&l,P[1]=l>>>8&255,r.check=L(r.check,P,2,0)),c=l=0,r.mode=5;case 5:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}r.length=l,r.head&&(r.head.extra_len=l),512&r.flags&&(P[0]=255&l,P[1]=l>>>8&255,r.check=L(r.check,P,2,0)),c=l=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((p=o<(p=r.length)?o:p)&&(r.head&&(I=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),E.arraySet(r.head.extra,i,n,p,I)),512&r.flags&&(r.check=L(r.check,i,p,n)),o-=p,n+=p,r.length-=p),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;for(p=0;I=i[n+p++],r.head&&I&&r.length<65536&&(r.head.name+=String.fromCharCode(I)),I&&p<o;);if(512&r.flags&&(r.check=L(r.check,i,p,n)),o-=p,n+=p,I)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;for(p=0;I=i[n+p++],r.head&&I&&r.length<65536&&(r.head.comment+=String.fromCharCode(I)),I&&p<o;);if(512&r.flags&&(r.check=L(r.check,i,p,n)),o-=p,n+=p,I)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(l!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}c=l=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}e.adler=r.check=D(l),c=l=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=u,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=c,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last)l>>>=7&c,c-=7&c,r.mode=27;else{for(;c<3;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}switch(r.last=1&l,--c,3&(l>>>=1)){case 0:r.mode=14;break;case 1:C=x=void 0;var C,x=r;if(W){for(U=new E.Buf32(512),G=new E.Buf32(32),C=0;C<144;)x.lens[C++]=8;for(;C<256;)x.lens[C++]=9;for(;C<280;)x.lens[C++]=7;for(;C<288;)x.lens[C++]=8;for(V(N,x.lens,0,288,U,0,x.work,{bits:9}),C=0;C<32;)x.lens[C++]=5;V(j,x.lens,0,32,G,0,x.work,{bits:5}),W=!1}if(x.lencode=U,x.lenbits=9,x.distcode=G,x.distbits=5,r.mode=20,6!==t)break;l>>>=2,c-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}l>>>=2,c-=2}break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&l,c=l=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(p=r.length){if(0===(p=u<(p=o<p?o:p)?u:p))break e;E.arraySet(s,i,n,p,a),o-=p,n+=p,u-=p,a+=p,r.length-=p}else r.mode=12;break;case 17:for(;c<14;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(r.nlen=257+(31&l),l>>>=5,c-=5,r.ndist=1+(31&l),l>>>=5,c-=5,r.ncode=4+(15&l),l>>>=4,c-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}r.lens[w[r.have++]]=7&l,l>>>=3,c-=3}for(;r.have<19;)r.lens[w[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,F={bits:r.lenbits},O=V(0,r.lens,0,19,r.lencode,0,r.work,F),r.lenbits=F.bits,O){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(_=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,b=65535&_,!((v=_>>>24)<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(b<16)l>>>=v,c-=v,r.lens[r.have++]=b;else{if(16===b){for(A=v+2;c<A;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(l>>>=v,c-=v,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}I=r.lens[r.have-1],p=3+(3&l),l>>>=2,c-=2}else if(17===b){for(A=v+3;c<A;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}I=0,p=3+(7&(l>>>=v)),l>>>=3,c=c-v-3}else{for(A=v+7;c<A;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}I=0,p=11+(127&(l>>>=v)),l>>>=7,c=c-v-7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;p--;)r.lens[r.have++]=I}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,F={bits:r.lenbits},O=V(N,r.lens,0,r.nlen,r.lencode,0,r.work,F),r.lenbits=F.bits,O){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,F={bits:r.distbits},O=V(j,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,F),r.distbits=F.bits,O){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=o&&258<=u){e.next_out=a,e.avail_out=u,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=c,M(e,f),a=e.next_out,s=e.output,u=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=r.hold,c=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;g=(_=r.lencode[l&(1<<r.lenbits)-1])>>>16&255,b=65535&_,!((v=_>>>24)<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(g&&0==(240&g)){for(k=v,S=g,y=b;g=(_=r.lencode[y+((l&(1<<k+S)-1)>>k)])>>>16&255,b=65535&_,!(k+(v=_>>>24)<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}l>>>=k,c-=k,r.back+=k}if(l>>>=v,c-=v,r.back+=v,r.length=b,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(A=r.extra;c<A;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}r.length+=l&(1<<r.extra)-1,l>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(_=r.distcode[l&(1<<r.distbits)-1])>>>16&255,b=65535&_,!((v=_>>>24)<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(0==(240&g)){for(k=v,S=g,y=b;g=(_=r.distcode[y+((l&(1<<k+S)-1)>>k)])>>>16&255,b=65535&_,!(k+(v=_>>>24)<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}l>>>=k,c-=k,r.back+=k}if(l>>>=v,c-=v,r.back+=v,64&g){e.msg="invalid distance code",r.mode=30;break}r.offset=b,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(A=r.extra;c<A;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}r.offset+=l&(1<<r.extra)-1,l>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===u)break e;if(r.offset>(p=f-u)){if((p=r.offset-p)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}d=p>r.wnext?(p-=r.wnext,r.wsize-p):r.wnext-p,p>r.length&&(p=r.length),m=r.window}else m=s,d=a-r.offset,p=r.length;for(u-=p=u<p?u:p,r.length-=p;s[a++]=m[d++],--p;);0===r.length&&(r.mode=21);break;case 26:if(0===u)break e;s[a++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;c<32;){if(0===o)break e;o--,l|=i[n++]<<c,c+=8}if(f-=u,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=(r.flags?L:T)(r.check,s,f,a-f)),f=u,(r.flags?l:D(l))!==r.check){e.msg="incorrect data check",r.mode=30;break}c=l=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(l!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}c=l=0}r.mode=29;case 29:O=1;break e;case 30:O=-3;break e;case 31:return-4;default:return R}return e.next_out=a,e.avail_out=u,e.next_in=n,e.avail_in=o,r.hold=l,r.bits=c,(r.wsize||f!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&z(e,e.output,e.next_out,f-e.avail_out),f-=e.avail_out,e.total_in+=h-=e.avail_in,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=(r.flags?L:T)(r.check,s,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),O=(0==h&&0===f||4===t)&&O===B?-5:O},r.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,B):R},r.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?R:((e.head=t).done=!1,B)},r.inflateSetDictionary=function(e,t){var r,i=t.length;return!e||!e.state||0!==(r=e.state).wrap&&11!==r.mode?R:11===r.mode&&T(1,t,i,0)!==r.check?-3:z(e,t,i,i)?(r.mode=31,-4):(r.havedict=1,B)},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){var M=e("../utils/common"),V=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],B=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,i,s,n,a,o){for(var u,l,c,h,f,p,d,m,v,g=o.bits,b=0,k=0,S=0,y=0,I=0,O=0,F=0,A=0,_=0,P=0,w=null,C=0,x=new M.Buf16(16),E=new M.Buf16(16),T=null,L=0,b=0;b<=15;b++)x[b]=0;for(k=0;k<i;k++)x[t[r+k]]++;for(I=g,y=15;1<=y&&0===x[y];y--);if(y<I&&(I=y),0===y)s[n++]=20971520,s[n++]=20971520,o.bits=1;else{for(S=1;S<y&&0===x[S];S++);for(I<S&&(I=S),b=A=1;b<=15;b++)if((A=(A<<=1)-x[b])<0)return-1;if(0<A&&(0===e||1!==y))return-1;for(E[1]=0,b=1;b<15;b++)E[b+1]=E[b]+x[b];for(k=0;k<i;k++)0!==t[r+k]&&(a[E[t[r+k]]++]=k);if(p=0===e?(w=T=a,19):1===e?(w=V,C-=257,T=N,L-=257,256):(w=j,T=B,-1),b=S,f=n,F=k=P=0,c=-1,h=(_=1<<(O=I))-1,1===e&&852<_||2===e&&592<_)return 1;for(;;){for(v=a[k]<p?(m=0,a[k]):a[k]>p?(m=T[L+a[k]],w[C+a[k]]):(m=96,0),u=1<<(d=b-F),S=l=1<<O;s[f+(P>>F)+(l-=u)]=d<<24|m<<16|v|0,0!==l;);for(u=1<<b-1;P&u;)u>>=1;if(P=0!==u?(P&u-1)+u:0,k++,0==--x[b]){if(b===y)break;b=t[r+a[k]]}if(I<b&&(P&h)!==c){for(f+=S,A=1<<(O=b-(F=0===F?I:F));O+F<y&&!((A-=x[O+F])<=0);)O++,A<<=1;if(_+=1<<O,1===e&&852<_||2===e&&592<_)return 1;s[c=P&h]=I<<24|O<<16|f-n|0}}0!==P&&(s[f+P]=b-F<<24|64<<16|0),o.bits=I}return 0}},{"../utils/common":41}],51:[function(e,t,r){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,e){var a=r("../utils/common"),c=0,h=1;function t(e){for(var t=e.length;0<=--t;)e[t]=0}var o,u,l,f=29,p=256,d=p+1+f,m=30,v=19,A=2*d+1,_=15,i=16,R=7,g=256,b=16,k=17,S=18,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=new Array(2*(d+2)),P=(t(F),new Array(2*m)),w=(t(P),new Array(512)),C=(t(w),new Array(256)),x=(t(C),new Array(f)),E=(t(x),new Array(m));function T(e,t,r,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function L(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function M(e){return e<256?w[e]:w[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,r){e.bi_valid>i-r?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>i-e.bi_valid,e.bi_valid+=r-i):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function N(e,t,r){V(e,r[2*t],r[2*t+1])}function D(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function U(e,t,r){for(var i,s=new Array(_+1),n=0,a=1;a<=_;a++)s[a]=n=n+r[a-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=D(s[o]++,o))}}function G(e){for(var t=0;t<d;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*g]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function W(e){8<e.bi_valid?s(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function z(e,t,r,i){var s=2*t,n=2*r;return e[s]<e[n]||e[s]===e[n]&&i[t]<=i[r]}function j(e,t,r){for(var i=e.heap[r],s=r<<1;s<=e.heap_len&&(s<e.heap_len&&z(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!z(t,i,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=i}function H(e,t,r){var i,s,n,a,o=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0==i?N(e,s,t):(N(e,(n=C[s])+p+1,t),0!==(a=y[n])&&V(e,s-=x[n],a),N(e,n=M(--i),r),0!==(a=I[n])&&V(e,i-=E[n],a)),o<e.last_lit;);N(e,g,t)}function B(e,t){var r,i,s,n=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=A,r=0;r<u;r++)0!==n[2*r]?(e.heap[++e.heap_len]=l=r,e.depth[r]=0):n[2*r+1]=0;for(;e.heap_len<2;)n[2*(s=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=a[2*s+1]);for(t.max_code=l,r=e.heap_len>>1;1<=r;r--)j(e,n,r);for(s=u;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],j(e,n,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,n[2*s]=n[2*r]+n[2*i],e.depth[s]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,n[2*r+1]=n[2*i+1]=s,e.heap[1]=s++,j(e,n,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var c,h,f,p,d,m=e,v=t.dyn_tree,g=t.max_code,b=t.stat_desc.static_tree,k=t.stat_desc.has_stree,S=t.stat_desc.extra_bits,y=t.stat_desc.extra_base,I=t.stat_desc.max_length,O=0,F=0;F<=_;F++)m.bl_count[F]=0;for(v[2*m.heap[m.heap_max]+1]=0,c=m.heap_max+1;c<A;c++)I<(F=v[2*v[2*(h=m.heap[c])+1]+1]+1)&&(F=I,O++),v[2*h+1]=F,g<h||(m.bl_count[F]++,p=0,y<=h&&(p=S[h-y]),d=v[2*h],m.opt_len+=d*(F+p),k&&(m.static_len+=d*(b[2*h+1]+p)));if(0!==O){do{for(F=I-1;0===m.bl_count[F];)F--}while(m.bl_count[F]--,m.bl_count[F+1]+=2,m.bl_count[I]--,0<(O-=2));for(F=I;0!==F;F--)for(h=m.bl_count[F];0!==h;)g<(f=m.heap[--c])||(v[2*f+1]!==F&&(m.opt_len+=(F-v[2*f+1])*v[2*f],v[2*f+1]=F),h--)}U(n,l,e.bl_count)}function K(e,t,r){var i,s,n=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)s=a,a=t[2*(i+1)+1],++o<u&&s===a||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==n&&e.bl_tree[2*s]++,e.bl_tree[2*b]++):o<=10?e.bl_tree[2*k]++:e.bl_tree[2*S]++,n=s,l=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4))}function X(e,t,r){var i,s,n=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),i=0;i<=r;i++)if(s=a,a=t[2*(i+1)+1],!(++o<u&&s===a)){if(o<l)for(;N(e,s,e.bl_tree),0!=--o;);else 0!==s?(s!==n&&(N(e,s,e.bl_tree),o--),N(e,b,e.bl_tree),V(e,o-3,2)):o<=10?(N(e,k,e.bl_tree),V(e,o-3,3)):(N(e,S,e.bl_tree),V(e,o-11,7));n=s,l=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4)}}t(E);var Y=!1;function Z(e,t,r,i){V(e,0+(i?1:0),3),i=t,t=r,W(r=e),s(r,t),s(r,~t),a.arraySet(r.pending_buf,r.window,i,t,r.pending),r.pending+=t}e._tr_init=function(e){if(!Y){for(var t,r,i,s=new Array(_+1),n=0,a=0;a<f-1;a++)for(x[a]=n,t=0;t<1<<y[a];t++)C[n++]=a;for(C[n-1]=a,a=i=0;a<16;a++)for(E[a]=i,t=0;t<1<<I[a];t++)w[i++]=a;for(i>>=7;a<m;a++)for(E[a]=i<<7,t=0;t<1<<I[a]-7;t++)w[256+i++]=a;for(r=0;r<=_;r++)s[r]=0;for(t=0;t<=143;)F[2*t+1]=8,t++,s[8]++;for(;t<=255;)F[2*t+1]=9,t++,s[9]++;for(;t<=279;)F[2*t+1]=7,t++,s[7]++;for(;t<=287;)F[2*t+1]=8,t++,s[8]++;for(U(F,d+1,s),t=0;t<m;t++)P[2*t+1]=5,P[2*t]=D(t,5);o=new T(F,y,p+1,d,_),u=new T(P,I,0,m,_),l=new T(new Array(0),q,0,v,R),Y=!0}e.l_desc=new L(e.dyn_ltree,o),e.d_desc=new L(e.dyn_dtree,u),e.bl_desc=new L(e.bl_tree,l),e.bi_buf=0,e.bi_valid=0,G(e)},e._tr_stored_block=Z,e._tr_flush_block=function(e,t,r,i){var s,n,a=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=(e=>{for(var t=4093624447,r=0;r<=31;r++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*r])return c;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return h;for(r=32;r<p;r++)if(0!==e.dyn_ltree[2*r])return h;return c})(e)),B(e,e.l_desc),B(e,e.d_desc),a=(e=>{var t;for(K(e,e.dyn_ltree,e.l_desc.max_code),K(e,e.dyn_dtree,e.d_desc.max_code),B(e,e.bl_desc),t=v-1;3<=t&&0===e.bl_tree[2*O[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),(n=e.static_len+3+7>>>3)<=(s=e.opt_len+3+7>>>3)&&(s=n)):s=n=r+5,r+4<=s&&-1!==t)Z(e,t,r,i);else if(4===e.strategy||n===s)V(e,2+(i?1:0),3),H(e,F,P);else{V(e,4+(i?1:0),3);var o,u=e,t=e.l_desc.max_code+1,r=e.d_desc.max_code+1,l=a+1;for(V(u,t-257,5),V(u,r-1,5),V(u,l-4,4),o=0;o<l;o++)V(u,u.bl_tree[2*O[o]+1],3);X(u,u.dyn_ltree,t-1),X(u,u.dyn_dtree,r-1),H(e,e.dyn_ltree,e.dyn_dtree)}G(e),i&&W(e)},e._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(C[r]+p+1)]++,e.dyn_dtree[2*M(t)]++),e.last_lit===e.lit_bufsize-1},e._tr_align=function(e){V(e,2,3),N(e,g,F),16===(e=e).bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,r){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)}),(o=>{var u,l,c,h,f,p,d,t,m,v,i,e;void 0===o||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent)||(e=o.document,u=function(){return o.URL||o.webkitURL||o},l=e.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in l,h=/constructor/i.test(o.HTMLElement)||o.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent),p=o.setImmediate||o.setTimeout,d=function(e){p(function(){throw e},0)},t=4e4,m=function(e){setTimeout(function(){"string"==typeof e?u().revokeObjectURL(e):e.remove()},t)},v=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},e=(i=function(e,r,t){t||(e=v(e));var i,s,n=this,t="application/octet-stream"===e.type,a=function(){for(var e=n,t="writestart progress write writeend".split(" "),r=void 0,i=(t=[].concat(t)).length;i--;){var s=e["on"+t[i]];if("function"==typeof s)try{s.call(e,r||e)}catch(e){d(e)}}};n.readyState=n.INIT,c?(i=u().createObjectURL(e),p(function(){var e,t;l.href=i,l.download=r,e=l,t=new MouseEvent("click"),e.dispatchEvent(t),a(),m(i),n.readyState=n.DONE},0)):(f||t&&h)&&o.FileReader?((s=new FileReader).onloadend=function(){var e=f?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");o.open(e,"_blank")||(o.location.href=e),n.readyState=n.DONE,a()},s.readAsDataURL(e),n.readyState=n.INIT):(i=i||u().createObjectURL(e),!t&&o.open(i,"_blank")||(o.location.href=i),n.readyState=n.DONE,a(),m(i))}).prototype,"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)||(e.abort=function(){},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,o.FileSaver_saveAs=function(e,t,r){return new i(e,t||e.name||"download",r)})})("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0),!function(){var root="object"==typeof window?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node,COMMON_JS=(NODE_JS&&(root=global),!root.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports),AMD="function"==typeof define&&define.amd,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(t){return function(e){return new Sha1(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");(t=NODE_JS?nodeWrap(t):t).create=function(){return new Sha1},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var r=OUTPUT_TYPES[e];t[r]=createOutputMethod(r)}return t},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("sha1").update(e,"utf8").digest("hex");if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(void 0===e.length)return method(e);return crypto.createHash("sha1").update(new Buffer(e)).digest("hex")};return nodeMethod};function Sha1(e){e?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(e){if(!this.finalized){for(var t,r,i="string"!=typeof e,s=0,n=(e=i&&e.constructor===root.ArrayBuffer?new Uint8Array(e):e).length||0,a=this.blocks;s<n;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),i)for(r=this.start;s<n&&r<64;++s)a[r>>2]|=e[s]<<SHIFT[3&r++];else for(r=this.start;s<n&&r<64;++s)(t=e.charCodeAt(s))<128?a[r>>2]|=t<<SHIFT[3&r++]:(t<2048?a[r>>2]|=(192|t>>6)<<SHIFT[3&r++]:(t<55296||57344<=t?a[r>>2]|=(224|t>>12)<<SHIFT[3&r++]:(t=65536+((1023&t)<<10|1023&e.charCodeAt(++s)),a[r>>2]|=(240|t>>18)<<SHIFT[3&r++],a[r>>2]|=(128|t>>12&63)<<SHIFT[3&r++]),a[r>>2]|=(128|t>>6&63)<<SHIFT[3&r++]),a[r>>2]|=(128|63&t)<<SHIFT[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,64<=r?(this.block=a[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){var e,t;this.finalized||(this.finalized=!0,e=this.blocks,t=this.lastByteIndex,e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],56<=t&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash())},Sha1.prototype.hash=function(){for(var e,t=this.h0,r=this.h1,i=this.h2,s=this.h3,n=this.h4,a=this.blocks,o=16;o<80;++o)e=a[o-3]^a[o-8]^a[o-14]^a[o-16],a[o]=e<<1|e>>>31;for(o=0;o<20;o+=5)t=(e=(r=(e=(i=(e=(s=(e=(n=(e=t<<5|t>>>27)+(r&i|~r&s)+n+1518500249+a[o]<<0)<<5|n>>>27)+(t&(r=r<<30|r>>>2)|~t&i)+s+1518500249+a[o+1]<<0)<<5|s>>>27)+(n&(t=t<<30|t>>>2)|~n&r)+i+1518500249+a[o+2]<<0)<<5|i>>>27)+(s&(n=n<<30|n>>>2)|~s&t)+r+1518500249+a[o+3]<<0)<<5|r>>>27)+(i&(s=s<<30|s>>>2)|~i&n)+t+1518500249+a[o+4]<<0,i=i<<30|i>>>2;for(;o<40;o+=5)t=(e=(r=(e=(i=(e=(s=(e=(n=(e=t<<5|t>>>27)+(r^i^s)+n+1859775393+a[o]<<0)<<5|n>>>27)+(t^(r=r<<30|r>>>2)^i)+s+1859775393+a[o+1]<<0)<<5|s>>>27)+(n^(t=t<<30|t>>>2)^r)+i+1859775393+a[o+2]<<0)<<5|i>>>27)+(s^(n=n<<30|n>>>2)^t)+r+1859775393+a[o+3]<<0)<<5|r>>>27)+(i^(s=s<<30|s>>>2)^n)+t+1859775393+a[o+4]<<0,i=i<<30|i>>>2;for(;o<60;o+=5)t=(e=(r=(e=(i=(e=(s=(e=(n=(e=t<<5|t>>>27)+(r&i|r&s|i&s)+n-1894007588+a[o]<<0)<<5|n>>>27)+(t&(r=r<<30|r>>>2)|t&i|r&i)+s-1894007588+a[o+1]<<0)<<5|s>>>27)+(n&(t=t<<30|t>>>2)|n&r|t&r)+i-1894007588+a[o+2]<<0)<<5|i>>>27)+(s&(n=n<<30|n>>>2)|s&t|n&t)+r-1894007588+a[o+3]<<0)<<5|r>>>27)+(i&(s=s<<30|s>>>2)|i&n|s&n)+t-1894007588+a[o+4]<<0,i=i<<30|i>>>2;for(;o<80;o+=5)t=(e=(r=(e=(i=(e=(s=(e=(n=(e=t<<5|t>>>27)+(r^i^s)+n-899497514+a[o]<<0)<<5|n>>>27)+(t^(r=r<<30|r>>>2)^i)+s-899497514+a[o+1]<<0)<<5|s>>>27)+(n^(t=t<<30|t>>>2)^r)+i-899497514+a[o+2]<<0)<<5|i>>>27)+(s^(n=n<<30|n>>>2)^t)+r-899497514+a[o+3]<<0)<<5|r>>>27)+(i^(s=s<<30|s>>>2)^n)+t-899497514+a[o+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+r<<0,this.h2=this.h2+i<<0,this.h3=this.h3+s<<0,this.h4=this.h4+n<<0},Sha1.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,s=this.h4;return HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,s=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i,s>>24&255,s>>16&255,s>>8&255,255&s]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var exports=createMethod();COMMON_JS?module.exports=exports:(root.sha1=exports,AMD&&define(function(){return exports}))}(),Object.extend(Squeak,{vmPath:"/",platformSubtype:"Browser",osVersion:navigator.userAgent,windowSystem:"HTML"}),window.SqueakJS={};var canUseMouseOffset=null;function updateMousePos(e,t,r){var i=(canUseMouseOffset=null===canUseMouseOffset?"offsetX"in e:canUseMouseOffset)?e.offsetX:e.layerX,e=canUseMouseOffset?e.offsetY:e.layerY,i=(r.cursorCanvas&&(r.cursorCanvas.style.left=i+t.offsetLeft+r.cursorOffsetX+"px",r.cursorCanvas.style.top=e+t.offsetTop+r.cursorOffsetY+"px"),i*t.width/t.offsetWidth|0),e=e*t.height/t.offsetHeight|0,s=r.width||t.width,t=r.height||t.height;r.mouseX=Math.max(0,Math.min(s,i)),r.mouseY=Math.max(0,Math.min(t,e))}function recordMouseEvent(e,t,r,i,s){if(updateMousePos(t,r,i),i.vm){var n=i.buttons&Squeak.Mouse_All;switch(e){case"mousedown":switch(t.button||0){case 0:n=Squeak.Mouse_Red;break;case 1:n=Squeak.Mouse_Yellow;break;case 2:n=Squeak.Mouse_Blue}(n===Squeak.Mouse_Red&&(t.altKey||t.metaKey)||i.cmdButtonTouched)&&(n=Squeak.Mouse_Yellow),s.swapButtons&&(n==Squeak.Mouse_Yellow?n=Squeak.Mouse_Blue:n==Squeak.Mouse_Blue&&(n=Squeak.Mouse_Yellow));break;case"mousemove":break;case"mouseup":n=0}i.buttons=n|recordModifiers(t,i),i.eventQueue&&(i.eventQueue.push([Squeak.EventTypeMouse,t.timeStamp,i.mouseX,i.mouseY,i.buttons&Squeak.Mouse_All,i.buttons>>3]),i.signalInputEvent)&&i.signalInputEvent(),i.idle=0,"mouseup"===e?i.runFor(100,e):i.runNow(e)}}function recordWheelEvent(e,t){var r;t.vm&&(t.eventQueue&&t.vm.image.isSpur?(r=[Squeak.EventTypeMouseWheel,e.timeStamp,e.deltaX,-e.deltaY,t.buttons&Squeak.Mouse_All,t.buttons>>3],t.eventQueue.push(r),t.signalInputEvent&&t.signalInputEvent(),t.idle=0,t.runNow&&t.runNow("wheel")):fakeCmdOrCtrlKey(0<e.deltaY?31:30,e.timeStamp,t))}for(var MacRomanToUnicode=[196,197,199,201,209,214,220,225,224,226,228,227,229,231,233,232,234,235,237,236,238,239,241,243,242,244,246,245,250,249,251,252,8224,176,162,163,167,8226,182,223,174,169,8482,180,168,8800,198,216,8734,177,8804,8805,165,181,8706,8721,8719,960,8747,170,186,937,230,248,191,161,172,8730,402,8776,8710,171,187,8230,160,192,195,213,338,339,8211,8212,8220,8221,8216,8217,247,9674,255,376,8260,8364,8249,8250,64257,64258,8225,183,8218,8222,8240,194,202,193,203,200,205,206,207,204,211,212,63743,210,218,219,217,305,710,732,175,728,729,730,184,733,731,711],UnicodeToMacRoman={},i=0;i<MacRomanToUnicode.length;i++)UnicodeToMacRoman[MacRomanToUnicode[i]]=i+128;function recordKeyboardEvent(e,t,r){var i,s;r.vm&&(i=UnicodeToMacRoman[e]||(e<128?e:0),s=r.buttons>>3<<8|i,r.eventQueue?(r.eventQueue.push([Squeak.EventTypeKeyboard,t,i,Squeak.EventKeyChar,r.buttons>>3,e]),r.signalInputEvent&&r.signalInputEvent(),r.keys[0]=s):s===r.vm.interruptKeycode?r.vm.interruptPending=!0:r.keys.push(s),r.idle=0,r.runNow)&&r.runNow("keyboard")}function recordDragDropEvent(e,t,r,i){i.vm&&i.eventQueue&&(updateMousePos(t,r,i),i.eventQueue.push([Squeak.EventTypeDragDropFiles,t.timeStamp,e,i.mouseX,i.mouseY,i.buttons>>3,i.droppedFiles.length]),i.signalInputEvent&&i.signalInputEvent(),i.idle=0,i.runNow)&&i.runNow("drag-drop")}function fakeCmdOrCtrlKey(e,t,r){r.buttons&=~Squeak.Keyboard_All,r.buttons|=Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl,r.keys=[],recordKeyboardEvent(e,t,r)}function makeSqueakEvent(e,t,r){t[0]=e[0],t[1]=e[1]-r&Squeak.MillisecondClockMask;for(var i=2;i<e.length;i++)t[i]=e[i]}function createSqueakDisplay(u,l){(l=l||{}).fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor="black",u.style.border="none",u.style.borderRadius="0px",document.ontouchmove=function(e){e.preventDefault()});var c={context:u.getContext("2d"),fullscreen:!1,width:0,height:0,scale:1,highdpi:l.highdpi,mouseX:0,mouseY:0,buttons:0,keys:[],cmdButtonTouched:null,eventQueue:null,clipboardString:"",clipboardStringChanged:!1,handlingEvent:"",cursorCanvas:!1!==l.cursor&&document.getElementById("sqCursor")||document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null,changedCallback:null},h=(l.pixelated&&(u.classList.add("pixelated"),c.cursorCanvas)&&c.cursorCanvas.classList.add("pixelated"),c.reset=function(){c.eventQueue=null,c.signalInputEvent=null,c.lastTick=0,c.getNextEvent=function(e,t){c.eventQueue=[],c.eventQueue.push=function(e){c.eventQueue.offset=Date.now()-e[1],delete c.eventQueue.push,c.eventQueue.push(e)},c.getNextEvent=function(e,t){var r=c.eventQueue.shift();r?makeSqueakEvent(r,e,t-c.eventQueue.offset):e[0]=Squeak.EventTypeNone},c.getNextEvent(e,t)}},c.reset(),setupFullscreen(c,u,l)),f=(c.fullscreenRequest=function(e,t){(c.fullscreen!=e?(c.fullscreen=e,c.resizeTodo=t,c.resizeTodoTimeout=setTimeout(c.resizeDone,1e3),h):t)()},c.resizeDone=function(){clearTimeout(c.resizeTodoTimeout);var e=c.resizeTodo;e&&(c.resizeTodo=null,e())},c.clear=function(){u.width=u.width},c.setTitle=function(e){document.title=e},c.showBanner=function(e,t){t=t||c.context.canvas.style||{};var r=c.context;r.clearRect(0,0,u.width,u.height),r.fillStyle=t.color||"#F90",r.font=t.font||"bold 48px sans-serif",!t.font&&r.measureText(e).width>u.width&&(r.font="bold 24px sans-serif"),r.textAlign="center",r.textBaseline="middle",r.fillText(e,u.width/2,u.height/2)},c.showProgress=function(e,t){t=t||c.context.canvas.style||{};var r=c.context,i=u.width/3|0,s=.5*u.width-i/2,n=.5*u.height+48;r.fillStyle=t.background||"#000",r.fillRect(s,n,i,24),r.lineWidth=2,r.strokeStyle=t.stroke||"#F90",r.strokeRect(s,n,i,24),r.fillStyle=t.fill||"#F90",r.fillRect(s,n,i*e,24)},c.executeClipboardPasteKey=function(e,t){if(!c.vm)return!0;try{c.clipboardString=e,fakeCmdOrCtrlKey("v".charCodeAt(0),t,c)}catch(e){console.error("paste error "+e)}},c.executeClipboardCopyKey=function(e,t){if(!c.vm)return!0;c.clipboardStringChanged=!1,fakeCmdOrCtrlKey((e||"c").charCodeAt(0),t,c);for(var r=Date.now();!c.clipboardStringChanged&&Date.now()-r<500;)c.vm.interpret(20);if(c.clipboardStringChanged)try{return c.clipboardString}catch(e){console.error("copy error "+e)}},u.onmousedown=function(e){return h(),recordMouseEvent("mousedown",e,u,c,l),e.preventDefault(),!1},u.onmouseup=function(e){recordMouseEvent("mouseup",e,u,c,l),h(),e.preventDefault()},u.onmousemove=function(e){recordMouseEvent("mousemove",e,u,c,l),e.preventDefault()},u.onwheel=function(e){recordWheelEvent(e,c),e.preventDefault()},u.oncontextmenu=function(){return!1},{state:"idle",button:0,x:0,y:0,dist:0,down:{}});function p(e){if(e.touches.length){for(var t=0,r=0,i=0,s=0;s<e.touches.length;s++)e.touches[s].identifier!==c.cmdButtonTouched&&(t+=e.touches[s].pageX,r+=e.touches[s].pageY,i++);0<i&&(f.x=t/i,f.y=r/i)}return{timeStamp:e.timeStamp,button:f.button,offsetX:f.x-u.offsetLeft,offsetY:f.y-u.offsetTop}}function i(e,t,r,i){e-=r,r=t-i;return Math.sqrt(e*e+r*r)}function a(e,t){return i(e.pageX,e.pageY,t.pageX,t.pageY)}function d(e,t,r,i){var s=c.cursorCanvas,n=r/u.width,a=c.highdpi?window.devicePixelRatio:1,o=n*a;return u.style.left=(0|e)+"px",u.style.top=(0|t)+"px",u.style.width=(0|r)+"px",u.style.height=(0|i)+"px",s&&(s.style.left=(e+c.cursorOffsetX+c.mouseX*n|0)+"px",s.style.top=(t+c.cursorOffsetY+c.mouseY*n|0)+"px",s.style.width=(s.width*o|0)+"px",s.style.height=(s.height*o|0)+"px"),l.pixelated||(o%1==0||5<o?(u.classList.add("pixelated"),s&&s.classList.add("pixelated")):(u.classList.remove("pixelated"),s&&c.cursorCanvas.classList.remove("pixelated"))),c.css={left:e,top:t,width:r,height:i,scale:n,pixelScale:o,ratio:a},c.changedCallback&&c.changedCallback(),n}u.ontouchstart=function(e){e.preventDefault();for(var t=p(e),r=0;r<e.changedTouches.length;r++)if(e.changedTouches[r].identifier!==c.cmdButtonTouched)switch(f.state){case"idle":f.state="got1stFinger",f.first=t,setTimeout(function(){"got1stFinger"===f.state&&(f.state="mousing",f.button=t.button=0,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l))},100);break;case"got1stFinger":f.state="got2ndFinger",f.dist=a(e.touches[0],e.touches[1]),f.down.x=f.x,f.down.y=f.y,f.down.dist=f.dist,f.down.left=u.offsetLeft,f.down.top=u.offsetTop,f.down.width=u.offsetWidth,f.down.height=u.offsetHeight,f.orig||(f.orig={left:f.down.left,top:f.down.top,right:f.down.left+f.down.width,bottom:f.down.top+f.down.height,width:f.down.width,height:f.down.height}),setTimeout(function(){"got2ndFinger"===f.state&&(10<Math.abs(f.down.dist-f.dist)||10<i(f.down.x,f.down.y,f.x,f.y)?f.state="zooming":(f.state="mousing",f.button=t.button=2,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l)))},200)}},u.ontouchmove=function(e){e.preventDefault();var t,r,i,s,n=p(e);switch(f.state){case"got1stFinger":f.state="mousing",f.button=n.button=0,recordMouseEvent("mousemove",n,u,c,l),recordMouseEvent("mousedown",n,u,c,l);break;case"mousing":recordMouseEvent("mousemove",n,u,c,l);break;case"got2ndFinger":1<e.touches.length&&(f.dist=a(e.touches[0],e.touches[1]));break;case"zooming":(t=e).touches.length<2||(f.dist=a(t.touches[0],t.touches[1]),t=f.orig.width/f.down.width,s=f.dist/f.down.dist,s=Math.min(Math.max(s,.95*t),5*t),t=f.down.width*s,r=f.orig.height*t/f.orig.width,i=f.down.left-(f.down.x-f.down.left)*(s-1)+(f.x-f.down.x),s=f.down.top-(f.down.y-f.down.top)*(s-1)+(f.y-f.down.y),d(i=Math.max(Math.min(i,f.orig.left+20),f.orig.right-t-20),s=Math.max(Math.min(s,f.orig.top+20),f.orig.bottom-r-20),t,r))}},u.ontouchend=function(e){e.preventDefault(),h();var t=p(e),r=e.touches.length;0<=Array.from(e.touches).findIndex(e=>e.identifier===c.cmdButtonTouched)&&r--;for(var i,s,n,a,o=0;o<e.changedTouches.length;o++)if(e.changedTouches[o].identifier!==c.cmdButtonTouched)switch(f.state){case"mousing":0<r||(f.state="idle",recordMouseEvent("mouseup",t,u,c,l));break;case"got1stFinger":f.state="idle",f.button=t.button=0,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l),recordMouseEvent("mouseup",t,u,c,l);break;case"got2ndFinger":f.state="mousing",f.button=t.button=2,recordMouseEvent("mousemove",t,u,c,l),recordMouseEvent("mousedown",t,u,c,l);break;case"zooming":0<r||(f.state="idle",a=n=s=i=void 0,i=u.offsetLeft,s=u.offsetTop,n=u.offsetWidth,n=Math.min(Math.max(n,f.orig.width),5*f.orig.width),a=f.orig.height*n/f.orig.width,d(Math.max(Math.min(i,f.orig.left),f.orig.right-n),Math.max(Math.min(s,f.orig.top),f.orig.bottom-a),n,a)-c.scale<1e-4&&(f.orig=null,g()))}},u.ontouchcancel=function(e){u.ontouchend(e)},c.cursorCanvas&&(t="absolute"===window.getComputedStyle(u).position,c.cursorCanvas.style.display="block",c.cursorCanvas.style.position=t?"absolute":"fixed",c.cursorCanvas.style.cursor="none",c.cursorCanvas.style.background="transparent",c.cursorCanvas.style.pointerEvents="none",u.parentElement.appendChild(c.cursorCanvas),u.style.cursor="none");var r=document.createElement("input");if(r.setAttribute("autocomplete","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false"),r.style.position="absolute",r.style.left="-1000px",u.parentElement.appendChild(r),"ontouchstart"in document){var t=document.createElement("div"),s=(t.innerHTML='<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg width="50px" height="50px" viewBox="0 0 150 150" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="Page-1" stroke="none" fill="#000000"><rect x="33" y="105" width="10" height="10" rx="1"></rect><rect x="26" y="60" width="10" height="10" rx="1"></rect><rect x="41" y="60" width="10" height="10" rx="1"></rect><rect x="56" y="60" width="10" height="10" rx="1"></rect><rect x="71" y="60" width="10" height="10" rx="1"></rect><rect x="86" y="60" width="10" height="10" rx="1"></rect><rect x="101" y="60" width="10" height="10" rx="1"></rect><rect x="116" y="60" width="10" height="10" rx="1"></rect><rect x="108" y="105" width="10" height="10" rx="1"></rect><rect x="33" y="75" width="10" height="10" rx="1"></rect><rect x="48" y="75" width="10" height="10" rx="1"></rect><rect x="63" y="75" width="10" height="10" rx="1"></rect><rect x="78" y="75" width="10" height="10" rx="1"></rect><rect x="93" y="75" width="10" height="10" rx="1"></rect><rect x="108" y="75" width="10" height="10" rx="1"></rect><rect x="41" y="90" width="10" height="10" rx="1"></rect><rect x="26" y="90" width="10" height="10" rx="1"></rect><rect x="56" y="90" width="10" height="10" rx="1"></rect><rect x="71" y="90" width="10" height="10" rx="1"></rect><rect x="86" y="90" width="10" height="10" rx="1"></rect><rect x="101" y="90" width="10" height="10" rx="1"></rect><rect x="116" y="90" width="10" height="10" rx="1"></rect><rect x="48" y="105" width="55" height="10" rx="1"></rect><path d="M20.0056004,51 C18.3456532,51 17.0000001,52.3496496 17.0000001,54.0038284 L17.0000001,85.6824519 L17,120.003453 C17.0000001,121.6584 18.3455253,123 20.0056004,123 L131.9944,123 C133.654347,123 135,121.657592 135,119.997916 L135,54.0020839 C135,52.3440787 133.654475,51 131.9944,51 L20.0056004,51 Z" fill="none" stroke="#000000" stroke-width="2"></path><path d="M52.0410156,36.6054687 L75.5449219,21.6503905 L102.666016,36.6054687" id="Line" stroke="#000000" stroke-width="3" stroke-linecap="round" fill="none"></path></g></svg>',t.setAttribute("style","position:fixed;right:0;bottom:0;background-color:rgba(128,128,128,0.5);border-radius:5px"),u.parentElement.appendChild(t),t.onmousedown=function(e){r.focus({preventScroll:!0}),e.preventDefault()},t.ontouchstart=t.onmousedown,document.createElement("div"));if(s.innerHTML="⌘",s.setAttribute("style","position:fixed;left:0;background-color:rgba(128,128,128,0.5);width:50px;height:50px;font-size:30px;text-align:center;vertical-align:middle;line-height:50px;border-radius:5px"),window.visualViewport){let e=window.visualViewport;t=()=>s.style.top=e.height+"px";e.addEventListener("resize",t),s.style.transform="translateY(-100%)",t()}else s.style.bottom="0";u.parentElement.appendChild(s),s.ontouchstart=function(e){c.cmdButtonTouched=e.changedTouches[0].identifier,s.style.backgroundColor="rgba(255,255,255,0.5)",e.preventDefault(),e.stopPropagation()},s.ontouchend=function(e){c.cmdButtonTouched=null,s.style.backgroundColor="rgba(128,128,128,0.5)",e.preventDefault(),e.stopPropagation()},s.ontouchcancel=s.ontouchend}else r.onblur=function(){r.focus({preventScroll:!0})},r.focus({preventScroll:!0});c.isMac=navigator.userAgent.includes("Mac");var m,n=[];function o(){r.value="**",r.selectionStart=1,r.selectionEnd=1}if(r.oninput=function(e){if(!c.vm)return!0;if("insertText"===e.inputType||"insertCompositionText"===e.inputType||"insertFromComposition"===e.inputType){var t=0<n.length;if(t){var r=c.buttons;c.buttons&=~Squeak.Keyboard_All;for(var i=0;i<n.length;i++)recordKeyboardEvent(8,e.timeStamp,c);c.buttons=r,n=[]}for(var s=Array.from(e.data),i=0;i<s.length;i++)recordKeyboardEvent(s[i].codePointAt(0),e.timeStamp,c);!t&&e.isComposing&&"insertCompositionText"===e.inputType&&(n=n.concat(s))}n.length||o()},r.onkeydown=function(t){if(h(),!c.vm)return!0;if(!("Dead"===t.key)){recordModifiers(t,c);var e,r={8:8,9:9,13:13,27:27,32:32,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[t.keyCode];if(r)return recordKeyboardEvent(r,t.timeStamp,c),t.preventDefault();if(c.isMac?t.metaKey:t.ctrlKey)switch(t.key){case"c":case"x":return navigator.clipboard?("string"==typeof(e=c.executeClipboardCopyKey(t.key,t.timeStamp))&&navigator.clipboard.writeText(e).catch(function(e){console.error("display: copy error "+e.message)}),t.preventDefault()):void 0;case"v":return navigator.clipboard?(navigator.clipboard.readText().then(function(e){c.executeClipboardPasteKey(e,t.timeStamp)}).catch(function(e){console.error("display: paste error "+e.message)}),t.preventDefault()):void 0}return 1===t.key.length&&c.buttons&(Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl)?(r=t.key.toLowerCase().charCodeAt(0),c.buttons&Squeak.Keyboard_Ctrl&&96<=r&&r<127&&(r&=31),recordKeyboardEvent(r,t.timeStamp,c),t.preventDefault()):void 0}},r.onkeyup=function(e){if(!c.vm)return!0;recordModifiers(e,c)},o(),"ontouchstart"in document){let t=0;setInterval(()=>{var e=r.selectionStart-1;0==e?t=0:((0===t||2<t)&&recordKeyboardEvent(e<1?28:29,Date.now(),c),r.selectionStart=1,r.selectionEnd=1,t++)},250)}function v(e){for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return 1}function g(){var e,t,r,i,s,n,a,o;f.orig||(e=window.innerWidth,t=window.innerHeight,clearTimeout(m),m=setTimeout(function(){e==window.innerWidth&&t==window.innerHeight?c.resizeDone():g()},300),r=window.innerWidth,i=window.innerHeight,n=s=0,l.fixedWidth?(c.width=l.fixedWidth,c.height=l.fixedHeight,(o=c.width/c.height)<r/i?s=r-Math.floor(i*o):n=i-Math.floor(r/o),c.scale=(r-s)/c.width):(l.minWidth||(l.minWidth=700),l.minHeight||(l.minHeight=700),o=c.highdpi?window.devicePixelRatio:1,a=r<l.minWidth?l.minWidth/r:o,o=i<l.minHeight?l.minHeight/i:o,a=Math.max(a,o),c.width=Math.floor(r*a),c.height=Math.floor(i*a),c.scale=r/c.width),u.width==c.width&&u.height==c.height||(o=(l.fixedWidth||!c.resizeTodo)&&c.context.getImageData(0,0,u.width,u.height),u.width=c.width,u.height=c.height,o&&c.context.putImageData(o,0,0)),d(0+Math.floor(s/2),0+Math.floor(n/2),r-s,i-n))}return navigator.clipboard?(c.readFromSystemClipboard=()=>c.handlingEvent&&navigator.clipboard.readText().then(e=>c.clipboardString=e).catch(e=>console.error("readFromSystemClipboard "+e.message)),c.writeToSystemClipboard=()=>c.handlingEvent&&navigator.clipboard.writeText(c.clipboardString).then(()=>c.clipboardStringChanged=!1).catch(e=>console.error("writeToSystemClipboard "+e.message))):(document.oncopy=function(e,t){t=c.executeClipboardCopyKey(t,e.timeStamp);"string"==typeof t&&e.clipboardData.setData("Text",t),e.preventDefault()},document.oncut=function(e){if(!c.vm)return!0;document.oncopy(e,"x")},document.onpaste=function(e){var t=e.clipboardData.getData("Text");c.executeClipboardPasteKey(t,e.timeStamp),e.preventDefault()}),document.ondragover=function(e){e.preventDefault(),v(e)?(e.dataTransfer.dropEffect="copy",recordDragDropEvent(Squeak.EventDragMove,e,u,c)):e.dataTransfer.dropEffect="none"},document.ondragenter=function(e){v(e)&&recordDragDropEvent(Squeak.EventDragEnter,e,u,c)},document.ondragleave=function(e){v(e)&&recordDragDropEvent(Squeak.EventDragLeave,e,u,c)},document.ondrop=function(i){var s,n,a,o;return i.preventDefault(),v(i)&&(s=[].slice.call(i.dataTransfer.files),n=[],o=null,c.droppedFiles=[],s.forEach(function(t){var r=l.root+t.name,e=(c.droppedFiles.push(r),new FileReader);e.onload=function(){var e=this.result;Squeak.filePut(r,e),n.push(r),a||!/.*image$/.test(r)||c.vm&&!confirm("Run "+t.name+" now?\n(cancel to use as file)")||(a=e,o=r),n.length==s.length&&(a?c.vm?(c.quitFlag=!0,l.onQuit=function(e,t,r){r.onQuit=null,SqueakJS.appName=o.replace(/.*\//,"").replace(/\.image$/,""),SqueakJS.runImage(a,o,t,r)}):(SqueakJS.appName=o.replace(/.*\//,"").replace(/\.image$/,""),SqueakJS.runImage(a,o,c,l)):recordDragDropEvent(Squeak.EventDragDrop,i,u,c))},e.readAsArrayBuffer(t)})),!1},l.embedded||(g(),window.onresize=g),c}function setupSpinner(t,e){e=e.spinner;return e?(e.onmousedown=function(e){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(t.interruptPending=!0)},e.style):null}var spinnerAngle=0,becameBusy=0,loop;function updateSpinner(e,t,r,i){i=r.lastTick-i.lastTick<500;!(0===t)||i?(e.display="none",becameBusy=0):0===becameBusy?becameBusy=r.lastTick:1e3<r.lastTick-becameBusy&&(e.display="block",spinnerAngle=(spinnerAngle+30)%360,e.webkitTransform=e.transform="rotate("+spinnerAngle+"deg)")}function processOptions(e){var t=(location.hash||location.search).slice(1),r=t&&t.split("&");if(r)for(var i=0;i<r.length;i++){var s=r[i].split("="),n=s[0],a=!0;if(1<s.length&&(a=decodeURIComponent(s.slice(1).join("="))).match(/^(true|false|null|[0-9"[{].*)$/))try{a=JSON.parse(a)}catch(e){"["===a[0]&&(a=a.slice(1,-1).split(","))}e[n]=a}t=Squeak.splitFilePath(e.root||"/").fullname;Squeak.dirCreate(t,!0),/\/$/.test(t)||(t+="/"),e.root=t,e.w&&(e.fixedWidth=e.w),e.h&&(e.fixedHeight=e.h),e.fixedWidth&&!e.fixedHeight&&(e.fixedHeight=3*e.fixedWidth/4|0),e.fixedHeight&&!e.fixedWidth&&(e.fixedWidth=4*e.fixedHeight/3|0),e.fixedWidth&&e.fixedHeight&&(e.fullscreen=!0),SqueakJS.options=e}function fetchTemplates(e){var t,r;if(e.templates)for(r in e.templates.constructor===Array&&(t={},e.templates.forEach(function(e){t[e]=e}),e.templates=t),e.templates){var i="/"==r[0]?r:e.root+r,s=new URL(e.url,document.baseURI).href.split(/[?#]/)[0],s=Squeak.splitUrl(e.templates[r],s).full;(s=s.endsWith("/")?s.slice(0,-1):s).endsWith("/.")&&(s=s.slice(0,-2)),Squeak.fetchTemplateDir(i,s)}}function processFile(e,t,r,i){Squeak.filePut(r.root+e.name,e.data,function(){console.log("Stored "+r.root+e.name),e.zip?processZip(e,t,r,i):i()})}function processZip(n,a,o,u){a.showBanner("Analyzing "+n.name),JSZip.loadAsync(n.data,{createFolders:!0}).then(function(e){var i=[];if(e.forEach(function(e,t){var r;e.startsWith("__MACOSX/")||e.endsWith(".DS_Store")||(t.dir?(e=e.replace(/\/$/,""),Squeak.dirCreate(o.root+e,!0)):(!o.image.name&&e.match(/\.image$/)&&(o.image.name=e),o.forceDownload||!Squeak.fileExists(o.root+e)?i.push(e):o.image.name===e&&(r=u,u=function(){Squeak.fileGet(o.root+e,function(e){return o.image.data=e,r()},function(){return Squeak.fileDelete(o.root+n.name),processZip(n,a,o,r)})})))}),0===i.length)return u();var s=0;a.showBanner("Unzipping "+n.name),a.showProgress(0),i.forEach(function(r){console.log("Inflating "+n.name+": "+r),e.file(r).async("arraybuffer",function(e){a.showProgress((e.percent/100+s)/i.length)}).then(function(e){console.log("Expanded size of "+r+": "+e.byteLength+" bytes");var t={};(t=o.image.name===r?o.image:t).name=r,t.data=e,processFile(t,a,o,function(){++s===i.length&&u()})})})})}function checkExisting(t,r,i,s,e){if(!Squeak.fileExists(i.root+t.name))return e();t.image||t.zip?Squeak.fileGet(i.root+t.name,function(e){t.data=e,t.zip?processZip(t,r,i,s):s()},function(){return Squeak.fileDelete(i.root+t.name),e()}):s()}function downloadFile(i,t,s,r){t.showBanner("Downloading "+i.name);var n=new XMLHttpRequest,e=s.proxy||"";n.open("GET",e+i.url),s.ajax&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.responseType="arraybuffer",n.onprogress=function(e){e.lengthComputable&&t.showProgress(e.loaded/e.total)},n.onload=function(e){200==this.status?(i.data=this.response,processFile(i,t,s,r)):this.onerror(this.statusText)},n.onerror=function(e){if(s.proxy)return console.error(Squeak.bytesAsString(new Uint8Array(this.response))),alert("Failed to download:\n"+i.url);var t=Squeak.defaultCORSProxy,r=new XMLHttpRequest;console.warn("Retrying with CORS proxy: "+t+i.url),r.open("GET",t+i.url),s.ajax&&r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.responseType=n.responseType,r.onprogress=n.onprogress,r.onload=n.onload,r.onerror=function(){console.error(Squeak.bytesAsString(new Uint8Array(this.response))),alert("Failed to download:\n"+i.url)},r.send()},n.send()}function fetchFiles(r,i,s,n){!function e(){if(0===r.length)return n();var t=r.shift();s.forceDownload||t.forceDownload?downloadFile(t,i,s,e):checkExisting(t,i,s,function(){e()},function(){downloadFile(t,i,s,e)})}()}SqueakJS.runImage=function(t,s,n,a){window.onbeforeunload=function(e){var t=SqueakJS.appName+" is still running";return e.returnValue=t},window.clearTimeout(loop),n.reset(),n.clear(),n.showBanner("Loading "+SqueakJS.appName),n.showProgress(0),window.setTimeout(function(){var e=new Squeak.Image(s);e.readFromBuffer(t,function(){n.quitFlag=!1;var t=new Squeak.Interpreter(e,n,a),r=(SqueakJS.vm=t,Squeak.Settings.squeakImageName=s,n.clear(),n.showBanner("Starting "+SqueakJS.appName),setupSpinner(t,a));function i(){try{n.quitFlag?SqueakJS.onQuit(t,n,a):t.interpret(50,function(e){"sleep"==e&&(e=200),r&&updateSpinner(r,e,t,n),loop=window.setTimeout(i,e)})}catch(e){console.error(e),alert(e)}}n.runNow=function(e){window.clearTimeout(loop),n.handlingEvent=e,i(),n.handlingEvent=""},n.runFor=function(e,t){var r=Date.now()+e;do{if(n.quitFlag)return}while(n.runNow(t),Date.now()<r)},a.onStart&&a.onStart(t,n,a),i()},function(e){n.showProgress(e)})},0)},SqueakJS.runSqueak=function(e,t,r={}){t||((t=document.createElement("canvas")).style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",document.body.appendChild(t)),processOptions(r),e&&e.endsWith(".zip")&&(r.zip=e.match(/[^\/]*$/)[0],r.url=e.replace(/[^\/]*$/,""),e=null),!e&&r.image&&(e=r.image);var i,s=r.url||"",n=(!s&&e&&e.replace(/[^\/]*$/,"")&&(s=e.replace(/[^\/]*$/,""),e=e.replace(/^.*\//,"")),"/"===(r.url=s)[0]&&"/"!==s[1]&&1<s.length&&"/"===r.root&&(r.root=s),fetchTemplates(r),createSqueakDisplay(t,r)),a={url:null,name:null,image:!0,data:null},o=[];return n.argv=r.argv,e&&(i=Squeak.splitUrl(e,s),a.url=i.full,a.name=i.filename),r.files&&r.files.forEach(function(e){var t=Squeak.splitUrl(e,s);a.name!==t.filename&&(!a.url&&e.match(/\.image$/)?(a.name=t.filename,a.url=t.full):o.push({url:t.full,name:t.filename}))}),r.zip&&("string"==typeof r.zip?[r.zip]:r.zip).forEach(function(e){var e=Squeak.splitUrl(e,s),t="";!e.filename.match(/[0-9]/)&&e.uptoslash.match(/[0-9]/)&&(t=e.uptoslash.replace(/^[^:]+:\/\//,"").replace(/[^a-zA-Z0-9]/g,"_")),o.push({url:e.full,name:t+e.filename,zip:!0})}),a.url&&o.push(a),r.document&&(i=Squeak.splitUrl(r.document,s),o.push({url:i.full,name:i.filename,forceDownload:!1!==r.forceDownload}),n.documentName=r.root+i.filename),r.image=a,fetchFiles(o,n,r,function(){Squeak.fsck();var e=r.image;return e.name?e.data?(SqueakJS.appName=r.appName||e.name.replace(/(.*\/|\.image$)/g,""),void SqueakJS.runImage(e.data,r.root+e.name,n,r)):alert("could not find image "+e.name):alert("could not find an image")}),n},SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0},SqueakJS.onQuit=function(e,t,r){window.onbeforeunload=null,t.vm=null,r.spinner&&(r.spinner.style.display="none"),r.onQuit?r.onQuit(e,t,r):t.showBanner(SqueakJS.appName+" stopped.")},window.applicationCache&&applicationCache.addEventListener("updateready",function(){var e=window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS";confirm(e+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())})}();